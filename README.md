# INFINITE-GALAXY



	<!DOCTYPE html>
	<html lang='en'>
		<head>
			<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
			<meta property='og:image' content='http://www.ad2460.com/images/webgfx/share_on_fb.jpg'/>
			<meta name='keywords' content='AD2460, Online strategy game, Online strategy, Science fiction, Sci-fi, Space-combat, Stellar combat'/>
			<meta name='description' content='AD2460 is simply the best next-gen online sci-fi game on the web'/>
			<meta name='robots' content='index,follow'/>
			<meta name='robots' content='noodp'/>
			<meta name='robots' content='noydir'/>
			<!--<meta name='viewport' content='height=device-height, user-scalable=yes'> -->
			<meta name='viewport' content='width=1366,maximum-scale=1'>
			<meta name='copyright' content='Copyright 2009-2010. Fifth Season AS, Oslo, Norway. All Rights Reserved.'/>
			<meta name='author' content='AD2460'/>
			<meta name='format-detection' content='telephone=no'>
			<title>AD2460 - The Game</title>
			
		

			<script type='text/javascript'>image_server='http://live.ad2460.com';</script>

			<script type='text/javascript' src='javascript/jquery-2.0.3.min.js'></script>
			<script type='text/javascript' src='javascript/jquery-ui.min.js'></script>

			<!--<script type='text/javascript' src='javascript/jquery.hotkeys-0.7.9.min.js'></script>-->
			<script type='text/javascript' src='javascript/mousetrap.min.js'></script>

			<script type='text/javascript' src='javascript/jquery.easing.1.3.js'></script>
			<script type='text/javascript' src='javascript/jquery.backgroundpos.js'></script>
			<script type='text/javascript' src='javascript/jquery.mousewheel.js'></script>
			<script type='text/javascript' src='javascript/jquery.transit.min.js'></script>
			<script type='text/javascript' src='javascript/jquery.lettering.js'></script>
			<script type='text/javascript' src='javascript/jquery.textillate.js'></script>
			<script type='text/javascript' src='javascript/upclick-min.js?rn=_v2_1507203681'></script>



			<script type='text/javascript'>
			// Copyright 2010-2016 Fifth Season AS
// Author: Christian "Spinner" Lassem
// If there is anythging here you wish to use, please contact me and ask permission. <firstname>.<lastname>@ad2460.com will do the trick.

// All global variables for AD2460 should be contained here.
// This includes empty containers also.

var specialPublicPlayer=false;

var ad2460={};

ad2460.serverTime=0;
ad2460.supportTickets=new Array;

ad2460.currentPageSection='Homeworld';
ad2460.currentPageSectionId='homeworld_content';

ad2460.extendedGUI=false;

ad2460.mobilebrowser=false;

ad2460.connectionFailures=new Array;
ad2460.lastConnectionFail=0;

ad2460.lastClosedShow=0;

ad2460.credits=0;
ad2460.techpoints=0;
ad2460.uncomittedTechPoints=0;

ad2460.amnestyUntilTime=0;

ad2460.playerUpdates=new Array;
ad2460.playerUpdatesImages=new Array;

ad2460.galaxyNews=new Array;

ad2460.referrals=new Array;

ad2460.wargames=new Array;

ad2460.currentPageSection='Homeworld';
ad2460.currentPageSectionId='homeworld_content';

ad2460.fullnewsVisible=false;
ad2460.galaxynewsVisible=false;

ad2460.read_intel_reports=new Array;

ad2460.missionRankings=new Array;
ad2460.missionPersonalRankings=new Array;


ad2460.playerUpdatesImages.push('images/planets/notification/notify_welcome.jpg');			// 0
ad2460.playerUpdatesImages.push('images/planets/notification/notify_player_levelup.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_facility.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_research.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_development.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_production.jpg');		// 5
ad2460.playerUpdatesImages.push('images/planets/notification/notify_prospecting.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_outpost_upgraded.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_commander_levelup.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_under_attack.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/notify_transport_return.jpg');	// 10
ad2460.playerUpdatesImages.push('images/planets/notification/notify_scout.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_espionage.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_infiltration.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/notify_alliance.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/notify_fleet_jump.jpg');		// 15
ad2460.playerUpdatesImages.push('images/planets/notification/notify_upkeep_fail.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/notify_commander_death.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/notify_salvage.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_mission_succeess.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/notify_mission_succeess.jpg'); // 20  Failed, but using same source as te above to avoid revealing...

ad2460.playerUpdatesImages.push('images/planets/notification/notify_infiltrator_activity_report.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/notify_launch.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/notify_station_attack.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/notify_wargame.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/notify_bounty.jpg'); // 25

ad2460.playerUpdatesImages.push('images/planets/notification/notify_bounty_claim.jpg'); // 26

ad2460.playerUpdatesImages.push('images/planets/notification/notify_inc_scout.jpg'); // 27
ad2460.playerUpdatesImages.push('images/planets/notification/notify_inc_espionage.jpg'); // 28
ad2460.playerUpdatesImages.push('images/planets/notification/notify_inc_infiltration.jpg'); // 29

ad2460.playerUpdatesImages.push('images/planets/notification/notify_bounty_claim.jpg'); // 30 donation received

ad2460.playerUpdatesImages.push('images/planets/notification/planettype01.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype02.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype03.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype04.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype05.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype06.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype07.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype08.jpg');

ad2460.playerUpdatesImages.push('images/planets/notification/planettype08.jpg'); // !!!!
ad2460.playerUpdatesImages.push('images/planets/notification/planettype08.jpg'); // !!!!

ad2460.playerUpdatesImages.push('images/planets/notification/planettype11.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype12.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype13.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype14.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype15.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype16.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype17.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype18.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype19.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype20.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype21.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype22.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype23.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype24.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype25.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype26.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype27.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype28.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype29.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype30.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype31.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype32.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype33.jpg');
ad2460.playerUpdatesImages.push('images/planets/notification/planettype34.jpg');

ad2460.systemImages=new Array;
ad2460.systemImages.push(image_server+'/images/systemicons/systemicon.png');
ad2460.systemImages.push(image_server+'/images/systemicons/erroricon.png');
ad2460.systemImages.push(image_server+'/images/systemicons/okicon.png');
ad2460.systemImages.push(image_server+'/images/systemicons/globeicon.png');

ad2460.updateTimes={};

ad2460.updateTimes.lastPlayerUpdateFetch=0;
ad2460.updateTimes.lastMailFetch=0;
ad2460.updateTimes.lastForumFetch=0;
ad2460.updateTimes.lastFacilityFetch=0;
ad2460.updateTimes.lastResearchFetch=0;
ad2460.updateTimes.lastDevelopmentFetch=0;
ad2460.updateTimes.lastChatFetch=0;



ad2460.feedbackQueue=new Array;
ad2460.feedbackBusy=false;

ad2460.globalStarOpacity=1;

ad2460.detected_events = new Array;
ad2460.showing_detected_events_box=false;
ad2460.show_detected_events=true;

ad2460.playerflags=new Array;

ad2460.audioVars={};
ad2460.audioVars.soundEnabled=false;
ad2460.audioVars.sfxVolume=0;
ad2460.audioVars.musicVolume=0;
ad2460.audioVars.combatsfxVolume=0;
ad2460.audioVars.combatmusicVolume=0;

ad2460.noteVars={};
ad2460.noteVars.selected_note_id=0;
ad2460.noteVars.edit_note_id=0;
ad2460.noteVars.notes=new Array;

ad2460.galaxyNewsTitles=['Unknown','Mighty Clashes','Awesome Robbery','Slaughter','The Magellan','Attacking Poodle','Defending Poodle','Drums Of War','The Shield','Sector-control','Most Wanted','Bounty Hunter','Behemoth'];
ad2460.galaxyNewsStrings=['','','','','Clusters: ','','','Attacks: ','Def-Wins: '];
ad2460.moonhoursX=new Array;
ad2460.moonhoursY=new Array;
ad2460.moonhoursX=[0,60,120,180,240,300,360,420,480,540,600,660,720,660,600,540,480,420,360,300,240,180,120,60];
ad2460.moonhoursY=[300,312,324,336,348,360, 372,360,348,336,324,312, 300,288,276,264,252,240, 228,240, 252, 264,276,288];

ad2460.max_outposts_by_level=new Array;
//ad2460.max_outposts_by_level=[2,2,3,4,6,7,8,9,11,12,13,14,15,16,17,18,19,20,21,23,25];
//ad2460.max_outposts_by_level=[3,6,9,12,15,20,25,30,35,40,50,60,75,100,150,200,250,300,350,400,500];
//ad2460.max_outposts_by_level=[1,2,3,3,4,5,5, 6, 7, 8, 9,10,10,11,12,13,14,15,15,16,17, 18, 19, 20, 21, 22];
ad2460.max_outposts_by_level=[1,1,2,3,3,4,5,5, 6, 7, 8, 9,10,10,11,12,13,14,15,15,16,17, 18, 19, 20, 21, 22];


ad2460.forum={};
ad2460.forum.rendering=false; // A lock variable
ad2460.forum.threadlock=false; // A lock variable

ad2460.forum.forums=new Array;
ad2460.forum.selected_forum_id=0;
ad2460.forum.selected_thread_id=0;
ad2460.forum.threads=new Array;
ad2460.forum.posts=new Array;
ad2460.forum.latest_threads=new Array;
ad2460.forum.latest_alliance_threads=new Array;
ad2460.forum.posterDetailsVisible=-1;

ad2460.forum.last_threads_render_type='';
ad2460.forum.last_threads_render_time=0;

ad2460.forum.myRecentThreads=new Array;

ad2460.conversations=new Array;
ad2460.selectedConversationId=0;
ad2460.lastConvSendTime=new Date;

ad2460.admin_status=0;

ad2460.developments=new Array;
ad2460.researches=new Array;
ad2460.facilities=new Array;
ad2460.productionitems=new Array;

ad2460.productionqueue=new Array;

ad2460.homeworldSelectedItems={};
ad2460.homeworldSelectedItems.production=0;
ad2460.homeworldSelectedItems.production_view='available';
ad2460.homeworldSelectedItems.facility_id=0;

ad2460.homeworldSelectedItems.building_id=0;
ad2460.homeworldSelectedItems.facility_info_id=0;
ad2460.homeworldSelectedItems.facility_info_level=0;

ad2460.homeworldSelectedItems.research=0;
ad2460.homeworldSelectedItems.research_view='available';
ad2460.homeworldSelectedItems.development=0;
ad2460.homeworldSelectedItems.development_view='available';


ad2460.techitems=new Array;
ad2460.techVariables={};
ad2460.techVariables.selectedTechItemId=0;
ad2460.techVariables.previousSelectedTechItemId=0;
ad2460.techVariables.spentTechPointsMatter=0;
ad2460.techVariables.spentTechPointsEnergy=0;
ad2460.techVariables.spentTechPointsDisplacement=0;
ad2460.techVariables.previousSelectedTechItemBranch='';
ad2460.techVariables.selectedTechItemBranch='';
ad2460.techVariables.bonusPanelOpen=false;

ad2460.techVariables.tiers=new Array;
ad2460.techVariables.tiers.push({branch:'Matter',		tier:1, open:true,	spent_points:0, temp_points:0, requires:0});
ad2460.techVariables.tiers.push({branch:'Matter',		tier:2, open:false, spent_points:0, temp_points:0, requires:10});
ad2460.techVariables.tiers.push({branch:'Matter',		tier:3, open:false, spent_points:0, temp_points:0, requires:20});
ad2460.techVariables.tiers.push({branch:'Matter',		tier:4, open:false, spent_points:0, temp_points:0, requires:30});
ad2460.techVariables.tiers.push({branch:'Matter',		tier:5, open:false, spent_points:0, temp_points:0, requires:40});
ad2460.techVariables.tiers.push({branch:'Matter',		tier:6, open:false, spent_points:0, temp_points:0, requires:50});
ad2460.techVariables.tiers.push({branch:'Energy',		tier:1, open:true,	spent_points:0, temp_points:0, requires:0});
ad2460.techVariables.tiers.push({branch:'Energy',		tier:2, open:false, spent_points:0, temp_points:0, requires:10});
ad2460.techVariables.tiers.push({branch:'Energy',		tier:3, open:false, spent_points:0, temp_points:0, requires:20});
ad2460.techVariables.tiers.push({branch:'Energy',		tier:4, open:false, spent_points:0, temp_points:0, requires:30});
ad2460.techVariables.tiers.push({branch:'Energy',		tier:5, open:false, spent_points:0, temp_points:0, requires:40});
ad2460.techVariables.tiers.push({branch:'Energy',		tier:6, open:false, spent_points:0, temp_points:0, requires:50});
ad2460.techVariables.tiers.push({branch:'Displacement',	tier:1, open:true,	spent_points:0, temp_points:0, requires:0});
ad2460.techVariables.tiers.push({branch:'Displacement',	tier:2, open:false, spent_points:0, temp_points:0, requires:10});
ad2460.techVariables.tiers.push({branch:'Displacement',	tier:3, open:false, spent_points:0, temp_points:0, requires:20});
ad2460.techVariables.tiers.push({branch:'Displacement',	tier:4, open:false, spent_points:0, temp_points:0, requires:30});
ad2460.techVariables.tiers.push({branch:'Displacement',	tier:5, open:false, spent_points:0, temp_points:0, requires:40});
ad2460.techVariables.tiers.push({branch:'Displacement',	tier:6, open:false,	spent_points:0, temp_points:0, requires:50});

ad2460.techpointsList=new Array;
ad2460.techpointsWindowOpen=false;
ad2460.techpointsClaimerRunning=false;
ad2460.unclaimedTechpoints=new Array;
ad2460.undisplayedTechpoints=new Array;

ad2460.sepDivText=new Array;
ad2460.sepDivText.push("None");
ad2460.sepDivText.push("Capital ships");
ad2460.sepDivText.push("Minor ships");
ad2460.sepDivText.push("Defensive Units");
ad2460.sepDivText.push("Utility-ships");
ad2460.sepDivText.push("Outposts");

ad2460.researchExpanderOpen='';
ad2460.productionQueueExpanderOpen='';
ad2460.allianceProjectsExpanderOpen='';
ad2460.allienceOwnTradeExpanderOpen='';
ad2460.developmentExpanderOpen='';

ad2460.developmentInProgress=false;
ad2460.researchInProgress=false;
ad2460.facilityInProgress=false;

ad2460.resources={};
ad2460.resources.hassium=0;
ad2460.resources.neodymium=0;
ad2460.resources.strontium=0;
ad2460.resources.indium=0;

ad2460.resources.max_storage={};
ad2460.resources.max_storage.hassium=0;
ad2460.resources.max_storage.neodymium=0;
ad2460.resources.max_storage.strontium=0;
ad2460.resources.max_storage.indium=0;

ad2460.trade_resource_storage={};
ad2460.trade_resource_storage.hassium=0;
ad2460.trade_resource_storage.neodymium=0;
ad2460.trade_resource_storage.strontium=0;
ad2460.trade_resource_storage.indium=0;

ad2460.temp={};

ad2460.timers=new Array;

ad2460.lastBlur;
ad2460.lastFocus;

ad2460.renderEffects={};
ad2460.renderEffects.stars=true;
ad2460.renderEffects.nebulas=true;
ad2460.renderEffects.comets=true;

ad2460.sound={};
ad2460.sound.playeffects=true;
ad2460.sound.playmusic=false;

ad2460.myFleets=new Array;
ad2460.fleetvars={};
ad2460.fleetvars.selected_fleet_id=0;
ad2460.fleetvars.selected_shiptype_row_id='';
ad2460.fleetvars.total_capital_ship_count=0;
ad2460.fleetvars.total_fleet_count=0;
ad2460.fleetvars.total_shortage_for_all_fleets=0;
ad2460.fleetvars.fleets_with_shortage=0;

ad2460.fleetvars.fleet_movement_selected_fleet_id=0;

ad2460.fleetvars.selectedFleetReassignArray=new Array;
ad2460.fleetvars.reassignmentOrders=new Array;
ad2460.fleetvars.selectedFleetReassignShipType=0;
ad2460.fleetvars.takeOnlySurplus=false;
ad2460.fleetvars.reassignPanelVisible=0;
ad2460.fleetvars.lastFetch=0;

ad2460.defFleets=new Array;
ad2460.defCommanders=new Array;

ad2460.scores={};
//ad2460.scores.score=0;
//ad2460.scores.strength=0;
//ad2460.scores.xp=0;
//ad2460.scores.level=0;

ad2460.rankings={};
//ad2460.rankings.score=0;
//ad2460.rankings.strength=0;
//ad2460.rankings.xp=0;

ad2460.homeworld={};
ad2460.homeworld.x=0;
ad2460.homeworld.y=0;
ad2460.homeworld.quadrant=0;
ad2460.homeworld.sector=0;
ad2460.homeworld.cluster=0;
ad2460.homeworld.system=0;
ad2460.homeworld.position=0;
ad2460.homeworld.name="";
ad2460.homeworld.orbit=new Array;

ad2460.allianceData={};
ad2460.allianceData.id=0;
ad2460.allianceData.rank_id=0;
ad2460.allianceData.name='';
ad2460.allianceData.motd='';
ad2460.allianceData.logo='none.jpg';
ad2460.allianceData.stations=new Array;
ad2460.allianceData.lastAllianceMenuSelected='none';
ad2460.allianceData.lastNewsRendered=0;

ad2460.allianceData.alliance_fleet_max_rank=-1;

ad2460.allianceData.alliance_information='';
ad2460.allianceData.memberlist=new Array;
ad2460.allianceData.invitedlist=new Array;
ad2460.allianceData.invitations=new Array;
ad2460.allianceData.selected_member_id=0;
ad2460.allianceData.selected_project_group=0;

ad2460.allianceData.rankDetails=new Array;
ad2460.allianceData.bank={};
ad2460.allianceData.myBank={};
ad2460.allianceData.bankLog=new Array;

ad2460.allianceData.sectorBonuses={outpost_mining:0, homeworld_mining:0, primary_damage:0, secondary_damage:0, tertiary_damage:0, shield_regen:0, absorbption:0, production_cost:0};


ad2460.allianceData.news=new Array;
ad2460.allianceData.newsFilters=new Array;
ad2460.allianceData.newsFilters.push(false);
ad2460.allianceData.newsFilters.push(true);
ad2460.allianceData.newsFilters.push(true);
ad2460.allianceData.newsFilters.push(true);
ad2460.allianceData.newsFilters.push(true);
ad2460.allianceData.newsFilters.push(true);


ad2460.allianceData.newTrade={};
ad2460.allianceData.newTrade.fromResId=1;
ad2460.allianceData.newTrade.toResId=2;

ad2460.allianceData.trade={};
ad2460.allianceData.trade.fromExchangeRes=1;
ad2460.allianceData.trade.toExchangeRes=2;
ad2460.allianceData.trade.hs_exchange_value=1.25;
ad2460.allianceData.trade.nd_exchange_value=1.00;
ad2460.allianceData.trade.sr_exchange_value=1.00;
ad2460.allianceData.trade.in_exchange_value=1.00;
ad2460.allianceData.trade.max_trade_length=24*60*60;

ad2460.allianceData.trade.filters={};

ad2460.allianceData.trade.filters.to={};
ad2460.allianceData.trade.filters.to.hs=1;
ad2460.allianceData.trade.filters.to.nd=1;
ad2460.allianceData.trade.filters.to.sr=1;
ad2460.allianceData.trade.filters.to.in=1;

ad2460.allianceData.trade.filters.from={};
ad2460.allianceData.trade.filters.from.hs=1;
ad2460.allianceData.trade.filters.from.nd=1;
ad2460.allianceData.trade.filters.from.sr=1;
ad2460.allianceData.trade.filters.from.in=1;

ad2460.allianceData.trades=new Array;

ad2460.openPanels=new Array;

ad2460.chatPaneVisible=0;
ad2460.mailPaneVisible=0;
ad2460.forumPaneVisible=0;

ad2460.openQuickMenues={};
ad2460.openQuickMenues.selected_fleet_reassign=false;
ad2460.openQuickMenues.selected_fleet_resupply=false;
ad2460.openQuickMenues.selected_fleet_configuration=false;
ad2460.openQuickMenues.selected_fleet_tactics=false;
ad2460.openQuickMenues.outpost_transport_panel=false;
ad2460.openQuickMenues.build_info=false;
ad2460.openQuickMenues.all_ships=false;
ad2460.openQuickMenues.starmap_intel_panel=false;
ad2460.openQuickMenues.station_breakdown=false;

ad2460.confirmationBoxOpen=false;
ad2460.okBoxOpen=false;

ad2460.openSlides=new Array;

ad2460.selectedChannel="";
ad2460.mySentChatHistory=new Array;
ad2460.currentChatHistory=-1;
ad2460.subscribedChannels=new Array;
ad2460.chatFetching=false;

ad2460.subscribedChannels.push({messages:new Array, channel:"global",domId:"global_chat_container_table_body"});
ad2460.subscribedChannels.push({messages:new Array, channel:"help",domId:"quadrant_chat_container_table_body"});
ad2460.subscribedChannels.push({messages:new Array, channel:"alliance",domId:"alliance_chat_container_table_body"});

ad2460.allianceMemberTags=new Array;
ad2460.allianceMemberTags.push('');
ad2460.allianceMemberTags.push('Recruitment Officer');
ad2460.allianceMemberTags.push('Missions Officer');
ad2460.allianceMemberTags.push('Fleet Officer');
ad2460.allianceMemberTags.push('Member Helper');
ad2460.allianceMemberTags.push('Tax Officer');
ad2460.allianceMemberTags.push('Projects Manager');
ad2460.allianceMemberTags.push('PR Officer');


ad2460.alliancePrivilegesHeaders=new Array;
ad2460.alliancePrivilegesHeaders.push('Invitation Rights');
ad2460.alliancePrivilegesHeaders.push('Kicking Rights');
ad2460.alliancePrivilegesHeaders.push('Banking Rights');
ad2460.alliancePrivilegesHeaders.push('Info Rights');
ad2460.alliancePrivilegesHeaders.push('Project Rights');
ad2460.alliancePrivilegesHeaders.push('Mission Rights');
ad2460.alliancePrivilegesHeaders.push('Taxation Rights');
ad2460.alliancePrivilegesHeaders.push('Military Rights');
ad2460.alliancePrivilegesHeaders.push('Promotion Rights');
ad2460.alliancePrivilegesHeaders.push('Moderation Rights');

ad2460.alliancePrivilegesComments=new Array;
ad2460.alliancePrivilegesComments.push('Allows Officer to invite new players into the alliance.');
ad2460.alliancePrivilegesComments.push('Enables officer to kick alliance members out of the alliance.');
ad2460.alliancePrivilegesComments.push('Enables officer to manage the alliance-bank, including donations.');
ad2460.alliancePrivilegesComments.push('Enables the officer to edit the alliance info sections and the MOTD.');
ad2460.alliancePrivilegesComments.push('Enables the officer to initiate new alliance advancement projects.');
ad2460.alliancePrivilegesComments.push('Enables the officer to assemble fleets and initiate alliance missions.');
ad2460.alliancePrivilegesComments.push('Enables the officer to modify the parameters of the alliance tax system.');
ad2460.alliancePrivilegesComments.push('Enables the officer to control station tactics and who can use alliance-fleets.');
ad2460.alliancePrivilegesComments.push('Enables the officer to promote other members to within one rank of his own.');
ad2460.alliancePrivilegesComments.push('Enables the officer to moderate the Alliance Forum.');

ad2460.allianceData.typeStrings=new Array;
ad2460.allianceData.typeStrings.push('Free alliance');
ad2460.allianceData.typeStrings.push('Taxed alliance');

// Tax settings
ad2460.allianceData.type=0; // free alliance :: 1 = taxed alliance
ad2460.allianceData.tax={};
ad2460.allianceData.tax.percentage=0;
ad2460.allianceData.tax.bank_deposit_percentage=0;		// How much of the tax goes to the bank (vs redist to the players)
ad2460.allianceData.tax.withdrawal_limit=0;				// How much (of each resource) can a player withdraw / be donated to per day (24 hours)
ad2460.allianceData.tax.cod_percentage=0;				// Defines how many % of the total cost of a local purchase can be received from the bank if the player does not have the required resources available. Default is 0.
ad2460.allianceData.tax.cod_bank_percentage=0;			// Defines how much of the bank-content that can be used in one COD-operation
ad2460.allianceData.tax.cod_interval=1;					// Days
ad2460.allianceData.tax.change_timestamp=0;				// Pending change at timestamp
ad2460.allianceData.tax.change_type=0;					// Pending type-change
ad2460.allianceData.tax.change_percentage=0;			// Pending percentage-change
ad2460.allianceData.tax.percentage_change_timestamp=0;	// Pending change at timestamp

ad2460.allianceData.current_alliance_upkeep_percent=0;
ad2460.allianceData.next_cod_usage_timestamp=0;

ad2460.allianceData.avg_tax_paid={};
ad2460.allianceData.avg_tax_paid.hassium=0;
ad2460.allianceData.avg_tax_paid.neodymium=0;
ad2460.allianceData.avg_tax_paid.strontium=0;
ad2460.allianceData.avg_tax_paid.indium=0;

ad2460.allianceData.avg_tax_received={};
ad2460.allianceData.avg_tax_received.hassium=0;
ad2460.allianceData.avg_tax_received.neodymium=0;
ad2460.allianceData.avg_tax_received.strontium=0;
ad2460.allianceData.avg_tax_received.indium=0;

ad2460.allianceData.avg_alliance_upkeep_paid={};
ad2460.allianceData.avg_alliance_upkeep_paid.hassium=0;
ad2460.allianceData.avg_alliance_upkeep_paid.neodymium=0;
ad2460.allianceData.avg_alliance_upkeep_paid.strontium=0;
ad2460.allianceData.avg_alliance_upkeep_paid.indium=0;

ad2460.allianceData.projects=new Array;

ad2460.upkeep_debt={};
ad2460.upkeep_debt.hassium=0;
ad2460.upkeep_debt.indium=0;
ad2460.upkeep_debt.strontium=0;
ad2460.upkeep_debt.neodymium=0;

ad2460.universe={};
ad2460.universe.quadrants=new Array;
ad2460.universe.topAlliances=new Array;
ad2460.universe.topPlanets=new Array;
ad2460.universe.last_fetch=0;

ad2460.universe.starmaptoggles={};
ad2460.universe.starmaptoggles.topAlliances=1;
ad2460.universe.starmaptoggles.topPlanets=1;
ad2460.universe.starmaptoggles.myAlliance=1;
ad2460.universe.starmaptoggles.highConflict=1;

ad2460.universe.link_details_panel_open=false;
ad2460.universe.last_selected_link_id=0;

ad2460.universeSearches=new Array;

ad2460.prospectingMissions=new Array;
ad2460.prospectedClusters=new Array;

ad2460.outposts=new Array;
ad2460.lostOutposts=new Array;

ad2460.selected_outpost_planet_id=0;

ad2460.allianceCache=new Array;

ad2460.militarysettings={};
ad2460.militarysettings.selectedCombatLogId=0;

ad2460.outpostQuartClasses=new Array;
ad2460.outpostQuartClasses.push("quart_1");
ad2460.outpostQuartClasses.push("quart_2");
ad2460.outpostQuartClasses.push("quart_5");
ad2460.outpostQuartClasses.push("quart_6");
ad2460.outpostQuartClasses.push("quart_9");
ad2460.outpostQuartClasses.push("quart_10");
ad2460.outpostQuartClasses.push("quart_11");
ad2460.outpostQuartClasses.push("quart_12");

ad2460.outpostStorageLevels=new Array;
ad2460.outpostStorageLevels.push(5000);
ad2460.outpostStorageLevels.push(75000);
ad2460.outpostStorageLevels.push(125000);
ad2460.outpostStorageLevels.push(200000);
ad2460.outpostStorageLevels.push(300000);
ad2460.outpostStorageLevels.push(500000);
ad2460.outpostStorageLevels.push(600000);
ad2460.outpostStorageLevels.push(800000);
ad2460.outpostStorageLevels.push(1000000);
ad2460.outpostStorageLevels.push(1200000);
ad2460.outpostStorageLevels.push(1500000);
ad2460.outpostStorageLevels.push('N/A');

ad2460.outpostUpgradeTimeInHours=new Array;
ad2460.outpostUpgradeTimeInHours.push(0);
ad2460.outpostUpgradeTimeInHours.push(0.05);
ad2460.outpostUpgradeTimeInHours.push(0.10);
ad2460.outpostUpgradeTimeInHours.push(0.25);
ad2460.outpostUpgradeTimeInHours.push(0.5);
ad2460.outpostUpgradeTimeInHours.push(0.5);
ad2460.outpostUpgradeTimeInHours.push(0.5);
ad2460.outpostUpgradeTimeInHours.push(1);
ad2460.outpostUpgradeTimeInHours.push(1);
ad2460.outpostUpgradeTimeInHours.push(1);
ad2460.outpostUpgradeTimeInHours.push(0);

ad2460.outpostOutputPercentages=new Array;
ad2460.outpostOutputPercentages.push(0);
ad2460.outpostOutputPercentages.push(10);
ad2460.outpostOutputPercentages.push(16);
ad2460.outpostOutputPercentages.push(24);
ad2460.outpostOutputPercentages.push(32);
ad2460.outpostOutputPercentages.push(39);
ad2460.outpostOutputPercentages.push(47);
ad2460.outpostOutputPercentages.push(57);
ad2460.outpostOutputPercentages.push(70);
ad2460.outpostOutputPercentages.push(84);
ad2460.outpostOutputPercentages.push(100);
ad2460.outpostOutputPercentages.push(0);

ad2460.outpostUpgradeCosts=new Array;
ad2460.outpostUpgradeCosts.push({hassium:0,neodymium:0,strontium:0,indium:0});
ad2460.outpostUpgradeCosts.push({hassium:5000,neodymium:5000,strontium:5000,indium:5000});
ad2460.outpostUpgradeCosts.push({hassium:10000,neodymium:10000,strontium:10000,indium:10000});
ad2460.outpostUpgradeCosts.push({hassium:15000,neodymium:15000,strontium:15000,indium:15000});
ad2460.outpostUpgradeCosts.push({hassium:25000,neodymium:25000,strontium:25000,indium:25000});
ad2460.outpostUpgradeCosts.push({hassium:50000,neodymium:50000,strontium:50000,indium:50000});
ad2460.outpostUpgradeCosts.push({hassium:100000,neodymium:100000,strontium:100000,indium:100000});
ad2460.outpostUpgradeCosts.push({hassium:150000,neodymium:150000,strontium:150000,indium:150000});
ad2460.outpostUpgradeCosts.push({hassium:200000,neodymium:200000,strontium:200000,indium:200000});
ad2460.outpostUpgradeCosts.push({hassium:250000,neodymium:250000,strontium:250000,indium:250000});
ad2460.outpostUpgradeCosts.push({hassium:0,neodymium:0,strontium:0,indium:0});

ad2460.transportVars={};
ad2460.transportVars.cargoShips=new Array;
ad2460.transportVars.current_transport_percent_hassium=0;
ad2460.transportVars.current_transport_percent_neodymium=0;
ad2460.transportVars.current_transport_percent_strontium=0;
ad2460.transportVars.current_transport_percent_indium=0;

ad2460.transportVars.current_transport_amount_hassium=0;
ad2460.transportVars.current_transport_amount_neodymium=0;
ad2460.transportVars.current_transport_amount_strontium=0;
ad2460.transportVars.current_transport_amount_indium=0;
ad2460.transportVars.current_outpost_planet_id=0;
ad2460.transportVars.totalResToTransport=0;
ad2460.transportVars.selectedEscortFleetId=0;
ad2460.transportVars.transportPanelVisible=0;

ad2460.resupplyVars={};
ad2460.resupplyVars.resupplyPanelVisible=0;
ad2460.resupplyVars.normal_distribution=true;
ad2460.resupplyVars.fighters_only=false;
ad2460.resupplyVars.corvettes_only=false;
ad2460.resupplyVars.tier_2_only=false;
ad2460.resupplyVars.tier_1_fighters_only=false;

ad2460.outpostVars={};
ad2460.outpostVars.fleet_overview_commander_open=false;
ad2460.outpostVars.fleet_overview_tactics_open=false;
ad2460.outpostVars.sorting='default';
ad2460.outpostVars.upgradeInProgress=false;

ad2460.selectedCommanderId=0;
ad2460.myCommanders=new Array;
//ad2460.commander_xp_levels=[0,50,200,800,3200,6400,12800,25600,50000,75000,100000];
ad2460.commander_xp_levels=[0,100,250,500,1000,2000,4000,8000,16000,32000,64000];

ad2460.commander_colours=['blue', 'crimson', 'burgundy', 'grey', 'green', 'pink', 'indigo', 'brown', 'orange', 'aegean', 'moss'];
ad2460.selected_commander_colour='';
ad2460.editCommander=false;
ad2460.commander_max_fleets=[0,1,1,2,2,3,4,5,7,10,15];

// ad2460.playerXpLevels=[0,250,500,2000,5000,10000,15000,20000,30000,50000,100000,200000,300000,500000,750000,1000000,1500000,2000000,5000000,10000000,20000000,30000000,40000000];
ad2460.playerXpLevels=[0, 250, 500, 2000, 5000, 10000, 15000, 20000, 30000, 50000, 100000, 150000, 200000, 250000, 300000, 350000, 400000, 500000, 750000, 1000000, 2000000, 3000000, 4000000, 5000000, 10000000];

ad2460.playerLevelMaxCommanders=[3,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25];

ad2460.commanderCache=new Array;

ad2460.launchVars={};
ad2460.launchVars.selectedFleets=new Array;
ad2460.launchVars.planet={};
ad2460.launchVars.tactics=new tacticSetup(0, 'Closest ship', 'yes', 'yes', 'corvette defense', 'defense', 60, 'Capital ships', 'yes', 'yes');
ad2460.launchVars.currentShipView='none';

ad2460.intel={};
ad2460.intel.missions=new Array;
ad2460.intel.reports=new Array;
ad2460.intel.selectedReport=false; // To be filled by a report-object!
ad2460.intel.view_own_scouts=true;
ad2460.intel.view_own_spies=true;
ad2460.intel.view_own_infiltrators=true;
ad2460.intel.view_ally_scouts=true;
ad2460.intel.view_ally_spies=true;
ad2460.intel.view_ally_infiltrators=true;
ad2460.intel.last_log_view_param=false;
ad2460.intel.last_log_view_param_2=false;


ad2460.playerRankings=new Array;

ad2460.playerLinks=new Array;

ad2460.combat={};
ad2460.combat.loadedLaunchData={};
ad2460.combat.currentSelectedCombatId=0;
ad2460.combat.currentSelectedLaunchId=0;
ad2460.combat.attFleets=new Array;
ad2460.combat.defFleets=new Array;
ad2460.combat.attShips=new Array;
ad2460.combat.defShips=new Array;

ad2460.combat.effects=new Array;
ad2460.combat.missiles=new Array;

ad2460.combat.attCommander={};
ad2460.combat.defCommander={};

ad2460.combat.paused=false;

ad2460.combatLogs=new Array;

ad2460.combat.summaries=new Array;

ad2460.combat.ship_info_plate_left_open=0;
ad2460.combat.ship_info_plate_right_open=0;

ad2460.combat.selected_ship_type_id=0;
ad2460.combat.selected_ship_side='';


// From the config-library
ad2460.statics={};
ad2460.statics.global_upkeep_percentage=1;
ad2460.statics.resource_fill_time=60*5;
ad2460.statics.jumpengine_recharge_time=600;
ad2460.statics.max_fleet_percentage_in_alliance_fleet=20;
ad2460.statics.scout_time=180; // 5 min
ad2460.statics.espionage_time=5*60; // 15 min
ad2460.statics.infiltration_time=15*60; // 30 min
ad2460.statics.scout_detection_chance=50;
ad2460.statics.espionage_detection_chance=25;
ad2460.statics.infiltration_detection_chance=25;
ad2460.statics.infiltration_frequency=60*60*8;
ad2460.statics.resourceTiltStrings=["N/A", "N/A", "N/A", "N/A", "N/A", "N/A", "N/A", "N/A", "N/A", "N/A", "N/A"];
ad2460.statics.resourceTiltStrings.push("Hs");
ad2460.statics.resourceTiltStrings.push("Nd");
ad2460.statics.resourceTiltStrings.push("Sr");
ad2460.statics.resourceTiltStrings.push("In");
ad2460.statics.resourceTiltStrings.push("Hs + Nd");
ad2460.statics.resourceTiltStrings.push("Hs + Sr");
ad2460.statics.resourceTiltStrings.push("Hs + In");
ad2460.statics.resourceTiltStrings.push("Nd + Hs");
ad2460.statics.resourceTiltStrings.push("Nd + Sr");
ad2460.statics.resourceTiltStrings.push("Nd + In");
ad2460.statics.resourceTiltStrings.push("Sr + Hs");
ad2460.statics.resourceTiltStrings.push("Sr + Nd");
ad2460.statics.resourceTiltStrings.push("Sr + In");
ad2460.statics.resourceTiltStrings.push("In + Hs");
ad2460.statics.resourceTiltStrings.push("In + Nd");
ad2460.statics.resourceTiltStrings.push("In + Sr");
ad2460.statics.resourceTiltStrings.push("Even");
ad2460.statics.resourceTiltStrings.push("Even");
ad2460.statics.resourceTiltStrings.push("Even");
ad2460.statics.resourceTiltStrings.push("Even");
ad2460.statics.resourceTiltStrings.push("Hs");
ad2460.statics.resourceTiltStrings.push("Nd");
ad2460.statics.resourceTiltStrings.push("Sr");
ad2460.statics.resourceTiltStrings.push("In");  // type 34



ad2460.rankingLists=new Array;
if (typeof addRankingList == 'function') {
	addRankingList('score_rank','Score', 0, 'p', 'A purely score-based ranking');
	addRankingList('strength_rank','Strength', 0, 'p', 'A purely strength-based ranking');
	addRankingList('wins_rank','Wins', 0, 'p', 'A ranking-list based on the number of wins in combat where there was at least 5.000 strength on both sides.');
	addRankingList('wins_percent_rank','Greatest Win Percentage', 0, 'p', 'A ranking-list based on the ratio of victories.');
	addRankingList('tactical_victories_rank','Tactical Victories', 0, 'p', 'A tactical victory means destroying more strength than the opposition in any combat where there was at least 25.000 strength on both sides.');
	addRankingList('underdog_wins_rank','Underdog Wins', 0, 'p','An underdog win is a combat won when having less strength than 90% of the opposition when the combat started where there was at least 25.000 strength on both sides.');
	addRankingList('longest_win_streak_rank','Longest Win-Streak', 0, 'p', 'A ranking based on the highest number of consecutive wins players have had in combat. Only actual combats where shots are fired will add to your win-streak.');
	addRankingList('win_streak_rank','Current Win-Streak', 0, 'p', 'A ranking based on the number of consecutive wins players currently have in combat. Only actual combats where shots are fired will add to your win-streak, and both sides must bring at least 5.000 Strength to the combat.');
	addRankingList('killed_strength_rank','Killed Strength', 0, 'p', 'A ranking based on how much hostile strength a player has destroyed in combat.');
	addRankingList('wargames_won_rank','Wargames won', 0, 'p', 'A ranking based on how many wargames a player has won.');
	addRankingList('xp_rank','XP', 0, 'p', 'A purely xp-based ranking');
	addRankingList('bounty_claimed_rank','Bounty claimed', 0, 'p', 'A ranking based on how many credits a player has collected as bounty.');
	addRankingList('paid_2_win_rank','Sponsors (P2W)', 0, 'p', 'A ranking based on how many credits a player has spent on the pay-2-win button.');
	addRankingList('millions_resources_stolen_rank','Stolen Resources', 0, 'p', 'A ranking based on how much resources players have stolen, in millions.');
	addRankingList('wins_where_both_above_25k_rank','X-Small Wins', 0, 'p', 'A ranking-list based on the number of wins in combat where both sides have 25.000-100.000 strength at the start of combat.');
	addRankingList('wins_where_both_above_100k_rank','Small Wins', 0, 'p', 'A ranking-list based on the number of wins in combat where both sides have 100.000-250.000 strength at the start of combat.');
	addRankingList('wins_where_both_above_250k_rank','Large Wins', 0, 'p', 'A ranking-list based on the number of wins in combat where both sides have 250.000-500.000 strength at the start of combat.');
	addRankingList('wins_where_both_above_500k_rank','Huge Wins', 0, 'p', 'A ranking-list based on the number of wins in combat where both sides have 500.000 strength or more at the start of combat.');
	addRankingList('killed_ships_rank','Killed Ships', 0, 'p', 'A ranking-list based on the number of killed capital ships.');
	addRankingList('killed_commanders_rank','Killed Commanders', 0, 'p', 'A ranking-list based on the number of killed enemy comanders.');
	addRankingList('captured_outposts_rank','Captured outposts', 0, 'p', 'A ranking-list based on the number of captured outposts.');
	addRankingList('launched_attacks_rank','Launched Attacks', 0, 'p', 'A ranking based only on the number of launched attacks, regardless of the outcome.');
	addRankingList('incoming_attacks_rank','Incoming Attacks', 0, 'p', 'A ranking based only on the number of incoming attacks, regardless of the outcome.');

	addRankingList('losses_rank','Losses', 0, 'p', 'A ranking-list based on the number of losses in combat where there was at least 5.000 strength on both sides.');
	addRankingList('lost_strength_rank','Lost Strength', 0, 'p', 'A ranking based on how much hostile strength a player has lost in combat.');
	addRankingList('lost_commanders_rank','Lost Commanders', 0, 'p', 'A ranking-list based on the number of lost comanders. You probably do not want to be at the top of this list.');
	addRankingList('lost_ships_rank','Lost Ships', 0, 'p', 'A ranking-list based on the number of lost capital ships. You really do not want to top this ranking.');
	addRankingList('lost_outposts_rank','Lost outposts', 0, 'p', 'A ranking-list based on the number of lost outposts.');
	addRankingList('newest_players_rank','Latest players', 0, 'p', 'A list of the most recently joined players, a good place to recruit fresh blood!');

	addRankingList('alliance_score_rank','Alliance Score', 0, 'a', 'A ranking based on the total score of all members in an alliance.');
	addRankingList('alliance_avg_memeber_score_rank','Average Score', 0, 'a','A ranking for all alliances based on the average member-score.');
	addRankingList('alliance_strength_rank','Top Strength', 0, 'a', 'A ranking based on the total strength of all members in an alliance.');
	addRankingList('alliance_top_ten_avg_memeber_strength_rank','Top 10 AVG Strength', 0, 'a','A ranking for all alliances based on the average member-strength of the 10 strongest members.');
	addRankingList('alliance_avg_memeber_strength_rank','Average Strength', 0, 'a','A ranking for all alliances based on the average member-strength.');
	addRankingList('alliance_millions_resources_stolen_rank','Stolen Resources', 0, 'a', 'A ranking based on the total amount of captured resources by all members in an alliance, in millions.');
	addRankingList('alliance_tactical_victories_rank','Tactical Victories', 0, 'a', 'A ranking based on the total number of tactical victories by all members in an alliance. A tactical victory means destroying more strength than the opposition in any combat, regardless of the actual outcome.');
	addRankingList('alliance_killed_strength_rank','Killed Strength', 0, 'a', 'A ranking based on the total amount of strength killed by all members in an alliance.');
	addRankingList('alliance_wins_rank','Wins', 0, 'a', 'A ranking based on the total amount of wins by all members in an alliance.');
	addRankingList('alliance_longest_win_streak_rank','Longest Win Streak', 0, 'a', 'A ranking based on the longest allied win-streak for the alliance. Any loss by any member will break this streak, but any win by any member will increase it.');
	addRankingList('alliance_lost_strength_rank','Lost Strength', 0, 'a', 'A ranking based on the total amount of strength lost by all members in an alliance.');
	addRankingList('alliance_losses_rank','Losses', 0, 'a', 'A ranking based on the total amount of losses by all members in an alliance. Not much to brag about, really.');
	addRankingList('alliance_launched_attacks_rank','Launched Attacks', 0, 'a', 'A ranking based on the total amount of launched attacks by all members in an alliance.');
	addRankingList('alliance_op_attacks_rank','Outpost Attacks', 0, 'a','The total number of attacks launched against enemy outposts for the entire alliance.');
	addRankingList('alliance_hw_attacks_rank','Homeworld Attacks', 0, 'a','The total number of attacks launched against enemy homeworlds for the entire alliance.');
	addRankingList('alliance_incoming_attacks_rank','Incoming Attacks', 0, 'a', 'A ranking based on the total amount of incoming attacks at any and all members in an alliance.');
	addRankingList('alliance_bank_attack_wins_rank','Bank Attack Wins', 0, 'a', 'A bank attack win is a successfull robbing of an alliance-bank. Please note that an empty bank does NOT count as a valid robbery!');
	addRankingList('alliance_bank_attack_losses_rank','Bank Attack Losses', 0, 'a', 'A bank attack loss is a simply losing a combat when attacking an alliance-bank.');
	addRankingList('alliance_bank_defense_wins_rank','Bank Defense Wins', 0, 'a','A bank defense win is simply winning a combat when defending an alliance-bank.');
	addRankingList('alliance_bank_defense_losses_rank','Bank Defense Losses', 0, 'a','A bank defense loss is simply losing a combat when defending an alliance-bank. Please note that if the bank is empty, the loss will not count as a bank-defense-loss.');
	addRankingList('alliance_xp_rank','Top XP', 0, 'a', 'A ranking based on the total xp of all members in an alliance.');
	addRankingList('alliance_avg_memeber_xp_rank','Average XP', 0, 'a','A ranking for all alliances based on the average member-xp.');

}

ad2460.missionPacks=new Array;
ad2460.missionChoiceOptions=new Array;
ad2460.missionVars={};
ad2460.missionVars.selected_pack_id=0;
ad2460.missionVars.selected_mission_id=0;
ad2460.missionVars.active_mission_id=0;
ad2460.missionVars.selected_option_id=0;
ad2460.missionVars.selected_commander_id=0;
ad2460.missionVars.tactics=new tacticSetup(0, 'Total firepower', 'no', 'no', 'corvette defense', 'offense', 0, 'Capital ships', 'no', 'yes');
ad2460.missionVars.selected_fleets=new Array;

ad2460.missionVars.show_completed_packs=true;
ad2460.missionVars.show_cost_packs=true;
ad2460.missionVars.show_other_packs=true;

ad2460.missionVars.allocated_scouts=0;
ad2460.missionVars.allocated_prospectors=0;
ad2460.missionVars.allocated_spies=0;
ad2460.missionVars.allocated_infiltrators=0;

ad2460.missionVars.max_allocated_scouts=5;
ad2460.missionVars.max_allocated_prospectors=5;
ad2460.missionVars.max_allocated_spies=5;
ad2460.missionVars.max_allocated_infiltrators=3;

ad2460.payButtons={};
ad2460.payButtons.adyen=false;
ad2460.payButtons.paypal=false;

ad2460.targetSearch=new Array;

ad2460.prospectReport=new Array;

ad2460.stationImage=new Image;
ad2460.stationImage.src='images/homeworlds/starmap_planets/planet_60.png';
ad2460.stationImageInactive=new Image;
ad2460.stationImageInactive.src='images/homeworlds/starmap_planets/planet_60_inactive.png';

ad2460.stationImageBG=new Image;
ad2460.stationImageBG.src='images/homeworlds/starmap_planets/planet_60_bg.png';
ad2460.stationImageInactiveBG=new Image;
ad2460.stationImageInactiveBG.src='images/homeworlds/starmap_planets/planet_60_inactive_bg.png';

ad2460.bankImage=new Image;
ad2460.bankImage.src='images/icons/bank_icon.png';
// Copyright 2010-2018 Fifth Season AS
// Author: Christian "Spinner" Lassem
// If there is anytIHng (note the typo, fluffyRom!) here you wish to use, please contact me and ask permission. <firstname>.<lastname>@ad2460.com will do the trick.

var pathToAllianceLogos="images/uploads/alliancelogos/";

var secret_decryption_key="gu#//r0uupASkeiu";

var static_page=false;

var canvaswidth=400;
var canvasheight=400;

var mouseDown = false;

var currencies;

var testx=1;
var testy=1;

var ignoreTechtreeRenderUpdate=false;


// test
$(window).resize(function () {
	callWindowResize();
});
// test end

function callWindowResize(){
	var w=window.innerWidth-1;
	var h=window.innerHeight-1;

	// two globals used for combat-clicking
	testx=1;
	testy=1;

	// 1366 * 768 is the default size
	// aspect ratio 16:9
	// So we must find out which is the "smaller" value that determines the smallest size

	if (resizeGuiOnWindowResize!=true){
		return;
	}

	var scaleString='';
	var zoomString='';

	if (w/h > 16/9){
		// too much width, the height determines the size
		var wantedHeight=h;
		var wantedWidth=h/9*16;

		var scaleX=wantedWidth/1366;
		var scaleY=wantedHeight/768;

		scaleString=''+scaleX+','+scaleY;

		testx=scaleX;

		zoomString=scaleX*100+'%';
	}
	else {
		// too much height, the width determines the size
		var wantedWidth=w;
		var wantedHeight=w*9/16;

		var scaleX=wantedWidth/1366;
		var scaleY=wantedHeight/768;

		scaleString=''+scaleX+','+scaleY;
		zoomString=scaleY*100+'%';

		testy=scaleY;
	}

	if (ad2460.extendedGUI==true){
		if (w/h > 13.1/9){
			// too much width, the height determines the size
			var wantedHeight=h;
			var wantedWidth=h/9*13.1;

			var scaleX=wantedWidth/1366;
			var scaleY=wantedHeight/942;

			scaleString=''+scaleX+','+scaleY;

			zoomString=scaleX*100+'%';
			testx=scaleX;
		}
		else {
			// too much height, the width determines the size
			var wantedWidth=w;
			var wantedHeight=w*9/13.1;

			var scaleX=wantedWidth/1366;
			var scaleY=wantedHeight/942;

			scaleString=''+scaleX+','+scaleY;
			zoomString=scaleY*100+'%';
			testy=scaleY;
		}

	}


	$("#main_bg").css({'margin' : '0px'});
	$("#main_bg").css({'position' : 'absolute'});
	$("#main_bg").css({'transform-origin' : 'left top'});



	//if ((navigator.userAgent.toLowerCase().indexOf('firefox') > -1 && parseInt(navigator.userAgent.match(/([0-9]*)([0-9.]*)$/)[1]) < 52)  || (navigator.userAgent.toLowerCase().indexOf('mobile') > -1)) {
	if ((navigator.userAgent.toLowerCase().indexOf('firefox') > -1) || (navigator.userAgent.toLowerCase().indexOf('mobile') > -1)) {
		// $("#main_bg").css({'transform' : 'scale(' + scaleString +')'});
		// Doesn't work properly due to FF-bug with dropdowns
		// do nothing
	}
	else if (navigator.userAgent.toLowerCase().indexOf('macintosh') > -1){
		$("#main_bg").css({'transform' : 'scale(' + scaleString +')'});
	}
	else if (navigator.userAgent.toLowerCase().indexOf('edge') > -1){
		$("#main_bg").css({'transform' : 'scale(' + scaleString +')'});
	}
	else {
		$("#main_bg").css({'zoom' : zoomString});
	}
	scrollChatToBottom();
}


function level15please(){
	$.post('actionhandler.pl', {action:'level_15_please'}, function(data){ parseInfo(data);});
}

$(window).load(function(){

	document.body.onmousedown = function() {
		mouseDown = true;
	}
	document.body.onmouseup = function() {
		mouseDown = false;
	}

	blinkElementById('main_menu_cycle_timer');

	ad2460.starmap.solIsShown=false;

	ad2460.isVip=false;
	var secondsToExpire=ad2460.vip_status-ad2460.serverTime;
	var msToExpire=secondsToExpire*1000;

	if (ad2460.vip_status>ad2460.serverTime){
		ad2460.isVip=true;
		if (secondsToExpire<24*3600){
			setTimeout(function(){expireVip();} , msToExpire);
		}
	}

	if (ad2460.isVip==false){
		$("#vip_promotion").show();
		$("#no_vip_promotion").hide();
	}
	else {
		$("#vip_promotion").hide();
		$("#no_vip_promotion").show();

	}

	if (ad2460.vip_status>ad2460.serverTime){
		if (ad2460.vip_status<ad2460.serverTime+(48*3600)){
			// less than 2 days until VIP expiry
			alertUserToExpiringVip();

		}
	}


	currencies=$.getJSON("http://api.fixer.io/latest");


	if (document.getElementById('starmap_search_input_player'))	{
		document.getElementById('starmap_search_input_player').onkeypress=function(event){
			if (event.which==13 || event.keyCode==13) {
				searchUniverseClick('player');
				return false;
			}
		}
		document.getElementById('starmap_search_input_planet').onkeypress=function(event){
			if (event.which==13 || event.keyCode==13) {
				searchUniverseClick('planet');
				return false;
			}
		}
		document.getElementById('starmap_search_input_alliance').onkeypress=function(event){
			if (event.which==13 || event.keyCode==13) {
				searchUniverseClick('alliance');
				return false;
			}
		}

	}

	callWindowResize();

	$("#opt_cp1").keydown(function(e) {
		var code = e.keyCode || e.which;
		if (code == '9') {
			$("#opt_cp2").focus();
			return false;
		}
	});
	$("#opt_cp2").keydown(function(e) {
		var code = e.keyCode || e.which;
		if (code == '9') {
			$("#opt_cp3").focus();
			return false;
		}
	});


});

//setTimeout ( "notifyMe('test-notification 2 from AD2460!')", 10000 );

function setDevLogo(){
	// $("#logo").css("background-image","url(images/fixed/logo2dev.png)");
}

function resolveConnectionFail(){
	var a=new Date;
	var timestamp=Math.round(a.valueOf()/1000);

	var failObj={};
	failObj.failTime=timestamp;

	if (timestamp>ad2460.lastConnectionFail+10){
		showOkPopup("Connection to server failed. Please Check Your Network.","OK","");
		ad2460.lastConnectionFail=timestamp;
		ad2460.connectionFailures.push(failObj);
		if (ad2460.connectionFailures.length>3){
			// Check the last 3 and see if they are all within the last 5 minutes
			var obj=ad2460.connectionFailures[ad2460.connectionFailures.length-3];
			if (obj.failTime>timestamp-600){
				// Ok, shitty line...send him the frack out...
				//sendToFrontpage();
			}
		}
	}
}

// Extending the canvas to support dotted lines....
var CP = window.CanvasRenderingContext2D && CanvasRenderingContext2D.prototype;
if(CP && CP.lineTo) CP.dashedLine = function(x, y, x2, y2, dashArray){
    if(! dashArray) dashArray=[10,5];
    var dashCount = dashArray.length;
    var dx = (x2 - x);
    var dy = (y2 - y);
    var xSlope = (Math.abs(dx) > Math.abs(dy));
    var slope = (xSlope) ? dy / dx : dx / dy;

    this.moveTo(x, y);
    var distRemaining = Math.sqrt(dx * dx + dy * dy);
    var dashIndex = 0;
    while(distRemaining >= 0.1){
        var dashLength = Math.min(distRemaining, dashArray[dashIndex % dashCount]);
        var step = Math.sqrt(dashLength * dashLength / (1 + slope * slope));
        if(xSlope){
            if(dx < 0) step = -step;
            x += step
            y += slope * step;
        }else{
            if(dy < 0) step = -step;
            x += slope * step;
            y += step;
        }
        this[(dashIndex % 2 == 0) ? 'lineTo' : 'moveTo'](x, y);
        distRemaining -= dashLength;
        dashIndex++;
    }
}

function showClosedBox(closedTime, deleteTime, reason){
	// "No credits", "Forum Abuse", "Messages Abuse", "Upload Abuse", "Chat Abuse"
	for (var i=0;i<ad2460.openSlides.length ;i++ ){
		if (ad2460.openSlides[i]=='optionsslide'){
			return;
		}
	}

	if (ad2460.lastClosedShow<ad2460.serverTime-120){
		ad2460.lastClosedShow=ad2460.serverTime;
		var onclick="";
		if (reason=='No credits'){
			onclick="openOptionsSlide()";
		}

		var myString="Your account was closed : "+closedTime+"<br>"+"Your account will be deleted : "+deleteTime;
		myString +="<br>Reason: "+reason;
		myString +="<br>While closed, you can't do anything in the game.";


		if (reason == 'No credits'){
			myString +="<br>As you have simply ran out of credits, and been closed due to this, you can buy more under Preferences to re-open your account.";
		}
		else {
			myString +="<br>Please contact support@ad2460.com if you feel this an error, but do not waste our time if you know you have violated the rules and behaved inapproprietly.";
		}

		showOkPopup(myString, "I understand", onclick);
		$("#global_chat_container_table_body").html("<br><br>The chat is disabled for closed accounts.");
	}
}


function sendToFrontpage(){
	if (window.location.host=="live.ad2460.com"){
		window.location='http://www.ad2460.com';
	}
	else if (window.location.host=="dev.ad2460.com"){
		window.location='http://dev.ad2460.com';
	}
	else {
		window.location='http://'+window.location.host;
	}
}

function animateFeedback () {
	$(".adlogo").transition({opacity:0.2},300).delay(5000).transition({opacity:1},1000 );
	$(".servertime").transition({opacity:0.2},300).delay(5000).transition({opacity:1}, 1000 );
	//busy fadein //
	$("#systemtext").animate({opacity:0.2, top: "20px", left: "20px"}, 30).animate({opacity:0.3}, 40).animate({opacity:0.2, top: "12px", left: "5px"}, 30).animate({opacity:0.4, top: "50px", left: "12px"}, 40).animate({opacity:0.1, top: "-40px", left: "2px"}, 30).animate({opacity:0.5, top: "20px", left: "30px"}, 40).animate({opacity:0.1, top: "10px", left: "5px"}, 60).animate({opacity:1, top: "15px", left: "10px"}, 40).delay(5000).animate({opacity:1, top: "200px"}, 300);
}


function gameinfoTopicClick(topicId){
	// find the topic we clicked to fetch the name etc
	var heading='';
	for (i=0;i<topics.length;i++) {
		if (topics[i].topic_id==topicId) {
			heading=topics[i].topic;
		}
	}
	// find out which subtopics we have
	// render the subtopics
	var i=0;
	var html_string="<div id='subtopic_heading_div' class='subtopic_menu' style='display: block; opacity: 1; '>";
	html_string+="<div class='largeheading'>"+heading+"</div>";
	html_string+="<div class='headingseparator'></div>";

	for (i=0;i<subtopics.length;i++) {
		if (subtopics[i].topic_id==topicId) {
			html_string+="<div id='selecttopic_"+topicId+"_"+subtopics[i].subtopic_id+"' class='subtopic_button' onclick='subtopicClick(this.id);'>";
			html_string+="<div class='subheading'>"+subtopics[i].subtopic+"</div>";
			html_string+="</div>";
		}
	}
	html_string+="</div>";

	var fadeoutDuration=150;
	var delayDuration=175;
	var fadeinDuration=150;

	if ($("#subtopic_heading_div").is(':visible')){
		fadeoutDuration=150;
		delayDuration=175;
	}
	else {
		fadeoutDuration=15;
		delayDuration=25;
	}
	$("#gameinfocontainer_sidepanel .sidepanel_content").animate( { opacity: 0 }, {duration :fadeoutDuration, easing : easing, complete: function() { $(this).html(html_string).hide().show().delay(delayDuration).animate( { opacity: 1 }, {duration :150, easing : easing} );  }} );
	//$("#gameinfocontainer_sidepanel .sidepanel_content").show().delay(200).animate( { opacity: 1 }, {duration :150, easing : easing} );

}

function subtopicClick(bodyId) {
	var numbers = bodyId.split("_");
	var topic = numbers[1];
	var subtopic = numbers[2];
	var body;
	var found=false;
	var i=0;
	for (i=0;i<articles.length;i++){
		if (topic==articles[i].topic_id && subtopic==articles[i].subtopic_id){
			found=true;
			body=articles[i].body;
		}
	}
	if (found===true){
		var topicHeight = 0;
		viewHeight = parseInt($(".infopanel_topic").parent().css("height"),10);
		$(".infopanel_topic").animate( { opacity: 0 }, {duration: 200, complete: function() {
			$(".infopanel_topic").css( { top: "0px" } );
			$(this).html(body);
			topicHeight = parseInt($(".infopanel_topic").css("height"),10);
			scrollHeight = viewHeight;
			scrollSteps = Math.ceil(topicHeight/scrollHeight);
			if (scrollSteps > 1) {
				$(".infopanel_topic").css( {paddingRight: "15px"});
				showScrollButtons();
				scrollPage = 1;
				$(".subtopicPageNumber").html(scrollPage);
				topicHeight = parseInt($(".infopanel_topic").css("height"),10);
				scrollSteps = Math.ceil(topicHeight/scrollHeight);
				//$(this).html('');
				$(this).html(body);
				//$(".infopanel_topic").css( {paddingRight: "15px"});

			}
			else {
				$(".infopanel_topic").css( {paddingRight: "0px"});
				hideScrollButtons();
			}
		}
		});
		$(".infopanel_topic").animate( { opacity: 1 }, {duration :300} );
	}
}

function artmediaTopicClick(topicId){
	// find the topic we clicked to fetch the name etc
	var heading='';
	var subheading='';
	for (i=0;i<artmedia_topics.length;i++) {
		if (artmedia_topics[i].topic_id==topicId) {
			heading=artmedia_topics[i].topic;
			subheading=artmedia_topics[i].description;
		}
	}
	// find out which subartmedia_topics we have
	// render the subartmedia_topics
	var i=0;
	var infopanel_html_string="";
	var html_string="<div id='artmedia_subtopic_heading_div' class='subtopic_menu' style='display: block; opacity: 1; '>";
	html_string+="<div class='largeheading'>"+heading+"</div>";
	html_string+="<div class='headingseparator'></div>";
	html_string+="<div class='front_art_subtopic'>"+subheading+"</div>";
	html_string+="</div>";

	var x=0;
	for (x=0;x<artmedia_items.length;x++) {
		if (artmedia_items[x].topic_id==topicId) {
			var mainFolder='images';
			var thisSrc="images/frontart/"+urlEncode(heading)+"/"+artmedia_items[x].small_source;
			infopanel_html_string+="<img src='"+thisSrc+"' class='art_thumb' onclick='artmediaItemClick("+artmedia_items[x].artmedia_id+")' />";
		}
	}

	var fadeoutDuration=150;
	var delayDuration=175;
	var fadeinDuration=150;

	$("#artandmediacontainer_sidepanel .sidepanel_content").animate( { opacity: 0 }, {duration :fadeoutDuration, easing : easing, complete: function() { $(this).html(html_string).hide().show().delay(delayDuration).animate( { opacity: 1 }, {duration :150, easing : easing} );  }} );

	$("#artandmediacontainer_infopanel .artmedia_infopanel_topic").animate( { opacity: 0 }, {duration :fadeoutDuration, easing : easing, complete: function() { $(this).html(infopanel_html_string).hide().show().delay(delayDuration).animate( { opacity: 1 }, {duration :150, easing : easing} );  }} );
}

function centerViewer(){

}

function artmediaItemClick(itemId){
	var x=0;
	var found=false;
	for (x=0;x<artmedia_items.length;x++) {
		if (artmedia_items[x].artmedia_id==itemId){
			found=true;

			if (artmedia_items[x].type=='image'){
				var mainFolder='images';
				var thisSrc="images/frontart/"+urlEncode(artmedia_items[x].topic)+"/"+artmedia_items[x].large_source;
				$(".main_container").stop().animate( { opacity: 0 }, {duration :500, easing : easing} );

				$("#image_viewer_image").show();
				$("#image_viewer_video").hide();

				$("#please_wait_image").show();
				$("#image_viewer_image").attr("src",thisSrc);
				$("#picdisplace .imagecomment").html(artmedia_items[x].body);
				$('#image_viewer_image').load(function() {
					$("#please_wait_image").hide();
					showConcept();
				});
			}

			if (artmedia_items[x].type=='video'){
				var thisSrc="images/frontart/"+urlEncode(artmedia_items[x].topic)+"/"+artmedia_items[x].large_source;
				var thisSrc2=thisSrc;
				thisSrc2=thisSrc2.replace(".webm",".mp4");

				$("#image_viewer_image").hide();
				$("#image_viewer_video").show();

				$(".main_container").stop().animate( { opacity: 0 }, {duration :500, easing : easing} );
				//$("#please_wait_image").show();
				//$("#front_video_source1").attr("src",thisSrc);
				//$("#front_video_source2").attr("src",thisSrc2);
				var video=document.getElementById('image_viewer_video');
				var canPlayWebm=video.canPlayType('video/webm');
				var canPlayMp4=video.canPlayType('video/mp4');

				// DEBUG MP4
				//	$("#image_viewer_video").attr("src",thisSrc2);
				// DEBUG

				if (canPlayWebm!==""){
					$("#image_viewer_video").attr("src",thisSrc);
				}
				else {
					$("#image_viewer_video").attr("src",thisSrc2);
				}

				document.getElementById('image_viewer_video').load();
				$("#picdisplace .imagecomment").html(artmedia_items[x].body);
				showConcept();
				document.getElementById('image_viewer_video').play();
				/*
				$('#image_viewer_image').load(function() {
					$("#please_wait_image").hide();
					showConcept();
				});
				*/
			}
			// image_viewer_image | image_viewer_video
		}
	}
	if (found===true){
//		showConcept();
//		$(".main_container").stop().animate( { opacity: 0 }, {duration :500, easing : easing} );
	}
}

function gameinfoDirectBrowse(topicId,subtopicId){
	if ($("#gameinfocontainer_infopanel").is(":visible")){
		gameinfoTopicClick(topicId);
		subtopicClick('ehhh_'+topicId+'_'+subtopicId);
	}
	else {
		$("#gameinfocontainer_main_panel").click();
		gameinfoTopicClick(topicId);
		subtopicClick('ehhh_'+topicId+'_'+subtopicId);
	}
}

function artmediaDirectBrowse(topicId,itemId){
	if ($("#artandmediacontainer_infopanel").is(":visible")){
		artmediaTopicClick(topicId);
		setTimeout ( "artmediaItemClick("+itemId+")", 400 );
		//artmediaItemClick(itemId);
	}
	else {
		$("#artandmediacontainer_main_panel").click();
		artmediaTopicClick(topicId);
		setTimeout ( "artmediaItemClick("+itemId+")", 400 );
		//artmediaItemClick(itemId);
	}
}



function blinkStar(){
	if (ad2460.renderEffects.stars==false){
		return;
	}

	createStar('dynstar1');
	createStar('dynstar2');
	createStar('dynstar3');
	createStar('dynstar4');
	createStar('dynstar5');
	createStar('dynstar6');
	createStar('dynstar7');
	createStar('dynstar8');

	createStar('dynstar9');
	createStar('dynstar10');
	createStar('dynstar11');
	createStar('dynstar12');
	createStar('dynstar13');
	createStar('dynstar14');
	createStar('dynstar15');
	createStar('dynstar16');

	$("#dynstar1").animate({opacity: "1"}, 500).animate({opacity: "0"}, 500);

	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar2").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',500);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar3").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',1000);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar4").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',1500);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar5").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',2000);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar6").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',2500);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar7").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',3000);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar8").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',3500);

	$("#dynstar9").animate({opacity: "1"}, 500).animate({opacity: "0"}, 500);

	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar10").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',500);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar11").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',1000);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar12").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',1500);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar13").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',2000);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar14").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',2500);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar15").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',3000);
	setTimeout('ad2460.globalStarOpacity=0.6+Math.random()*0.4;$("#dynstar16").animate({opacity: ad2460.globalStarOpacity}, 1500).animate({opacity: "0"}, 1500)',3500);

	setTimeout('deleteStars()',6500);
}

function createBanana(){

	var banana=document.createElement('img');
	var id='banana'+Math.floor(Math.random()*1000000);
	banana.setAttribute('id',id);
	banana.style.position = "absolute";
	banana.style.left = 0+Math.floor(Math.random()*1350)+"px";
	banana.style.top = -200+Math.floor(Math.random()*190)+"px";
	banana.style.width = 32+'px';
	banana.style.height = 32+'px';
	banana.style.zIndex = 100;
	banana.src='images/emoticons/banana.png';

	var animate_to_left=returnInteger(banana.style.left)-300+Math.floor(Math.random()*600);
	var animate_to_top=1500;

	var animate_to_left_string=animate_to_left+'px';
	var animate_to_top_string=animate_to_top+'px';

	var anim_duration=5000+Math.floor(Math.random()*3000);

	document.getElementById('main_bg').appendChild(banana);

	$("#"+id).stop().animate( { top: animate_to_top_string,left: animate_to_left_string }, {duration :anim_duration, easing : "linear", complete: function() { $(this).remove();}} );

}

function createComet(){
	if (ad2460.renderEffects.comets==false){
		return;
	}

	var id='comet'+Math.floor(Math.random()*1000);
	var comet=document.createElement('img');
	comet.setAttribute('id',id);
	comet.style.position = "absolute";
	comet.style.left = 200+Math.floor(Math.random()*1750)+"px";
	comet.style.top = -50+"px";
	comet.style.width = 23+'px';
	comet.style.height = 37+'px';

	var type=1+Math.floor(Math.random()*3);
	comet.src='images/testing/spinnercomet'+type+'.png';

	if (type==3){
		comet.style.left = 2000+"px";
		comet.style.top = 35+Math.floor(Math.random()*600)+"px";
		comet.style.width = 36+'px';
		comet.style.height = 10+'px';
	}

	document.getElementById('bgstars').appendChild(comet);

	var animate_to_left=returnInteger(comet.style.left)-325;
	var animate_to_top=600;

	if (type==1){
		animate_to_left=returnInteger(comet.style.left)-325;
	}
	else if (type==2){
		animate_to_left=returnInteger(comet.style.left)+325;
	}
	else if (type==3){
		animate_to_left=-50;
		animate_to_top=returnInteger(comet.style.top);
	}

	var animate_to_left_string=animate_to_left+'px';
	var animate_to_top_string=animate_to_top+'px';

	var anim_duration=3000+Math.floor(Math.random()*3000);

	$("#"+id).stop().animate( { top: animate_to_top_string,left: animate_to_left_string }, {duration :anim_duration, easing : "linear", complete: function() { $(this).remove();}} );

}

function createBlink(){
	if (ad2460.renderEffects.stars==false){
		return;
	}
	var id='blink'+Math.floor(Math.random()*1000);
	var blink=document.createElement('img');
	blink.setAttribute('id',id);
	blink.style.position = "absolute";
	blink.style.left = 400+Math.floor(Math.random()*1750)+"px";
	blink.style.top = 10+Math.floor(Math.random()*600)+"px";
	blink.style.width = 25+'px';
	blink.style.height = 25+'px';
	blink.style.opacity = 0;

	var type=3+Math.floor(Math.random()*4);
	blink.src='images/testing/burst'+type+'.png';

	document.getElementById('bgstars').appendChild(blink);

	var anim_duration=2000+Math.floor(Math.random()*5000);
	//$("#"+id).stop().animate( { opacity: "0.7" }, {duration :anim_duration, easing : "linear", complete: function() { $(this).remove();}} );

	$("#"+id).stop().animate( { opacity: "0.9" }, {duration :anim_duration, easing : "linear"} ).animate( { opacity: "0" }, {duration :anim_duration, easing : "linear", complete: function() { $(this).remove();}} );
}

function createNebula(){
	if (ad2460.renderEffects.nebulas==false){
		return;
	}
	var id='nebula'+Math.floor(Math.random()*1000);
	var blink=document.createElement('img');
	blink.setAttribute('id',id);
	blink.style.position = "absolute";
	blink.style.left = 200+Math.floor(Math.random()*1750)+"px";
	blink.style.top = 10+Math.floor(Math.random()*600)+"px";
	blink.style.width = 200+'px';
	blink.style.height = 164+'px';
	blink.style.opacity = 0;

	var type=1+Math.floor(Math.random()*8);
	blink.src='images/testing/nebula'+type+'.png';

	document.getElementById('bgstars').appendChild(blink);

	var anim_duration=30000+1000*(Math.floor(Math.random()*20)); // 30 - 50 seconds fade in and 30-50 out....

	//$("#"+id).stop().animate( { opacity: "0.7" }, {duration :anim_duration, easing : "linear", complete: function() { $(this).remove();}} );

	$("#"+id).stop().animate( { opacity: "0.8" }, {duration :anim_duration, easing : "linear"} ).animate( { opacity: "0" }, {duration :anim_duration, easing : "linear", complete: function() { $(this).remove();}} );
}

function deleteStars(){
	$("#dynstar1").remove();
	$("#dynstar2").remove();
	$("#dynstar3").remove();
	$("#dynstar4").remove();
	$("#dynstar5").remove();
	$("#dynstar6").remove();
	$("#dynstar7").remove();
	$("#dynstar8").remove();
	$("#dynstar9").remove();
	$("#dynstar10").remove();
	$("#dynstar11").remove();
	$("#dynstar12").remove();
	$("#dynstar13").remove();
	$("#dynstar14").remove();
	$("#dynstar15").remove();
	$("#dynstar16").remove();
}

function createStar(id) {
	var newdiv = document.createElement('div');
	newdiv.setAttribute('id', id);
	newdiv.style.width = 1+'px';
	newdiv.style.height = 1+'px';
	newdiv.style.position = "absolute";
	newdiv.style.left = 200+Math.floor(Math.random()*1750)+"px";
	newdiv.style.top = 35+Math.floor(Math.random()*595)+"px";
	newdiv.style.background = "#FFFFFF";
	if (Math.random()*100<20){
		newdiv.style.background = "#FF0000";
	}
	else if (Math.random()*100<40){
		newdiv.style.background = "#00FFFF";
	}
	else if (Math.random()*100<60){
		newdiv.style.background = "#FF00FF";
	}
	newdiv.style.opacity = 0;

	document.getElementById('bgstars').appendChild(newdiv);
}

function systemFeedback(header, body, imageId, seconds){
	// create a div centered on the screen, animate it upwards and fadeout
	var ok_class_added='';
	if (imageId!=1)	{
		ok_class_added=' ok';
	}

	var generatedId='feedback'+Math.floor(Math.random()*999999);

	var containerDiv=createSingleElement('div', 'new_feedback_container'+ok_class_added, generatedId, '', 'removeFeedbackNew(this.id)');
	var img=createSingleElement('img','new_feedback_icon','', ad2460.systemImages[imageId],'');
	var headerDiv=createSingleElement('div', 'new_feedback_header', '', header, '');
	var bodyDiv=createSingleElement('div', 'new_feedback_body', '', body, '');

	containerDiv.appendChild(img);
	containerDiv.appendChild(headerDiv);
	containerDiv.appendChild(bodyDiv);

	document.getElementById('main_bg').appendChild(containerDiv);

	containerDiv.setAttribute('aria-live', 'polite');
	containerDiv.setAttribute('role', 'alert');


	var ms=3750;
	if (imageId!=1)	{
		// ms=700;
	}

	setTimeout("removeFeedbackNew('"+generatedId+"')",ms);
}

function removeFeedbackNew(id){
	$("#"+id).remove();
}

function systemFeedbackOld(header, body, imageId, seconds){
	// Seconds is now null and void, unused feature from earlier, but kept for backwards compatibility
	// There are two options here.
	if (imageId<0){
		imageId=0;
	}
	if (body==''){
		return;
	}

	if (seconds<5){
		seconds=5;
	}

	if (ad2460.feedbackBusy==true){
		// Put it in the queue!
		// But not if there is an identical one in the slot before it!
		if ($("#systemtext_body").html()==body && ad2460.feedbackBusy==true){
			return;
		}
		if (ad2460.feedbackQueue.length>0 ){
			if (ad2460.feedbackQueue[ad2460.feedbackQueue.length-1].body==body){
				return;
			}
		}
		// Ok, nothing in the queue, add it...
		ad2460.feedbackQueue.push(new feedbackQueueEntry(header, body, imageId));
	}
	else {
		// Show it immidiately!
		ad2460.feedbackBusy=true;
		setTimeout("ad2460.feedbackBusy=false",5000);
		showSystemFeedback(header, body, imageId);

	}
}

function showSystemFeedback(header,body,imageId){
	$("#systemtext_header").html(header);
	$("#systemtext_body").html(body);
	$("#systeminfo_image").attr('src',ad2460.systemImages[imageId]);
	animateFeedback();
}

function checkForQueuedFeedback(){
	if (ad2460.feedbackQueue.length>0){
		// if we're busy, do nothing
		// if we're not, show and delete entry.
		if (ad2460.feedbackBusy==false){
			var header=ad2460.feedbackQueue[0].header;
			var body=ad2460.feedbackQueue[0].body;
			var imageId=ad2460.feedbackQueue[0].imageId;
			ad2460.feedbackQueue.shift();
			systemFeedback(header, body, imageId, 3);
		}
	}
}

function returnUnit(id){
	// Look for the right unit-id in productionitems and return the object with the right id
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		thisUnit=ad2460.productionitems[i];
		if (thisUnit.id==id){
			return (thisUnit);
		}
	}
}



function updateResources(hassium, neodymium, strontium, indium){
	ad2460.resources.hassium=hassium;
	ad2460.resources.neodymium=neodymium;
	ad2460.resources.strontium=strontium;
	ad2460.resources.indium=indium;

	renderResources();
	reRenderOutpostUpgradeAmounts();

	if (ad2460.homeworldSelectedItems.development>0){
		reSelectDevelopmentItem();
	}
	if (ad2460.homeworldSelectedItems.production>0){
		reSelectProductionItem();
	}
	if (ad2460.homeworldSelectedItems.research>0){
		reSelectResearchItem();
	}
	if (ad2460.homeworldSelectedItems.facility_id>0){
		reSelectFacilityItem();
	}
}

function updateCredits(credits){
	ad2460.credits=credits;
	$("#energy").html(''+credits);
	if (ad2460.credits<1){
		$("#energy").addClass("notenough");
		$("#energy").fadeOut(300).fadeIn(300).fadeOut(300).fadeIn(300).fadeOut(300).fadeIn(300).fadeOut(300).fadeIn(300).fadeOut(300).fadeIn(300);
	}
	else {
		$("#energy").removeClass("notenough");
	}
}

function renderResources(){
	$("#hassium").html(prettyPrint(ad2460.resources.hassium));
	$("#indium").html(prettyPrint(ad2460.resources.indium));
	$("#neodymium").html(prettyPrint(ad2460.resources.neodymium));
	$("#strontium").html(prettyPrint(ad2460.resources.strontium));

	$("#active_trade_hs").hide();
	$("#active_trade_nd").hide();
	$("#active_trade_sr").hide();
	$("#active_trade_in").hide();

	var in_trade_hs=0;
	var in_trade_nd=0;
	var in_trade_sr=0;
	var in_trade_in=0;



	var i=0;
	if (ad2460.allianceData.trades){
		for (i=0;i<ad2460.allianceData.trades.length ;i++ ){
			if (ad2460.allianceData.trades[i].user_id==ad2460.user_id){
				if (ad2460.allianceData.trades[i].from_res_id==1){
					$("#active_trade_hs").show();
					in_trade_hs+=ad2460.allianceData.trades[i].amount;
				}
				if (ad2460.allianceData.trades[i].from_res_id==2){
					$("#active_trade_nd").show();
					in_trade_nd+=ad2460.allianceData.trades[i].amount;
				}
				if (ad2460.allianceData.trades[i].from_res_id==3){
					$("#active_trade_sr").show();
					in_trade_sr+=ad2460.allianceData.trades[i].amount;
				}
				if (ad2460.allianceData.trades[i].from_res_id==4){
					$("#active_trade_in").show();
					in_trade_in+=ad2460.allianceData.trades[i].amount;
				}
			}
		}
	}

	$("#hassium_trade_resource_storage").html(''+in_trade_hs);
	$("#indium_trade_resource_storage").html(''+in_trade_in);
	$("#strontium_trade_resource_storage").html(''+in_trade_sr);
	$("#neodymium_trade_resource_storage").html(''+in_trade_nd);

	calc_max_storage();
}




function getHullPercentage(thisShip){
	var percentage=0;
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==thisShip.ship_type_id){
			percentage=Math.floor(thisShip.hullstrength*100/ad2460.productionitems[i].hullstrength);
			return percentage;
		}
	}
}

function returnFirepower(ship_type_id){
	var firepower=0;
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==ship_type_id){
			firepower=	Math.floor(ad2460.productionitems[i].primary_weaponstrength*ad2460.productionitems[i].primary_guns*ad2460.productionitems[i].primary_rateoffire);
			firepower+=(Math.floor(ad2460.productionitems[i].secondary_weaponstrength*ad2460.productionitems[i].secondary_guns*ad2460.productionitems[i].secondary_rateoffire));
			firepower+=(Math.floor(ad2460.productionitems[i].tertiary_weaponstrength*ad2460.productionitems[i].tertiary_guns*ad2460.productionitems[i].tertiary_rateoffire));
			return firepower;
		}
	}
}

function returnShieldstrength(ship_type_id){
	var shieldstrength=0;
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==ship_type_id){
			shieldstrength=Math.floor(ad2460.productionitems[i].shieldstrength);
			return shieldstrength;
		}
	}
}

function returnHullstrength(ship_type_id){
	var hullstrength=0;
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==ship_type_id){
			hullstrength=Math.floor(ad2460.productionitems[i].hullstrength);
			return hullstrength;
		}
	}
}

function returnHangarCapacity(ship_type_id){
	var hangar_capacity=0;
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==ship_type_id){
			hangar_capacity=Math.floor(ad2460.productionitems[i].hangar_capacity);

			var s=returnGameObjectById(ship_type_id);
			if (s){
				if (s.ship_type_id==420){
					var o=returnGameObjectById(841);
					if (o){
						// hangar_capacity+=o.points;
					}
				}
				if (s.vesselclass=='Carrier'){
					var r=returnGameObjectById(137);
					if (r.user_id>0 && r.upgrading==0 && s.tech=='Matter'){
						hangar_capacity+=4;
					}
					var r=returnGameObjectById(118);
					if (r.user_id>0 && r.upgrading==0){
						hangar_capacity+=2;
					}
					var r=returnGameObjectById(125);
					if (r.user_id>0 && r.upgrading==0 && s.tech=='Matter'){
						hangar_capacity+=2;
					}
				}
			}


			return hangar_capacity;
		}
	}
}

function returnShiptypeCapacityPoint(ship_type_id){
	var capacity=0;
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==ship_type_id){
			if (ad2460.productionitems[i].vesselclass=='Fighter'){
				capacity=1;
			}
			else if(ad2460.productionitems[i].vesselclass=='Corvette'){
				capacity=2;
			}
			return capacity;
		}
	}

}

function returnUnitName(ship_type_id){
	var name='';
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==ship_type_id){
			name=ad2460.productionitems[i].name;
			return name;
		}
	}
}


function calculateDockedCapacityPoint(thisShip){
	var spentCapacity=0;
	spentCapacity+=thisShip.docked_401*returnShiptypeCapacityPoint(401);
	spentCapacity+=thisShip.docked_402*returnShiptypeCapacityPoint(402);
	spentCapacity+=thisShip.docked_403*returnShiptypeCapacityPoint(403);
	spentCapacity+=thisShip.docked_404*returnShiptypeCapacityPoint(404);
	spentCapacity+=thisShip.docked_405*returnShiptypeCapacityPoint(405);
	spentCapacity+=thisShip.docked_406*returnShiptypeCapacityPoint(406);
	spentCapacity+=thisShip.docked_407*returnShiptypeCapacityPoint(407);
	spentCapacity+=thisShip.docked_408*returnShiptypeCapacityPoint(408);
	spentCapacity+=thisShip.docked_409*returnShiptypeCapacityPoint(409);
	spentCapacity+=thisShip.docked_410*returnShiptypeCapacityPoint(410);

	return spentCapacity;
}


function quickbuyClick(ship_type_id){
//	console.log("Resupply all clicked for ship_type_id "+ship_type_id);
	initiateProductionClick(ship_type_id);
	event.stopPropagation();
	return false;
}

function returnTechTilt(thisFleet,returnAll){
	var matterCount=0;
	var energyCount=0;
	var displacementCount=0;


	var techtilt='Neutral';

	var i=0;
	for (i=0;i<thisFleet.ships.length ;i++ ){
		var id=thisFleet.ships[i].ship_type_id;
		if (id==411 || id==414 || id==417 || id==420 || id==423 || id==424 || id==437  ){
			matterCount++;
		}
		else if (id==412 || id==415 || id==418 || id==421 || id==425 || id==426 || id==427  ){
			energyCount++;
		}
		else if (id==413 || id==416 || id==419 || id==422 || id==428 || id==429  ){
			displacementCount++;
		}
	}

	if (matterCount>energyCount && matterCount>displacementCount){
		techtilt='InTech';
	}
	else if (energyCount>matterCount && energyCount>displacementCount){
		techtilt='Strontech';
	}
	else if (displacementCount>energyCount && displacementCount>matterCount){
		techtilt='NeoTech';
	}
	else {
		techtilt='Neutral';
	}

	if (returnAll==true){
		var returnObj={};
		returnObj.matterCount=matterCount;
		returnObj.energyCount=energyCount;
		returnObj.displacementCount=displacementCount;
		return returnObj;
	}
	else {
		return techtilt;
	}

}

// SCORES

function updateScores(scoreObj){
	ad2460.scores=scoreObj;
	if (ad2460.levelBoxOpen!=true && ad2460.techpointsBoxOpen!=true){
		checkForLevelUp();
	}
	renderScores();
	if (ad2460.scores.level>6){
		$("#buildtreebutton").css('box-shadow', 'none');
		$("#buildtreebutton").css('background-color', 'grey');
	}

	renderGeneralWargameStats();
	checkUnclaimedTechPoints('scores_loaded',0);
}



function checkForLevelUp(){
	try{
		if (ad2460.scores.xp>=ad2460.playerXpLevels[ad2460.scores.level]){
			// DING!
			$.post('actionhandler.pl', {action:'check_level_up'}, function(data){ parseInfo(data);});
		}
	}
	catch(error){
		console.log(error);
	}
}

function updateScoresOld(score, strength, level, xp){
	ad2460.scores.score=score;
	ad2460.scores.strength=strength;
	ad2460.scores.level=level;
	ad2460.scores.xp=xp;

	renderScores();
	renderRankings();
}

function renderScores(){
	$("#homeworld_user_score").html(prettyPrint(ad2460.scores.score));
	$("#homeworld_user_strength").html(prettyPrint(ad2460.scores.strength));
	$("#homeworld_planet_advancement_level").html(prettyPrint(ad2460.scores.level));
	$("#homeworld_user_xp").html(prettyPrint(ad2460.scores.xp)+' / '+prettyPrint(ad2460.playerXpLevels[ad2460.scores.level]));
	$("#homeworld_user_score_rank").html('(# '+prettyPrint(ad2460.scores.score_rank)+')');
	$("#homeworld_user_xp_rank").html('(# '+prettyPrint(ad2460.scores.xp_rank)+')');
	$("#homeworld_user_strength_rank").html('(# '+prettyPrint(ad2460.scores.strength_rank)+')');
	$("#homeworld_planet_unused").html(prettyPrint(ad2460.scores.current_outlook));


}
// END SCORES


function renderRankings(){
	$("#homeworld_planet_rank").html('# '+prettyPrint(ad2460.scores.score_rank));
	$("#homeworld_planet_strength_rank").html('# '+prettyPrint(ad2460.rankings.strength));
}

function clearInput(id){
	$("#"+id).attr("value","");
}



function hideConfirmationPopup(){
	$("#confirmation_popup").hide();
	document.getElementById('conf_ok_button').onclick=null;
	document.getElementById('conf_cancel_button').onclick=null;
	ad2460.confirmationBoxOpen=false;
}

function showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick, specialAttackedFlag, specialWargameAcceptedFlag, specialBankAttackFlag, specialStationAttackFlag){
	$("#conf_main_text").html(mainText);
	$("#conf_ok_button_text").html(okText);
	$("#conf_cancel_button_text").html(cancelText);
	document.getElementById('conf_ok_button').onclick=function(){eval(okClick);};
	document.getElementById('conf_cancel_button').onclick=function(){eval(cancelClick);hideConfirmationPopup();};
	$("#confirmation_popup .confirmation_box").removeClass("attacked");
	$("#confirmation_popup .confirmation_box").removeClass("challenge_accepted");
	$("#confirmation_popup .confirmation_box").removeClass("bank");
	$("#confirmation_popup .confirmation_box").removeClass("station");


	if (specialAttackedFlag==true){
		$("#confirmation_popup .confirmation_box").addClass("attacked");
	}
	if (specialWargameAcceptedFlag==true){
		// special edition
		$("#confirmation_popup .confirmation_box").addClass("challenge_accepted");
	}

	if (specialBankAttackFlag==true){
		// special edition
		$("#confirmation_popup .confirmation_box").addClass("bank");
	}
	if (specialStationAttackFlag==true){
		// special edition
		$("#confirmation_popup .confirmation_box").addClass("station");
	}


	$("#confirmation_popup").show();
	ad2460.confirmationBoxOpen=true;
}

function toggleTickerPanel(){
	if (ad2460.galaxynewsVisible==true){
		hideTickerPanel();
		ad2460.galaxynewsVisible=false;
	}
	else {
		showTickerPanel();
		ad2460.galaxynewsVisible=true;
		if (ad2460.fullnewsVisible==true){
			toggleFullNews();
		}
	}

}

function returnBaseFleet(){
	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].homeworld_fleet==1){
			return ad2460.myFleets[i];
		}
	}
	return false;
}

function handleEscapePress(){
	if (document.getElementById('blind_status_window') ){
		hideBlindStatus();
		return;
	}
	if ( $("#simple_popup").is(':visible')  ){
		hideSimpleBox();
		return;
	}
	if ( $("#starmap_espionage_slidepanel").is(':visible')  ){
		hideEspionageOption();
		return;
	}



	if ( $("#help_commander").is(':visible')  ){
		clearInterval(ladyHelperInterval);
		ladyHelperInterval=null;
		hideHelpCommander();
		hideConfirmationPopup();
		denyLadyHelp=true;
		setTimeout(function(){
			ladyHelperInterval=setInterval(function(){ denyLadyHelp=false;ladyHelperMain(); }, 1000*20);
		},20000);
		return;
	}

	if (acceptClick==false){
		return;
	}

	if (ad2460.confirmationBoxOpen){
		hideConfirmationPopup();
		return;
	}

	if (ad2460.fullnewsVisible==true){
		toggleFullNews();
		return;
	}


	// Lets try this, a general escape-button handler, listening on the body element...
	var counter=0;
	for (i=0;i<ad2460.openSlides.length ;i++ ){
		closeSlide(ad2460.openSlides[i]);
		counter++;
	}
	if (counter>0){
		return;
	}

	if (ad2460.openQuickMenues.selected_fleet_reassign){
		fleetAssignPanelDown();
		return;
	}
	if (ad2460.openQuickMenues.all_ships){
		shipListDown();
		return;
	}

	if (ad2460.openQuickMenues.selected_fleet_resupply){
		fleetResupplyPanelDown();
		return;
	}
	if (ad2460.openQuickMenues.selected_fleet_configuration){
		// Unused after design-spec
		return;
	}
	if (ad2460.openQuickMenues.selected_fleet_tactics){
		tacticsMenuDown();
		return;
	}
	if (ad2460.openQuickMenues.outpost_transport_panel){
		transportOptionsMenuDown();
		return;
	}

	// If we're still going, lets close the panels too
	var i=0;

	var counter=0;
	for (i=0;i<ad2460.openPanels.length ;i++ ){
		//		$("#"+ad2460.openPanels[i]).click();
		$("#"+ad2460.openPanels[i]+" .main_panel").click();
		counter++;
	}
	if (counter>0){
		return;
	}
}

function returnFleetFirepower(fleet){
	var i=0;
	var firepower=0;

	for (i=0;i<fleet.ships.length ;i++ ){
		firepower+=returnFirepower(fleet.ships[i].ship_type_id);
	}
	return firepower;
}

function returnFleetHullstrength(fleet){
	var i=0;
	var hull=0;

	for (i=0;i<fleet.ships.length ;i++ ){
		hull+=returnHullstrength(fleet.ships[i].ship_type_id);
	}
	return hull;
}




$(document).ready(function() {
	$("#help_overlay").click(function(){
		$("#help_overlay").fadeOut(100);
		$(".localhelp").delay(250).fadeOut(100).fadeIn(100);
	});

	$("#playerinfo_popup").draggable({ handle:"#player_info_nickname", containment: "#main_bg", scroll: false });
	$("#allianceinfo_popup").draggable({ handle:"#alliance_info_name", containment: "#main_bg", scroll: false });

	$("#simple_popup").draggable({ handle:"#simple_header_text", containment: "#main_bg", scroll: false });
	$("#simple_header_text").css("cursor","move");

	$("#simple_popup_2").draggable({ handle:"#simple_header_text_2", containment: "#body", scroll: false });
	$("#simple_header_text_2").css("cursor","move");

	$("#large_popup").draggable({ handle:"#large_header_text", containment: "#main_bg", scroll: false });
	$("#large_header_text").css("cursor","move");

	$("#nemesis_popup").draggable({ handle:"#nemesis_header_text", containment: "#main_bg", scroll: false });
	$("#nemesis_header_text").css("cursor","move");


	$("#game_object_info_box_container").draggable({ handle: "#g_o_name_container",containment: "#main_bg", scroll: false });
	$("#single_infiltration_report").draggable({handle:"#intel_report_type_location",containment: "#main_bg", scroll: false });
	$("#g_o_name_container").css("cursor","move");

	$("#help_overlay_on").click(function(){
		renderHelpOverlay();
	});

	(function(a,b){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))ad2460.mobilebrowser=true;})(navigator.userAgent||navigator.vendor||window.opera,true);




});


function clearTechTree(){
	$("#techtreeslide .techitem").remove();
	$("#techtreeslide .tech_line_separate").remove();

	ad2460.techVariables.selectedTechItemId=0;
	ad2460.techVariables.previousSelectedTechItemId=0;
	ad2460.techVariables.previousSelectedTechItemBranch='';
	ad2460.techVariables.selectedTechItemBranch='';
	ad2460.techVariables.bonusPanelOpen = false;
}

function clearTechTreeNew(){
	$("#techtreeslide .techitem").remove();
	$("#techtreeslide .tech_line_separate").remove();
	$("#auto_button_intech").remove();
	$("#auto_button_strontech").remove();
	$("#auto_button_neotech").remove();

	//ad2460.techVariables.selectedTechItemId=0;
	//ad2460.techVariables.previousSelectedTechItemId=0;
	//ad2460.techVariables.previousSelectedTechItemBranch='';
	//ad2460.techVariables.selectedTechItemBranch='';
	//ad2460.techVariables.bonusPanelOpen = false;
}


function renderTechTreeNew(){
	//console.log("new ran");
	// First we need to clear all of them.
	clearTechTreeNew();
	$("#current_available_techpoints").html(ad2460.techpoints-ad2460.uncomittedTechPoints);
	var last_rendered_tier=1;
	var last_rendered_tech='Matter';

	ad2460.techVariables.spentTechPointsMatter=0;
	ad2460.techVariables.spentTechPointsEnergy=0;
	ad2460.techVariables.spentTechPointsDisplacement=0;


	var pts_needed_to_unlock_next_matter_tier=1000;
	var pts_needed_to_unlock_next_energy_tier=1000;
	var pts_needed_to_unlock_next_displacement_tier=1000;


	//matter_tech_point_needed_to_unlock
	//energy_tech_point_needed_to_unlock
	//displacement_tech_point_needed_to_unlock


	// Now let's collect some data on how much we spent in which tree, which we need before rendering
	var i=0;
	for (i=0;i<ad2460.techitems.length ;i++ ){
		var thisItem=ad2460.techitems[i];
		if (thisItem.branch=='Matter'){
			ad2460.techVariables.spentTechPointsMatter+=thisItem.points+thisItem.temp_points;
		}
		else if (thisItem.branch=='Energy'){
			ad2460.techVariables.spentTechPointsEnergy+=thisItem.points+thisItem.temp_points;
		}
		else if (thisItem.branch=='Matter'){
			ad2460.techVariables.spentTechPointsDisplacement+=thisItem.points+thisItem.temp_points;
		}
	}

	for (i=0;i<ad2460.techitems.length ;i++ ){
		var thisItem=ad2460.techitems[i];
		if (thisItem.branch=='Matter'){
			if (ad2460.techVariables.spentTechPointsMatter<thisItem.required_spent_points_in_branch && (thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsMatter)<pts_needed_to_unlock_next_matter_tier ){
				pts_needed_to_unlock_next_matter_tier=thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsMatter;
			}
		}
		if (thisItem.branch=='Energy'){
			if (ad2460.techVariables.spentTechPointsEnergy<thisItem.required_spent_points_in_branch && (thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsEnergy)<pts_needed_to_unlock_next_energy_tier ){
				pts_needed_to_unlock_next_energy_tier=thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsEnergy;
			}
		}
		if (thisItem.branch=='Displacement'){
			if (ad2460.techVariables.spentTechPointsDisplacement<thisItem.required_spent_points_in_branch && (thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsDisplacement)<pts_needed_to_unlock_next_displacement_tier ){
				pts_needed_to_unlock_next_displacement_tier=thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsDisplacement;
			}
		}
	}

	$("#matter_tech_point_needed_to_unlock").html(pts_needed_to_unlock_next_matter_tier);
	$("#energy_tech_point_needed_to_unlock").html(pts_needed_to_unlock_next_energy_tier);
	$("#displacement_tech_point_needed_to_unlock").html(pts_needed_to_unlock_next_displacement_tier);

	$("#matter_tech_point_needed_to_unlock_text").html('points needed to unlock new tier');
	$("#energy_tech_point_needed_to_unlock_text").html('points needed to unlock new tier');
	$("#displacement_tech_point_needed_to_unlock_text").html('points needed to unlock new tier');



	// Now we should be able to render all of these, knowing their parent by their branch and whether or not enough points have been spent to enable them
	var i=0;
	for (i=0;i<ad2460.techitems.length ;i++ ){
		var thisItem=ad2460.techitems[i];
		var parentId='available_matter_techs';

		console.log(thisItem);

		if (thisItem.branch=='Matter'){
			parentId='available_matter_techs';
			if (ad2460.techVariables.spentTechPointsMatter<thisItem.required_spent_points_in_branch){
				parentId='unavailable_matter_techs';
			}
		}
		if (thisItem.branch=='Energy'){
			parentId='available_energy_techs';
			if (ad2460.techVariables.spentTechPointsEnergy<thisItem.required_spent_points_in_branch){
				parentId='unavailable_energy_techs';
			}
		}
		if (thisItem.branch=='Displacement'){
			parentId='available_displacement_techs';
			if (ad2460.techVariables.spentTechPointsDisplacement<thisItem.required_spent_points_in_branch){
				parentId='unavailable_displacement_techs';
			}
		}

		//console.log("Parent ID is "+parentId);

		var parent=document.getElementById(parentId);
		if (!parent){
			console.log("Error: No parent found in techtreeslide for techitem" + thisItem);
		}

		// Now we need to check if this tier is higher than the one previously rendered, or if we have changed branch....
		if (thisItem.branch!=last_rendered_tech){
			last_rendered_tier=1;
			last_rendered_tech=thisItem.branch;
		}
		else if (thisItem.tier!=last_rendered_tier){
			// Uh oh, we need to put in place a tier-splitter-element before proceeding
			var sepdiv=document.createElement("div");
			sepdiv.setAttribute('class','tech_line_separate');
			parent.appendChild(sepdiv);
		}

		last_rendered_tier=thisItem.tier;

		// Ok, we should be ok to render the element now
		//<div class='techitem' id='m01'>
		//	<img src='images/icons/research/101.jpg' />
		//	<div class='techitem_level'>3</div>
		//</div>

		var itemContainer=document.createElement("div");
		itemContainer.setAttribute('class','techitem');
		itemContainer.setAttribute('id',''+thisItem.id);
		itemContainer.setAttribute("onclick","techItemClick("+thisItem.id+",false,event)");


		var itemImg=document.createElement("img");
		itemImg.setAttribute('src','images/icons/techtree/'+thisItem.id+'.jpg');
		itemImg.setAttribute('alt',thisItem.name);

		var levelDiv=document.createElement("div");
		levelDiv.setAttribute('class','techitem_level');
		levelDiv.setAttribute('id','techitem_level_'+thisItem.id);
		levelDiv.innerHTML=''+thisItem.points;

		itemContainer.appendChild(itemImg);
		itemContainer.appendChild(levelDiv);
		parent.appendChild(itemContainer);
	}
}

function tempCountTechPoints(){
	var matterPoints=0;
	var energyPoints=0;
	var displacementPoints=0;
	var matterPointsTemp=0;
	var energyPointsTemp=0;
	var displacementPointsTemp=0;

	var i=0;
	for (i=0;i<ad2460.techitems.length ;i++ ){
		var item=ad2460.techitems[i];
		if (item.branch=='Matter'){
			matterPoints+=item.points;
			matterPointsTemp+=item.temp_points;
		}
		if (item.branch=='Energy'){
			energyPoints+=item.points;
			energyPointsTemp+=item.temp_points;
		}
		if (item.branch=='Displacement'){
			displacementPoints+=item.points;
			displacementPointsTemp+=item.temp_points;
		}
	}

	if (matterPointsTemp>0 && ( matterPoints+matterPointsTemp==10 || matterPoints+matterPointsTemp==20 || matterPoints+matterPointsTemp==30 || matterPoints+matterPointsTemp==40 || matterPoints+matterPointsTemp==50  )){
		// We are exactly at a barrier
		$("#matter_tech_point_needed_to_unlock").html('');
		$("#matter_tech_point_needed_to_unlock_text").html('Commit now to open new tier.');


	}
	if (energyPointsTemp>0 && ( energyPoints+energyPointsTemp==10 || energyPoints+energyPointsTemp==20 || energyPoints+energyPointsTemp==30 || energyPoints+energyPointsTemp==40 || energyPoints+energyPointsTemp==50  )){
		// We are exactly at a barrier
		$("#energy_tech_point_needed_to_unlock").html('');
		$("#energy_tech_point_needed_to_unlock_text").html('Commit now to open new tier.');

	}
	if (displacementPointsTemp>0 && ( displacementPoints+displacementPointsTemp==10 || displacementPoints+displacementPointsTemp==20 || displacementPoints+displacementPointsTemp==30 || displacementPoints+displacementPointsTemp==40 || displacementPoints+displacementPointsTemp==50  )){
		// We are exactly at a barrier
		$("#displacement_tech_point_needed_to_unlock").html('');
		$("#displacement_tech_point_needed_to_unlock_text").html('Commit now to open new tier.');

	}

}

function renderTechTree(){
	// First we need to clear all of them.
	//console.log("I ran");
	clearTechTree();
	$("#current_available_techpoints").html(ad2460.techpoints);
	var last_rendered_tier=1;
	var last_rendered_tech='Matter';

	ad2460.techVariables.spentTechPointsMatter=0;
	ad2460.techVariables.spentTechPointsEnergy=0;
	ad2460.techVariables.spentTechPointsDisplacement=0;


	var pts_needed_to_unlock_next_matter_tier=1000;
	var pts_needed_to_unlock_next_energy_tier=1000;
	var pts_needed_to_unlock_next_displacement_tier=1000;


	//matter_tech_point_needed_to_unlock
	//energy_tech_point_needed_to_unlock
	//displacement_tech_point_needed_to_unlock


	// Now let's collect some data on how much we spent in which tree, which we need before rendering
	var i=0;
	for (i=0;i<ad2460.techitems.length ;i++ ){
		var thisItem=ad2460.techitems[i];
		if (thisItem.branch=='Matter'){
			ad2460.techVariables.spentTechPointsMatter+=thisItem.points;
		}
		else if (thisItem.branch=='Energy'){
			ad2460.techVariables.spentTechPointsEnergy+=thisItem.points;
		}
		else if (thisItem.branch=='Matter'){
			ad2460.techVariables.spentTechPointsDisplacement+=thisItem.points;
		}
	}

	for (i=0;i<ad2460.techitems.length ;i++ ){
		var thisItem=ad2460.techitems[i];
		if (thisItem.branch=='Matter'){
			if (ad2460.techVariables.spentTechPointsMatter<thisItem.required_spent_points_in_branch && (thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsMatter)<pts_needed_to_unlock_next_matter_tier ){
				pts_needed_to_unlock_next_matter_tier=thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsMatter;
			}
		}
		if (thisItem.branch=='Energy'){
			if (ad2460.techVariables.spentTechPointsEnergy<thisItem.required_spent_points_in_branch && (thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsEnergy)<pts_needed_to_unlock_next_energy_tier ){
				pts_needed_to_unlock_next_energy_tier=thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsEnergy;
			}
		}
		if (thisItem.branch=='Displacement'){
			if (ad2460.techVariables.spentTechPointsDisplacement<thisItem.required_spent_points_in_branch && (thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsDisplacement)<pts_needed_to_unlock_next_displacement_tier ){
				pts_needed_to_unlock_next_displacement_tier=thisItem.required_spent_points_in_branch-ad2460.techVariables.spentTechPointsDisplacement;
			}
		}
	}

	$("#matter_tech_point_needed_to_unlock").html(pts_needed_to_unlock_next_matter_tier);
	$("#energy_tech_point_needed_to_unlock").html(pts_needed_to_unlock_next_energy_tier);
	$("#displacement_tech_point_needed_to_unlock").html(pts_needed_to_unlock_next_displacement_tier);

	$("#matter_tech_point_needed_to_unlock_text").html('points needed to unlock new tier');
	$("#energy_tech_point_needed_to_unlock_text").html('points needed to unlock new tier');
	$("#displacement_tech_point_needed_to_unlock_text").html('points needed to unlock new tier');



	// Now we should be able to render all of these, knowing their parent by their branch and whether or not enough points have been spent to enable them
	var i=0;
	for (i=0;i<ad2460.techitems.length ;i++ ){
		var thisItem=ad2460.techitems[i];
		var parentId='available_matter_techs';

		if (thisItem.branch=='Matter'){
			parentId='available_matter_techs';
			if (ad2460.techVariables.spentTechPointsMatter<thisItem.required_spent_points_in_branch){
				parentId='unavailable_matter_techs';
			}
		}
		if (thisItem.branch=='Energy'){
			parentId='available_energy_techs';
			if (ad2460.techVariables.spentTechPointsEnergy<thisItem.required_spent_points_in_branch){
				parentId='unavailable_energy_techs';
			}
		}
		if (thisItem.branch=='Displacement'){
			parentId='available_displacement_techs';
			if (ad2460.techVariables.spentTechPointsDisplacement<thisItem.required_spent_points_in_branch){
				parentId='unavailable_displacement_techs';
			}
		}

		//console.log("Parent ID is "+parentId);

		var parent=document.getElementById(parentId);
		if (!parent){
			console.log("Error: No parent found in techtreeslide for techitem" + thisItem);
		}

		// Now we need to check if this tier is higher than the one previously rendered, or if we have changed branch....
		if (thisItem.branch!=last_rendered_tech){
			last_rendered_tier=1;
			last_rendered_tech=thisItem.branch;
		}
		else if (thisItem.tier!=last_rendered_tier){
			// Uh oh, we need to put in place a tier-splitter-element before proceeding
			var sepdiv=document.createElement("div");
			sepdiv.setAttribute('class','tech_line_separate');
			parent.appendChild(sepdiv);
		}

		last_rendered_tier=thisItem.tier;

		// Ok, we should be ok to render the element now
		//<div class='techitem' id='m01'>
		//	<img src='images/icons/research/101.jpg' />
		//	<div class='techitem_level'>3</div>
		//</div>

		var itemContainer=document.createElement("div");
		itemContainer.setAttribute('class','techitem');
		itemContainer.setAttribute('id',''+thisItem.id);
		itemContainer.setAttribute("onclick","techItemClick("+thisItem.id+",false,event)");


		var itemImg=document.createElement("img");
		itemImg.setAttribute('src','images/icons/techtree/'+thisItem.id+'.jpg');

		var levelDiv=document.createElement("div");
		levelDiv.setAttribute('class','techitem_level');
		levelDiv.setAttribute('id','techitem_level_'+thisItem.id);
		levelDiv.innerHTML=''+thisItem.points;

		itemContainer.appendChild(itemImg);
		itemContainer.appendChild(levelDiv);
		parent.appendChild(itemContainer);
	}
}

function returnTechItemById(id){
	var i=0;
	for (i=0;i<ad2460.techitems.length ;i++ ){
		if (ad2460.techitems[i].id==id){
			return ad2460.techitems[i];
		}
	}
	return false;
}

function techItemClick(id, skipPanel, event){
	if (event) {
		if (event.shiftKey==true) {
			handleShiftClickObjectWithId(id);
			return;
		}

	}
	var item=returnTechItemById(id);
	if (!item){
		console.log("ERROR: TECHITEM with id "+id+" not found.");
	}

	ad2460.techVariables.previousSelectedTechItemId=ad2460.techVariables.selectedTechItemId;
	ad2460.techVariables.selectedTechItemId=id;

	ad2460.techVariables.previousSelectedTechItemBranch=ad2460.techVariables.selectedTechItemBranch;
	ad2460.techVariables.selectedTechItemBranch=item.branch;

	// Lets find out if the buttons should be visible or not
	var thisTier=item.tier;
	var thisBranch=item.branch;
	var tierData=returnTierDataByBranchTier(item.branch,item.tier);
	if (tierData.open==true){
		$("#techtreePlusButton").css('visibility', 'visible');
		$("#techtreeMinusButton").css('visibility', 'visible');
	}
	else {
		$("#techtreePlusButton").css('visibility', 'hidden');
		$("#techtreeMinusButton").css('visibility', 'hidden');
	}

	var panePos=0;

	if (ad2460.techVariables.previousSelectedTechItemId == ad2460.techVariables.selectedTechItemId && ad2460.techVariables.bonusPanelOpen == true) {
		// If the bonus-panel is already open, and you click the same techitem as the previous click, close it!
		closeTechtreeBonusPanel();
	}
	else {
		// We will open it!
		if(ad2460.techVariables.selectedTechItemBranch == 'Matter')			{ panePos = 350; }
		if(ad2460.techVariables.selectedTechItemBranch == 'Energy')			{ panePos = 670; }
		if(ad2460.techVariables.selectedTechItemBranch == 'Displacement')	{ panePos = 318; }

		// Set the right data in the point-fields
		$("#bonus_allocated").html(item.points+item.temp_points);
		$("#bonus_total").html(''+item.max_points);

		if (skipPanel==true){
			return;
		}

		if(ad2460.techVariables.selectedTechItemBranch == ad2460.techVariables.previousSelectedTechItemBranch) {
			$("#bonuspane_text_content").css({opacity: 0}).html(item.description);
			$("#bonuspane_title_content").html(item.name);
			var paneHeight = $("#bonuspane_entry").outerHeight();
			$("#bonuspane .techitem_dup img").attr({'src' : 'images/icons/techtree/'+item.id+'.jpg'});
			if (ad2460.techVariables.selectedTechItemBranch != 'Displacement') {
				$("#bonuspane_entry").removeAttr( 'style' ).removeClass('bonuspane_entry_mirror').addClass('bonuspane_entry');
				$("#bonuspane").removeAttr( 'style' ).removeClass('bonuspane_mirror').addClass('bonuspane').css({left: panePos+'px', width: '250px', height: paneHeight+10});
			}
			else {
				$("#bonuspane").removeAttr( 'style' ).removeClass('bonuspane').addClass('bonuspane_mirror').css({right: panePos+'px', width: '250px', height: paneHeight+10});
				$("#bonuspane_entry").removeAttr( 'style' ).removeClass('bonuspane_entry').addClass('bonuspane_entry_mirror');
			}
			$("#bonuspane_text").css({opacity: 1});
			$("#bonuspane_text_content").css({opacity: 1});
			ad2460.techVariables.bonusPanelOpen=true;
		}
		else if(ad2460.techVariables.selectedTechItemBranch != ad2460.techVariables.previousSelectedTechItemBranch) {
			$("#bonuspane_text_content").css({opacity: 0}).html(item.description);
			$("#bonuspane_title_content").html(item.name);
			var paneHeight = $("#bonuspane_entry").outerHeight();
			$("#bonuspane .techitem_dup img").attr({'src' : 'images/icons/techtree/'+item.id+'.jpg'});
			$("#bonuspane").css({width: '0px'});
			if (ad2460.techVariables.selectedTechItemBranch != 'Displacement') {
				$("#bonuspane_entry").removeAttr( 'style' ).removeClass('bonuspane_entry_mirror').addClass('bonuspane_entry');
				$("#bonuspane").removeAttr( 'style' ).removeClass('bonuspane_mirror').addClass('bonuspane').css({left: panePos+'px', height: paneHeight+10});
			}
			else {
				$("#bonuspane").removeAttr( 'style' ).removeClass('bonuspane').addClass('bonuspane_mirror').css({right: panePos+'px', height: paneHeight+10});
				$("#bonuspane_entry").removeAttr( 'style' ).removeClass('bonuspane_entry').addClass('bonuspane_entry_mirror');
			}
			$("#bonuspane_text").css({opacity: 1})
			$("#bonuspane_text_content").css({opacity: 1});
			$("#bonuspane").css({width: '0px'}).animate({width: '250px'},200);
			//	console.log('Pane moved from other tech');
			ad2460.techVariables.bonusPanelOpen=true;
		}
	}
	//console.log("You clicked "+item.name+ "in the branch " +item.branch);
}

function techtreePlusClick(){
	var item=returnTechItemById(ad2460.techVariables.selectedTechItemId);
	if (!item){
		console.log("No item selected.");
		return;
	}
	if (item.points+item.temp_points<item.max_points && ad2460.techpoints-ad2460.uncomittedTechPoints>0){
		ad2460.uncomittedTechPoints++;
		item.temp_points++;
		$("#bonus_allocated").html(item.points+item.temp_points);
		$("#current_available_techpoints").html(ad2460.techpoints-ad2460.uncomittedTechPoints);
		var idToEdit='techitem_level_'+ad2460.techVariables.selectedTechItemId;
		$("#"+idToEdit).html(item.points+item.temp_points);
		//tempCountTechPoints();
		//updateTechBonusText(item.points+item.temp_points);
		updateTierData();
		updateCommitButton();

		setTimeout(function(){
			if (mouseDown==true){
				techtreePlusClick();
			}
		},150);
	}
}

function techtreeMinusClick(){
	var item=returnTechItemById(ad2460.techVariables.selectedTechItemId);
	if (!item){
		return;
	}
	if (item.temp_points>0){
		ad2460.uncomittedTechPoints--;
		item.temp_points--;
		$("#bonus_allocated").html(item.points+item.temp_points);
		$("#current_available_techpoints").html(ad2460.techpoints-ad2460.uncomittedTechPoints);
		var idToEdit='techitem_level_'+ad2460.techVariables.selectedTechItemId;
		$("#"+idToEdit).html(item.points+item.temp_points);
		//updateTechBonusText(item.points+item.temp_points);
		updateTierData();
		updateCommitButton();
		setTimeout(function(){
			if (mouseDown==true){
				techtreeMinusClick();
			}
		},150);

	}
}

function updateCommitButton(){
	if (ad2460.uncomittedTechPoints>0){
		$("#techtree_commit_button .buttontext24").css({color:'red'});
	}
	else {
		$("#techtree_commit_button .buttontext24").css({color:'#e5e5e5'});
	}

}

function updateTechBonusText(total_points){
	var item=returnTechItemById(ad2460.techVariables.selectedTechItemId);
	//$("#bonuspane_text_content").html('updated text maybe?');

}

function techTreeCancelClick(){
	// Null out any temp-points and re-render
	var i=0;
	for (i=0;i<ad2460.techitems.length ;i++ ){
		var item=ad2460.techitems[i];
		item.temp_points=0;
	}
	if (ad2460.techVariables.selectedTechItemId>0){
		var item=returnTechItemById(ad2460.techVariables.selectedTechItemId);
		if (item){
			$("#bonus_allocated").html(item.points);
		}
	}
	ad2460.uncomittedTechPoints=0;
	updateTierData();
	updateCommitButton();
	//$("#current_available_techpoints").html(ad2460.techpoints-ad2460.uncomittedTechPoints);
	//renderTechTree();
}

function techTreeCommitClick(callback){
	// parse all techitems and look for temp_points
	// create a string that holds the update-data
	// 800:2--801:3--802:5 etc
	var techupdate="";
	var i=0;
	for (i=0;i<ad2460.techitems.length ;i++ ){
		var item=ad2460.techitems[i];
		if (item.temp_points>0){
			techupdate=techupdate+""+item.id+":"+item.temp_points+"--";
		}
	}

	$.post('actionhandler.pl', {action:'commit_tech_points',updatedata:techupdate}, function(data){ parseInfo(data);if(typeof(callback) === 'function') {hideHelpCommander();callback();}});
}

function techTreeResetClickPrevious(){
	var price=100000;
	var i=0;

	var totalPoints=0;

	for (i=0;i<ad2460.techitems.length ;i++ ){

		totalPoints+=ad2460.techitems[i].points;
	}
	price+=(totalPoints*20000);
	// check for grace-time discount
	var secsLeft=ad2460.homeworld.reg_timestamp+(168*3600)-ad2460.serverTime;

	// temp discount
	// price=0;

	if (secsLeft>0){
		// Fixed price during grace-time, 2.000 of each resource
		price=2000;

		// temp discount
		// price=0;

		// showConfirmationPopup("Are you sure to wish to fully reset all techpoints? This will cost you "+prettyPrint(price)+ " of each resource! Be advised, after your first 96 hours, this price will be much higher!","Yes","No","confirmTechPointReset();hideConfirmationPopup();")
		showConfirmationPopup("Are you sure to wish to fully reset all techpoints? Be advised, after your first week, this price will be much higher!","Yes","No","confirmTechPointReset();hideConfirmationPopup();")
		return;
	}

	showConfirmationPopup("Are you sure to wish to fully reset all techpoints? This will cost you "+prettyPrint(price)+ " of each resource! ","Yes","No","confirmTechPointReset();hideConfirmationPopup();")
	//showConfirmationPopup("Are you sure to wish to fully reset all techpoints?","Yes","No","confirmTechPointReset();hideConfirmationPopup();")
}

function techTreeResetClick(){
	var price=5;
	var i=0;

	if (ad2460.scores.level<8){
		showConfirmationPopup("Are you sure to wish to fully reset all techpoints? This is completely FREE for you now, as you have not yet reached level 8. Later, it will cost you "+price+" credits!","Yes","No","confirmTechPointReset();hideConfirmationPopup();")
	}
	else {
		showConfirmationPopup("Are you sure to wish to fully reset all techpoints? This will cost you "+prettyPrint(price)+ " credits! ","Yes","No","confirmTechPointReset();hideConfirmationPopup();")
	}
}

function confirmTechPointReset(){
	// Pass the message to the server to reset the whole thing...
	var price=5;

	if (ad2460.scores.level<8){
		price=0;
	}

	if (ad2460.credits<price ){
		systemFeedback("Not enough credits.", 1, 3);
		return;
	}

	// Ok, we have enough res, proceed...
	$.post('actionhandler.pl', {action:'reset_all_tech_points'}, function(data){ parseInfo(data);renderProductionitems();});
}



function renderTechPointList(){
	// close any open bonus-item first
	closeTechtreeBonusPanel();

	var i=0;
	// clean columns first
	removeChildNodes('tech_desc_column_1');
	removeChildNodes('tech_desc_column_2');
	removeChildNodes('tech_desc_column_3');

	var col1=document.getElementById('tech_desc_column_1');
	var col2=document.getElementById('tech_desc_column_2');
	var col3=document.getElementById('tech_desc_column_3');

	var parents=[col1,col2,col3];

	for (i=0;i<ad2460.techpointsList.length ; i++){
		var parent=parents[i % 3];
		var entry_class='tech_point_gain_entry';
		var p=ad2460.techpointsList[i];
		if (p.timestamp>0){
			entry_class+=' done';
		}
		var text=p.description; // Default

		// Now handle the different types..
		// development','research','facility','production','academy_use','commander_level','claim_outpost','upgrade_outpost','gain_level','intel_operation','prospect','complete_mission
		if (p.type=='development' || p.type=='research' || p.type=='facility' || p.type=='production' ){
			var o=returnGameObjectById(p.num_var);
			text=p.description+ ' ' + o.name;
			if (p.type=='facility')	{
				text+=' L '+o.level;
			}
		}
		if (p.type=='upgrade_outpost'){
			text+=" "+p.num_var;
		}
		if (p.type=='gain_level'){
			text+=" "+p.num_var;
		}
		if (p.type=='complete_mission'){
			var mission=returnMissionByMissionId(p.num_var);
			if (mission){
				text+=" "+mission.mission_name;
			}
			else {
				text+=" INVALID MISSION";
			}

		}

		var elm=createSingleElement('div', entry_class, '', text, '');
		if (p.type=='development' || p.type=='research' || p.type=='facility' || p.type=='production' ){
			elm.setAttribute("onclick","showGameInfoBox("+p.num_var+")");
			elm.style.cursor='pointer';

		}
		parent.appendChild(elm);
	}

}

function closeTechtreeBonusPanel(){
	$("#bonuspane").css({width: '0px'});
	ad2460.techVariables.bonusPanelOpen = false;
	ad2460.techVariables.selectedTechItemId=0;
	ad2460.techVariables.previousSelectedTechItemId=0;
	ad2460.techVariables.previousSelectedTechItemBranch='';
	ad2460.techVariables.selectedTechItemBranch='';
}

function updateTierData(){
	reInitTierData();

	for (i=0;i<ad2460.techitems.length ;i++ ){
		var item=ad2460.techitems[i];
		var tierData=returnTierDataByBranchTier(item.branch,item.tier);
		tierData.spent_points+=item.points;
		tierData.temp_points+=item.temp_points;
	}

	// Now lets find out which ones to open
	for (i=0;i<ad2460.techVariables.tiers.length ;i++ ){
		//console.log("processing "+ad2460.techVariables.tiers[i].branch+" "+ad2460.techVariables.tiers[i].tier);
		var thisTier=ad2460.techVariables.tiers[i];
		if (thisTier.open==false){
			//console.log("It is not open...");
			// Check the previous entry if it meets this requires
			if (countTotalPointsSpentInBranchUpUntilTier(thisTier.branch, thisTier.tier-1)>=thisTier.requires){
				thisTier.open=true;
			}
		}
	}

	if (ignoreTechtreeRenderUpdate!=true){
		renderTechTreeNewest();
	}

	var problemFound=false;
	// And a special check to clean up invalid placed points...
	for (i=0;i<ad2460.techitems.length ;i++ ){
		var item=ad2460.techitems[i];
		var tierData=returnTierDataByBranchTier(item.branch,item.tier);
		if (tierData.open==false && item.temp_points>0){
			problemFound=true;
			// Houston, we have a problem!
			ad2460.uncomittedTechPoints-=item.temp_points;
			item.temp_points=0;
		}
	}
	if (problemFound){
		updateTierData();
	}


}

function returnTierDataByBranchTier(branch,tier){
	var i=0;
	for (i=0;i<ad2460.techVariables.tiers.length; i++ ){
		if (ad2460.techVariables.tiers[i].branch==branch && ad2460.techVariables.tiers[i].tier==tier){
			return ad2460.techVariables.tiers[i];
		}
	}
	return false;
}

function reInitTierData(){
	ad2460.techVariables.tiers=new Array;
	ad2460.techVariables.tiers.push({branch:'Matter',		tier:1, open:true,	spent_points:0, temp_points:0, requires:0});
	ad2460.techVariables.tiers.push({branch:'Matter',		tier:2, open:false, spent_points:0, temp_points:0, requires:10});
	ad2460.techVariables.tiers.push({branch:'Matter',		tier:3, open:false, spent_points:0, temp_points:0, requires:20});
	ad2460.techVariables.tiers.push({branch:'Matter',		tier:4, open:false, spent_points:0, temp_points:0, requires:30});
	ad2460.techVariables.tiers.push({branch:'Matter',		tier:5, open:false, spent_points:0, temp_points:0, requires:40});
	ad2460.techVariables.tiers.push({branch:'Matter',		tier:6, open:false, spent_points:0, temp_points:0, requires:50});
	ad2460.techVariables.tiers.push({branch:'Energy',		tier:1, open:true,	spent_points:0, temp_points:0, requires:0});
	ad2460.techVariables.tiers.push({branch:'Energy',		tier:2, open:false, spent_points:0, temp_points:0, requires:10});
	ad2460.techVariables.tiers.push({branch:'Energy',		tier:3, open:false, spent_points:0, temp_points:0, requires:20});
	ad2460.techVariables.tiers.push({branch:'Energy',		tier:4, open:false, spent_points:0, temp_points:0, requires:30});
	ad2460.techVariables.tiers.push({branch:'Energy',		tier:5, open:false, spent_points:0, temp_points:0, requires:40});
	ad2460.techVariables.tiers.push({branch:'Energy',		tier:6, open:false, spent_points:0, temp_points:0, requires:50});
	ad2460.techVariables.tiers.push({branch:'Displacement',	tier:1, open:true,	spent_points:0, temp_points:0, requires:0});
	ad2460.techVariables.tiers.push({branch:'Displacement',	tier:2, open:false, spent_points:0, temp_points:0, requires:10});
	ad2460.techVariables.tiers.push({branch:'Displacement',	tier:3, open:false, spent_points:0, temp_points:0, requires:20});
	ad2460.techVariables.tiers.push({branch:'Displacement',	tier:4, open:false, spent_points:0, temp_points:0, requires:30});
	ad2460.techVariables.tiers.push({branch:'Displacement',	tier:5, open:false, spent_points:0, temp_points:0, requires:40});
	ad2460.techVariables.tiers.push({branch:'Displacement',	tier:6, open:false,	spent_points:0, temp_points:0, requires:50});

}

function countTotalPointsSpentInBranch(branch){
	var i=0;
	var count=0;
	for (i=0;i<ad2460.techVariables.tiers.length; i++ ){
		if (ad2460.techVariables.tiers[i].branch==branch){
			count+=ad2460.techVariables.tiers[i].spent_points+ad2460.techVariables.tiers[i].temp_points;
		}
	}
	return count;
}

function countTotalPointsSpentInBranchUpUntilTier(branch,tier){
	var i=0;
	var count=0;
	for (i=0;i<ad2460.techVariables.tiers.length; i++ ){
		if (ad2460.techVariables.tiers[i].branch==branch && ad2460.techVariables.tiers[i].tier<=tier){
			count+=ad2460.techVariables.tiers[i].spent_points+ad2460.techVariables.tiers[i].temp_points;
		}
	}
	return count;
}


function countPointsRequiredToOpenNextTier(branch){
	var i=0;
	for (i=0;i<ad2460.techVariables.tiers.length; i++ ){
		if (ad2460.techVariables.tiers[i].branch==branch){
			if (ad2460.techVariables.tiers[i].open==false){
				return (ad2460.techVariables.tiers[i].requires-countTotalPointsSpentInBranch(branch));
			}
		}
	}
}


function renderTechTreeNewest(){
	// First we need to clear all of them.
	clearTechTreeNew();
	$("#current_available_techpoints").html(ad2460.techpoints-ad2460.uncomittedTechPoints);
	var last_rendered_tier=1;
	var last_rendered_tech='Matter';

	ad2460.techVariables.spentTechPointsMatter=countTotalPointsSpentInBranch("Matter");
	ad2460.techVariables.spentTechPointsEnergy=countTotalPointsSpentInBranch("Energy");
	ad2460.techVariables.spentTechPointsDisplacement=countTotalPointsSpentInBranch("Displacement");

	var pts_needed_to_unlock_next_matter_tier=countPointsRequiredToOpenNextTier("Matter");
	var pts_needed_to_unlock_next_energy_tier=countPointsRequiredToOpenNextTier("Energy");
	var pts_needed_to_unlock_next_displacement_tier=countPointsRequiredToOpenNextTier("Displacement");

	$("#matter_tech_point_needed_to_unlock").html(pts_needed_to_unlock_next_matter_tier);
	$("#energy_tech_point_needed_to_unlock").html(pts_needed_to_unlock_next_energy_tier);
	$("#displacement_tech_point_needed_to_unlock").html(pts_needed_to_unlock_next_displacement_tier);

	$("#matter_tech_point_needed_to_unlock_text").html('points needed to unlock next tier');
	$("#energy_tech_point_needed_to_unlock_text").html('points needed to unlock next tier');
	$("#displacement_tech_point_needed_to_unlock_text").html('points needed to unlock next tier');

	if (ad2460.techVariables.spentTechPointsMatter>=50){
		$("#matter_tech_point_needed_to_unlock").html('');
		$("#matter_tech_point_needed_to_unlock_text").html('All tiers have been unlocked');
	}
	if (ad2460.techVariables.spentTechPointsEnergy>=50){
		$("#energy_tech_point_needed_to_unlock").html('');
		$("#energy_tech_point_needed_to_unlock_text").html('All tiers have been unlocked');
	}
	if (ad2460.techVariables.spentTechPointsDisplacement>=50){
		$("#displacement_tech_point_needed_to_unlock").html('');
		$("#displacement_tech_point_needed_to_unlock_text").html('All tiers have been unlocked');
	}

	// Now we should be able to render all of these, knowing their parent by their branch and whether or not enough points have been spent to enable them
	var i=0;
	for (i=0;i<ad2460.techitems.length ;i++ ){
		var thisItem=ad2460.techitems[i];
		var parentId='available_matter_techs';

		if (thisItem.branch=='Matter'){
			parentId='available_matter_techs';
			if (countTotalPointsSpentInBranchUpUntilTier(thisItem.branch,thisItem.tier-1)<thisItem.required_spent_points_in_branch){
				parentId='unavailable_matter_techs';
			}
		}
		if (thisItem.branch=='Energy'){
			parentId='available_energy_techs';
			if (countTotalPointsSpentInBranchUpUntilTier(thisItem.branch,thisItem.tier-1)<thisItem.required_spent_points_in_branch){
				parentId='unavailable_energy_techs';
			}
		}
		if (thisItem.branch=='Displacement'){
			parentId='available_displacement_techs';
			if (countTotalPointsSpentInBranchUpUntilTier(thisItem.branch,thisItem.tier-1)<thisItem.required_spent_points_in_branch){
				parentId='unavailable_displacement_techs';
			}
		}

		//console.log("Parent ID is "+parentId);

		var parent=document.getElementById(parentId);
		if (!parent){
			console.log("Error: No parent found in techtreeslide for techitem" + thisItem);
		}

		// Now we need to check if this tier is higher than the one previously rendered, or if we have changed branch....
		if (thisItem.branch!=last_rendered_tech){
			last_rendered_tier=1;
			last_rendered_tech=thisItem.branch;
		}
		else if (thisItem.tier!=last_rendered_tier){
			// Uh oh, we need to put in place a tier-splitter-element before proceeding
			var sepdiv=document.createElement("div");
			sepdiv.setAttribute('class','tech_line_separate');
			parent.appendChild(sepdiv);
		}

		last_rendered_tier=thisItem.tier;

		// Ok, we should be ok to render the element now
		//<div class='techitem' id='m01'>
		//	<img src='images/icons/research/101.jpg' />
		//	<div class='techitem_level'>3</div>
		//</div>

		var itemContainer=document.createElement("div");
		itemContainer.setAttribute('class','techitem');
		itemContainer.setAttribute('id',''+thisItem.id);
		itemContainer.setAttribute("onclick","techItemClick("+thisItem.id+",false,event)");


		var itemImg=document.createElement("img");
		itemImg.setAttribute('src','images/icons/techtree/'+thisItem.id+'.jpg');
		itemImg.setAttribute('alt',thisItem.name);

		var levelDiv=document.createElement("div");
		levelDiv.setAttribute('class','techitem_level');
		levelDiv.setAttribute('id','techitem_level_'+thisItem.id);
		levelDiv.innerHTML=thisItem.points+thisItem.temp_points;

		itemContainer.appendChild(itemImg);
		itemContainer.appendChild(levelDiv);
		parent.appendChild(itemContainer);
	}

	// now for the auto-buttons...
	if (ad2460.techpoints>=20 && ad2460.vip_status>ad2460.serverTime){
		var parent=document.getElementById('outer_tech_tree_border_intech');
		var auto_button_intech=createSingleElement('div', 'auto_tech_button intech', 'auto_button_intech', 'Auto', 'autoFillTechTree("intech")');
		parent.appendChild(auto_button_intech);

		var parent=document.getElementById('outer_tech_tree_border_strontech');
		var auto_button_strontech=createSingleElement('div', 'auto_tech_button strontech', 'auto_button_strontech', 'Auto', 'autoFillTechTree("strontech")');
		parent.appendChild(auto_button_strontech);

		var parent=document.getElementById('outer_tech_tree_border_neotech');
		var auto_button_neotech=createSingleElement('div', 'auto_tech_button neotech', 'auto_button_neotech', 'Auto', 'autoFillTechTree("neotech")');
		parent.appendChild(auto_button_neotech);
	}
}

function reloadAllTechTreeData(callback){
	$.post('actionhandler.pl', {action:'reload_tech_tree'}, function(data){ parseInfo(data);if(typeof(callback) === 'function') {callback();}});
}

function clearTechtreeData(){
	ad2460.techitems=new Array;
}

function loadTechpoints(callback){
	$.post('actionhandler.pl', {action:'load_tech_points_list'}, function(data){ parseInfo(data);if(typeof(callback) === 'function') {callback();}});
}

function updateTechPointDef(id,type,num_var,string_var,description,timestamp){
	var found=false;
	var i=0;
	for (i=0;i<ad2460.techpointsList.length ;i++ ){
		if (ad2460.techpointsList[i].id==id){
			found=true;
			// The only possible updated value is the timestamp tbh!!
			ad2460.techpointsList[i].timestamp=timestamp;
			return;
		}
	}
	if (found==false){
		ad2460.techpointsList.push(new techPointDef(id,type,num_var,string_var,description,timestamp));
	}
}

function claimTechpoint(id){
	$.post('actionhandler.pl', {action:'claim_tech_point',id:id}, function(data){ parseInfo(data);});
}

function processUndisplayedTechPoints(){
	if (ad2460.techpointsBoxOpen==true || ad2460.levelBoxOpen==true){
		return;
	}

	if (ad2460.undisplayedTechpoints.length>0){
		// We have shit to do! Process the first one only!
		// find the techpoint pls...
		for (i=0;i<ad2460.techpointsList.length ;i++ ){
			if (ad2460.undisplayedTechpoints[0]==ad2460.techpointsList[i].id){
				var mainBodyText=translations.techpoint_heading;
				var secondaryBodyText="";
				if (ad2460.techpointsList[i].type=='facility'){
					var item=returnGameObjectById(ad2460.techpointsList[i].num_var);
					secondaryBodyText=fillIn(translations.techpoint_facility,[item.name]);
				}
				if (ad2460.techpointsList[i].type=='research'){
					var item=returnGameObjectById(ad2460.techpointsList[i].num_var);
					secondaryBodyText=fillIn(translations.techpoint_research,[item.name]);
				}
				if (ad2460.techpointsList[i].type=='development'){
					var item=returnGameObjectById(ad2460.techpointsList[i].num_var);
					secondaryBodyText=fillIn(translations.techpoint_development,[item.name]);
				}
				if (ad2460.techpointsList[i].type=='production'){
					var item=returnGameObjectById(ad2460.techpointsList[i].num_var);
					secondaryBodyText=fillIn(translations.techpoint_production,[item.name]);
				}
				if (ad2460.techpointsList[i].type=='academy_use'){
					secondaryBodyText=translations.techpoint_academy_use;
				}
				if (ad2460.techpointsList[i].type=='commander_level'){
					var rankObj=returnCommanderRankNameObject(ad2460.techpointsList[i].num_var);
					secondaryBodyText=fillIn(translations.techpoint_commander_level,[rankObj.longRank]);
				}
				if (ad2460.techpointsList[i].type=='claim_outpost'){
					var numberString="";
					if (ad2460.techpointsList[i].num_var==1)	{	numberString=translations.position_1;	}
					if (ad2460.techpointsList[i].num_var==2)	{	numberString=translations.position_2;	}
					if (ad2460.techpointsList[i].num_var==3)	{	numberString=translations.position_3;	}
					if (ad2460.techpointsList[i].num_var==4)	{	numberString=translations.position_4;	}
					if (ad2460.techpointsList[i].num_var==5)	{	numberString=translations.position_5;	}
					if (ad2460.techpointsList[i].num_var==6)	{	numberString=translations.position_6;	}
					if (ad2460.techpointsList[i].num_var==7)	{	numberString=translations.position_7;	}
					if (ad2460.techpointsList[i].num_var==8)	{	numberString=translations.position_8;	}
					if (ad2460.techpointsList[i].num_var==9)	{	numberString=translations.position_9;	}
					if (ad2460.techpointsList[i].num_var==10)	{	numberString=translations.position_10;	}

					if (ad2460.techpointsList[i].num_var==10)	{	numberString=translations.position_10;	}
					if (ad2460.techpointsList[i].num_var==11)	{	numberString=translations.position_11;	}
					if (ad2460.techpointsList[i].num_var==12)	{	numberString=translations.position_12;	}
					if (ad2460.techpointsList[i].num_var==13)	{	numberString=translations.position_13;	}
					if (ad2460.techpointsList[i].num_var==14)	{	numberString=translations.position_14;	}
					if (ad2460.techpointsList[i].num_var==15)	{	numberString=translations.position_15;	}
					if (ad2460.techpointsList[i].num_var==16)	{	numberString=translations.position_16;	}
					if (ad2460.techpointsList[i].num_var==17)	{	numberString=translations.position_17;	}
					if (ad2460.techpointsList[i].num_var==18)	{	numberString=translations.position_18;	}
					if (ad2460.techpointsList[i].num_var==19)	{	numberString=translations.position_19;	}
					if (ad2460.techpointsList[i].num_var==20)	{	numberString=translations.position_20;	}

					secondaryBodyText=fillIn(translations.techpoint_claim_outpost,[numberString]);
				}
				if (ad2460.techpointsList[i].type=='upgrade_outpost'){
					secondaryBodyText=fillIn(translations.techpoint_upgrade_outpost,[ad2460.techpointsList[i].num_var]);
				}
				if (ad2460.techpointsList[i].type=='gain_level'){
					secondaryBodyText=fillIn(translations.techpoint_gain_level,[ad2460.techpointsList[i].num_var]);
				}
				if (ad2460.techpointsList[i].type=='intel_operation'){
					if (ad2460.techpointsList[i].string_var=='scout'){
						secondaryBodyText=translations.techpoint_intel_operation_scout;
					}
					if (ad2460.techpointsList[i].string_var=='espionage'){
						secondaryBodyText=translations.techpoint_intel_operation_espionage;
					}
					if (ad2460.techpointsList[i].string_var=='infiltration'){
						secondaryBodyText=translations.techpoint_intel_operation_infiltration;
					}
				}
				if (ad2460.techpointsList[i].type=='prospect'){
					secondaryBodyText=translations.techpoint_prospect;
				}
				if (ad2460.techpointsList[i].type=='complete_mission'){
					var mission=returnMissionByMissionId(ad2460.techpointsList[i].num_var);
					secondaryBodyText=fillIn(translations.techpoint_completed_mission,[mission.mission_name]);
				}
				if (ad2460.techpointsList[i].type=='wargames_win'){
					secondaryBodyText=fillIn(translations.techpoint_wargames_won,[ad2460.techpointsList[i].num_var]);
				}
				if (ad2460.techpointsList[i].type=='small_wins'){
					secondaryBodyText=fillIn(translations.techpoint_small_wins,[ad2460.techpointsList[i].num_var]);
				}
				if (ad2460.techpointsList[i].type=='large_wins'){
					secondaryBodyText=fillIn(translations.techpoint_large_wins,[ad2460.techpointsList[i].num_var]);
				}
				if (ad2460.techpointsList[i].type=='huge_wins'){
					secondaryBodyText=fillIn(translations.techpoint_huge_wins,[ad2460.techpointsList[i].num_var]);
				}
				if (ad2460.techpointsList[i].type=='tactical_victories'){
					secondaryBodyText=fillIn(translations.techpoint_tactical_victories,[ad2460.techpointsList[i].num_var]);
				}
				if (ad2460.techpointsList[i].type=='underdog_wins'){
					secondaryBodyText=fillIn(translations.techpoint_underdog_wins,[ad2460.techpointsList[i].num_var]);
				}
				if (ad2460.techpointsList[i].type=='killed_strength'){
					secondaryBodyText=fillIn(translations.techpoint_killed_strength,[prettyPrint(ad2460.techpointsList[i].num_var)]);
				}

				var buttonText="Cool!";
				if (Math.random()*100<30){	buttonText="Wheeeee!";		}
				else if (Math.random()*100<50){	buttonText="Lovely!";		}
				else if (Math.random()*100<70){	buttonText="Thank you!";	}

				ad2460.undisplayedTechpoints.shift();
				//showOkPopup(mainBodyText+"<br/><br/>"+secondaryBodyText, buttonText, "");

				$("#techpoint_head").html(mainBodyText);

				if (ad2460.techpoints<4 && ad2460.techVariables.spentTechPointsDisplacement==0 && ad2460.techVariables.spentTechPointsEnergy==0 && ad2460.techVariables.spentTechPointsMatter==0){
					secondaryBodyText+="<br><br>Tech points in AD2460 are used to specialise in a certain technology, to enable special bonuses and even to unlock new ships. You select from several possible options, and place your tech points in these to gain the bonuses.<br><br>There are 3 different tech trees. Each tree corresponds to one of the main technologies in the game: InTech, StronTech and NeoTech. The more points you put into one of the trees, the deeper you will specialise in that technology.<br><br>InTech specialises in hull and cargo/hangar capacity. They are also very capable when it comes to secondary weapons (missiles).<br>StronTech specialises in shields and primary weapon damage.<br>NeoTech specialises in manoeuvrability and special effects.<br><br>It is not important to pick a tech just yet, but if you do anyway, you can always change it later, for a small fee.<br><br>To open the Tech Tree at any time, click the round 'T'-button in the lower left corner.";
				}

				$("#techpoint_desc").html(secondaryBodyText);

				// if (ad2460.scores.level>2){
					showTechAward();
					ad2460.techpointsBoxOpen=true;
				// }



				return;
			}
		}
	}
}

function levelMeUp(wasLevel,isLevel){
	if (combatPanelOpen==1){
		// Would be nice to delay it!!!
		var functionString="levelMeUp("+wasLevel+","+isLevel+")";
		setTimeout(functionString, 1000);
		return;
	}


	ad2460.levelBoxOpen=true;
	var newMaxOutposts=ad2460.max_outposts_by_level[isLevel];
	var newMaxCommanders=ad2460.playerLevelMaxCommanders[isLevel];
	var requiredXP=ad2460.playerXpLevels[isLevel]-ad2460.scores.xp;

	var secondaryBodyText='<div class="leveltext_extraction">You can now extract resources from '+newMaxOutposts+' outposts and have a total of '+newMaxCommanders+' commanders.</div><div class="leveltext_nextlevel">Next level requires '+prettyPrint(requiredXP)+' XP</div>';

	//$("#techpoint_head").html(mainBodyText);
	//$("#techpoint_desc").html(secondaryBodyText);
	$("#level_up_text").html("You have reached level "+isLevel+"!");
	$("#level_up_desc").html(ad2460.levelText[isLevel]+secondaryBodyText);

	//showLevelUp();
	showLevelUpPlate();
	updateOutpostOverview();

	// play levelup.mp3
	play_multi_sound('levelup');
	hideHelpCommander();
	if (ga){
		ga('send', 'event', 'game-action', 'level-up', 'Level '+isLevel, ad2460.user_id );
	}
	reloadAllMilitaryData();

	// showLevelInfo() will only show the bottom part, the showLevelUpPlate(); shows both top and bottom
	// hideLevelUpPlate() hides both, and should show the woman in the corner
}

function showLevelHelp(level){
	if ($("#level_up_main").is(":visible")==true){
		hideLevelUpPlate();
		return;
	}

	if (isNaN(level)){
		level=ad2460.scores.level;
	}



	var newMaxOutposts=ad2460.max_outposts_by_level[level];
	var newMaxCommanders=ad2460.playerLevelMaxCommanders[level];
	var requiredXP=ad2460.playerXpLevels[ad2460.scores.level]-ad2460.scores.xp;

	var secondaryBodyText='<div class="leveltext_extraction">You can now extract resources from '+newMaxOutposts+' outposts and have a total of '+newMaxCommanders+' commanders.</div><div class="leveltext_nextlevel">Next level requires '+prettyPrint(requiredXP)+' XP</div>';

	$("#level_up_desc").html(ad2460.levelText[level]+secondaryBodyText);

	showLevelInfo();
	blinkElementById("gameinfo_level");
}


function processUnclaimedTechPoints(){
	// traverse ad2460.unclaimedTechpoints and deal with them one by one....
	// Or leave it to an interval to call this routine
	if (ad2460.techpointsClaimerRunning==true){
		return;
	}
	ad2460.techpointsClaimerRunning=true;

	if (ad2460.unclaimedTechpoints.length>0){
		claimTechpoint(ad2460.unclaimedTechpoints[0]);
		ad2460.unclaimedTechpoints.shift();
	}

	setTimeout("ad2460.techpointsClaimerRunning=false",3000);
}

function addUnclaimed(id){
	var i=0;
	var found=false;
	for(i=0;i<ad2460.unclaimedTechpoints.length;i++){
		if(ad2460.unclaimedTechpoints[i]==id){
			found=true;
		}
	}
	if(found==false){
		ad2460.unclaimedTechpoints.push(id);
	}
}

function checkUnclaimedTechPoints(checkType,identifier){
	var i=0;
	// Don't forget that the server must VERIFY all claims regardless of type...
	if (checkType=='player_update'){
		/* identifier is the image-id
		1 = player_levelup		2 = facility		3 = research		4 = development		5 = production
		6 = prospecting		7 = outpost-upgrade		8 = commander level-up
		11 = scout		12 = spy		13 = infiltration
		*/
		if (identifier==1){
			// Now go through the ad2460.techpointsList
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				var myLevel=ad2460.scores.level;
				if (ad2460.techpointsList[i].type=='gain_level'){
					// the type is right
					if (myLevel>=ad2460.techpointsList[i].num_var && ad2460.techpointsList[i].timestamp<1){
						// We have an unclaimed techpoint!
						addUnclaimed(ad2460.techpointsList[i].id);
						return;
					}
				}
			}
		}
		else if (identifier==2){
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='facility' && ad2460.techpointsList[i].timestamp==0){
					var facility=returnGameObjectById(ad2460.techpointsList[i].num_var);
					if (facility!=false){
						if (facility.user_id>0 && facility.upgrading!=1){
							// We have it!
							addUnclaimed(ad2460.techpointsList[i].id);
							return;
						}
					}
				}
			}
		}

		else if (identifier==3){
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='research' && ad2460.techpointsList[i].timestamp==0){
					var research=returnGameObjectById(ad2460.techpointsList[i].num_var);
					if (research!=false){
						if (research.user_id>0 && research.upgrading!=1){
							// We have it!
							addUnclaimed(ad2460.techpointsList[i].id);
							return;
						}
					}
				}
			}
		}

		else if (identifier==4){
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='development' && ad2460.techpointsList[i].timestamp==0){
					var development=returnGameObjectById(ad2460.techpointsList[i].num_var);
					if (development!=false){
						if (development.user_id>0 && development.upgrading!=1){
							// We have it!
							addUnclaimed(ad2460.techpointsList[i].id);
							return;
						}
					}
				}
			}
		}

		else if (identifier==5){
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='production' && ad2460.techpointsList[i].timestamp==0){
					var item=returnGameObjectById(ad2460.techpointsList[i].num_var);
					if (item!=false){
						// a bit trickier this one, as we need to check ALL ships for this one....
						var f=0;
						for (f=0;f<ad2460.myFleets.length ;f++ ){
							var s=0;
							for (s=0;s<ad2460.myFleets[f].ships.length ;s++ ){
								if (ad2460.myFleets[f].ships[s].ship_type_id==ad2460.techpointsList[i].num_var){
									// We have it!!
									addUnclaimed(ad2460.techpointsList[i].id);
									return;
								}
							}
							// Actually, it could be in the homeworlds orbit as well!!
							for (s=0;s<ad2460.homeworld.orbit.length ;s++ ){
								var shipThing=ad2460.homeworld.orbit[s];
								if (shipThing.id==ad2460.techpointsList[i].num_var && shipThing.count>0)	{
									// We have it!!
									addUnclaimed(ad2460.techpointsList[i].id);
									return;
								}
							}
						}
					}
				}
			}
		}

		else if (identifier==6){
			// This is somewhat easier
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='prospect' && ad2460.techpointsList[i].timestamp==0){
					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}
		}

		else if (identifier==7){
			// Outpost-upgrade
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='upgrade_outpost' && ad2460.techpointsList[i].timestamp==0){
					var o=0;
					for (o=0;o<ad2460.outposts.length ;o++ ){
						if (ad2460.outposts[o].level>=ad2460.techpointsList[i].num_var){
							addUnclaimed(ad2460.techpointsList[i].id);
							return;
						}
					}
				}
			}
		}

		else if (identifier==8){
			// Commander level-up
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='commander_level' && ad2460.techpointsList[i].timestamp==0){
					var c=0;
					for (c=0;c<ad2460.myCommanders.length ;c++ ){
						if (ad2460.myCommanders[c].rank>=ad2460.techpointsList[i].num_var && ad2460.myCommanders[c].hired==1){
							addUnclaimed(ad2460.techpointsList[i].id);
							return;
						}
					}
				}
			}
		}
		// The next 3 are about checking ad2460.intel.reports for completed ones ;) They all have a type like 'scout-report' etc
		else if (identifier==11){
			// Scout
			//console.log(ad2460.techpointsList.length);
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='intel_operation'  && ad2460.techpointsList[i].string_var=='scout' && ad2460.techpointsList[i].timestamp==0){
					var r=0;
					for (r=0;r<ad2460.intel.reports.length ;r++ ){
						if (ad2460.intel.reports[r].type=='scout-report' && ad2460.intel.reports[r].mission_id>0 && ad2460.intel.reports[r].user_id==ad2460.user_id){
							// Ok, we have a scout-report finished
							addUnclaimed(ad2460.techpointsList[i].id);
							return;
						}
					}
				}
			}
		}
		else if (identifier==12){
			// Spy
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='intel_operation'  && ad2460.techpointsList[i].string_var=='espionage' && ad2460.techpointsList[i].timestamp==0){
					var r=0;
					for (r=0;r<ad2460.intel.reports.length ;r++ ){
						if (ad2460.intel.reports[r].type=='espionage-report' && ad2460.intel.reports[r].mission_id>0 && ad2460.intel.reports[r].user_id==ad2460.user_id ){
							// Ok, we have a espionage-report finished
							addUnclaimed(ad2460.techpointsList[i].id);
							return;
						}
					}
				}
			}
		}
		else if (identifier==13){
			// Infiltrator
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='intel_operation'  && ad2460.techpointsList[i].string_var=='infiltration' && ad2460.techpointsList[i].timestamp==0){
					var r=0;
					for (r=0;r<ad2460.intel.reports.length ;r++ ){
						if (ad2460.intel.reports[r].type=='infiltration-report' && ad2460.intel.reports[r].mission_id>0 && ad2460.intel.reports[r].user_id==ad2460.user_id){
							// Ok, we have a infiltration-report finished
							addUnclaimed(ad2460.techpointsList[i].id);
							return;
						}
					}
				}
			}
		}
		else if (identifier==19){
			// Mission complete
			for (i=0;i<ad2460.techpointsList.length ;i++ ){
				if (ad2460.techpointsList[i].type=='complete_mission'  && ad2460.techpointsList[i].timestamp==0){
					var r=0;
					for (r=0;r<ad2460.missionPacks.length ;r++ ){
						for (m=0;m<ad2460.missionPacks[r].missions.length ;m++ ){
							if (ad2460.missionPacks[r].missions[m].completed_counter>0 && ad2460.missionPacks[r].missions[m].mission_id==ad2460.techpointsList[i].num_var){
								// We have completed the mission!
								addUnclaimed(ad2460.techpointsList[i].id);
								return;
							}
						}
					}
				}
			}
		}

	} // end if (checkType=='player_update')

	// Here we can add other checkTypes ....
	else if (checkType=='academy_use'){
		for (i=0;i<ad2460.techpointsList.length ;i++ ){
			if (ad2460.techpointsList[i].type=='academy_use' && ad2460.techpointsList[i].timestamp==0){
				var hired=0;
				var c=0;
				for (c=0;c<ad2460.myCommanders.length ;c++ ){
					if (ad2460.myCommanders[c].hired==1){
						hired++;
					}
				}

				if (hired>2){
					// We have obviously promoted someone!
					// err, not...We can have a couple in the academy too, lol...

					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}
		}
	}
	else if (checkType=='claim_outpost'){
		for (i=0;i<ad2460.techpointsList.length ;i++ ){
			if (ad2460.techpointsList[i].type=='claim_outpost' && ad2460.techpointsList[i].timestamp==0){
				if (ad2460.outposts.length>=ad2460.techpointsList[i].num_var){
					// We have obviously claimed something
					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}
		}
	}
	else if (checkType=='scores_loaded'){
		// Check the wargames_won thingie
		// ad2460.scores.wargames_won
		for (i=0;i<ad2460.techpointsList.length ;i++ ){
			if (ad2460.techpointsList[i].type=='wargames_win' && ad2460.techpointsList[i].timestamp==0){
				if (ad2460.scores.wargames_won>=ad2460.techpointsList[i].num_var){
					// We have obviously claimed something
					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}
			if (ad2460.techpointsList[i].type=='small_wins' && ad2460.techpointsList[i].timestamp==0){
				if (ad2460.scores.wins_where_both_above_100k>=ad2460.techpointsList[i].num_var){
					// We have obviously claimed something
					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}
			if (ad2460.techpointsList[i].type=='large_wins' && ad2460.techpointsList[i].timestamp==0){
				if (ad2460.scores.wins_where_both_above_250k>=ad2460.techpointsList[i].num_var){
					// We have obviously claimed something
					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}
			if (ad2460.techpointsList[i].type=='huge_wins' && ad2460.techpointsList[i].timestamp==0){
				if (ad2460.scores.wins_where_both_above_500k>=ad2460.techpointsList[i].num_var){
					// We have obviously claimed something
					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}
			if (ad2460.techpointsList[i].type=='tactical_victories' && ad2460.techpointsList[i].timestamp==0){
				if (ad2460.scores.tactical_victories>=ad2460.techpointsList[i].num_var){
					// We have obviously claimed something
					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}
			if (ad2460.techpointsList[i].type=='underdog_wins' && ad2460.techpointsList[i].timestamp==0){
				if (ad2460.scores.underdog_wins>=ad2460.techpointsList[i].num_var){
					// We have obviously claimed something
					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}
			if (ad2460.techpointsList[i].type=='killed_strength' && ad2460.techpointsList[i].timestamp==0){
				if (ad2460.scores.killed_strength>=ad2460.techpointsList[i].num_var){
					// We have obviously claimed something
					addUnclaimed(ad2460.techpointsList[i].id);
					return;
				}
			}

		}
	}
}


function showOkPopup(mainText, okText, okClick){
	$("#ok_main_text").html(mainText);
	$("#ok_ok_button_text").html(okText);
	document.getElementById('ok_ok_button').onclick=function(){hideOkPopup();eval(okClick);};
	$("#ok_popup").show();
	ad2460.okBoxOpen=true;
}

function showNewOkPopup(mainText, okText, okClick){
	$("#new_ok_main_text").html(mainText);
	$("#new_ok_button_text").html(okText);
	document.getElementById('new_ok_button').onclick=function(){hideNewOkPopup();eval(okClick);};
	$("#new_ok_popup").show();
	ad2460.newOkBoxOpen=true;
}

function hideOkPopup(){
	$("#ok_popup").hide();
	document.getElementById('ok_ok_button').onclick=null;
	ad2460.okBoxOpen=false;
}

function hideNewOkPopup(){
	$("#new_ok_popup").hide();
	document.getElementById('new_ok_button').onclick=null;
	ad2460.newOkBoxOpen=false;
}

function openRankingsSlide(){
	openSlide('rankingslide');
	selectPlayerRanks();
	selectPlayerRankinglist('score_rank');

}
function openOptionsSlide(param){
	// Simple, for now.
	// Consider fetching required data and building it on open in stead of heaving it pre-buillt
	openSlide('optionsslide');
	if (param=='vip'){
		setTimeout(function(){blinkElementByIdShort('vip_pack_option');},250);

	}

}
function openSupportSlide(){
	// Simple, for now.
	// Consider fetching required data and building it on open in stead of heaving it pre-buillt
	openSlide('supportslide');
}

function enableAvatarUploader(){
	var avataruploader = document.getElementById('avataruploader');
	upclick({
		element: avataruploader,
		action: 'actionhandler_upload.pl',
		action_params: {action:"upload_avatar"},
		onstart: function(filename){
			systemFeedback('Uploading','Please wait', 2, 3);
		},
		oncomplete:
		function(response_data){
			parseInfo(response_data);
		}
	});
}

function enableAllianceAvatarUploader(){
	if (ad2460.allianceData.id>0){
		if (ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_info==1){
			//var allianceavataruploader = document.getElementById('alliance_crest_edit');
			var allianceavataruploader = document.getElementById('alliance_avatar_shader');

			upclick({
				element: allianceavataruploader,
				action: 'actionhandler_upload.pl',
				action_params: {action:"upload_alliance_avatar"},
				onstart: function(filename){
					systemFeedback('Uploading','Please wait', 2, 3);
				},
				oncomplete:
				function(response_data){
					parseInfo(response_data);
				}
			});
		}
	}
}

function updateMyAvatar(filename){
	ad2460.avatar=filename;
	$("#options_avatar_image").attr("src","images/uploads/avatars/"+ad2460.avatar);
}

function updateAllianceLogo(filename){
	ad2460.allianceData.logo=filename;
	$("#crest").attr("src","images/uploads/alliancelogos/"+ad2460.allianceData.logo);
	$("#alliance_avatar_picture").attr("src","images/uploads/alliancelogos/"+ad2460.allianceData.logo);
}

function changePwClick(){
	var cp1=$("#opt_cp1").val(); 	var cp2=$("#opt_cp2").val();	var cp3=$("#opt_cp3").val();
	$.post('actionhandler.pl', {action:'cpw',cp1:cp1,cp2:cp2,cp3:cp3}, function(data){ parseInfo(data);});
}

function changeNicknameClick(){
	var newNickname=$("#new_nickname").val();
	$.post('actionhandler.pl', {action:'change_nickname',new_nick:newNickname}, function(data){ parseInfo(data);});
}
function changeNicknameClickConfirmed(){
	var newNickname=$("#new_nickname").val();
	$.post('actionhandler.pl', {action:'change_nickname_confirmed',new_nick:newNickname}, function(data){ parseInfo(data);});
}

function showNicknameChangeConfirm(nick){
	var mainText='Are you absolutely sure you wish to change your nickname to <br><b>';
	mainText+=nick+'</b></br>? It will cost you 10 credits.';
	mainText+='<br>When confirmed, you will be logged out and must log back in to complete the process.';

	var okText='Yes';
	var cancelText='Cancel';
	var okClick='changeNicknameClickConfirmed();hideConfirmationPopup();';
	var cancelClick='hideConfirmationPopup();';

	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick, false, false, false, false);
}

function bulliedClick(){
	systemFeedback("Chicken!","Running away, are we? How about you man up and get even in stead!", 1, 7);
}

function updatePhoneNumber(){
	systemFeedback("Nope!","You can not do this yet.", 1, 4);
}

function reloadRankings(){
	$.post('actionhandler.pl', {action:'reload_rankings'}, function(data){ parseInfo(data);});
}

function clearRankingLists(){
	var i=0;
	for (i=0;i<ad2460.rankingLists.length ;i++ ){
		ad2460.rankingLists[i].entries=new Array;
	}
}

function addRankingList(id,name, last_fetch, type, description){
	// search through rankinglists and look for the id, to consider a possible update.
	var i=0;
	var found=false;
	for (i=0;i<ad2460.rankingLists.length ;i++ ){
		if (ad2460.rankingLists[i].id==id){
			found=true;
			ad2460.rankingLists[i].last_fetch=last_fetch;
			ad2460.rankingLists[i].name=name;
			ad2460.rankingLists[i].type=type; // p or a
			ad2460.rankingLists[i].description=description;
			ad2460.rankingLists[i].entries=new Array;
		}
	}

	if (found==false){
		ad2460.rankingLists.push(new rankingList(id,name,last_fetch, type, description));
	}
}

function addRankingListEntry(id, entry){
	// lets try an entry-object
	var i=0;
	for (i=0;i<ad2460.rankingLists.length ;i++ ){
		if (ad2460.rankingLists[i].id==id){
			ad2460.rankingLists[i].last_fetch=ad2460.serverTime;
			ad2460.rankingLists[i].entries.push(entry);
		}
	}
}
 // addRankingList('p_firepower','Most firepower', 12345678, 'p');
 // addRankingList('a_firepower','Most firepower', 12345678, 'a');

 // addRankingListEntry('p_firepower',{name:'joe',user_id:34,aname:'CoolGuys',value:304837,aid:1, x:217,y:312,rank:1});
function selectPlayerRankings(){
	myScrollToTop('rank_category_slide',0);
	removeChildNodes('rank_category_slide');
	var container=document.getElementById('rank_category_slide');
	var i=0;
	for (i=0;i<ad2460.rankingLists.length ;i++ ){
		if (ad2460.rankingLists[i].type=='p'){
			// Just one div to render.
			var newdiv = document.createElement('div');
			newdiv.innerHTML=ad2460.rankingLists[i].name;
			newdiv.setAttribute("onclick","selectPlayerRankinglist('"+ad2460.rankingLists[i].id+"')");
			container.appendChild(newdiv);
		}
	}
	document.getElementById('own_rank_name').innerHTML=ad2460.scores.nickname;
	selectPlayerRankinglist('score_rank');

	checkScrollButtonStatus('rank_category_slide');
	checkScrollButtonStatus('rank_listing_slide');
}

function selectAllianceRankings(){
	myScrollToTop('rank_category_slide',0);
	removeChildNodes('rank_category_slide');
	var container=document.getElementById('rank_category_slide');
	var i=0;
	for (i=0;i<ad2460.rankingLists.length ;i++ ){
		if (ad2460.rankingLists[i].type=='a'){
			// Just one div to render.
			var newdiv = document.createElement('div');
			newdiv.innerHTML=ad2460.rankingLists[i].name;
			newdiv.setAttribute("onclick","selectAllianceRankinglist('"+ad2460.rankingLists[i].id+"')");
			container.appendChild(newdiv);
		}
	}
	var aname='--';
	if (ad2460.allianceData.id>0){
		aname=ad2460.allianceData.name;
	}
	document.getElementById('own_rank_name').innerHTML=aname;
	selectAllianceRankinglist('alliance_score_rank');
	checkScrollButtonStatus('rank_category_slide');
	checkScrollButtonStatus('rank_listing_slide');

}


function renderOwnRankingRank(id){
	var rankNumber='?';
	if (id=='score_rank'){
		rankNumber=ad2460.scores.score_rank;
		rankValue=ad2460.scores.score;
	}
	else if (id=='strength_rank'){
		rankNumber=ad2460.scores.strength_rank;
		rankValue=ad2460.scores.strength;
	}
	else if (id=='xp_rank'){
		rankNumber=ad2460.scores.xp_rank;
		rankValue=ad2460.scores.xp;
	}
	else if (id=='launched_attacks_rank'){
		rankNumber=ad2460.scores.launched_attacks_rank;
		rankValue=ad2460.scores.launched_attacks;
	}
	else if (id=='incoming_attacks_rank'){
		rankNumber=ad2460.scores.incoming_attacks_rank;
		rankValue=ad2460.scores.incoming_attacks;
	}
	else if (id=='killed_ships_rank'){
		rankNumber=ad2460.scores.killed_ships_rank;
		rankValue=ad2460.scores.killed_ships;
	}
	else if (id=='lost_ships_rank'){
		rankNumber=ad2460.scores.lost_ships_rank;
		rankValue=ad2460.scores.lost_ships;
	}
	else if (id=='killed_commanders_rank'){
		rankNumber=ad2460.scores.killed_commanders_rank;
		rankValue=ad2460.scores.killed_commanders;
	}
	else if (id=='lost_commanders_rank'){
		rankNumber=ad2460.scores.lost_commanders_rank;
		rankValue=ad2460.scores.lost_commanders;
	}
	else if (id=='outpost_upgrades_rank'){
		rankNumber=ad2460.scores.outpost_upgrades_rank;
		rankValue=ad2460.scores.outpost_upgrades;
	}
	else if (id=='captured_outposts_rank'){
		rankNumber=ad2460.scores.captured_outposts_rank;
		rankValue=ad2460.scores.captured_outposts;
	}
	else if (id=='lost_outposts_rank'){
		rankNumber=ad2460.scores.lost_outposts_rank;
		rankValue=ad2460.scores.lost_outposts;
	}
	else if (id=='wins_rank'){
		rankNumber=ad2460.scores.wins_rank;
		rankValue=ad2460.scores.wins;
	}
	else if (id=='losses_rank'){
		rankNumber=ad2460.scores.losses_rank;
		rankValue=ad2460.scores.losses;
	}
	else if (id=='wins_percent_rank'){
		rankNumber=ad2460.scores.wins_percent_rank;
		if (ad2460.scores.wins==0)	{
			rankValue=0;
		}
		else {
			rankValue=Math.round(ad2460.scores.wins*100/(ad2460.scores.wins+ad2460.scores.losses));
		}

	}
	else if (id=='launched_scouts_rank'){
		rankNumber=ad2460.scores.launched_scouts_rank;
		rankValue=ad2460.scores.launched_scouts;
	}
	else if (id=='espionage_missions_rank'){
		rankNumber=ad2460.scores.espionage_missions_rank;
		rankValue=ad2460.scores.espionage_missions;
	}
	else if (id=='infiltration_missions_rank'){
		rankNumber=ad2460.scores.infiltration_missions_rank;
		rankValue=ad2460.scores.infiltration_missions;
	}
	else if (id=='completed_missions_rank'){
		rankNumber=ad2460.scores.completed_missions_rank;
		rankValue=ad2460.scores.completed_missions;
	}
	else if (id=='failed_missions_rank'){
		rankNumber=ad2460.scores.failed_missions_rank;
		rankValue=ad2460.scores.failed_missions;
	}


	else if (id=='killed_strength_rank'){
		rankNumber=ad2460.scores.killed_strength_rank;
		rankValue=ad2460.scores.killed_strength;
	}
	else if (id=='launched_attacks_rank'){
		rankNumber=ad2460.scores.launched_attacks_rank;
		rankValue=ad2460.scores.launched_attacks;
	}
	else if (id=='longest_win_streak_rank'){
		rankNumber=ad2460.scores.longest_win_streak_rank;
		rankValue=ad2460.scores.longest_win_streak;
	}
	else if (id=='win_streak_rank'){
		rankNumber=ad2460.scores.win_streak_rank;
		rankValue=ad2460.scores.win_streak;
	}
	else if (id=='wargames_won_rank'){
		rankNumber=ad2460.scores.wargames_won_rank;
		rankValue=ad2460.scores.wargames_won;
	}
	else if (id=='bounty_claimed_rank'){
		rankNumber=ad2460.scores.bounty_claimed_rank;
		rankValue=ad2460.scores.bounty_claimed;
	}
	else if (id=='paid_2_win_rank'){
		rankNumber=ad2460.scores.paid_2_win_rank;
		rankValue=ad2460.scores.paid_2_win;
	}
	else if (id=='lost_strength_rank'){
		rankNumber=ad2460.scores.lost_strength_rank;
		rankValue=ad2460.scores.lost_strength;
	}
	else if (id=='millions_resources_stolen_rank'){
		rankNumber=ad2460.scores.millions_resources_stolen_rank;
		rankValue=ad2460.scores.millions_resources_stolen;
	}
	else if (id=='tactical_victories_rank'){
		rankNumber=ad2460.scores.tactical_victories_rank;
		rankValue=ad2460.scores.tactical_victories;
	}
	else if (id=='underdog_wins_rank'){
		rankNumber=ad2460.scores.underdog_wins_rank;
		rankValue=ad2460.scores.underdog_wins;
	}
	else if (id=='wins_where_both_above_25k_rank'){
		rankNumber=ad2460.scores.wins_where_both_above_25k_rank;
		rankValue=ad2460.scores.wins_where_both_above_25k;
	}
	else if (id=='wins_where_both_above_100k_rank'){
		rankNumber=ad2460.scores.wins_where_both_above_100k_rank;
		rankValue=ad2460.scores.wins_where_both_above_100k;
	}
	else if (id=='wins_where_both_above_250k_rank'){
		rankNumber=ad2460.scores.wins_where_both_above_250k_rank;
		rankValue=ad2460.scores.wins_where_both_above_250k;
	}
	else if (id=='wins_where_both_above_500k_rank'){
		rankNumber=ad2460.scores.wins_where_both_above_500k_rank;
		rankValue=ad2460.scores.wins_where_both_above_500k;
	}

	else if (id=='alliance_score_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.score_rank;
			rankValue=ad2460.allianceData.score;
		}
		else {
			rankNumber='--';
			rankValue='--';
		}
	}
	else if (id=='alliance_strength_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.strength_rank;
			rankValue=ad2460.allianceData.strength;
		}
		else {
			rankNumber='--';
			rankValue='--';
		}

	}
	else if (id=='alliance_xp_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.xp_rank;
			rankValue=ad2460.allianceData.xp;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_millions_resources_stolen_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.millions_resources_stolen_rank;
			rankValue=ad2460.allianceData.millions_resources_stolen;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_tactical_victories_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.tactical_victories_rank;
			rankValue=ad2460.allianceData.tactical_victories;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_killed_strength_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.killed_strength_rank;
			rankValue=ad2460.allianceData.killed_strength;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_lost_strength_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.lost_strength_rank;
			rankValue=ad2460.allianceData.lost_strength;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_wins_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.wins_rank;
			rankValue=ad2460.allianceData.wins;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_losses_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.losses_rank;
			rankValue=ad2460.allianceData.losses;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_launched_attacks_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.launched_attacks_rank;
			rankValue=ad2460.allianceData.launched_attacks;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_incoming_attacks_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.incoming_attacks_rank;
			rankValue=ad2460.allianceData.incoming_attacks;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_longest_win_streak_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.longest_win_streak_rank;
			rankValue=ad2460.allianceData.longest_win_streak;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_bank_attack_wins_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.bank_attack_wins_rank;
			rankValue=ad2460.allianceData.bank_attack_wins;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_bank_attack_losses_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.bank_attack_losses_rank;
			rankValue=ad2460.allianceData.bank_attack_losses;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_bank_defense_wins_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.bank_defense_wins_rank;
			rankValue=ad2460.allianceData.bank_defense_wins;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_bank_defense_losses_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.bank_defense_losses_rank;
			rankValue=ad2460.allianceData.bank_defense_losses;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_op_attacks_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.op_attacks_rank;
			rankValue=ad2460.allianceData.op_attacks;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_hw_attacks_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.hw_attacks_rank;
			rankValue=ad2460.allianceData.hw_attacks;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_avg_memeber_strength_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.avg_memeber_strength_rank;
			rankValue=ad2460.allianceData.avg_memeber_strength;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_avg_memeber_score_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.avg_memeber_score_rank;
			rankValue=ad2460.allianceData.avg_memeber_score;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_avg_memeber_xp_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.avg_memeber_xp_rank;
			rankValue=ad2460.allianceData.avg_memeber_xp;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}
	else if (id=='alliance_top_ten_avg_memeber_strength_rank'){
		if (ad2460.allianceData.id>0){
			rankNumber=ad2460.allianceData.top_ten_avg_memeber_strength_rank;
			rankValue=ad2460.allianceData.top_ten_avg_memeber_strength;
		}
		else {	rankNumber='--'; 	rankValue='--';		}
	}

	//console.log(id, rankNumber, rankValue );

/*
		$return_string.="addRankingList('alliance_score_rank','Top Score', $time, 'a');";
		$return_string.="addRankingList('alliance_strength_rank','Top Strength', $time, 'a');";
		$return_string.="addRankingList('alliance_xp_rank','Top XP', $time, 'a');";
*/


	document.getElementById('own_rank_number').innerHTML=''+rankNumber;
	document.getElementById('own_rank_value').innerHTML=prettyPrint(rankValue);

}

function selectPlayerRankinglist(id){
	myScrollToTop('rank_listing_slide',0);
	removeChildNodes('rank_listing_slide');
	document.getElementById('own_rank_name').innerHTML=ad2460.scores.nickname;
	// renderOwnRankingRank(id);
	var container=document.getElementById('rank_listing_slide');

	var i=0;
	var x=0;
	for (i=0;i<ad2460.rankingLists.length ;i++ ){
		if (ad2460.rankingLists[i].id==id)	{
			document.getElementById('selected_ranking_list_header').innerHTML=ad2460.rankingLists[i].name;
			$("#ranking_description").html(ad2460.rankingLists[i].description);
			var ranking=ad2460.rankingLists[i];
			for (x=0;x<ranking.entries.length ;x++ ){
				var thisEntry=ranking.entries[x];
				if (x==0){
					//console.log(thisEntry);
					// special rendering of #1
					var div1=document.createElement('div');
					div1.setAttribute('class','rank_line_container');
					//div1.setAttribute('onclick','zoomInToXY('+thisEntry.x+','+thisEntry.y+')');
					div1.setAttribute('onclick','loadPlayerInfo('+thisEntry.user_id+')');

					var topimg=document.createElement('img');
					topimg.setAttribute('class','top_rank_img');
					topimg.src='images/icons/adcrown.png';

					var div2=document.createElement('div');
					div2.setAttribute('class','top_rank_name_value');

					var span1=document.createElement('div');
					span1.setAttribute('class','top_rank_name');
					span1.innerHTML=thisEntry.name;

					var span2=document.createElement('div');
					span2.setAttribute('class','top_rank_alliance');
					if (thisEntry.aname!=""){
						span2.innerHTML='('+thisEntry.aname+')';
					}
					else {
						span2.innerHTML=' ';
					}


					var span3=document.createElement('div');
					span3.setAttribute('class','top_rank_value');
					span3.innerHTML=prettyPrint(Math.round(thisEntry.value));

					div2.appendChild(span1);
					div2.appendChild(span2);
					div2.appendChild(span3);

					div1.appendChild(topimg);
					div1.appendChild(div2);

					container.appendChild(div1);
				}
				else {
					// normal rendering


					var div1=document.createElement('div');
					div1.setAttribute('class','rank_line_container');
					div1.setAttribute('onclick','loadPlayerInfo('+thisEntry.user_id+')');

					var diff=thisEntry.m_rank-thisEntry.rank;
					var imgsrc='images/icons/blank.gif';
					if (diff<0)	{
						imgsrc='images/fixed/downqueue.png';
					}
					if (diff>0)	{
						imgsrc='images/fixed/upqueue.png';
					}

					diff=Math.abs(diff);


					var div2=document.createElement('div');
					div2.setAttribute('class','number_rank p_rank');
					div2.innerHTML=thisEntry.rank;

					var div2b=document.createElement('div');
					div2b.setAttribute('class','change_rank p_rank');
					if (diff!=0){
						diff='<img class="rank_change_arrow" src="'+imgsrc+'"><span class="rank_change_number">'+diff+'</span>';
						div2b.innerHTML=diff;
					}
					else {
						div2b.innerHTML='-';
					}


					var thisClass='rank_line_name p_rank';
					if (thisEntry.x==ad2460.homeworld.x && thisEntry.y==ad2460.homeworld.y){
						thisClass='rank_line_name selfranking  p_rank';
					}

					var div3=document.createElement('div');
					div3.setAttribute('class',thisClass);
					div3.innerHTML=thisEntry.name;

					var div4=document.createElement('div');
					div4.setAttribute('class','rank_line_alliance p_rank');
					if (thisEntry.aname!=""){
						div4.innerHTML='('+thisEntry.aname+')';
					}
					else {
						div4.innerHTML=' ';
					}


					var div5=document.createElement('div');
					div5.setAttribute('class','rank_line_value p_rank');
					div5.innerHTML=prettyPrint(Math.round(thisEntry.value));

					div1.appendChild(div2);
					div1.appendChild(div2b);
					div1.appendChild(div3);
					div1.appendChild(div4);
					div1.appendChild(div5);
					container.appendChild(div1);

					if (x==99 && x<ranking.entries.length-1 ){
						var div1=document.createElement('div');
						div1.setAttribute('class','rank_line_container p_rank');

						var div2=document.createElement('div');
						div2.setAttribute('class','number_rank p_rank');

						var div2b=document.createElement('div');
						div2b.setAttribute('class','number_rank p_rank');
						div2.innerHTML=' ';


						var div3=document.createElement('div');
						div3.setAttribute('class','rank_line_name p_rank');

						var div4=document.createElement('div');
						div4.setAttribute('class','rank_line_alliance p_rank');
						div4.style.color="#FFFFFF";
						div4.innerHTML="Near you";


						var div5=document.createElement('div');
						div5.setAttribute('class','rank_line_value p_rank');

						div1.appendChild(div2);
						div1.appendChild(div2b);
						div1.appendChild(div3);
						div1.appendChild(div4);
						div1.appendChild(div5);
						container.appendChild(div1);



					}

				}
				if (thisEntry.user_id==ad2460.user_id){
					$("#own_rank_number").html(thisEntry.rank);
					$("#own_rank_name").html(thisEntry.name);
					$("#own_rank_value").html(thisEntry.value);


				}
			}
		}
	}

	checkScrollButtonStatus('rank_category_slide');
	checkScrollButtonStatus('rank_listing_slide');

}

function selectAllianceRankinglist(id){
	myScrollToTop('rank_listing_slide',0);
	removeChildNodes('rank_listing_slide');
	renderOwnRankingRank(id);
	var container=document.getElementById('rank_listing_slide');

	var i=0;
	var x=0;
	for (i=0;i<ad2460.rankingLists.length ;i++ ){
		if (ad2460.rankingLists[i].id==id)	{
			document.getElementById('selected_ranking_list_header').innerHTML=ad2460.rankingLists[i].name;
			$("#ranking_description").html(ad2460.rankingLists[i].description);
			var ranking=ad2460.rankingLists[i];
			for (x=0;x<ranking.entries.length ;x++ ){
				var thisEntry=ranking.entries[x];
				if (x==0){
					//console.log(thisEntry);
					// special rendering of #1
					var div1=document.createElement('div');
					div1.setAttribute('class','rank_line_container');
					div1.setAttribute('onclick','loadAllianceInfo('+thisEntry.aid+')');

					var topimg=document.createElement('img');
					topimg.setAttribute('class','top_rank_img');
					topimg.src='images/icons/adcrown.png';

					var div2=document.createElement('div');
					div2.setAttribute('class','top_rank_name_value');

					var span1=document.createElement('div');
					span1.setAttribute('class','top_rank_name');
					span1.innerHTML=thisEntry.aname;

					// Unsure what to do here tbh...
					var span2=document.createElement('div');
					span2.setAttribute('class','top_rank_alliance');
					span2.innerHTML=' ';

					var span3=document.createElement('div');
					span3.setAttribute('class','top_rank_value');
					span3.innerHTML=prettyPrint(Math.round(thisEntry.value));

					div2.appendChild(span1);
					div2.appendChild(span2);
					div2.appendChild(span3);

					div1.appendChild(topimg);
					div1.appendChild(div2);

					container.appendChild(div1);

				}
				else {
					// normal rendering
					var div1=document.createElement('div');
					div1.setAttribute('class','rank_line_container');
					div1.setAttribute('onclick','loadAllianceInfo('+thisEntry.aid+')');

					var div2=document.createElement('div');
					div2.setAttribute('class','number_rank');
					div2.innerHTML=thisEntry.rank;

					var div2b=document.createElement('div');
					div2b.setAttribute('class','change_rank');

					var div3=document.createElement('div');
					div3.setAttribute('class','rank_line_name');
					div3.innerHTML=thisEntry.aname;

					var div4=document.createElement('div');
					div4.setAttribute('class','rank_line_alliance');
					div4.innerHTML=' ';

					var div5=document.createElement('div');
					div5.setAttribute('class','rank_line_value');
					div5.innerHTML=prettyPrint(Math.round(thisEntry.value));

					div1.appendChild(div2);
					div1.appendChild(div2b);
					div1.appendChild(div3);
					div1.appendChild(div4);
					div1.appendChild(div5);
					container.appendChild(div1);
				}
			}
		}
	}

	checkScrollButtonStatus('rank_category_slide');
	checkScrollButtonStatus('rank_listing_slide');


}

function rankingSlideOpened(){
	// callback-function in case we want to optimize elements on the page
	// called after the animation that shows the panel
	checkScrollButtonStatus('rank_category_slide');
	checkScrollButtonStatus('rank_listing_slide');

}
function rankingSlideClosed(){
	// callback-function in case we want to optimize elements on the page
	// called after the animation that hides the panel

}

function updateStarmapIntelTimes(){
	var bonus=returnSpyTimeBonusPercent();

	var scoutTime=ad2460.statics.scout_time-(Math.floor(ad2460.statics.scout_time*bonus/100));
	var espionageTime=ad2460.statics.espionage_time-(Math.floor(ad2460.statics.espionage_time*bonus/100));
	var infiltrationTime=ad2460.statics.infiltration_time-(Math.floor(ad2460.statics.infiltration_time*bonus/100));

	$("#sm_spypanel_scout_time").html(secondsToFullTime(scoutTime));
	$("#sm_spypanel_espionage_time").html(secondsToFullTime(espionageTime));
	$("#sm_spypanel_infiltration_time").html(secondsToFullTime(infiltrationTime));

}

function updateServerTime(){
	var tmp=new Date;
	var timestring=formatShortTime(ad2460.serverTime+(tmp.getTimezoneOffset()*60));
	$("#servertime").html(timestring);
}

function reRenderRecentThreads(){
	renderLatestAllianceThreads();
	renderLatestThreads();
	// renderLatestConversations();
}

function logout(){
	$.post('actionhandler.pl', {action:'logout'}, function(data){
		parseInfo(data);

		try {
			win.close();
		}
		catch(err) {
			// do nothing
		}
	});
}

function renderEconomyOverview(){
	var res=returnHomeworldResourceExtraction();

	$("#eco_hw_prod_h").html(prettyPrint(res.hassium));
	$("#eco_hw_prod_i").html(prettyPrint(res.indium));
	$("#eco_hw_prod_s").html(prettyPrint(res.strontium));
	$("#eco_hw_prod_n").html(prettyPrint(res.neodymium));

	var outpost_output={h:0, i:0, s:0, n:0};
	var i=0;
	for (i=0;i<ad2460.outposts.length ;i++ ){
		if (ad2460.outposts[i].inactive==0){
			outpost_output.h+=ad2460.outposts[i].current_output_hassium;
			outpost_output.i+=ad2460.outposts[i].current_output_indium;
			outpost_output.s+=ad2460.outposts[i].current_output_strontium;
			outpost_output.n+=ad2460.outposts[i].current_output_neodymium;
		}
	}

	// Add support for the new OP-mining-bonus from controlling sectors
	if (ad2460.allianceData.id>0){
		a_bonus_percent=ad2460.allianceData.sectorBonuses.outpost_mining;
		outpost_output.h+=(Math.floor(outpost_output.h*a_bonus_percent/100));
		outpost_output.i+=(Math.floor(outpost_output.i*a_bonus_percent/100));
		outpost_output.s+=(Math.floor(outpost_output.s*a_bonus_percent/100));
		outpost_output.n+=(Math.floor(outpost_output.n*a_bonus_percent/100));
	}

	$("#eco_op_prod_h").html(prettyPrint(outpost_output.h));
	$("#eco_op_prod_i").html(prettyPrint(outpost_output.i));
	$("#eco_op_prod_s").html(prettyPrint(outpost_output.s));
	$("#eco_op_prod_n").html(prettyPrint(outpost_output.n));

	var tax_in={h:0, i:0, s:0, n:0};
	if (ad2460.allianceData.id>0){
		tax_in.h=Math.round(ad2460.allianceData.avg_tax_received.hassium/24);
		tax_in.i=Math.round(ad2460.allianceData.avg_tax_received.indium/24);
		tax_in.s=Math.round(ad2460.allianceData.avg_tax_received.strontium/24);
		tax_in.n=Math.round(ad2460.allianceData.avg_tax_received.neodymium/24);
	}

	$("#eco_tax_rec_h").html(prettyPrint(tax_in.h));
	$("#eco_tax_rec_i").html(prettyPrint(tax_in.i));
	$("#eco_tax_rec_s").html(prettyPrint(tax_in.s));
	$("#eco_tax_rec_n").html(prettyPrint(tax_in.n));

	var fleet_upkeep={h:0, i:0, s:0, n:0};
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		fleet_upkeep.h+=ad2460.myFleets[i].upkeep.hassium;
		fleet_upkeep.i+=ad2460.myFleets[i].upkeep.indium;
		fleet_upkeep.s+=ad2460.myFleets[i].upkeep.strontium;
		fleet_upkeep.n+=ad2460.myFleets[i].upkeep.neodymium;
	}
	$("#eco_flt_up_h").html(prettyPrint(fleet_upkeep.h));
	$("#eco_flt_up_i").html(prettyPrint(fleet_upkeep.i));
	$("#eco_flt_up_s").html(prettyPrint(fleet_upkeep.s));
	$("#eco_flt_up_n").html(prettyPrint(fleet_upkeep.n));

	var alliance_upkeep={h:0, i:0, s:0, n:0};
	if (ad2460.allianceData.id>0){
		alliance_upkeep.h=Math.round(ad2460.allianceData.avg_alliance_upkeep_paid.hassium/24);
		alliance_upkeep.i=Math.round(ad2460.allianceData.avg_alliance_upkeep_paid.indium/24);
		alliance_upkeep.s=Math.round(ad2460.allianceData.avg_alliance_upkeep_paid.strontium/24);
		alliance_upkeep.n=Math.round(ad2460.allianceData.avg_alliance_upkeep_paid.neodymium/24);
	}

	$("#eco_all_up_h").html(prettyPrint(alliance_upkeep.h));
	$("#eco_all_up_i").html(prettyPrint(alliance_upkeep.i));
	$("#eco_all_up_s").html(prettyPrint(alliance_upkeep.s));
	$("#eco_all_up_n").html(prettyPrint(alliance_upkeep.n));

	var tax_out={h:0, i:0, s:0, n:0};

	if (ad2460.allianceData.id>0){
		tax_out.h=Math.round(ad2460.allianceData.avg_tax_paid.hassium/24);
		tax_out.i=Math.round(ad2460.allianceData.avg_tax_paid.indium/24);
		tax_out.s=Math.round(ad2460.allianceData.avg_tax_paid.strontium/24);
		tax_out.n=Math.round(ad2460.allianceData.avg_tax_paid.neodymium/24);
	}

	$("#eco_tax_paid_h").html(prettyPrint(tax_out.h));
	$("#eco_tax_paid_i").html(prettyPrint(tax_out.i));
	$("#eco_tax_paid_s").html(prettyPrint(tax_out.s));
	$("#eco_tax_paid_n").html(prettyPrint(tax_out.n));

	var balance={h:0, i:0, s:0, n:0};
	balance.h=res.hassium+outpost_output.h+tax_in.h-fleet_upkeep.h-alliance_upkeep.h-tax_out.h;
	balance.i=res.indium+outpost_output.i+tax_in.i-fleet_upkeep.i-alliance_upkeep.i-tax_out.i;
	balance.s=res.strontium+outpost_output.s+tax_in.s-fleet_upkeep.s-alliance_upkeep.s-tax_out.s;
	balance.n=res.neodymium+outpost_output.n+tax_in.n-fleet_upkeep.n-alliance_upkeep.n-tax_out.n;

	$("#eco_balance_h").html(prettyPrint(balance.h));
	$("#eco_balance_i").html(prettyPrint(balance.i));
	$("#eco_balance_s").html(prettyPrint(balance.s));
	$("#eco_balance_n").html(prettyPrint(balance.n));

	$("#eco_upkeep_debt_h").html(prettyPrint(ad2460.upkeep_debt.hassium));
	$("#eco_upkeep_debt_i").html(prettyPrint(ad2460.upkeep_debt.indium));
	$("#eco_upkeep_debt_s").html(prettyPrint(ad2460.upkeep_debt.strontium));
	$("#eco_upkeep_debt_n").html(prettyPrint(ad2460.upkeep_debt.neodymium));

	renderEconomyBonusPercentages();
}

function renderEconomyBonusPercentages(){
	var prodCostBonus=0;
	var resCostBonus=0;
	var devCostBonus=0;

	var facCostBonus=0;

	var allianceUpkeepBonus=0;
	var upkeepBonus=0;
	var vaultSize=25000;
	var prodSpeedBonus=0;

	var hwMiningBonus=0;

	var o=returnGameObjectById(354);
	if (o.user_id>0 && o.upgrading<1){
		upkeepBonus+=5;
	}
	var o=returnGameObjectById(132);
	if (o.user_id>0 && o.upgrading<1){
		upkeepBonus+=3;
	}
	var o=returnGameObjectById(152);
	if (o.user_id>0 && o.upgrading<1){
		upkeepBonus+=3;
	}
	var o=returnGameObjectById(172);
	if (o.user_id>0 && o.upgrading<1){
		upkeepBonus+=3;
	}
	var o=returnGameObjectById(181);
	if (o.user_id>0 && o.upgrading<1){
		upkeepBonus+=2;
	}


	$("#eco_bonus_upkeep").html(upkeepBonus+' %');

	if (ad2460.scores.level>=6){	prodSpeedBonus+=5;	}
	if (ad2460.scores.level>=8){	prodSpeedBonus+=5;	}
	if (ad2460.scores.level>=10){	prodSpeedBonus+=5;	}
	if (ad2460.scores.level>=12){	prodSpeedBonus+=5;	}
	if (ad2460.scores.level>=14){	prodSpeedBonus+=5;	}
	if (ad2460.scores.level>=16){	prodSpeedBonus+=5;	}
	if (ad2460.scores.level>=18){	prodSpeedBonus+=5;	}
	if (ad2460.scores.level>=20){	prodSpeedBonus+=5;	}

	var o=returnGameObjectById(800);
	prodSpeedBonus+=o.points;

	var o=returnGameObjectById(803);
	prodSpeedBonus+=o.points;

	var o=returnGameObjectById(806);
	prodSpeedBonus+=o.points;

	var o=returnGameObjectById(183);
	if (o.user_id>0 && o.upgrading<1){
		prodSpeedBonus+=5;
	}
	var o=returnGameObjectById(193);
	if (o.user_id>0 && o.upgrading<1){
		prodSpeedBonus+=15;
	}
	var o=returnGameObjectById(360);
	if (o.user_id>0 && o.upgrading<1){
		prodSpeedBonus+=5;
	}

	var bestProdBonus=prodSpeedBonus;
	var o=returnGameObjectById(822);
	bestProdBonus+=(o.points*5);
	var o=returnGameObjectById(825);
	bestProdBonus+=(o.points*5);
	var o=returnGameObjectById(828);
	bestProdBonus+=(o.points*5);

	var vip_string="";
	if (ad2460.vip_status>ad2460.serverTime){
		vip_string="VIP + ";
	}

	if (prodSpeedBonus>90){
		prodSpeedBonus=90;
	}
	if (bestProdBonus>90){
		bestProdBonus=90;
	}

	$("#eco_bonus_production_speed").html(vip_string + prodSpeedBonus+' %' +' ('+bestProdBonus+' %)');


	var r=returnGameObjectById(188);
	if (r){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			prodCostBonus+=2;
		}
	}
	var r=returnGameObjectById(353);
	if (r){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			prodCostBonus+=5;
		}
	}

	$("#eco_bonus_prodcost").html(prodCostBonus+' %');


	var r=returnGameObjectById(101);
	if (r){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			hwMiningBonus+=10;
		}
	}
	var r=returnGameObjectById(116);
	if (r){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			hwMiningBonus+=10;
		}
	}
	var o=returnGameObjectById(831);
	hwMiningBonus+=o.points*20;

	var o=returnGameObjectById(834);
	hwMiningBonus+=o.points*20;

	var o=returnGameObjectById(837);
	hwMiningBonus+=o.points*20;
	/*
		101: 10%
		116 : 10%
		831 834 837 : +20% per point
	*/

	$("#eco_bonus_hw_mining").html(hwMiningBonus+' %');

	var obj=returnGameObjectById(614);
	if (obj!=false){
		if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 && ad2460.allianceData.memberlist.length>=5 ){
			resCostBonus+=5;
		}
	}

	var obj=returnGameObjectById(615);
	if (obj!=false){
		if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 && ad2460.allianceData.memberlist.length>=10 ){
			resCostBonus+=5;
		}
	}

	var obj=returnGameObjectById(616);
	if (obj!=false){
		if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 && ad2460.allianceData.memberlist.length>=15 ){
			resCostBonus+=5;
		}
	}

	var r=returnGameObjectById(103);
	if (r){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			resCostBonus+=5;
		}
	}

	$("#eco_bonus_rescost").html(resCostBonus+' %');


	var r=returnGameObjectById(352);
	if (r!=false){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			devCostBonus+=5;
		}
	}
	var r=returnGameObjectById(104);
	if (r){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			devCostBonus+=5;
		}
	}


	$("#eco_bonus_devcost").html(devCostBonus+' %');

	var r=returnGameObjectById(102);
	if (r){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			facCostBonus+=5;
		}
	}

	$("#eco_bonus_faccost").html(facCostBonus+' %');


	var o=returnGameObjectById(355);
	if (o.user_id>0 && o.upgrading<1){
		allianceUpkeepBonus+=5;
	}

	var o=returnGameObjectById(356);
	if (o.user_id>0 && o.upgrading<1){
		allianceUpkeepBonus+=5;
	}

	var o=returnGameObjectById(357);
	if (o.user_id>0 && o.upgrading<1){
		allianceUpkeepBonus+=10;
	}

	var o=returnGameObjectById(190);
	if (o.user_id>0 && o.upgrading<1){
		allianceUpkeepBonus+=2;
	}

	var o=returnGameObjectById(198);
	if (o.user_id>0 && o.upgrading<1){
		allianceUpkeepBonus+=4;
	}


	var obj=returnGameObjectById(602);
	if (obj!=false){
		if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 ){
			allianceUpkeepBonus+=5;
		}
	}

	var obj=returnGameObjectById(603);
	if (obj!=false){
		if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 ){
			allianceUpkeepBonus+=5;
		}
	}

	var obj=returnGameObjectById(604);
	if (obj!=false){
		if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 ){
			allianceUpkeepBonus+=5;
		}
	}


	$("#eco_bonus_allyupkeep").html(allianceUpkeepBonus+' %');


	var o=returnGameObjectById(397);
	if (o.user_id>0 && o.upgrading<1){
		vaultSize=100000;
	}
	var o=returnGameObjectById(398);
	if (o.user_id>0 && o.upgrading<1){
		vaultSize=500000;
	}
	var o=returnGameObjectById(399);
	if (o.user_id>0 && o.upgrading<1){
		vaultSize=1500000;
	}

	$("#eco_bonus_vaultsize").html(prettyPrint(vaultSize));

	var eco_bonus_alliance_sector_hw_mining=0;
	var eco_bonus_alliance_sector_op_mining=0;

	if (ad2460.allianceData.id>0){
		eco_bonus_alliance_sector_hw_mining=ad2460.allianceData.sectorBonuses.homeworld_mining;
		eco_bonus_alliance_sector_op_mining=ad2460.allianceData.sectorBonuses.outpost_mining;
	}
	$("#eco_bonus_alliance_sector_hw_mining").html(eco_bonus_alliance_sector_hw_mining+' %');
	$("#eco_bonus_alliance_sector_op_mining").html(eco_bonus_alliance_sector_op_mining+' %');


}

function updateGraceTimer(){
	var secsLeft=ad2460.amnestyUntilTime-ad2460.serverTime;
	if (secsLeft>0){
		$("#gracetime_container").show();
		$("#grace_time_counter").html(secondsToFullTime(secsLeft));
		if (secsLeft<3600){
			window.clearInterval(grace_time_interval);
			grace_time_interval=setInterval("updateGraceTimer()" , 1000 );
		}
	}
	else {
		$("#gracetime_container").hide();
		window.clearInterval(grace_time_interval);
	}
}

function returnDetectedEventById(id){
	var i=0;
	for (i=0;i<ad2460.detected_events.length;i++){
		if (ad2460.detected_events[i].event_id==id){
			return ad2460.detected_events[i];
		}
	}
	return false;
}

function detectEvents(){
	// Disabled!
	//return;
	// Disabled!


	if (ad2460.showing_detected_events_box==false){
		var i=0;
		for (i=0;i<ad2460.detected_events.length;i++){
			if (ad2460.detected_events[i].user_id==0){  // Not triggered before
				var d=ad2460.detected_events[i];
				// 'none','facility_start','research_start','development_start','production_start',
				// 'facility_complete','research_complete','development_complete','production_complete',
				// 'panel_opening','map-navigation','mission_start','mission_fail','mission_complete'
				if (d.event_trigger_type == 'none'){
					// Fire away!
					d.user_id=ad2460.user_id;
					eval(d.trigger_function);
					return;
				}
				if (d.event_trigger_type == 'facility_start'){
					//console.log("Checking facility_start");
					var o=returnGameObjectById(d.number_param_1);
					//console.log(o);
					if (o.upgrading==1 || (o.upgrading==0 && o.user_id==ad2460.user_id)){
						d.user_id=ad2460.user_id;
						//console.log(d.trigger_function);
						eval(d.trigger_function);
						return;
					}
				}
				if (d.event_trigger_type == 'research_start'){
					var o=returnGameObjectById(d.number_param_1);
					if (o.upgrading==1 || (o.upgrading==0 && o.user_id==ad2460.user_id)){
						d.user_id=ad2460.user_id;
						eval(d.trigger_function);
						return;
					}
				}
				if (d.event_trigger_type == 'development_start'){
					var o=returnGameObjectById(d.number_param_1);
					if (o.upgrading==1 || (o.upgrading==0 && o.user_id==ad2460.user_id)){
						d.user_id=ad2460.user_id;
						eval(d.trigger_function);
						return;
					}
				}
				if (d.event_trigger_type == 'production_start'){
					// check productionqueue
					var a=0;
					for (a=0;a<ad2460.productionqueue.length ;a++ )	{
						if (ad2460.productionqueue[a].id==d.number_param_1){
							d.user_id=ad2460.user_id;
							eval(d.trigger_function);
							return;
						}
					}
				}
				if (d.event_trigger_type == 'production_complete'){
					// check reserves // base-fleet
					var ship_type_id=d.number_param_1;
					var foundUnit=false;
					if (ship_type_id<=410 || ship_type_id==430 || ship_type_id==431){
						var fleet=returnStorageFleet();
						for (var a=0;a<fleet.storage.length ;a++ ){
							if (fleet.storage[a].ship_type_id==ship_type_id){
								if (fleet.storage[a].counter>0){
									foundUnit=true;
								}
							}
						}
					}
					else {
						var fleet=returnBaseFleet();
						for (var a=0;a<fleet.ships.length ;a++ ){
							if (fleet.ships[a].ship_type_id==ship_type_id){
								foundUnit=true;
							}
						}
					}

					if (foundUnit==true){
						d.user_id=ad2460.user_id;
						eval(d.trigger_function);
						return;
					}
				} // end production_end
				if (d.event_trigger_type == 'facility_complete'){
					var o=returnGameElementById(d.number_param_1);
					if (o.user_id==ad2460.user_id && o.upgrading==0){
						d.user_id=ad2460.user_id;
						eval(d.trigger_function);
						return;
					}
				}
				if (d.event_trigger_type == 'research_complete'){
					var o=returnGameElementById(d.number_param_1);
					if (o.user_id==ad2460.user_id && o.upgrading==0){
						d.user_id=ad2460.user_id;
						eval(d.trigger_function);
						return;
					}
				}
				if (d.event_trigger_type == 'development_complete'){
					var o=returnGameElementById(d.number_param_1);
					if (o.user_id==ad2460.user_id && o.upgrading==0){
						d.user_id=ad2460.user_id;
						eval(d.trigger_function);
						return;
					}
				}
				if (d.event_trigger_type == 'map-navigation'){
					var coords=d.string_param_1.split(':');
					var found=false;
					if (coords.length==1){
						if (ad2460.starmap.quadrantSquare==coords[0]){
							found=true;
						}
					}
					if (coords.length==2){
						if (ad2460.starmap.quadrantSquare==coords[0] && ad2460.starmap.sectorSquare==coords[1]){
							found=true;
						}
					}
					if (coords.length==3){
						if (ad2460.starmap.quadrantSquare==coords[0] && ad2460.starmap.sectorSquare==coords[1] && ad2460.starmap.clusterSquare==coords[2]){
							found=true;
						}
					}
					if (coords.length==4){
						if (ad2460.starmap.quadrantSquare==coords[0] && ad2460.starmap.sectorSquare==coords[1] && ad2460.starmap.clusterSquare==coords[2] && ad2460.starmap.systemSquare==coords[3]){
							found=true;
						}
					}
					if (coords.length==5){
						if (ad2460.starmap.quadrantSquare==coords[0] && ad2460.starmap.sectorSquare==coords[1] && ad2460.starmap.clusterSquare==coords[2] && ad2460.starmap.systemSquare==coords[3] && ad2460.starmap.systemViewVars.currentPlanetSelect==coords[4]){
							found=true;
						}
					}

					if (found==true){
						d.user_id=ad2460.user_id;
						eval(d.trigger_function);
						return;
					}
				} // end map-navigation-detection
			}
		}
	}

}

function loadDetectedEvents(){
	$.post('actionhandler.pl', {action:'select_detectable_events'}, function(data){ parseInfo(data)});
}


function showDetectedEventsMessage(id){
	if (ad2460.show_detected_events==false || ad2460.showing_detected_events_box==true){
		return;
	}

	$.post('actionhandler.pl', {action:'mark_detected_event',event_id:id}, function(data){ parseInfo(data)});

	var string="";



	if (id==1){
		string="Welcome to AD2460!"+"<br>";
		string+="You can find the Main Menu in the top left corner of the screen. Then there are other screens that you can open or close by clicking the buttons along the bottom of the screen.";
		string+="We recommend you check out the tutorial as well. If the GUI seems hard to understand, the button with a '?' is always there to help you."+"<br>";
		string+="So, lets get down to it. The first thing you should do, to improve your economy, is build a Facility-addon."+"<br>";
		string+="Open the Facilities-panel, click on Refinery, then click on Hassium Refinery. Then click the BUILD-button."+"<br>";
		string+="When you have done that, click the OK-button below.";
	}

	else if (id==2){
		string="Very good! Your Hassium-refinery add-on will boost your income of Hassium, which you will need!";
		string="It will be ready in about 60 minutes."+"<br>";
		string+="Next, we will initiate your first Research."+"<br>";
		string+="This research is one of the things you need to be able to build Planetary Defensive System (PDS) for use in space surrounding your homeworld."+"<br>";
		string+="So go ahead and open the Research-panel and initiate the research called Improved Gunnery."+"<br>";
		string+="When you have done that, click the OK-button below.";
	}

	else if (id==3){
		string="Excellent, it will be ready in about 30 minutes."+" ";
		string+="Meanwhile, we will initiate your first Development."+"<br>";
		string+="Development is turning research and theory into producable things, like ships."+"<br>";
		string+="To get your economy and your expansion started, you will need to build something called Outposts, and first we need to develop this concept."+"<br>";
		string+="Open your development-panel and start the development called Standard Outpost."+"<br>";
		string+="When you have done that, click the OK-button below.";
	}
	else if (id==4){
		string="Good job! Now you know how to build, research and develop."+" ";
		string+="Now you will order your first producable unit in the game, a special ship called a Prospector."+"<br>";
		string+="Before we proceed you need to know that the Galaxy is split into 16 quadrants. A quadrant is split into 16 sectors, and each of those is split into 16 clusters And each cluster contains 16 solar systems."+"<br>";
		string+="The Prospector is not a combat-unit but a ship that can scan a whole cluster and reveal which planets are suitable for mining, what kind of resources they contain and how good it is. "+"<br>";
		string+="Open your Production-panel, and order 1 prospector."+" ";
		string+="When you have done that, click the OK-button below.";
	}
	else if (id==5){
		string="Perfect! It should be ready in a few minutes."+"<br>";
		string+="While we wait, you should take the time visit the different sections of the game."+"<br>";
		string+="We strongly advice against using more resources at this point, as you will soon need them to build your first Outpost."+"<br>";
		string+="When your prospector is ready, the tutorial will continue."+"<br><br>";
		string+="Click the OK-button below now please.";
	}
	else if (id==6){
		string="Your prospecting-ship is now ready."+"<br>";
		string+="You will use it to survey which planets are best suited for mining in your own Cluster."+"<br>";
		string+="Click on the STARMAP-button, then the HOME-button, and then click the grey big C at the top right to zoom out to the Cluster-view."+"<br>";
		string+="Finally, click the Prospect Now button. This will take a while. When it has completed, you can browse all the 16 systems in your home-cluster to look for the best locations for your Outposts!"+"<br><br>";
		string+="Click the OK-button below now please.";
	}
	string+="<br><br><span onclick='disableEventDetection()'>Click HERE to turn this help off. (Re-enable from Options)</span>";
	showDetectedEventsBox(string,id);
}

function showDetectedEventsBox(string,id){
	ad2460.showing_detected_events_box=true;
	$("#d_e_main_text").html(string);
	$("#detected_event_box").show();
}

function hideDetectedEventsBox(){
	$("#detected_event_box").hide();
	ad2460.showing_detected_events_box=false;
	detectEvents();
}
function goToSleep(){
	var mainText="This button will make you go to sleep, for real. Are you sure you wish to fall asleep now?";
	var okText=translations.general_yes;
	var cancelText=translations.general_no;
	var okClick='hideConfirmationPopup();startSleeping();';
	var cancelClick='hideConfirmationPopup();';
	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick);
}

function startSleeping(){
	$('#main_bg').stop().animate({
		opacity: 0
		}, {
		duration: 10000
	}).animate( { opacity: 1 }, 1000);
}

function setAmnestyUntilTime(timestamp){
	ad2460.amnestyUntilTime=timestamp;
	updateGraceTimer();

}

function cancelGraceTimeClick(){
	var mainText="Players in grace or in amnesty can not be attacked and can not attack others. Are you sure you wish to cancel your protection now?";
	var okText=translations.general_yes;
	var cancelText=translations.general_no;
	var okClick='confirmedCancelGracetime();hideConfirmationPopup();';
	var cancelClick='hideConfirmationPopup();';

	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick);
}

function confirmedCancelGracetime(){
	$.post('actionhandler.pl', {action:'cancel_amnesty'}, function(data){ parseInfo(data);});
}

// MISSION RELATED LOGIC

function updateMissionPack(pack_id, pack_name, pack_description, pack_level, pack_image, mission_counter, pack_cost, pack_type, required_level, required_admin, user_id, purchase_timestamp){
	var found=false;
	for (var i=0;i<ad2460.missionPacks.length ;i++ ){
		if (ad2460.missionPacks[i].pack_id==pack_id){
			found=true;
			// update
			var thisPack=ad2460.missionPacks[i];
			thisPack.pack_id=pack_id;
			thisPack.pack_name=pack_name;
			thisPack.pack_description=pack_description;
			thisPack.pack_level=pack_level;
			thisPack.pack_image=pack_image;
			thisPack.mission_counter=mission_counter;
			thisPack.pack_cost=pack_cost;
			thisPack.pack_type=pack_type;
			thisPack.required_level=required_level;
			thisPack.required_admin=required_admin;

			thisPack.user_id=user_id;
			thisPack.purchase_timestamp=purchase_timestamp;


		}
	}
	if (found==false){
		ad2460.missionPacks.push(new missionPack(pack_id, pack_name, pack_description, pack_level, pack_image, mission_counter, pack_cost, pack_type, required_level, required_admin, user_id, purchase_timestamp));
	}

}


function updateMission(mission_id, pack_id, mission_name, mission_description, required_advancement_level, type, minimum_firepower, essential_ships_string, difficult_rating, must_own_unit_id, required_specific_ship_id_1, required_specific_ship_id_1_counter, required_cargo_capacity, required_combat_fighters, required_combat_corvettes, required_combat_frigates, required_combat_cruisers, required_combat_battleships, required_combat_carriers, required_prospectors, required_scouts, required_spies, required_infiltrators, minimum_commander_rank, repeatable, reward_ship_type_id_1, reward_ship_type_id_1_count, reward_ship_type_id_2, reward_ship_type_id_2_count, reward_ship_type_id_3, reward_ship_type_id_3_count, reward_ship_type_id_4, reward_ship_type_id_4_count, reward_hassium, reward_indium, reward_strontium, reward_neodymium, opponent_fleet_template_id, mission_complete_text, choice_option_1, choice_option_2, choice_option_3, choice_option_4, choice_option_5, mission_chapter, required_completed_mission_id, reward_xp, required_game_object_id, expected_success_result, user_id, status, failed, completed_counter, last_completed_time, last_failed_time, intel_allocation_number, choice_option_selected, mission_combat_id, entry_id, duration, repeat_delay, commander_id, commander_data, launch_time, complete_time, tactics_string, summary_string, max_strength, max_level, ranked, enabled){
	var p;
	var m;
	var foundMission=false;
	for (p=0;p<ad2460.missionPacks.length ;p++ ){
		if (ad2460.missionPacks[p].pack_id==pack_id){
			// We're in the right pack
			for (m=0;m<ad2460.missionPacks[p].missions.length ;m++ ){
				if (ad2460.missionPacks[p].missions[m].mission_id==mission_id){
					foundMission=true;
					var thisMission=ad2460.missionPacks[p].missions[m];
					thisMission.mission_id=mission_id;
					thisMission.pack_id=pack_id;
					thisMission.mission_name=mission_name;
					thisMission.mission_description=mission_description;
					thisMission.required_advancement_level=required_advancement_level;
					thisMission.type=type;
					thisMission.minimum_firepower=minimum_firepower;
					thisMission.essential_ships_string=essential_ships_string;
					thisMission.difficult_rating=difficult_rating;
					thisMission.must_own_unit_id=must_own_unit_id;
					thisMission.required_specific_ship_id_1=required_specific_ship_id_1;
					thisMission.required_specific_ship_id_1_counter=required_specific_ship_id_1_counter;
					thisMission.required_cargo_capacity=required_cargo_capacity;
					thisMission.required_combat_fighters=required_combat_fighters;
					thisMission.required_combat_corvettes=required_combat_corvettes;
					thisMission.required_combat_frigates=required_combat_frigates;
					thisMission.required_combat_cruisers=required_combat_cruisers;
					thisMission.required_combat_battleships=required_combat_battleships;
					thisMission.required_combat_carriers=required_combat_carriers;
					thisMission.required_prospectors=required_prospectors;
					thisMission.required_scouts=required_scouts;
					thisMission.required_spies=required_spies;
					thisMission.required_infiltrators=required_infiltrators;
					thisMission.minimum_commander_rank=minimum_commander_rank;
					thisMission.repeatable=repeatable;
					thisMission.reward_ship_type_id_1=reward_ship_type_id_1;
					thisMission.reward_ship_type_id_1_count=reward_ship_type_id_1_count;
					thisMission.reward_ship_type_id_2=reward_ship_type_id_2;
					thisMission.reward_ship_type_id_2_count=reward_ship_type_id_2_count;
					thisMission.reward_ship_type_id_3=reward_ship_type_id_3;
					thisMission.reward_ship_type_id_3_count=reward_ship_type_id_3_count;
					thisMission.reward_ship_type_id_4=reward_ship_type_id_4;
					thisMission.reward_ship_type_id_4_count=reward_ship_type_id_4_count;
					thisMission.reward_hassium=reward_hassium;
					thisMission.reward_indium=reward_indium;
					thisMission.reward_strontium=reward_strontium;
					thisMission.reward_neodymium=reward_neodymium;
					thisMission.opponent_fleet_template_id=opponent_fleet_template_id;
					thisMission.mission_complete_text=mission_complete_text;
					thisMission.choice_option_1=choice_option_1;
					thisMission.choice_option_2=choice_option_2;
					thisMission.choice_option_3=choice_option_3;
					thisMission.choice_option_4=choice_option_4;
					thisMission.choice_option_5=choice_option_5;
					thisMission.mission_chapter=mission_chapter;
					thisMission.required_completed_mission_id=required_completed_mission_id;
					thisMission.reward_xp=reward_xp;
					thisMission.required_game_object_id=required_game_object_id;
					thisMission.expected_success_result=expected_success_result;
					thisMission.user_id=user_id;
					thisMission.status=status;
					thisMission.failed=failed;
					thisMission.completed_counter=completed_counter;
					thisMission.last_completed_time=last_completed_time;
					thisMission.last_failed_time=last_failed_time;
					thisMission.intel_allocation_number=intel_allocation_number;
					thisMission.choice_option_selected=choice_option_selected;
					thisMission.mission_combat_id=mission_combat_id;
					thisMission.entry_id=entry_id;
					thisMission.launch_time=launch_time;
					thisMission.complete_time=complete_time;
					thisMission.duration=duration;
					thisMission.repeat_delay=repeat_delay;
					thisMission.commander_id=commander_id;
					thisMission.tactics_string=tactics_string;
					thisMission.summary_string=summary_string;
					thisMission.max_strength=max_strength;
					thisMission.max_level=max_level;
					thisMission.ranked=ranked;
					thisMission.enabled=enabled;
					if (thisMission.commander_id>0){
						// Now split the commander_data into entries...Split on :: and make damn sure you know what you get :)
						//commander_id :: owner_id :: hired :: name :: personality :: tactics :: commanding :: perception :: morale :: rank :: experience :: wins :: losses | image_id | sex  | fleet_id | missions | dead

						var commander_array=commander_data.split("::");
						thisMission.commander=false;
						if (commander_array.length>10){
							thisMission.commander=new commander(commander_array[0], commander_array[1], commander_array[2], commander_array[3], commander_array[4], commander_array[5], commander_array[6], commander_array[7], commander_array[8], commander_array[9], commander_array[10], commander_array[11], commander_array[12], commander_array[13], commander_array[14], commander_array[15], commander_array[16], commander_array[17] );
						}
					}



				}
			}
			if (foundMission==false){
				ad2460.missionPacks[p].missions.push(new mission(mission_id, pack_id, mission_name, mission_description, required_advancement_level, type, minimum_firepower, essential_ships_string, difficult_rating, must_own_unit_id, required_specific_ship_id_1, required_specific_ship_id_1_counter, required_cargo_capacity, required_combat_fighters, required_combat_corvettes, required_combat_frigates, required_combat_cruisers, required_combat_battleships, required_combat_carriers, required_prospectors, required_scouts, required_spies, required_infiltrators, minimum_commander_rank, repeatable, reward_ship_type_id_1, reward_ship_type_id_1_count, reward_ship_type_id_2, reward_ship_type_id_2_count, reward_ship_type_id_3, reward_ship_type_id_3_count, reward_ship_type_id_4, reward_ship_type_id_4_count, reward_hassium, reward_indium, reward_strontium, reward_neodymium, opponent_fleet_template_id, mission_complete_text, choice_option_1, choice_option_2, choice_option_3, choice_option_4, choice_option_5, mission_chapter, required_completed_mission_id, reward_xp, required_game_object_id, expected_success_result, user_id, status, failed, completed_counter, last_completed_time, last_failed_time, intel_allocation_number, choice_option_selected, mission_combat_id, entry_id, duration, repeat_delay, commander_id, commander_data, launch_time, complete_time, tactics_string, summary_string, max_strength, max_level, ranked, enabled));
			}
			return;
		}
	}
}

function setupMissionTimer(){
	// look for active mission
	// if found, set up the timer!
	if (ad2460.missionVars.active_mission_id>0){

		var p=0;
		for (p=0;p<ad2460.missionPacks.length ;p++ ){
			for (m=0;m<ad2460.missionPacks[p].missions.length ;m++ )	{
				if (ad2460.missionPacks[p].missions[m].mission_id==ad2460.missionVars.active_mission_id){
					var mission=ad2460.missionPacks[p].missions[m];
					registerNewTimer('current_mission_timer', ['process_9_eta','current_mission_timer'], ['process_9_progress'], mission.launch_time, mission.complete_time, function(){loadMissionsData();});
					$('#process_9_name').html(replaceMissionConstants(mission.mission_name));
					$('#process_9_progress').show();
					$('#process_9_colour').show();

					$("#process_9").show();
				}
			}
		}
	}
	else {
		removeTimer('current_mission_timer');
		$('#process_9_progress').css('width','0%');
		$('#process_9_eta').html('');
		$('#process_9_name').html('No mission in progress');
		$('#process_9_colour').hide();
		//$("#process_9").hide();

	}
}

function updateMissionChoices(option_id, option_type, option_name, option_description, stat, success_chance_mod, duration_mod){
	var i=0;
	var found=false;
	for (i=0;i<ad2460.missionChoiceOptions.length ;i++ ){
		if (ad2460.missionChoiceOptions[i].option_id==option_id){
			found=true;
		}
	}
	if (found==false){
		ad2460.missionChoiceOptions.push(new missionOptionChoice(option_id, option_type, option_name, option_description, stat, success_chance_mod, duration_mod));
	}
}

function renderMissionPacks(){
	// dummy
	if (specialPublicPlayer==true){
		return;
	}
	removeChildNodes('soloMissions');
	var container=document.getElementById('soloMissions');
	var classes=["tableselection evenline","tableselection oddline"];
	var d=document.createDocumentFragment();

	var activeMission=returnMissionByMissionId(ad2460.missionVars.active_mission_id);

	for (var i=0;i<ad2460.missionPacks.length ;i++ ){
		var all_completed_at_least_once=true;

		var pack=ad2460.missionPacks[i];
		if (pack.pack_cost>0 && ad2460.missionVars.show_cost_packs==false){
			continue;
		}

		for (var m=0;m<pack.missions.length ;m++ ){
			if (pack.missions[m].user_id==0){
				all_completed_at_least_once=false;
			}
		}

		var missions_left=0;
		for (var m=0;m<pack.missions.length ;m++ ){
			if (pack.missions[m].repeatable==true && ad2460.scores.level<=pack.missions[m].max_level && pack.missions[m].enabled==1){
				if (ad2460.scores.level<7 || (ad2460.scores.level>6 && pack.missions[m].completed_counter<10) ){
					missions_left++;
					if (pack.missions[m].last_completed_time+pack.missions[m].repeat_delay>ad2460.serverTime || pack.missions[m].last_failed_time+pack.missions[m].repeat_delay>ad2460.serverTime){
						missions_left--;
					}
				}

			}
			else {
				if (pack.missions[m].completed_counter==0 && pack.missions[m].enabled==1){
					missions_left++;
				}
			}
		}

		if (all_completed_at_least_once==true && missions_left==0 && ad2460.missionVars.show_completed_packs==false){
			continue;
		}

		var itemContainer=createSingleElement('div', classes[i%2], 'missionPack'+ad2460.missionPacks[i].pack_id, '', 'selectMissionPack('+ad2460.missionPacks[i].pack_id+')');
		var nameDiv=createSingleElement('div','table_fleet_name allymission', '', replaceMissionConstants(ad2460.missionPacks[i].pack_name)+' ('+missions_left+')', '');
		//var iconDiv=createSingleElement('div','mission_icon', '', '', '');
		if ( (pack.pack_cost>0 && pack.purchase_timestamp==0) || pack.required_level>ad2460.scores.level){
			var iconImg=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_pack_locked.png', '');
			itemContainer.appendChild(iconImg);
		}
		else if (all_completed_at_least_once==true){
			var iconImg=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_pack_completed.png', '');
			itemContainer.appendChild(iconImg);
		}
		else{
			var iconImg=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_pack.png', '');
			itemContainer.appendChild(iconImg);
		}

		if (pack.pack_cost>0 && pack.purchase_timestamp==0){
			var iconImg2=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_purchase.png', '');
			itemContainer.appendChild(iconImg2);
		}

		if (activeMission){
			if (activeMission.pack_id==ad2460.missionPacks[i].pack_id){
				var iconImg2=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_active_solo.png', '');
				itemContainer.appendChild(iconImg2);
			}
		}

		itemContainer.appendChild(nameDiv);
		//itemContainer.appendChild(iconDiv);

		d.appendChild(itemContainer);

		/*
		<div class="tableselection evenline" id="select_solo_mission_pack_01">
			<div class="table_fleet_name allymission">The Original Position</div>
			<div class="mission_icon">
				<img src="images/icons/missionpack_icon3.png">
			</div>
		</div>
		*/
	}
	container.appendChild(d);
}


function reselectMissionPackAndMission(){
	if (ad2460.missionVars.selected_pack_id>0){
		selectMissionPack(ad2460.missionVars.selected_pack_id);
	}
	if (ad2460.missionVars.selected_mission_id>0){
		selectMission(ad2460.missionVars.selected_mission_id);
	}

}

function loadMissionsData(callbackFunction){
	$.post('actionhandler.pl', {action:'load_missions_data'}, function(data){ parseInfo(data);callbackFunction;});
}

function missionSort(a,b){
	return ( (a.mission_chapter) - (b.mission_chapter) );
	// return ( (a.mission_chapter+a.required_completed_mission_id/25) - (b.mission_chapter+b.required_completed_mission_id/25) );
}

function renderMissions(){
	// use ad2460.missionVars.selected_pack_id
	var pack=returnMissionPackById(ad2460.missionVars.selected_pack_id);
	if (pack==false){
		return;
	}
	var classes=["tableselection evenline","tableselection oddline"];
	var activeclasses=["tableselection_selected evenline","tableselection_selected oddline"];
	var d=document.createDocumentFragment();
	var container=document.getElementById('soloMissionPack');
	removeChildNodes('soloMissionPack');

	// Now sort the missions on mission_chapter + required_completed_mission_id/100
	pack.missions.sort(missionSort);

	for (var i=0;i<pack.missions.length ;i++ ){
		var m=pack.missions[i];

		var itemClassName=classes[i%2];
		if (m.entry_id>0){
			itemClassName=activeclasses[i%2];
		}

		var techpointReward=false;
		for (var t=0;t<ad2460.techpointsList.length ;t++ ){
			if (ad2460.techpointsList[t].type=="complete_mission" && ad2460.techpointsList[t].num_var==pack.missions[i].mission_id && ad2460.techpointsList[t].timestamp==0){
				techpointReward=true;
			}
		}

		var itemContainer=createSingleElement('div', itemClassName, 'mission'+m.mission_id, '', 'selectMission('+m.mission_id+',event)');
		var nameDiv=createSingleElement('div','table_fleet_name allymission', '', '', '');
		var nameSpan=createSingleElement('span','', '', replaceMissionConstants(m.mission_name), '');

		if (m.enabled<1){
			nameDiv.style.opacity='0.5';
		}

		if (m.required_completed_mission_id>0){
			nameIcon=createSingleElement('img','mission_chain_img', '', 'images/icons/mission/mission_chained.png', '');
			nameDiv.appendChild(nameIcon);
		}
		nameDiv.appendChild(nameSpan);


		var obj=checkMissionRequirements(m);
		//if (obj.ok!=true || (pack.cost>0 && pack.purchase_timestamp==0)){
		//if ((pack.cost>0 && pack.purchase_timestamp==0)){
		if (obj.locked==true){
			var iconImg=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_locked.png', '');
			itemContainer.appendChild(iconImg);
		}

		if (m.repeatable==true && m.completed_counter>0){

			if (m.completed_counter>=10 && ad2460.scores.level>6){
				// no more
			}
			else if (ad2460.scores.level>m.max_level){
				// do nothing
			}
			else if (m.entry_id>0){
				// Do not render the repeatable icon if we are doing it
			}
			else {
				if (m.enabled==1){
					var iconImg=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_repeatable.png', '');
					itemContainer.appendChild(iconImg);
					if (m.last_completed_time+m.repeat_delay>ad2460.serverTime || m.last_failed_time+m.repeat_delay>ad2460.serverTime){
						iconImg.style.opacity=0.25;
					}

				}

			}
		}
		if (m.completed_counter>0){
			var iconImg=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_completed.png', '');
			itemContainer.appendChild(iconImg);
		}
		if (m.entry_id>0){
			var iconImg=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_active_solo.png', '');
			itemContainer.appendChild(iconImg);
		}
		if (m.failed>0 && m.completed_counter<1)	{
			var iconImg=createSingleElement('img','mission_icon', '', 'images/icons/mission/mission_failed.png', '');
			itemContainer.appendChild(iconImg);
		}
		if (techpointReward==true){
			var iconImg=createSingleElement('img','mission_icon', '', 'images/icons/buttons/UI_techpoints_icon.png', '');
			//iconImg.style.height='30px';
			//iconImg.style.width='30px';
			itemContainer.appendChild(iconImg);
		}


		itemContainer.appendChild(nameDiv);
		//itemContainer.appendChild(iconDiv);

		d.appendChild(itemContainer);

		/*
		<div class="tableselection oddline">
			<div class="table_fleet_name allymission">Ancient Truths</div>
			<div class="mission_icon">
				<img src="images/icons/mission/mission_completed.png">
			</div>
		</div>
		*/
	}
	container.appendChild(d);
	// reRenderGetStartedList();

	//hideHelpCommander();
}

function showPackDescription(){
	var pack=returnMissionPackById(ad2460.missionVars.selected_pack_id);
	if (pack){
		$("#main_mission_description").removeClass('notenough').html(replaceMissionConstants(pack.pack_description));
	}
}

function hideMissionRankings(){
	$("#missions_ranking_outer_container").hide();
	$("#missions_ranking_personal_container").hide();

}

function selectMissionPack(pack_id){
	var pack=returnMissionPackById(pack_id);
	if (pack==false){
		return;
	}
	$("#missions_ranking_outer_container").hide();
	$("#missions_ranking_personal_container").hide();


	if (pack.required_level>ad2460.scores.level){
		$("#main_mission_description").html("<div style='padding-top:10px;padding-bottom:10px;position:absolute;top:120px;text-align:center;width:300px;left:40px;text-shadow:2px 2px #000000;border-radius:10px 20px;border-bottom:10px solid rgba(212,212,255,0.50);'><span style='color:#ff0000;font-size:18px;'>Level-requirement not met.</span><br> Please check back when you have reached Advancement Level "+pack.required_level+".</div>");
		return;
	}

	removeChildNodes('mission_pack_image_container');
	var e=document.getElementById('mission_pack_image_container');
	e.appendChild(createSingleElement('img', 'img_pack pack_in', 'mission_pack_image', "images/fixed/missions/"+pack.pack_image, ''));
	e.appendChild(createSingleElement('div', 'mission_pack_name', 'bigPackName', replaceMissionConstants(pack.pack_name), ''));

//	e.appendChild(createSingleElement('div', 'ranked_mission_list_official', 'missions_ranking_outer_container', '', ''));
//	e.appendChild(createSingleElement('div', 'ranked_mission_list_personal', 'missions_ranking_personal_container', '', ''));



	$("#soloPackTitle").html(pack.pack_name);

	$("#main_mission_description").html(replaceMissionConstants(pack.pack_description));

	ad2460.missionVars.selected_pack_id=pack_id;

	// Now render the "alternate list"
	renderMissions();
	$("#mission_select_header").html("Available missions");
	// Then animate the moving-stuff
	showSoloMissionPack(null,null);

	if (pack.pack_cost>0 && pack.purchase_timestamp==0){
		// show the purchase-stuff man!
		$("#purchase_missionpack_cost_div").html("Credit-Cost: "+pack.pack_cost);
		showMissionPurchase();
		// there is a
		// hideMissionPurchase(); too :)
	}
	else {
		hideMissionPurchase();
	}

}

function unselectMission(){
	ad2460.missionVars.selected_mission_id=0;
	ad2460.missionVars.selected_mission_pack=0;
	$("#selected_mission_name").html('No mission selected');
	$("#main_mission_description").html('No mission selected').removeClass('notenough');
	$("#selected_mission_type").html('No mission selected');
	$("#selected_mission_difficulty").html('N/A');
	$("#selected_mission_minimum_strength").html('N/A');
	$("#selected_mission_essential_ships").html('N/A');
	$("#selected_mission_extra_field").html('N/A');
	$("#selected_mission_prepare_button").hide();
	$("#selected_mission_summary_button").hide();
	$("#mission_pack_image").attr("src","images/fixed/missions/no_mission_selected.jpg");
	$("#bigPackName").html('No mission-pack selected');
	hideMissionPurchase();

}

function toggleMissionFilter(id){
	if (id==1){
		ad2460.missionVars.show_completed_packs=!ad2460.missionVars.show_completed_packs;
	}
	if (id==2){
		ad2460.missionVars.show_cost_packs=!ad2460.missionVars.show_cost_packs;
	}
	if (id==3){
		ad2460.missionVars.show_other_packs=!ad2460.missionVars.show_other_packs;
	}
	myScrollToTop('soloMissions');
	unselectMission();
	renderMissionPackToggles();
	renderMissionPacks();
	$("#view_solo_missions_list").click();

}

function renderMissionPackToggles(){
	if (ad2460.missionVars.show_completed_packs==true){
		$("#mission_filter_toggle_1").attr("src","images/icons/buttons/26x26green.png");
	}
	else {
		$("#mission_filter_toggle_1").attr("src","images/icons/buttons/26x26regular.png");
	}
	if (ad2460.missionVars.show_cost_packs==true){
		$("#mission_filter_toggle_2").attr("src","images/icons/buttons/26x26green.png");
	}
	else {
		$("#mission_filter_toggle_2").attr("src","images/icons/buttons/26x26regular.png");
	}
	if (ad2460.missionVars.show_other_packs==true){
		$("#mission_filter_toggle_3").attr("src","images/icons/buttons/26x26green.png");
	}
	else {
		$("#mission_filter_toggle_3").attr("src","images/icons/buttons/26x26regular.png");
	}
}

function selectMission(mission_id,event){
	// if mission_id is not specified, select "first available mission in selected pack"
	if (event) {
		if (event.shiftKey==true) {
			handleShiftClickObjectWithId(2000+parseInt(mission_id));
			return;
		}
	}

	var pack=returnMissionPackById(ad2460.missionVars.selected_pack_id);
	if (pack==false){
		return;
	}

	var mission=false;
	for (var m=0;m<pack.missions.length ;m++ ){
		if (pack.missions[m].mission_id==mission_id){
			mission=pack.missions[m];
		}
	}

	if (mission==false){
		return;
	}

	var requirements_response=checkMissionRequirements(mission);

	if (requirements_response.ok!=true){
		$("#selected_mission_name").html(replaceMissionConstants(mission.mission_name));

		if (requirements_response.locked!=true){
			var tmp="<div class='notenough mission_warning'>"+requirements_response.description+"</div>"+replaceMissionConstants(mission.mission_description);
			$("#main_mission_description").html(tmp);
		}
		else {
			var tmp="<div class='notenough mission_warning'>"+requirements_response.description+"</div>";
			$("#main_mission_description").html(tmp);
		}

		$("#selected_mission_prepare_button").hide();
		$("#selected_mission_summary_button").hide();
	}
	else {
		$("#selected_mission_name").html(replaceMissionConstants(mission.mission_name));
		$("#main_mission_description").html(replaceMissionConstants(mission.mission_description));

		$("#selected_mission_prepare_button").show();
	}

	if (mission.completed_counter>0 && mission.repeatable==false){
		$("#selected_mission_prepare_button").hide();
		$("#selected_mission_summary_button").show();
	}
	if (mission.completed_counter>0 && mission.repeatable==true){
		$("#selected_mission_summary_button").show();
	}

	if (mission.failed>0){
		$("#selected_mission_summary_button").show();
	}
	if (mission.completed_counter==0 && mission.failed==0){
		$("#selected_mission_summary_button").hide();
	}

	if (mission.enabled<1){
		$("#selected_mission_prepare_button").hide();
		$("#selected_mission_summary_button").show();
	}


	// Right side info showing

	if (requirements_response.locked==true){
		$("#selected_mission_type").html("Unknown");
		$("#selected_mission_difficulty").html("Unknown");
		$("#selected_mission_minimum_strength").html("Unknown");
		$("#selected_mission_essential_ships").html("Unknown");
		$("#selected_mission_extra_field").html("Unknown");
		$("#selected_mission_repeatable").html("Unknown");
	}
	else{
		if (mission.type=='Unknown'){
			$("#selected_mission_type").html(mission.type);
			$("#selected_mission_difficulty").html("N/A");
			$("#selected_mission_minimum_strength").html("N/A");
			$("#selected_mission_essential_ships").html("N/A");
			$("#selected_mission_extra_field").html("N/A");
			$("#selected_mission_repeatable").html("N/A");
		}
		else {
			$("#selected_mission_type").html(mission.type);
			$("#selected_mission_difficulty").html(mission.difficult_rating+'/10');

			var strString="N/A";
			if (mission.minimum_firepower>0){
				if (mission.max_strength>0){
					strString=mission.minimum_firepower+' - '+mission.max_strength;
				}
				else {
					strString="Minimum "+mission.minimum_firepower;
				}
			}

			$("#selected_mission_minimum_strength").html(strString);

			$("#selected_mission_essential_ships").html(mission.essential_ships_string+'&nbsp;');
			if (mission.duration>0){
				var duration=mission.duration;

				var res=returnGameObjectById(185);
				if (res.user_id>0 && res.upgrading==0){
					duration-=(duration*25/100);
				}

				//$("#selected_mission_extra_field").html(secondsToFullTimeNosecs(duration));
				$("#selected_mission_extra_field").html(secondsToFullTime(duration));
			}
			else {
				$("#selected_mission_extra_field").html("N/A");
			}
			if (mission.repeatable==true){
				var hours=Math.round(mission.repeat_delay/3600);
				$("#selected_mission_repeatable").html("("+mission.completed_counter+"/10) "+hours+" hours");
			}
			else {
				$("#selected_mission_repeatable").html("N/A");
			}

		}

	}


	ad2460.missionVars.selected_mission_id=mission_id;
	ad2460.missionVars.selected_option_id=0; // Resetting this one!

	handleRankedMissions(mission_id);

}

function handleRankedMissions(mission_id){
	// if mission-id one of the ranked ones
	// ask the server for the best wins (lowest strengths) here
	$("#missions_ranking_outer_container").hide();
	$("#missions_ranking_personal_container").hide();

	var m=returnMissionByMissionId(mission_id);

	removeChildNodes('missions_ranking_outer_container');
	removeChildNodes('missions_ranking_personal_container');

	if (m.ranked>0 ){
		$.post('actionhandler.pl', {action:'fetch_mission_rankings',mission_id:mission_id}, function(data){ parseInfo(data);});
	}

}

function renderMissionRanking(){
	// data in ad2460.missionRankings
	// and ad2460.missionPersonalRankings

	var parent=document.getElementById('missions_ranking_outer_container');
	var header=createSingleElement('div', 'mission_rank_header', '', 'Top Efforts', '');

	parent.appendChild(header);

	for (var i=0;i<ad2460.missionRankings.length ;i++ ){
		var div1=createSingleElement('div', 'top_mission_player', '', ad2460.missionRankings[i].nickname, 'loadPlayerInfo('+ad2460.missionRankings[i].user_id+')');
		var div2=createSingleElement('div', 'top_mission_score', '', prettyPrint(ad2460.missionRankings[i].strength), '');

		parent.appendChild(div1);
		parent.appendChild(div2);
	}

	$("#missions_ranking_outer_container").show();

	parent=document.getElementById('missions_ranking_personal_container');

	var header=createSingleElement('div', 'mission_rank_header', '', 'Personal Best', '');
	var header2=createSingleElement('div', 'mission_rank_header', '', 'N/A', '');

	parent.appendChild(header);
	parent.appendChild(header2);

	if (ad2460.missionPersonalRankings.length>0){
		header2.innerHTML=prettyPrint(ad2460.missionPersonalRankings[0].strength);
		var buttonOuter=createSingleElement('div', 'lightbutton160', '', '', 'viewCombat('+ad2460.missionPersonalRankings[0].view_id+')');
		var buttonInner=createSingleElement('div', 'buttontext24', '', 'View Combat', '');

		buttonOuter.appendChild(buttonInner);
		parent.appendChild(buttonOuter);
	}

	$("#missions_ranking_personal_container").show();

}

function returnMissionPackById(pack_id){
	var p=0;
	for (p=0;p<ad2460.missionPacks.length ;p++ ){
		if (ad2460.missionPacks[p].pack_id==pack_id){
			return ad2460.missionPacks[p];
		}
	}
	return false;
}

function checkMissionRequirements(mission){
	var returnObj={};
	returnObj.ok=true;
	returnObj.description='Good';
	returnObj.locked=false;

	// First we must do the lock-checks!
	// they return nothing, they must only set locked to true if required
	// or can we move up the locked-checks first maybe?


	var pack=returnMissionPackById(mission.pack_id);
	// Lock-checks first
	if (pack.pack_cost>0 && pack.purchase_timestamp==0){
		returnObj.ok=false;
		returnObj.locked=true;
		returnObj.description='Pack must be purchased.';
		return returnObj;
	}



	if (pack==false){
		returnObj.ok=false;
		returnObj.description='Invalid pack selected';
		returnObj.locked=true;
		return returnObj;
	}

	if (mission.required_completed_mission_id>0){
		var i=0;
		for (i=0;i<pack.missions.length ;i++ ){
			if (pack.missions[i].mission_id==mission.required_completed_mission_id && pack.missions[i].last_completed_time<1){
				returnObj.ok=false;
				returnObj.locked=true;
				returnObj.description='You have not completed the required mission.';
				return returnObj;
			}
		}
	}
	if (mission.required_advancement_level>ad2460.scores.level){
		returnObj.ok=false;
		returnObj.locked=true;
		returnObj.description='This mission requires Advancement Level '+mission.required_advancement_level+'.';
		return returnObj;
	}

	if (mission.enabled<1){
		returnObj.ok=false;
		returnObj.locked=true;
		returnObj.description='This mission has been disabled.';
		return returnObj;
	}

	if (mission.required_game_object_id>0){
		var reqObj=returnGameObjectById(mission.required_game_object_id);
		if (reqObj.user_id<1 || reqObj.upgrading==1){
			// We don't have it!
			returnObj.ok=false;
			returnObj.locked=true;
			if (reqObj.item_type=='Facility'){	returnObj.description='This mission requires the facility '+reqObj.name+' Level '+reqObj.level+'.';	}
			if (reqObj.item_type=='Development'){	returnObj.description='This mission requires the development '+reqObj.name+'.';	}
			if (reqObj.item_type=='Research'){	returnObj.description='This mission requires the research '+reqObj.name+'.';	}
			return returnObj;
		}
	}



	if (pack.required_level>ad2460.scores.level){
		returnObj.ok=false;
		returnObj.description='Level-requirement not met. ('+pack.required_level+')';
		return returnObj;
	}


	if (mission.mission_id==ad2460.missionVars.active_mission_id){
		returnObj.ok=false;
		returnObj.description='Mission underway. Stand by.';
		return returnObj;
	}

	if (mission.last_completed_time>0 && mission.repeatable==false){
		returnObj.ok=false;
		returnObj.description='You have already completed this mission.';
		return returnObj;
	}

	if (ad2460.missionVars.active_mission_id>0 && mission.mission_id!=ad2460.missionVars.active_mission_id){
		returnObj.ok=false;
		returnObj.description='You are already busy with another mission and must wait for it to complete.';
		return returnObj;
	}

	if (mission.required_advancement_level>ad2460.scores.level){
		returnObj.ok=false;
		returnObj.description='Advancement Level '+mission.required_advancement_level+' required.';
		return returnObj;
	}
	if (mission.max_level<ad2460.scores.level && mission.max_level>1){
		returnObj.ok=false;
		returnObj.description='Your advancement level is too high for this mission.';
		return returnObj;
	}




	if (mission.repeatable==true && mission.last_completed_time>ad2460.serverTime-mission.repeat_delay){
		returnObj.ok=false;

		var next_run_timestamp=mission.last_completed_time+mission.repeat_delay;

		var d = new Date()
		var n = d.getTimezoneOffset();
		next_run_timestamp+=n*60;

		var timestamp=formatShortTime(next_run_timestamp);

		//var countdownsecs=mission.last_completed_time+mission.repeat_delay-ad2460.serverTime;
		//var countdownstring=secondsToFullTimeNosecs(countdownsecs);
		returnObj.description='You can play this mission again at '+timestamp+'.';
		return returnObj;
	}

	if (mission.completed_counter>=10 && mission.repeatable==true){
		if (ad2460.scores.level>6){

			returnObj.ok=false;
			returnObj.description='After reaching level 6, repeatable missions can only be completed 10 times.';
			return returnObj;
		}
	}

	if (mission.repeatable==true && mission.last_failed_time>ad2460.serverTime-mission.repeat_delay){
		returnObj.ok=false;

		var next_run_timestamp=mission.last_failed_time+mission.repeat_delay;

		var d = new Date()
		var n = d.getTimezoneOffset();
		next_run_timestamp+=n*60;

		var timestamp=formatShortTime(next_run_timestamp);

		//var countdownsecs=mission.last_completed_time+mission.repeat_delay-ad2460.serverTime;
		//var countdownstring=secondsToFullTimeNosecs(countdownsecs);
		returnObj.description='You can play this mission again at '+timestamp+'.';
		return returnObj;
	}


	if (mission.required_game_object_id>0){
		var item=returnGameObjectById(mission.required_game_object_id);
		if (item.type=='Research'){
			if (item.user_id<1 || item.upgrading==1){
				returnObj.ok=false;
				returnObj.description='You have not completed the required research: '+item.name;
			}
		}
		if (item.type=='Facility'){
			if (item.user_id<1 || item.upgrading==1){
				returnObj.ok=false;
				returnObj.description='You have not completed the required facility: '+item.name;
			}
		}
		if (item.type=='Development'){
			if (item.user_id<1 || item.upgrading==1){
				returnObj.ok=false;
				returnObj.description='You have not completed the required development: '+item.name;
			}
		}
		if (item.type=='Productionitem'){
			if (item.user_id<1){
				returnObj.ok=false;
				returnObj.description='You need to be able to build the unit "'+item.name+'"';
			}
		}
		if (item.type=='Techitem'){
			if (item.user_id<1 || item.points<1){
				returnObj.ok=false;
				returnObj.description='You need to allocate 1 techpoint in '+item.name;
			}
		}
	}

	if (mission.last_completed_time>0 && mission.repeatable==true){
		returnObj.ok=true;
		returnObj.description='You have already completed this mission, but you may play this mission more than once.';
		return returnObj;
	}


	return returnObj;
}

function prepareMissionClick(){
	var pack=returnMissionPackById(ad2460.missionVars.selected_pack_id);
	if (pack==false){
		return;
	}
	var mission=false;
	for (var m=0;m<pack.missions.length ;m++ ){
		if (pack.missions[m].mission_id==ad2460.missionVars.selected_mission_id){
			mission=pack.missions[m];
		}
	}
	if (mission==false){
		return;
	}

	var availableProspectorUnits=0;
	var availableScoutUnits=0;
	var fleet=returnStorageFleet();
	if (fleet){
		var i=0;
		for (i=0;i<fleet.storage.length ;i++ ){
			if (fleet.storage[i].ship_type_id==430 && fleet.storage[i].counter>0)	{
				availableScoutUnits=fleet.storage[i].counter;
			}
			if (fleet.storage[i].ship_type_id==431 && fleet.storage[i].counter>0)	{
				availableProspectorUnits=fleet.storage[i].counter;
			}
		}
	}
	else {
		return;
	}


	if (mission.type=='Scouting' && availableScoutUnits<1){
		systemFeedback("Error","You will need to produce some Scouts before you can start this mission.", 1, 5);
		return;
	}
	else if (mission.type=='Espionage' && returnMaxAgents().spies < 1){
		systemFeedback("Error","You have no spies yet. Build the Intelligence Branch facility.", 1, 5);
		return;
	}
	else if (mission.type=='Reconnaissance' && availableProspectorUnits<1){
		systemFeedback("Error","You will need to produce some Prospectors before you can start this mission.", 1, 5);
		return;
	}




	// pack and mission are selected fine
	ad2460.missionVars.selected_commander_id=0;
	ad2460.missionVars.selected_fleets=new Array;

	ad2460.missionVars.allocated_infiltrators=0;
	ad2460.missionVars.allocated_scouts=0;
	ad2460.missionVars.allocated_spies=0;

	renderMissionSlide(pack,mission);

	//showMissionSlide();
	openSlide('missionslide');

	denyLadyHelp=true;
	//console.log("Denying big lady in prepareMissionClick and hiding her");
	hideHelpCommander();

	if (ad2460.scores.level<=1 && ad2460.missionVars.selected_mission_id==1){
		blinkElementById('allocateScoutPlusButton');
		// mission_options_container should get the extra noob helper object
		var extraHelpBubble=createSingleElement('div', 'prepare_combat_mission_noob_help scout_mission ', '', '1:Make sure you have produced at least 1 scout<br>2: Allocate scouts with the + button<br>3: Modify settings (optional)<br>4: Click LAUNCH', '');
		var extraImage=createSingleElement('img','prepare_combat_mission_noob_help_img scout_mission','','images/commanders/helpcommander_big.png','');
		extraHelpBubble.appendChild(extraImage);
		document.getElementById('mission_options_container').appendChild(extraHelpBubble);
	}

	if (ad2460.scores.level<=1 && ad2460.missionVars.selected_mission_id==9){
		blinkElementById('allocateScoutPlusButton');
		// mission_options_container should get the extra noob helper object
		var extraHelpBubble=createSingleElement('div', 'prepare_combat_mission_noob_help scout_mission ', '', 'If you have no spies you need to upgrade your Intelligence Branch facility-addon (Diplomatic Office)', '');
		var extraImage=createSingleElement('img','prepare_combat_mission_noob_help_img scout_mission','','images/commanders/helpcommander_big.png','');
		extraHelpBubble.appendChild(extraImage);
		document.getElementById('mission_options_container').appendChild(extraHelpBubble);
	}

	if (ad2460.scores.level<=2 && ad2460.missionVars.selected_mission_id==2){
		blinkElementById('selectable_commanders_container');
	}

}

function buyMissionPackClick(){
	var pack=returnMissionPackById(ad2460.missionVars.selected_pack_id);
	if (pack==false){
		hideMissionPurchase();
		loadMissionData();
		return;
	}
	if (pack.cost<1){
		hideMissionPurchase();
		loadMissionData();
		return;
	}
	if (pack.purchase_timestamp>0){
		hideMissionPurchase();
		loadMissionData();
		return;
	}

	$.post('actionhandler.pl', {action:'purchase_mission_pack',pack_id:pack.pack_id}, function(data){ parseInfo(data);});
}

function allocateProspectorsClick(increase){
	if (increase==true){
		if (ad2460.missionVars.allocated_prospectors<ad2460.missionVars.max_allocated_prospectors){
			ad2460.missionVars.allocated_prospectors++;
		}
	}
	else {
		if (ad2460.missionVars.allocated_prospectors>1){
			ad2460.missionVars.allocated_prospectors--;
		}
	}
	$("#scouts_allocated").html(''+ad2460.missionVars.allocated_prospectors);
	$("#scouts_max").html(''+ad2460.missionVars.max_allocated_prospectors);

	renderMissionRequirements(false);
}

function allocateScoutsClick(increase){
	if (increase==true){
		if (ad2460.missionVars.allocated_scouts<ad2460.missionVars.max_allocated_scouts){
			ad2460.missionVars.allocated_scouts++;
		}
	}
	else {
		if (ad2460.missionVars.allocated_scouts>1){
			ad2460.missionVars.allocated_scouts--;
		}
	}
	$("#scouts_allocated").html(''+ad2460.missionVars.allocated_scouts);
	$("#scouts_max").html(''+ad2460.missionVars.max_allocated_scouts);

	renderMissionRequirements(false);
}

function allocateSpiesClick(increase){
	if (increase==true){
		if (ad2460.missionVars.allocated_spies<ad2460.missionVars.max_allocated_spies){
			ad2460.missionVars.allocated_spies++;
		}
	}
	else {
		if (ad2460.missionVars.allocated_spies>1){
			ad2460.missionVars.allocated_spies--;
		}
	}
	$("#scouts_allocated").html(''+ad2460.missionVars.allocated_spies);
	$("#scouts_max").html(''+ad2460.missionVars.max_allocated_spies);
	renderMissionRequirements(false);
}

function allocateInfiltratorsClick(increase){
	if (increase==true){
		if (ad2460.missionVars.allocated_infiltrators<ad2460.missionVars.max_allocated_infiltrators){
			ad2460.missionVars.allocated_infiltrators++;
		}
	}
	else {
		if (ad2460.missionVars.allocated_infiltrators>1){
			ad2460.missionVars.allocated_infiltrators--;
		}
	}
	$("#scouts_allocated").html(''+ad2460.missionVars.allocated_infiltrators);
	$("#scouts_max").html(''+ad2460.missionVars.max_allocated_infiltrators);
	renderMissionRequirements(false);
}

function renderMissionSlide(pack,mission){
	removeChildNodes('missionslide_container');
	var container=document.getElementById('missionslide_container');
	// And then parse the selected mission and render shit accordingly

	if (pack==false || mission==false){
		return;
	}

	if (mission.type=='Scouting' || mission.type=='Espionage' || mission.type=='Reconnaissance' ){
		$("#missionslide_container").html("<div class='scout_mission_container' style='display: block;'>\
	<div class='mission_box scout_mission_text'>\
		<span class='mission_text_heading' id='mission_text_heading'>Lost in Transit</span>\
		<div class='mission_scrollcontainer'>\
			<span class='mission_text_body' id='mission_text_body'><img id='mission_type_image' src='images/fixed/scout_icon.png'>Blah blah mission text</span>\
		</div>              \
		<div class='mission_scroller_bottom_shade'></div>\
	</div>\
	<div class='mission_white_box scouts'>\
		<span class='mission_text_heading' id='allocate_heading'>Allocate Scouts</span>\
		<img src='images/planets/notification/notify_scout.jpg' id='allocate_image' class='spy_slider_image' style='left: 25%; margin-left: -60px; top: 25px;'>\
		<div class='bonuspane_counter' style=' top: 10px; right: 40px;'>\
			<div class='bonuspane_bonuses' style=' box-shadow: inset 0px 0px 10px black; background: rgba(0,0,0,0.5);height: 120px; width: 80px;'>\
				<div class='bonuspane_button' onclick='allocateScoutsClick(true)' id='allocateScoutPlusButton' style='visibility: visible; margin-left: 20px;'>\
					<div class='bonuspane_click' style='opacity: 0;'></div>\
					<div class='buttontext bonuspane_buttontext'>+</div>\
				</div>\
				<span id='scouts_allocated'>5</span>/<span id='scouts_max'>5</span>\
				<div class='bonuspane_button' onclick='allocateScoutsClick(false)' id='allocateScoutMinusButton' style='visibility: visible; margin-left: 20px;'>\
					<div class='bonuspane_click'></div>\
					<div class='buttontext bonuspane_buttontext'>-</div>\
				</div>\
			</div>\
		</div>\
	</div>\
	<div class='mission_box scout_settings'>\
		<span class='mission_text_heading' id='settings_header'>Scout Settings</span>\
		<div class='mission_option_set_container' id='mission_options_container'>\
			<!-- Per option\
			<div id='opt_01_01' class='mission_options_list scout_option selected' onclick='selectOption(top_01_01)'>\
				<span class='mission_option_inner_header'>Normal Search</span>\
				<span class='mission_option_description'>Routine search mission parameters are used.</span>                            \
			</div>\
			-->\
		</div>\
		<div class='mission_scroller_bottom_shade'></div>\
	</div>\
	<div class='mission_box scout_requirements' id='mission_requirements'>\
		<span class='mission_text_heading'>Mission Requirements</span>\
		<!-- per entry\
		<div class='mission_requirement_met'>1 scout available</div>\
		<div class='mission_requirement_fail'>1 prospector available</div>\
		-->\
	</div>\
	<div class='mission_box scout_expectations'>\
		<span class='mission_text_heading'>Expected Success Results</span>\
		<div class='mission_scrollcontainer'>\
			<span class='mission_text_body' id='expected_success_results_text_body'>Blah blah blah</span>\
		</div>\
		<div class='mission_scroller_bottom_shade'></div> \
	</div>\
	<div class='mission_box scout_rewards'>\
		<span class='mission_text_heading'>Known Rewards</span>\
		<div class='mission_scrollcontainer'>\
			<div class='xp_header' id='mission_reward_xp_header'>Experience Points</div><div class='xp_counter'  id='mission_reward_xp'>9.999.000</div>\
				<div class='mission_reward_container' id='mission_reward_unit_1'>\
					<img class='reward_img' id='mission_reward_unit_1_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_1_counter'>2</div>\
				</div>\
				<div class='mission_reward_container' id='mission_reward_unit_2'>\
					<img class='reward_img' id='mission_reward_unit_2_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_2_counter'>2</div>\
				</div>\
				<div class='mission_reward_container' id='mission_reward_unit_3'>\
					<img class='reward_img' id='mission_reward_unit_3_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_3_counter'>2</div>\
				</div>\
				<div class='mission_reward_container' id='mission_reward_unit_4'>\
					<img class='reward_img' id='mission_reward_unit_4_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_4_counter'>2</div>\
				</div>\
				<div class='outpost_levels mission' id='mission_reward_resources'>\
					<div class='resouce_level hs_level' id='mission_reward_hs'>100.000</div>\
					<div class='resouce_level sr_level' id='mission_reward_sr'>50.000</div>\
					<div class='resouce_level nd_level' id='mission_reward_nd'>50.000</div>\
					<div class='resouce_level in_level' id='mission_reward_in'>50.000</div>\
				</div>\
			</div>\
		<div class='mission_scroller_bottom_shade'></div> \
	</div>\
	<div class='lightbutton160' style='position: absolute; bottom: 6px; left: 690px;' onclick='closeSlide(\"missionslide\");'>\
		<div class='buttontext24'>Cancel</div>\
	</div>\
	<div class='lightbutton160' style='position: absolute; bottom: 5px; left: 845px;' onclick='launchMissionClick()'>\
		<div class='buttontext24'>Launch</div>\
	</div> \
</div>");

	}

	if (mission.type=='Unknown' ){
		$("#missionslide_container").html("<div class='scout_mission_container' style='display: block;'>\
	<div class='mission_box scout_mission_text'>\
		<span class='mission_text_heading' id='mission_text_heading'>Lost in Transit</span>\
		<div class='mission_scrollcontainer'>\
			<span class='mission_text_body' id='mission_text_body'><img id='mission_type_image' src='images/fixed/unknown_icon.png'>Blah blah mission text</span>\
		</div>              \
		<div class='mission_scroller_bottom_shade'></div>\
	</div>\
	<div class='mission_box scout_settings' style='top: 0px; height: 557px;'>\
		<span class='mission_text_heading' id='settings_header'>Unknown Missions</span>\
		<div>Unknown missions are rare in AD2460. They will never tell you exactly what to do.<br>\
		There is no 'launch-button' to use, and they involve solving mysteries, puzzles or performing actions elsewhere in the game to be triggered.<br><br>\
		It can be as easy as navigating to a certain set of coordinates using the starmap, or maybe it hints at attacking someone else in the game. Sometimes, all you need to do is wait.<br><br>\
		Expect the unexpected, enjoy the riddles, and try to figure out what you have to do in order to trigger the mission. <br><br>\
		If there is no riddle or puzzle to solve, and no hint as to what you need to do, don't give up. If you do give up, you can always ask some allies, maybe they have solved it!<br><br>\
		Have fun and good luck!</div>\
		<div class='mission_scroller_bottom_shade'></div>\
	</div>\
	<div class='mission_box scout_requirements' id='mission_requirements'>\
		<span class='mission_text_heading'>Mission Requirements</span>\
		<!-- per entry\
		<div class='mission_requirement_met'>1 scout available</div>\
		<div class='mission_requirement_fail'>1 prospector available</div>\
		-->\
	</div>\
	<div class='mission_box scout_expectations'>\
		<span class='mission_text_heading'>Expected Success Results</span>\
		<div class='mission_scrollcontainer'>\
			<span class='mission_text_body' id='expected_success_results_text_body'>Blah blah blah</span>\
		</div>\
		<div class='mission_scroller_bottom_shade'></div> \
	</div>\
	<div class='mission_box scout_rewards'>\
		<span class='mission_text_heading'>Known Rewards</span>\
		<div class='mission_scrollcontainer'>\
		</div>\
		<div class='mission_scroller_bottom_shade'></div> \
	</div>\
	<div class='lightbutton160' style='position: absolute; bottom: 6px; left: 690px;' onclick='closeSlide(\"missionslide\");'>\
		<div class='buttontext24'>Cancel</div>\
	</div>\
</div>");

	}

	if (mission.type=='Diplomatic'){
		$("#missionslide_container").html("<div class='diplomatic_mission_container' style='display: block;color:white;'>\
	<div class='mission_box diplomat_mission_text'>\
		<span class='mission_text_heading' id='mission_text_heading'>The Way of the Diplomat</span>\
		<div class='mission_scrollcontainer'>\
			<span class='mission_text_body'id='mission_text_body'><img id='mission_type_image' src='images/fixed/diplomatic_icon.png'>Upon returning the your solar system... </span>   \
		</div> \
		<div class='mission_scroller_bottom_shade'></div>           \
	</div>\
	<div class='mission_box commanders' style='position: absolute; top: 320px; left: 36px; height: 235px; width: 280px;'>\
		<span class='mission_text_heading'>Select Commander</span>\
		<div class='mission_scrollcontainer' id='selectable_commanders_container'>\
		</div>\
		<div class='mission_scroller_bottom_shade'></div>\
	</div>\
	<div class='mission_box selected_commander'>\
		<span class='mission_text_heading'>Selected Commander</span>\
		<div class='mission_commander_list_entry' id='selected_commander_container' style='display:none;'>\
			<div class='mission_commander_list_image'>\
				<img class='selected_commander_bg' src='../images/commanders/comm_bg_01.jpg' id='m_s_c_img_bg'>\
				<img class='selected_commander_uniform' src='../images/commanders/female/rank01.png' id='m_s_c_img_uniform'>\
				<img class='selected_commander_head' src='../images/commanders/female/heads/f01r01.png' id='m_s_c_img_head'>\
			</div>\
			<div class='mission_commander_stats'>\
				<div class='mission_commander_namerank'  id='m_s_c_rank_and_name'>Fleet Major Biana</div>\
				<div class='commander_select_personality' id='m_s_c_personality'>Zelot</div>\
				<div class='commander_select_statname'>Commanding:</div><div class='commander_select_statvalue' id='m_s_c_commanding'>100</div>\
				<div class='commander_select_statname'>Perception:</div><div class='commander_select_statvalue' id='m_s_c_perception'>100</div>\
				<div class='commander_select_statname'>Tactics:</div><div class='commander_select_statvalue' id='m_s_c_tactics'>100</div>\
				<div class='commander_select_statname'>Morale</div><div class='commander_select_statvalue' id='m_s_c_morale'>100</div>\
				<div class='commander_select_statname xp'>XP</div><div class='commander_select_statvalue xp' id='m_s_c_xp'>100 000/64 000</div>\
			</div>\
		</div>\
	</div>\
	<div class='mission_box diplomatic_options' >\
		<span class='mission_text_heading'>Diplomatic Options</span>\
		<div class='mission_option_set_container' id='mission_options_container'>\
		</div>\
		<div class='mission_scroller_bottom_shade'></div>\
	</div>\
	<div class='mission_box scout_requirements' id='mission_requirements'>\
		<span class='mission_text_heading'>Mission Requirements</span>\
	</div>\
	<div class='mission_box scout_expectations'>\
		<span class='mission_text_heading'>Expected Success Results</span>\
		<div class='mission_scrollcontainer'>\
			<span class='mission_text_body' id='expected_success_results_text_body'>Blah blah blah</span>\
		</div>\
		<div class='mission_scroller_bottom_shade'></div> \
	</div>\
	<div class='mission_box scout_rewards'>\
		<span class='mission_text_heading'>Known Rewards</span>\
		<div class='mission_scrollcontainer'>\
			<div class='xp_header' id='mission_reward_xp_header'>Experience Points</div><div class='xp_counter'  id='mission_reward_xp'>9.999.000</div>\
				<div class='mission_reward_container' id='mission_reward_unit_1'>\
					<img class='reward_img' id='mission_reward_unit_1_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_1_counter'>2</div>\
				</div>\
				<div class='mission_reward_container' id='mission_reward_unit_2'>\
					<img class='reward_img' id='mission_reward_unit_2_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_2_counter'>2</div>\
				</div>\
				<div class='mission_reward_container' id='mission_reward_unit_3'>\
					<img class='reward_img' id='mission_reward_unit_3_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_3_counter'>2</div>\
				</div>\
				<div class='mission_reward_container' id='mission_reward_unit_4'>\
					<img class='reward_img' id='mission_reward_unit_4_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_4_counter'>2</div>\
				</div>\
				<div class='outpost_levels mission' id='mission_reward_resources'>\
					<div class='resouce_level hs_level' id='mission_reward_hs'>100.000</div>\
					<div class='resouce_level sr_level' id='mission_reward_sr'>50.000</div>\
					<div class='resouce_level nd_level' id='mission_reward_nd'>50.000</div>\
					<div class='resouce_level in_level' id='mission_reward_in'>50.000</div>\
				</div>\
			</div>\
		<div class='mission_scroller_bottom_shade'></div> \
	</div>\
	<div class='lightbutton160' style='position: absolute; bottom: 6px; left: 690px;' onclick='closeSlide(\"missionslide\");'>\
		<div class='buttontext24'>Cancel</div>\
	</div>\
	<div class='lightbutton160' style='position: absolute; bottom: 5px; left: 845px;' onclick='launchMissionClick()'>\
		<div class='buttontext24'>Initiate</div>\
	</div> \
</div>");
	}

	if (mission.type=='Combat'){
		$("#missionslide_container").html("<div class='battle_mission_container' style='display: block;color:white;'>\
	<div class='mission_box diplomat_mission_text'>\
		<span class='mission_text_heading' id='mission_text_heading'>The Way of the Diplomat</span>\
		<div class='mission_scrollcontainer'>\
			<span class='mission_text_body'id='mission_text_body'><img id='mission_type_image' src='images/fixed/diplomatic_icon.png'>Upon returning the your solar system... </span>   \
		</div> \
		<div class='mission_scroller_bottom_shade'></div>           \
	</div>\
	<div class='mission_box commanders' id='combat_mission_fleet_box'>\
		<span class='mission_text_heading'>Available Fleets</span>\
		<div class='launch_fleet_scroll_outer mission'>\
			<div class='scrollBG launch_fleet_scrollbg'>\
				<div class='launch_fleet_scroll_container'>\
					<div class='lowpanel_table_scrollwrapper' id='launchMissionFleetSelect'>\
					</div>\
				</div>\
				<div class='lowpanel_table_headers launch_fleet_table'>\
					<div class='table_fleet_name launch_fleet_table mission'>Fleet Name</div>\
					<div class='table_fleet_size launch_fleet_table launch'>Cap</div>\
					<div class='table_fleet_size launch_fleet_table launch'>Min</div>\
					<div class='table_fleet_size launch_fleet_table launch'>T</div>\
					<div class='table_fleet_strength launch_fleet_table'>Str</div>\
				</div>\
			</div>\
			<div class='scrollbuttons_launch'>\
				<div class='scrollbutton_up' id='launchMissionFleetSelect_up' onclick=\"myScroll('launchMissionFleetSelect',181,500,'scrollBG')\"></div>\
				<div class='scrollbutton_down' id='launchMissionFleetSelect_down' onclick=\"myScroll('launchMissionFleetSelect',-181,500,'scrollBG')\"></div>\
			</div>\
		</div>\
	</div>\
	<div class='mission_box battle_tactics'>\
		<span class='mission_text_heading'>Tactical Settings</span>\
		<div class='tactical_inner_subset launch1 mission'>\
			<div class='tactical_list_header tacticslide'>Target Priority</div>                    \
			<div class='tactical_list_subheader'>Take-down priority</div>\
			<div id='m_tac_target_priority_7' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Closest ship</span></div>\
			<div id='m_tac_target_priority_1' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Firepower</span></div>\
			<div id='m_tac_target_priority_3' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Least Hull</span></div> \
			<div id='m_tac_target_priority_4' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Most Hull</span></div>\
			<div id='m_tac_target_priority_5' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Least Manoeuvrability</span></div>\
			<div id='m_tac_target_priority_6' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Most Manoeuvrability</span></div>\
		</div>\
		<div class='tactical_inner_subset launch2 mission'>\
			<div class='tactical_list_header tacticslide'>Re-evaluate</div>\
			<div id='m_tac_target_switching_1' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>No</span></div> \
			<div id='m_tac_target_switching_2' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Yes</span></div> \
		</div>\
		<div class='tactical_inner_subset launch3 mission'>   \
			<div class='tactical_list_header tacticslide'>Fighter Priority</div>\
			<div id='m_tac_fighter_priority_1' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Corvette Defense</span></div> \
			<div id='m_tac_fighter_priority_2' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span'>Capital ship defense</span></div> \
			<div id='m_tac_fighter_priority_4' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span'>Defend all</span></div> \
			<div id='m_tac_fighter_priority_3' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Ship-to-ship</span></div>\
		</div>\
		<div class='tactical_inner_subset launch4 mission'>   \
			<div class='tactical_list_header tacticslide'>Corvette Priority</div>\
			<div id='m_tac_corvette_priority_1' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Defense</span></div> \
			<div id='m_tac_corvette_priority_2' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Offense</span></div> \
		</div>   \
		<div class='tactical_inner_subset launch5 mission'>    \
			<div class='tactical_list_header tacticslide'>Retreat condition</div>\
			<div class='tactical_list_subheader'><span>Call retreat at</span></div>\
			<div>                    \
				<div id='m_tac_retreat_percentage_1' class='tactical_list mission_launch_third' onclick='selectMissionTactic(this.id)'><span>Never</span></div>\
				<div id='m_tac_retreat_percentage_2' class='tactical_list mission_launch_third' onclick='selectMissionTactic(this.id)'><span>15%</span></div>\
				<div id='m_tac_retreat_percentage_3' class='tactical_list mission_launch_third' onclick='selectMissionTactic(this.id)'><span>30%</span></div>\
				<div id='m_tac_retreat_percentage_4' class='tactical_list mission_launch_third' onclick='selectMissionTactic(this.id)'><span>45%</span></div>\
				<div id='m_tac_retreat_percentage_5' class='tactical_list mission_launch_third' onclick='selectMissionTactic(this.id)'><span>60%</span></div>\
				<div id='m_tac_retreat_percentage_6' class='tactical_list mission_launch_third' onclick='selectMissionTactic(this.id)'><span>75%</span></div>\
			</div>\
			<div class='tactical_list_subheader'><span>of remaining</span></div>\
			<div>\
				<div id='m_tac_retreat_type_1' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Total firepower</span></div>\
				<div id='m_tac_retreat_type_2' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Capital Ships</span></div>\
				<div id='m_tac_retreat_type_3' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Total hull</span></div>\
\
			</div>\
			<div class='tactical_list_subheader'><span>Retreat if unwinnable?</span></div>\
			<div>\
				<div id='m_tac_retreat_if_unwinnable_1' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>No</span></div>\
				<div id='m_tac_retreat_if_unwinnable_2' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Yes</span></div>\
			</div>\
			<div class='tactical_list_subheader'><span>But if losses are even...</span></div>\
			<div>\
				<div id='m_tac_retreat_if_even_1' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Stay and Fight</span></div>\
				<div id='m_tac_retreat_if_even_2' class='tactical_list mission_launch_half' onclick='selectMissionTactic(this.id)'><span>Retreat anyway</span></div>\
			</div>\
		</div>\
	</div>\
	<div class='mission_box scout_requirements' id='mission_requirements'>\
		<span class='mission_text_heading'>Mission Requirements</span>\
	</div>\
	<div class='mission_box scout_expectations'>\
		<span class='mission_text_heading'>Expected Success Results</span>\
		<div class='mission_scrollcontainer'>\
			<span class='mission_text_body' id='expected_success_results_text_body'>Blah blah blah</span>\
		</div>\
		<div class='mission_scroller_bottom_shade'></div> \
	</div>\
	<div class='mission_box scout_rewards'>\
		<span class='mission_text_heading'>Known Rewards</span>\
		<div class='mission_scrollcontainer'>\
			<div class='xp_header' id='mission_reward_xp_header'>Experience Points</div><div class='xp_counter'  id='mission_reward_xp'>9.999.000</div>\
				<div class='mission_reward_container' id='mission_reward_unit_1'>\
					<img class='reward_img' id='mission_reward_unit_1_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_1_counter'>2</div>\
				</div>\
				<div class='mission_reward_container' id='mission_reward_unit_2'>\
					<img class='reward_img' id='mission_reward_unit_2_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_2_counter'>2</div>\
				</div>\
				<div class='mission_reward_container' id='mission_reward_unit_3'>\
					<img class='reward_img' id='mission_reward_unit_3_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_3_counter'>2</div>\
				</div>\
				<div class='mission_reward_container' id='mission_reward_unit_4'>\
					<img class='reward_img' id='mission_reward_unit_4_img' src='images/icons/production/435.jpg'>\
					<div class='reward_counter' id='mission_reward_unit_4_counter'>2</div>\
				</div>\
				<div class='outpost_levels mission' id='mission_reward_resources'>\
					<div class='resouce_level hs_level' id='mission_reward_hs'>100.000</div>\
					<div class='resouce_level sr_level' id='mission_reward_sr'>50.000</div>\
					<div class='resouce_level nd_level' id='mission_reward_nd'>50.000</div>\
					<div class='resouce_level in_level' id='mission_reward_in'>50.000</div>\
				</div>\
			</div>\
		<div class='mission_scroller_bottom_shade'></div> \
	</div>\
	<div class='lightbutton160' style='position: absolute; bottom: 6px; left: 690px;' onclick='closeSlide(\"missionslide\");'>\
		<div class='buttontext24'>Cancel</div>\
	</div>\
	<div class='lightbutton160' style='position: absolute; bottom: 5px; left: 845px;' onclick='launchMissionClick()'>\
		<div class='buttontext24'>Initiate</div>\
	</div> \
</div>");
	}


	if (mission.type=='Scouting'){
		$("#mission_type_image").attr("src","images/fixed/scout_icon.png");
		$("#allocate_image").attr("src","images/planets/notification/notify_scout.jpg");
		$("#allocate_heading").html("Allocate scouts");
		$("#allocateScoutPlusButton").attr("onclick","allocateScoutsClick(true)");
		$("#allocateScoutMinusButton").attr("onclick","allocateScoutsClick(false)");
		$("#settings_header").html("Scout Settings");
		$("#scouts_allocated").html("0");
		$("#scouts_allocated").removeClass("notenough");
		$("#scouts_max").removeClass("notenough");

		ad2460.missionVars.allocated_scouts=0;
		ad2460.missionVars.max_allocated_scouts=5;
		var stFleet=returnStorageFleet();
		var storage=stFleet.storage;
		var s=0;
		for (s=0;s<storage.length ;s++ ){
			if (storage[s].ship_type_id==430){
				if (storage[s].counter<5){
					ad2460.missionVars.max_allocated_scouts=storage[s].counter;
					$("#scouts_max").html(""+ad2460.missionVars.max_allocated_scouts);

				}
				if (storage[s].counter==0){
					ad2460.missionVars.allocated_scouts=0;
					$("#scouts_allocated").html("0").addClass("notenough");
					$("#scouts_max").html("0").addClass("notenough");

				}

			}
		}
	}
	if (mission.type=='Espionage'){
		var maxAgents=returnMaxAgents();
		var defaultNumber=0;
		var i=0;
		for (i=0;i<ad2460.intel.missions.length ;i++ ){
			if (ad2460.intel.missions[i].type=='espionage')	{
				maxAgents.spies--;
			}
			if (ad2460.intel.missions[i].type=='infiltration')	{
				maxAgents.infiltrators--;
			}
		}

		$("#mission_type_image").attr("src","images/fixed/espionage_icon.png");
		$("#allocate_image").attr("src","images/planets/notification/notify_espionage.jpg");
		$("#allocate_heading").html("Allocate spies");
		if (mission.required_infiltrators>0){
			$("#allocateScoutPlusButton").attr("onclick","allocateInfiltratorsClick(true)");
			$("#allocateScoutMinusButton").attr("onclick","allocateInfiltratorsClick(false)");
			defaultNumber=maxAgents.infiltrators;
			$("#scouts_max").html(''+maxAgents.infiltrators);
		}
		else {
			$("#allocateScoutPlusButton").attr("onclick","allocateSpiesClick(true)");
			$("#allocateScoutMinusButton").attr("onclick","allocateSpiesClick(false)");
			defaultNumber=maxAgents.spies;
			$("#scouts_max").html(''+maxAgents.spies);

		}
		$("#settings_header").html("Espionage Settings");
		$("#scouts_allocated").html(""+defaultNumber);

		if (mission.required_infiltrators>0){
			ad2460.missionVars.allocated_infiltrators=defaultNumber;
			ad2460.missionVars.allocated_spies=0;
		}
		else if (mission.required_spies>0){
			ad2460.missionVars.allocated_infiltrators=0;
			ad2460.missionVars.allocated_spies=defaultNumber;
		}


		ad2460.missionVars.max_allocated_spies=maxAgents.spies;
		ad2460.missionVars.max_allocated_infiltrators=maxAgents.infiltrators;

	}

	if (mission.type=='Reconnaissance'){
		$("#allocate_heading").html("Allocate prospectors");
		$("#allocateScoutPlusButton").attr("onclick","allocateProspectorsClick(true)");
		$("#allocateScoutMinusButton").attr("onclick","allocateProspectorsClick(false)");
		$("#settings_header").html("Recon Settings");
		$("#scouts_allocated").html("1");
		$("#scouts_allocated").removeClass("notenough");
		$("#scouts_max").removeClass("notenough");
		$("#mission_type_image").attr("src","images/fixed/scout_icon.png");
		$("#allocate_image").attr("src","images/planets/notification/notify_prospecting.jpg");



		ad2460.missionVars.allocated_prospectors=1;
		ad2460.missionVars.max_allocated_prospectors=5;
		var stFleet=returnStorageFleet();
		var storage=stFleet.storage;
		var s=0;
		for (s=0;s<storage.length ;s++ ){
			if (storage[s].ship_type_id==431){
				if (storage[s].counter<5){
					ad2460.missionVars.max_allocated_prospectors=storage[s].counter;
					$("#scouts_max").html(""+ad2460.missionVars.max_allocated_prospectors);

				}
				if (storage[s].counter==0){
					ad2460.missionVars.allocated_prospectors=0;
					$("#scouts_allocated").html("0").addClass("notenough");
					$("#scouts_max").html("0").addClass("notenough");

				}

			}
		}
	}

	if (mission.type=='Diplomatic'){
		if (ad2460.missionVars.selected_commander_id>0){
			renderSelectedMissionCommander();
		}
		else {
			$("#selected_commander_container").hide();
		}
	}

	if (mission.type=='Unknown'){

	}

	renderMissionTexts(mission);
	if (mission.type =='Scouting' || mission.type =='Espionage' || mission.type =='Diplomatic'  || mission.type =='Reconnaissance' ){
		renderMissionOptions(mission);
		renderMissionTime(mission);
		updateMissionTime();
	}
	renderMissionRequirements(mission);
	renderExpectedSucessResult(mission);
	renderRewards(mission);

	if (mission.type=='Diplomatic'){
		renderSelectableCommanders();
	}
	if (mission.type=='Combat'){
		renderSelectableFleets();
		renderMissionTactics();
		$('#launchMissionFleetSelect').mousewheel(function(event, delta) {
			var curTop=parseInt($(this).css('top'),10);
			var contentHeight=parseInt($(this).outerHeight(),10);
			var windowHeight=parseInt($(this).parent().css('height'),10);
			var maxTop=0;
			var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
			var newTop=curTop+(delta*60);
			if (newTop>maxTop){	newTop=maxTop;	}
			if (newTop<minTop){	newTop=minTop;	}
			if (contentHeight>windowHeight){
				this.style.top=newTop+'px';
			}
			checkScrollButtonStatus(this.id);
		});

	}

}

function updateMissionTime(){
	var mission=returnMissionByMissionId(ad2460.missionVars.selected_mission_id);

	var org_duration=mission.duration;

	var res=returnGameObjectById(185);
	if (res.user_id>0 && res.upgrading==0){
		org_duration-=(org_duration*25/100);
	}

	var option=returnMissionOptionById(ad2460.missionVars.selected_option_id);
	if (option!=false){
		org_duration+=(org_duration*option.duration_mod/100);
	}

	org_duration=Math.floor(org_duration);

	$("#mission_prepare_timer").html(secondsToFullTime(org_duration));

}

function renderExpectedSucessResult(mission){
	$("#expected_success_results_text_body").html(replaceMissionConstants(mission.expected_success_result));
}

function renderRewards(mission){
	$("#mission_reward_xp").html(prettyPrint(mission.reward_xp));
	if (mission.reward_hassium>0 || mission.reward_indium>0 || mission.reward_strontium>0 || mission.reward_neodymium>0 ){
		$("#mission_reward_hs").html(prettyPrint(mission.reward_hassium));
		$("#mission_reward_sr").html(prettyPrint(mission.reward_strontium));
		$("#mission_reward_in").html(prettyPrint(mission.reward_indium));
		$("#mission_reward_nd").html(prettyPrint(mission.reward_neodymium));
		$("#mission_reward_resources").show();
	}
	else {
		$("#mission_reward_resources").hide();
	}

	//if (mission.reward_ship_type_id_1>0 || mission.reward_ship_type_id_2>0 || mission.reward_ship_type_id_3>0 || mission.reward_ship_type_id_4>0){
		if (mission.reward_ship_type_id_1>0){
			$("#mission_reward_unit_1_img").attr("src","images/icons/production/"+mission.reward_ship_type_id_1+".jpg");
			$("#mission_reward_unit_1_img").attr("onclick","showGameInfoBox("+mission.reward_ship_type_id_1+",event)");
			$("#mission_reward_unit_1_counter").html(mission.reward_ship_type_id_1_count);
			$("#mission_reward_unit_1").show();
		}
		else {
			$("#mission_reward_unit_1").hide();
		}

		if (mission.reward_ship_type_id_2>0){
			$("#mission_reward_unit_2_img").attr("src","images/icons/production/"+mission.reward_ship_type_id_2+".jpg");
			$("#mission_reward_unit_2_img").attr("onclick","showGameInfoBox("+mission.reward_ship_type_id_2+",event)");
			$("#mission_reward_unit_2_counter").html(mission.reward_ship_type_id_2_count);
			$("#mission_reward_unit_2").show();
		}
		else {
			$("#mission_reward_unit_2").hide();
		}

		if (mission.reward_ship_type_id_3>0){
			$("#mission_reward_unit_3_img").attr("src","images/icons/production/"+mission.reward_ship_type_id_3+".jpg");
			$("#mission_reward_unit_3_img").attr("onclick","showGameInfoBox("+mission.reward_ship_type_id_3+",event)");
			$("#mission_reward_unit_3_counter").html(mission.reward_ship_type_id_3_count);
			$("#mission_reward_unit_3").show();
		}
		else {
			$("#mission_reward_unit_3").hide();
		}

		if (mission.reward_ship_type_id_4>0){
			$("#mission_reward_unit_4_img").attr("src","images/icons/production/"+mission.reward_ship_type_id_4+".jpg");
			$("#mission_reward_unit_4_img").attr("onclick","showGameInfoBox("+mission.reward_ship_type_id_4+",event)");
			$("#mission_reward_unit_4_counter").html(mission.reward_ship_type_id_4_count);
			$("#mission_reward_unit_4").show();
		}
		else {
			$("#mission_reward_unit_4").hide();
		}

	//}



}

function renderMissionTexts(mission){
	var mission_type_image_html="<img id='mission_type_image' src='images/fixed/scout_icon.png'>";
	if (mission.type=='Scouting'){
		mission_type_image_html="<img id='mission_type_image' src='images/fixed/scout_icon.png'>";
	}
	if (mission.type=='Espionage'){
		mission_type_image_html="<img id='mission_type_image' src='images/fixed/espionage_icon.png'>";
	}
	if (mission.type=='Diplomatic'){
		mission_type_image_html="<img id='mission_type_image' src='images/fixed/diplomatic_icon.png'>";
	}
	if (mission.type=='Reconnaissance'){
		mission_type_image_html="<img id='mission_type_image' src='images/fixed/scout_icon.png'>";
	}

	if (mission.type=='Combat'){
		mission_type_image_html="<img id='mission_type_image' src='images/fixed/attack_icon.png'>";
	}
	$("#mission_text_heading").html(replaceMissionConstants(mission.mission_name));
	$("#mission_text_body").html(mission_type_image_html+replaceMissionConstants(mission.mission_description));

}

function returnMissionOptionById(id){
	var i=0;
	for (i=0;i<ad2460.missionChoiceOptions.length ;i++ ){
		if (ad2460.missionChoiceOptions[i].option_id==id){
			return ad2460.missionChoiceOptions[i];
		}
	}
	return false;
}


function renderMissionRequirements(mission){

	if (mission==false){
		mission=returnMissionByMissionId(ad2460.missionVars.selected_mission_id);
	}

	if (mission==false){
		return;
	}

	var container=document.getElementById('mission_requirements');
	removeChildNodes('mission_requirements');
	container.appendChild(createSingleElement('span', 'mission_text_heading', '', 'Mission Requirements', ''));



	if (mission.required_specific_ship_id_1>0){
		// handle later with combat-missions, it has to do with the ships in the selected fleets!
		var ship=returnGameObjectById(mission.required_specific_ship_id_1);
		var num_to_have=mission.required_specific_ship_id_1_counter;
		var className='mission_requirement_fail';

		var foundNumber=0;
		for (var f=0;f<ad2460.missionVars.selected_fleets.length ;f++ ){
			var fleet=returnFleetById(ad2460.missionVars.selected_fleets[f]);
			for (var g=0; g<fleet.ships.length ;g++ ){
				if (fleet.ships[g].ship_type_id==mission.required_specific_ship_id_1){
					foundNumber++;
				}
			}
		}

		if (foundNumber>=num_to_have){
			className='mission_requirement_met';
		}

		container.appendChild(createSingleElement('div', className, null, ship.name+'(s): '+num_to_have, null));
	}


	if (mission.required_advancement_level>1){
		// We have a requirement here...
		var className='mission_requirement_fail';
		if (ad2460.scores.level>=mission.required_advancement_level){
			className='mission_requirement_met';
		}
		var string='Advancement Level: '+mission.required_advancement_level;
		if (mission.max_level>0){
			string='Advancement Levels: '+mission.required_advancement_level+'-'+mission.max_level;
			if (mission.max_level<ad2460.scores.level){
				className='mission_requirement_fail';
			}
		}

		container.appendChild(createSingleElement('div', className, '', string, ''));
	}

	var shiptypesObject=parseSelectedMissionFleets();

	if (mission.required_cargo_capacity>0){
		// We have a requirement here...
		var className='mission_requirement_fail';

		if (shiptypesObject.cargospace>=mission.required_cargo_capacity){
			className='mission_requirement_met';
		}

		// check selected fleets for this, not possible yet
		container.appendChild(createSingleElement('div', className, '', 'Cargo capacity: '+mission.required_cargo_capacity, ''));
	}

	// Begin repeat!


	if (mission.required_combat_fighters>0){
		// We have a requirement here...
		var className='mission_requirement_fail';
		if (shiptypesObject.fighters>=mission.required_combat_fighters){
			className='mission_requirement_met';
		}

		container.appendChild(createSingleElement('div', className, '', 'Fighters: '+mission.required_combat_fighters, ''));
	}
	if (mission.required_combat_corvettes>0){
		// We have a requirement here...
		var className='mission_requirement_fail';
		if (shiptypesObject.corvettes>=mission.required_combat_corvettes){
			className='mission_requirement_met';
		}

		container.appendChild(createSingleElement('div', className, '', 'Corvettes: '+mission.required_combat_corvettes, ''));
	}
	if (mission.required_combat_frigates>0){
		// We have a requirement here...
		var className='mission_requirement_fail';
		if (shiptypesObject.frigates>=mission.required_combat_frigates){
			className='mission_requirement_met';
		}

		container.appendChild(createSingleElement('div', className, '', 'Frigates: '+mission.required_combat_frigates, ''));
	}
	if (mission.required_combat_cruisers>0){
		// We have a requirement here...
		var className='mission_requirement_fail';
		if (shiptypesObject.cruisers>=mission.required_combat_cruisers){
			className='mission_requirement_met';
		}

		container.appendChild(createSingleElement('div', className, '', 'Cruisers: '+mission.required_combat_cruisers, ''));
	}
	if (mission.required_combat_carriers>0){
		// We have a requirement here...
		var className='mission_requirement_fail';
		if (shiptypesObject.carriers>=mission.required_combat_carriers){
			className='mission_requirement_met';
		}

		container.appendChild(createSingleElement('div', className, '', 'Carriers: '+mission.required_combat_carriers, ''));
	}
	if (mission.required_combat_battleships>0){
		// We have a requirement here...
		var className='mission_requirement_fail';
		if (shiptypesObject.battleships>=mission.required_combat_battleships){
			className='mission_requirement_met';
		}

		container.appendChild(createSingleElement('div', className, '', 'Battleships: '+mission.required_combat_battleships, ''));
	}
	if (mission.minimum_firepower>0){
		// We have a requirement here...
		var className='mission_requirement_fail';
		if (shiptypesObject.strength>=mission.minimum_firepower){
			className='mission_requirement_met';
		}
		// However, we might have a max-strength to deal with too!
		var strString='Strength: '+prettyPrint(mission.minimum_firepower);
		if (mission.max_strength>0){
			strString='Strength: '+prettyPrint(mission.minimum_firepower)+'-'+prettyPrint(mission.max_strength);
			if (shiptypesObject.strength>mission.max_strength){
				className='mission_requirement_fail';
			}

		}

		container.appendChild(createSingleElement('div', className, '', strString, ''));
	}



	if (mission.required_completed_mission_id>0){
		// We have a requirement here...
		var pack=returnMissionPackById(mission.pack_id);
		var required_mission=false;
		var t=0;
		var className='mission_requirement_fail';
		for (t=0;t<pack.missions.length ;t++ ){
			if (pack.missions[t].mission_id==mission.required_completed_mission_id){
				required_mission=pack.missions[t];
				if (required_mission.completed_counter>0){
					className='mission_requirement_met';
				}
			}
		}

		container.appendChild(createSingleElement('div', className, '', 'Completed '+replaceMissionConstants(required_mission.mission_name), ''));
	}

	if (mission.required_game_object_id>0){
		var obj=returnGameObjectById(mission.required_game_object_id);
		var className='mission_requirement_fail';
		if (obj.user_id>0 && obj.upgrading==0){
			className='mission_requirement_met';
		}
		var nameString=obj.name;
		if (obj.item_type=='Facility'){
			nameString+=" Lvl "+obj.level;
		}
		container.appendChild(createSingleElement('div', className, '', obj.item_type+': ' +nameString, ''));
	}

	if (mission.required_scouts>0){
		var fleet=returnStorageFleet();
		var scout_counter=0;
		if (fleet){
			var i=0;
			for (i=0;i<fleet.storage.length ;i++ ){
				if (fleet.storage[i].ship_type_id==430 && fleet.storage[i].counter>0)	{
					scout_counter=fleet.storage[i].counter;
				}
			}
		}

		// Rethink this...light up green if we have allocated enough scouts
		var className='mission_requirement_fail';
		if (ad2460.missionVars.allocated_scouts>=mission.required_scouts){
			className='mission_requirement_met';
		}
		container.appendChild(createSingleElement('div', className, '', 'Scouts: '+mission.required_scouts, ''));
	}

	var maxAgents=returnMaxAgents();
	var i=0;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		if (ad2460.intel.missions[i].type=='espionage')	{
			maxAgents.spies--;
		}
		if (ad2460.intel.missions[i].type=='infiltration')	{
			maxAgents.infiltrators--;
		}
	}

	if (mission.required_spies>0){
		var className='mission_requirement_fail';
		if (maxAgents.spies>=mission.required_spies){
			className='mission_requirement_met';
		}
		container.appendChild(createSingleElement('div', className, '', 'Spies: '+mission.required_spies, ''));
	}

	if (mission.required_infiltrators>0){
		var className='mission_requirement_fail';
		if (maxAgents.infiltrators>=mission.required_infiltrators){
			className='mission_requirement_met';
		}
		container.appendChild(createSingleElement('div', className, '', 'Infiltrators: '+mission.required_infiltrators, ''));
	}

	if (mission.required_prospectors>0){
		var fleet=returnStorageFleet();
		var counter=0;
		if (fleet){
			var i=0;
			for (i=0;i<fleet.storage.length ;i++ ){
				if (fleet.storage[i].ship_type_id==431 && fleet.storage[i].counter>0)	{
					counter=fleet.storage[i].counter;
				}
			}
		}
		var className='mission_requirement_fail';
		if (ad2460.missionVars.allocated_prospectors>=mission.required_prospectors){
			className='mission_requirement_met';
		}
		container.appendChild(createSingleElement('div', className, '', 'Prospectors: '+mission.required_prospectors, ''));
	}

	if (mission.required_specific_ship_id_1>0){
		// Ok, we need to have one or more of this ship...
		// Loop through all fleets and look for it
		// Actually...it will be listed until we have SELECTED THE FLEETS that has the ships!
	}

	if (mission.minimum_commander_rank>0){
		var className='mission_requirement_fail';
		if (ad2460.missionVars.selected_commander_id>0){
			var commander=returnCommanderById(ad2460.missionVars.selected_commander_id);
			if (commander){
				if (commander.rank>=mission.minimum_commander_rank){
					className='mission_requirement_met';
				}
			}
		}
		var rankObj=returnCommanderRankNameObject(mission.minimum_commander_rank);
		container.appendChild(createSingleElement('div', className, 'minimum_commander_rank_requirement', 'Min. Cmd. Rank : '+rankObj.longRank, ''));

	}


}

function parseSelectedMissionFleets(){
	var returnObj={};
	returnObj.fighters=0;
	returnObj.corvettes=0;
	returnObj.frigates=0;
	returnObj.cruisers=0;
	returnObj.battleships=0;
	returnObj.carriers=0;
	returnObj.strength=0;
	returnObj.cargospace=0;

	var f=0;
	for (f=0;f<ad2460.missionVars.selected_fleets.length ;f++ ){
		var fleet=returnFleetById(ad2460.missionVars.selected_fleets[f]);
		var s=0;
		for (s=0;s<fleet.ships.length ;s++ ){
			var unit=returnGameObjectById(fleet.ships[s].ship_type_id);
			if (unit.vesseltype=='Normal'){
				if (unit.vesselclass=='Fighter'){		returnObj.fighters++;			}
				if (unit.vesselclass=='Corvette'){		returnObj.corvettes++;			}
				if (unit.vesselclass=='Frigate'){		returnObj.frigates++;			}
				if (unit.vesselclass=='Cruiser'){		returnObj.cruisers++;			}
				if (unit.vesselclass=='Battleship'){		returnObj.battleships++;			}
				if (unit.vesselclass=='Carrier'){		returnObj.carriers++;			}
			}
			returnObj.cargospace+=returnCargoCapacity(fleet.ships[s].ship_type_id);
		}
		returnObj.strength+=fleet.strength;
	}

	return returnObj;


}

function renderMissionOptions(mission){
	var container=document.getElementById('mission_options_container');
	if (mission.choice_option_1>0){
		container.appendChild(returnMissionOptionDomObject(returnMissionOptionById(mission.choice_option_1),true));
	}
	if (mission.choice_option_2>0){
		container.appendChild(returnMissionOptionDomObject(returnMissionOptionById(mission.choice_option_2),false));
	}
	if (mission.choice_option_3>0){
		container.appendChild(returnMissionOptionDomObject(returnMissionOptionById(mission.choice_option_3),false));
	}
	if (mission.choice_option_4>0){
		container.appendChild(returnMissionOptionDomObject(returnMissionOptionById(mission.choice_option_4),false));
	}
	if (mission.choice_option_5>0){
		container.appendChild(returnMissionOptionDomObject(returnMissionOptionById(mission.choice_option_5),false));
	}
}

function renderMissionTime(mission){

	var container=document.getElementById('mission_options_container');

	// cleanup
	var element = document.getElementById("mission_prepare_timer_container");
	if (element){
		element.parentNode.removeChild(element);
	}

	// do it!
	var elm=document.createElement("div");
	elm.id='mission_prepare_timer_container';
	elm.className="mission_pre_timer";
	elm.innerHTML="Mission Completion Time: <span id='mission_prepare_timer'>4h 23min</span>";
	container.appendChild(elm);
}

function returnMissionOptionDomObject(option, selected){

	var className='mission_options_list scout_option';
	if (selected==true){
		className='mission_options_list scout_option selected';
		ad2460.missionVars.selected_option_id=option.option_id;
	}

	var containerDiv=createSingleElement('div', className, 'mission_option_selector_'+option.option_id, '', 'selectMissionOption('+option.option_id+')')

	var textSpan=createSingleElement('span', 'mission_option_inner_header', '', replaceMissionConstants(option.option_name), '');
	var descrSpan=createSingleElement('span', 'mission_option_description', '', replaceMissionConstants(option.option_description), '');
	var statsDiv=createSingleElement('div', 'mission_option_description', '', '', '');
	var statsDivContent="";
	if (option.duration_mod>0){
		statsDivContent+="+"+option.duration_mod+"% Time &nbsp;&nbsp;&nbsp;";
	}
	else if (option.duration_mod<0){
		statsDivContent+=""+option.duration_mod+"% Time &nbsp;&nbsp;&nbsp;";
	}

	if (option.success_chance_mod>0){
		statsDivContent+="+"+option.success_chance_mod+"% Success &nbsp;&nbsp;&nbsp;";
	}
	else if (option.success_chance_mod<0){
		statsDivContent+=""+option.success_chance_mod+"% Success &nbsp;&nbsp;&nbsp;";
	}

	if (option.stat=='diplomat_points'){
		statsDivContent+="+1 Diplomat";
	}
	else if (option.stat=='tactician_points'){
		statsDivContent+="+1 Tactician";
	}
	else if (option.stat=='conqueror_points'){
		statsDivContent+="+1 Conqueror";
	}





	statsDiv.innerHTML=statsDivContent;

	containerDiv.appendChild(textSpan);
	containerDiv.appendChild(descrSpan);
	containerDiv.appendChild(statsDiv);
	/*
			<div id='opt_01_01' class='mission_options_list scout_option selected' onclick='selectOption(top_01_01)'>\
				<span class='mission_option_inner_header'>Normal Search</span>\
				<span class='mission_option_description'>Routine search mission parameters are used.</span>                            \
			</div>\
	*/
	return containerDiv;
}

function selectMissionOption(option_id){
	$("#missionslide_container .mission_options_list").removeClass("selected");
	$("#mission_option_selector_"+option_id).addClass("selected");
	ad2460.missionVars.selected_option_id=option_id;
	updateMissionTime();
}

function replaceMissionConstants(string){
	if (typeof string =='undefined'){
		return '';
	}
	if (typeof specialPublicPlayer == true){
		ad2460.homeworld.name='Somewhere';
		ad2460.nickname='Someone';
		ad2460.universe.quadrants.push({quadrant_name:'Alpha'});
		ad2460.universe.quadrants.push({quadrant_name:'Beta'});
		ad2460.universe.quadrants.push({quadrant_name:'Gamma'});
		ad2460.universe.quadrants.push({quadrant_name:'Delta'});
		ad2460.universe.quadrants.push({quadrant_name:'Epsilon'});
		ad2460.universe.quadrants.push({quadrant_name:'Zeta'});
		ad2460.universe.quadrants.push({quadrant_name:'Eta'});
		ad2460.universe.quadrants.push({quadrant_name:'Theta'});
		ad2460.universe.quadrants.push({quadrant_name:'Iota'});
		ad2460.universe.quadrants.push({quadrant_name:'Kappa'});
		ad2460.universe.quadrants.push({quadrant_name:'Lambda'});
		ad2460.universe.quadrants.push({quadrant_name:'Omicron'});
		ad2460.universe.quadrants.push({quadrant_name:'Sigma'});
		ad2460.universe.quadrants.push({quadrant_name:'Upsilon'});
		ad2460.universe.quadrants.push({quadrant_name:'Psi'});
		ad2460.universe.quadrants.push({quadrant_name:'Omega'});
	}

	string=string.replace(/\%h\%/gi,ad2460.homeworld.name);
	string=string.replace(/\%n\%/gi,ad2460.nickname);
	if (ad2460.outposts.length>0){
		var ops=ad2460.outposts;
		ops.sort(function(a, b){ return b.last_owner_change_time-a.last_owner_change_time });
		string=string.replace(/\%o\%/gi,ops[0].name);
	}
	else {
		string=string.replace(/\%o\%/gi,'an outpost');
	}
	string=string.replace(/\%q\%/gi,ad2460.universe.quadrants[ad2460.homeworld.quadrant-1].quadrant_name);

	return string;
}

function renderSelectableCommanders(){
	var parent=document.getElementById('selectable_commanders_container');

	var mission=returnMissionByMissionId(ad2460.missionVars.selected_mission_id);
	if (mission==false){
		return;
	}

	var renderCounter=0;

	for (var i=0;i<ad2460.myCommanders.length ;i++ ){
		var commander=ad2460.myCommanders[i];

		if (commander.fleet_id>0 || commander.dead>0 || commander.hired<1 || commander.rank<mission.minimum_commander_rank){
			continue;
		}

		var imgData=returnCommanderGraphics(commander);

		var rankNameObj=returnCommanderRankNameObject(commander.rank);
		var nameString=rankNameObj.shortRank+' '+commander.name;

		var containerDiv=createSingleElement('div', 'mission_commander_list_entry', 'mission_commander_'+commander.commander_id, '', 'selectMissionCommander('+commander.commander_id+')');
		var imgContainer=createSingleElement('div', 'mission_commander_list_image', '', '', '');
		var img1=createSingleElement('img', 'selected_commander_bg', '', imgData.bgImage, '');
		var img2=createSingleElement('img', 'selected_commander_uniform', '', imgData.uniformImage, '');
		var img3=createSingleElement('img', 'selected_commander_head', '', imgData.headImage, '');

		var statsContainer=createSingleElement('div', 'mission_commander_stats', '', '', '');
		var nameDiv=createSingleElement('div', 'mission_commander_namerank', '', nameString, '');
		var persDiv=createSingleElement('div', 'commander_select_personality', '', commander.personality, '');
		var a1=createSingleElement('div', 'commander_select_statname', '', 'Commanding', '');
		var a2=createSingleElement('div', 'commander_select_statvalue', '', commander.commanding, '');
		var b1=createSingleElement('div', 'commander_select_statname', '', 'Perception', '');
		var b2=createSingleElement('div', 'commander_select_statvalue', '', commander.perception, '');
		var c1=createSingleElement('div', 'commander_select_statname', '', 'Tactics', '');
		var c2=createSingleElement('div', 'commander_select_statvalue', '', commander.tactics, '');
		var d1=createSingleElement('div', 'commander_select_statname', '', 'Morale', '');
		var d2=createSingleElement('div', 'commander_select_statvalue', '', commander.morale, '');
		var e1=createSingleElement('div', 'commander_select_statname xp', '', 'XP', '');
		var e2=createSingleElement('div', 'commander_select_statvalue xp', '', prettyPrint(commander.experience) + ' / ' + prettyPrint(ad2460.commander_xp_levels[commander.rank]), '');

		containerDiv.appendChild(imgContainer);
		imgContainer.appendChild(img1);
		imgContainer.appendChild(img2);
		imgContainer.appendChild(img3);

		containerDiv.appendChild(statsContainer);
		statsContainer.appendChild(nameDiv);
		statsContainer.appendChild(persDiv);
		statsContainer.appendChild(a1);
		statsContainer.appendChild(a2);
		statsContainer.appendChild(b1);
		statsContainer.appendChild(b2);
		statsContainer.appendChild(c1);
		statsContainer.appendChild(c2);
		statsContainer.appendChild(d1);
		statsContainer.appendChild(d2);
		statsContainer.appendChild(e1);
		statsContainer.appendChild(e2);

		parent.appendChild(containerDiv);
		renderCounter++;
	}
	if (renderCounter==0){
		var containerDiv=createSingleElement('div', 'mission_requirement_fail', '', 'You have no available commanders. Remember that commanders who are in fleets can not leave on diplomatic missions, so you might need to disband his fleet temporarily for the mission.<br><br>You can do this in Fleet Management.', '');
		parent.appendChild(containerDiv);
	}
}

function selectMissionCommander(commander_id){
	ad2460.missionVars.selected_commander_id=commander_id;
	renderSelectedMissionCommander();
	$("#selectable_commanders_container .mission_commander_list_entry").removeClass("selected");
	$("#selectable_commanders_container #mission_commander_"+commander_id).addClass("selected");


}

function renderSelectedMissionCommander(){
	var id=ad2460.missionVars.selected_commander_id;
	var commander=returnCommanderById(id);
	// fill it in
	var imgData=returnCommanderGraphics(commander);
	var rankNameObj=returnCommanderRankNameObject(commander.rank);
	var nameString=rankNameObj.shortRank+' '+commander.name;


	$("#m_s_c_img_bg").attr("src",imgData.bgImage);
	$("#m_s_c_img_uniform").attr("src",imgData.uniformImage);
	$("#m_s_c_img_head").attr("src",imgData.headImage);
	$("#m_s_c_rank_and_name").html(nameString);

	$("#m_s_c_personality").html(commander.personality);
	$("#m_s_c_commanding").html(commander.commanding);
	$("#m_s_c_perception").html(commander.perception);
	$("#m_s_c_tactics").html(commander.tactics);
	$("#m_s_c_morale").html(commander.morale);

	$("#m_s_c_xp").html(prettyPrint(commander.experience)+" / "+prettyPrint(ad2460.commander_xp_levels[commander.rank]));



	// And show ir

	$("#selected_commander_container").show();

	$("#minimum_commander_rank_requirement").removeClass("mission_requirement_fail").addClass("mission_requirement_met");

}


function renderSelectableFleets(){
	// standard procudure, render the fleets that are at home and are generally avilable for launch
	removeChildNodes('launchMissionFleetSelect');
	var parent=document.getElementById('launchMissionFleetSelect');

	var drawnFleets=0;
	var lineClass=["evenline","oddline"];

	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var thisFleet=ad2460.myFleets[i];
		if (thisFleet.storage_fleet==0 && thisFleet.homeworld_fleet==0 && thisFleet.commander_id>0 && thisFleet.status==0 && thisFleet.shipcount>0 && thisFleet.current_x==ad2460.homeworld.x && thisFleet.current_y==ad2460.homeworld.y && thisFleet.last_hyperspace_jump_time<(ad2460.serverTime-600)){
			// We want this one to be displayed
			if (thisFleet.commander.dead>0)	{
				continue;
			}

			var containerClassName='tableselection '+lineClass[drawnFleets % 2];
			for (var s=0;s<ad2460.missionVars.selected_fleets.length ;s++ ){
				if (ad2460.missionVars.selected_fleets[s]==thisFleet.fleet_id){
					containerClassName+="_selected";
				}
			}

			var minors=0;
			var transports=0;
			for (var t=0;t<thisFleet.ships.length ;t++ ){
				if (thisFleet.ships[t].ship_type_id>400 && thisFleet.ships[t].ship_type_id<411){
					minors++;
				}
				if (thisFleet.ships[t].ship_type_id>=435 && thisFleet.ships[t].ship_type_id<=437){
					transports++;
				}
			}


			var containerDiv=createSingleElement('div', containerClassName, '', '', 'selectMissionFleet('+thisFleet.fleet_id+')');
			var nameDiv=createSingleElement('div', 'table_fleet_name mission', '', thisFleet.fleet_name, '');
			var sizeDiv=createSingleElement('div', 'table_fleet_size launch', '', prettyPrint(thisFleet.shipcount), '');
			var minorsDiv=createSingleElement('div', 'table_fleet_size launch', '', prettyPrint(minors), '');
			var transportsDiv=createSingleElement('div', 'table_fleet_size launch', '', prettyPrint(transports), '');
			var strengthDiv=createSingleElement('div', 'table_fleet_strength', '', prettyPrint(thisFleet.strength), '');

			containerDiv.appendChild(nameDiv);
			containerDiv.appendChild(sizeDiv);
			containerDiv.appendChild(minorsDiv);
			containerDiv.appendChild(transportsDiv);
			containerDiv.appendChild(strengthDiv);
			parent.appendChild(containerDiv);

			drawnFleets++;
		}
	}

	// special extra little helper bubble to render if the player has a low level and not too many fleets
	if (ad2460.scores.level<3 && drawnFleets<4){
		var extraHelpBubble=createSingleElement('div', 'prepare_combat_mission_noob_help', '', '1: Select fleet(s) above<br>2: Modify tactics (optional)<br>3: Click Initiate', '');
		var extraImage=createSingleElement('img','prepare_combat_mission_noob_help_img','','images/commanders/helpcommander_big.png','');
		extraHelpBubble.appendChild(extraImage);
		document.getElementById('combat_mission_fleet_box').appendChild(extraHelpBubble);
	}
}

function renderMissionTactics(){
	// Check the mission_tactics object and set selected on the right points
	selectMissionTactic();
}

function selectMissionFleet(fleet_id){
	// ad2460.missionVars.selected_fleets
	var found=false;
	for (var i=0;i<ad2460.missionVars.selected_fleets.length ;i++ ){
		if (ad2460.missionVars.selected_fleets[i]==fleet_id){
			found=true;
		}
	}
	if (found==false){
		ad2460.missionVars.selected_fleets.push(fleet_id);
	}

	if (found==true){
		// remove it
		for (var i=0;i<ad2460.missionVars.selected_fleets.length ;i++ ){
			if (ad2460.missionVars.selected_fleets[i]==fleet_id){

				ad2460.missionVars.selected_fleets.splice(i,1);
				i--;
			}
		}
	}
	renderSelectableFleets();
	renderMissionRequirements(returnMissionByMissionId(ad2460.missionVars.selected_mission_id));
	updateMissionTactics();

	if (ad2460.missionVars.selected_mission_id==64 || ad2460.missionVars.selected_mission_id==75 || ad2460.missionVars.selected_mission_id==10 || ad2460.missionVars.selected_mission_id==13 || ad2460.missionVars.selected_mission_id==147){
		$("#m_tac_retreat_percentage_1").click();
		$("#m_tac_retreat_if_unwinnable_1").click();
		$("#m_tac_retreat_if_even_1").click();
	}
}

function updateMissionTactics(){
	if (ad2460.missionVars.selected_fleets.length==0){
		// No fleets selected, never mind this! Leave as it is!
		return;
	}

	// lets find the highest ranking commander of the selected fleets:
	var highest_ranking_commander=false;
	for (var i=0;i<ad2460.missionVars.selected_fleets.length ;i++ ){
		var thisFleet=returnFleetById(ad2460.missionVars.selected_fleets[i]);
		var cmd=returnCommanderById(thisFleet.commander_id);
		if (highest_ranking_commander==false){
			highest_ranking_commander=cmd;
		}
		else if (highest_ranking_commander.rank<cmd.rank){
			// Better rank
			highest_ranking_commander=cmd;
		}
		else if (highest_ranking_commander.rank==cmd.rank){
			// Same rank, diff XP
			if (cmd.experience>highest_ranking_commander.experience){
				highest_ranking_commander=cmd;
			}
		}
	}
	// Now we should have the best commander in charge

	var fleet=returnFleetById(highest_ranking_commander.fleet_id);

	if (fleet!=false){
		ad2460.missionVars.tactics=fleet.tactics;
	}

	selectMissionTactic(null);
}


function selectMissionTactic(id){
	// must be a logical copy of the selectTactic function

	// Remind him to select his fleets first, if none are selected!
	if (ad2460.missionVars.selected_fleets.length==0){
		systemFeedback("Note","Please select your fleets before you alter the tactical settings", 3, 5);
		return;
	}

	var t=ad2460.missionVars.tactics;

	if	    (id=='m_tac_target_priority_1' || id=='m_tac_target_priority_2' )		{	t.target_priority='Total firepower';	}
	else if (id=='m_tac_target_priority_3')	{	t.target_priority='Least hull';	}
	else if (id=='m_tac_target_priority_4')	{	t.target_priority='Most hull';	}
	else if (id=='m_tac_target_priority_5')	{	t.target_priority='Least speed';	}
	else if (id=='m_tac_target_priority_6')	{	t.target_priority='Most speed';	}
	else if (id=='m_tac_target_priority_7')	{	t.target_priority='Closest ship';	}

	else if (id=='m_tac_target_switching_1')	{	t.target_switching='no';	}
	else if (id=='m_tac_target_switching_2')	{	t.target_switching='yes';	}

	else if (id=='m_tac_fighter_priority_1')	{	t.fighter_priority='corvette defense';	}
	else if (id=='m_tac_fighter_priority_2')	{	t.fighter_priority='capital ship defense';	}
	else if (id=='m_tac_fighter_priority_3')	{	t.fighter_priority='ship to ship';	}
	else if (id=='m_tac_fighter_priority_4')	{	t.fighter_priority='defend all';	}

	else if (id=='m_tac_corvette_priority_1')	{	t.corvette_priority='defense';	}
	else if (id=='m_tac_corvette_priority_2')	{	t.corvette_priority='offense';	}

	else if (id=='m_tac_retreat_percentage_1')	{	t.retreat_percentage=0;	}
	else if (id=='m_tac_retreat_percentage_2')	{	t.retreat_percentage=15;	}
	else if (id=='m_tac_retreat_percentage_3')	{	t.retreat_percentage=30;	}
	else if (id=='m_tac_retreat_percentage_4')	{	t.retreat_percentage=45;	}
	else if (id=='m_tac_retreat_percentage_5')	{	t.retreat_percentage=60;	}
	else if (id=='m_tac_retreat_percentage_6')	{	t.retreat_percentage=75;	}
	else if (id=='m_tac_retreat_percentage_7')	{	t.retreat_percentage=90;	}

	else if (id=='m_tac_retreat_type_1')		{	t.retreat_type='Total firepower';	}
	else if (id=='m_tac_retreat_type_2')		{	t.retreat_type='Capital ships';	}
	else if (id=='m_tac_retreat_type_3')		{	t.retreat_type='Total hull';	}

	else if (id=='m_tac_retreat_if_even_1')		{	t.retreat_if_even='no';		}
	else if (id=='m_tac_retreat_if_even_2')		{	t.retreat_if_even='yes';	}

	else if (id=='m_tac_retreat_if_unwinnable_1')		{	t.retreat_if_unwinnable='no';		}
	else if (id=='m_tac_retreat_if_unwinnable_2')		{	t.retreat_if_unwinnable='yes';	}

	$("#missionslide_container .tactical_list").removeClass("selected");

	if (t.target_priority=='Total firepower' || t.target_priority=='Primary firepower')	{	$("#m_tac_target_priority_1").addClass("selected");		}
	if (t.target_priority=='Least hull')		{	$("#m_tac_target_priority_3").addClass("selected");		}
	if (t.target_priority=='Most hull')			{	$("#m_tac_target_priority_4").addClass("selected");		}
	if (t.target_priority=='Least speed')		{	$("#m_tac_target_priority_5").addClass("selected");		}
	if (t.target_priority=='Most speed')		{	$("#m_tac_target_priority_6").addClass("selected");		}
	if (t.target_priority=='Closest ship')		{	$("#m_tac_target_priority_7").addClass("selected");		}

	if (t.target_switching=='no')				{	$("#m_tac_target_switching_1").addClass("selected");		}
	if (t.target_switching=='yes')				{	$("#m_tac_target_switching_2").addClass("selected");		}

	if (t.fighter_priority=='corvette defense')		{	$("#m_tac_fighter_priority_1").addClass("selected");		}
	if (t.fighter_priority=='capital ship defense')	{	$("#m_tac_fighter_priority_2").addClass("selected");		}
	if (t.fighter_priority=='ship to ship')			{	$("#m_tac_fighter_priority_3").addClass("selected");		}
	if (t.fighter_priority=='defend all')			{	$("#m_tac_fighter_priority_4").addClass("selected");		}

	if (t.corvette_priority=='defense')			{	$("#m_tac_corvette_priority_1").addClass("selected");		}
	if (t.corvette_priority=='offense')			{	$("#m_tac_corvette_priority_2").addClass("selected");		}

	if (t.retreat_percentage==0)				{	$("#m_tac_retreat_percentage_1").addClass("selected");		}
	if (t.retreat_percentage==15)				{	$("#m_tac_retreat_percentage_2").addClass("selected");		}
	if (t.retreat_percentage==30)				{	$("#m_tac_retreat_percentage_3").addClass("selected");		}
	if (t.retreat_percentage==45)				{	$("#m_tac_retreat_percentage_4").addClass("selected");		}
	if (t.retreat_percentage==60)				{	$("#m_tac_retreat_percentage_5").addClass("selected");		}
	if (t.retreat_percentage==75)				{	$("#m_tac_retreat_percentage_6").addClass("selected");		}
	if (t.retreat_percentage==90)				{	$("#m_tac_retreat_percentage_7").addClass("selected");		}

	if (t.retreat_type=='Total firepower' || t.retreat_type=='Total strength')		{	$("#m_tac_retreat_type_1").addClass("selected");		}
	if (t.retreat_type=='Capital ships')		{	$("#m_tac_retreat_type_2").addClass("selected");		}
	if (t.retreat_type=='Total hull')			{	$("#m_tac_retreat_type_3").addClass("selected");		}

	if (t.retreat_if_even=='no')				{	$("#m_tac_retreat_if_even_1").addClass("selected");		}
	if (t.retreat_if_even=='yes')				{	$("#m_tac_retreat_if_even_2").addClass("selected");		}

	if (t.retreat_if_unwinnable=='no')			{	$("#m_tac_retreat_if_unwinnable_1").addClass("selected");		}
	if (t.retreat_if_unwinnable=='yes')			{	$("#m_tac_retreat_if_unwinnable_2").addClass("selected");		}

}

function launchMissionClick(callback){
	// heavy thing.
	// start with fetching the pack and mission data
	var pack=returnMissionPackById(ad2460.missionVars.selected_pack_id);
	var mission=false;
	if (pack==false){
		return;
	}
	for (var i=0;i<pack.missions.length ;i++ ){
		if (pack.missions[i].mission_id==ad2460.missionVars.selected_mission_id){
			mission=pack.missions[i];
		}
	}
	if (mission==false){
		return;
	}

	// ok, pack and missions are good
	var mission_id=ad2460.missionVars.selected_mission_id;
	var pack_id=ad2460.missionVars.selected_pack_id;

	// Do we really need anything else?
	// Wait a minute..where do we define the time that is required for the mission to complete?
	if (mission.type=='Scouting'){
		if (ad2460.missionVars.allocated_scouts<mission.required_scouts){
			systemFeedback('Missing scouts','You need to allocate more scouts for this mission.', 1, 3);
			return;
		}

		//console.log("denying lady in mission launch and hiding");
		denyLadyHelp=true;
		hideHelpCommander();

		setTimeout(function(){
			denyLadyHelp=false;
			//console.log("Allowing lady in timeout after 15...");
			ladyHelperMain('launchMissionClick');
		},5000);


		$.post('actionhandler.pl', {action:'mission_launch',pack_id:pack_id, mission_id:mission_id, type:mission.type, option_id:ad2460.missionVars.selected_option_id, allocated_scouts:ad2460.missionVars.allocated_scouts}, function(data){ parseInfo(data);if (typeof(callback)=='function'){callback}});
		return;


	}
	if (mission.type=='Reconnaissance'){
		if (ad2460.missionVars.allocated_prospectors<mission.required_prospectors){
			systemFeedback('Missing scouts','You need to allocate more prospectors for this mission.', 1, 3);
			return;
		}

		//console.log("denying lady in mission launch and hiding");
		denyLadyHelp=true;
		hideHelpCommander();

		setTimeout(function(){
			denyLadyHelp=false;
			//console.log("Allowing lady in timeout after 15...");
			ladyHelperMain('Recon');
		},5000);


		$.post('actionhandler.pl', {action:'mission_launch',pack_id:pack_id, mission_id:mission_id, type:mission.type, option_id:ad2460.missionVars.selected_option_id, allocated_prospectors:ad2460.missionVars.allocated_prospectors}, function(data){ parseInfo(data);if (typeof(callback)=='function'){callback}});
		return;


	}
	if (mission.type=='Espionage'){
		if (ad2460.missionVars.allocated_spies<mission.required_spies){
			systemFeedback('Missing scouts','You need to allocate more agents for this mission.', 1, 3);
			return;
		}
		if (ad2460.missionVars.allocated_infiltrators<mission.required_infiltrators){
			systemFeedback('Missing scouts','You need to allocate more agents for this mission.', 1, 3);
			return;
		}

		var used_agents=0;
		if (mission.required_spies>0){
			used_agents=ad2460.missionVars.allocated_spies;
		}
		if (mission.required_infiltrators>0){
			used_agents=ad2460.missionVars.allocated_infiltrators;
		}

		//console.log("denying lady in mission launch and hiding");
		denyLadyHelp=true;
		hideHelpCommander();

		setTimeout(function(){
			denyLadyHelp=false;
			//console.log("Allowing lady in timeout after 15...");
			ladyHelperMain('espionage');
		},5000);


		$.post('actionhandler.pl', {action:'mission_launch',pack_id:pack_id, mission_id:mission_id, type:mission.type, option_id:ad2460.missionVars.selected_option_id, used_agents:used_agents}, function(data){ parseInfo(data);if (typeof(callback)=='function'){callback}});
		return;
	}

	if (mission.type=='Diplomatic'){
		if (ad2460.missionVars.selected_commander_id==0){
			systemFeedback('Missing commander','You need to select a commander for this mission.', 1, 3);
			return;
		}

		//console.log("denying lady in mission launch and hiding");
		denyLadyHelp=true;
		hideHelpCommander();

		setTimeout(function(){
			denyLadyHelp=false;
			//console.log("Allowing lady in timeout after 15...");
			ladyHelperMain('diplo');
		},5000);

		$.post('actionhandler.pl', {action:'mission_launch',pack_id:pack_id, mission_id:mission_id, type:mission.type, option_id:ad2460.missionVars.selected_option_id, selected_commander_id:ad2460.missionVars.selected_commander_id}, function(data){ parseInfo(data);if (typeof(callback)=='function'){callback}});
		return;

	}
	if (mission.type=='Combat'){
		if (ad2460.missionVars.selected_fleets.length<1){
			systemFeedback('No fleets selected','You must select which fleets to send out on this mission.', 1, 3);
			return;
		}


		var fleet_ids=ad2460.missionVars.selected_fleets.toString();

		//console.log("denying lady in mission launch and hiding");
		denyLadyHelp=true;
		hideHelpCommander();



		$.post('actionhandler.pl', {action:'mission_launch', pack_id:pack_id, mission_id:mission_id, type:mission.type, fleet_ids:fleet_ids, target_priority:ad2460.missionVars.tactics.target_priority, target_switching:ad2460.missionVars.tactics.target_switching, fighter_priority:ad2460.missionVars.tactics.fighter_priority, corvette_priority:ad2460.missionVars.tactics.corvette_priority, retreat_percentage:ad2460.missionVars.tactics.retreat_percentage, retreat_type:ad2460.missionVars.tactics.retreat_type, retreat_if_even:ad2460.missionVars.tactics.retreat_if_even, retreat_if_unwinnable:ad2460.missionVars.tactics.retreat_if_unwinnable}, function(data){ parseInfo(data);if (typeof(callback)=='function'){callback}});
		return;

	}


	// We probably need more client-side checks here later, but for now, lets head to the server and get things started!

}

function returnMissionByMissionId(id){
	var p=0;
	var i=0;
	for (p=0;p<ad2460.missionPacks.length ;p++ ){
		for (i=0;i<ad2460.missionPacks[p].missions.length ;i++ ){
			if (ad2460.missionPacks[p].missions[i].mission_id==id){
				return ad2460.missionPacks[p].missions[i];
			}
		}
	}

	return false;

}

function fetchPreviousMissionCombats(mission_id){
	$.post('actionhandler.pl', {action:'fetch_previous_mission_combats',mission_id:mission_id}, function(data){ parseInfo(data);});
}

function clearPreviousCombatMissions(){
	removeChildNodes("previous_mission_battles");
	var parent=document.getElementById("previous_mission_battles");
	var container=createSingleElement('div','previous_mission_container_header', '', '', '');
	var div1=createSingleElement('div','previous_mission_date', '', 'Date', '');
	var div2=createSingleElement('div','previous_mission_strength', '', 'Strength', '');
	var div3=createSingleElement('div','previous_mission_result', '', 'Result', '');
	container.appendChild(div1);
	container.appendChild(div2);
	container.appendChild(div3);
	parent.appendChild(container);

}

function addPreviousCombatMission(date_string, attacking_strength, view_id, result ){
	var parent=document.getElementById("previous_mission_battles");
	var container=createSingleElement('div','previous_mission_container', '', '', 'viewCombatSummaryClick('+view_id+')');
	var div1=createSingleElement('div','previous_mission_date', '', date_string, '');
	var div2=createSingleElement('div','previous_mission_strength', '', prettyPrint(attacking_strength), '');
	var result_string='Success';
	if (result==2 || result==5){
		result_string='Fail';
	}

	var div3=createSingleElement('div','previous_mission_result', '', result_string, '');
	container.appendChild(div1);
	container.appendChild(div2);
	container.appendChild(div3);

	parent.appendChild(container);
}

function showSelectedMissionSummary(){
	showMissionSummary(ad2460.missionVars.selected_mission_id);
}

function showMissionSummary(mission_id){
	var mission=returnMissionByMissionId(mission_id);
	if (mission==false){
		return;
	}

	// console.log(mission);

	$("#m_s_middle_combat_1").hide();
	$("#m_s_middle_combat_2").hide();
	$("#m_s_middle_scouting_1").hide();
	$("#m_s_middle_scouting_2").hide();
	$("#m_s_middle_diplomacy_1").hide();
	$("#m_s_middle_diplomacy_2").hide();

	// now render the summary slide

	if (mission.type=='Scouting'){
		$("#m_s_mission_type_image").attr("src","images/fixed/scout_icon.png");
	}
	if (mission.type=='Reconnaissance'){
		$("#m_s_mission_type_image").attr("src","images/fixed/scout_icon.png");
	}
	if (mission.type=='Espionage'){
		$("#m_s_mission_type_image").attr("src","images/fixed/espionage_icon.png");
	}
	if (mission.type=='Diplomatic'){
		$("#m_s_mission_type_image").attr("src","images/fixed/diplomatic_icon.png");
	}
	if (mission.type=='Combat'){
		$("#m_s_mission_type_image").attr("src","images/fixed/attack_icon.png");
	}

	if (mission.failed==1 && mission.last_completed_time<1){
		$("#m_s_result").removeClass("mission_requirement_met").addClass("mission_requirement_fail").html("Mission Failed");
		$("#m_s_mission_complete_text").html("You failed and learned nothing.");
	}
	else {
		$("#m_s_result").removeClass("mission_requirement_fail").addClass("mission_requirement_met").html("Mission Successful");
		if (mission.commander_id>0){
			var cmdname=mission.commander.name;
			mission.mission_complete_text=mission.mission_complete_text.replace('%c%',cmdname);
		}
		$("#m_s_mission_complete_text").html(replaceMissionConstants(mission.mission_complete_text));
	}

	var pack=returnMissionPackById(mission.pack_id);

	$("#m_s_result_packname").html(replaceMissionConstants(pack.pack_name));
	$("#m_s_result_missionname").html(replaceMissionConstants(mission.mission_name));


	if (mission.type=='Combat'){
		//console.log(mission);
		fetchPreviousMissionCombats(mission_id);
		$("#m_s_middle_combat_1").show();
		var tactics_array=mission.tactics_string.split("::");
		var summary_array=mission.summary_string.split("::");
		var tactics;
		if (tactics_array.length>5){
			tactics=new tacticSetup(0, tactics_array[0], tactics_array[1], tactics_array[2], tactics_array[3], tactics_array[4], tactics_array[5], tactics_array[6], tactics_array[7], tactics_array[8]);
		}

		//console.log(tactics);

		var summary={};
		summary.org_fi=0;
		summary.org_co=0;
		summary.org_fr=0;
		summary.org_cr=0;
		summary.org_ba=0;
		summary.org_ca=0;
		summary.org_ut=0;
		summary.org_tr=0;

		summary.lost_fi=0;
		summary.lost_co=0;
		summary.lost_fr=0;
		summary.lost_cr=0;
		summary.lost_ba=0;
		summary.lost_ca=0;
		summary.lost_ut=0;
		summary.lost_tr=0;

		if (summary_array.length>5){
			summary.org_fi=summary_array[0];
			summary.org_co=summary_array[1];
			summary.org_fr=summary_array[2];
			summary.org_cr=summary_array[3];
			summary.org_ba=summary_array[4];
			summary.org_ca=summary_array[5];
			summary.org_ut=summary_array[6];
			summary.org_tr=summary_array[7];

			summary.lost_fi=summary_array[8];
			summary.lost_co=summary_array[9];
			summary.lost_fr=summary_array[10];
			summary.lost_cr=summary_array[11];
			summary.lost_ba=summary_array[12];
			summary.lost_ca=summary_array[13];
			summary.lost_ut=summary_array[14];
			summary.lost_tr=summary_array[15];
		}

		if (typeof tactics !='undefined'){
			$("#m_s_tac_tp").html(tactics.target_priority.capitalize());
			$("#m_s_tac_ts").html(tactics.target_switching.capitalize());
			$("#m_s_tac_fp").html(tactics.fighter_priority.capitalize());
			$("#m_s_tac_cp").html(tactics.corvette_priority.capitalize());

			var retreatConditionString="Never";
			if (tactics.retreat_percentage>0){
				retreatConditionString="At "+tactics.retreat_percentage+'%'+' '+'of'+' '+tactics.retreat_type;
			}

			$("#m_s_tac_rc").html(retreatConditionString);
			$("#m_s_tac_even").html(tactics.retreat_if_even.capitalize());
			if (tactics.retreat_if_even=='no'){
				$("#m_s_tac_even").html("Stay and Fight");
			}
			if (tactics.retreat_if_even=='yes'){
				$("#m_s_tac_even").html("Retreat anyway");
			}

			$("#m_s_tac_unwin").html(tactics.retreat_if_unwinnable.capitalize());
		}


		$("#m_s_middle_combat_2").show();

		$("#m_s_bat_tot_fr").html(summary.org_fr);
		$("#m_s_bat_lost_fr").html(summary.lost_fr);
		$("#m_s_bat_tot_cr").html(summary.org_cr);
		$("#m_s_bat_lost_cr").html(summary.lost_cr);
		$("#m_s_bat_tot_bs").html(summary.org_ba);
		$("#m_s_bat_lost_bs").html(summary.lost_ba);
		$("#m_s_bat_tot_ca").html(summary.org_ca);
		$("#m_s_bat_lost_ca").html(summary.lost_ca);
		$("#m_s_bat_tot_ut").html(summary.org_ut);
		$("#m_s_bat_lost_ut").html(summary.lost_ut);
		$("#m_s_bat_tot_tr").html(summary.org_tr);
		$("#m_s_bat_lost_tr").html(summary.lost_tr);

		$("#m_s_bat_tot_fi").html(summary.org_fi);
		$("#m_s_bat_lost_fi").html(summary.lost_fi);
		$("#m_s_bat_tot_co").html(summary.org_co);
		$("#m_s_bat_lost_co").html(summary.lost_co);

		document.getElementById('m_s_view_combat_button').setAttribute("onclick","loadFirstDataForCombat("+mission.mission_combat_id+")");
	}

	if (mission.type=='Scouting' || mission.type=='Espionage' || mission.type=='Reconnaissance'){
		$("#m_s_middle_scouting_1").show();
		$("#m_s_middle_scouting_2").show();

		if (mission.type=='Scouting'){
			$("#m_s_allocation_heading").html("Allocated Scouts");
		}
		else if (mission.type=='Espionage'){
			$("#m_s_allocation_heading").html("Allocated Agents");
		}
		else if (mission.type=='Reconnaissance'){
			$("#m_s_allocation_heading").html("Allocated Prospectors");
		}


		if (mission.type=='Scouting'){
			$("#m_s_allocation_image").attr("src","images/planets/notification/notify_scout.jpg");
		}
		else if (mission.type=='Espionage'){
			$("#m_s_allocation_image").attr("src","images/planets/notification/notify_espionage.jpg");
		}
		else if (mission.type=='Reconnaissance'){
			$("#m_s_allocation_image").attr("src","images/planets/notification/notify_prospecting.jpg");
		}

		$("#m_s_agents_used").html(mission.intel_allocation_number);

		var choice=returnMissionOptionById(mission.choice_option_selected);
		$("#m_s_scouting_selected_option_container").html("");
		document.getElementById('m_s_scouting_selected_option_container').appendChild(returnMissionOptionDomObject(choice,true));

		//$("#m_s_choice_selected").html(choice.option_name);
		//$("#m_s_choice_selected_description").html(choice.option_description);
	}

	if (mission.type=='Diplomatic'){
		$("#m_s_middle_diplomacy_1").show();
		$("#m_s_middle_diplomacy_2").show();

		var commanderGFX=returnCommanderGraphics(mission.commander);
		$("#m_s_commander_img_bg").attr("src",commanderGFX.bgImage);
		$("#m_s_commander_img_uniform").attr("src",commanderGFX.uniformImage);
		$("#m_s_commander_img_head").attr("src",commanderGFX.headImage);

		var rankObj=returnCommanderRankNameObject(mission.commander.rank);
		var namerank=rankObj.shortRank+' '+mission.commander.name;
		$("#m_s_commander_namerank").html(namerank);
		$("#m_s_commander_personality").html(mission.commander.personality);
		$("#m_s_commander_commanding").html(mission.commander.commanding);
		$("#m_s_commander_perception").html(mission.commander.perception);
		$("#m_s_commander_tactics").html(mission.commander.tactics);
		$("#m_s_commander_morale").html(mission.commander.morale);

		var choice=returnMissionOptionById(mission.choice_option_selected);
		//$("#m_s_diplomatic_choice_selected").html(choice.option_name);
		//$("#m_s_diplomatic_choice_selected_description").html(choice.option_description);

		$("#m_s_diplomacy_selected_option_container").html("");
		document.getElementById('m_s_diplomacy_selected_option_container').appendChild(returnMissionOptionDomObject(choice,true));

	}

	// Common stuff for all, the rewards

	if (mission.failed==1 && mission.last_completed_time<1){
		$("#m_s_rewards_content").hide();
		$("#m_s_no_rewards").addClass("mission_requirement_fail").html("There are no rewards for failure!").show();
	}
	else {
		$("#m_s_no_rewards").hide();
		$("#m_s_rewards_content").show();

		$("#m_s_reward_xp").html(prettyPrint(mission.reward_xp));
		$("#m_s_reward_hs").html(prettyPrint(mission.reward_hassium));
		$("#m_s_reward_in").html(prettyPrint(mission.reward_indium));
		$("#m_s_reward_sr").html(prettyPrint(mission.reward_strontium));
		$("#m_s_reward_nd").html(prettyPrint(mission.reward_neodymium));

		$("#m_s_reward_unit_container_1").hide();
		$("#m_s_reward_unit_container_2").hide();
		$("#m_s_reward_unit_container_3").hide();
		$("#m_s_reward_unit_container_4").hide();

		if (mission.reward_ship_type_id_1>0){
			$("#m_s_reward_unit_image_1").attr("src","images/icons/production/"+mission.reward_ship_type_id_1+".jpg").show();
			$("#m_s_reward_unit_counter_1").html(''+mission.reward_ship_type_id_1_count);
			$("#m_s_reward_unit_counter_1").show();
			$("#m_s_reward_unit_container_1").show();
		}
		if (mission.reward_ship_type_id_2>0){
			$("#m_s_reward_unit_image_2").attr("src","images/icons/production/"+mission.reward_ship_type_id_2+".jpg").show();
			$("#m_s_reward_unit_counter_2").html(''+mission.reward_ship_type_id_2_count);
			$("#m_s_reward_unit_counter_2").show();
			$("#m_s_reward_unit_container_2").show();
		}
		if (mission.reward_ship_type_id_3>0){
			$("#m_s_reward_unit_image_3").attr("src","images/icons/production/"+mission.reward_ship_type_id_3+".jpg").show();
			$("#m_s_reward_unit_counter_3").html(''+mission.reward_ship_type_id_3_count);
			$("#m_s_reward_unit_counter_3").show();
			$("#m_s_reward_unit_container_3").show();
		}
		if (mission.reward_ship_type_id_4>0){
			$("#m_s_reward_unit_image_4").attr("src","images/icons/production/"+mission.reward_ship_type_id_4+".jpg").show();
			$("#m_s_reward_unit_counter_4").html(''+mission.reward_ship_type_id_4_count);
			$("#m_s_reward_unit_counter_4").show();
			$("#m_s_reward_unit_container_4").show();
		}

	}



	// and show it
	openSlide('mission_summary');
}

function showMissionResultQuickPopup(mission_id){
	var mission=returnMissionByMissionId(mission_id);
	if (mission.failed==1){
		$("#mission_complete_head").html('Mission Failed!');
		$("#mission_complete_desc").html("Unfortunately you failed at the mission '"+replaceMissionConstants(mission.mission_name)+"'.<br><br>Reselect the mission and try again.");
		$("#mission_complete_img").attr("src","images/fixed/mission_failed_icon.png");
		showMissionCompleteAward();

		//showOkPopup("Congrats, you FAILED miserably at the mission "+mission.mission_name, 'I know....', 'hideOkPopup()');
	}
	else {
		if (mission.commander_id>0){
			var cmdname=mission.commander.name;
			mission.mission_complete_text=mission.mission_complete_text.replace('%c%',cmdname);
		}
		$("#mission_complete_head").html('Mission Complete!');
		$("#mission_complete_desc").html("Congratulations, your mission '"+replaceMissionConstants(mission.mission_name)+"' was completed successfully.<br><br>"+replaceMissionConstants(mission.mission_complete_text));
		$("#mission_complete_img").attr("src","images/fixed/mission_complete_icon.png");
		showMissionCompleteAward();

		//showOkPopup("Yeah baby, you totally aced the mission "+mission.mission_name, 'Of course I did!', 'hideOkPopup()');
	}
	notifyServerAboutSeenMissionPopup(mission_id);
}

function notifyServerAboutSeenMissionPopup(mission_id){
	$.post('actionhandler.pl', {action:'seen_mission_popup',mission_id:mission_id}, function(data){ parseInfo(data);});
}

function update_g2a_form(){
	var selected_credits=$("#g2acredits").val();
	updateCurrencyInfo(selected_credits);
}

function update_adyen_form(){
	$("#adyen_buy_text").removeClass('threaddisabled');
	var selected_credits=$("#adyen_credits").val();
	if (selected_credits==10) {
		$('#adyen_amount').attr("value",amounts[0]);
		$('#adyen_order_data').attr("value",order_data[0]);
		$('#adyen_merchant_sig').attr("value",sigs[0]);
		$('#adyen_merchant_reference').attr("value",refs[0]);
		$('#adyen_submit_button').attr("disabled",false);
		ad2460.payButtons.adyen=true;
	}
	if (selected_credits==30) {
		$('#adyen_amount').attr("value",amounts[1]);
		$('#adyen_order_data').attr("value",order_data[1]);
		$('#adyen_merchant_sig').attr("value",sigs[1]);
		$('#adyen_merchant_reference').attr("value",refs[1]);
		$('#adyen_submit_button').attr("disabled",false);
		ad2460.payButtons.adyen=true;
	}
	if (selected_credits==65) {
		$('#adyen_amount').attr("value",amounts[2]);
		$('#adyen_order_data').attr("value",order_data[2]);
		$('#adyen_merchant_sig').attr("value",sigs[2]);
		$('#adyen_merchant_reference').attr("value",refs[2]);
		$('#adyen_submit_button').attr("disabled",false);
		ad2460.payButtons.adyen=true;
	}
	if (selected_credits==90) {
		$('#adyen_amount').attr("value",amounts[3]);
		$('#adyen_order_data').attr("value",order_data[3]);
		$('#adyen_merchant_sig').attr("value",sigs[3]);
		$('#adyen_merchant_reference').attr("value",refs[3]);
		$('#adyen_submit_button').attr("disabled",false);
		ad2460.payButtons.adyen=true;
	}
	if (selected_credits==180) {
		$('#adyen_amount').attr("value",amounts[4]);
		$('#adyen_order_data').attr("value",order_data[4]);
		$('#adyen_merchant_sig').attr("value",sigs[4]);
		$('#adyen_merchant_reference').attr("value",refs[4]);
		$('#adyen_submit_button').attr("disabled",false);
		ad2460.payButtons.adyen=true;
	}
	if (selected_credits==365) {
		$('#adyen_amount').attr("value",amounts[5]);
		$('#adyen_order_data').attr("value",order_data[5]);
		$('#adyen_merchant_sig').attr("value",sigs[5]);
		$('#adyen_merchant_reference').attr("value",refs[5]);
		$('#adyen_submit_button').attr("disabled",false);
		ad2460.payButtons.adyen=true;
	}
	if (selected_credits==750) {
		$('#adyen_amount').attr("value",amounts[6]);
		$('#adyen_order_data').attr("value",order_data[6]);
		$('#adyen_merchant_sig').attr("value",sigs[6]);
		$('#adyen_merchant_reference').attr("value",refs[6]);
		$('#adyen_submit_button').attr("disabled",false);
		ad2460.payButtons.adyen=true;
	}
	if (selected_credits<1) {
		$('#adyen_submit_button').attr("disabled","disabled");
		ad2460.payButtons.adyen=false;
		$("#adyen_buy_text").addClass('threaddisabled');
	}

	updateCurrencyInfo(selected_credits);
}

function update_paypal_form(){
	$("#paypal_buy_text").removeClass('threaddisabled');
	var selected_credits=parseInt($("#paypal_credits").val());
	if (selected_credits>0) {
		$('#paypal_submit_button').attr("disabled",false);
		$('#paypal_item_name').attr("value",selected_credits+" credits for AD2460");
		$('#paypal_item_number').attr("value",selected_credits);
		$('#paypal_amount').attr("value",credits_to_euro(selected_credits)+".00");
		ad2460.payButtons.paypal=true;
	}
	if (selected_credits<1) {
		$('#paypal_submit_button').attr("disabled","disabled");
		ad2460.payButtons.paypal=false;
		$("#paypal_buy_text").addClass('threaddisabled');
	}

	 updateCurrencyInfo(selected_credits);

}

function updateCurrencyInfo(selected_credits){
	$("#currency_text_field").html('');

	if (selected_credits>0) {
		if (ad2460.reg_country_iso_3166=='us'){
			var USD=currencies.responseJSON.rates.USD*credits_to_euro(selected_credits);
			$("#currency_text_field").html(credits_to_euro(selected_credits)+" Euro is very close to "+USD.toFixed(2)+" USD");
		}
		if (ad2460.reg_country_iso_3166=='ca'){
			var CAD=currencies.responseJSON.rates.CAD*credits_to_euro(selected_credits);
			$("#currency_text_field").html(credits_to_euro(selected_credits)+" Euro is very close to "+CAD.toFixed(2)+" CAD");
		}
		if (ad2460.reg_country_iso_3166=='no'){
			var NOK=currencies.responseJSON.rates.NOK*credits_to_euro(selected_credits);
			$("#currency_text_field").html(credits_to_euro(selected_credits)+" Euro is very close to "+NOK.toFixed(2)+" NOK");
		}
		if (ad2460.reg_country_iso_3166=='uk'){
			var GBP=currencies.responseJSON.rates.GBP*credits_to_euro(selected_credits);
			$("#currency_text_field").html(credits_to_euro(selected_credits)+" Euro is very close to "+GBP.toFixed(2)+" GBP");
		}
		if (ad2460.reg_country_iso_3166=='br'){
			var BRL=currencies.responseJSON.rates.BRL*credits_to_euro(selected_credits);
			$("#currency_text_field").html(credits_to_euro(selected_credits)+" Euro is very close to "+BRL.toFixed(2)+" BRL");
		}
		if (ad2460.reg_country_iso_3166=='pl'){
			var PLN=currencies.responseJSON.rates.PLN*credits_to_euro(selected_credits);
			$("#currency_text_field").html(credits_to_euro(selected_credits)+" Euro is very close to "+PLN.toFixed(2)+" PLN");
		}
		if (ad2460.reg_country_iso_3166=='hu'){
			var HUF=currencies.responseJSON.rates.HUF*credits_to_euro(selected_credits);
			$("#currency_text_field").html(credits_to_euro(selected_credits)+" Euro is very close to "+HUF.toFixed(2)+" HUF");
		}
		if (ad2460.reg_country_iso_3166=='au'){
			var AUD=currencies.responseJSON.rates.AUD*credits_to_euro(selected_credits);
			$("#currency_text_field").html(credits_to_euro(selected_credits)+" Euro is very close to "+AUD.toFixed(2)+" AUD");
		}
		if (ad2460.reg_country_iso_3166=='cz'){
			var CZK=currencies.responseJSON.rates.CZK*credits_to_euro(selected_credits);
			$("#currency_text_field").html(credits_to_euro(selected_credits)+" Euro is very close to "+CZK.toFixed(2)+" CZK");
		}

		blinkElementById('currency_text_field');
	}
}

function adyenClick(){
	if (ad2460.payButtons.adyen==true){
		document.getElementById('adyen_form').submit();
	}
}

function paypalClick(){
	if (ad2460.payButtons.paypal==true){
		document.getElementById('paypal_form').submit();
	}
}

function euro_to_credits(euro){
	var credits=1;

	if (euro<4) {
		credits=euro*5;
	}
	else if (euro==8) {
		credits=65;
	}
	else if (euro<10) {
		credits=euro*7.5;
	}
	else if (euro<18) {
		credits=euro*9;
	}
	else if (euro<32) {
		credits=euro*10;
	}
	else if (euro<60) {
		credits=euro*11.41;
	}
	else {
		credits=euro*12.5;
	}

	return (Math.floor(credits));

}

function credits_to_euro(credits){
	var euro=0;
	if		(credits==10){	euro=2;	}
	else if (credits==30){	euro=4;	}
	else if (credits==65){	euro=8;	}
	else if (credits==90){	euro=10;}
	else if (credits==180){	euro=18;}
	else if (credits==365){	euro=32;}
	else if (credits==750){	euro=60;}

	return euro;

}

function showReturnedFromPaymentPopup(){
	var mainText="Thank you so much for supporting us. The credits you purchased might be with you already, or they are up to a couple of minutes away. Contact support if you have not seen the credits in one hour.";
	mainText+="<br>"+"Good luck in the game, and have fun!";
	mainText+="<br><br>"+"-AD2460 HeadQuarters, Fifth Season AS, Oslo, Norway, Earth";
	showOkPopup(mainText, "OK", "");
}

function openPurchaseSection(){
	openSlide('purchaseslide');
}

function fetchReferrals(){
	$.post('actionhandler.pl', {action:'fetch_referrals'}, function(data){ parseInfo(data);});
}

function renderReferrals(){
	showSimpleBox("Referrals","");
	var container=document.getElementById("simple_main_text");

	if (ad2460.referrals.length==0){
		$("#simple_main_text").html("There are no players in the game now with you as referrer.");
		return;
	}

	var i=0;
	for (i=0;i<ad2460.referrals.length ;i++ ){
		var first=createSingleElement('div', '', '', ad2460.referrals[i].nickname, 'initiateConversationWithName("'+ad2460.referrals[i].nickname+'")');
		first.style.cursor='pointer';
		container.appendChild(first);
	}

}


function moveHelperChecklist(){
	return;
	$("#helper_checklist").animate({
	    right: "934px",
		top: "303px",
		width: "430px",
	    height: "292px"


	  }, 200, function() {
	    // Animation complete.
	});
}
function restoreHelperChecklist(){
	return;
	$("#helper_checklist").animate({
	    width: "500px",
	    right: "166px",
	    height: "357px",
		top: "44px"
	  }, 200, function() {
	    // Animation complete.
	});
}
function moveHelperChecklistProduction(){
	return;
	$("#helper_checklist").animate({
		width: "600px",
		right: "170px",
		height: "246px",
		top: "348px"
	  }, 200, function() {
	    // Animation complete.
	});
}


function moveHelperChecklistStarmap(){
	return;
	$("#helper_checklist").animate({
		width: "450px",
		right: "0px",
		height: "270px",
		top: "326px"
	  }, 200, function() {
	    // Animation complete.
	});

}
function moveHelperChecklistMissions(){
	return;
	$("#helper_checklist").animate({
		width: "644px",
		right: "170px",
		height: "199px",
		top: "26px"
	  }, 200, function() {
	    // Animation complete.
	});
}

function toggleHelperSize(){
	var top=parseInt($("#helper_checklist").css("top"));
	// top toggles between 590 and 40 px
	if (top>=500){
		// set top to 40
		// set height to 715

		$( "#helper_checklist" ).animate({
		top: "50",
		height: "715"
		}, 300, function() {
		// Animation complete.
		});
		$('#helper_maxmin').transition( {rotateX: 180},200 );
	}
	else {
		// set top to 590
		// set height to 175
		$( "#helper_checklist" ).animate({
		top: "590",
		height: "175"
		}, 300, function() {
		// Animation complete.
		});
		$('#helper_maxmin').transition( {rotateX: 0},200 );

	}

}


function blinkElementById(id){
	$("#"+id).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
}
function blinkElementByIdShort(id){
	$("#"+id).fadeOut(500).fadeIn(500);
}

function alertSystemToOpenChecklist(){
	var i=0;

	if (ad2460.currentPageSection=='Homeworld'){
		for (i=0;i<ad2460.openPanels.length ;i++ ){
			if (ad2460.openPanels[i]=='facility'){
				moveHelperChecklist();
			}
			if (ad2460.openPanels[i]=='research'){
				moveHelperChecklistProduction();
			}
			if (ad2460.openPanels[i]=='development'){
				moveHelperChecklistProduction();
			}
			if (ad2460.openPanels[i]=='production'){
				moveHelperChecklistProduction();
			}
		}

	}


}

function vacationModeClick(){
	var mainText='Are you absolutely sure you wish to enter vacation-mode now? You will not be able to log in for at least 60 hours!';
	var okText='Yes';
	var cancelText='No';
	var okClick='hideConfirmationPopup();confirmedVacationModeClick();';
	var cancelClick='hideConfirmationPopup()';
	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick);
}

function confirmedVacationModeClick(){
	$.post('actionhandler.pl', {action:'enter_vacation_mode'}, function(data){ parseInfo(data);});
}

function showAnnouncement(id, subject, body, timestamp){
	var timestring=formatMessageTimestamp(timestamp);
	var onclick="confirmReadAnnouncement("+id+")";
	//showOkPopup(subject+"<br>"+timestring+"<br><br>"+linkify(body), "Got it!", onclick);
	showSimpleBox(subject,timestring+"<br><br>"+linkify(body),onclick);

}

function confirmReadAnnouncement(id){
	$.post('actionhandler.pl', {action:'confirm_read_announcement',id:id}, function(data){ parseInfo(data);});
}

function loadNotes(){
	$.post('actionhandler.pl', {action:'load_notes'}, function(data){ clearNotes(); parseInfo(data);renderNotes();});
}

function clearNotes(){
	ad2460.noteVars.notes=new Array;
}

function addNote(note_id, timestamp, heading, body){
	ad2460.noteVars.notes.push(new note(note_id, timestamp, heading, body));
}

function renderNotes(){
	$("#notelist .note_entry").remove();
	var container=document.getElementById('notelist');
	var i=0;
	for (i=0;i<ad2460.noteVars.notes.length;i++){
		var n=ad2460.noteVars.notes[i];
		var d1=createSingleElement('div', 'note_entry', '', '', 'selectNote('+n.note_id+',event)');
		var d2=createSingleElement('div', 'note_subject', '', n.heading, '');
		var d3=createSingleElement('div', 'note_time', '', formatDate(n.timestamp), '');
		var d4=createSingleElement('div', 'note_edit', '', '&nbsp;', 'editNote('+n.note_id+',event)');
		var d5=createSingleElement('div', 'note_delete', '', '&nbsp;', 'deleteNote('+n.note_id+',event)');

		d1.appendChild(d2);
		d1.appendChild(d3);
		d1.appendChild(d4);
		d1.appendChild(d5);
		container.appendChild(d1);
	}
	if (ad2460.noteVars.selected_note_id>0){
		selectNote(ad2460.noteVars.selected_note_id);
	}

	if (ad2460.noteVars.notes.length==0){
		$("#nonotes").show();
		$("#notelist").hide();

	}
	else {
		$("#nonotes").hide();
		$("#notelist").show();
	}
}

function editNote(id,event){
	event.stopPropagation();
	for (i=0;i<ad2460.noteVars.notes.length;i++){
		if (ad2460.noteVars.notes[i].note_id==id){
			var n=ad2460.noteVars.notes[i];
			var mainText='<input type="text" style="margin-bottom:5px;font-size:15px;width:98%;" id="new_note_heading"><br><textarea id="new_note_body" style="font-size:14px;width:97%;height: 200px;"></textarea>';
			var okText='Update';
			var cancelText='Cancel';
			var okClick='saveNewNoteClick(event);';
			var cancelClick='$("#simple_popup_2").hide();ad2460.noteVars.edit_note_id=0;';
			$("#simple_header_text_2").html("Edit note");
			$("#simple_main_text_2").html(mainText);

			document.getElementById('simple_ok_button_2').onclick=function(){eval(okClick);};
			document.getElementById('simple_cancel_button_2').onclick=function(){eval(cancelClick);hideConfirmationPopup();};

			ad2460.noteVars.edit_note_id=id;

			$("#simple_ok_button_text_2").html(okText);
			$("#simple_cancel_button_text_2").html(cancelText);

			var t_heading=n.heading;
			var t_body=n.body;

			t_heading=t_heading.replace(/<br>/g, "\n");
			t_heading=t_heading.replace(/&lt;/g, "<");
			t_body=t_body.replace(/<br>/g, "\n");
			t_body=t_body.replace(/&lt;/g, "<");



			$("#new_note_heading").val(t_heading);
			$("#new_note_body").val(t_body);

			$("#simple_popup_2").show();

		}
	}
}

function selectNote(id){
	for (i=0;i<ad2460.noteVars.notes.length;i++){
		if (ad2460.noteVars.notes[i].note_id==id){
			ad2460.noteVars.selected_note_id=id;
			$("#selected_note_subject").html(ad2460.noteVars.notes[i].heading);
			$("#selected_note")	.html(linkify(ad2460.noteVars.notes[i].body));
		}
	}
}

function newNoteClick(event){

	var mainText='<input type="text" style="margin-bottom:5px;font-size:15px;width:98%;" id="new_note_heading" placeholder="New note..."><br><textarea id="new_note_body" style="font-size:14px;width:97%;height: 200px;"></textarea>';
	var okText='Save';
	var cancelText='Cancel';
	var okClick='saveNewNoteClick();';
	var cancelClick='$("#simple_popup_2").hide();';
	$("#simple_header_text_2").html("Create / Edit note");
	$("#simple_main_text_2").html(mainText);

	document.getElementById('simple_ok_button_2').onclick=function(){eval(okClick);};
	document.getElementById('simple_cancel_button_2').onclick=function(){eval(cancelClick);hideConfirmationPopup();};

	ad2460.noteVars.selected_note_id=0;
	ad2460.noteVars.edit_note_id=0;

	$("#simple_ok_button_text_2").html(okText);
	$("#simple_cancel_button_text_2").html(cancelText);

	$("#simple_popup_2").show();
}

function saveNewNoteClick(){
	var heading=$("#new_note_heading").val();
	var body=$("#new_note_body").val();

	if (heading=='' || body==''){
		systemFeedback(translations.general_error,'Notes require both a heading and a body...', 1, 3);
		return;
	}

	$.post('actionhandler.pl', {action:'save_note',note_id:ad2460.noteVars.edit_note_id,heading:heading, body:body}, function(data){ parseInfo(data);loadNotes();});
}

function deleteNote(id){
	var mainText="Are you sure you wish to delete this note?";
	var okText=translations.general_yes;
	var cancelText=translations.general_no;
	var okClick='hideConfirmationPopup();deleteNote2('+id+');';
	var cancelClick='hideConfirmationPopup();';
	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick);
}

function deleteNote2(id){
	$.post('actionhandler.pl', {action:'delete_note',note_id:id}, function(data){ parseInfo(data);loadNotes();selectNoNote();});
}

function selectNoNote(){
	ad2460.noteVars.selected_note_id=0;
	$("#selected_note_subject").html("No note selected");
	$("#selected_note")	.html(" ");

}

function fetchGalayNews(){
	$.post('actionhandler.pl', {action:'fetch_galaxy_news'}, function(data){ parseInfo(data);});
}


function clearGalaxyNews(){
	ad2460.galaxyNews=new Array;
	$("#galactic_news_container").empty();
}

function renderGalaxyNews(){

	//ad2460.galaxyNews.sort(function(a,b){return b.timestamp-a.timestamp;});

	ad2460.galaxyNews.sort(function(a,b){
		if (a.news_type==12){
			return 1;
		}
		if (b.news_type==12){
			return -1;
		}
		else {return (b.timestamp-a.timestamp)/100000;}
	});

	var i=0;
	var parent=document.getElementById('galactic_news_container');
	for (i=0;i<ad2460.galaxyNews.length;i++){
		var g=ad2460.galaxyNews[i];
		if(g.news_type==1){
			//mighty_clashes
			if (g.left_image==''){
				g.left_image='none.jpg';
			}
			if (g.right_image==''){
				g.right_image='none.jpg';
			}
			var container=createSingleElement('div', 'news_ticker_entry versus', '', '', 'viewCombatSummaryClick('+g.num_val_1+')');
			var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title;
			var av1;
			var av2;
			var name1;
			var name2;

			if (g.num_val_2>0){
				av1=createSingleElement('img', 'ticker_avatar att_avatar', '', 'images/uploads/avatars/'+g.left_image, '');
				av2=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/avatars/'+g.right_image, '');
				name1=createSingleElement('div', 'ticker_name att_name', '', g.string_val_1, '');
				name2=createSingleElement('div', 'ticker_name def_name', '', g.string_val_2, '');
				title=createSingleElement('div', 'ticker_title', '', 'Mighty Clash', '');
			}
			else{
				av1=createSingleElement('img', 'ticker_avatar att_avatar', '', 'images/uploads/alliancelogos/'+g.left_image, '');
				av2=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/alliancelogos/'+g.right_image, '');

				// av1=createSingleElement('img', 'ticker_avatar att_avatar', '', 'images/uploads/alliancelogos/'+g.left_image, '');
				// av2=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/alliancelogos/'+g.right_image, '');
				name1=createSingleElement('div', 'ticker_name att_name ally_fight', '', g.string_val_1, '');
				name2=createSingleElement('div', 'ticker_name def_name ally_fight', '', g.string_val_2, '');
				title=createSingleElement('div', 'ticker_title', '', 'Territorial dispute', '');
			}

			container.appendChild(av1);
			container.appendChild(av2);

			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name1);
			container.appendChild(name2);
			container.appendChild(timestamp);

			parent.appendChild(container);
		}

		if(g.news_type==2){
			//Awesome robbery
			if (g.left_image==''){
				g.left_image='none.jpg';
			}
			if (g.right_image==''){
				g.right_image='none.jpg';
			}

			var container=createSingleElement('div', 'news_ticker_entry versus', '', '', 'viewCombatSummaryClick('+g.num_val_1+')');

			var av1=createSingleElement('img', 'ticker_avatar att_avatar', '', 'images/uploads/avatars/'+g.left_image, '');
			var av2=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/avatars/'+g.right_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'Awesome Robbery', '');
			var name1=createSingleElement('div', 'ticker_name att_name', '', g.string_val_1, '');
			var name2=createSingleElement('div', 'ticker_name def_name', '', g.string_val_2, '');
			var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');


			container.appendChild(av1);
			container.appendChild(av2);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name1);
			container.appendChild(name2);
			container.appendChild(timestamp);
			parent.appendChild(container);
		}

		if(g.news_type==3){
			//Slaughter
			if (g.left_image==''){
				g.left_image='none.jpg';
			}
			if (g.right_image==''){
				g.right_image='none.jpg';
			}

			var container=createSingleElement('div', 'news_ticker_entry versus', '', '', 'viewCombatSummaryClick('+g.num_val_1+')');
			var av1=createSingleElement('img', 'ticker_avatar att_avatar', '', 'images/uploads/avatars/'+g.left_image, '');
			var av2=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/avatars/'+g.right_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'Slaughter', '');
			var name1=createSingleElement('div', 'ticker_name att_name', '', g.string_val_1, '');
			var name2=createSingleElement('div', 'ticker_name def_name', '', g.string_val_2, '');
			var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');



			container.appendChild(av1);
			container.appendChild(av2);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name1);
			container.appendChild(name2);
			container.appendChild(timestamp);
			parent.appendChild(container);
		}


		if(g.news_type==4){
			//Magellan
			if (g.left_image==''){
				g.left_image='none.jpg';
			}

			var container=createSingleElement('div', 'news_ticker_entry', '', '', 'loadPlayerInfo('+g.num_val_1+')');
			var av1=createSingleElement('img', 'ticker_avatar', '', 'images/uploads/avatars/'+g.left_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'The Magellan', '');
			var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
			var value=createSingleElement('div', 'ticker_value', '', 'Clusters: '+g.num_val_2, '');
			var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');



			container.appendChild(av1);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name);
			container.appendChild(value);
			container.appendChild(timestamp);
			parent.appendChild(container);
		}

		if(g.news_type==5){
			//Attacking poodle
			if (g.left_image==''){
				g.left_image='none.jpg';
			}
			if (g.right_image==''){
				g.right_image='none.jpg';
			}

			var container=createSingleElement('div', 'news_ticker_entry versus', '', '', 'viewCombatSummaryClick('+g.num_val_1+')');
			var av1=createSingleElement('img', 'ticker_avatar att_avatar', '', 'images/uploads/avatars/'+g.left_image, '');
			var av2=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/avatars/'+g.right_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'Attacking Poodle', '');
			var name1=createSingleElement('div', 'ticker_name att_name', '', g.string_val_1, '');
			var name2=createSingleElement('div', 'ticker_name def_name', '', g.string_val_2, '');
			var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');

			container.appendChild(av1);
			container.appendChild(av2);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name1);
			container.appendChild(name2);
			container.appendChild(timestamp);

			parent.appendChild(container);
		}
		if(g.news_type==6){
			//Defending Poodle
			if (g.left_image==''){
				g.left_image='none.jpg';
			}
			if (g.right_image==''){
				g.right_image='none.jpg';
			}

			var container=createSingleElement('div', 'news_ticker_entry versus', '', '', 'viewCombatSummaryClick('+g.num_val_1+')');
			var av1=createSingleElement('img', 'ticker_avatar att_avatar', '', 'images/uploads/avatars/'+g.left_image, '');
			var av2=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/avatars/'+g.right_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'Defending Poodle', '');
			var name1=createSingleElement('div', 'ticker_name att_name', '', g.string_val_1, '');
			var name2=createSingleElement('div', 'ticker_name def_name', '', g.string_val_2, '');
			var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');



			container.appendChild(av1);
			container.appendChild(av2);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name1);
			container.appendChild(name2);
			container.appendChild(timestamp);

			parent.appendChild(container);
		}

		if(g.news_type==7){
			//Drums of war
			if (g.left_image==''){
				g.left_image='none.jpg';
			}

			var container=createSingleElement('div', 'news_ticker_entry alliance', '', '', 'loadAllianceInfo('+g.num_val_1+')');
			var av1=createSingleElement('img', 'ticker_avatar', '', 'images/uploads/alliancelogos/'+g.left_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'Drums Of War', '');
			var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
			var value=createSingleElement('div', 'ticker_value', '', 'Attacks: '+g.num_val_2, '');
			var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');

			container.appendChild(av1);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name);
			container.appendChild(value);
			container.appendChild(timestamp);

			parent.appendChild(container);
		}
		if(g.news_type==8){
			//The Shield
			if (g.left_image==''){
				g.left_image='none.jpg';
			}

			var container=createSingleElement('div', 'news_ticker_entry alliance', '', '', 'loadAllianceInfo('+g.num_val_1+')');
			var av1=createSingleElement('img', 'ticker_avatar', '', 'images/uploads/alliancelogos/'+g.left_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'The Shield', '');
			var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
			var value=createSingleElement('div', 'ticker_value', '', 'Def Wins: '+g.num_val_2, '');
			var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');

			container.appendChild(av1);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name);
			container.appendChild(value);
			container.appendChild(timestamp);

			parent.appendChild(container);
		}
		if(g.news_type==9){
			//Sector takeovers
			if (g.left_image==''){
				g.left_image='none.jpg';
			}
			// right_image holds previous alliance name!

			var container=createSingleElement('div', 'news_ticker_entry sector_takeover', '', '', 'zoomInTo('+g.num_val_3+','+g.num_val_4+')');
			var av1=createSingleElement('img', 'ticker_avatar', '', 'images/uploads/alliancelogos/'+g.left_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'Sector Takeover', '');
			var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
			//var value=createSingleElement('div', 'ticker_value', '', g.string_val_2, '');
			var value=createSingleElement('div', 'ticker_value', '', '<span class="all_takeover">'+g.string_val_2+'</span> has defeated <span class="all_takeover">'+g.right_image+'</span> and controls the sector.', '');
			var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');

			container.appendChild(av1);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name);
			container.appendChild(value);
			container.appendChild(timestamp);

			parent.appendChild(container);
		}
		if(g.news_type==10){
			//Most wanted
			if (g.left_image==''){
				g.left_image='none.jpg';
			}
			var container=createSingleElement('div', 'news_ticker_entry most_wanted', '', '', 'loadPlayerInfo('+g.num_val_3+')');
			var av1=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/avatars/'+g.left_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'Most Wanted', '');
			var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
			var value=createSingleElement('div', 'ticker_value', '', g.string_val_2+' credits', '');

			container.appendChild(av1);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name);
			container.appendChild(value);
			//container.appendChild(timestamp);

			parent.appendChild(container);
		}
		if(g.news_type==11){
			//Bounty-hunter
			if (g.left_image==''){
				g.left_image='none.jpg';
			}
			var container=createSingleElement('div', 'news_ticker_entry bounty_hunter', '', '', 'loadPlayerInfo('+g.num_val_3+')');
			var av1=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/avatars/'+g.left_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'Bounty Hunter', '');
			var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
			var value=createSingleElement('div', 'ticker_value', '', g.string_val_2+' credits', '');

			container.appendChild(av1);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name);
			container.appendChild(value);
			//container.appendChild(timestamp);

			parent.appendChild(container);
		}
		if(g.news_type==12){
			//Behemoth
			if (g.left_image==''){
				g.left_image='none.jpg';
			}
			var container=createSingleElement('div', 'news_ticker_entry behemoth', '', '', 'loadPlayerInfo('+g.num_val_3+')');
			var av1=createSingleElement('img', 'ticker_avatar def_avatar', '', 'images/uploads/avatars/'+g.right_image, '');
			var bg=createSingleElement('div', 'ticker_bg', '', '', '');
			var logo=createSingleElement('div', 'ticker_logo', '', '', '');
			var title=createSingleElement('div', 'ticker_title', '', 'Behemoth', '');
			var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
			var value=createSingleElement('div', 'ticker_value', '', prettyPrint(g.num_val_1)+' Strength', '');

			container.appendChild(av1);
			container.appendChild(bg);
			container.appendChild(logo);
			container.appendChild(title);
			container.appendChild(name);
			container.appendChild(value);
			//container.appendChild(timestamp);

			parent.appendChild(container);
		}
	}
	updateRightTickerEntry();
}


function updateRightTickerEntry(){
	if(ad2460.galaxyNews.length<1){
		return;
	}

	var i=Math.floor(Math.random()*ad2460.galaxyNews.length);
	var g=ad2460.galaxyNews[i];

	var parent=document.getElementById('ticker_view');
	$("#ticker_view").empty();

	// The VS-design
	var titlestring=ad2460.galaxyNewsTitles[g.news_type];



	$("#ticker_view").removeClass("alliance").removeClass("versus").removeClass("sector_takeover").removeClass("most_wanted").removeClass("bounty_hunter");

	if (g.news_type==7 || g.news_type==8){
		$("#ticker_view").addClass("alliance");
	}


	if (g.news_type==1 || g.news_type==2 || g.news_type==3 || g.news_type==5 || g.news_type==6 ){
		$("#ticker_view").addClass("versus");

		var extra_name_class='';

		if (g.news_type==1 && g.num_val_2==0){
			extra_name_class='ally_fight';
			titlestring='Territorial dispute';
		}

		var bg=createSingleElement('div', 'ticker_bg', '', '', '');
		var logo=createSingleElement('div', 'ticker_logo', '', '', '');
		var title=createSingleElement('div', 'ticker_title', '', titlestring, '');
		var name=createSingleElement('div', 'ticker_name att_name '+extra_name_class, '', g.string_val_1, '');
		var value=createSingleElement('div', 'ticker_name def_name '+extra_name_class, '', g.string_val_2, '');
		var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');

		parent.appendChild(bg);
		parent.appendChild(logo);
		parent.appendChild(title);
		parent.appendChild(name);
		parent.appendChild(value);
		parent.appendChild(timestamp);
		/*
		<div class="ticker_bg"></div>
		<div class="ticker_logo"></div>
		<div class="ticker_title">Bank Robber</div>
		<div class="ticker_name att_name">Aileenye</div>
		<div class="ticker_name def_name">Bada Bing &amp; Co.</div>
		*/
	}
	else if (g.news_type==9){
		$("#ticker_view").addClass("sector_takeover");

		var titlestring=ad2460.galaxyNewsTitles[g.news_type];

		var bg=createSingleElement('div', 'ticker_bg', '', '', '');
		var logo=createSingleElement('div', 'ticker_logo', '', '', '');
		var title=createSingleElement('div', 'ticker_title', '', titlestring, '');
		var name=createSingleElement('div', 'ticker_name att_name', '', g.string_val_1, '');
		var value=createSingleElement('div', 'ticker_name def_name', '', g.string_val_2, '');
		//var value=createSingleElement('div', 'ticker_name def_name', '', '<span class="all_takeover">'+g.string_val_2+'</span> PWND <span class="all_takeover">'+g.right_image+'</span>', '');
		var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');



		parent.appendChild(bg);
		parent.appendChild(logo);
		parent.appendChild(title);
		parent.appendChild(name);
		parent.appendChild(value);
		parent.appendChild(timestamp);

	}
	else if (g.news_type==10){
		$("#ticker_view").addClass("most_wanted");

		var titlestring=ad2460.galaxyNewsTitles[g.news_type];

		var bg=createSingleElement('div', 'ticker_bg', '', '', '');
		var logo=createSingleElement('div', 'ticker_logo', '', '', '');
		var title=createSingleElement('div', 'ticker_title', '', titlestring, '');
		var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
		var value=createSingleElement('div', 'ticker_value', '', g.string_val_2+' credits', '');
		//var value=createSingleElement('div', 'ticker_name def_name', '', '<span class="all_takeover">'+g.string_val_2+'</span> PWND <span class="all_takeover">'+g.right_image+'</span>', '');

		parent.appendChild(bg);
		parent.appendChild(logo);
		parent.appendChild(title);
		parent.appendChild(name);
		parent.appendChild(value);
	}
	else if (g.news_type==11){
		$("#ticker_view").addClass("bounty_hunter");

		var titlestring=ad2460.galaxyNewsTitles[g.news_type];

		var bg=createSingleElement('div', 'ticker_bg', '', '', '');
		var logo=createSingleElement('div', 'ticker_logo', '', '', '');
		var title=createSingleElement('div', 'ticker_title', '', titlestring, '');
		var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
		var value=createSingleElement('div', 'ticker_value', '', g.string_val_2+' credits', '');
		//var value=createSingleElement('div', 'ticker_name def_name', '', '<span class="all_takeover">'+g.string_val_2+'</span> PWND <span class="all_takeover">'+g.right_image+'</span>', '');

		parent.appendChild(bg);
		parent.appendChild(logo);
		parent.appendChild(title);
		parent.appendChild(name);
		parent.appendChild(value);
	}
	else if (g.news_type==12){
		$("#ticker_view").addClass("behemoth");

		var titlestring=ad2460.galaxyNewsTitles[g.news_type];

		var bg=createSingleElement('div', 'ticker_bg', '', '', '');
		var logo=createSingleElement('div', 'ticker_logo', '', '', '');
		var title=createSingleElement('div', 'ticker_title', '', titlestring, '');
		var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
		var value=createSingleElement('div', 'ticker_value', '', prettyPrint(g.num_val_1)+' Strength', '');
		//var value=createSingleElement('div', 'ticker_name def_name', '', '<span class="all_takeover">'+g.string_val_2+'</span> PWND <span class="all_takeover">'+g.right_image+'</span>', '');

		parent.appendChild(bg);
		parent.appendChild(logo);
		parent.appendChild(title);
		parent.appendChild(name);
		parent.appendChild(value);
	}
	else {

		var extraString=ad2460.galaxyNewsStrings[g.news_type];

		var img;
		if (g.news_type==4){
			img=createSingleElement('img', 'ticker_avatar', '', 'images/uploads/avatars/'+g.left_image, '');
		}
		else {
			img=createSingleElement('img', 'ticker_avatar', '', 'images/uploads/alliancelogos/'+g.left_image, '');
		}


		var bg=createSingleElement('div', 'ticker_bg', '', '', '');
		var logo=createSingleElement('div', 'ticker_logo', '', '', '');
		var title=createSingleElement('div', 'ticker_title', '', titlestring, '');
		var name=createSingleElement('div', 'ticker_name', '', g.string_val_1, '');
		var value=createSingleElement('div', 'ticker_value', '', extraString+''+g.num_val_2, '');
		var timestamp=createSingleElement('div', 'ticker_timestamp', '', secondsToFullTimeNosecs(ad2460.serverTime-g.timestamp), '');

		parent.appendChild(img);
		parent.appendChild(bg);
		parent.appendChild(logo);
		parent.appendChild(title);
		parent.appendChild(name);
		parent.appendChild(value);
		parent.appendChild(timestamp);

		/*
		<img src="images/fixed/avartar2.jpg" width="76" class="ticker_avatar">
		<div class="ticker_bg"></div>
		<div class="ticker_logo"></div>
		<div class="ticker_title">Bank Robber</div>
		<div class="ticker_name">Aileenye</div>
		<div class="ticker_value">2.986.298.568</div>
		*/
	}


}


function notifyMe(msg) {
	// Let's check if the browser supports notifications
	if (!("Notification" in window)) {
		return;
	}
	// Let's check whether notification permissions have already been granted
	else if (Notification.permission === "granted") {
		// If it's okay let's create a notification
		var notification = new Notification(msg);
  	}

	// Otherwise, we need to ask the user for permission
	else if (Notification.permission !== 'denied') {
		Notification.requestPermission(function (permission) {
		// If the user accepts, let's create a notification
			if (permission === "granted") {
				var notification = new Notification("Hi there!");
			}
		} ) ;
  	}
	// Finally, if the user has denied notifications and you
	// want to be respectful there is no need to bother them any more.
}

/* test to extend GUI */
function extendGui(){
	ad2460.extendedGUI=true;
	$(".main_bg").addClass("extended_main_bg");
	$(".main_content_container").addClass("extended_main_content_container");
	$(".guibottom").addClass("extended_guibottom");
	$(".chatpane").addClass("extended_chatpane");
	$(".bottompanel").addClass("extended_bottompanel");
	$(".chatbg").addClass("extended_chatbg");
	$(".starmap_bottomslider").addClass("extended_starmap_bottomslider");
	$(".bottomslider").addClass("extended_bottomslider");

	//$(".notesbutton").addClass("extended_notesbutton");
	//$(".rankingsbutton").addClass("extended_rankingsbutton");
	//$(".techbutton").addClass("extended_techbutton");
	//$(".shortcut01").addClass("extended_shortcut01");
	//$(".forumsbutton").addClass("extended_forumsbutton");
	//$(".messagesbutton").addClass("extended_messagesbutton");
	//$(".chat_functions").addClass("extended_chat_functions");

	$(".chat_func_4").addClass("extended_chat_func_4");
	$(".tip_of_the_day").addClass("extended_tip_of_the_day");

	$(".forumheaderdisplay").addClass("extended_forumheaderdisplay");

	// $(".gameinfobutton").addClass("extended_gameinfobutton");

	$(".chat_input").addClass("extended_chat_input");

	//$("#unused_tech_points_indicator").addClass('extended_unused_tech_points');
	//$("#points_msg_unread_msg_indicator").addClass('extended_unread_msg');

	$("#close_battle").addClass('extended_close_battle_button');
	$("#battle_stats_field").addClass('extended_battle_stats_field');
	$("#helper_checklist").addClass('extended_helper_checklist');

	//$("#checklist_initiate").addClass('extended_checklist_button');

	renderAllianceFrontMOTD();
	scrollChatToBottom();
}

function unextendGui(){
	ad2460.extendedGUI=false;
	$(".main_bg").removeClass("extended_main_bg");
	$(".main_content_container").removeClass("extended_main_content_container");
	$(".guibottom").removeClass("extended_guibottom");
	$(".chatpane").removeClass("extended_chatpane");
	$(".bottompanel").removeClass("extended_bottompanel");
	$(".chatbg").removeClass("extended_chatbg");
	$(".starmap_bottomslider").removeClass("extended_starmap_bottomslider");
	$(".bottomslider").removeClass("extended_bottomslider");

	//$(".notesbutton").removeClass("extended_notesbutton");
	//$(".rankingsbutton").removeClass("extended_rankingsbutton");
	//$(".techbutton").removeClass("extended_techbutton");
	//$(".shortcut01").removeClass("extended_shortcut01");
	//$(".forumsbutton").removeClass("extended_forumsbutton");
	//$(".messagesbutton").removeClass("extended_messagesbutton");
	//$(".chat_functions").removeClass("extended_chat_functions");

	$(".chat_func_4").removeClass("extended_chat_func_4");
	$(".tip_of_the_day").removeClass("extended_tip_of_the_day");

	$(".forumheaderdisplay").removeClass("extended_forumheaderdisplay");

	// $(".gameinfobutton").removeClass("extended_gameinfobutton");

	$(".chat_input").removeClass("extended_chat_input");

	//$("#unused_tech_points_indicator").removeClass('extended_unused_tech_points');
	//$("#points_msg_unread_msg_indicator").removeClass('extended_unread_msg');

	$("#close_battle").removeClass('extended_close_battle_button');
	$("#battle_stats_field").removeClass('extended_battle_stats_field');
	$("#helper_checklist").removeClass('extended_helper_checklist');

	$("#checklist_initiate").removeClass('extended_checklist_button');

	renderAllianceFrontMOTD();
	scrollChatToBottom();
}


function spendCodeClick(){
	var code=document.getElementById('reward_code').value;
	if (code == ''){
		systemFeedback(translations.general_error,'Invalid code', 1, 3);
		return;
	}
	$.post('actionhandler.pl', {action:'validate_code', code:code}, function(data){ parseInfo(data);});
}

function clearCodeInputField(){
	document.getElementById('reward_code').value='';
}

function pay2winClick(){
	// humour-function, show a popup with you win and charge five credits!
	$.post('actionhandler.pl', {action:'pay_2_win'}, function(data){ parseInfo(data);});

}

var globalYouWinId;
var globalYouWinCanvasId;
var globalYouWinCtx;
var globalYouWinFrame=0;
var globalYouWinParticles=new Array;

function removeYouWinCanvas(){
	cleanupYouWinAnim();
	//console.log("Firework loop ended!");
	$("#you_win_canvas").remove();

}

function cleanupYouWinAnim(){
	cancelAnimationFrame(globalYouWinId);
	globalYouWinCanvasId.width=475;
	globalYouWinCanvasId.height=200;
	globalYouWinCtx.clearRect(0,0,475, 200);
	globalYouWinParticles=new Array;
}

function random( min, max ) {
	return Math.floor(Math.random() * ( max - min ) + min);
}

function doYouWinCanvas(){
	globalYouWinFrame=0;
	globalYouWinCanvasId=document.getElementById('you_win_canvas');
	globalYouWinCtx=globalYouWinCanvasId.getContext('2d');
	globalYouWinCanvasId.width=475;
	globalYouWinCanvasId.height=200;
	globalYouWinCtx.clearRect(0,0,475, 200);
	setTimeout(function(){ updateYouWinCanvas();}, 250);

	globalYouWinParticles=new Array;
	var exps=50;
	for (var i=0;i<exps ;i++ ){
		globalYouWinParticles.push({x: random(50,globalYouWinCanvasId.width-50), y: random(25,globalYouWinCanvasId.height-25), delay: random(1,400), currentFrame:0, material:explosionImage1, type:'e1' });
	}
	for (var i=0;i<exps ;i++ ){
		globalYouWinParticles.push({x: random(50,globalYouWinCanvasId.width-50), y: random(25,globalYouWinCanvasId.height-25), delay: random(1,400), currentFrame:0, material:explosionImage4, type:'e2' });
	}
	for (var i=0;i<exps ;i++ ){
		globalYouWinParticles.push({x: random(50,globalYouWinCanvasId.width-50), y: random(25,globalYouWinCanvasId.height-25), delay: random(1,400), currentFrame:0, material:explosionImage5, type:'e3' });
	}
	for (var i=0;i<exps ;i++ ){
		globalYouWinParticles.push({x: random(50,globalYouWinCanvasId.width-50), y: random(25,globalYouWinCanvasId.height-25), delay: random(1,400), currentFrame:0, material:volatilityExplosionImage, type:'e4' });
	}
}

function updateYouWinCanvas(){
	globalYouWinCtx.clearRect(0,0,475, 200);
	globalYouWinFrame++;

	var i=0;
	for (i=0;i<globalYouWinParticles.length ;i++ ){
		if (globalYouWinFrame>=globalYouWinParticles[i].delay && globalYouWinFrame<globalYouWinParticles[i].delay+12 && globalYouWinParticles[i].type =='e1'){
			var animFrameToDraw=globalYouWinFrame-globalYouWinParticles[i].delay;
			var frameWidth=134;
			var startX=frameWidth*(animFrameToDraw);
			var startY=0;
			globalYouWinCtx.drawImage(globalYouWinParticles[i].material,startX, startY, frameWidth,frameWidth, globalYouWinParticles[i].x-(frameWidth/2), globalYouWinParticles[i].y-(frameWidth/2),frameWidth,frameWidth);
			globalYouWinParticles[i].currentFrame++;
		}
		if (globalYouWinFrame>=globalYouWinParticles[i].delay && globalYouWinFrame<globalYouWinParticles[i].delay+19 && globalYouWinParticles[i].type =='e2'){
			var animFrameToDraw=globalYouWinFrame-globalYouWinParticles[i].delay;
			var frameWidth=64;
			var startX=frameWidth*(animFrameToDraw);
			var startY=0;
			globalYouWinCtx.drawImage(globalYouWinParticles[i].material,startX, startY, frameWidth,frameWidth, globalYouWinParticles[i].x-(frameWidth/2), globalYouWinParticles[i].y-(frameWidth/2),frameWidth,frameWidth);
			globalYouWinParticles[i].currentFrame++;
		}
		if (globalYouWinFrame>=globalYouWinParticles[i].delay && globalYouWinFrame<globalYouWinParticles[i].delay+32 && globalYouWinParticles[i].type =='e3'){
			var animFrameToDraw=globalYouWinFrame-globalYouWinParticles[i].delay;
			var frameWidth=80;
			var startX=frameWidth*(animFrameToDraw);
			var startY=0;
			globalYouWinCtx.drawImage(globalYouWinParticles[i].material,startX, startY, frameWidth,frameWidth, globalYouWinParticles[i].x-(frameWidth/2), globalYouWinParticles[i].y-(frameWidth/2),frameWidth,frameWidth);
			globalYouWinParticles[i].currentFrame++;
		}
		if (globalYouWinFrame>=globalYouWinParticles[i].delay && globalYouWinFrame<globalYouWinParticles[i].delay+36 && globalYouWinParticles[i].type =='e4'){
			var animFrameToDraw=globalYouWinFrame-globalYouWinParticles[i].delay;
			var frameWidth=80;
			var startX=frameWidth*(animFrameToDraw);
			var startY=0;
			globalYouWinCtx.drawImage(globalYouWinParticles[i].material,startX, startY, frameWidth,frameWidth, globalYouWinParticles[i].x-(frameWidth/2), globalYouWinParticles[i].y-(frameWidth/2),frameWidth,frameWidth);
			globalYouWinParticles[i].currentFrame++;
		}
	}


	// Do whatever
	globalYouWinId=requestAnimationFrame(updateYouWinCanvas);

}

function reActivateOldUser(xp,level){
	showConfirmationPopup("An old account registered with this email has been detected. The old account is at level "+level+". Do you wish to continue that game or restart from level 1?<br><br><span style='color:red'>Clicking 'Restart' will delete the old account permanently and you will start at level 1.</span>", "Continue", "Restart", "confirmReActivateOldUser()", "denyReactivation()", false, false);
}

function confirmReActivateOldUser(){
	$.post('actionhandler.pl', {action:'reactivate_old_user'}, function(data){ parseInfo(data);});
}

function denyReactivation(){
	$.post('actionhandler.pl', {action:'deny_reactivation'}, function(data){ parseInfo(data);});
}

function loadPlayerInfo(id){
	$.post('actionhandler.pl', {action:'fetch_player_info', player_id:id}, function(data){ parseInfo(data);});
}

function closeInfoAndInitiateConversationWithName(name){
	hidePlayerInfoPopup();
	initiateConversationWithName(name);
}

function showPlayerInfoPopup(p){
	hideSimpleBox();
	if (p.hasOwnProperty('nickname') ) {

		// player_id
		$("#player_info_nickname").html(p.nickname);
		$("#player_info_homeworld_name").html(p.homeworld_name);
		$("#player_info_homeworld_name").off("click");
		document.getElementById('player_info_homeworld_name').setAttribute("onclick","zoomInToXY("+p.homeworld_x+","+p.homeworld_y+")");

		$("#player_info_msglink").off("click");
		if (ad2460.mobilebrowser){
			document.getElementById('player_info_msglink').setAttribute("onclick","closeInfoAndInitiateConversationWithName('"+p.nickname+"')");
		}
		else {
			document.getElementById('player_info_msglink').setAttribute("onclick","initiateConversationWithName('"+p.nickname+"')");
		}


		$("#player_info_wargamelink").off("click");
		document.getElementById('player_info_wargamelink').setAttribute("onclick","playerInfoChallengeClick('"+p.nickname+"')");

		// check the invite-button
		var access=0;
		if (ad2460.allianceData.id>0){
			access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_invitation;
		}

		document.getElementById("player_info_invitelink").setAttribute("onclick",null);
		if (p.alliance_id==0 && access>0){
			$("#player_info_invitelink").show();
			document.getElementById('player_info_invitelink').setAttribute("onclick","allianceInviteButtonClick('"+p.nickname+"')");
		}
		else {
			$("#player_info_invitelink").hide();
		}


		$("#player_info_view_intel_button").off("click");
		document.getElementById('player_info_view_intel_button').setAttribute("onclick","viewIntelReport(0,"+p.homeworld_id+","+p.player_id+","+p.alliance_id+",'intel')");


		$("#player_info_wargames_my_wins").html(prettyPrint(p.wargames_won));
		$("#player_info_wargames_my_losses").html(prettyPrint(p.wargames_lost));

		var wargames_win_percent=0;
		if (p.wargames_won+p.wargames_lost>0){
			wargames_win_percent=Math.floor(p.wargames_won*100/(p.wargames_won+p.wargames_lost));
		}
		$("#player_info_wargames_my_winpercent").html(wargames_win_percent+" %");

		$("#player_info_avatar").attr("src","/images/uploads/avatars/"+p.avatar);

		$("#player_info_alliance_name").off("click");
		document.getElementById('player_info_alliance_name').setAttribute("onclick","loadAllianceInfo("+p.alliance_id+")");

		$("#player_info_alliance_name").html(p.alliance_name);

		$("#player_info_level").html(p.level);
		$("#player_info_strength").html(prettyPrint(p.strength));
		$("#player_info_score").html(prettyPrint(p.score));

		document.getElementById('player_info_total_bounty').style.cursor='default';
		$("#player_info_total_bounty").off("click");
		document.getElementById('player_info_total_bounty').setAttribute("onclick",null);



		if (p.total_bounty<1){
			$("#player_info_total_bounty").html("There is no bounty on this player");
		}
		else {
			$("#player_info_total_bounty").html(p.total_bounty+ " credits");
			document.getElementById('player_info_total_bounty').style.cursor='help';
			document.getElementById('player_info_total_bounty').setAttribute("onclick","getBountyDetails("+p.player_id+")");

		}

		removeChildNodes('player_info_wargames_container');
		removeChildNodes('player_info_combats_container');

		$("#player_info_wargames_heading").html("Wargames VS "+p.nickname);

		var parent=document.getElementById('player_info_wargames_container');

		if (p.last_wargames_1_id>0){
			var o=createSingleElement('div', 'tableselection', '', '', 'loadFirstDataForCombat('+p.last_wargames_1_id+')');
			var i1=createSingleElement('div', 'table_combat_log_location', '', p.last_wargames_1_location, '');
			var i2=createSingleElement('div', 'table_combat_log_outcome', '', p.last_wargames_1_result, '');

			o.appendChild(i1);
			o.appendChild(i2);
			parent.appendChild(o);
		}

		if (p.last_wargames_2_id>0){
			var o=createSingleElement('div', 'tableselection', '', '', 'loadFirstDataForCombat('+p.last_wargames_2_id+')');
			var i1=createSingleElement('div', 'table_combat_log_location', '', p.last_wargames_2_location, '');
			var i2=createSingleElement('div', 'table_combat_log_outcome', '', p.last_wargames_2_result, '');

			o.appendChild(i1);
			o.appendChild(i2);
			parent.appendChild(o);
		}

		if (p.last_wargames_3_id>0){
			var o=createSingleElement('div', 'tableselection', '', '', 'loadFirstDataForCombat('+p.last_wargames_3_id+')');
			var i1=createSingleElement('div', 'table_combat_log_location', '', p.last_wargames_3_location, '');
			var i2=createSingleElement('div', 'table_combat_log_outcome', '', p.last_wargames_3_result, '');

			o.appendChild(i1);
			o.appendChild(i2);
			parent.appendChild(o);
		}

		var parent=document.getElementById('player_info_combats_container');

		if (p.last_combats_1_id>0){
			var o=createSingleElement('div', 'tableselection', '', '', 'loadFirstDataForCombat('+p.last_combats_1_id+')');
			var i1=createSingleElement('div', 'table_combat_log_location', '', p.last_combats_1_location, '');
			var i2=createSingleElement('div', 'table_combat_log_outcome', '', p.last_combats_1_result, '');

			o.appendChild(i1);
			o.appendChild(i2);
			parent.appendChild(o);
		}

		if (p.last_combats_2_id>0){
			var o=createSingleElement('div', 'tableselection', '', '', 'loadFirstDataForCombat('+p.last_combats_2_id+')');
			var i1=createSingleElement('div', 'table_combat_log_location', '', p.last_combats_2_location, '');
			var i2=createSingleElement('div', 'table_combat_log_outcome', '', p.last_combats_2_result, '');

			o.appendChild(i1);
			o.appendChild(i2);
			parent.appendChild(o);
		}

		if (p.last_combats_3_id>0){
			var o=createSingleElement('div', 'tableselection', '', '', 'loadFirstDataForCombat('+p.last_combats_3_id+')');
			var i1=createSingleElement('div', 'table_combat_log_location', '', p.last_combats_3_location, '');
			var i2=createSingleElement('div', 'table_combat_log_outcome', '', p.last_combats_3_result, '');

			o.appendChild(i1);
			o.appendChild(i2);
			parent.appendChild(o);
		}

		if (p.vip_icon != '' && p.vip_icon != 'none'){
			$("#player_info_vip_icon").attr("src","images/icons/vip/forum/"+p.vip_icon).attr("title","VIP").show();
			if (p.vip_icon=='dev.png'){
				$("#player_info_vip_icon").attr("title","DEV");
			}
		}
		else {
			$("#player_info_vip_icon").attr("src","images/icons/vip/forum/none.gif").hide();
		}

		$("#admin_ban_button").off("click");
		$("#admin_ban_button").hide();
		$("#admin_unban_button").off("click");
		$("#admin_unban_button").hide();

		if (ad2460.admin_status>0) {
			$("#admin_ban_button").show();
			document.getElementById('admin_ban_button').setAttribute("onclick","chatban("+p.player_id+")");
			$("#admin_unban_button").show();
			document.getElementById('admin_unban_button').setAttribute("onclick","unban("+p.player_id+")");
		}
	}

	$("#playerinfo_popup").show();
}

function loadAllianceInfo(id){
	$.post('actionhandler.pl', {action:'fetch_alliance_info', aid:id}, function(data){ parseInfo(data);});
}
function showAllianceInfoPopup(p){
	//alliance_id , name , avatar , strength , avg_strength , strength_ranking , score_ranking , leader_name , leader_id , recruiter_name , recruiter_id ,
	//last_combats_1_id  , last_combats_1_location , last_combats_1_att_nickname , last_combats_1_def_nickname , last_combats_1_location , last_combats_1_result , last_combats_2_id , last_combats_2_location , last_combats_2_result , last_combats_3_id , last_combats_3_location , last_combats_3_result

	$("#alliance_info_avatar").attr("src","images/uploads/alliancelogos/"+p.avatar);
	$("#alliance_info_name").html(p.name);
	$("#alliance_info_strength").html(prettyPrint(p.strength));
	$("#alliance_info_membercount").html(p.membercount);
	$("#alliance_info_avg_strength").html(prettyPrint(p.avg_strength));
	// $("#alliance_info_strength_ranking").html("# "+p.strength_ranking);
	$("#alliance_info_strength_ranking").html("# "+p.score_ranking);

	$("#alliance_info_public_text").html(p.public_text);

	$("#alliance_info_leader_name").off("click");
	document.getElementById('alliance_info_leader_name').setAttribute("onclick",null);
	$("#alliance_info_leader_name").html("-");
	if (p.leader_id>0){
		$("#alliance_info_leader_name").html(p.leader_name);
		document.getElementById('alliance_info_leader_name').setAttribute("onclick","loadPlayerInfo("+p.leader_id+")");
	}

	$("#alliance_info_recruiter_name").off("click");
	document.getElementById('alliance_info_recruiter_name').setAttribute("onclick",null);
	$("#alliance_info_recruiter_name").html("-");
	if (p.recruiter_id>0){
		$("#alliance_info_recruiter_name").html(p.recruiter_name);
		document.getElementById('alliance_info_recruiter_name').setAttribute("onclick","loadPlayerInfo("+p.recruiter_id+")");
	}

	// $("#alliance_info_view_intel_button").off("click");
	// document.getElementById('alliance_info_view_intel_button').setAttribute("onclick","viewIntelReport(0,"+"0"+","+p.leader_id+","+p.alliance_id+",'intel')");

	removeChildNodes('allianceinfo_popup_bankers');

	var parent=document.getElementById('allianceinfo_popup_bankers');
	// just need the location and the name actually
	// can link to zooming to the planet
	parent.innerHTML=p.bank_name;
	parent.style.color='#ffe868';
	parent.style.cursor='pointer';
	parent.setAttribute("onclick","zoomInToXY("+p.bank_x+","+p.bank_y+")");

	// $("#alliance_info_view_intel_button")

	//alliance_info_combats_container

	removeChildNodes('alliance_info_combats_container');
	var parent=document.getElementById('alliance_info_combats_container');

	if (p.last_combats_1_id>0){
		var o=createSingleElement('div', 'tableselection', '', '', 'loadFirstDataForCombat('+p.last_combats_1_id+')');
		var i1=createSingleElement('div', 'table_combat_log_location', '', p.last_combats_1_att_nickname, '');
		var i2=createSingleElement('div', 'table_combat_log_outcome', '', 'vs', '');
		var i3=createSingleElement('div', 'table_combat_log_location', '', p.last_combats_1_def_nickname, '');
		var i4=createSingleElement('div', 'table_combat_log_outcome', '', p.last_combats_1_result, '');

		o.appendChild(i1);
		o.appendChild(i2);
		o.appendChild(i3);
		o.appendChild(i4);
		parent.appendChild(o);
	}

	if (p.last_combats_2_id>0){
		var o=createSingleElement('div', 'tableselection', '', '', 'loadFirstDataForCombat('+p.last_combats_2_id+')');
		var i1=createSingleElement('div', 'table_combat_log_location', '', p.last_combats_2_att_nickname, '');
		var i2=createSingleElement('div', 'table_combat_log_outcome', '', 'vs', '');
		var i3=createSingleElement('div', 'table_combat_log_location', '', p.last_combats_2_def_nickname, '');
		var i4=createSingleElement('div', 'table_combat_log_outcome', '', p.last_combats_2_result, '');

		o.appendChild(i1);
		o.appendChild(i2);
		o.appendChild(i3);
		o.appendChild(i4);
		parent.appendChild(o);
	}

	if (p.last_combats_3_id>0){
		var o=createSingleElement('div', 'tableselection', '', '', 'loadFirstDataForCombat('+p.last_combats_3_id+')');
		var i1=createSingleElement('div', 'table_combat_log_location', '', p.last_combats_3_att_nickname, '');
		var i2=createSingleElement('div', 'table_combat_log_outcome', '', 'vs', '');
		var i3=createSingleElement('div', 'table_combat_log_location', '', p.last_combats_3_def_nickname, '');
		var i4=createSingleElement('div', 'table_combat_log_outcome', '', p.last_combats_3_result, '');

		o.appendChild(i1);
		o.appendChild(i2);
		o.appendChild(i3);
		o.appendChild(i4);
		parent.appendChild(o);
	}

	$("#alliance_info_declare_war_button").hide();
/*
	$("#alliance_info_declare_war_button").off("click");
	document.getElementById('alliance_info_declare_war_button').setAttribute("onclick",null);

	if (ad2460.allianceData.id>0){
		if (ad2460.allianceData.rank_id==1){
			// We are a leader and can actually wage war!
			$("#alliance_info_declare_war_button").show();
			document.getElementById('alliance_info_declare_war_button').setAttribute("onclick","declareWarClick("+p.alliance_id+")");
		}
	}
*/

	$("#allianceinfo_popup").show();

}


function hidePlayerInfoPopup(){
	$("#playerinfo_popup").hide();
}

function hideAllianceInfoPopup(){
	$("#allianceinfo_popup").hide();
}

function getBountyDetails(player_id){
	$.post('actionhandler.pl', {action:'fetch_bounty_details', player_id:player_id}, function(data){ parseInfo(data);});
}

function showBountyDetails(){
	var i=0;
	var string="";
	for (i=0;i<ad2460.playerBounties.length ;i++ ){
		string+=ad2460.playerBounties[i].nickname+" offers "+ad2460.playerBounties[i].credits+" credits for the destruction of "+ad2460.playerBounties[i].strength+".000 strength.<br>";
	}

	showSimpleBox('Bounties',string,'');
	$("#simple_popup").css({"left":"684px"});
}

function showAttacksIcon(){
	$("#attack_alert").show();
}

function attackAlertClick(){
	// ok, pop out the news-slide showing all attack-notifications only I suppose...
	toggleFullNews('attacksonly');
	$("#attack_alert").hide();
}

function donateCredits1(){
	var donateCredits=parseInt($("#donate_credits").val());
	var donateNickname=$("#donate_nickname").val();

	if (donateCredits<5){
		systemFeedback("Error", "Not enough credits.", 1, 2);
		return;
	}

	var total=donateCredits+Math.ceil(donateCredits/10);
	if (ad2460.credits < total+15){
		systemFeedback("Error","Not enough credits.", 1, 2);
	}

	$.post('actionhandler.pl', {action:'donate1', nickname:donateNickname, credits:donateCredits}, function(data){ parseInfo(data);});

}

function showDonateConfirmation(credits,nickname, donate_user_id){
	var mainText=fillIn(translations.donate_string,[credits,nickname]);
	var okText=translations.general_yes;
	var cancelText=translations.general_no;
	var okClick="donateCredits2("+credits+","+donate_user_id+")";

	showConfirmationPopup(mainText, okText, cancelText, okClick, null, false, false);
}

function donateCredits2(credits, donate_user_id){
	$.post('actionhandler.pl', {action:'donate2', donate_user_id:donate_user_id, credits:credits}, function(data){ parseInfo(data);});
}

function updateAutoResizeGui(){
	var selected_setting=document.getElementById('auto_resize_gui_dropdown').selectedIndex;
	$.post('actionhandler.pl', {action:'set_auto_resize_gui', selection:selected_setting}, function(data){ parseInfo(data);});
	if (selected_setting==1){
		resizeGuiOnWindowResize=true;
		callWindowResize();
	}
	else {
		resizeGuiOnWindowResize=false;
		$("#main_bg").css({'zoom': '100%'});
		$("#main_bg").css({'transform' : 'scale(100%,100%)'});
		$("#main_bg").css({'margin': '0px auto'});
		$("#main_bg").css({'position': 'relative'});
		testx=1;
		testy=1;
	}
}

function updateNewshipsGoToClick(){
	var selected_setting=document.getElementById('move_new_ships_to').selectedIndex;

	$.post('actionhandler.pl', {action:'set_new_ships_go_to_fleet', selection:selected_setting}, function(data){ parseInfo(data);});
}

function selectVipIcon(id){
	ad2460.temp_selected_vip_icon=id;
	$("#icon_selection .vip_icon_select").removeClass('selected');
	$("#vip_icon_0"+id).addClass('selected');
}

function purchaseVipClick(){
	var thisClass='chat_player_name col_'+zeroPad($("#vip_chat_color_select").val());
	var thisImg='images/icons/vip/forum/vip'+zeroPad(ad2460.temp_selected_vip_icon)+'.png';

	var mainText="<img height='100' width='100' style='vertical-align:middle;float:left' src='"+thisImg+"'>This will spend 50 credits and give you VIP-status in the game for 30 days. <br>You have selected this <span class='"+thisClass+"' style='margin-left:5px;margin-right:5px;'>nick-colour</span>.<br>Your selected icon and colour can not be changed until the next VIP-period.<br> Are you sure?";
	var okText="Yes";
	var cancelText="No";
	var okClick="purchaseVipConfirmed();hideConfirmationPopup();";

	showConfirmationPopup(mainText, okText, cancelText, okClick, null, false, false);
}

function purchaseVipConfirmed(){
	var icon_id=ad2460.temp_selected_vip_icon;
	var chat_class=$("#vip_chat_color_select").val();

	$.post('actionhandler.pl', {action:'purchase_vip_status', icon_id:icon_id, chat_class:chat_class}, function(data){ parseInfo(data);});
}

function renewVip(){
	var mainText="This will spend 50 credits and extend your VIP-status in the game for 30 days. <br>If you wish to change your vip-icon and chat-colour, you have to let the VIP expire and rebuy it.<br> Are you sure you wish to extend it as it is?";
	var okText="Yes";
	var cancelText="No";
	var okClick="rewnewVipConfirmed();hideConfirmationPopup();";

	showConfirmationPopup(mainText, okText, cancelText, okClick, null, false, false);
}

function changeVipColor(){
	var chat_class=$("#vip_chat_color_select_extend").val();
	$.post('actionhandler.pl', {action:'change_vip_color', chat_class:chat_class}, function(data){ parseInfo(data);});
}

function rewnewVipConfirmed(){
	$.post('actionhandler.pl', {action:'renew_vip'}, function(data){ parseInfo(data);});
}

function alertUserToExpiringVip(){
	// ok, we need to check a cookie here to see if we have displayed the warning in the past 6 hours...
	// if not, show it.

	var lastNotification=ReadCookie('lastVipRemind');
	if (lastNotification<ad2460.serverTime-(6*3600)){
		SetCookie("lastVipRemind", ad2460.serverTime, window.location.host,30);
		showOkPopup('Your VIP status is expiring soon! <br>You might want to extend your VIP under Options!','OK','');
	}
}


function updateChatColorSelect(){
	var chat_class=$("#vip_chat_color_select").val();
	var zeropadded=zeroPad(chat_class);
	$("#vip_chat_color_select").removeClass("col_01").removeClass("col_02").removeClass("col_03").removeClass("col_04").removeClass("col_05").removeClass("col_06").removeClass("col_07").removeClass("col_08").removeClass("col_09")
		.removeClass("col_10").removeClass("col_11").removeClass("col_12").removeClass("col_13").removeClass("col_14").removeClass("col_15").removeClass("col_16").removeClass("col_17").removeClass("col_18").removeClass("col_19").removeClass("col_20");
	$("#vip_chat_color_select").addClass("col_"+zeropadded);

}

function updateChatColorSelectExtend(){
	var chat_class=$("#vip_chat_color_select_extend").val();
	var zeropadded=zeroPad(chat_class);
	$("#vip_chat_color_select_extend").removeClass("col_01").removeClass("col_02").removeClass("col_03").removeClass("col_04").removeClass("col_05").removeClass("col_06").removeClass("col_07").removeClass("col_08").removeClass("col_09")
		.removeClass("col_10").removeClass("col_11").removeClass("col_12").removeClass("col_13").removeClass("col_14").removeClass("col_15").removeClass("col_16").removeClass("col_17").removeClass("col_18").removeClass("col_19").removeClass("col_20");
	$("#vip_chat_color_select_extend").addClass("col_"+zeropadded);

}

function checkInitialVipStatus(){
	if (ad2460.vip_status>ad2460.serverTime){
		hideVipOptions();
	}
	else {
		showVipOptions();
	}
}

function hideVipOptions(){
	var vip_date_time=ad2460.vip_status;
	$("#vip_pack_option").hide();
	$("#vip_pack_option_2").show();
	$("#options_vip_timer").html("<div class='vip_end_date'>You are a Very Important Player until "+formatDateTime(ad2460.vip_status)+"</div>");
	$("#vip_promotion").hide();
	$("#no_vip_promotion").show();
}

function showVipOptions(){
	$("#vip_pack_option").show();
	$("#vip_pack_option_2").hide();
	$("#vip_promotion").show();
	$("#no_vip_promotion").hide();

}

function expireVip(){
	if (ad2460.isVip==true){
		$.post('actionhandler.pl', {action:'expire_vip'}, function(data){ parseInfo(data);});
	}
}

// tech-tree-test

var _0x905a=["\x69\x6E\x74\x65\x63\x68","\x73\x74\x72\x6F\x6E\x74\x65\x63\x68","\x6E\x65\x6F\x74\x65\x63\x68"];
function autoFillTechTree(_0x6e37x2){

	ignoreTechtreeRenderUpdate=true;

	if(_0x6e37x2==_0x905a[0]){
		techItemClick(800,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(801,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(802,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(812,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(811,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(831,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(848,true,null);techtreePlusClick();
		techItemClick(823,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(832,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(849,true,null);techtreePlusClick();
		techItemClick(809,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(810,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(830,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(821,true,null);techtreePlusClick();
		techItemClick(840,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(841,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(850,true,null);techtreePlusClick();
		techItemClick(839,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(822,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
	}

	if(_0x6e37x2==_0x905a[1]){
		techItemClick(803,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(804,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(805,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(815,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(816,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(834,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(824,true,null);techtreePlusClick();
		techItemClick(826,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(835,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(852,true,null);techtreePlusClick();
		techItemClick(813,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(814,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(833,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(853,true,null);techtreePlusClick();
		techItemClick(843,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(844,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(851,true,null);techtreePlusClick();
		techItemClick(825,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(842,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
	}

	if(_0x6e37x2==_0x905a[2]){
		techItemClick(806,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(807,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(808,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(819,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(820,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(837,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(827,true,null);techtreePlusClick();
		techItemClick(829,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(838,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(854,true,null);techtreePlusClick();
		techItemClick(817,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(818,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(836,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(855,true,null);techtreePlusClick();
		techItemClick(846,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(847,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();

		techItemClick(856,true,null);techtreePlusClick();
		techItemClick(828,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
		techItemClick(845,true,null);techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();techtreePlusClick();
	}
	ignoreTechtreeRenderUpdate=false;
	renderTechTreeNewest();

}

function specialNavigateToLatestPatchNotes(){
	if (outGameHelpVisible!=1){
		$("#gameinfo").click();
	}

	$("#outgamehelp").contents().find("#upcoming").click();
	$("#outgamehelp").contents().find("#upcoming_current_patch").click();
}

function g2aPayClick(){
	var g2acredits=$("#g2acredits").val();
	$.post('actionhandler.pl', {action:'init_g2a_payment', credits:g2acredits}, function(data){ parseInfo(data);});
}

function forwardToG2A(token){
	window.location.href = "https://checkout.pay.g2a.com/index/gateway?token="+token;
}

function registerNewMissionLaunch(type){
	if (ga){
		ga('send', 'event', 'game-action', 'mission-launch', type, ad2460.user_id );
	}
}

function fetchSessionData(){
	$.post('actionhandler.pl', {action:'fetch_session_data'}, function(data){ parseInfo(data);});
}

function setupSessionReminder(){
	var secondsToExpires=ad2460.sessionExpires-ad2460.serverTime;
	var secondsToWarning=secondsToExpires-1800;

	setTimeout(function(){
		showOkPopup("Reminder: Your session will expire in 30 minutes and you will then be forced to log in again. <br>You may do so now in stead of course.<br><br><a style='color:orange;' href='http://www.ad2460.com?section=login'>Login now</a>","Got it!",'');
	},secondsToWarning*1000);

}

ad2460.fetchingBlindStatus=false;

function fetchBlindStatus(){
	console.log("fetch called");
	if (ad2460.fetchingBlindStatus==false){
		ad2460.fetchingBlindStatus=true;
		$.post('actionhandler.pl', {action:'fetch_status_blind'}, function(data){ parseInfo(data);});
		// should return showStatusBlind(data) where data is an object.

	}
}

function showBlindStatus(data){

	document.getElementById("global_chat_container_table_body").setAttribute("aria-live","off");
	document.getElementById("combat_commentary_container").setAttribute("aria-live","off");

	var textarea=document.getElementById('blind_status_window');

	var unreadMessages=countUnreadMessages();
	var unspentTechpoints=ad2460.techpoints;

	var wargameChallengesString="";
	for (var i=0;i<ad2460.wargames.length ;i++ ){
		if (ad2460.wargames[i].challenger_id!=ad2460.user_id){
			wargameChallengesString+="You have a war game challenge from "+ad2460.wargames[i].challenger_nickname+ " with max "+ad2460.wargames[i].max_strength+" strength. ";
		}
	}

	textarea.appendChild(createSingleElement('div', '', '', 'You have '+unreadMessages+' new messages.', ''));
	textarea.appendChild(createSingleElement('div', '', '', 'You have '+unspentTechpoints+' unspent techpoints.', ''));
	textarea.appendChild(createSingleElement('div', '', '', wargameChallengesString, ''));

	for (var i=0;i<ad2460.facilities.length ;i++ ){
		if (ad2460.facilities[i].upgrading==1){
			var completedIn=Math.round((ad2460.facilities[i].end_time-ad2460.serverTime)/60);
			if (completedIn>60){
				completedIn=Math.round(completedIn/60);
				textarea.appendChild(createSingleElement('div', '', '', 'Your new facility, '+ad2460.facilities[i].name+', is ready in '+completedIn+' hours.', ''));
			}
			else {
				textarea.appendChild(createSingleElement('div', '', '', 'Your new facility, '+ad2460.facilities[i].name+', is ready in '+completedIn+' minutes.', ''));
			}

		}
	}

	for (var i=0;i<ad2460.researches.length ;i++ ){
		if (ad2460.researches[i].upgrading==1){
			var completedIn=Math.round((ad2460.researches[i].end_time-ad2460.serverTime)/60);
			if (completedIn>60){
				completedIn=Math.round(completedIn/60);
				textarea.appendChild(createSingleElement('div', '', '', 'Your new research, '+ad2460.researches[i].name+', is ready in '+completedIn+' hours.', ''));
			}
			else {
				textarea.appendChild(createSingleElement('div', '', '', 'Your new research, '+ad2460.researches[i].name+', is ready in '+completedIn+' minutes.', ''));
			}

		}
	}

	for (var i=0;i<ad2460.developments.length ;i++ ){
		if (ad2460.developments[i].upgrading==1){
			var completedIn=Math.round((ad2460.developments[i].end_time-ad2460.serverTime)/60);
			if (completedIn>60){
				completedIn=Math.round(completedIn/60);
				textarea.appendChild(createSingleElement('div', '', '', 'Your new development, '+ad2460.developments[i].name+', is ready in '+completedIn+' hours.', ''));
			}
			else {
				textarea.appendChild(createSingleElement('div', '', '', 'Your new development, '+ad2460.developments[i].name+', is ready in '+completedIn+' minutes.', ''));
			}

		}
	}

	//textarea.appendChild(createSingleElement('div', '', '', 'Hit escape to close this window and to return the reading-focus to the chat.', ''));

	ad2460.fetchingBlindStatus=false;

}

function hideBlindStatus(){
	document.getElementById("global_chat_container_table_body").setAttribute("aria-live","polite");
	document.getElementById("combat_commentary_container").setAttribute("aria-live","off");

	removeChildNodes("blind_status_window");

}


function setupKeyboardShortcuts(){
	// Navigation
	Mousetrap.bind(['ctrl+shift+1', 'command+shift+1', '# h o m e w o r l d'], function(e) {	$('#homeworldbutton').focus().click();	});
	Mousetrap.bind(['ctrl+shift+2', 'command+shift+2', '# o u t p o s t s'], function(e) {	$('#outpostsbutton').focus().click();	});
	Mousetrap.bind(['ctrl+shift+3', 'command+shift+3', '# a l l i a n c e'], function(e) {	$('#alliancebutton').focus().click();	});
	Mousetrap.bind(['ctrl+shift+4', 'command+shift+4', '# m i l i t a r y'], function(e) {	$('#militarybutton').focus().click();	});
	Mousetrap.bind(['ctrl+shift+5', 'command+shift+5', '# m i s s i o n s'], function(e) {	$('#missionsbutton').focus().click();	});
	Mousetrap.bind(['ctrl+shift+6', 'command+shift+6', '# s t a r m a p'], function(e) {	$('#starmapbutton').focus().click(); 	});

	Mousetrap.bind(['# t e c h p o i n t s'], function(e) {	openSlide('techtreeslide');	});
	Mousetrap.bind(['# e c o n o m y'], function(e) {	openSlide('economy_slide');	});
	Mousetrap.bind(['# r a n k i n g s'], function(e) {	openRankingsSlide();	});
	Mousetrap.bind(['# m e s s a g e s'], function(e) {	openSlide('mailslide');	});
	Mousetrap.bind(['# f o r u m s'], function(e) {	openSlide('forumcategories');	});
	Mousetrap.bind(['# n o t e s'], function(e) {	openSlide('noteslide');	});
	Mousetrap.bind(['# o p t i o n s'], function(e) {	openOptionsSlide();	});
	Mousetrap.bind(['# p u r c h a s e'], function(e) {	openSlide("purchaseslide");	});
	Mousetrap.bind(['# s u p p o r t'], function(e) {	openSlide("supportslide");	});

	Mousetrap.bind(['ctrl+shift+home', 'command+shift+home'], function(e) {	zoomToHomeworld();	});
	Mousetrap.bind(['ctrl+shift+-', 'command+shift+-'], function(e) {	zoomOut();	});

	Mousetrap.bind(['ctrl+shift+0', 'command+shift+0'], function(e) {	$('#chat_input_field').focus().click();	});

	Mousetrap.bind(['escape'], function(e) {handleEscapePress();return false;	});

	// special
	Mousetrap.bind(['ctrl+shift+9', 'command+shift+9','# s t a t u s'], function(e) {	fetchBlindStatus();	});
	Mousetrap.bind(['# c o'], function(e) {	specialClaimOutpostCommand();	});
	Mousetrap.bind(['# s c o u t'], function(e) {	setupStarmapIntelPanel(1); initiateScoutClick();	});
	Mousetrap.bind(['# s p y'], function(e) {	setupStarmapIntelPanel(2); initiateEspionageClick();	});
	Mousetrap.bind(['# i n f i l t r a t o r'], function(e) {	setupStarmapIntelPanel(3); initiateInfiltrateClick();	});

	var chat_input_field=document.getElementById('chat_input_field');
	Mousetrap(chat_input_field).bind('return', function(e, combo) {
		sendChatMessage();return false;
	});
	Mousetrap(chat_input_field).bind('tab', function(e, combo) {
		completeNick();return false;
	});
	Mousetrap(chat_input_field).bind('shift+up', function(e, combo) {
		goBackInChatHistory();
	});


	var conversation_textarea_body=document.getElementById('conversation_textarea_body');
	Mousetrap(conversation_textarea_body).bind('ctrl+return', function(e, combo) {
		conversationSendClick();
	});

}

function fetchMySupport(){
	$.post('actionhandler.pl', {action:'fetch_my_support'}, function(data){ parseInfo(data);});
	// Only pick up those updated in the last month or so?
}

function returnSupportTicketById(id){
	for (var i = 0; i < ad2460.supportTickets.length; i++) {
		if (ad2460.supportTickets[i].id==id) {
			return ad2460.supportTickets[i];
		}
	}
	return false;
}

function clearSupportInput(){
	$("#support_title").val("");
	$("#support_body").val("");
}

function fileNewSupportTicket(){
	var title=$("#support_title").val();
	var body=$("#support_body").val();
	$.post('actionhandler.pl', {action:'new_support_ticket', title:title, body:body}, function(data){ parseInfo(data);});
}

function renderSupportTickets(){
	var parent=document.getElementById('support_list_container');

	if (ad2460.supportTickets.length==0) {
		parent.innerHTML="No tickets found.";
		return;
	}

	parent.innerHTML="";
	for (var i = 0; i < ad2460.supportTickets.length; i++) {
		var container=createSingleElement('div', 'support_ticket_entry', '', '', 'selectSupportTicket('+ad2460.supportTickets[i].id+')');
		container.appendChild(createSingleElement('div', 'support_ticket_title', '', ''+ad2460.supportTickets[i].title, '') );
		container.appendChild(createSingleElement('div', 'support_ticket_timestamp', '', formatDateTimeShort(convertToUTC(parseInt(ad2460.supportTickets[i].last_update))), '') );
		container.appendChild(createSingleElement('div', 'support_ticket_status', '', ''+ad2460.supportTickets[i].status, '') );
		parent.appendChild(container);
	}
}

function submitSupportComment(id){
	var body=$("#support_ticket_new_comment").val();
	var status=$("#support_ticket_new_status").val();
	$.post('actionhandler.pl', {action:'new_support_comment', body:body, case_id:id, new_status:status}, function(data){ parseInfo(data);});
	// No need to clear it, we simply select it again in the return-string from actionhandler with selectSupportTicket(id)
}

function handleSupportTitleKeydown(event){
	if (event.which==9 || event.keyCode==9) {		document.getElementById('support_body').focus();			return false;			}
}
function selectSupportTicket(id){
	var parent=document.getElementById('selected_support_container');
	var thiscase=returnSupportTicketById(id);
	if (thiscase) {
		parent.innerHTML="";

		// Add the textarea and button to respond
		var textarea=document.createElement("textarea");
		textarea.style.width="400px";
		textarea.style.height="60px";
		textarea.setAttribute('id','support_ticket_new_comment');
		parent.appendChild(textarea);

		var button=createSingleElement('div', 'lightbutton160', '', '', 'submitSupportComment('+id+')');
		button.appendChild(createSingleElement('div', 'buttontext24', '', 'Add comment', ''));
		parent.appendChild(button);

		if (ad2460.admin_status>3) {
			var dropdown=document.createElement('select');
			dropdown.setAttribute('id','support_ticket_new_status');
			var opt1 = document.createElement("option"); opt1.text = 'Waiting';		opt1.value = 'Waiting';	dropdown.options.add(opt1);
			var opt2 = document.createElement("option"); opt2.text = 'Responded';		opt2.value = 'Responded';	dropdown.options.add(opt2);
			var opt3 = document.createElement("option"); opt3.text = 'Closed';		opt3.value = 'Closed';	dropdown.options.add(opt3);

			if (thiscase.status=="Waiting") {		dropdown.selectedIndex=0;		}
			else if (thiscase.status=="Responded") {		dropdown.selectedIndex=1;		}
			else if (thiscase.status=="Closed") {		dropdown.selectedIndex=2;		}
			parent.appendChild(dropdown);
		}


		parent.appendChild(createSingleElement('hr', '', '', '', ''));

		parent.appendChild(createSingleElement('div', 'support_ticket_header', '', thiscase.title+' ('+thiscase.status+')', ''));

		for (var i = 0; i < thiscase.notes.length; i++) {
			var extraclass="";
			if (thiscase.notes[i].user_id==ad2460.user_id) {
				extraclass=" own";
			}
			parent.appendChild(createSingleElement('div', 'support_ticket_written_by'+extraclass, '', thiscase.notes[i].nickname+' '+formatDateTimeShort(convertToUTC(parseInt(thiscase.notes[i].timestamp))), ''));
			parent.appendChild(createSingleElement('div', 'support_ticket_note_body'+extraclass, '', thiscase.notes[i].body, ''));
			parent.appendChild(createSingleElement('hr', '', '', '', ''));
		}
	}
}
var can_always_hit_ops_with_this_strength=1000;

function starmapViewLevel(galaxyView,quadrantView,clusterView,sectorView,systemView){
	ad2460.starmap.animationComplete=false;
	ad2460.starmap.dataFetch=false;
	// Now we can proceed!
	var currentMapZoomLevel=getCurrentZoomLevel();
	if (currentMapZoomLevel == 'system'){
		HideMapLinkInfo();
	}
	fetchMapData(currentMapZoomLevel);
}

function clearAllStarmapOverlayFlags(){
	ad2460.universe.starmaptoggles.topAlliances=0;
	ad2460.universe.starmaptoggles.topPlanets=0;
	ad2460.universe.starmaptoggles.myAlliance=0;
	ad2460.universe.starmaptoggles.highConflict=0;
}


function drawAllPlanets(ctx, thisCluster){
	//ad2460.universe.quadrants[5].sectors[12].clusters[4].systems[4]

	// first we must issue colours to each present owner_id
	var ownerArray=new Array;
	for (s=0;s<thisCluster.systems.length ; s++){
		var thisSystem=thisCluster.systems[s];
		for (var i=0;i<thisSystem.planets.length ;i++ ){
			var ownerFound=false;
			if (thisSystem.planets[i].owner_id>0){
				for (var x=0;x<ownerArray.length ;x++ ){
					if (ownerArray[x].owner_id==thisSystem.planets[i].owner_id){
						ownerFound=true;
					}
				}
				if (ownerFound==false){
					ownerArray.push({owner_id:thisSystem.planets[i].owner_id, fillStyle:playerIdToBgColor(thisSystem.planets[i].owner_id), strokeStyle:playerIdToColor(thisSystem.planets[i].owner_id)});
				}
			}
		}
	}

	//console.log(ownerArray);

	var s=0;

	for (s=0;s<thisCluster.systems.length ; s++){
		// For each system in this cluster
		var thisSystem=thisCluster.systems[s];
		var p=0;
		for (p=0;p<thisSystem.planets.length ;p++ ){
			var planet=thisSystem.planets[p];
			if (planet.owner_id>0){
				var drawCoords=convertGlobalCoordsToDrawCoords(planet.x,planet.y);
				ctx.lineWidth=1;
				for (var u=0;u<ownerArray.length ;u++ ){
					if (ownerArray[u].owner_id==planet.owner_id){
						ctx.fillStyle = ownerArray[u].fillStyle;
						ctx.strokeStyle = ownerArray[u].strokeStyle;
					}
				}
				ctx.beginPath();
				//ctx.rect(drawCoords.x-12, drawCoords.y-12, 25, 25);
				ctx.rect(drawCoords.x-10, drawCoords.y-10, 24, 24);
				ctx.fill();
				//ctx.stroke();
			}
		}
	}
}

function drawMyPlanets(ctx){

	var home_x=ad2460.homeworld.x/1024*canvaswidth;
	var home_y=ad2460.homeworld.y/1024*canvaswidth;

	var homeworldDrawCoords=convertGlobalCoordsToDrawCoords(ad2460.homeworld.x,ad2460.homeworld.y);
	//console.log(homeworldDrawCoords);

	ctx.lineWidth=2;
	ctx.strokeStyle = "rgba(255, 255, 255, 1.0)";
	ctx.beginPath();
	ctx.arc(homeworldDrawCoords.x, homeworldDrawCoords.y, 6, 0, Math.PI*2, true);
	ctx.closePath();
	ctx.stroke();

	// Outpost circles

	return;

	ctx.save();
	ctx.shadowOffsetX=3;
	ctx.shadowOffsetY=3;
	ctx.shadowBlur=0;
	ctx.shadowColor="rgba(0, 0, 0, 0.7)";
	ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
	ctx.fillStyle = "rgba(255, 0, 0, 1.0)";


	var i=0;
	for (i=0;i<ad2460.outposts.length ;i++ ){
		var drawCoords=convertGlobalCoordsToDrawCoords(ad2460.outposts[i].x,ad2460.outposts[i].y);
		ctx.lineWidth=1;
		ctx.beginPath();
		ctx.arc(drawCoords.x, drawCoords.y, 3, 0, Math.PI*2, true);
		ctx.closePath();
		ctx.stroke();
	}

	// Lines, one line from the homeworld to each outpost

	ctx.strokeStyle = "rgba(255, 255, 255, 0.2)";
	var i=0;
	for (i=0;i<ad2460.outposts.length ;i++ ){
		var drawCoords=convertGlobalCoordsToDrawCoords(ad2460.outposts[i].x,ad2460.outposts[i].y);
		ctx.lineWidth=1;
		ctx.beginPath();
		ctx.moveTo(homeworldDrawCoords.x, homeworldDrawCoords.y);
		ctx.lineTo(drawCoords.x,drawCoords.y);
		ctx.closePath();
		ctx.stroke();
	}

//

	ctx.restore();
}


function drawMyFleets(ctx){
	// Fleet circles
	ctx.save();
	ctx.strokeStyle = "rgba(255, 0, 0, 0.9)";
	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
			var drawCoords=convertGlobalCoordsToDrawCoords(ad2460.myFleets[i].current_x,ad2460.myFleets[i].current_y);
			ctx.lineWidth=1;
			ctx.beginPath();
			ctx.arc(drawCoords.x, drawCoords.y, 4, 0, Math.PI*2, true);
			ctx.closePath();
			ctx.stroke();

		if (ad2460.myFleets[i].status!=0 && ad2460.myFleets[i].status!=4){

			// And now a dotted line towards it's target x and y
			var drawCoords2=convertGlobalCoordsToDrawCoords(ad2460.myFleets[i].current_mission_target_x,ad2460.myFleets[i].current_mission_target_y);
			ctx.beginPath();
			ctx.dashedLine(drawCoords.x, drawCoords.y, drawCoords2.x, drawCoords2.y, [5,5]) ;
			//ctx.moveTo(drawCoords.x, drawCoords.y);
			//ctx.lineTo(drawCoords2.x,drawCoords2.y);
			ctx.closePath();
			ctx.stroke();
		}
	}
	ctx.restore();
}

function drawTopPlanets(ctx){

	var fillStyles=[
						"rgba(50, 255, 50, 0.2)",
						"rgba(255, 50, 50, 0.2)",
						"rgba(255, 210, 30, 0.2)",
						"rgba(114, 252, 221, 0.4)",
						"rgba(200, 200, 200, 0.4)",
						"rgba(255, 255, 50, 0.2)",
						"rgba(50, 255, 255, 0.2)",
						"rgba(255, 50, 255, 0.2)",
						"rgba(200, 100, 30, 0.2)",
						"rgba(100, 90, 200, 0.2)",
						"rgba(255, 255, 255, 0.1)",
						"rgba(255, 255, 255, 0.1)",
						"rgba(255, 255, 255, 0.1)",
						"rgba(255, 255, 255, 0.1)",
						"rgba(255, 255, 255, 0.1)"
					];


	var strokeStyles=[	"rgba(50, 255, 50, 0.9)",
						"rgba(255, 50, 50, 0.9)",
						"rgba(255, 210, 30, 0.9)",
						"rgba(114, 252, 221, 0.9)",
						"rgba(200, 200, 200, 0.9)",
						"rgba(255, 255, 50, 0.9)",
						"rgba(50, 255, 255, 0.9)",
						"rgba(255, 50, 255, 0.9)",
						"rgba(200, 100, 30, 0.9)",
						"rgba(100, 90, 200, 0.9)",
						"rgba(255, 255, 255, 0.7)",
						"rgba(255, 255, 255, 0.7)",
						"rgba(255, 255, 255, 0.7)",
						"rgba(255, 255, 255, 0.7)",
						"rgba(255, 255, 255, 0.7)"
					];

	var rankings;

	var currentMapZoomLevel=getCurrentZoomLevel();

	var i=0;
	var number_to_draw=5;
	if (currentMapZoomLevel=='galaxy'){
		rankings=ad2460.universe.topPlayers;
	}
	if (currentMapZoomLevel=='quadrant'){
		var thisQuadrant=returnQuadrant(ad2460.starmap.quadrantSquare);
		rankings=thisQuadrant.topPlayers;
	}
	if (currentMapZoomLevel=='sector'){
		var thisSector=returnSector(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare);
		rankings=thisSector.topPlayers;
		number_to_draw=15;
	}
	if (currentMapZoomLevel=='cluster'){
		var thisCluster=returnCluster(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,ad2460.starmap.clusterSquare);
		rankings=thisCluster.topPlayers;
		number_to_draw=15;
	}
	if (currentMapZoomLevel=='system'){
		var thisSystem=returnSystem(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,ad2460.starmap.clusterSquare,ad2460.starmap.systemSquare);
		rankings=thisSystem.topPlayers;
		number_to_draw=0;
	}

	if (rankings){
		for (var f=0;f<rankings.length ;f++ ){
			if (f<number_to_draw){
				var x=rankings[f].x;
				var y=rankings[f].y;
				var drawCoords=convertGlobalCoordsToDrawCoords(x,y);
				//ctx.strokeStyle = strokeStyles[f];
				ctx.strokeStyle = playerIdToColor(rankings[f].user_id);
				//console.log(playerIdToColor(rankings[f].user_id));
				ctx.lineWidth=2;
				ctx.beginPath();
				ctx.arc(drawCoords.x, drawCoords.y, 6, 0, Math.PI*2, true);
				ctx.stroke();

			}
		}
	}

	ctx.lineWidth=1;

}

function returnClosestLeader(member){
	var members=ad2460.allianceData.memberlist;
	var rank=member.rank;
	var returnObject={};
	returnObject.user_id=-1;
	returnObject.distance=1000000;

	if (rank>=2 && rank<=6){
		// We're looking for the leader of the alliance
		var i=0;
		for (i=0;i<members.length ;i++){
			if (members[i].rank==1){
				// We got him
				returnObject.user_id=members[i].user_id;
				returnObject.real_x=members[i].x;
				returnObject.real_y=members[i].y;
				returnObject.distance=Math.round(Math.abs(Math.sqrt( ((member.x-members[i].x)*(member.x-members[i].x)) + ((member.y-members[i].y)*(member.y-members[i].y))  )));
				return returnObject;
			}
		}
	}
	else if (rank>6){
		// We're looking for anyone with a rank of 6 or "lower"
		var i=0;
		for (i=0;i<members.length ;i++){
			if (members[i].rank<6){
				// We got one
				var thisDistance=Math.round(Math.abs(Math.sqrt( ((member.x-members[i].x)*(member.x-members[i].x)) + ((member.y-members[i].y)*(member.y-members[i].y))  )));
				if (thisDistance<returnObject.distance){
					returnObject.user_id=members[i].user_id;
					returnObject.real_x=members[i].x;
					returnObject.real_y=members[i].y;
					returnObject.distance=thisDistance;
				}
			}
		}
		return returnObject;
	}
}
function renderMyAllianceSymbol(ctx, x,y,rank,closest_leader,cluster){
		ctx.save();
		var strokeStyle="rgba(255, 246, 0, 1.0)";
		ctx.strokeStyle = strokeStyle;
		//console.log("RenderMyAllianceSymbol called with" +x,y,rank,closest_leader,cluster);
		if (rank==1){
			ctx.lineWidth=2;
			ctx.beginPath();
			// console.log(x,y);
			ctx.arc(x, y, 9, 0, Math.PI*2, true);
			ctx.stroke();
			ctx.beginPath();
			ctx.arc(x, y, 5, 0, Math.PI*2, true);
			ctx.stroke();
			ctx.beginPath();
			ctx.moveTo(x,y-10);
			ctx.lineTo(x,y+10);
			ctx.closePath();
			ctx.stroke();
		}
		else if (rank>=2 && rank<=6){
			ctx.lineWidth=2;
			ctx.beginPath();
			ctx.arc(x, y, 5, 0, Math.PI*2, true);
			ctx.stroke();
			ctx.beginPath();
			ctx.arc(x, y, 2, 0, Math.PI*2, true);
			// console.log(x,y);
			ctx.stroke();
		}
		else {
			ctx.lineWidth=1;
			ctx.beginPath();
			ctx.arc(x, y, 6, 0, Math.PI*2, true);
			// console.log(x,y);
			ctx.stroke();
		}
		if (cluster==true){
			ctx.lineWidth=2;
			ctx.beginPath();
			ctx.arc(x, y, 12, -Math.PI/2, (-Math.PI/2)+Math.PI/5, false);
			ctx.stroke();
			ctx.beginPath();
			ctx.arc(x, y, 12, (-Math.PI/2)+(2*Math.PI/5), (-Math.PI/2)+(3*Math.PI/5), false);
			ctx.stroke();
			ctx.beginPath();
			ctx.arc(x, y, 12, (-Math.PI/2)+(4*Math.PI/5), (-Math.PI/2)+(5*Math.PI/5), false);
			ctx.stroke();
		}

		ctx.restore();

}
function drawMyAlliance(ctx){

	var fillStyle="rgba(255, 246, 0, 0.2)";
	var strokeStyle="rgba(255, 246, 0, 0.3)";

	if (ad2460.allianceData.id==0){
		return;
	}

	if (ad2460.universe.starmaptoggles.myAlliance==0){
		return;
	}

	//ctx.save();

	// ad2460.allianceData.memberlist[i].x
	// ad2460.allianceData.memberlist[i].y
	ctx.fillStyle = fillStyle;
	ctx.strokeStyle = strokeStyle;

	var drawCoordsArray=new Array;
	// {x,y,rank,id, closest_officer, distance_to_closest_officer, user_id}

	// Now draw the symbols of the members in the right places, the order doesn't matter now, just their status in the alliance
	for (m=0;m<ad2460.allianceData.memberlist.length ;m++ ){
		var drawCoords=convertGlobalCoordsToDrawCoords(ad2460.allianceData.memberlist[m].x,ad2460.allianceData.memberlist[m].y);
		var closest_leader=-1;
		var distance_to_closest_leader=1000000;
		var user_id=ad2460.allianceData.memberlist[m].user_id;
		var rank=ad2460.allianceData.memberlist[m].rank;
		var closest_leader_draw_x=0;
		var closest_leader_draw_y=0;


		if (rank==1){

		}
		if (rank>=2 && rank<=6){
			var closest_leader_object=returnClosestLeader(ad2460.allianceData.memberlist[m]);
			closest_leader=closest_leader_object.user_id;
			distance_to_closest_leader=closest_leader_object.distance;
			var leaderDrawCoords=convertGlobalCoordsToDrawCoords(closest_leader_object.real_x,closest_leader_object.real_y);
			closest_leader_draw_x=leaderDrawCoords.x;
			closest_leader_draw_y=leaderDrawCoords.y;

		}
		if (rank>6){
			var closest_leader_object=returnClosestLeader(ad2460.allianceData.memberlist[m]);
			closest_leader=closest_leader_object.user_id;
			distance_to_closest_leader=closest_leader_object.distance;
			var leaderDrawCoords=convertGlobalCoordsToDrawCoords(closest_leader_object.real_x,closest_leader_object.real_y);
			closest_leader_draw_x=leaderDrawCoords.x;
			closest_leader_draw_y=leaderDrawCoords.y;
		}

		drawCoordsArray.push({x:drawCoords.x,y:drawCoords.y,rank:rank,id:m, closest_leader:closest_leader,distance_to_closest_leader:distance_to_closest_leader,user_id:user_id,closest_leader_draw_x:closest_leader_draw_x,closest_leader_draw_y:closest_leader_draw_y});
	}

	// console.log(drawCoordsArray);

	var i=0;
	for (i=0;i<drawCoordsArray.length ;i++ ){
		drawCoordsArray[i].draw=true;
		drawCoordsArray[i].cluster=false;
		drawCoordsArray[i].isLeader=false;
		drawCoordsArray[i].isOfficer=false;
		drawCoordsArray[i].clusterId=-1;
		drawCoordsArray[i].drawn=false;
	}

	for (i=0;i<drawCoordsArray.length ;i++ ){
		var isCluster=false;
		// Hvis denne ikke er tegnet
		// Hvis denne skal tegnes

		// Gå igjennom de andre entries som ikke er tegnet,
		//  og sjekk avstand. Hvis noen er for nærme, sett deres DRAW til false og tegn på cluster-symbolet i tillegg på denne.

		// Tegn den evt med cluster-symbol
		if (drawCoordsArray[i].drawn==false && drawCoordsArray[i].draw==true){
			var x=0;
			for (x=0;x<drawCoordsArray.length ;x++ ){
				if (drawCoordsArray[i].user_id!=drawCoordsArray[x].user_id){
					var dist=calcDistance(drawCoordsArray[i].x,drawCoordsArray[i].y,drawCoordsArray[x].x,drawCoordsArray[x].y);
					//console.log(dist);
					if (drawCoordsArray[x].drawn==false && dist<20){
						drawCoordsArray[x].draw=false;
						drawCoordsArray[x].cluster=true;
						drawCoordsArray[x].cluster_id=drawCoordsArray[i].user_id;
						isCluster=true;
						//console.log(x+ ' is set to not draw!');
					}
				}
			}
		}

		if (drawCoordsArray[i].draw==true){
			ctx.lineWidth=2;
			renderMyAllianceSymbol(ctx, drawCoordsArray[i].x,drawCoordsArray[i].y,drawCoordsArray[i].rank,drawCoordsArray[i].closest_leader,isCluster);
			if (drawCoordsArray[i].closest_leader>0){
				ctx.lineWidth=1;
				ctx.beginPath();
				ctx.moveTo(drawCoordsArray[i].x,drawCoordsArray[i].y);
				ctx.lineTo(drawCoordsArray[i].closest_leader_draw_x,drawCoordsArray[i].closest_leader_draw_y);
				ctx.stroke();

			}
			drawCoordsArray[i].drawn=true;
		}
	}

	//ctx.restore();
}

function drawTopAlliances(ctx){
	//ctx.save();
	var currentMapZoomLevel=getCurrentZoomLevel();
	if (ad2460.universe.starmaptoggles.topAlliances==0){
		return;
	}

	ctx.lineWidth=1;

	if (currentMapZoomLevel=='galaxy'){

		// New function to draw alliance-ownerships of sectors
		var fillstyles=["rgba(50, 255, 50, 0.2)", "rgba(255, 50, 50, 0.2)", "rgba(50, 50, 255, 0.2)", "rgba(100, 100, 100, 0.4)", "rgba(200, 200, 200, 0.4)", "rgba(255, 255, 50, 0.2)", "rgba(50, 255, 255, 0.2)", "rgba(255, 50, 255, 0.2)", "rgba(200, 100, 30, 0.2)", "rgba(100, 90, 200, 0.2)"];
		var strokestyles=["rgba(50, 255, 50, 0.7)", "rgba(255, 50, 50, 0.7)", "rgba(50, 50, 255, 0.7)", "rgba(100, 100, 100, 0.7)", "rgba(200, 200, 200, 0.7)", "rgba(255, 255, 50, 0.7)", "rgba(50, 255, 255, 0.7)", "rgba(255, 50, 255, 0.7)", "rgba(200, 100, 30, 0.7)", "rgba(100, 90, 200, 0.7)"];

		// Based on the zoom-level, we need to colour the map with areas that represent alliance-ownership
		// In galaxy-view, I guesss that means 25px by 25px for each sector.
		// go through all quadrants, and inside those, all sectors to determine ownership-bits, and translate to coords and draw.
		// We would need to sort out the most-owning alliances first though...
		var q=ad2460.universe.quadrants;
		var topalliances=new Array; // {alliance_id, sectors}
		var a=0;
		var b=0;

		for (a=0;a<q.length;a++){
			// each quadrant
			var s=q[a].sectors;
			for (b=0;b<s.length;b++){
				if (s[b].s_ctrl_a_id>0){
					var c=0;
					var found=false;
					for (c=0;c<topalliances.length;c++){
						if (topalliances[c].alliance_id==s[b].s_ctrl_a_id){
							found=true;
							topalliances[c].sectors++;
						}
					}
					if (found==false){
						topalliances.push({alliance_id:s[b].s_ctrl_a_id,sectors:1});
					}
				}
			}
		}


		topalliances.sort(function(a, b){
			return b.sectors-a.sectors;
		});

		for (var i=0;i<topalliances.length;i++){
			if (i<10){
				topalliances[i].fillstyle=fillstyles[i];
				topalliances[i].strokestyle=strokestyles[i];
			}
			else {
				topalliances[i].fillstyle="rgba(255, 255, 255, 0.15)";
				topalliances[i].strokestyle="rgba(255, 255, 255, 0.15)";
			}
		}

		// Ok, array sorted now, colors assigned to each of them, puh
		//console.log(topalliances);

		var i=0;
		var a=0;
		var x=0;


		for (i=0;i<q.length;i++){
			// loop through quadrants
			for (x=0;x<q[i].sectors.length;x++){
				var thisSector=q[i].sectors[x];
				if (thisSector.s_ctrl_a_id>0){
					for (a=0;a<topalliances.length;a++){
						if (topalliances[a].alliance_id==thisSector.s_ctrl_a_id){
							renderSectorOwnerShip(ctx,thisSector.sector_local_id, thisSector.quadrant_id, topalliances[a].fillstyle, topalliances[a].strokestyle, thisSector.s_ctrl_a_id);
						}
					}
				}
			}
		}
		var ruling_alliance=returnRulingAlliance();
		if (ruling_alliance!=false){
			$("#rulers_header").html("Rulers of the Galaxy");
			$("#ruling_aliance_name").html(ruling_alliance.name);
			$("#ruling_aliance_name").attr("onclick","loadAllianceInfo("+ruling_alliance.alliance_id+")");
			$("#ruling_alliance_avatar").attr("src","images/uploads/alliancelogos/"+ruling_alliance.logo_url);
			$("#rulers_container").show();
		}
		else {
			$("#rulers_container").hide();
		}

	}

	if (currentMapZoomLevel=='quadrant'){
		var ruling_alliance=returnRulingAlliance();
		if (ruling_alliance!=false){
			$("#rulers_header").html("Rulers of the Quadrant");
			$("#ruling_aliance_name").html(ruling_alliance.name);
			$("#ruling_aliance_name").attr("onclick","showAllianceInfo("+ruling_alliance.alliance_id+")");
			$("#ruling_alliance_avatar").attr("src","images/uploads/alliancelogos/"+ruling_alliance.logo_url);
			$("#rulers_container").show();
		}
		else {
			$("#rulers_container").hide();
		}

	}

	// In quadrant-view, I guesss that means 100px by 100px for each sector.



	// In sector-view, We already have the text
	// In cluster-view, we should show the station, always!


	//ctx.restore();

}

function renderSectorOwnerShip(ctx,sector_local_id, quadrant_id, fillstyle, strokestyle, alliance_id){
	var currentMapZoomLevel=getCurrentZoomLevel();
	if (currentMapZoomLevel=='galaxy'){
		var drawWidth=25;
		var drawHeight=25;
		var xOffset=0;
		if (quadrant_id==2 || quadrant_id==6 || quadrant_id==10 || quadrant_id==14 ){
			xOffset=100;
		}
		if (quadrant_id==3 || quadrant_id==7 || quadrant_id==11 || quadrant_id==15 ){
			xOffset=200;
		}
		if (quadrant_id==4 || quadrant_id==8 || quadrant_id==12 || quadrant_id==16 ){
			xOffset=300;
		}
		var yOffset=0;
		if (quadrant_id==5 || quadrant_id==6 || quadrant_id==7 || quadrant_id==8 ){
			yOffset=100;
		}
		if (quadrant_id==9 || quadrant_id==10 || quadrant_id==11 || quadrant_id==12 ){
			yOffset=200;
		}
		if (quadrant_id==13 || quadrant_id==14 || quadrant_id==15 || quadrant_id==16 ){
			yOffset=300;
		}

		if (sector_local_id==2 || sector_local_id==6 || sector_local_id==10 || sector_local_id==14   ){
			xOffset+=25;
		}
		if (sector_local_id==3 || sector_local_id==7 || sector_local_id==11 || sector_local_id==15   ){
			xOffset+=50;
		}
		if (sector_local_id==4 || sector_local_id==8 || sector_local_id==12 || sector_local_id==16   ){
			xOffset+=75;
		}

		if (sector_local_id==5 || sector_local_id==6 || sector_local_id==7 || sector_local_id==8 ){
			yOffset+=25;
		}
		if (sector_local_id==9 || sector_local_id==10 || sector_local_id==11 || sector_local_id==12 ){
			yOffset+=50;
		}
		if (sector_local_id==13 || sector_local_id==14 || sector_local_id==15 || sector_local_id==16 ){
			yOffset+=75;
		}

		if (alliance_id!=1000000000){
			//ctx.save();
			ctx.fillStyle=fillstyle;
			ctx.strokeStyle=strokestyle;
			ctx.beginPath();
			ctx.rect(xOffset,yOffset,drawWidth,drawHeight);
			//ctx.stroke();
			ctx.closePath();
			ctx.fill();
			//ctx.restore();
		}
		else {
			/*
			ctx.save();
			ctx.fillStyle="rgba(255,255,0,0.50)";
			ctx.strokeStyle="rgba(255,255,0,0.50)";
			ctx.beginPath();
			ctx.moveTo(xOffset,yOffset);
			ctx.lineTo(xOffset+25,yOffset+25);
			ctx.lineTo(xOffset,yOffset+25);
			ctx.lineTo(xOffset,yOffset);
			ctx.closePath();
			ctx.fill();

			ctx.fillStyle="rgba(0,255,255,0.50)";
			ctx.strokeStyle="rgba(0,255,255,0.50)";
			ctx.beginPath();
			ctx.moveTo(xOffset,yOffset);
			ctx.lineTo(xOffset+25,yOffset);
			ctx.lineTo(xOffset+25,yOffset+25);
			ctx.lineTo(xOffset,yOffset);
			ctx.closePath();
			ctx.fill();
			ctx.restore();
			*/
			ctx.save();
			ctx.beginPath();
			ctx.strokeStyle="rgba(255,0,0,0.50)";
			ctx.lineWidth=5;
			ctx.moveTo(xOffset+1,yOffset+1);
			ctx.lineTo(xOffset+24,yOffset+24);
			ctx.closePath();
			ctx.stroke();

			ctx.strokeStyle="rgba(255,255,0,0.90)";
			ctx.lineWidth=1;
			ctx.beginPath();
			ctx.moveTo(xOffset+1,yOffset+1);
			ctx.lineTo(xOffset+24,yOffset+24);
			ctx.closePath();
			ctx.stroke();

			ctx.restore();

		}
	}
}


function renderMapData(nodelay){
	// this function should be called by the action-handler server-side as the very last thing.
	// However, in case data is cached on the client, we need to be able to call it regardless!
	var delay=1250;
	var animtime=750;

	$("#sm_planet_marker").hide();

	if (nodelay=='nodelay'){
		delay=0;
		animtime=0;
	}

	var starmapCanvasOverlay=document.getElementById('starmapCanvasOverlay');
	var ctx = starmapCanvasOverlay.getContext("2d");
	ctx.clearRect (0, 0, canvaswidth, canvaswidth);

	var currentMapZoomLevel=getCurrentZoomLevel();
	// console.log("renderMapData called for "+currentMapZoomLevel);

	if (currentMapZoomLevel=='galaxy'){
		//$("#prospect_cluster_container").hide();
		//$("#prospecting_cluster_container").hide();
		$("#prospect_cluster_button").css({opacity:0.5});
		$("#prospect_time").html("Zoom to Sector");
		$("#star_nav_container .grid .gridicon").remove();
		$("#star_nav_container .grid .sm_area_ownership_name").remove();

		if (nodelay!='nodelay'){
			starmapCanvasOverlay.style.display='none';
		}


		drawTopPlanets(ctx);
		drawTopAlliances(ctx);
		drawMyAlliance(ctx);
		drawMyPlanets(ctx);
		drawMyFleets(ctx);
		updateStarmapRankingLists();
		if (nodelay!='nodelay'){
			setTimeout('$("#starmapCanvasOverlay").fadeIn('+animtime+')',delay);
		}
	}
	else if (currentMapZoomLevel=='quadrant'){
		//$("#prospect_cluster_container").hide();
		//$("#prospecting_cluster_container").hide();
		$("#prospect_cluster_button").css({opacity:0.5});
		$("#prospect_time").html("Zoom to Sector");
		$("#star_nav_container .grid .gridicon").remove();
		$("#star_nav_container .grid .sm_area_ownership_name").remove();

		if (nodelay!='nodelay'){
			starmapCanvasOverlay.style.display='none';
		}

		renderGridSectorIcons(currentMapZoomLevel);

		drawTopPlanets(ctx);
		drawTopAlliances(ctx);
		drawMyAlliance(ctx);
		drawMyPlanets(ctx);
		drawMyFleets(ctx)
		updateStarmapRankingLists();
		if (nodelay!='nodelay'){
			setTimeout('$("#starmapCanvasOverlay").fadeIn('+animtime+')',delay);
		}

	}
	else if (currentMapZoomLevel=='sector'){
		//$("#prospect_cluster_container").hide();
		//$("#prospecting_cluster_container").hide();
		$("#prospect_cluster_button").css({opacity:1.0}).removeClass('lightbutton160red').addClass('lightbutton160');
		$("#prospect_cluster_button_text").html("Sector report");
		document.getElementById('prospect_cluster_button').setAttribute("onclick","fetchProspectingReport("+ad2460.starmap.quadrantSquare+","+ad2460.starmap.sectorSquare+")");
		$("#prospect_time").html("N/A");
		$("#star_nav_container .grid .gridicon").remove();
		$("#star_nav_container .grid .sm_area_ownership_name").remove();


		if (nodelay!='nodelay'){
			starmapCanvasOverlay.style.display='none';
		}
		renderGridSectorIcons(currentMapZoomLevel);
		drawTopPlanets(ctx);
		//drawTopAlliances(ctx);
		drawMyAlliance(ctx);
		drawMyPlanets(ctx);
		drawMyFleets(ctx)
		updateStarmapRankingLists();
		var thisSector=returnSector(ad2460.starmap.quadrantSquare , ad2460.starmap.sectorSquare);
		renderStationInSectorView(ctx, thisSector);
		if (nodelay!='nodelay'){
			setTimeout('$("#starmapCanvasOverlay").fadeIn('+animtime+')',delay);
		}

		setTimeout('specialSectorProspecting()',2000);
	}
	else if (currentMapZoomLevel=='cluster'){
		//$("#prospect_cluster_container").hide();
		//$("#prospecting_cluster_container").hide();
		$("#prospect_cluster_button").css({opacity:1.0});
		$("#star_nav_container .grid .gridicon").remove();
		$("#star_nav_container .grid .sm_area_ownership_name").remove();

		if (nodelay!='nodelay'){
			starmapCanvasOverlay.style.display='none';
		}

		// Here we can descide wehter to turn on or off the prospecting-box
		// the element has id prospect_cluster_container
		// find the right cluster-data for coords ad2460.starmap.quadrantSquare , ad2460.starmap.sectorSquare , ad2460.starmap.clusterSquare
		var thisCluster=returnCluster(ad2460.starmap.quadrantSquare , ad2460.starmap.sectorSquare , ad2460.starmap.clusterSquare);

		renderStationInClusterView(ctx, thisCluster);
		renderBanksInClusterView(ctx, thisCluster);

		if (thisCluster.prospected==1){
			//$("#prospect_cluster_button").css({opacity:0.5});
			$("#prospect_time").html("N/A");
			$("#prospect_cluster_button_text").html('View report');
			document.getElementById('prospect_cluster_button').setAttribute("onclick","fetchProspectingReport("+ad2460.starmap.quadrantSquare+","+ad2460.starmap.sectorSquare+","+ad2460.starmap.clusterSquare+")");
			//$("#prospecting_cluster_container").hide();
			//console.log("Already prospected, hiding...");
		}
		else if (thisCluster.prospecting==1){
			$("#prospect_cluster_button").css({opacity:0.5});
			$("#prospect_time").html("N/A");
			$("#prospect_cluster_button_text").html('Waiting...');
			// current_prospecting_timer must be set to the right timer-thingie....
			// document.getElementById('complete_prospecting_now').setAttribute("onclick","instantCompleteProspecting("+ad2460.prospectingMissions[tempCounter].cluster_id+")");
		}
		else {
			$("#prospect_cluster_button").css({opacity:1.0});
			$("#prospecting_cluster_container").hide();
			var minutes=returnProspectingTimeInMinutes(ad2460.homeworld.quadrant,ad2460.homeworld.sector,ad2460.homeworld.cluster, ad2460.starmap.quadrantSquare , ad2460.starmap.sectorSquare , ad2460.starmap.clusterSquare);
			var seconds=minutes*60;
			var timeString=secondsToFullTimeNosecs(seconds);
			$("#prospect_time").html(timeString);
			$("#prospect_cluster_button_text").html('Prospect now');
			document.getElementById('prospect_cluster_button').setAttribute("onclick","prospectCluster()");
			//$("#prospect_cluster_container").show(250);

			// Now determine if we have prospecting-ships available in our base-fleet
			var i=0;
			var prospect_ships=returnAvailableProspectingShips();
			if (prospect_ships==0){
				$("#prospect_cluster_additional_info_2").hide();
				$("#prospect_cluster_additional_info").show(250);
				$("#prospect_cluster_button").addClass('lightbutton160red').removeClass('lightbutton160').show();
			}
			else {
				$("#prospect_cluster_additional_info").hide();
				$("#prospect_cluster_additional_info_2").show(250);
				$("#prospect_cluster_button").addClass('lightbutton160').removeClass('lightbutton160red');
			}
		}




		drawTopPlanets(ctx);
		//drawTopAlliances(ctx);
		drawMyAlliance(ctx);
		drawMyPlanets(ctx);
		drawMyFleets(ctx);
		updateStarmapRankingLists();
		// Experimental
		drawAllPlanets(ctx, thisCluster);
		// Experimental



		if (nodelay!='nodelay'){
			setTimeout('$("#starmapCanvasOverlay").fadeIn('+animtime+')',delay);
		}

	}
	else if (currentMapZoomLevel=='system'){
		$("#prospect_cluster_container").hide();
		$("#prospecting_cluster_container").hide();
		var starmapCanvasOverlay=document.getElementById('starmapCanvasOverlay')
		starmapCanvasOverlay.style.display='none';
	}
}

function specialSectorProspecting(){
	var currentMapZoomLevel=getCurrentZoomLevel();
	if (currentMapZoomLevel=='sector' && starMapVisible==1){
		var thisSector=returnSector(ad2460.starmap.quadrantSquare , ad2460.starmap.sectorSquare);
		var unprospectedClusters=0;
		for (var t=0;t<thisSector.clusters.length ;t++ ){
			if (thisSector.clusters[t].prospected==0 && thisSector.clusters[t].prospecting==0){
				unprospectedClusters++;
			}
		}
		var availableProspectors=returnAvailableProspectingShips();

		if (unprospectedClusters>0 && availableProspectors >= unprospectedClusters){
			var mainText="You have enough prospectors to prospect this entire sector. This will spend "+unprospectedClusters+" prospectors. Would you like to do so now?";
			var okText="Yes";
			var cancelText="No";
			var okClick="prospectAllSubClusters();hideConfirmationPopup();";
			var cancelClick='hideConfirmationPopup();'
			showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick, false, false, false, false);
		}
	}
}


function prospectAllSubClusters(){
	var thisSector=returnSector(ad2460.starmap.quadrantSquare , ad2460.starmap.sectorSquare);
	$.post('actionhandler.pl', {action:'auto_prospect_subclusters', sector_id:thisSector.sector_id}, function(data){ parseInfo(data);});

}

function renderStationInSectorView(ctx,sector){
	var grid=sector.main_station_cluster_local_id;

	if (grid==0){
		return;
	}

	var drawX=0;
	var drawY=0;

	if (grid==1){	drawX=50;	drawY=50;	}
	if (grid==2){	drawX=150;	drawY=50;	}
	if (grid==3){	drawX=250;	drawY=50;	}
	if (grid==4){	drawX=350;	drawY=50;	}

	if (grid==5){	drawX=50;	drawY=150;	}
	if (grid==6){	drawX=150;	drawY=150;	}
	if (grid==7){	drawX=250;	drawY=150;	}
	if (grid==8){	drawX=350;	drawY=150;	}

	if (grid==9){	drawX=50;	drawY=250;	}
	if (grid==10){	drawX=150;	drawY=250;	}
	if (grid==11){	drawX=250;	drawY=250;	}
	if (grid==12){	drawX=350;	drawY=250;	}

	if (grid==13){	drawX=50;	drawY=350;	}
	if (grid==14){	drawX=150;	drawY=350;	}
	if (grid==15){	drawX=250;	drawY=350;	}
	if (grid==16){	drawX=350;	drawY=350;	}

    // Radii of the white glow.
    var innerRadius = 5;
    var outerRadius = 40;
    // Radius of the entire circle.
    var radius = 40;


	var outputWidth=50;
	var outputHeight=50;

	var gradient = ctx.createRadialGradient(drawX, drawY, innerRadius, drawX, drawY, outerRadius);
	gradient.addColorStop(0, 'rgba(0,0,0,1)');
	gradient.addColorStop(1, 'rgba(0,0,0,0)');
	ctx.arc(drawX, drawY, radius, 0, 2 * Math.PI);
	ctx.fillStyle = gradient;
	ctx.fill();

	ctx.drawImage(ad2460.stationImage,drawX-outputWidth/2,drawY-outputHeight/2,outputWidth,outputHeight);

}

function renderStationInClusterView(ctx, cluster){
	var i=0;
	var p=0;
	var station=false;
	var system_local_id=0;
	for (i=0;i<cluster.systems.length;i++){
		for (p=0;p<cluster.systems[i].planets.length;p++){
			if (cluster.systems[i].planets[p].world_type==60){
				station=cluster.systems[i].planets[p];
				system_local_id=cluster.systems[i].system_local_id;
			}
		}
	}

	var homeworldDrawCoords=convertGlobalCoordsToDrawCoords(station.x,station.y);

	var drawX=0;
	var drawY=0;

	if (system_local_id==1){	drawX=50;	drawY=50;	}
	if (system_local_id==2){	drawX=150;	drawY=50;	}
	if (system_local_id==3){	drawX=250;	drawY=50;	}
	if (system_local_id==4){	drawX=350;	drawY=50;	}

	if (system_local_id==5){	drawX=50;	drawY=150;	}
	if (system_local_id==6){	drawX=150;	drawY=150;	}
	if (system_local_id==7){	drawX=250;	drawY=150;	}
	if (system_local_id==8){	drawX=350;	drawY=150;	}

	if (system_local_id==9){	drawX=50;	drawY=250;	}
	if (system_local_id==10){	drawX=150;	drawY=250;	}
	if (system_local_id==11){	drawX=250;	drawY=250;	}
	if (system_local_id==12){	drawX=350;	drawY=250;	}

	if (system_local_id==13){	drawX=50;	drawY=350;	}
	if (system_local_id==14){	drawX=150;	drawY=350;	}
	if (system_local_id==15){	drawX=250;	drawY=350;	}
	if (system_local_id==16){	drawX=350;	drawY=350;	}

    // Radii of the white glow.
    var innerRadius = 5;
    var outerRadius = 40;
    // Radius of the entire circle.
    var radius = 40;


	var outputWidth=50;
	var outputHeight=50;

	if (station.inactive==1){
		outputWidth=25;
		outputHeight=25;
		innerRadius = 5;
		outerRadius = 20;
    // Radius of the entire circle.
		radius = 25;

	}

	var gradient = ctx.createRadialGradient(drawX, drawY, innerRadius, drawX, drawY, outerRadius);
	gradient.addColorStop(0, 'rgba(0,0,0,1)');
	gradient.addColorStop(1, 'rgba(0,0,0,0)');
	ctx.arc(drawX, drawY, radius, 0, 2 * Math.PI);
	ctx.fillStyle = gradient;
	ctx.fill();

	ctx.drawImage(ad2460.stationImage,drawX-outputWidth/2,drawY-outputHeight/2,outputWidth,outputHeight);
}

function renderBanksInClusterView(ctx, cluster){
	var i=0;
	var p=0;
	var bank=false;
	var system_local_id=0;
	for (i=0;i<cluster.systems.length;i++){
		for (p=0;p<cluster.systems[i].planets.length;p++){
			if (cluster.systems[i].planets[p].world_type==70){
				bank=cluster.systems[i].planets[p];
				var homeworldDrawCoords=convertGlobalCoordsToDrawCoords(bank.x,bank.y);
				var drawX=homeworldDrawCoords.x+2;
				var drawY=homeworldDrawCoords.y+2;

				system_local_id=cluster.systems[i].system_local_id;

				var outputWidth=20;
				var outputHeight=20;

				ctx.drawImage(ad2460.bankImage,drawX-outputWidth/2,drawY-outputHeight/2,outputWidth,outputHeight);
			}
		}
	}

}

function updateStarmapRankingLists(){
	var currentMapZoomLevel=getCurrentZoomLevel();

	if (currentMapZoomLevel=='sector'){
		$("#rulers_container").hide();
	}
	if (currentMapZoomLevel=='cluster'){
		$("#rulers_container").hide();
	}
	if (currentMapZoomLevel=='system'){
		$("#rulers_container").hide();
	}


	var aRankings=new Array;
	var pRankings=new Array;
	if (currentMapZoomLevel=='galaxy'){
		aRankings=ad2460.universe.topAlliances;
		pRankings=ad2460.universe.topPlayers;
	}
	if (currentMapZoomLevel=='quadrant'){
		var thisQuadrant=returnQuadrant(ad2460.starmap.quadrantSquare);
		aRankings=thisQuadrant.topAlliances;
		pRankings=thisQuadrant.topPlayers;
	}
	if (currentMapZoomLevel=='sector'){
		var thisSector=returnSector(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare);
		aRankings=thisSector.topAlliances;
		pRankings=thisSector.topPlayers;
	}
	if (currentMapZoomLevel=='cluster'){
		var thisCluster=returnCluster(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,ad2460.starmap.clusterSquare);
		aRankings=thisCluster.topAlliances;
		pRankings=thisCluster.topPlayers;
	}
	if (currentMapZoomLevel=='system'){
		var thisSystem=returnSystem(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,ad2460.starmap.clusterSquare,ad2460.starmap.systemSquare);
		aRankings=thisSystem.topAlliances;
		pRankings=thisSystem.topPlayers;
	}

	removeChildNodes('starmap_alliance_rank_container');

	removeChildNodes('starmap_player_rank_container');

	//console.log(aRankings);
	//console.log(pRankings);


	var container=document.getElementById('starmap_alliance_rank_container');
	for (a=0;a<aRankings.length ;a++ ){
		if (a<5){
			var classname='sm_arank_'+parseInt(a+1,10);
			var rank=parseInt(a+1,10);
			var div=createSingleElement('div', classname, '', rank+'. '+aRankings[a].name, 'loadAllianceInfo('+aRankings[a].id+')');
			div.style.color=playerIdToColor(aRankings.alliance_id);
			div.style.cursor='pointer';
			container.appendChild(div);

		}
	}

	var container=document.getElementById('starmap_player_rank_container');
	if (pRankings){
		for (a=0;a<pRankings.length ;a++ ){
			if (a<5){
				var classname='sm_arank_'+parseInt(a+1,10);
				classname='';
				var rank=parseInt(a+1,10);
				var element=createSingleElement('div', classname, '', rank+'. '+pRankings[a].nickname, "zoomInTo("+pRankings[a].quadrant+","+pRankings[a].sector+","+pRankings[a].cluster+","+pRankings[a].system+","+parseInt(pRankings[a].position,10)+")");
				element.style.cursor='pointer';
				element.style.color=playerIdToColor(pRankings[a].user_id);
				var drawCoords=convertGlobalCoordsToDrawCoords(pRankings[a].x,pRankings[a].y);
				element.setAttribute('onmouseover','showStarMapPlanetMarker('+parseInt(drawCoords.x-12,10)+','+parseInt(drawCoords.y-12,10)+')');
				element.setAttribute('onmouseout','hideStarMapPlanetMarker()');
				container.appendChild(element);
			}
		}
	}

	if (currentMapZoomLevel=='sector'){
		updateSectorInfo();
	}
	if (currentMapZoomLevel=='cluster'){
		updateClusterInfo();
	}
}

function showStarMapPlanetMarker(x,y){
	document.getElementById('sm_planet_marker').style.left=x+'px';
	document.getElementById('sm_planet_marker').style.top=y+'px';
	document.getElementById('sm_planet_marker').style.display='block';
//	$("#sm_planet_marker").css('left',x+'px');
//	$("#sm_planet_marker").css('top',y+'px');
//	$("#sm_planet_marker").show();
}

function hideStarMapPlanetMarker(){
	document.getElementById('sm_planet_marker').style.display='none';
	//$("#sm_planet_marker").hide();
}

function renderGridSectorIcons(view){
	if (view=='sector'){
		// Here we need to check the clusters in the current sector for prospected and prospecting values...
		var quadrant_local_id=ad2460.starmap.quadrantSquare;
		var sector_local_id=ad2460.starmap.sectorSquare;

		var thisSector=returnSector(ad2460.starmap.quadrantSquare , ad2460.starmap.sectorSquare);

		var i=0;

		for (i=0;i<thisSector.clusters.length ;i++ ){
			var thisCluster=thisSector.clusters[i];
			if (thisCluster.prospected>0){
				renderGridIcon('prospected',thisCluster.cluster_local_id);
			}
			if (thisCluster.prospecting>0){
				renderGridIcon('prospecting',thisCluster.cluster_local_id);
			}
			if (thisCluster.c_ctrl_a_id>0){
				var alliance=returnAllianceById(thisCluster.c_ctrl_a_id);
				if (alliance!=false){
					renderClusterOwnerShip(alliance.name, thisCluster.cluster_local_id, alliance.alliance_id);
				}
			}
			// Later we must add intel-checks here as well, to render the intel-icons
		}
	}
	else if (view=='quadrant'){
		var q=returnQuadrant(ad2460.starmap.quadrantSquare);
		//console.log(q);
		if (q){
			var i=0;
			for (i=0;i<q.sectors.length ;i++ ){
				var thisSector=q.sectors[i];
				//console.log(thisSector);
				if (thisSector.s_ctrl_a_id>0 && thisSector.s_ctrl_a_id<1000000000){
					var alliance=returnAllianceById(thisSector.s_ctrl_a_id);
					if (alliance!=false){
						renderClusterOwnerShip(alliance.name, thisSector.sector_local_id, alliance.alliance_id);
					}
				}
				else if (thisSector.s_ctrl_a_id==1000000000){
					renderClusterConflict('Contested', thisSector.sector_local_id, 0);
				}
			}
		}
	}
}

function updateClusterInfo(){
	var thisCluster=returnCluster(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,ad2460.starmap.clusterSquare);
	var station_owner_id=false;
	var station_owner_name=false;
	var station_owner_alliance_name=false;
	var station_owner_strength=false;
	var station_owner_avatar=false;

	$("#cluster_view_owner_name").html('-');
	$("#cluster_view_owner_avatar").hide();

	if (thisCluster){
		for (var x=0;x<thisCluster.systems.length ;x++ ){
			for (var y=0;y<thisCluster.systems[x].planets.length ;y++ ){
				var p=thisCluster.systems[x].planets[y];
				if (p.world_type==60){
					//console.log(p);
					station_owner_id=p.owner_id;
					station_owner_name=p.nickname;
					station_owner_alliance_name=p.alliance_name;
					station_owner_strength='Unknown';
					var latestIntel=returnLatestIntelReport(p.planet_id);
					if (latestIntel.strength_present>-1){
						station_owner_strength=prettyPrint(latestIntel.strength_present);
					}
					station_owner_avatar=p.avatar;

					var desc_string='This station is dormant and we have been unable to access it or gather any information about it.';
					if (p.inactive==0){
						desc_string=returnSectorDescString(ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].sectors[ad2460.starmap.sectorSquare-1].bonus_type);
					}
					$("#cluster_bonus_desc").html(desc_string);


				}
			}
		}
	}

	if (station_owner_id!=false){
		if (station_owner_id>0){
			$("#cluster_view_owner_name").html(station_owner_name);
			$("#cluster_view_station_strength").html(station_owner_strength);
			$("#cluster_view_owner_avatar").attr("src","images/uploads/avatars/"+station_owner_avatar);
			$("#cluster_view_owner_avatar").show();
		}
		else {
			$("#cluster_view_owner_name").html('-');
			$("#cluster_view_station_strength").html('-');
			$("#cluster_view_owner_avatar").hide();
		}
	}

	$("#cluster_bonus_desc").html(desc_string);

}

function returnSectorDescString(type){
	if (type=='absorbption')		{ return "Controlling this sector gives the owning alliance +150% Absorption on all capital ships, divided by all members, and capped at max 25%.";	}
	if (type=='homeworld_mining')	{ return "Controlling this sector gives the owning alliance +150% Homeworld Mining, divided by all members., and capped at max 25%.";	}
	if (type=='outpost_mining')		{ return "Controlling this sector gives the owning alliance +150% Outpost Mining on all outposts, divided by all members, and capped at max 25%.";	}
	if (type=='primary_damage')		{ return "Controlling this sector gives the owning alliance +150% Primary Firepower on all capital ships, divided by all members, and capped at max 25%.";	}
	if (type=='secondary_damage')	{ return "Controlling this sector gives the owning alliance +150% Secondary Firepower on all capital ships, divided by all members, and capped at max 25%.";	}
	if (type=='tertiary_damage')	{ return "Controlling this sector gives the owning alliance +150% Tertiary Firepower on all capital ships, divided by all members, and capped at max 25%.";	}
	if (type=='production_cost')	{ return "Controlling this sector gives the owning alliance -150% Production-cost on all capital ships, divided by all members, and capped at max 25%.";	}
	if (type=='shield_regen')		{ return "Controlling this sector gives the owning alliance +150% Shield Regeneration on all capital ships, divided by all members, and capped at max 25%.";	}
}

function updateSectorInfo(){
	$("#sector_view_sector_bonus").html(bonusTypeToString(ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].sectors[ad2460.starmap.sectorSquare-1].bonus_type));
	$("#sector_view_sector_name").html(ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].sectors[ad2460.starmap.sectorSquare-1].sector_name);
	var alliance=returnAllianceById(ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].sectors[ad2460.starmap.sectorSquare-1].s_ctrl_a_id);

	var desc_string=returnSectorDescString(ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].sectors[ad2460.starmap.sectorSquare-1].bonus_type);
	//bonusTypeToString(type)
	$("#sector_bonus_desc").html(desc_string);

	if (alliance){
		$("#sector_view_alliance_name").html(alliance.name);
		$("#sector_view_sector_alliance_logo").attr("src","images/uploads/alliancelogos/"+alliance.logo_url);
		$("#sector_view_sector_alliance_logo").show();
		var stations_count=0;
		var x=0;
		for (x=0;x<ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].sectors[ad2460.starmap.sectorSquare-1].clusters.length ;x++ ){
			if (ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].sectors[ad2460.starmap.sectorSquare-1].clusters[x].c_ctrl_a_id==alliance.alliance_id){
				stations_count++;
			}
		}
		$("#sector_stations_count").html(stations_count);
		if (stations_count==0){
			$("#sector_stations_container").hide();
		}
		else {
			$("#sector_stations_container").show();
		}
	}
	else {
		$("#sector_view_alliance_name").html("-");
		$("#sector_view_sector_alliance_logo").hide();
		$("#sector_stations_count").html("-");
		$("#sector_stations_container").hide();
	}
}

function renderClusterOwnerShip(name, local_id, alliance_id){
	var myArray = returnCoordsArray(local_id);
	var x=myArray[0];
	var y=myArray[1];
	var containerId='grid'+x+'_'+y;
	var container=document.getElementById(containerId);

	var extraclass=returnTextColClassBasedOnAllianceId(alliance_id);

	var elm=document.createElement('div');
	elm.setAttribute('class','sm_area_ownership_name '+extraclass);
	elm.innerHTML=name;
	container.appendChild(elm);
}

function renderClusterConflict(name, local_id, alliance_id){
	var myArray = returnCoordsArray(local_id);
	var x=myArray[0];
	var y=myArray[1];
	var containerId='grid'+x+'_'+y;
	var container=document.getElementById(containerId);

	var elm=document.createElement('div');
	elm.setAttribute('class','sm_area_ownership_name contested');
	elm.innerHTML=name;
	container.appendChild(elm);
}


function renderGridIcon(type,local_id){
	// type is i.e. 'prospected' or 'prospecting'
	// local_id is 1-16
	// container is the element with an id like 'grid4_2'
	var myArray = returnCoordsArray(local_id);
	var x=myArray[0];
	var y=myArray[1];

	var src="images/icons/none.png";

	var containerId='grid'+x+'_'+y;

	var container=document.getElementById(containerId);

	if (type == 'prospected'){
		src="images/icons/prospected.png";
	}
	if (type == 'prospecting'){
		src="images/icons/prospecting.png";
	}

	var img=document.createElement('img');
	img.style.cssFloat='right';
	img.setAttribute('src',src);
	img.setAttribute('class','gridicon');

	container.appendChild(img);

	// console.log("renderGridIcon called with type "+type+ "and coords "+x+" "+y+" and gives a container-id of "+containerId);
}


function updateGalaxyAlliances(allianceData){
	ad2460.universe.topAlliances=new Array;
	var a=0;
	for (a=0;a<allianceData.length ;a++ ){
		ad2460.universe.topAlliances.push(new allianceStarmapRankEntry(allianceData[a].id,allianceData[a].rank,allianceData[a].name,allianceData[a].score));
	}
	removeChildNodes('starmap_alliance_rank_container');
	var container=document.getElementById('starmap_alliance_rank_container');
	for (a=0;a<ad2460.universe.topAlliances.length ;a++ ){
		if (a<5){
			var classname='sm_arank_'+parseInt(a+1,10);
			container.appendChild(createSingleElement('div', classname, '', ad2460.universe.topAlliances[a].rank+'. '+ad2460.universe.topAlliances[a].name, ''));
		}
	}
}

function updateGalaxyPlayers(playerData){
	ad2460.universe.topPlayers=new Array;
	var a=0;
	for (a=0;a<playerData.length ;a++ ){
		ad2460.universe.topPlayers.push(new playerStarmapRankEntry(playerData[a].rank, playerData[a].nickname, playerData[a].user_id, playerData[a].score, playerData[a].quadrant, playerData[a].sector, playerData[a].cluster, playerData[a].system, playerData[a].position, playerData[a].homeworld_id));
	}
	removeChildNodes('starmap_player_rank_container');
	var container=document.getElementById('starmap_player_rank_container');
	for (a=0;a<ad2460.universe.topPlayers.length ;a++ ){

		var element=createSingleElement('div', '', '', ad2460.universe.topPlayers[a].rank+'. '+ad2460.universe.topPlayers[a].nickname, "zoomInTo("+ad2460.universe.topPlayers[a].quadrant+","+ad2460.universe.topPlayers[a].sector+","+ad2460.universe.topPlayers[a].cluster+","+ad2460.universe.topPlayers[a].system+","+parseInt(ad2460.universe.topPlayers[a].position,10)+")");
		element.style.color=playerIdToColor(ad2460.universe.topPlayers[a].user_id);
		container.appendChild(element);
	}
}

function updateQuadrant(quadrant_id, quadrant_local_id, quadrant_name, last_fetch){
	var i=0;
	var foundIt=false;
	for (i=0;i<ad2460.universe.quadrants.length ;i++ ){
		var thisQuadrant=ad2460.universe.quadrants[i];
		if (thisQuadrant.quadrant_id==quadrant_id){
			thisQuadrant.quadrant_local_id=quadrant_local_id;
			thisQuadrant.quadrant_name=quadrant_name;
			thisQuadrant.last_fetch=last_fetch;
			foundIt=true;
			return;
		}
	}

	if (foundIt==false){
		ad2460.universe.quadrants.push(new Quadrant(quadrant_id, quadrant_local_id, quadrant_name, last_fetch));
	}
}

function updateQuadrantAlliances(quadrant_id, allianceData){
	var i=0;
	var foundIt=false;
	for (i=0;i<ad2460.universe.quadrants.length ;i++ ){
		var thisQuadrant=ad2460.universe.quadrants[i];
		if (thisQuadrant.quadrant_id==quadrant_id){
			removeChildNodes('starmap_alliance_rank_container');
			var container=document.getElementById('starmap_alliance_rank_container');
			thisQuadrant.topAlliances=new Array;
			var a=0;
			for (a=0;a<allianceData.length ;a++ ){
				if (a<5){
					thisQuadrant.topAlliances.push(new allianceStarmapRankEntry(allianceData[a].id, allianceData[a].rank, allianceData[a].name, allianceData[a].score));
					var classname='sm_arank_'+parseInt(a+1,10);
					container.appendChild(createSingleElement('div', classname, '', thisQuadrant.topAlliances[a].rank+'. '+thisQuadrant.topAlliances[a].name, ''));
				}
			}
			return;
		}
	}
}

function updateQuadrantPlanets(quadrant_id, planetData){

	var i=0;
	var foundIt=false;
	for (i=0;i<ad2460.universe.quadrants.length ;i++ ){
		var thisQuadrant=ad2460.universe.quadrants[i];
		if (thisQuadrant.quadrant_id==quadrant_id){
			thisQuadrant.topPlayers=new Array;
			removeChildNodes('starmap_player_rank_container');
			var container=document.getElementById('starmap_player_rank_container');
			var a=0;
			for (a=0;a<planetData.length ;a++ ){
				thisQuadrant.topPlayers.push(new playerStarmapRankEntry(planetData[a].rank, planetData[a].nickname, planetData[a].user_id, planetData[a].score, planetData[a].quadrant, planetData[a].sector, planetData[a].cluster, planetData[a].system, planetData[a].position, planetData[a].homeworld_id));
				var element=createSingleElement('div', '', '', planetData[a].rank+'. '+planetData[a].nickname, "zoomInTo("+planetData[a].quadrant+","+planetData[a].sector+","+planetData[a].cluster+","+planetData[a].system+","+parseInt(planetData[a].position,10)+")");
				element.style.color=playerIdToColor(planetData[a].user_id);
				container.appendChild(element);
			}
			return;
		}
	}
}

function updateSector(sector_id, sector_local_id, quadrant_id, last_fetch, sector_name, bonus_type, s_ctrl_a_id, main_station_cluster_local_id){
	var quadrant=0;
	var sector=0;
	var foundIt=false;

	for (quadrant=0;quadrant<ad2460.universe.quadrants.length ;quadrant++ ){
		var thisQuadrant=ad2460.universe.quadrants[quadrant];
		if (thisQuadrant.quadrant_id==quadrant_id){
			// We're in the right quadrant, now look for the sector!!
			for (sector=0;sector<thisQuadrant.sectors.length ;sector++ ){
				var thisSector=thisQuadrant.sectors[sector];
				if (thisSector.sector_id==sector_id){
					// Found it!
					// console.log("Found it.");
					thisSector.sector_local_id=sector_local_id;
					thisSector.quadrant_id=quadrant_id;
					thisSector.last_fetch=last_fetch;
					thisSector.sector_name=sector_name;
					thisSector.bonus_type=bonus_type;
					thisSector.s_ctrl_a_id=s_ctrl_a_id;
					thisSector.main_station_cluster_local_id=main_station_cluster_local_id;
					foundIt=true;
					return;
				}
			}
			if (foundIt==false){
				//console.log("Creating sector: "+sector_id +" "+ sector_local_id +" "+ quadrant_id +" "+ last_fetch);
				thisQuadrant.sectors.push(new Sector(sector_id, sector_local_id, quadrant_id, last_fetch, sector_name, bonus_type, s_ctrl_a_id, main_station_cluster_local_id));
			}
		}
	}

}

function updateSectorAlliances(sector_id, allianceData){
	var i=0;
	var foundIt=false;
	for (i=0;i<ad2460.universe.quadrants.length ;i++ ){
		var thisQuadrant=ad2460.universe.quadrants[i];
		var sector=0;
		for (sector=0;sector<thisQuadrant.sectors.length ;sector++ ){
			thisSector=thisQuadrant.sectors[sector];
			if (thisSector.sector_id==sector_id){
				thisSector.topAlliances=new Array;
				var a=0;
				for (a=0;a<allianceData.length ;a++ ){
					thisSector.topAlliances.push(allianceData[a].name,allianceData[a].id,allianceData[a].score);
				}
			}
		}
	}
}

function updateSectorPlanets(quadrant, sector, planetData){
	var i=0;
	var foundIt=false;
	thisSector=returnSector(quadrant, sector);
	thisSector.topPlayers=new Array;
	var a=0;
	for (a=0;a<planetData.length ;a++ ){
		thisSector.topPlayers.push(new playerStarmapRankEntry(planetData[a].rank, planetData[a].nickname, planetData[a].user_id, planetData[a].score, planetData[a].quadrant, planetData[a].sector, planetData[a].cluster, planetData[a].system, planetData[a].position, planetData[a].homeworld_id));
	}
}


function updateCluster(cluster_id, cluster_local_id, sector_id, quadrant_id, last_fetch, prospected, prospecting, c_ctrl_a_id){
	// console.log("!!!!!!!!!!!!!!!! updateCluster called "+cluster_id+" "+cluster_local_id+" "+sector_id+" "+last_fetch);
	var quadrant=0;
	var sector=0;
	var cluster=0;
	var foundIt=false;
	for (quadrant=0;quadrant<ad2460.universe.quadrants.length ;quadrant++ ){
		var thisQuadrant=ad2460.universe.quadrants[quadrant];
		if (thisQuadrant.quadrant_id==quadrant_id){
			// We're in the right quadrant, now look for the sector!!
			for (sector=0;sector<thisQuadrant.sectors.length ;sector++ ){
				var thisSector=thisQuadrant.sectors[sector];
				if (thisSector.sector_id==sector_id){
					for (cluster=0;cluster<thisSector.clusters.length ;cluster++ ){
						var thisCluster=thisSector.clusters[cluster];
						if (thisCluster.cluster_id==cluster_id){
							// Found it!
							thisCluster.cluster_local_id=cluster_local_id;
							thisCluster.sector_id=sector_id;
							thisCluster.last_fetch=last_fetch;
							thisCluster.prospected=prospected;
							thisCluster.prospecting=prospecting;
							thisCluster.c_ctrl_a_id=c_ctrl_a_id;
							foundIt=true;
							return;
						}
					}
					if (foundIt==false){
						thisSector.clusters.push(new Cluster(cluster_id, cluster_local_id, sector_id, last_fetch, prospected, prospecting, c_ctrl_a_id));
						return;
					}

				}
			}
		}
	}
}

function updateClusterAlliances(cluster_id, allianceData){
	var quadrant=0;
	var sector=0;
	var cluster=0;
	var foundIt=false;
	for (quadrant=0;quadrant<ad2460.universe.quadrants.length ;quadrant++ ){
		var thisQuadrant=ad2460.universe.quadrants[quadrant];
		if (thisQuadrant.quadrant_id==quadrant_id){
			// We're in the right quadrant, now look for the sector!!
			for (sector=0;sector<thisQuadrant.sectors.length ;sector++ ){
				var thisSector=thisQuadrant.sectors[sector];
				for (cluster=0;cluster<thisSector.clusters.length ;cluster++ ){
					var thisCluster=thisSector.clusters[cluster];
					if (thisCluster.cluster_id==cluster_id){
						// Found it!
						thisCluster.topAlliances=new Array;
						var a=0;
						for (a=0;a<allianceData.length ;a++ ){
							thisCluster.topAlliances.push(allianceData[a].name,allianceData[a].id,allianceData[a].score);
						}
					}
				}
			}
		}
	}
}

function updateClusterPlanets(quadrant, sector, cluster, planetData){
	var i=0;
	var foundIt=false;
	thisCluster=returnCluster(quadrant, sector, cluster);
	thisCluster.topPlayers=new Array;
	var a=0;
	for (a=0;a<planetData.length ;a++ ){
		thisCluster.topPlayers.push(new playerStarmapRankEntry(planetData[a].rank, planetData[a].nickname, planetData[a].user_id, planetData[a].score, planetData[a].quadrant, planetData[a].sector, planetData[a].cluster, planetData[a].system, planetData[a].position, planetData[a].homeworld_id));
	}
}

function updateSolarSystem(quadrant_id, sector_id, cluster_id, system_id, quadrant_local_id, sector_local_id, cluster_local_id, system_local_id, occupied_habitable_planets, locked, system_type, last_fetch){
	var i=0;
	var foundIt=false;

	var quadrant=0;
	var sector=0;
	var cluster=0;
	var system=0;


	for (quadrant=0;quadrant<ad2460.universe.quadrants.length ;quadrant++ ){
		if (quadrant_id==ad2460.universe.quadrants[quadrant].quadrant_id){
			thisQuadrant=ad2460.universe.quadrants[quadrant];
			for (sector=0;sector<thisQuadrant.sectors.length ;sector++ ){
				if (sector_id==thisQuadrant.sectors[sector].sector_id){
					thisSector=thisQuadrant.sectors[sector];
					for (cluster=0;cluster<thisSector.clusters.length ;cluster++ ){
						if (cluster_id==thisSector.clusters[cluster].cluster_id){
							thisCluster=thisSector.clusters[cluster];
							for (system=0;system<thisCluster.systems.length ;system++ ){
								if (system_id==thisCluster.systems[system].system_id){
									// Holy schmoke, we got it!
									thisSystem=thisCluster.systems[system];
									thisSystem.occupied_habitable_planets=occupied_habitable_planets;
									thisSystem.locked=locked;
									thisSystem.system_type=system_type;
									thisSystem.last_fetch=last_fetch;
									foundIt=true;
									return;
								}
							}
							if (foundIt==false){
								var thisSystem=new System(quadrant_id, sector_id, cluster_id, system_id, quadrant_local_id, sector_local_id, cluster_local_id, system_local_id, occupied_habitable_planets, locked, system_type, last_fetch);
								thisCluster.systems.push(thisSystem);
							}
						}
					}
				}
			}
		}
	}
}

function updatePlanet(planet_id, planet_name , owner_id , x , y  , habitable , world_type , quadrant , sector , cluster , system , position , nickname, alliance_id, alliance_name, player_rank ,alliance_rank, resource_tilt, output_potential, avatar, score, strength, player_level, asleep_until, amnesty_until, closed, inactive, planet_grace, outpost_level){
	// Browse the systems, and upon a match, browse the planets and update as needed or create a new one
	var i=0;
	var done=false;

	var quadrant_counter=0;
	var sector_counter=0;
	var cluster_counter=0;
	var system_counter=0;
	var planet_counter=0;

	for (quadrant_counter=0;quadrant_counter<ad2460.universe.quadrants.length ;quadrant_counter++ ){
		if (quadrant==ad2460.universe.quadrants[quadrant_counter].quadrant_local_id){
			thisQuadrant=ad2460.universe.quadrants[quadrant_counter];
			for (sector_counter=0;sector_counter<thisQuadrant.sectors.length ;sector_counter++ ){
				if (sector==thisQuadrant.sectors[sector_counter].sector_local_id){
					thisSector=thisQuadrant.sectors[sector_counter];
					for (cluster_counter=0;cluster_counter<thisSector.clusters.length ;cluster_counter++ ){
						if (cluster==thisSector.clusters[cluster_counter].cluster_local_id){
							thisCluster=thisSector.clusters[cluster_counter];
							for (system_counter=0;system_counter<thisCluster.systems.length ;system_counter++ ){
								if (system==thisCluster.systems[system_counter].system_local_id){
									// We got the right system!!!
									thisSystem=thisCluster.systems[system_counter];
									for (planet_counter=0;planet_counter<thisSystem.planets.length ;planet_counter++ ){
										var thisPlanet=thisSystem.planets[planet_counter];
										if (thisPlanet.planet_id==planet_id){
											thisPlanet.planet_id=planet_id;
											thisPlanet.planet_name=planet_name;
											thisPlanet.owner_id=owner_id;
											thisPlanet.x=x;
											thisPlanet.y=y;
											thisPlanet.habitable=habitable;
											thisPlanet.world_type=world_type;
											thisPlanet.quadrant=quadrant;
											thisPlanet.sector=sector;
											thisPlanet.cluster=cluster;
											thisPlanet.system=system;
											thisPlanet.position=position;
											thisPlanet.nickname=nickname;
											thisPlanet.alliance_id=alliance_id;
											thisPlanet.alliance_name=alliance_name;
											thisPlanet.player_rank=player_rank;
											thisPlanet.alliance_rank=alliance_rank;
											thisPlanet.resource_tilt=resource_tilt;
											thisPlanet.output_potential=output_potential;
											thisPlanet.avatar=avatar;
											thisPlanet.score=score;
											thisPlanet.strength=strength;
											thisPlanet.player_level=player_level;
											thisPlanet.asleep_until=asleep_until;
											thisPlanet.amnesty_until=amnesty_until;
											thisPlanet.closed=closed;
											thisPlanet.inactive=inactive;
											thisPlanet.planet_grace=planet_grace;
											thisPlanet.outpost_level=outpost_level;

											done=true;
											return;
										}
									}
									if (done==false){
										// We need to create the planet-object and push it into the array
										var thisPlanet=new Planet(planet_id, planet_name, owner_id, x, y, habitable, world_type, quadrant, sector, cluster, system, position, nickname, alliance_id, alliance_name, player_rank, alliance_rank, resource_tilt, output_potential, avatar, score, strength, player_level, asleep_until, amnesty_until, closed, inactive, planet_grace, outpost_level);
										thisSystem.planets.push(thisPlanet);
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

function getGalaxyData(){
	var unix_timestamp = Math.round((new Date()).getTime() / 1000);
	var max_age=60;
	var threshold=unix_timestamp-max_age;
	var found=false;
	var stale=false;

	if (ad2460.universe.last_fetch<threshold){
		// console.log('getGalaxyData mustget');
		loadGalaxyContent(); // will get a call to renderGalaxyData in the callback
		ad2460.universe.last_fetch=unix_timestamp;
	}
	else {
		// render the galaxydata we already have!
		ad2460.starmap.dataFetch=true;
		// console.log('getGalaxyData hascached');
		renderMapData();
		// renderGalaxyData();
	}
}

function getQuadrantData(quadrant){
	// console.log("!!!!! getQuadrantData called");
	var unix_timestamp = Math.round((new Date()).getTime() / 1000);
	var max_age=60;
	var threshold=unix_timestamp-max_age;
	var found=false;
	var stale=false;

	var i=0;
	for (i=0;i<ad2460.universe.quadrants.length ;i++ ){
		var thisQuadrant=ad2460.universe.quadrants[i];
		if (thisQuadrant.quadrant_local_id==quadrant){
			// Not good enough, we need to check the length of its sectors-array
			if (thisQuadrant.sectors.length>0){
				found=true;
				if (thisQuadrant.last_fetch<threshold){
					stale=true;
				}
			}
		}
	}

	// console.log("getQuadrantData: found="+found+" :: stale="+stale);

	if (found==false || stale==true){
		// Fetch the data from the server!
		// console.log('getQuadrantData mustfetch');
		loadQuadrantContent(quadrant); // will get a call to renderQuadrantData in the callback
	}
	else {
		ad2460.starmap.dataFetch=true;
		// console.log('getQuadrantData hascached');
		renderMapData();
		// renderQuadrantData(quadrant);
	}

}

function getSectorData(quadrant,sector){

	// console.log("!!!!! getSectorData called.");
	var unix_timestamp = Math.round((new Date()).getTime() / 1000);
	var max_age=60;
	var threshold=unix_timestamp-max_age;
	var found=false;
	var stale=false;

	var q=0;
	var s=0;
	for (q=0;q<ad2460.universe.quadrants.length ;q++ ){
		var thisQuadrant=ad2460.universe.quadrants[q];
		if (thisQuadrant.quadrant_local_id==quadrant){
			for (s=0;s<thisQuadrant.sectors.length ;s++ ){
				var thisSector=thisQuadrant.sectors[s];
				if (thisSector.sector_local_id==sector)	{
					if (thisSector.clusters.length>0){
						found=true;
						if (thisSector.last_fetch<threshold){
							stale=true;
						}
					}
				}
			}
		}
	}


	if (found==false || stale==true){
		// Fetch the data from the server!
		// console.log('getSectorData mustfetch');
		loadSectorContent(quadrant, sector); // will get a call to renderSectorData in the callback
	}
	else {
		ad2460.starmap.dataFetch=true;
		// console.log('getSectorData hascached');
		renderMapData();
		// renderSectorData(quadrant,sector);
	}
}


function getClusterData(quadrant , sector , cluster, renderSystemOnComplete, planet){
	var renderSystemData=0;
	if (renderSystemOnComplete==1){
		renderSystemData=1;
	}

	var planet=ad2460.starmap.getClusterPlanet;

	ad2460.starmap.getClusterPlanet=0;

	var unix_timestamp = Math.round((new Date()).getTime() / 1000);
	var system_max_age=30;
	var threshold=unix_timestamp-system_max_age;
	var foundSystem=false;
	var staleSystem=false;
	var i=0;

	var quadrant_counter=0;
	var sector_counter=0;
	var cluster_counter=0;
	var system_counter=0;

	for (quadrant_counter=0;quadrant_counter<ad2460.universe.quadrants.length ;quadrant_counter++ ){
		if (quadrant==ad2460.universe.quadrants[quadrant_counter].quadrant_local_id){
			thisQuadrant=ad2460.universe.quadrants[quadrant_counter];
			for (sector_counter=0;sector_counter<thisQuadrant.sectors.length ;sector_counter++ ){
				if (sector==thisQuadrant.sectors[sector_counter].sector_local_id){
					thisSector=thisQuadrant.sectors[sector_counter];
					for (cluster_counter=0;cluster_counter<thisSector.clusters.length ;cluster_counter++ ){
						if (cluster==thisSector.clusters[cluster_counter].cluster_local_id){
							thisCluster=thisSector.clusters[cluster_counter];
							for (system_counter=0;system_counter<thisCluster.systems.length ;system_counter++ ){
								//if (system==thisCluster.systems[system_counter].system_local_id){
									thisSystem=thisCluster.systems[system_counter];
									if (thisSystem.planets.length>0){
										foundSystem=true;
										if (thisSystem.last_fetch < threshold){
											staleSystem=true;
										}
									}
								//}
							}
						}
					}
				}
			}
		}
	}
	if (foundSystem==false || staleSystem==true){
		// Fetch the data from the server!

		loadClusterContent(quadrant, sector, cluster, renderSystemData, planet);
	}
	else {
		ad2460.starmap.dataFetch=true;
		renderMapData();
		// renderClusterData(quadrant,sector,cluster);
	}
}

function iHaveTheCluster(q,s,c){
	//console.log("IhaveTheCluster called with",q,s,c);
	var cluster=returnCluster(q , s , c);
	if (cluster){
		//console.log("iMightHaveTheCluster");
		if (cluster.systems.length>0){
			//console.log("iSOOOHaveTheCluster");
			return true;
		}
		else {
			//console.log("honstlyThough, I sort of don't have it afterall");
			return false;
		}


	}
	else {
		//console.log("iDontHaveTheCluster");
		return false;
	}
}

function coordsClick(){
		var coordsstring="";
		if (ad2460.starmap.systemViewVars.currentPlanetSelect> 0){
			coordsstring="(COORDS:"+ad2460.starmap.quadrantSquare+":"+ad2460.starmap.sectorSquare+":"+ad2460.starmap.clusterSquare+":"+ad2460.starmap.systemSquare+":"+ad2460.starmap.systemViewVars.currentPlanetSelect+")";
		}
		else if (ad2460.starmap.systemSquare > 0){ 		coordsstring="(COORDS:"+ad2460.starmap.quadrantSquare+":"+ad2460.starmap.sectorSquare+":"+ad2460.starmap.clusterSquare+":"+ad2460.starmap.systemSquare+")";	}
		else if (ad2460.starmap.clusterSquare > 0){	coordsstring="(COORDS:"+ad2460.starmap.quadrantSquare+":"+ad2460.starmap.sectorSquare+":"+ad2460.starmap.clusterSquare+")";		}
		else if (ad2460.starmap.sectorSquare > 0){
			coordsstring="(COORDS:"+ad2460.starmap.quadrantSquare+":"+ad2460.starmap.sectorSquare+")";
		}
		else if (ad2460.starmap.quadrantSquare > 0){coordsstring="(COORDS:"+ad2460.starmap.quadrantSquare+")"+" The "+ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].quadrant_name+" quadrant";		}

		$("#chat_input_field").focus();
		$("#chat_input_field").val($("#chat_input_field").val()+ coordsstring);


}

function fetchMapData(currentMapZoomLevel){
	// console.log("fetchMapData called: "+currentMapZoomLevel);
	var quadrantSquare=ad2460.starmap.quadrantSquare;
	var sectorSquare=ad2460.starmap.sectorSquare;
	var clusterSquare=ad2460.starmap.clusterSquare;
	var systemSquare=ad2460.starmap.systemSquare;

	switch(currentMapZoomLevel){
	case "galaxy":
		getGalaxyData();
		break;
	case "quadrant":
		getQuadrantData(quadrantSquare);
		break;
	case "sector":
		getSectorData(quadrantSquare,sectorSquare);
		break;
	case "cluster":
		getClusterData(quadrantSquare,sectorSquare,clusterSquare,0);
		break;
	case "system":
		getClusterData(quadrantSquare,sectorSquare,clusterSquare,1);
		break;
	default:
		return false;
	}
}

function removeStarmapCanvasOverlay(){
	$("#starmapCanvasOverlay").hide();
}

function loadGalaxyContent(){
	//console.log("loadGalaxyContent called.")
	$.post('actionhandler.pl', {action:'fetch_galaxy_content'}, function(data){ parseInfo(data);});
}

function loadQuadrantContent(quadrant){
	// console.log("loadQuadrantContent called.")
	$.post('actionhandler.pl', {action:'fetch_quadrant_content' ,quadrant:quadrant}, function(data){ parseInfo(data);});
}

function loadSectorContent(quadrant, sector){
	// console.log("loadSectorContent called.")
	$.post('actionhandler.pl', {action:'fetch_sector_content' ,quadrant:quadrant, sector:sector}, function(data){ parseInfo(data);});
}

function loadClusterContent(quadrant, sector, cluster, renderSystemCallbackInteger,planet){
	//console.log("loadClusterContent called.")
	$.post('actionhandler.pl', {action:'fetch_cluster_content' ,quadrant:quadrant, sector:sector, cluster:cluster, render_system_on_complete:renderSystemCallbackInteger, planet:planet}, function(data){ parseInfo(data);});
}

function specialNewLoadClusterContent(quadrant, sector, cluster, callbackString){
	$.post('actionhandler.pl', {action:'fetch_cluster_content_special' ,quadrant:quadrant, sector:sector, cluster:cluster, callback_string:callbackString}, function(data){ parseInfo(data);});
}

function renderSolarSystem(){

	var solCanvas=document.getElementById("sol_canvas");
	var solCTX=solCanvas.getContext("2d");

	if ($("#single_infiltration_report").is(":visible")){
		$("#single_infiltration_report").animate({left: "273px"}, 500);
	}

	// Lets find the right system!
	var quadrant=ad2460.starmap.quadrantSquare;
	var sector=ad2460.starmap.sectorSquare;
	var cluster=ad2460.starmap.clusterSquare;
	var system=ad2460.starmap.systemSquare;

	//console.log("ad2460.starmap.systemSquare is "+ad2460.starmap.systemSquare);

	var thisSystem=returnSystem(quadrant, sector, cluster, system);

	var systemRenderType=returnSolarSystemRenderType(quadrant, sector, cluster, system);

	if (thisSystem==false){
		//console.log("renderSolarSystem failed due to having no system to render...");
		ad2460.starmap.solIsShown=false;
		return;
	}

	// check if we should show or hide the system_prospect_container
	var prospected=false;
	for (var p=0;p<ad2460.prospectedClusters.length ;p++ ){
		if (ad2460.prospectedClusters[p].quadrant==quadrant && ad2460.prospectedClusters[p].sector==sector && ad2460.prospectedClusters[p].cluster==cluster){
			prospected=true;
		}
	}

	if (prospected==false){
		$("#prospect_cluster_from_system_button_text").html("Prospect Now");
		$("#system_prospect_container").show();

	}
	else {
		$("#system_prospect_container").hide();
	}

	var prospecting=false;
	for (var p=0;p<ad2460.prospectingMissions.length ;p++ ){
		if (ad2460.prospectingMissions[p].quadrant==quadrant && ad2460.prospectingMissions[p].sector==sector && ad2460.prospectingMissions[p].cluster==cluster){
			prospecting=true;
		}
	}

	if (prospecting==true){
		$("#prospect_cluster_from_system_button_text").html("Prospecting...");
		$("#system_prospect_container").show();
	}


	ad2460.starmap.systemViewVars.solId=0;
	ad2460.starmap.systemViewVars.oldSol=0;
	ad2460.starmap.systemViewVars.solPlanetSelected=0;
	deleteSolPlanets();
	updateSolRings(systemRenderType);
	var i=0;
	//console.log(thisSystem.planets);
	for (i=0;i<thisSystem.planets.length ;i++){
		var thisSrc=returnRightsidePlanetImage(thisSystem.planets[i].world_type);
		var idNumber=i+1;
		var imgId='viewerplanetimg'+idNumber;
		document.getElementById(imgId).setAttribute("src",thisSrc);
		//console.log("Rendering planet "+i);
		renderSolPlanet(thisSystem.planets[i]);
	}
	showPlanets();
	renderSolCanvas(thisSystem, solCTX);
}

function updatePlanetInfoinFiveSecs(){
	setTimeout(function(){updateStarmapSelectedPlanetInfo(); }, 5000);
}

function renderSolCanvas(thisSystem, ctx){

	// first we must issue colours to each present owner_id
	var ownerArray=new Array;
	for (var i=0;i<thisSystem.planets.length ;i++ ){
		var ownerFound=false;
		if (thisSystem.planets[i].owner_id>0){
			for (var x=0;x<ownerArray.length ;x++ ){
				if (ownerArray[x].owner_id==thisSystem.planets[i].owner_id){
					ownerFound=true;
				}
			}
			if (ownerFound==false){
				ownerArray.push({owner_id:thisSystem.planets[i].owner_id, fillStyle:playerIdToBgColor(thisSystem.planets[i].owner_id)});
			}
		}
	}

	//console.log(ownerArray);
	ctx.clearRect(0, 0, 520, 520);
	for (var i=0;i<thisSystem.planets.length ;i++ ){
		if (thisSystem.planets[i].owner_id>0){
			var posObject=returnSolPlanetGridXY(thisSystem.planets[i]);
			//console.log(posObject);
			ctx.beginPath();
			ctx.lineWidth="1";
			ctx.strokeStyle="green";
			for (var x=0;x<ownerArray.length ;x++ ){
				if (ownerArray[x].owner_id==thisSystem.planets[i].owner_id){
					ctx.fillStyle=ownerArray[x].fillStyle;
					ctx.strokeStyle=playerIdToColor(ownerArray[x].owner_id);
				}
			}

			ctx.rect(posObject.x,posObject.y,130,130);
			ctx.fill();
			ctx.stroke();
		}
	}
}

function returnSolPlanetGridXY(planet){
	var retObj={x:0, y:0};
	if (planet.position==1){		retObj.x=0;			retObj.y=0;	}
	else if (planet.position==2){ retObj.x=130;		retObj.y=0;	}
	else if (planet.position==3){ retObj.x=260;		retObj.y=0;	}
	else if (planet.position==4){ retObj.x=390;		retObj.y=0;	}
	else if (planet.position==5){ retObj.x=0;			retObj.y=130;	}
	else if (planet.position==6){ retObj.x=130;		retObj.y=130;	}
	else if (planet.position==7){ retObj.x=260;		retObj.y=130;	}
	else if (planet.position==8){ retObj.x=390;		retObj.y=130;	}
	else if (planet.position==9){ retObj.x=0;			retObj.y=260;	}
	else if (planet.position==10){ retObj.x=130;		retObj.y=260;	}
	else if (planet.position==11){ retObj.x=260;		retObj.y=260;	}
	else if (planet.position==12){ retObj.x=390;		retObj.y=260;	}
	else if (planet.position==13){ retObj.x=0;			retObj.y=390;	}
	else if (planet.position==14){ retObj.x=130;		retObj.y=390;	}
	else if (planet.position==15){ retObj.x=260;		retObj.y=390;	}
	else if (planet.position==16){ retObj.x=390;		retObj.y=390;	}

	return retObj;
}


function lateCompleteRenderSolarSystem(planet){

	try{
		renderSolarSystem();
		//showSol(0,0,0);
		if (planet > 0) {
			planetClick('planetSelect'+planet, 1);
		}
	}
	catch(err){
		//console.log("Problem with lateCompleteRenderSolarSystem: Unable to render dynamic system");
		ad2460.starmap.solIsShown=false;
	}
	if (ad2460.starmap.solIsShown!=true){
		showSol(0,0,planet);
	}

}

function deleteSolPlanets(){
	var i=1;
	for (i=0;i<=16 ;i++ ){
		var id="planetSelect"+i;
		killNode(id);
	}
}

function updateSolRings(system_type){

	$('#planetlist').removeClass('planetlist_01').removeClass('planetlist_02').removeClass('planetlist_03').removeClass('planetlist_04').removeClass('planetlist_05').removeClass('planetlist_06').addClass('planetlist_0'+system_type).show();

	if (system_type==1){
		document.getElementById('solrings_image').setAttribute("src","images/fixed/fullsol1_new.jpg");
	}
	if (system_type==2){
		document.getElementById('solrings_image').setAttribute("src","images/fixed/fullsol2_new.jpg");
	}
	if (system_type==3){
		document.getElementById('solrings_image').setAttribute("src","images/fixed/fullsol3_new.jpg");
	}
	if (system_type==4){
		document.getElementById('solrings_image').setAttribute("src","images/fixed/fullsol4_new.jpg");
	}
	if (system_type==5){
		document.getElementById('solrings_image').setAttribute("src","images/fixed/fullsol5_new.jpg");
	}
	if (system_type==6){
		document.getElementById('solrings_image').setAttribute("src","images/fixed/fullsol6_new.jpg");
	}
}

function returnPlanetImage(world_type){
	var src='images/homeworlds/starmap_planets/planet_'+zeroPad(world_type)+'.png';
	return src;
}
function returnRightsidePlanetImage(world_type){
	var src='images/planets/planettype'+zeroPad(world_type)+'.png';
	return src;
}

function returnQuadrant(quadrant){
	var quadrant_counter=0;

	for (quadrant_counter=0;quadrant_counter<ad2460.universe.quadrants.length ;quadrant_counter++ ){
		if (quadrant==ad2460.universe.quadrants[quadrant_counter].quadrant_local_id){
			thisQuadrant=ad2460.universe.quadrants[quadrant_counter];
			return thisQuadrant;
		}
	}
	//console.log("Oh drat, no quadrant returned by returnQuadrant("+quadrant+")");
}

function returnSector(quadrant, sector){
	var quadrant_counter=0;
	var sector_counter=0;

	for (quadrant_counter=0;quadrant_counter<ad2460.universe.quadrants.length ;quadrant_counter++ ){
		if (quadrant==ad2460.universe.quadrants[quadrant_counter].quadrant_local_id){
			thisQuadrant=ad2460.universe.quadrants[quadrant_counter];
			for (sector_counter=0;sector_counter<thisQuadrant.sectors.length ;sector_counter++ ){
				if (sector==thisQuadrant.sectors[sector_counter].sector_local_id){
					thisSector=thisQuadrant.sectors[sector_counter];
					return thisSector;
				}
			}
		}
	}
	//console.log("Oh drat, no sector returned by returnSector("+quadrant+","+sector+")");
}

function expireCluster(quadrant , sector , cluster, inPlanet){
	var quadrant_counter=0;
	var sector_counter=0;
	var cluster_counter=0;
	for (quadrant_counter=0;quadrant_counter<ad2460.universe.quadrants.length ;quadrant_counter++ ){
		if (quadrant==ad2460.universe.quadrants[quadrant_counter].quadrant_local_id){
			thisQuadrant=ad2460.universe.quadrants[quadrant_counter];
			for (sector_counter=0;sector_counter<thisQuadrant.sectors.length ;sector_counter++ ){
				if (sector==thisQuadrant.sectors[sector_counter].sector_local_id){
					thisSector=thisQuadrant.sectors[sector_counter];
					for (cluster_counter=0;cluster_counter<thisSector.clusters.length ;cluster_counter++ ){
						if (cluster==thisSector.clusters[cluster_counter].cluster_local_id){
							thisSector.clusters[cluster_counter]=false;
						}
					}
				}
			}
		}
	}
	var planet=0;
	if (inPlanet>0){
		planet=inPlanet;
	}
	getClusterData(quadrant , sector , cluster, 1, planet);
}


function returnCluster(quadrant , sector , cluster){
	var quadrant_counter=0;
	var sector_counter=0;
	var cluster_counter=0;
	for (quadrant_counter=0;quadrant_counter<ad2460.universe.quadrants.length ;quadrant_counter++ ){
		if (quadrant==ad2460.universe.quadrants[quadrant_counter].quadrant_local_id){
			thisQuadrant=ad2460.universe.quadrants[quadrant_counter];
			for (sector_counter=0;sector_counter<thisQuadrant.sectors.length ;sector_counter++ ){
				if (sector==thisQuadrant.sectors[sector_counter].sector_local_id){
					thisSector=thisQuadrant.sectors[sector_counter];
					for (cluster_counter=0;cluster_counter<thisSector.clusters.length ;cluster_counter++ ){
						if (cluster==thisSector.clusters[cluster_counter].cluster_local_id){
							thisCluster=thisSector.clusters[cluster_counter];
							return thisCluster;
						}
					}
				}
			}
		}
	}
	//console.log("Oh drat, no cluster returned by returnCluster("+quadrant+","+sector+","+cluster+")");
	return false;
}

function returnSystem(quadrant, sector, cluster, system  ){

	//console.log("ReturnSystem called with "+quadrant+" "+sector+" "+cluster+" "+system);

	var quadrant_counter=0;
	var sector_counter=0;
	var cluster_counter=0;
	var system_counter=0;

	for (quadrant_counter=0;quadrant_counter<ad2460.universe.quadrants.length ;quadrant_counter++ ){
		if (quadrant==ad2460.universe.quadrants[quadrant_counter].quadrant_local_id){
			thisQuadrant=ad2460.universe.quadrants[quadrant_counter];
			for (sector_counter=0;sector_counter<thisQuadrant.sectors.length ;sector_counter++ ){
				if (sector==thisQuadrant.sectors[sector_counter].sector_local_id){
					thisSector=thisQuadrant.sectors[sector_counter];
					for (cluster_counter=0;cluster_counter<thisSector.clusters.length ;cluster_counter++ ){
						if (cluster==thisSector.clusters[cluster_counter].cluster_local_id){
							thisCluster=thisSector.clusters[cluster_counter];
							for (system_counter=0;system_counter<thisCluster.systems.length ;system_counter++ ){
								if (system==thisCluster.systems[system_counter].system_local_id){
									thisSystem=thisCluster.systems[system_counter];
									return thisSystem;
								}
							}
						}
					}
				}
			}
		}
	}

	//console.log("Oh shit, no system found in returnSystem!!!");
	return false;

}


function renderSolPlanet(planet){

	var container=document.getElementById('planetlist');

	var planetClass='planet_'+parseInt(planet.position,10);
	var planetId='planetSelect'+parseInt(planet.position,10);
	var planetImageSrc=returnPlanetImage(planet.world_type);

	var extraNameClass='';

	if (planet.world_type==60){
		planetClass+=' station';
		extraNameClass=' station';
	}
	if (planet.world_type==60){
		planetClass+=' bank';
		extraNameClass=' bank';
	}
	var planetContainer=createSingleElement('div','solplanet_container '+planetClass, planetId, '', 'planetClick("'+planetId+'")');
	var planetImage=createSingleElement('img','solplanet_image '+planetClass, '', planetImageSrc, '');

	var labelContainer=createSingleElement('div','solplanet_label op', '', '', '');

	var namelabel=createSingleElement('span','sol_hw_name'+extraNameClass, '', planet.planet_name, '');

	var ownerlabel=createSingleElement('span','sol_hw_player', '', planet.nickname, '');

	var own_alliance_class='';
	if (planet.alliance_id==ad2460.allianceData.id){
		own_alliance_class=' own_alliance';
	}

	var alliancelabel=createSingleElement('span','sol_hw_alliance'+own_alliance_class, '', planet.alliance_name, '');

	planetContainer.appendChild(planetImage);
	planetContainer.appendChild(labelContainer);
	labelContainer.appendChild(namelabel);
	if (planet.nickname!=""){
		labelContainer.appendChild(ownerlabel);
	}
	if (planet.alliance_name!=""){
		labelContainer.appendChild(alliancelabel);
	}
	container.appendChild(planetContainer);

	var planeticonContainer=createSingleElement('div','res_types', '', '', '');
	planetContainer.appendChild(planeticonContainer);

	// namelabel must get child-objects, based on many things:
	if (planet.world_type<10){
		// Habitable
		if (planet.owner_id>0){
			var extraImg=createSingleElement('img','planeticon square', '', 'images/icons/elements/hwicon.png', '');
			extraImg.setAttribute('title','Habitable world (occupied)');
			planetContainer.appendChild(extraImg);
		}
		else {
			var extraImg=createSingleElement('img','planeticon square', '', 'images/icons/elements/hwicon_none.png', '');
			extraImg.setAttribute('title','Habitable world (unoccupied)');
			planetContainer.appendChild(extraImg);
		}
	}
	else if(planet.world_type==70){
			var extraImg=createSingleElement('img','planeticon square', '', 'images/icons/bank_icon.png', '');
			extraImg.setAttribute('title','Habitable world (occupied)');
			planetContainer.appendChild(extraImg);
	}
	else{
		// Not habitable
		var resStringTmp=returnResourceTiltString(planet.world_type);
		var a=resStringTmp.split(" + ");
		if (a.length>0){
			if (a[0]=='Hs'){
				var extraImg=createSingleElement('img','planeticon square', '', 'images/icons/elements/hs42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
			if (a[0]=='In'){
				var extraImg=createSingleElement('img','planeticon square', '', 'images/icons/elements/in42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
			if (a[0]=='Sr'){
				var extraImg=createSingleElement('img','planeticon square', '', 'images/icons/elements/sr42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
			if (a[0]=='Nd'){
				var extraImg=createSingleElement('img','planeticon square', '', 'images/icons/elements/nd42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
			if (a[0]=='Even'){
				var extraImg=createSingleElement('img','planeticon square', '', 'images/icons/elements/even42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
		}
		if (a.length>1){
			if (a[1]=='Hs'){
				var extraImg=createSingleElement('img','planeticon square2', '', 'images/icons/elements/hs42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
			if (a[1]=='In'){
				var extraImg=createSingleElement('img','planeticon square2', '', 'images/icons/elements/in42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
			if (a[1]=='Sr'){
				var extraImg=createSingleElement('img','planeticon square2', '', 'images/icons/elements/sr42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
			if (a[1]=='Nd'){
				var extraImg=createSingleElement('img','planeticon square2', '', 'images/icons/elements/nd42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
			if (a[1]=='Even'){
				var extraImg=createSingleElement('img','planeticon square2', '', 'images/icons/elements/even42.png', '');
				planeticonContainer.appendChild(extraImg);
			}
		}
	}

}

function returnResourceTiltString(world_type){
	//console.log("returnResourceTiltString: "+world_type);
	if(world_type<60){
		return ad2460.statics.resourceTiltStrings[world_type];
	}
	else {
		return "N/A";
	}

}

function viewLatestIntelOnSelectedPlanet(){
	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	if (planet)	{
		viewIntelReport(0,planet.planet_id,planet.owner_id,planet.alliance_id,'starmap');
	}
}

var planetReloadWaiting=false;

function reloadPlanetData(){
	var d=new Date;
	if (ad2460.currentPageSectionId=='starmapslide' && ad2460.starmap.systemView==1){
		var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
		if (planet)	{
			$.post('actionhandler.pl', {action:'reload_planet_data', planet_id:planet.planet_id, quadrant:planet.quadrant, sector:planet.sector, cluster:planet.cluster}, function(data){ parseInfo(data);planetReloadWaiting=false;updateStarmapSelectedPlanetInfo();});
		}
	}
}

function showNotProspectedYet(){
	systemFeedback('Note', 'You have not prospected this cluster yet.', 3, 5);
}

function updateStarmapSelectedPlanetInfo(){
	//$("#planet_claim_1").css({top: '114px'});
	$("#claim_planet_container").hide();
	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);

	if (planet)	{
		if (planet.owner_id==ad2460.user_id){
			hideBountyIssue();
		}
		else if (planet.owner_id==0){
			hideBountyIssue();
		}
		else if (planet.world_type>10){
			hideBountyIssue();
		}
		else {
			showBountyIssue();
		}

		if (ad2460.scores.level<7){
			hideBountyIssue();
		}

		$("#planet_player_info").off("click");
		if (planet.owner_id>0){
			document.getElementById('planet_player_info').setAttribute("onclick","loadPlayerInfo("+planet.owner_id+")");
			$("#planet_player_info").css({"opacity":"1.0"});
		}

		if (planet.world_type==70){
			$("#sm_pi_player_strength_title").html("Bank strength");
		}
		else if (planet.world_type>10 && planet.world_type<60){
			$("#sm_pi_player_strength_title").html("Outpost strength");
		}
		else {
			$("#sm_pi_player_strength_title").html("Player strength");
		}


		$("#bounty_issue_help").html("Click to place bounty");
		$("#place_bounty_inner_container").show();
		var i=0;
		for (i=0;i<ad2460.bounties.length ;i++ ){
			if (planet.world_type<=10 && planet.owner_id==ad2460.bounties[i].target_user_id){
				// We have already placed a bounty on this player
				$("#bounty_issue_help").html("Bounty already placed.");
				$("#place_bounty_inner_container").hide();
			}
		}

		ad2460.starmap.currently_selected_planet_id=planet.planet_id;
		var alliance=returnAllianceById(planet.alliance_id);

		var estimated_travel_time=calcEta(planet.x, planet.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, false, false);
		var estimated_travel_time_string=secondsToFullTimeNosecs(estimated_travel_time);
		$("#sm_pi_estimated_traveltime").html(estimated_travel_time_string);

		var player_ranking_string="";
		if (planet.player_rank>0){
			player_ranking_string='#'+planet.player_rank;
		}
		var alliance_ranking_string="";
		if (planet.alliance_rank>0){
			alliance_ranking_string='#'+planet.alliance_rank;
		}

		if (planet.world_type==60){
			$("#sm_pi_planet_specific").hide();
			$("#sm_pi_station_specific").show();
		}
		else {
			$("#sm_pi_station_specific").hide();
			$("#sm_pi_planet_specific").show();
		}

		// do we need a set for banks too ? Or are we ok?


		var resource_tilt_string="Unknown";
		var output_potential_string="Unknown";
		if (planet.world_type>10 && planet.world_type<60){
			//resource_tilt_string=planet.resource_tilt;
			resource_tilt_string=returnResourceTiltString(planet.world_type);
			if (planet.output_potential>0)	{
				output_potential_string=return_output_potential_string(planet.output_potential)+' ('+planet.output_potential+'/10)';
			}
			if (planet.owner_id==0){
				var basic_outposts=0;
				var advanced_outposts=0;
				var superior_outposts=0;

				var i=0;
				for (i=0;i<ad2460.homeworld.orbit.length ;i++ ){
					if (ad2460.homeworld.orbit[i].id==438){
						basic_outposts=ad2460.homeworld.orbit[i].count;
					}
					if (ad2460.homeworld.orbit[i].id==439){
						advanced_outposts=ad2460.homeworld.orbit[i].count;
					}
					if (ad2460.homeworld.orbit[i].id==440){
						superior_outposts=ad2460.homeworld.orbit[i].count;
					}
				}

				document.getElementById('claim_basic_outpost_counter').innerHTML=basic_outposts;
				document.getElementById('claim_advanced_outpost_counter').innerHTML=advanced_outposts;
				document.getElementById('claim_superior_outpost_counter').innerHTML=superior_outposts;
				$("#claim_planet_container").show();
			}
		}
		if (planet.world_type==60 && planet.owner_id==0 && planet.inactive==0){
			$("#claim_station_container").show();
		}
		else {
			$("#claim_station_container").hide();
		}

		$("#sm_selectedPlanet_launch_button").css({"opacity":"1.0"});
		document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","starmapLaunchClick("+planet.planet_id+")");

		document.getElementById('starmap_spy').setAttribute("onclick","openEspionagePanel();closePlanetClaim();closeBountyIssue();");
		$("#starmap_spy").css({"opacity":"1.0"});

		document.getElementById('starmap_message').setAttribute("onclick","initiateConversationWithName('"+planet.nickname+"')");
		$("#starmap_message").css({"opacity":"1.0"});

		document.getElementById('planet_link_button').setAttribute("onclick","createLinkToPlanet("+planet.planet_id+")");
		document.getElementById('planet_link_image').setAttribute("src","images/icons/planet_allianceinfo_regular.png");

		$("#planet_link_button").css({"opacity":"1.0"});

		for (var link=0;link<ad2460.playerLinks.length ;link++ ){
			if (ad2460.playerLinks[link].quadrant==planet.quadrant && ad2460.playerLinks[link].sector==planet.sector && ad2460.playerLinks[link].cluster==planet.cluster && ad2460.playerLinks[link].system==planet.system && ad2460.playerLinks[link].position==planet.position){
				document.getElementById('planet_link_button').setAttribute("onclick","deletePlayerLinkClickById("+ad2460.playerLinks[link].link_id+")");
				document.getElementById('planet_link_image').setAttribute("src","images/icons/planet_unlink.png");
			}
		}

		var allied=false;
		if (planet.alliance_id==ad2460.allianceData.id && ad2460.allianceData.id>0){
			allied=true;
		}

		var planetIsLostOutpost=false;
		var o=0;
		for (o=0;o<ad2460.lostOutposts.length ;o++ ){
			if (ad2460.lostOutposts[o].planet_id==planet.planet_id){
				planetIsLostOutpost=true;
			}
		}

		//var canAttack=false;

		//if (planet.owner_id==ad2460.user_id || allied==true || planet.owner_id==0 || planet.amnesty_until>ad2460.servertime || planet.asleep_until>0)	{
		//if (planet.owner_id==ad2460.user_id || allied==true || planet.owner_id==0 || planet.amnesty_until>0 || planet.asleep_until>0 || planet.planet_grace>ad2460.serverTime)	{
		if (planet.owner_id==ad2460.user_id || planet.owner_id==0 || planet.amnesty_until>0 || planet.asleep_until>0 || planet.planet_grace>ad2460.serverTime)	{
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick",null);
			document.getElementById('starmap_spy').setAttribute("onclick",null);
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
			$("#starmap_spy").css({"opacity":"0.2"});
		}

		if (planet.world_type>10 && planet.world_type<60 && planet.output_potential==0){
			// Not prospected
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showNotProspectedYet()");
			document.getElementById('starmap_spy').setAttribute("onclick","showNotProspectedYet()");
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
			$("#starmap_spy").css({"opacity":"0.2"});
		}

		//if ((planet.strength<ad2460.scores.strength*0.75 || planet.strength>Math.floor(ad2460.scores.strength*1.3333))  && planetIsLostOutpost==false ){
		//	document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick",null);
		//	$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
		//}

		if (planet.owner_id==ad2460.user_id || planet.owner_id==0 )	{
			document.getElementById('starmap_message').setAttribute("onclick",null);
			$("#starmap_message").css({"opacity":"0.2"});

			if (planet.owner_id==0)	{
				document.getElementById('planet_player_info').setAttribute("onclick",null);
				$("#planet_player_info").css({"opacity":"0.2"});
			}
		}

		document.getElementById('sm_pi_planetname').innerHTML=planet.planet_name;
		document.getElementById('sm_pi_ownername').innerHTML=planet.nickname;
		if (planet.world_type<10){
			document.getElementById('sm_pi_planet_type').innerHTML='Habitable';
		}
		else if (planet.world_type<60){
			document.getElementById('sm_pi_planet_type').innerHTML='Mining';
		}
		else if (planet.world_type==60){
			if (planet.inactive==1)	{
				document.getElementById('sm_pi_planet_type').innerHTML='Sub-Station';
			}
			else {
				document.getElementById('sm_pi_planet_type').innerHTML='Station';
			}
		}
		else if (planet.world_type==70){
			document.getElementById('sm_pi_planet_type').innerHTML='Alliance Bank';
		}

		//if (planet.amnesty_until>ad2460.serverTime) {
		if (planet.amnesty_until>0) {
			document.getElementById('planet_status_icon').setAttribute('src','images/icons/grace_icon.png');
			document.getElementById('planet_status_text').innerHTML='Player is in grace-time and cannot be attacked at this time.';
			$("#starmap_grace_indicator").show();
		}
		else if(planet.planet_grace>ad2460.serverTime){
			document.getElementById('planet_status_icon').setAttribute('src','images/icons/grace_icon.png');
			if (planet.world_type<60){
				document.getElementById('planet_status_text').innerHTML='This outpost can not be attacked at this time.';
			}
			else if (planet.world_type==60){
				document.getElementById('planet_status_text').innerHTML='This station can not be attacked at this time.';
			}
			else if (planet.world_type==70){
				document.getElementById('planet_status_text').innerHTML='This bank can not be attacked at this time.';
			}


			$("#starmap_grace_indicator").show();

		}
		else if (planet.asleep_until>0) {
			document.getElementById('planet_status_icon').setAttribute('src','images/icons/vacationmode_icon.png');
			document.getElementById('planet_status_text').innerHTML='Player is in vacation-mode and cannot be attacked at this time.';
			$("#starmap_grace_indicator").show();
		}
		else if (planet.closed>0) {
			document.getElementById('planet_status_icon').setAttribute('src','images/icons/underattack_icon.png');
			document.getElementById('planet_status_text').innerHTML='This account is closed and cannot be attacked at this time.';
			$("#starmap_grace_indicator").show();
		}
		else{
			$("#starmap_grace_indicator").hide();
		}

		if (planet.world_type==60 && planet.inactive==1){
			$("#inactive_station_indicator").show();
		}
		else {
			$("#inactive_station_indicator").hide();
		}


		document.getElementById('sm_pi_alliancename').innerHTML=planet.alliance_name;
		document.getElementById('sm_pi_player_level').innerHTML=planet.player_level;

		if (planet.owner_id<1)	{
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(8)");
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
		}
		else if (ad2460.scores.level<7 && planet.habitable==1)	{
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(4)");
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
		}
		else if (planet.player_level<5)	{
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(1)");
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
		}
		else if (planet.player_level<7 && planet.habitable==1)	{
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(2)");
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
		}
		else if (ad2460.scores.level<5 && planet.world_type>10 && planet.world_type<60)	{
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(3)");
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
		}
		else if (ad2460.scores.level<5 && planet.world_type==70)	{
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(9)");
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
		}
		else if (ad2460.scores.level<11 && planet.world_type==60)	{
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(10)");
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
		}
		else if (planet.player_level<ad2460.scores.level && planet.habitable==1 && planet.player_level<12 && planet.strength<333333)	{
			// New , can't hit down in level!
			document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(7)");
			$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
		}


		if (planet.world_type<=10){
			var prospected=false;
			for (var p=0;p<ad2460.prospectedClusters.length ;p++ ){
				if (ad2460.prospectedClusters[p].quadrant==planet.quadrant && ad2460.prospectedClusters[p].sector==planet.sector && ad2460.prospectedClusters[p].cluster==planet.cluster){
					prospected=true;
				}
			}
			if (prospected!=true){
				document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showNotProspectedYet()");
				document.getElementById('starmap_spy').setAttribute("onclick","showNotProspectedYet()");
				$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
				$("#starmap_spy").css({"opacity":"0.2"});
			}
		}


		if (planet.habitable==1 && planet.owner_id>0 && planet.closed<1 && planet.owner_id!=ad2460.user_id)	{
			// populate fleet dropdown
			populateStarmapChallengeFleetDropdown();
			$("#starmap_challenge_container").show();
		}
		else {
			$("#starmap_challenge_container").hide();
		}

		document.getElementById('sm_pi_player_strength').innerHTML=prettyPrint(planet.strength);

		if (planet.world_type==60){
			document.getElementById('sm_pi_alliance_strength').innerHTML=prettyPrint(planet.strength);
			document.getElementById('sm_pi_bonus').innerHTML=bonusTypeToString(ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].sectors[ad2460.starmap.sectorSquare-1].bonus_type);
		}

		var myStrength=ad2460.scores.strength;
		if (myStrength<1){
			myStrength=1;
		}
		var def_str_ratio=planet.strength/ad2460.scores.strength*100;

		if (def_str_ratio>=150){
			// X3 XP
			document.getElementById('sm_pi_player_strength').style.color='red';
		}
		else if (def_str_ratio>=125 && def_str_ratio<150){
			// X2-3 XP
			document.getElementById('sm_pi_player_strength').style.color='orange';
		}
		else if (def_str_ratio>=110 && def_str_ratio<125){
			// X1-2 XP
			document.getElementById('sm_pi_player_strength').style.color='yellow';
		}
		else if (def_str_ratio>=90 && def_str_ratio<110){
			// X1 XP
			document.getElementById('sm_pi_player_strength').style.color='green';
		}
		else if (def_str_ratio>=75 && def_str_ratio<90){
			document.getElementById('sm_pi_player_strength').style.color='cyan';
			// gain less than 1X XP
		}
		else if (def_str_ratio<75){
			document.getElementById('sm_pi_player_strength').style.color='pink';
			// lose xp
		}

		if (planet.world_type>10 && planet.world_type<60){
			document.getElementById('sm_pi_player_strength').style.color='white';
		}

		if ( planet.player_level<7 && planet.habitable==1 )	{
			document.getElementById('sm_pi_player_level').style.color='red';
		}
		else if ( planet.player_level<5 && planet.habitable==0 )	{
			document.getElementById('sm_pi_player_level').style.color='red';
		}
		else {
			document.getElementById('sm_pi_player_level').style.color='white';
		}


		//document.getElementById('sm_pi_alliance_ranking').innerHTML=alliance_ranking_string;

		//document.getElementById('sm_pi_active_intelligence').innerHTML='None';

		document.getElementById('sm_pi_last_update').innerHTML='';
		document.getElementById('sm_pi_firepower_present').innerHTML=translations.general_unknown;
		//document.getElementById('sm_pi_defense_present').innerHTML=translations.general_unknown;
		//document.getElementById('sm_pi_defensive_units').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_cannons_present').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_shieldgens_present').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_artillery_present').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_stations_present').innerHTML=translations.general_unknown;

		document.getElementById('sm_pi_ships_present').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_minor_ships_present').innerHTML=translations.general_unknown;

		document.getElementById('sm_pi_stored_hassium').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_stored_strontium').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_stored_neodymium').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_stored_indium').innerHTML=translations.general_unknown;

		document.getElementById('sm_pi_outpost_level').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_outpost_current_output').innerHTML=translations.general_unknown;
		document.getElementById('sm_pi_outpost_resource_tilt').innerHTML=resource_tilt_string;
		//console.log(planet);

		document.getElementById('sm_pi_outpost_output_potential').innerHTML=output_potential_string;


		// Now the default data for the player-info and alliance-info must be set too
		removeChildNodes('playerinfo_outposts_container');
		removeChildNodes('allianceinfo_richest_members_container');

		document.getElementById('playerinfo_playername').innerHTML=planet.nickname;
		$("#playerinfo_avatar_image").attr("src","images/uploads/avatars/"+planet.avatar);
		//document.getElementById('playerinfo_avatar_image').innerHTML=translations.general_unknown;
		document.getElementById('playerinfo_playerrank').innerHTML=player_ranking_string;
		document.getElementById('playerinfo_playerscore').innerHTML=prettyPrint(planet.score);
		document.getElementById('playerinfo_playerstrength').innerHTML=prettyPrint(planet.strength);
		document.getElementById('playerinfo_capital_ships').innerHTML=translations.general_unknown;
		document.getElementById('playerinfo_total_firepower').innerHTML=translations.general_unknown;
		//document.getElementById('playerinfo_top_commander_rank').innerHTML=translations.general_unknown;
		if (alliance){
			$('#allianceinfo_logo_image').attr("src","images/uploads/alliancelogos/"+alliance.logo_url);
		}
		else {
			$('#allianceinfo_logo_image').attr("src","images/icons/missingimage.png");
		}

		document.getElementById('allianceinfo_alliance_name').innerHTML=planet.alliance_name;
		document.getElementById('allianceinfo_alliance_rank').innerHTML=alliance_ranking_string;
		document.getElementById('allianceinfo_membercount').innerHTML=translations.general_unknown;
		document.getElementById('allianceinfo_leader').innerHTML=translations.general_unknown;
		document.getElementById('allianceinfo_recruitment_officer').innerHTML=translations.general_unknown;

		if (alliance){
			document.getElementById('allianceinfo_membercount').innerHTML=alliance.members.length;
			var y=0;
			for (y=0;y<alliance.members.length ;y++ ){
				if (alliance.members[y].tag_string=='Alliance Leader'){
					document.getElementById('allianceinfo_leader').innerHTML=alliance.members[y].name;
					document.getElementById('allianceinfo_leader').style.cursor='pointer';
					var coords=convertShortCoordsToLongCoords(alliance.members[y].x,alliance.members[y].y);
					var posnum=coords.p;
					document.getElementById('allianceinfo_leader').setAttribute("onclick","zoomInTo("+coords.q+","+coords.s+","+coords.g+","+coords.o+","+posnum+")");
				}
			}
			for (y=0;y<alliance.members.length ;y++ ){
				if (alliance.members[y].tag_string=='Recruitment Officer'){
					document.getElementById('allianceinfo_recruitment_officer').innerHTML=alliance.members[y].name;
					document.getElementById('allianceinfo_recruitment_officer').style.cursor='pointer';
					var coords=convertShortCoordsToLongCoords(alliance.members[y].x,alliance.members[y].y);
					var posnum=coords.p;
					document.getElementById('allianceinfo_recruitment_officer').setAttribute("onclick","zoomInTo("+coords.q+","+coords.s+","+coords.g+","+coords.o+","+posnum+")");

				}
			}
		}



		var thisIntel=returnLatestIntelReport(planet.planet_id, planet.owner_id, planet.alliance_id);
		//console.log(thisIntel);
		var activeIntelligenceString='None';
		var x=0;
		for (x=0;x<ad2460.intel.missions.length ;x++ ){
			if (ad2460.intel.missions[x].planet_id==planet.planet_id){
				if (ad2460.intel.missions[x].type=='scout')	{
					activeIntelligenceString=translations.military_intel_type_scout;
				}
				if (ad2460.intel.missions[x].type=='espionage')	{
					activeIntelligenceString=translations.military_intel_type_espionage;
				}
				if (ad2460.intel.missions[x].type=='infiltration')	{
					activeIntelligenceString=translations.military_intel_type_infiltration;
				}
			}
		}

		//console.log(thisIntel);

		if (thisIntel){
			// planet.outpost_level=thisIntel.outpost_level;
			if (thisIntel.output_potential>0){
				output_potential_string=return_output_potential_string(thisIntel.output_potential)+' ('+thisIntel.output_potential+'/10)';
			}
			if (thisIntel.resource_tilt!='Unknown'){
				resource_tilt_string=thisIntel.resource_tilt;
			}
			resource_tilt_string=returnResourceTiltString(planet.world_type);

			//document.getElementById('sm_pi_active_intelligence').innerHTML=activeIntelligenceString;

			if (thisIntel.scoutTimestamp>0){
				document.getElementById('sm_pi_last_update').innerHTML=formatMessageTimestamp(thisIntel.scoutTimestamp);
			}
			if (thisIntel.espionageTimestamp>thisIntel.scoutTimestamp){
				document.getElementById('sm_pi_last_update').innerHTML=formatMessageTimestamp(thisIntel.espionageTimestamp);
			}

			document.getElementById('sm_pi_firepower_present').innerHTML=prettyPrint(thisIntel.strength_present);

			if (thisIntel.present_frigates>-1){
				document.getElementById('sm_pi_ships_present').innerHTML=thisIntel.present_frigates+thisIntel.present_cruisers+thisIntel.present_battleships+thisIntel.present_carriers;
				document.getElementById('sm_pi_minor_ships_present').innerHTML=thisIntel.present_minors;
				document.getElementById('sm_pi_cannons_present').innerHTML=thisIntel.present_cannons;
				document.getElementById('sm_pi_shieldgens_present').innerHTML=thisIntel.present_shieldgens;
				document.getElementById('sm_pi_artillery_present').innerHTML=thisIntel.present_artillery;
				document.getElementById('sm_pi_stations_present').innerHTML=thisIntel.present_stations;
			}
			else {
				document.getElementById('sm_pi_ships_present').innerHTML="Unknown";
				document.getElementById('sm_pi_minor_ships_present').innerHTML="Unknown";
				document.getElementById('sm_pi_cannons_present').innerHTML="Unknown";
				document.getElementById('sm_pi_shieldgens_present').innerHTML="Unknown";
				document.getElementById('sm_pi_artillery_present').innerHTML="Unknown";
				document.getElementById('sm_pi_stations_present').innerHTML="Unknown";

			}

			document.getElementById('sm_pi_stored_hassium').innerHTML=prettyPrint(thisIntel.stored_hassium);
			document.getElementById('sm_pi_stored_strontium').innerHTML=prettyPrint(thisIntel.stored_strontium);
			document.getElementById('sm_pi_stored_neodymium').innerHTML=prettyPrint(thisIntel.stored_neodymium);
			document.getElementById('sm_pi_stored_indium').innerHTML=prettyPrint(thisIntel.stored_indium);


			if (thisIntel.outpost_level>-1){
				// We need to calc the current output if we have the intel on it, as in outpost_level
				var potential=return_output_potential(thisIntel.total_output);
				var potential_string=potential+'/10';
				var outputPercent=ad2460.outpostOutputPercentages[thisIntel.outpost_level];
				calced_output=parseInt(thisIntel.total_output*outputPercent/100);
				calced_output=prettyPrint(calced_output)+" u/h";
				document.getElementById('sm_pi_outpost_level').innerHTML=thisIntel.outpost_level;
				document.getElementById('sm_pi_outpost_current_output').innerHTML=calced_output;
			}
			else {
				document.getElementById('sm_pi_outpost_level').innerHTML="Unknown";
				document.getElementById('sm_pi_outpost_current_output').innerHTML="Unknown";
			}

			document.getElementById('sm_pi_outpost_resource_tilt').innerHTML=resource_tilt_string;
			document.getElementById('sm_pi_outpost_output_potential').innerHTML=output_potential_string;



			// continue here to fill in the player-info and alliance-info if found...
			if (thisIntel.owned_frigates>-1){
				document.getElementById('playerinfo_capital_ships').innerHTML=thisIntel.owned_frigates+thisIntel.owned_cruisers+thisIntel.owned_battleships+thisIntel.owned_carriers;
			}
			if (thisIntel.owned_strength>-1){
				document.getElementById('playerinfo_total_firepower').innerHTML=thisIntel.owned_strength;
			}
			//if (thisIntel.top_commander_level>-1){
			//	var rankObj=returnCommanderRankNameObject(thisIntel.top_commander_level);
			//	document.getElementById('playerinfo_top_commander_rank').innerHTML=rankObj.longRank;
			//}

			// Now render the list of outposts!!!
			removeChildNodes('playerinfo_outposts_container');
			var outpostContainer=document.getElementById('playerinfo_outposts_container');
			// outposts-data could be "Safa|167|151||Binunu Deus|920|85||Afuris War|893|198||"
			// So first, we split on ||
			if (thisIntel.outposts!= '-1' && thisIntel.outposts!= 'Unknown' ){
				var outpostArray=thisIntel.outposts.split('||');
				var y=0;
				for (y=0;y<outpostArray.length ;y++ ){

					var dataArray=outpostArray[y].split('|');
					if (dataArray.length>1)	{

						var coordObject=convertShortCoordsToLongCoords(dataArray[2],dataArray[3]);
						var coordString='['+coordObject.q+':'+coordObject.s+':'+coordObject.g+':'+coordObject.o+'.'+coordObject.p+']';

						var elmContainer=createSingleElement('div','top_outpost_list_entry', '', '', '');
						var div1=createSingleElement('div','planetspy_info_title', '', ''+dataArray[0], '');
						var div2=createSingleElement('div','planetspy_info_def', '', '', '');
						var div3=createSingleElement('div','planetspy_info_entry coords', '', ''+coordString, 'zoomInToXY('+dataArray[2]+','+dataArray[3]+')');
						if (dataArray[4]=='1') {
							div2.innerHTML='<img src="../images/icons/defense_beacon_select.png" height="15">';
						};

						elmContainer.appendChild(div1);
						elmContainer.appendChild(div2);
						elmContainer.appendChild(div3);

						outpostContainer.appendChild(elmContainer);
					}
				}
			}

			// Now render the list of rich members!!!
			removeChildNodes('allianceinfo_richest_members_container');
			var richestContainer=document.getElementById('allianceinfo_richest_members_container');
			// outposts-data could be "Safa|167|151||Binunu Deus|920|85||Afuris War|893|198||"
			// So first, we split on ||
			if (thisIntel.alliance_bankers!= '-1' && thisIntel.alliance_bankers!= 'Unknown'  && thisIntel.alliance_bankers!= 'None' ){
				var richestArray=thisIntel.alliance_bankers.split('||');
				var y=0;
				for (y=0;y<richestArray.length ;y++ ){
					var dataArray=richestArray[y].split('|');

					if (dataArray.length>1)	{
						var coordObject=convertShortCoordsToLongCoords(dataArray[2],dataArray[3]);
						var coordString='['+coordObject.q+':'+coordObject.s+':'+coordObject.g+':'+coordObject.o+'.'+coordObject.p+']';

						var elmContainer=createSingleElement('div','banker_entry', '', '', '');
						//console.log(dataArray);
						var estimated_travel_time=calcEta(dataArray[2], dataArray[3], ad2460.homeworld.x, ad2460.homeworld.y, 1, false, false);
						var estimated_travel_time_string=secondsToFullTimeNosecs(estimated_travel_time);

						var div1=createSingleElement('div','planetspy_info_title banker', '', ''+dataArray[0], 'zoomInToXY('+dataArray[2]+','+dataArray[3]+')');
						var div2=createSingleElement('div','planetspy_info_entry travel', '', estimated_travel_time_string, '');
						var div3=createSingleElement('div','planetspy_info_entry str', '', dataArray[1],'');

						elmContainer.appendChild(div1);
						elmContainer.appendChild(div2);
						elmContainer.appendChild(div3);
						richestContainer.appendChild(elmContainer);

					}
				}
			}


			//console.log(thisIntel);

			/*
			if (thisIntel.report_id<0){
				document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(5)");
				$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
			}
			else {
				if ( thisIntel.infiltrationTimestamp<ad2460.serverTime-3600 && thisIntel.espionageTimestamp<ad2460.serverTime-3600 && thisIntel.scoutTimestamp<ad2460.serverTime-3600){
					console.log("Only stale and old intel found, should not allow an attack!");
					document.getElementById('sm_selectedPlanet_launch_button').setAttribute("onclick","showCantAttack(6)");
					$("#sm_selectedPlanet_launch_button").css({"opacity":"0.2"});
				}
			}
			*/


		}

		if (planet.world_type<=10){
			$("#sm_pi_outpost_level").hide();
			$("#sm_pi_outpost_current_output").hide();
			$("#sm_pi_outpost_resource_tilt").hide();
			$("#sm_pi_outpost_output_potential").hide();
			$("#sm_pi_outpost_level_header").hide();
			$("#sm_pi_outpost_current_output_header").hide();
			$("#sm_pi_outpost_resource_tilt_header").hide();
			$("#sm_pi_outpost_output_potential_header").hide();
			$("#spacer_2_title").hide();
			$("#spacer_2_entry").hide();
		}
		else if (planet.world_type<60){
			$("#sm_pi_outpost_level").show();
			$("#sm_pi_outpost_current_output").show();
			$("#sm_pi_outpost_resource_tilt").show();
			$("#sm_pi_outpost_output_potential").show();
			$("#sm_pi_outpost_level_header").show();
			$("#sm_pi_outpost_current_output_header").show();
			$("#sm_pi_outpost_resource_tilt_header").show();
			$("#sm_pi_outpost_output_potential_header").show();
			$("#spacer_2_title").show();
			$("#spacer_2_entry").show();
		}
		else {
			$("#sm_pi_outpost_level").hide();
			$("#sm_pi_outpost_current_output").hide();
			$("#sm_pi_outpost_resource_tilt").hide();
			$("#sm_pi_outpost_output_potential").hide();
			$("#sm_pi_outpost_level_header").hide();
			$("#sm_pi_outpost_current_output_header").hide();
			$("#sm_pi_outpost_resource_tilt_header").hide();
			$("#sm_pi_outpost_output_potential_header").hide();
			$("#spacer_2_title").hide(); $("#spacer_2_entry").hide();
		}

		if (planet.habitable==0 || planet.owner_id==0 ){
			$("#start_spy").css({"opacity":"0.3"});
			$("#start_infiltration").css({"opacity":"0.3"});
		}
		else {
			$("#start_spy").css({"opacity":"1.0"});
			$("#start_infiltration").css({"opacity":"1.0"});
		}
		if (planetReloadWaiting==false){
			setTimeout(function(){reloadPlanetData();},30000);
			planetReloadWaiting=true;
		}


	}
	else {
		//console.log("Problem in updateStarmapSelectedPlanetInfo, no planet-data available!");
		ad2460.starmap.systemViewVars.currentPlanetSelect=0;
	}
}

function specialClaimOutpostCommand(){
	var p=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	if (p!=false){
		if (p.owner_id==0){
			if (p.world_type>10 && p.world_type<60){
				var basic_outposts=0;
				var advanced_outposts=0;
				var superior_outposts=0;

				var i=0;
				for (i=0;i<ad2460.homeworld.orbit.length ;i++ ){
					if (ad2460.homeworld.orbit[i].id==438){
						basic_outposts=ad2460.homeworld.orbit[i].count;
					}
					if (ad2460.homeworld.orbit[i].id==439){
						advanced_outposts=ad2460.homeworld.orbit[i].count;
					}
					if (ad2460.homeworld.orbit[i].id==440){
						superior_outposts=ad2460.homeworld.orbit[i].count;
					}
				}
				if (superior_outposts>0){
					claimSelectedOutpost('superior');
					return;
				}
				else if (advanced_outposts>0){
					claimSelectedOutpost('advanced');
					return;
				}
				else if (basic_outposts>0){
					claimSelectedOutpost('basic');
					return;
				}
				else {
					systemFeedback('Error','You have no outpost-units to deploy.',1);
					return;
				}

			}
			else {
				systemFeedback('Error','That is not an outpost.',1);
				return;
			}

		}
		else {
			if (p.owner_id==ad2460.user_id){
				systemFeedback('Error','You already own this planet.',2);
				return;
			}
			else {
				systemFeedback('Error','This planet is owned by someone else.',2);
				return;

			}
		}

	}
	else {
		systemFeedback('Error','No valid planet selected.',3);
		return;
	}

	return;
}

function showCantAttack(id){
	var string="";
	if (id==1){
		string="You can not attack outposts belonging to a player under level 5.";
	}
	else if (id==2){
		string="You can not attack the homeworld of a player under level 7.";
	}
	else if (id==3){
		string="You must reach level 5 before you can attack outposts.";
	}
	else if (id==4){
		string="You must reach level 7 before you can attack homeworlds.";
	}
	else if (id==5){
		string="You have no intel on this target and may not attack it until you do.";
	}
	else if (id==6){
		string="Your intel on this target is old and can not be trusted. Aquire new intel before attacking.";
	}
	else if (id==7){
		string="You can not attack homeworlds belonging to players with a lower level than your own.";
	}
	else if (id==8){
		string="There is no one to attack here, as the planet is unowned.";
	}
	else if (id==9){
		string="You must reach level 5 before you can attack banks.";
	}
	else if (id==10){
		string="You must reach level 11 before you can attack stations.";
	}
	systemFeedback('Illegal attack', string, 1, 3);
}

function updateActiveIntelligenceInPlanetView(type){
	var activeIntelligenceString='Unknown';
	if (type=='scout')	{
		activeIntelligenceString=translations.military_intel_type_scout;
	}
	if (type=='espionage')	{
		activeIntelligenceString=translations.military_intel_type_espionage;
	}
	if (type=='infiltration')	{
		activeIntelligenceString=translations.military_intel_type_infiltration;
	}
	//document.getElementById('sm_pi_active_intelligence').innerHTML=activeIntelligenceString;
}

function returnLatestIntelReport(planet_id, owner_id, alliance_id){
	// Loop through all reports present, and put those matching the planet in an array, then sort by timestamp
	// then we must assemble a complete report based on what we have, with different timestamps.
	// Hang on....We might also want data from espionage-reports and infiltration-reports for the same user, but NOT the same planet....

	var summaryReport={};

	summaryReport.report_id=-1;
	summaryReport.mission_id=-1;
	summaryReport.type=-1;
	summaryReport.timestamp=-1;
	summaryReport.user_id=-1;
	summaryReport.user_alliance_id=-1;
	summaryReport.planet_id=-1;
	summaryReport.planet_name=-1;
	summaryReport.planet_x=-1;
	summaryReport.planet_y=-1;
	summaryReport.planet_owner_id=-1;
	summaryReport.planet_owner_alliance_id=-1;
	summaryReport.planet_owner_alliance_name=-1;
	summaryReport.planet_owner_name=-1;
	summaryReport.planet_owner_homeworld_name=-1;
	summaryReport.planet_owner_homeworld_x=-1;
	summaryReport.planet_owner_homeworld_y=-1;
	summaryReport.strength_present='Unknown';
	summaryReport.fleets_present='Unknown';
	summaryReport.stored_hassium='Unknown';
	summaryReport.stored_strontium='Unknown';
	summaryReport.stored_neodymium='Unknown';
	summaryReport.stored_indium='Unknown';
	summaryReport.world_type=-1;
	summaryReport.outpost_level=-1;
	summaryReport.present_frigates=-1;
	summaryReport.present_cruisers=-1;
	summaryReport.present_battleships=-1;
	summaryReport.present_carriers=-1;
	summaryReport.present_minors=-1;
	summaryReport.present_cannons=-1;
	summaryReport.present_shieldgens=-1;
	summaryReport.present_artillery=-1;
	summaryReport.present_stations=-1;
	summaryReport.owned_frigates=-1;
	summaryReport.owned_cruisers=-1;
	summaryReport.owned_battleships=-1;
	summaryReport.owned_carriers=-1;
	summaryReport.owned_minors=-1;
	summaryReport.owned_cannons=-1;
	summaryReport.owned_shieldgens=-1;
	summaryReport.owned_artillery=-1;
	summaryReport.owned_stations=-1;
	summaryReport.owned_artifacts=-1;
	summaryReport.owned_strength=-1;
	summaryReport.owned_fleets=-1;
	summaryReport.player_level=-1;
	summaryReport.outposts=-1;
	summaryReport.tech_tilt='Unknown';
	summaryReport.alliance_bankers=-1;
	summaryReport.alliance_bank_hassium=-1;
	summaryReport.alliance_bank_indium=-1;
	summaryReport.alliance_bank_strontium=-1;
	summaryReport.alliance_bank_neodymium=-1;
	summaryReport.last_5_combats=-1;
	summaryReport.score_rank=-1;
	summaryReport.total_output=-1;
	summaryReport.scoutTimestamp=-1;
	summaryReport.espionageTimestamp=-1;
	summaryReport.infiltrationTimestamp=-1;

	// new intelReport(0, mission_id, type, timestamp, user_id, user_alliance_id, planet_id, planet_name, planet_owner_id, planet_owner_alliance_id, firepower_present, defense_present, capital_ships_present, stored_hassium, stored_strontium, stored_neodymium, stored_indium, outpost_level, current_output, resource_tilt, output_potential, capital_ships_owned, firepower_owned, defense_owned, top_commander_level, outposts, artifacts_owned, advancement_level, tech_tilt, alliance_rich_members)

	var entries=new Array;

	var i=0;
	for (i=0;i<ad2460.intel.reports.length ;i++ ){
		if (ad2460.intel.reports[i].planet_id==planet_id){
			entries.push(ad2460.intel.reports[i]);
		}
	}
	// Adding spy- and infiltration-reports for the same player for other planets.....!!!
	for (i=0;i<ad2460.intel.reports.length ;i++ ){
		if (ad2460.intel.reports[i].planet_id!=planet_id && ad2460.intel.reports[i].planet_owner_id==owner_id && (ad2460.intel.reports[i].type=='espionage-report' || ad2460.intel.reports[i].type=='infiltration-report') ){
			entries.push(ad2460.intel.reports[i]);
		}
	}
	for (i=0;i<ad2460.intel.reports.length ;i++ ){
		if (ad2460.intel.reports[i].planet_id!=planet_id && ad2460.intel.reports[i].planet_owner_id!=owner_id && ad2460.intel.reports[i].type=='infiltration-report' && ad2460.intel.reports[i].planet_owner_alliance_id==alliance_id && ad2460.intel.reports[i].planet_owner_alliance_id>0){
			entries.push(ad2460.intel.reports[i]);
		}
	}

	if ( owner_id!=ad2460.user_id ) {
	//if (owner_id!=ad2460.user_id && (alliance_id!=ad2460.allianceData.id || alliance_id==0 )){
		// Not our planet
		if (entries.length==0){
			// Just return false if we have no intel...
			//return false;
		}

		entries.sort(spyReportsSort); // new to old
		entries.reverse(); // old to new

		for (i=0;i<entries.length ;i++ ){

			summaryReport.report_id=entries[i].report_id;
			summaryReport.mission_id=entries[i].mission_id;
			summaryReport.type=entries[i].type;
			summaryReport.timestamp=entries[i].timestamp;
			summaryReport.user_id=entries[i].user_id;
			summaryReport.user_alliance_id=entries[i].user_alliance_id;

			if (entries[i].planet_id==planet_id){
				summaryReport.planet_id=entries[i].planet_id;
				summaryReport.planet_name=entries[i].planet_name;
				summaryReport.planet_x=entries[i].planet_x;
				summaryReport.planet_y=entries[i].planet_y;
				summaryReport.planet_owner_id=entries[i].planet_owner_id;
				summaryReport.planet_owner_alliance_id=entries[i].planet_owner_alliance_id;
				summaryReport.planet_owner_alliance_name=entries[i].planet_owner_alliance_name;
				summaryReport.score_rank=entries[i].score_rank;

				summaryReport.planet_owner_name=entries[i].planet_owner_name;
				summaryReport.planet_owner_homeworld_name=entries[i].planet_owner_homeworld_name;
				summaryReport.planet_owner_homeworld_x=entries[i].planet_owner_homeworld_x;
				summaryReport.planet_owner_homeworld_y=entries[i].planet_owner_homeworld_y;

				summaryReport.world_type=entries[i].world_type;

				summaryReport.stored_hassium=entries[i].stored_hassium;
				summaryReport.stored_strontium=entries[i].stored_strontium;
				summaryReport.stored_neodymium=entries[i].stored_neodymium;
				summaryReport.stored_indium=entries[i].stored_indium;
				summaryReport.total_output=entries[i].total_output;
				summaryReport.outpost_level=entries[i].outpost_level;

				summaryReport.strength_present=entries[i].strength_present;
				summaryReport.fleets_present=entries[i].fleets_present;

				summaryReport.present_frigates=entries[i].present_frigates;
				summaryReport.present_cruisers=entries[i].present_cruisers;
				summaryReport.present_battleships=entries[i].present_battleships;
				summaryReport.present_carriers=entries[i].present_carriers;
				summaryReport.present_minors=entries[i].present_minors;
				summaryReport.present_cannons=entries[i].present_cannons;
				summaryReport.present_shieldgens=entries[i].present_shieldgens;
				summaryReport.present_artillery=entries[i].present_artillery;
				summaryReport.present_stations=entries[i].present_stations;

				if (entries[i].type=='scout-report' ){
					summaryReport.scoutTimestamp=entries[i].timestamp;
				}

			}
			if (entries[i].planet_owner_id==owner_id){
				summaryReport.score_rank=entries[i].score_rank;
				if (entries[i].type=='espionage-report' || entries[i].type=='infiltration-report'){

					summaryReport.owned_frigates=entries[i].owned_frigates;
					summaryReport.owned_cruisers=entries[i].owned_cruisers;
					summaryReport.owned_battleships=entries[i].owned_battleships;
					summaryReport.owned_carriers=entries[i].owned_carriers;
					summaryReport.owned_minors=entries[i].owned_minors;
					summaryReport.owned_cannons=entries[i].owned_cannons;
					summaryReport.owned_shieldgens=entries[i].owned_shieldgens;
					summaryReport.owned_artillery=entries[i].owned_artillery;
					summaryReport.owned_stations=entries[i].owned_stations;
					summaryReport.owned_artifacts=entries[i].owned_artifacts;
					summaryReport.owned_strength=entries[i].owned_strength;
					summaryReport.owned_fleets=entries[i].owned_fleets;
					summaryReport.player_level=entries[i].player_level;
					summaryReport.outposts=entries[i].outposts;
					summaryReport.last_5_combats=entries[i].last_5_combats;
					summaryReport.scoutTimestamp=entries[i].timestamp;
					summaryReport.espionageTimestamp=entries[i].timestamp;
					summaryReport.tech_tilt=entries[i].tech_tilt;

				}
			}
			if (entries[i].planet_owner_alliance_id==alliance_id){
				if (entries[i].type=='infiltration-report'){
					summaryReport.alliance_bankers=entries[i].alliance_bankers;
					summaryReport.alliance_bank_hassium=entries[i].alliance_bank_hassium;
					summaryReport.alliance_bank_indium=entries[i].alliance_bank_indium;
					summaryReport.alliance_bank_strontium=entries[i].alliance_bank_strontium;
					summaryReport.alliance_bank_neodymium=entries[i].alliance_bank_neodymium;
					summaryReport.scoutTimestamp=entries[i].timestamp;
					summaryReport.espionageTimestamp=entries[i].timestamp;
					summaryReport.infiltrationTimestamp=entries[i].timestamp;
				}
			}
		}
	}



	// We need a special-case to handle our own planets!
	if (owner_id==ad2460.user_id){

		// This is OUR planet, so we should really have all the data ;)
		summaryReport.present_minors=0;
		summaryReport.present_frigates=0;
		summaryReport.present_cruisers=0;
		summaryReport.present_battleships=0;
		summaryReport.present_carriers=0;

		summaryReport.present_cannons=0;
		summaryReport.present_shieldgens=0;
		summaryReport.present_artillery=0;
		summaryReport.present_stations=0;

		summaryReport.strength_present=0;
		summaryReport.fleets_present=0;

		// Outpost or homeworld?
		if (planet_id==ad2460.homeworld.planet_id){
			// Homeworld
			for (i=0;i<ad2460.myFleets.length ;i++ ){
				if (ad2460.myFleets[i].current_x==ad2460.homeworld.x && ad2460.myFleets[i].current_y==ad2460.homeworld.y){
					summaryReport.strength_present+=ad2460.myFleets[i].strength;
					summaryReport.fleets_present++;

					var s=0;
					for (s=0;s<ad2460.myFleets[i].ships.length ;s++ ){

						var ship=returnGameObjectById(ad2460.myFleets[i].ships[s].ship_type_id);

						if (ship.vesseltype=='Normal'){
							if (ship.vesselclass=='Fighter'){
								summaryReport.present_minors++;
							}
							if (ship.vesselclass=='Corvette'){
								summaryReport.present_minors++;
							}
							if (ship.vesselclass=='Frigate'){
								summaryReport.present_frigates++;
							}
							if (ship.vesselclass=='Cruiser'){
								summaryReport.present_cruisers++;
							}
							if (ship.vesselclass=='Battleship'){
								summaryReport.present_battleships++;
							}
							if (ship.vesselclass=='Carrier'){
								summaryReport.present_carriers++;
							}
						}
						if (ship.vesseltype=='Satelite'){
							if (ship.id==501 || ship.id==502 || ship.id==503 ){
								summaryReport.present_cannons++;
							}
							if (ship.id==504 || ship.id==505 || ship.id==506 ){
								summaryReport.present_shieldgens++;
							}
							if (ship.id==507 || ship.id==508 || ship.id==509 ){
								summaryReport.present_artillery++;
							}
							if (ship.id==510 || ship.id==511 || ship.id==512 ){
								summaryReport.present_stations++;
							}
							if (ship.id==513 || ship.id==514 || ship.id==515 ){
								summaryReport.present_stations++;
							}
						}
					}

				}
			}
			summaryReport.stored_hassium=prettyPrint(ad2460.resources.hassium);
			summaryReport.stored_strontium=prettyPrint(ad2460.resources.strontium);
			summaryReport.stored_neodymium=prettyPrint(ad2460.resources.neodymium);
			summaryReport.stored_indium=prettyPrint(ad2460.resources.indium);
			summaryReport.timestamp=ad2460.serverTime;

		}
		else {
			// Outpost
			var outpost=returnOutpostByPlanetId(planet_id);
			//console.log(outpost);
			if (outpost!=false)	{
				for (i=0;i<ad2460.myFleets.length ;i++ ){
					if (ad2460.myFleets[i].current_x==outpost.x && ad2460.myFleets[i].current_y==outpost.y){
							summaryReport.strength_present+=ad2460.myFleets[i].strength;
							summaryReport.fleets_present++;

							var s=0;
							for (s=0;s<ad2460.myFleets[i].ships.length ;s++ ){
								var ship=returnGameObjectById(ad2460.myFleets[i].ships[s].ship_type_id);
								if (ship.vesseltype=='Normal'){
									if (ship.vesselclass=='Fighter'){
										summaryReport.present_minors++;
									}
									if (ship.vesselclass=='Corvette'){
										summaryReport.present_minors++;
									}
									if (ship.vesselclass=='Frigate'){
										summaryReport.present_frigates++;
									}
									if (ship.vesselclass=='Cruiser'){
										summaryReport.present_cruisers++;
									}
									if (ship.vesselclass=='Battleship'){
										summaryReport.present_battleships++;
									}
									if (ship.vesselclass=='Carrier'){
										summaryReport.present_carriers++;
									}
								}
								if (ship.vesseltype=='Satelite'){
									if (ship.ship_type_id==501 || ship.ship_type_id==502 || ship.ship_type_id==503 ){
										summaryReport.present_cannons++;
									}
									if (ship.ship_type_id==504 || ship.ship_type_id==505 || ship.ship_type_id==506 ){
										summaryReport.present_shieldgens++;
									}
									if (ship.ship_type_id==507 || ship.ship_type_id==508 || ship.ship_type_id==509 ){
										summaryReport.present_artillery++;
									}
									if (ship.ship_type_id==510 || ship.ship_type_id==511 || ship.ship_type_id==512 ){
										summaryReport.present_stations++;
									}
									if (ship.ship_type_id==513 || ship.ship_type_id==514 || ship.ship_type_id==515 ){
										summaryReport.present_stations++;
									}
								}
							}
					}
				}
				summaryReport.stored_hassium=prettyPrint(outpost.stored_hassium);
				summaryReport.stored_strontium=prettyPrint(outpost.stored_strontium);
				summaryReport.stored_neodymium=prettyPrint(outpost.stored_neodymium);
				summaryReport.stored_indium=prettyPrint(outpost.stored_indium);
				summaryReport.timestamp=ad2460.serverTime;

				summaryReport.outpost_level=outpost.level;
				summaryReport.total_output=outpost.max_output_hassium+outpost.max_output_indium+outpost.max_output_strontium+outpost.max_output_neodymium;
				summaryReport.resource_tilt=returnResourceTiltString(outpost.world_type);
				// continue here
				var tmp_potential=return_output_potential(outpost.max_output_hassium+outpost.max_output_neodymium+outpost.max_output_strontium+outpost.max_output_indium);
				//summaryReport.output_potential=return_output_potential_string(return_output_potential(outpost.max_output_hassium+outpost.max_output_neodymium+outpost.max_output_strontium+outpost.max_output_indium))+ '('+tmp_potential+'/10)';
				summaryReport.output_potential=tmp_potential;
			}

		}
		// Fill in the outpost-info
		var outpostString="";
		var o=0;
		for (o=0;o<ad2460.outposts.length ;o++ ){
			var thisOutpost=ad2460.outposts[o];
			outpostString=outpostString+(thisOutpost.name+'|'+thisOutpost.level+'|'+thisOutpost.x+'|'+thisOutpost.y+'||');
		}

		summaryReport.outposts=outpostString;

		summaryReport.owned_frigates=0;
		summaryReport.owned_cruisers=0;
		summaryReport.owned_battleships=0;
		summaryReport.owned_carriers=0;
		summaryReport.owned_minors=0;
		summaryReport.owned_cannons=0;
		summaryReport.owned_shieldgens=0;
		summaryReport.owned_artillery=0;
		summaryReport.owned_stations=0;
		summaryReport.owned_artifacts=0;
		summaryReport.player_level=ad2460.scores.level;

		for (i=0;i<ad2460.myFleets.length ;i++ ){
			summaryReport.owned_strength+=ad2460.myFleets[i].strength;
			summaryReport.owned_fleets++;

			var s=0;
			for (s=0;s<ad2460.myFleets[i].ships.length ;s++ ){
				if (ad2460.myFleets[i].ships[s].vesseltype=='Normal'){
					if (ad2460.myFleets[i].ships[s].vesselclass=='Fighter'){
						summaryReport.owned_minors++;
					}
					if (ad2460.myFleets[i].ships[s].vesselclass=='Corvette'){
						summaryReport.owned_minors++;
					}
					if (ad2460.myFleets[i].ships[s].vesselclass=='Frigate'){
						summaryReport.owned_frigates++;
					}
					if (ad2460.myFleets[i].ships[s].vesselclass=='Cruiser'){
						summaryReport.owned_cruisers++;
					}
					if (ad2460.myFleets[i].ships[s].vesselclass=='Battleship'){
						summaryReport.owned_battleships++;
					}
					if (ad2460.myFleets[i].ships[s].vesselclass=='Carrier'){
						summaryReport.owned_carriers++;
					}
				}
				if (ad2460.myFleets[i].ships[s].vesseltype=='Satelite'){
					if (ad2460.myFleets[i].ships[s].ship_type_id==501 || ad2460.myFleets[i].ships[s].ship_type_id==502 || ad2460.myFleets[i].ships[s].ship_type_id==503 ){
						summaryReport.owned_cannons++;
					}
					if (ad2460.myFleets[i].ships[s].ship_type_id==504 || ad2460.myFleets[i].ships[s].ship_type_id==505 || ad2460.myFleets[i].ships[s].ship_type_id==506 ){
						summaryReport.owned_shieldgens++;
					}
					if (ad2460.myFleets[i].ships[s].ship_type_id==507 || ad2460.myFleets[i].ships[s].ship_type_id==508 || ad2460.myFleets[i].ships[s].ship_type_id==509 ){
						summaryReport.owned_artillery++;
					}
					if (ad2460.myFleets[i].ships[s].ship_type_id==510 || ad2460.myFleets[i].ships[s].ship_type_id==511 || ad2460.myFleets[i].ships[s].ship_type_id==512 ){
						summaryReport.owned_stations++;
					}
					if (ad2460.myFleets[i].ships[s].ship_type_id==513 || ad2460.myFleets[i].ships[s].ship_type_id==514 || ad2460.myFleets[i].ships[s].ship_type_id==515 ){
						summaryReport.owned_stations++;
					}
				}
			}


		}

		summaryReport.alliance_bankers="N/A";
	}

	if (alliance_id==ad2460.allianceData.id && ad2460.allianceData.id>0){
			summaryReport.alliance_bankers="";
			var total_percentage=0;
			for (var m=0;m<ad2460.allianceData.memberlist.length ;m++) {
				ad2460.allianceData.memberlist[m].relative_percentage=return_relative_bank_percentage_based_on_rank(ad2460.allianceData.memberlist[m].rank);
				total_percentage+=ad2460.allianceData.memberlist[m].relative_percentage;
			}
			if (total_percentage>0) {
				var factor=100/total_percentage;
				for (var m=0;m<ad2460.allianceData.memberlist.length ;m++) {
					ad2460.allianceData.memberlist[m].absolute_percentage=Math.round(ad2460.allianceData.memberlist[m].relative_percentage*factor);
				}
			}


			var i=0;
			for (i=0;i<5 ;i++ ){
				if (ad2460.allianceData.memberlist.length>i){
					if (ad2460.allianceData.memberlist[i].absolute_percentage>0){
						summaryReport.alliance_bankers+=(ad2460.allianceData.memberlist[i].name+'|'+ad2460.allianceData.memberlist[i].absolute_percentage+' %|'+ad2460.allianceData.memberlist[i].x+'|'+ad2460.allianceData.memberlist[i].y+'||');
					}

				}
			}
	}

	return summaryReport;

}

function populateStarmapChallengeFleetDropdown(){
	removeChildNodes('starmap_challenge_fleet_dropdown');
	var dropdown=document.getElementById('starmap_challenge_fleet_dropdown');
	var o=document.createElement("option");
	o.text='Select Fleet'; o.value='0';
	dropdown.appendChild(o);

	for (var i=0;i<ad2460.myFleets.length ;i++ ){
		var f=ad2460.myFleets[i];
		if (f.status==0 && f.homeworld_fleet==0 && f.storage_fleet==0 && f.commander_id>0 && f.current_x==ad2460.homeworld.x && f.current_y==ad2460.homeworld.y && f.strength>=5000){
			if (f.commander.dead==0){
				// continue here!
				var o=document.createElement("option");
				o.text=f.fleet_name+" ("+prettyPrint(f.strength)+")"; o.value=''+f.fleet_id;
				dropdown.appendChild(o);
			}
		}
	}


}

function starmapWargameChallengeClick(){
	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	var fleet_id=$("#starmap_challenge_fleet_dropdown").val();
	if (planet!==false){
		// we have already populated the fleet-dropdown, so just fire off the request to the server
		$.post('actionhandler.pl', {action:'create_wargame', receiver_id:planet.owner_id, fleet_id:fleet_id}, function(data){ parseInfo(data);});
	}
}

function claimSelectedOutpost(outpost_type){
	var cur_pot=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect).output_potential;
	$.post('actionhandler.pl', {action:'claim_outpost', type:outpost_type, planet_id:ad2460.starmap.currently_selected_planet_id, potential:cur_pot}, function(data){ parseInfo(data);});
}

function claimStation(){
	$.post('actionhandler.pl', {action:'claim_station', planet_id:ad2460.starmap.currently_selected_planet_id}, function(data){ parseInfo(data);});
}


function returnPlanet(planetNum){
	//console.log("Return planet called....");
	var quadrant=ad2460.starmap.quadrantSquare;
	var sector=ad2460.starmap.sectorSquare;
	var cluster=ad2460.starmap.clusterSquare;
	var system=ad2460.starmap.systemSquare;

	var thisSystem=returnSystem(quadrant, sector, cluster, system);
	if (thisSystem){
		for (var p=0;p<thisSystem.planets.length ;p++ ){
			if (thisSystem.planets[p].position==planetNum){
				return thisSystem.planets[p];
			}
		}

		return thisSystem.planets[planetNum];
	}
	else {
		return false;
	}
}

function updateHomeworldOrbit(unit_id,count){
	var i=0;
	var found=false;
	for (i=0;i<ad2460.homeworld.orbit.length ;i++ ){
		if (ad2460.homeworld.orbit[i].id==unit_id){
			ad2460.homeworld.orbit[i].count=count;
			found=true;
			return;

		}
	}

	if (found==false){
		var thisUnit;
		// Lets locate the right production-item based on the id
		var i=0;
		for (i=0;i<ad2460.productionitems.length ;i++ ){
			if (ad2460.productionitems[i].id==unit_id){
				var unit=ad2460.productionitems[i];
				//console.log(unit);
				thisUnit=new ship(unit.id, unit.name, unit.vesselclass , unit.vesseltype, unit.h_cost, unit.i_cost, unit.s_cost, unit.n_cost, unit.time_cost, unit.credit_cost, unit.required_facility_id, unit.required_research_id, unit.required_development_id, unit.required_tech_tree_points, unit.required_points_tree, unit.special_requirement, unit.description, unit.hullstrength, unit.hullshield, unit.shieldtype, unit.shieldstrength, unit.shieldrecharge, unit.primary_weapontype, unit.primary_weaponstrength, unit.primary_weaponspeed, unit.primary_guns, unit.primary_rateoffire, unit.primary_crit_chance, unit.primary_range, unit.secondary_weapontype, unit.secondary_weaponstrength, unit.secondary_weaponspeed, unit.secondary_guns, unit.secondary_rateoffire,	unit.secondary_crit_chance, unit.secondary_range, unit.tertiary_weapontype, unit.tertiary_weaponstrength, unit.tertiary_weaponspeed, unit.tertiary_guns, unit.tertiary_rateoffire,	unit.tertiary_crit_chance, unit.tertiary_range, unit.repair_ability, unit.cargo_capacity, unit.hangar_capacity, unit.jump_range, unit.primary_special_effect_id, unit.secondary_special_effect_id, unit.maneuverability, unit.h_upkeep_cost, unit.i_upkeep_cost, unit.s_upkeep_cost, unit.n_upkeep_cost, unit.volatility);
				thisUnit.count=count;
				//console.log(thisUnit);
				ad2460.homeworld.orbit.push(thisUnit);
				return;
			}
		}
	}
}

function updateSystemProspectText(){
	$("#prospect_cluster_from_system_button_text").html("Prospecting...");
}

function prospectClusterFromSystem(){
	var quadrant=ad2460.starmap.quadrantSquare;
	var sector=ad2460.starmap.sectorSquare;
	var cluster=ad2460.starmap.clusterSquare;

	var pTime=returnProspectingTimeInMinutes(ad2460.homeworld.quadrant,ad2460.homeworld.sector,ad2460.homeworld.cluster,quadrant, sector, cluster);

	var text="Prospecting a cluster will spend 1 prospecting-ship and provide you with information about all planets in an entire cluster (16 solar systems). It will reveal all planets mining-potential, to help you choose the best ones for your mining operations. It will take "+pTime+" minutes to complete.<br>Do you wish to proceed?";

	if (ad2460.scores.level>3 || ad2460.prospectedClusters.length>3){
		prospectClusterFromSystemConfirmed();
		hideHelpCommander();
		return;
	}
	else {
		showConfirmationPopup(text, translations.general_yes, translations.general_no, 'prospectClusterFromSystemConfirmed();hideConfirmationPopup();', 'hideConfirmationPopup()', false, false);
	}

	hideHelpCommander();

}

function prospectClusterFromSystemConfirmed(){
	var quadrant=ad2460.starmap.quadrantSquare;
	var sector=ad2460.starmap.sectorSquare;
	var cluster=ad2460.starmap.clusterSquare;

	$.post('actionhandler.pl', {action:'initiate_cluster_prospecting', quadrant:quadrant, sector:sector, cluster:cluster, fromsystem:1}, function(data){ parseInfo(data); hideHelpCommander(); ladyHelperMain('prospect'); });
}

function prospectCluster(){
	if (ad2460.starmap.clusterView==0){
		systemFeedback('Wrong zoom-level', 'Prospecting must be initiated from the Cluster-view, so you need to zoom in some more!', 1, 3);
		return;
	}
	var quadrant=ad2460.starmap.quadrantSquare;
	var sector=ad2460.starmap.sectorSquare;
	var cluster=ad2460.starmap.clusterSquare;

	$.post('actionhandler.pl', {action:'initiate_cluster_prospecting', quadrant:quadrant, sector:sector, cluster:cluster, fromsystem:0}, function(data){ parseInfo(data);		hideHelpCommander();});
}

function updateProspectingMission(quadrant, sector, cluster, cluster_id, complete_time, start_time){
	var i=0;
	var found=false;
	for (i=0;i<ad2460.prospectingMissions.length ;i++ )	{
		var thisMission=ad2460.prospectingMissions[i];
		if (thisMission.quadrant==quadrant && thisMission.sector==sector && thisMission.cluster==cluster ){
			found=true;
			thisMission.complete_time=complete_time;
		}
	}
	if (found==false){
		ad2460.prospectingMissions.push(new prospectingMission(quadrant, sector, cluster, cluster_id, complete_time, start_time));
	}
}

function checkProspectingMissions(){
	var i=0;
	for (i=0;i<ad2460.prospectingMissions.length ;i++ )	{
		var thisMission=ad2460.prospectingMissions[i];
		if (thisMission.complete_time<ad2460.serverTime+15){
			// Should be done by now!
			reloadProspectingMissions();
			loadSectorContent(thisMission.quadrant, thisMission.sector);
			return;
		}
	}
	renderProspectingMissions();
}

function reloadProspectingMissions(){
	ad2460.prospectingMissions=new Array;
	$.post('actionhandler.pl', {action:'reload_active_prospecting_missions'}, function(data){ parseInfo(data);});

}

function handleIntelTimer(){
	// Here we need to register a timer, somehow, and then tie it to this DOM-node.
	var timerId='currentIntelProgressTimer';
	removeTimer(timerId);
	if (ad2460.intel.missions.length>0){
		ad2460.intel.missions.sort(function(a, b){ return a.next_report_timestamp-b.next_report_timestamp });

		// Lets always display the next intel, who cares about the alliance-upgrade, the HCs will have full control on this anyway
		var m=ad2460.intel.missions[0];
		var name;
		if (m.type=='scout'){
			name='Scouting '+m.planet_name;
		}
		if (m.type=='espionage'){
			name='Espionage at '+m.planet_name;
		}
		if (m.type=='infiltration'){
			name='Infiltrator at '+m.planet_name;
		}
		if (m.type=='infiltrator-sweep'){
			name='Infiltrator-sweep';
		}
		if (m.type=='spy-sweep'){
			name='Spy-sweep';
		}
		registerNewTimer(timerId, ['process_8_eta'], ['process_8_progress'], m.initiate_timestamp, m.next_report_timestamp, function(){loadAllIntel();});
		$('#process_8_name').html(name);
		$('#process_8_progress').show();
		$('#process_8_colour').show();
		$('#process_8').show();
		$('#process_7').hide();
	}
	else {
		//$('#process_8').hide();
		$('#process_8_name').html("No active intel");
		$('#process_8_progress').hide();
		$('#process_8_colour').hide();
		$('#process_8_eta').html("");

	}

}

function handleProspectingTimer(){
	// Here we need to register a timer, somehow, and then tie it to this DOM-node.
	var timerId='currentProspectingProgressTimer';
	removeTimer(timerId);


	if (ad2460.prospectingMissions.length>0){
		ad2460.prospectingMissions.sort(function(a, b){ return a.complete_time-b.complete_time });

		var p=ad2460.prospectingMissions[0];

		var name='Prospecting '+p.quadrant+':'+p.sector+':'+p.cluster;

		// var loadString="loadSectorContent("+p.quadrant+","+p.sector+");";

		registerNewTimer(timerId, ['process_7_eta'], ['process_7_progress'], p.start_time, p.complete_time, function(){reloadProspectingMissions();});

		var t=returnTimerById(timerId);
		if (t){
			t.quadrant=p.quadrant;
			t.sector=p.sector;
		}

		$('#process_7_name').html(name);
		$('#process_7_progress').show();
		$("#process_7_colour").show();
		// Now to decide wether to show it or not...
		// based on possible outpost-upgrades that are running!!!
		var hide_prospecting=false;
		for (var i=0;i<ad2460.intel.missions.length ;i++ ){
			if (ad2460.intel.missions[i].next_report_timestamp<p.complete_time){
				hide_prospecting=true;
			}
		}

		if (hide_prospecting==true){
			$('#process_7').hide();
			$('#process_8').show();
		}
		else{
			$('#process_7').show();
			$('#process_8').hide();
		}
	}
	else {
		// No prospecting-missions
		$("#process_7_progress").css("width","0%");
		$("#process_7_name").html("No active prospecting");
		$("#process_7_eta").html("");

		$("#process_7_colour").hide();
		$('#process_7').hide();
		$('#process_8').show();

	}


	if (ad2460.missionVars.active_mission_id>0){
		$('#process_7').hide();
	}
}

function updateProspectedClusters(quadrant, sector, cluster,complete_time){
	// loop through, check match, if not add to ad2460.prospectedClusters
	var i=0;
	var found=false;
	for (i=0;i<ad2460.prospectedClusters.length ;i++ ){
		if (ad2460.prospectedClusters[i].quadrant==quadrant && ad2460.prospectedClusters[i].sector==sector && ad2460.prospectedClusters[i].cluster==cluster){
			found=true;
		}
	}
	if (found==false){
		ad2460.prospectedClusters.push(new prospectedCluster(quadrant, sector, cluster,complete_time));
	}
}

function wipeProspectingData(){
	ad2460.prospectingMissions=new Array;
	ad2460.prospectedClusters=new Array;
}

function renderProspectingMissions(){
	// ad2460.prospectingMissions
	//ad2460.prospectedClusters

	// for later
	// .setAttribute("onclick","instantCompleteProspecting("+ad2460.prospectingMissions[tempCounter].cluster_id+")");
	// showConfirmationPopup("Are you sure you wish to spend 1 credit to complete this prospecting-mission instantly?", "Yes", "No", "instantCompleteProspecting("+p.cluster_id+")");

	removeChildNodes('current_prospecting_missions_container');
	removeChildNodes('completed_prospecting_missions_container');
	var i=0;
	var parent=document.getElementById('current_prospecting_missions_container');
	ad2460.prospectingMissions.sort(function(a, b){ return a.complete_time-b.complete_time });
	for (i=0;i<ad2460.prospectingMissions.length ;i++ )	{
		if (i<5){
			var p=ad2460.prospectingMissions[i];
			var outerdiv=createSingleElement('div', 'eta_prospecting', '', '', '');
			var div1=createSingleElement('div', 'prospect_link', '', '['+p.quadrant+':'+p.sector+':'+p.cluster+']', 'zoomInTo('+p.quadrant+','+p.sector+','+p.cluster+')');
			var span1=createSingleElement('div', '', '', 'Prospecting ', '');

			var onclickString='showConfirmationPopup("Are you sure you wish to spend 1 credit to complete this prospecting-mission instantly?", "Yes", "No", "instantCompleteProspecting('+p.cluster_id+');hideConfirmationPopup();")';
			//console.log(onclickString);
			var div2=createSingleElement('div', 'prospect_credit_use', '', '', '');
			//var div2=createSingleElement('div', '', '', '', '');
			var eta=createSingleElement('div', 'eta_timer', '', secondsToFullTimeNosecs(p.complete_time-ad2460.serverTime), '');
			outerdiv.appendChild(div1);
			outerdiv.appendChild(div2);
			outerdiv.appendChild(eta);
			parent.appendChild(outerdiv);
		}
	}

	var parent=document.getElementById('completed_prospecting_missions_container');
	ad2460.prospectedClusters.sort(function(a, b){ return b.complete_time-a.complete_time });
	for (i=0;i<ad2460.prospectedClusters.length ;i++ )	{
		if (i<5){
			var p=ad2460.prospectedClusters[i];
			var outerdiv=createSingleElement('div', 'eta_prospecting', '', '', '');
			var div1=createSingleElement('div', 'prospect_link', '', '['+p.quadrant+':'+p.sector+':'+p.cluster+']', 'zoomInTo('+p.quadrant+','+p.sector+','+p.cluster+')');
			//var eta=createSingleElement('div', 'eta_timer', '', formatShortDate(p.complete_time), '');
			var eta=createSingleElement('div', 'eta_timer pointer', '', 'Show Report', 'fetchProspectingReport('+p.quadrant+','+p.sector+','+p.cluster+')');

			outerdiv.appendChild(div1);
			outerdiv.appendChild(eta);
			parent.appendChild(outerdiv);
		}
	}

}

function fetchProspectingReport(q,s,c){
	if (ad2460.starmap.clusterView==0 && ad2460.starmap.sectorView==0){
		return;
	}

	if (ad2460.starmap.sectorView==1){
		// fetch compiled report for the sector
		$.post('actionhandler.pl', {action:'fetch_compiled_prospecting_report', quadrant:q, sector:s}, function(data){ parseInfo(data);});
	}
	else {
		$.post('actionhandler.pl', {action:'fetch_prospecting_report', quadrant:q, sector:s, cluster:c}, function(data){ parseInfo(data);});
	}


}

function clearProspectReport(){
	ad2460.prospectReport=new Array;
}

function fetchAlternateProspectingReport(){
	// Check the ad2460.prospectData={quadrant:$quadrant, sector:$sector, cluster:0, available_only:$available_only}

	var q=ad2460.prospectData.quadrant;
	var s=ad2460.prospectData.sector;
	var c=ad2460.prospectData.cluster;
	var available_only=1-ad2460.prospectData.available_only;

	if (c>0){
		$.post('actionhandler.pl', {action:'fetch_prospecting_report', quadrant:q, sector:s, cluster:c, available_only:available_only}, function(data){ parseInfo(data);});
	}
	else {
		$.post('actionhandler.pl', {action:'fetch_compiled_prospecting_report', quadrant:q, sector:s, available_only:available_only}, function(data){ parseInfo(data);});
	}


}

function renderProspectReport(){
	showSimpleBox("Prospecting-report","");
	var container=document.getElementById("simple_main_text");

	if (ad2460.prospectReport.length==0){
		$("#simple_main_text").html("No report found.");
		return;
	}

	// I'm thinking Name Tilt Potential Owner

	var i=0;

	var availableOnlyButton=createSingleElement('div', 'lightbutton320 blue', 'prospeting_available_button', '', 'fetchAlternateProspectingReport()');

	if (ad2460.prospectData.available_only==1){
		availableOnlyButton.innerHTML='Include occupied outposts';
	}
	else {
		availableOnlyButton.innerHTML='Show only available outposts';
	}

	container.appendChild(availableOnlyButton);

	var headerContainer=createSingleElement('div', 'prosp_rep_container', '', '', '');
	var h1=createSingleElement('div', 'prosp_rep_col_1', '', 'Name', '');
	var h2=createSingleElement('div', 'prosp_rep_col_2', '', 'Type', '');
	var h3=createSingleElement('div', 'prosp_rep_col_3', '', 'Pot.', '');
	var h3b=createSingleElement('div', 'prosp_rep_col_3', '', 'Out.', '');
	var h4=createSingleElement('div', 'prosp_rep_col_4', '', 'Owner', '');
	var h5=createSingleElement('div', 'prosp_rep_col_2', '', 'TT', '');

	h1.style.cursor='default';
	h1.style.color='white';


	h3.style.width='50px';
	h3b.style.width='60px';

	headerContainer.appendChild(h1);
	headerContainer.appendChild(h2);
	headerContainer.appendChild(h3);
	headerContainer.appendChild(h3b);
	headerContainer.appendChild(h4);
	headerContainer.appendChild(h5);

	container.appendChild(headerContainer);

	for (i=0;i<ad2460.prospectReport.length ;i++ ){

		var total_output=parseInt(ad2460.prospectReport[i].hassium_max_output) + parseInt(ad2460.prospectReport[i].neodymium_max_output) + parseInt(ad2460.prospectReport[i].strontium_max_output) + parseInt(ad2460.prospectReport[i].indium_max_output);

		var outer=createSingleElement('div', 'prosp_rep_container', '', '', '');
		var col1=createSingleElement('div', 'prosp_rep_col_1', '', ad2460.prospectReport[i].name, 'zoomInToXY('+ad2460.prospectReport[i].x+','+ad2460.prospectReport[i].y+')');
		var col2=createSingleElement('div', 'prosp_rep_col_2', '', returnResourceTiltString(ad2460.prospectReport[i].world_type), '');
		var potential=return_output_potential(parseInt(ad2460.prospectReport[i].hassium_max_output) + parseInt(ad2460.prospectReport[i].neodymium_max_output) + parseInt(ad2460.prospectReport[i].strontium_max_output) + parseInt(ad2460.prospectReport[i].indium_max_output));
		var potential_string=potential+'/10';
		//console.log(potential);
		var col3=createSingleElement('div', 'prosp_rep_col_3', '', potential_string, '');
		var col3b=createSingleElement('div', 'prosp_rep_col_2', '', ''+Math.round(total_output/1000)+' K', '');
		col3.style.width='50px';
		col3b.style.width='60px';

		var col4;


		var ownerName='--';
		var className='prosp_rep_col_4';

		if (ad2460.prospectReport[i].owner_id>0 && ad2460.prospectReport[i].world_type<60){
			ownerName=ad2460.prospectReport[i].nickname;
			className='prosp_rep_col_4_owned';
			col4=createSingleElement('div', className, '', ownerName, 'loadPlayerInfo('+ad2460.prospectReport[i].owner_id+')');
		}
		else if (ad2460.prospectReport[i].owner_id>0 && ad2460.prospectReport[i].world_type==60){
			ownerName=ad2460.prospectReport[i].nickname;
			className='prosp_rep_col_4_owned';
			col4=createSingleElement('div', className, '', ownerName, 'loadAllianceInfo('+ad2460.prospectReport[i].owner_id+')');
		}
		else if (ad2460.prospectReport[i].owner_id>0 && ad2460.prospectReport[i].world_type==70){
			ownerName=ad2460.prospectReport[i].nickname;
			className='prosp_rep_col_4_owned';
			col4=createSingleElement('div', className, '', ownerName, 'loadAllianceInfo('+ad2460.prospectReport[i].owner_id+')');
		}
		else {
			col4=createSingleElement('div', className, '', ownerName, '');
		}



		col4.style.width='110px';

		var estimated_travel_time=calcEta(ad2460.prospectReport[i].x, ad2460.prospectReport[i].y, ad2460.homeworld.x, ad2460.homeworld.y, 1, false, false);
		var estimated_travel_time_string=secondsToFullTimeNosecs(estimated_travel_time);

		var col5=createSingleElement('div', 'prosp_rep_col_2', '', estimated_travel_time_string, '');

		if (ad2460.prospectReport[i].world_type==60){
			col1.className='prosp_rep_col_1 station';
			col2.innerHTML='Station';
			col3.innerHTML=' ';
			col3b.innerHTML=' ';
			col4.className=className+' station';
		}

		if (ad2460.prospectReport[i].world_type==70){
			col1.className='prosp_rep_col_1 bank';
			col2.innerHTML='Bank';
			col3.innerHTML=' ';
			col3b.innerHTML=' ';
			col4.className=className+' bank';
		}


		outer.appendChild(col1);
		outer.appendChild(col2);
		outer.appendChild(col3);
		outer.appendChild(col3b);
		outer.appendChild(col4);
		outer.appendChild(col5);

		container.appendChild(outer);
	}
}

function getAllianceData(alliance_id){
	console.log("getAllianceData called, using the cache!");
	// First we see if we have it cached and updated the last 15 minutes.
	var i=0;
	for (i=0;i<ad2460.allianceCache.length ;i++ ){
		if (ad2460.allianceCache[i].alliance_id==alliance_id){
			if (ad2460.allianceCache[i].fetch_time>(ad2460.serverTime-(60*15)))	{
				return;
			}
		}
	}
	$.post('actionhandler.pl', {action:'fetch_public_alliance_data', alliance_id:alliance_id}, function(data){ parseInfo(data);});
}

function updateAllianceCacheEntry(alliance_id, name, logo_url, alliance_information, score, strength, xp, score_rank, strength_rank, xp_rank, fetch_time ){
	var i=0;
	for (i=0;i<ad2460.allianceCache.length ;i++ ){
		if (ad2460.allianceCache[i].alliance_id==alliance_id){
			var thisAlliance=ad2460.allianceCache[i];
			thisAlliance.name=name;
			thisAlliance.logo_url=logo_url;
			thisAlliance.alliance_information=alliance_information;
			thisAlliance.score=score;
			thisAlliance.strength=strength;
			thisAlliance.xp=xp;
			thisAlliance.score_rank=score_rank;
			thisAlliance.strength_rank=strength_rank;
			thisAlliance.xp_rank=xp_rank;
			thisAlliance.fetch_time=fetch_time;
			return;
		}
	}
	// If we got here without returning, we have a new entry
	ad2460.allianceCache.push(new AllianceCacheEntry(alliance_id, name, logo_url, alliance_information, score, strength, xp, score_rank, strength_rank, xp_rank, fetch_time ));
}

function updatePublicAllianceMember(user_id, alliance_id, name, level, tag_string, score, strength, xp, score_rank, strength_rank, xp_rank, homeworld_name, homeworld_id, x, y){
	var foundAlliance=false;
	var foundMember=false;
	var a=0;
	var m=0;

	for (a=0;a<ad2460.allianceCache.length ;a++ ){
		if (ad2460.allianceCache[a].alliance_id==alliance_id){
			foundAlliance=true;
			var thisAlliance=ad2460.allianceCache[a];
			var members=thisAlliance.members;
			for (m=0;m<members.length ;m++ ){
				if (members[m].user_id==user_id){
					foundMember=true;
					var thisMember=members[m];
					thisMember.name=name;
					thisMember.level=level;
					thisMember.tag_string=tag_string;
					thisMember.score=score;
					thisMember.strength=strength;
					thisMember.xp=xp;
					thisMember.score_rank=score_rank;
					thisMember.strength_rank=strength_rank;
					thisMember.xp_rank=xp_rank;
					thisMember.homeworld_name=homeworld_name;
					thisMember.homeworld_id=homeworld_id;
					thisMember.x=x;
					thisMember.y=y;
					var thisLocation=convertShortCoordsToLongCoords(x,y);
					thisMember.quadrant=thisLocation.q;
					thisMember.sector=thisLocation.s;
					thisMember.cluster=thisLocation.g;
					thisMember.system=thisLocation.o;
					thisMember.position=thisLocation.p;
					return;
				}
			}
			// If we got here, we found the right alliance, but not the member...
			thisAlliance.members.push(new PublicAllianceMember(user_id, alliance_id, name, level, tag_string, score, strength, xp, score_rank, strength_rank, xp_rank, homeworld_name, homeworld_id, x, y));
			return;
		}
	}
}

function refreshAllianceFleetsClick(){

	$.post('actionhandler.pl', {action:'reload_alliance_data'}, function(data){
		parseInfo(data);
		ad2460.launchVars.selectedFleets=new Array;
		renderLaunchFleets();
	});

}

function renderLaunchFleets(){
	removeChildNodes('launch_fleet_select_scroller');
	var lineClass=["evenline","oddline"];
	var parent=document.getElementById('launch_fleet_select_scroller');
	var drawCounter=0;

	$("#launch_button_text").removeClass("notenough");

	var myStrength=0;
	var aStrength=0;

	for (var a=0;a<ad2460.launchVars.selectedFleets.length ;a++ ){
		var f=ad2460.launchVars.selectedFleets[a];
		if (f.owner_id==ad2460.user_id){
			myStrength+=f.strength;
		}
		else {
			aStrength+=f.strength;
		}
	}

	// fleets must be at home, with 0 as status
	// otherwise they must be alliance-fleets I am allowed to use!
	// must have been 10 minutes since it used its jumpengines too
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var thisFleet=ad2460.myFleets[i];

		// Don't show the storage-fleet
		if (thisFleet.storage_fleet==0 && thisFleet.homeworld_fleet==0 && thisFleet.commander_id>0 && thisFleet.status==0 && thisFleet.shipcount>0 && thisFleet.current_x==ad2460.homeworld.x && thisFleet.current_y==ad2460.homeworld.y && thisFleet.last_hyperspace_jump_time<(ad2460.serverTime-600)){
			// We want this one to be displayed
			if (thisFleet.commander.dead>0)	{
				continue;
			}

			var lineClassName=lineClass[drawCounter % 2];

			var selected=false;
			for (x=0;x<ad2460.launchVars.selectedFleets.length ;x++ ){
				if (ad2460.launchVars.selectedFleets[x].fleet_id==thisFleet.fleet_id){
					selected=true;
				}
			}
			if (selected==true){
				lineClassName+='_selected';
			}

			var imgObject=returnFleetTitleAndImage(thisFleet);

			var entry=createSingleElement('div', 'tableselection '+lineClassName, '', '', 'launchFleetClick('+thisFleet.fleet_id+')');
			var entryName=createSingleElement('div', 'table_fleet_name launch', '', thisFleet.fleet_name, '');
			entry.appendChild(entryName);
			var entryOwner=createSingleElement('div', 'table_fleet_owner', '', ad2460.nickname, '');
			entry.appendChild(entryOwner);

			var entryType=createSingleElement('div', 'table_fleet_type launch ', '', '', '');
			var entryTypeImage=createSingleElement('img', ' ', '', imgObject.imgsrc, '');
			entryType.setAttribute("title",imgObject.title);
			entryType.appendChild(entryTypeImage);
			entry.appendChild(entryType);

			var minors=0;
			var transports=0;
			for (var t=0;t<thisFleet.ships.length ;t++ ){
				if (thisFleet.ships[t].ship_type_id>400 && thisFleet.ships[t].ship_type_id<411){
					minors++;
				}
				if (thisFleet.ships[t].ship_type_id>=435 && thisFleet.ships[t].ship_type_id<=436){
					transports++;
				}
			}

			var entrySize=createSingleElement('div', 'table_fleet_size launch', '', prettyPrint(thisFleet.shipcount), '');
			var entryMinors=createSingleElement('div', 'table_fleet_size launch', '', prettyPrint(minors), '');
			var entryTransports=createSingleElement('div', 'table_fleet_size launch', '', prettyPrint(transports), '');
			var entryStrength=createSingleElement('div', 'table_fleet_strength', '', prettyPrint(thisFleet.strength), '');
			var entryInfo=createSingleElement('img', 'table_fleet_info launch_fleet_table', '', 'images/icons/info_white.png', 'showFleetDetails('+thisFleet.fleet_id+',event)');

			entry.appendChild(entrySize);
			entry.appendChild(entryMinors);
			entry.appendChild(entryTransports);
			entry.appendChild(entryStrength);
			entry.appendChild(entryInfo);

			parent.appendChild(entry);

			drawCounter++;



		}
	}

	// Adding alliance-fleets.

	var red_launch_text=false;
	// But only if I have access!!
	if (ad2460.allianceData.rank_id<=ad2460.allianceData.alliance_fleet_max_rank && ad2460.scores.level>=12){
		var m=0;
		for (m=0;m<ad2460.allianceData.memberlist.length ;m++ ){
			if (ad2460.allianceData.memberlist[m].user_id!=ad2460.user_id){
				for (i=0;i<ad2460.allianceData.memberlist[m].allianceFleets.length ;i++ ){
					var thisFleet=ad2460.allianceData.memberlist[m].allianceFleets[i];
					if (thisFleet.commander.dead>0)	{
						continue;
					}
					// Don't show the storage-fleet
					if (thisFleet.storage_fleet==0 && thisFleet.homeworld_fleet==0 && thisFleet.status==0 && thisFleet.alliance_fleet==1){
						// We want this one to be displayed
						var lineClassName=lineClass[drawCounter % 2];

						var selected=false;
						for (x=0;x<ad2460.launchVars.selectedFleets.length ;x++ ){
							if (ad2460.launchVars.selectedFleets[x].fleet_id==thisFleet.fleet_id){
								selected=true;
							}
						}
						if (selected==true){
							lineClassName+='_selected';
						}

						var imgObject=returnFleetTitleAndImage(thisFleet);

						var minors=0;
						var transports=0;
						for (var t=0;t<thisFleet.ships.length ;t++ ){
							if (thisFleet.ships[t].ship_type_id>400 && thisFleet.ships[t].ship_type_id<411){
								minors++;
							}
							if (thisFleet.ships[t].ship_type_id>=435 && thisFleet.ships[t].ship_type_id<=436){
								transports++;
							}
						}

						var entry=createSingleElement('div', 'tableselection '+lineClassName, '', '', 'launchFleetClick('+thisFleet.fleet_id+')');
						var entryName=createSingleElement('div', 'table_fleet_name launch', '', thisFleet.fleet_name, '');
						entry.appendChild(entryName);

						var entryOwner=createSingleElement('div', 'table_fleet_owner', '', ad2460.allianceData.memberlist[m].name, '');
						entry.appendChild(entryOwner);

						var entryType=createSingleElement('div', 'table_fleet_type launch ', '', '', '');
						var entryTypeImage=createSingleElement('img', ' ', '', imgObject.imgsrc, '');
						entryType.setAttribute("title",imgObject.title);
						entryType.appendChild(entryTypeImage);
						entry.appendChild(entryType);
						var addedClass='';
						if (selected==true){
							if (aStrength > myStrength*3  ){
								addedClass='notenough';
								$("#launch_button_text").addClass("notenough");
								red_launch_text=true;

							}
						}
						else if (aStrength+thisFleet.strength>myStrength*3){
							addedClass='notenough';
						}
						if (ad2460.launchVars.planet.world_type==60 && myStrength>=5000){
							addedClass='';
							red_launch_text=false;
						}
						if (ad2460.launchVars.planet.world_type==70 && myStrength>=5000){
							addedClass='';
							red_launch_text=false;
						}

						var entrySize=createSingleElement('div', 'table_fleet_size launch', '', thisFleet.shipcount, '');
						var entryMinors=createSingleElement('div', 'table_fleet_size launch', '', prettyPrint(minors), '');
						var entryTransports=createSingleElement('div', 'table_fleet_size launch', '', prettyPrint(transports), '');
						var entryStrength=createSingleElement('div', 'table_fleet_strength '+addedClass, '', prettyPrint(thisFleet.strength), '');
						var entryInfo=createSingleElement('img', 'table_fleet_info launch_fleet_table', '', 'images/icons/info_white.png', 'showFleetDetails('+thisFleet.fleet_id+',event)');

						entry.appendChild(entrySize);
						entry.appendChild(entryMinors);
						entry.appendChild(entryTransports);
						entry.appendChild(entryStrength);
						entry.appendChild(entryInfo);

						parent.appendChild(entry);
						drawCounter++;
					}
				}
			}
		}
	}
	updateContingentDetails('',red_launch_text);
}

function showFleetDetails(fleet_id, event){
	var fleet=returnFleetById(fleet_id);
	if (event.stopPropagation){
		event.stopPropagation();
	}
	else if(window.event){
		window.event.cancelBubble=true;
	}

	if (fleet!=false){
		shipListUpLaunchfleet(fleet);
	}

}

function launchFleetClick(fleet_id){
	// Add or remove from
	// ad2460.launchVars.selectedFleets.push(thisFleet);

	// Now then, to only support adding fleets that are 20% or less than your own contributed strength!
	var myStrength=0;
	var aStrength=0;

	for (var a=0;a<ad2460.launchVars.selectedFleets.length ;a++ ){
		var f=ad2460.launchVars.selectedFleets[a];
		if (f.owner_id==ad2460.user_id){
			myStrength+=f.strength;
		}
		else {
			aStrength+=f.strength;
		}
	}


	var i = ad2460.launchVars.selectedFleets.length;
	var found=false;
	while(i--) {
		if (ad2460.launchVars.selectedFleets[i].fleet_id==fleet_id){
			found=true;
			ad2460.launchVars.selectedFleets.splice(i,1); // remove it
		}
	}
	if (found==false){
		// add it!
		var thisFleet=returnFleetById(fleet_id);
		if (thisFleet.owner_id!=ad2460.user_id){
			//if (thisFleet.strength>myStrength*20/100){
				//systemFeedback('Fleet-strength too high', 'You can only add alliance-fleets that have less than 20% of your own contributed strength.', 1, 5);
			//}
			//else {

			//}
			ad2460.launchVars.selectedFleets.push(thisFleet);

		}
		else {
			ad2460.launchVars.selectedFleets.push(thisFleet);
		}

	}

	renderLaunchFleets();
	if (ad2460.launchVars.currentShipView=='all'){
		shipListUpLaunchcontingent();
	}

}

function updateContingentDetails(first,red_launch_text){
	var matterCount=0;
	var energyCount=0;
	var displacementCount=0;
	var fleetCounter=0;
	var totalStrength=0;
	var totalShipCount=0;
	var totalCargoCapacity=0;
	var commanderInChief=false;

	var i = ad2460.launchVars.selectedFleets.length;

	$("#launch_no_loot_warning").hide();
	$("#launch_op_min_max_box").hide();
	// ad2460.launchVars.planet.world_type

	var cargoBonusPercent=returnCargoCapacityBonusPercent();

	var orgCmd=ad2460.launchVars.commander;

	while(i--) {
		fleetCounter++;
		totalStrength+=ad2460.launchVars.selectedFleets[i].strength;
		totalShipCount+=ad2460.launchVars.selectedFleets[i].shipcount;

		var thisFleetTechNums=returnTechTilt(ad2460.launchVars.selectedFleets[i],true);

		matterCount+=thisFleetTechNums.matterCount;
		energyCount+=thisFleetTechNums.energyCount;
		displacementCount+=thisFleetTechNums.displacementCount;
		var x=0;
		for (x=0;x<ad2460.launchVars.selectedFleets[i].ships.length ;x++ ){
			var thisCapacity=returnCargoCapacity(ad2460.launchVars.selectedFleets[i].ships[x].ship_type_id);
			thisCapacity+=Math.floor(thisCapacity*cargoBonusPercent/100);
			totalCargoCapacity+=thisCapacity;
		}

		if (commanderInChief==false || ad2460.launchVars.selectedFleets[i].commander.experience>commanderInChief.experience){
			// Commanders of alliance-fleets always take the back seat...
			if (ad2460.launchVars.selectedFleets[i].commander.owner_id==ad2460.user_id){
				commanderInChief=ad2460.launchVars.selectedFleets[i].commander;
				ad2460.launchVars.commander=commanderInChief;
			}
		}
	}

	var newCmd=ad2460.launchVars.commander;
	if (newCmd!=orgCmd){
		// $(".tactical_list.selected").fadeOut(200).fadeIn(200);
	}

	var techtilt='Neutral';
	if (matterCount>energyCount && matterCount>displacementCount){
		techtilt=fullTechType('Matter');
	}
	else if (energyCount>matterCount && energyCount>displacementCount){
		techtilt=fullTechType('Energy');
	}
	else if (displacementCount>energyCount && displacementCount>matterCount){
		techtilt=fullTechType('Displacement');
	}
	else {
		techtilt='Neutral';
	}

	// Ok, that should be pretty much it...
	// We can now update the GUI with our fresh variables
	document.getElementById('lf_ov_fleets_selected').innerHTML=''+fleetCounter;
	document.getElementById('lf_ov_strength').innerHTML=''+prettyPrint(totalStrength);
	if (ad2460.launchVars.planet.world_type>=11){
		// OP-attack
		var canAlwaysHitWith=Math.ceil(outpostPotentialToMaxDefStrength(ad2460.launchVars.planet.output_potential)/5/10*ad2460.launchVars.planet.outpost_level);

		if (totalStrength>ad2460.launchVars.planet.strength*1.0 && totalStrength>canAlwaysHitWith){
			$("#lf_ov_strength").addClass("notenough");
			$("#launch_button_text").addClass("notenough");
		}
		else if (totalStrength<ad2460.launchVars.planet.strength/2){
			$("#lf_ov_strength").addClass("notenough");
			$("#launch_button_text").addClass("notenough");
		}
		else {
			$("#lf_ov_strength").removeClass("notenough");
			$("#launch_button_text").removeClass("notenough");
		}
		if (ad2460.launchVars.planet.world_type>10 && ad2460.launchVars.planet.world_type<60)	{
			var minStr=Math.ceil(ad2460.launchVars.planet.strength/2);
			var maxStr=Math.ceil(ad2460.launchVars.planet.strength);
			if (canAlwaysHitWith>maxStr){
				maxStr=canAlwaysHitWith;
			}

			$("#min_op_launch_strength").html(prettyPrint(minStr));
			$("#max_op_launch_strength").html(prettyPrint(maxStr));

			$("#launch_op_min_max_box").show();

		}
		else if (ad2460.launchVars.planet.world_type==60)	{
			canAlwaysHitWith=200000;
			var minStr=Math.ceil(ad2460.launchVars.planet.strength/2);
			var maxStr=Math.ceil(ad2460.launchVars.planet.strength);
			if (canAlwaysHitWith>maxStr){
				maxStr=canAlwaysHitWith;
			}

			$("#min_op_launch_strength").html(prettyPrint(minStr));
			$("#max_op_launch_strength").html(prettyPrint(maxStr));

			$("#launch_op_min_max_box").show();
		}
		else if (ad2460.launchVars.planet.world_type==70)	{
			canAlwaysHitWith=100000;
			var minStr=Math.ceil(ad2460.launchVars.planet.strength/2);
			var maxStr=Math.ceil(ad2460.launchVars.planet.strength);
			if (canAlwaysHitWith>maxStr){
				maxStr=canAlwaysHitWith;
			}

			$("#min_op_launch_strength").html(prettyPrint(minStr));
			$("#max_op_launch_strength").html(prettyPrint(maxStr));

			$("#launch_op_min_max_box").show();
		}

		else {
			$("#launch_op_min_max_box").hide();
		}
	}
	if (ad2460.launchVars.planet.world_type<11){
		$("#lf_ov_strength").removeClass("notenough");
		$("#launch_button_text").removeClass("notenough");

		//console.log(ad2460.launchVars.planet);
		var minStr=0;
		var maxStr=ad2460.launchVars.planet.strength;
		if (ad2460.launchVars.planet.strength<ad2460.launchVars.planet.player_level*1000){
			maxStr=ad2460.launchVars.planet.player_level*1000;
		}

		minStr=Math.ceil(maxStr/5);

		$("#min_op_launch_strength").html(prettyPrint(minStr));
		$("#max_op_launch_strength").html(prettyPrint(maxStr));

		$("#launch_op_min_max_box").show();


		if (totalStrength>ad2460.launchVars.planet.strength && totalStrength>ad2460.launchVars.planet.player_level*1000){
			$("#lf_ov_strength").addClass("notenough");
			$("#launch_button_text").addClass("notenough");
		}
		if (totalStrength<minStr){
			$("#lf_ov_strength").addClass("notenough");
			$("#launch_button_text").addClass("notenough");
		}
	}

	if (ad2460.launchVars.planet.world_type==60){
		$("#lf_ov_strength").removeClass("notenough");
		$("#launch_button_text").removeClass("notenough");
	}
	if (ad2460.launchVars.planet.world_type==70){
		// BANK-attack
		if (totalStrength>ad2460.launchVars.planet.strength && totalStrength>100000){
			$("#lf_ov_strength").addClass("notenough");
			$("#launch_button_text").addClass("notenough");

		}
		// Banks must be hit with at least 30% of its strength
		else if (totalStrength<ad2460.launchVars.planet.strength*30/100){
			$("#lf_ov_strength").addClass("notenough");
			$("#launch_button_text").addClass("notenough");
		}
		else {
			$("#lf_ov_strength").removeClass("notenough");
			$("#launch_button_text").removeClass("notenough");
		}
	}


	document.getElementById('lf_ov_ships').innerHTML=''+totalShipCount;
	document.getElementById('lf_ov_cargo_space').innerHTML=''+prettyPrint(totalCargoCapacity);
	document.getElementById('lf_ov_tech_tilt').innerHTML=techtilt;

	if (commanderInChief!=false){
		document.getElementById('lf_cmd_name').innerHTML=commanderInChief.name;
		document.getElementById('lf_cmd_rank').innerHTML=commanderInChief.rank;
		document.getElementById('lf_cmd_commanding').innerHTML=commanderInChief.commanding;
		document.getElementById('lf_cmd_perception').innerHTML=commanderInChief.perception;
		document.getElementById('lf_cmd_tactics').innerHTML=commanderInChief.tactics;
		document.getElementById('lf_cmd_morale').innerHTML=commanderInChief.morale;
		document.getElementById('lf_cmd_fleet_limit').innerHTML=ad2460.commander_max_fleets[commanderInChief.rank];
	}
	else {
		document.getElementById('lf_cmd_name').innerHTML='-';
		document.getElementById('lf_cmd_rank').innerHTML='-';
		document.getElementById('lf_cmd_commanding').innerHTML='-';
		document.getElementById('lf_cmd_perception').innerHTML='-';
		document.getElementById('lf_cmd_tactics').innerHTML='-';
		document.getElementById('lf_cmd_morale').innerHTML='-';
		document.getElementById('lf_cmd_fleet_limit').innerHTML='-';
	}
	// update launch_fleet_xp_info with the right data
	var xp_multiplier=returnXPmultiplier(totalStrength,ad2460.launchVars.planet.strength,ad2460.launchVars.planet.world_type);


	//console.log(ad2460.launchVars.planet);
	//console.log(ad2460.launchVars.planet.world_type, totalStrength, ad2460.launchVars.planet.strength, totalStrength, ad2460.launchVars.planet.player_level*1000);
	if (ad2460.launchVars.planet.world_type<11 && totalStrength>ad2460.launchVars.planet.strength && totalStrength>ad2460.launchVars.planet.player_level*1000){
		$("#launch_fleet_xp_info").html("N/A");
		$("#launch_fleet_xp_info").css("color","red");
		red_launch_text=true;

	}
	else if (ad2460.launchVars.planet.world_type<=10 && xp_multiplier<1){
		$("#launch_fleet_xp_info").html("N/A");
		$("#launch_fleet_xp_info").html(""+xp_multiplier);
		$("#launch_fleet_xp_info").css("color","yellow");
		red_launch_text=false;

	}
	else if (xp_multiplier>0){
		$("#launch_fleet_xp_info").html("XP Multiplier: "+xp_multiplier);
		$("#launch_fleet_xp_info").css("color","lightgreen");
	}
	else if (xp_multiplier==0){
		$("#launch_fleet_xp_info").html("0 XP");
		$("#launch_fleet_xp_info").css("color","yellow");

	}
	else {

		// This should not be triggered anymore afaik, so it can be left as it is.
		if (ad2460.launchVars.planet.world_type<10){
			var lossPercent=Math.abs(xp_multiplier);
			var actual_xp_cost=Math.floor(ad2460.scores.xp*lossPercent/100);
			$("#launch_fleet_xp_info").html("Launching will COST you "+prettyPrint(actual_xp_cost)+" XP!");
			$("#launch_fleet_xp_info").css("color","red");
			$("#launch_no_loot_warning").show();
		}
		else {
			$("#launch_fleet_xp_info").html("0 XP");
			$("#launch_fleet_xp_info").css("color","yellow");
			$("#launch_no_loot_warning").show();
		}


	}

	if (first=='first'){
		if ( ad2460.playerXpLevels[ad2460.scores.level-1] > (ad2460.scores.xp-actual_xp_cost) )	{
			//showOkPopup("Launching now will make you LOSE a level! Are you absolutely sure you wish to launch?", "I understand", "");
			showOkPopup("You may not launch an attack that costs you a level!", "I understand", "");
			red_launch_text=true;

		}
	}

	if (ad2460.launchVars.commander.hasOwnProperty('rank')){
		if (ad2460.commander_max_fleets[ad2460.launchVars.commander.rank]<ad2460.launchVars.selectedFleets.length){
			$("#lf_ov_fleets_selected").addClass("notenough");
			red_launch_text=true;

		}
		else {
			$("#lf_ov_fleets_selected").removeClass("notenough");
		}
	}
	else {
		$("#lf_ov_fleets_selected").removeClass("notenough");
	}



	if (red_launch_text==true){
		$("#launch_button_text").addClass("notenough");

	}
}

function returnXPmultiplier(myStrength,targetStrength,world_type){
	var xp_multiplier=3;

	var def_str_ratio=targetStrength/myStrength*100;

	if (def_str_ratio<150)	{	xp_multiplier=2.7;	}
	if (def_str_ratio<140) {	xp_multiplier=2.3;	}
	if (def_str_ratio<130) {	xp_multiplier=2.0;	}
	if (def_str_ratio<125) {	xp_multiplier=1.8;	}
	if (def_str_ratio<120) {	xp_multiplier=1.6;	}
	if (def_str_ratio<115) {	xp_multiplier=1.3;	}
	if (def_str_ratio<110) {	xp_multiplier=1.0;	}

	if (def_str_ratio<95) {	xp_multiplier=1.0;	}

	if (def_str_ratio<90) {xp_multiplier=0.95;	}
	if (def_str_ratio<88) {	xp_multiplier=0.9;	}
	if (def_str_ratio<86) {	xp_multiplier=0.8;	}
	if (def_str_ratio<84) {	xp_multiplier=0.75;	}
	if (def_str_ratio<82) {	xp_multiplier=0.7;	}
	if (def_str_ratio<80) {	xp_multiplier=0.6;	}
	if (def_str_ratio<78) {	xp_multiplier=0.5;	}
	if (def_str_ratio<77) {	xp_multiplier=0.5;	}
	if (def_str_ratio<76) {	xp_multiplier=0.5;	}

	if (def_str_ratio<75) {	xp_multiplier= 0.25;	}

	// check for special-case in regards to lost outposts
	if (xp_multiplier<0){
		if (ad2460.launchVars.planet.habitable==0){
			xp_multiplier=0.0;
		}
	}

	if(world_type>10){
		xp_multiplier=1.0;
	}

	return xp_multiplier;
}

function renderLaunchSlide(planet_id){
	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	if (planet==false){
		return;
	}

	var latestIntel=returnLatestIntelReport(planet_id,planet.owner_id,planet.alliance_id);

	var present_fleets_string=translations.general_unknown;
	var present_firepower_string=translations.general_unknown;
	var present_ships_string=translations.general_unknown;
	var present_tech_tilt_string=translations.general_unknown;

	if (latestIntel!=false){
		if (latestIntel.firepower_present>-1){
			present_firepower_string=''+latestIntel.firepower_present;

		}
		if (latestIntel.capital_ships_present>-1){
			present_ships_string=''+latestIntel.capital_ships_present;
		}
		else if (latestIntel.present_frigates+ latestIntel.present_cruisers+ latestIntel.present_battleships+ latestIntel.present_carriers > -1){
			var tmpcount=latestIntel.present_frigates+ latestIntel.present_cruisers+ latestIntel.present_battleships+ latestIntel.present_carriers;
			present_ships_string=''+tmpcount;
		}

		present_fleets_string=''+latestIntel.fleets_present;

		present_tech_tilt_string=''+fullTechType(latestIntel.tech_tilt);
	}

	var estimated_travel_time=calcEta(planet.x, planet.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, false, false);
	var estimated_travel_time_string=secondsToFullTimeNosecs(estimated_travel_time);


	removeChildNodes('launch_fleet_select_scroller');
	document.getElementById('lf_ov_fleets_selected').innerHTML=0;
	document.getElementById('lf_ov_strength').innerHTML=0;
	document.getElementById('lf_ov_ships').innerHTML=0;
	document.getElementById('lf_ov_cargo_space').innerHTML=0;
	document.getElementById('lf_ov_tech_tilt').innerHTML='N/A';

	document.getElementById('lf_ov_target_location_name').innerHTML=planet.planet_name;
	document.getElementById('lf_ov_target_player_name').innerHTML=planet.nickname;
	document.getElementById('lf_ov_target_location_alliance_name').innerHTML=planet.alliance_name;
	document.getElementById('lf_ov_target_location_strength').innerHTML=prettyPrint(planet.strength);
	document.getElementById('lf_ov_target_location_fleets_present').innerHTML=present_fleets_string;
	document.getElementById('lf_ov_target_location_ships').innerHTML=present_ships_string;
	document.getElementById('lf_ov_target_location_tech_tilt').innerHTML=fullTechType(present_tech_tilt_string);
	document.getElementById('lf_ov_target_location_travel_time').innerHTML=estimated_travel_time_string;

	// Now lets find out which fleets are actually available
	ad2460.launchVars.selectedFleets=new Array;
	ad2460.launchVars.commander={};
	renderLaunchFleets();
	updateContingentDetails('first',false);

	// Now the new warning...
	$("#launch_op_grace_warning").hide();
	var showOpGraceWarning=false;
	/*
	if (planet.world_type>10 && planet.world_type<60){
		var x=0;
		for (x=0; x < ad2460.outposts.length ;x++ ){
			if (ad2460.outposts[x].planet_grace>ad2460.serverTime){
				showOpGraceWarning=true;
			}
		}
	}
	if (showOpGraceWarning==true){
		$("#launch_op_grace_warning").show();
		blinkElementById("launch_op_grace_warning");
	}
	*/

}

function updateLaunchTargetStrength(newStrength){
	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	if (planet==false){
		return;
	}
		planet.strength=newStrength;
		document.getElementById('lf_ov_target_location_strength').innerHTML=prettyPrint(planet.strength);
		updateContingentDetails('first',false);

}

function starmapLaunchClick(planet_id){
	ad2460.launchVars.planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	renderLaunchSlide(planet_id);
	renderLaunchTactics();
	openSlide('launchslide');
}

function invalidateClusterData(quadrant, sector, cluster){
	var c=returnCluster(quadrant, sector, cluster);
	if (c!=false){
		c.last_fetch=0;
	}
}

function registerNewAttack(){
	if (ga){
		ga('send', 'event', 'game-action', 'launch', 'Launch Attack', ad2460.user_id);
	}
}

function launchOffensiveFleetClick(){
	// Must serialize the data about what we wish to launch and where (fleet-ids should be enough, sort of?)
	// Needs tactical setup too
	//  The returning string must close the launchslide and possibly open the combat-slide with a unique battle-id
	// ?? mmhhmm ??
	if (ad2460.launchVars.selectedFleets.length==0){
		systemFeedback('Launch-error', 'No fleet selected.', 1, 3);
		return;
	}
	var fleetString='';
	var i=0;
	for (i=0;i<ad2460.launchVars.selectedFleets.length ;i++ ){
		fleetString+=ad2460.launchVars.selectedFleets[i].fleet_id;
		fleetString+=",";
	}
	fleetString = fleetString.replace(/,$/,'');

	var target_planet_id=0;

	if (ad2460.launchVars.planet){
		target_planet_id=ad2460.launchVars.planet.planet_id;
	}
	//ad2460.launchVars.planet
	var t=ad2460.launchVars.tactics;

	var known_target_strength=ad2460.launchVars.planet.strength;

	$.post('actionhandler.pl', {action:'launch_attack',fleet_ids:fleetString,target:target_planet_id, known_target_strength:known_target_strength, commander_id:ad2460.launchVars.commander.commander_id, target_priority:t.target_priority, target_switching:t.target_switching, minimize_movement:t.minimize_movement, fighter_priority:t.fighter_priority, corvette_priority:t.corvette_priority, retreat_percentage:t.retreat_percentage, retreat_type:t.retreat_type, retreat_if_even:t.retreat_if_even, retreat_if_unwinnable:t.retreat_if_unwinnable}, function(data){ parseInfo(data);});
}

function checkCompletedIntel(){
	var i=0;
	var forceLoad=false;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		if (ad2460.intel.missions[i].next_report_timestamp<ad2460.serverTime+1){
			forceLoad=true;
		}
	}

	if (forceLoad==true){

		loadAllIntel();
	}
	else {
		if (ad2460.serverTime % 30 == 0){
			renderCurrentOperations();
		}
	}

}

function loadAllIntel(){
	$.post('actionhandler.pl', {action:'load_all_intel'}, function(data){ parseInfo(data);});
}

function setupStarmapIntelPanel(type){
	// type 1 == scout
	// type 2 == espionage
	// type 3 == infiltrator

	if (type==1){
		document.getElementById('sm_intel_panel_type_header').innerHTML='Scout-mission';
		document.getElementById('sm_spypanel_typepicture').src='images/planets/notification/notify_scout.jpg';
		document.getElementById('sm_spypanel_longdesc').innerHTML='A scout-mission will send out a scout through the jumpgate and gather what information it can from a distance. Scouts can be detected, and shot down before transmitting any data. They may also contain tracable information that leads back to you. Hopefully though, it will scan and transmit the data to you and then self-destruct. Either way, the scout-probe is spent and must be replaced before you can use another.';
		document.getElementById('sm_spypanel_shortdesc').innerHTML='Reveals information like resource-storage and present firepower.';
		$("#sm_spypanel_catch_warning").html("If your scout is detected, the target will know who sent it!");
		var spyTimeBonusPercent=returnSpyTimeBonusPercent();
		var missionTime=ad2460.statics.scout_time;
		missionTime=missionTime-Math.floor(missionTime*spyTimeBonusPercent/100);
		var detectionBonus=returnSpyDetectionBonusPercent();
		var detectionChance=Math.floor(ad2460.statics.scout_detection_chance-(ad2460.statics.scout_detection_chance*detectionBonus/100));
		document.getElementById('sm_spypanel_detection_chance').innerHTML=detectionChance+' %';
		document.getElementById('sm_spypanel_mission_time').innerHTML=secondsToFullTime(missionTime);
		$("#sm_spypanel_facility_heading").removeClass('red').addClass('green');
		$("#sm_spypanel_facility_noneed").show();
		$("#sm_spypanel_facility_image").hide();
		$("#sm_spypanel_facility_name").hide();
		document.getElementById('spy_execute_button').setAttribute("onclick","initiateScoutClick()");
		$("#spy_cost_h").removeClass("notenough");
		$("#spy_cost_i").removeClass("notenough");
		$("#spy_cost_s").removeClass("notenough");
		$("#spy_cost_n").removeClass("notenough");

		document.getElementById('spy_cost_h').innerHTML='0';
		document.getElementById('spy_cost_n').innerHTML='0';
		document.getElementById('spy_cost_s').innerHTML='0';
		document.getElementById('spy_cost_i').innerHTML='0';


	}

	if (type==2){
		document.getElementById('sm_intel_panel_type_header').innerHTML='Espionage';
		document.getElementById('sm_spypanel_typepicture').src='images/planets/notification/notify_espionage.jpg';
		document.getElementById('sm_spypanel_longdesc').innerHTML='The Espionage mission will place an agent on the ground of the homeworld you wish to spy on, and this agent will work to gather information without interacting with the population of the homeworld. The Agent will gather information about fleets, resources and outposts.';
		document.getElementById('sm_spypanel_shortdesc').innerHTML="Reveals information about target's homeworld, fleets and outposts.";
		$("#sm_spypanel_catch_warning").html("If your spy is detected and captured, she might break under pressure and reveal information about your homeworld.");
		var spyTimeBonusPercent=returnSpyTimeBonusPercent();
		var missionTime=ad2460.statics.espionage_time;
		missionTime=missionTime-Math.floor(missionTime*spyTimeBonusPercent/100);
		var detectionBonus=returnSpyDetectionBonusPercent();
		var detectionChance=Math.floor(ad2460.statics.espionage_detection_chance-(ad2460.statics.espionage_detection_chance*detectionBonus/100));
		document.getElementById('sm_spypanel_detection_chance').innerHTML=detectionChance+' %';
		document.getElementById('sm_spypanel_mission_time').innerHTML=secondsToFullTime(missionTime);
		// check the required facility  and remove the class green on if its not right 'build_panel_facility_heading'
		$("#sm_spypanel_facility_noneed").hide();
		document.getElementById('sm_spypanel_facility_image').src='images/icons/facility/346x100.jpg';

		var a=returnGameObjectById(349);
		$("#sm_spypanel_facility_name").html(a.name+' '+a.level);
		if (a.user_id==ad2460.user_id && a.upgrading==0){
			$("#sm_spypanel_facility_heading").removeClass('red').addClass('green');
			document.getElementById('spy_execute_button').setAttribute("onclick","initiateEspionageClick()");
		}
		else {
			$("#sm_spypanel_facility_heading").removeClass('green').addClass('red');
			document.getElementById('spy_execute_button').setAttribute("onclick","initiateEspionageClick()");
			//document.getElementById('spy_execute_button').setAttribute("onclick","showUnmetIntelFacilityRequirements()");
		}

		$("#sm_spypanel_facility_image").show();
		$("#sm_spypanel_facility_name").show();
		document.getElementById('spy_cost_h').innerHTML=prettyPrint(50000);
		document.getElementById('spy_cost_n').innerHTML=prettyPrint(50000);
		document.getElementById('spy_cost_s').innerHTML=prettyPrint(50000);
		document.getElementById('spy_cost_i').innerHTML=prettyPrint(50000);

		$("#spy_cost_h").removeClass("notenough");
		$("#spy_cost_i").removeClass("notenough");
		$("#spy_cost_s").removeClass("notenough");
		$("#spy_cost_n").removeClass("notenough");
		if (ad2460.resources.hassium<50000){		$("#spy_cost_h").addClass("notenough");		}
		if (ad2460.resources.indium<50000){		$("#spy_cost_i").addClass("notenough");		}
		if (ad2460.resources.strontium<50000){	$("#spy_cost_s").addClass("notenough");		}
		if (ad2460.resources.neodymium<50000){	$("#spy_cost_n").addClass("notenough");		}



	}

	if (type==3){
		document.getElementById('sm_intel_panel_type_header').innerHTML='Infiltration';
		document.getElementById('sm_spypanel_typepicture').src='images/planets/notification/notify_infiltration.jpg';
		document.getElementById('sm_spypanel_longdesc').innerHTML='The infiltration-mission will place an agent on the ground of the homeworld you wish to spy on, and keep him there reporting at regular intervals. He might be detected at any time though, and there is no telling what he might reveal about you if caught. An infiltrator can report on fleet-strength, top commanders and even alliance-related information.';
		document.getElementById('sm_spypanel_shortdesc').innerHTML="Reveals information about target's homeworld, fleets, outposts, commanders and even alliance-related information.";
		$("#sm_spypanel_catch_warning").html("If your infiltrator is detected and captured, he might break under pressure and reveal information about your homeworld.");
		var spyTimeBonusPercent=returnSpyTimeBonusPercent();
		var missionTime=ad2460.statics.infiltration_time;
		missionTime=missionTime-Math.floor(missionTime*spyTimeBonusPercent/100);
		var detectionBonus=returnSpyDetectionBonusPercent();
		var detectionChance=Math.floor(ad2460.statics.infiltration_detection_chance-(ad2460.statics.infiltration_detection_chance*detectionBonus/100));
		document.getElementById('sm_spypanel_detection_chance').innerHTML=detectionChance+' %';
		document.getElementById('sm_spypanel_mission_time').innerHTML=secondsToFullTime(missionTime);
		// check the required facility  and remove the class green on if its not right 'build_panel_facility_heading'
		$("#sm_spypanel_facility_noneed").hide();
		document.getElementById('sm_spypanel_facility_image').src='images/icons/facility/346x100.jpg';

		var a=returnGameObjectById(350);
		$("#sm_spypanel_facility_name").html(a.name+' '+a.level);
		if (a!=false){
		}
		if (a.user_id==ad2460.user_id && a.upgrading==0){
			$("#sm_spypanel_facility_heading").removeClass('red').addClass('green');
			document.getElementById('spy_execute_button').setAttribute("onclick","initiateInfiltrateClick()");
		}
		else {
			$("#sm_spypanel_facility_heading").removeClass('green').addClass('red');
			//document.getElementById('spy_execute_button').setAttribute("onclick",null);
			document.getElementById('spy_execute_button').setAttribute("onclick","initiateInfiltrateClick()");
		}

		$("#sm_spypanel_facility_image").show();
		$("#sm_spypanel_facility_name").show();
		document.getElementById('spy_cost_h').innerHTML=prettyPrint(150000);
		document.getElementById('spy_cost_n').innerHTML=prettyPrint(150000);
		document.getElementById('spy_cost_s').innerHTML=prettyPrint(150000);
		document.getElementById('spy_cost_i').innerHTML=prettyPrint(150000);
		$("#spy_cost_h").removeClass("notenough");
		$("#spy_cost_i").removeClass("notenough");
		$("#spy_cost_s").removeClass("notenough");
		$("#spy_cost_n").removeClass("notenough");
		if (ad2460.resources.hassium<150000){		$("#spy_cost_h").addClass("notenough");		}
		if (ad2460.resources.indium<150000){		$("#spy_cost_i").addClass("notenough");		}
		if (ad2460.resources.strontium<150000){	$("#spy_cost_s").addClass("notenough");		}
		if (ad2460.resources.neodymium<150000){	$("#spy_cost_n").addClass("notenough");		}
	}

	showEspionageOption();
}

function initiateScoutClick(){
	var planet_id=ad2460.starmap.currently_selected_planet_id;
	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	if (planet==false){
		systemFeedback('Radiation error', 'Please wait 5 seconds and try again.', 1, 3);
		loadClusterContent(ad2460.starmap.quadrantSquare, ad2460.starmap.sectorSquare, ad2460.starmap.clusterSquare, 1,ad2460.starmap.systemViewVars.currentPlanetSelect);
		return;
	}
	// My own planet???
	if (planet.owner_id==ad2460.user_id){
		systemFeedback('Failed logic', 'You may not scout your own planets.', 1, 3);
		return;
	}

	// My allied planet???
	// Allow it anyway
	/*
	if (planet.alliance_id==ad2460.allianceData.id && ad2460.allianceData.id!=0){
		systemFeedback('Diplomacy error', 'You may not scout an allied planet.', 1, 3);
		return;
	}
	*/
	// Now we must check if the player has any scouts in his small-ship-storage...
	var fleet=returnStorageFleet();
	var have_scout=false;
	if (fleet){
		var i=0;
		for (i=0;i<fleet.storage.length ;i++ ){
			if (fleet.storage[i].ship_type_id==430 && fleet.storage[i].counter>0)	{
				have_scout=true;
			}
		}
	}

	if (!have_scout){
		systemFeedback('No scout-ship found', 'You must build some scouts before you can use them.', 1, 3);
		return;
	}


	$.post('actionhandler.pl', {action:'initiate_scout', planet_id:planet_id}, function(data){ parseInfo(data);});

	closeEspionagePanel();
}

function initiateDirectScout(x,y){
	$.post('actionhandler.pl', {action:'initiate_scout_xy', x:x, y:y}, function(data){ parseInfo(data);});
}

function initiateDirectSpy(x,y){
	$.post('actionhandler.pl', {action:'initiate_spy_xy', x:x, y:y}, function(data){ parseInfo(data);});
}

function markTargetSearchDirectIcon(type){
	if (type=='scout'){
		$("#ts_scout_icon").css("border", "cyan solid 2px");
	}
	if (type=='espionage'){
		$("#ts_spy_icon").css("border", "cyan solid 2px");
	}
}


function updateLiveScoutCounter(){
	var scoutCounter=0;

	var fleet=returnStorageFleet();
	if (fleet){
		var i=0;
		for (i=0;i<fleet.storage.length ;i++ ){
			if (fleet.storage[i].ship_type_id==430 && fleet.storage[i].counter>0)	{
				scoutCounter=fleet.storage[i].counter;
			}
		}
	}
	$("#live_scout_counter").html(scoutCounter);
}

function updateLiveAgentCounters(){
	// live_espionage_counter_active
	// live_espionage_counter_available
	// live_infiltration_counter_active
	// live_infiltration_counter_available

	var maxAgents=returnMaxAgents();
	document.getElementById('live_espionage_counter_available').innerHTML=maxAgents.spies;
	document.getElementById('live_infiltration_counter_available').innerHTML=maxAgents.infiltrators;

	var currentEspMissions=0;
	var currentInfMissions=0;

	var i=0;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		if (ad2460.intel.missions[i].type=='espionage')	{
			currentEspMissions++;
		}
		if (ad2460.intel.missions[i].type=='spy-sweep')	{
			currentEspMissions++;
		}
		if (ad2460.intel.missions[i].type=='infiltration')	{
			currentInfMissions++;
		}
		if (ad2460.intel.missions[i].type=='infiltrator-sweep')	{
			currentInfMissions++;
		}
	}

	document.getElementById('live_espionage_counter_active').innerHTML=currentEspMissions;
	document.getElementById('live_infiltration_counter_active').innerHTML=currentInfMissions;

	if (maxAgents.spies>0){
		$("#espionage_available").removeClass('notavailable');
	}
	else {
		$("#espionage_available").addClass('notavailable');
	}
	if (maxAgents.infiltrators>0){
		$("#infiltration_available").removeClass('notavailable');
	}
	else {
		$("#infiltration_available").addClass('notavailable');
	}

}


function spendScout(){
	var fleet=returnStorageFleet();
	if (fleet){
		var i=0;
		for (i=0;i<fleet.storage.length ;i++ ){
			if (fleet.storage[i].ship_type_id==430 && fleet.storage[i].counter>0)	{
				fleet.storage[i].counter--;
			}
		}
	}
}

function addIntelMission(mission_id, user_id, type, initiate_timestamp, next_report_timestamp, planet_id, planet_name, planet_owner_id, planet_owner_alliance_id, detection_chance, owner_name, x , y, world_type){
	var i=0;
	var found=false;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		thisMission=ad2460.intel.missions[i];
		if (thisMission.mission_id==mission_id){
			thisMission.mission_id=mission_id;
			thisMission.user_id=user_id;
			thisMission.type=type;
			thisMission.initiate_timestamp=initiate_timestamp;
			thisMission.next_report_timestamp=next_report_timestamp;
			thisMission.planet_id=planet_id;
			thisMission.planet_name=planet_name;
			thisMission.planet_owner_id=planet_owner_id;
			thisMission.planet_owner_alliance_id=planet_owner_alliance_id;
			thisMission.detection_chance=detection_chance;
			thisMission.owner_name=owner_name;
			thisMission.x=x;
			thisMission.y=y;
			thisMission.world_type=world_type;

			found=true;

		}
	}
	if (found==false){
		ad2460.intel.missions.push(new intelMission(mission_id, user_id, type, initiate_timestamp, next_report_timestamp, planet_id, planet_name, planet_owner_id, planet_owner_alliance_id, detection_chance, owner_name, x, y, world_type));

	}

}

function addIntelReport(report_id, mission_id, type, timestamp, user_id, user_alliance_id, planet_id, planet_name, planet_x, planet_y, planet_owner_id, planet_owner_alliance_id, planet_owner_alliance_name, planet_owner_name, planet_owner_homeworld_name, planet_owner_homeworld_x, planet_owner_homeworld_y, strength_present, fleets_present, stored_hassium, stored_strontium, stored_neodymium, stored_indium, world_type, outpost_level, present_frigates, present_cruisers, present_battleships, present_carriers, present_minors, present_cannons, present_artillery, present_stations, owned_frigates, owned_cruisers, owned_battleships, owned_carriers, owned_minors, owned_cannons, owned_artillery, owned_stations, owned_artifacts, owned_strength, owned_fleets, player_level, outposts, tech_tilt, alliance_bankers, alliance_bank_hassium, alliance_bank_indium, alliance_bank_strontium, alliance_bank_neodymium, last_5_combats, score_rank, total_output, present_shieldgens, owned_shieldgens){
	var i=0;
	var found=false;
	for (i=0;i<ad2460.intel.reports.length ;i++ ){
		thisReport=ad2460.intel.reports[i];
		if (thisReport.report_id==report_id){
			thisReport.report_id=report_id;
			thisReport.mission_id=mission_id;
			thisReport.type=type;
			thisReport.timestamp=timestamp;
			thisReport.user_id=user_id;
			thisReport.user_alliance_id=user_alliance_id;
			thisReport.planet_id=planet_id;
			thisReport.planet_name=planet_name;
			thisReport.planet_x=planet_x;
			thisReport.planet_y=planet_y;
			thisReport.planet_owner_id=planet_owner_id;
			thisReport.planet_owner_alliance_id=planet_owner_alliance_id;
			thisReport.planet_owner_alliance_name=planet_owner_alliance_name;
			thisReport.planet_owner_name=planet_owner_name;
			thisReport.planet_owner_homeworld_name=planet_owner_homeworld_name;
			thisReport.planet_owner_homeworld_x=planet_owner_homeworld_x;
			thisReport.planet_owner_homeworld_y=planet_owner_homeworld_y;
			thisReport.strength_present=strength_present;
			thisReport.fleets_present=fleets_present;
			thisReport.stored_hassium=stored_hassium;
			thisReport.stored_strontium=stored_strontium;
			thisReport.stored_neodymium=stored_neodymium;
			thisReport.stored_indium=stored_indium;
			thisReport.world_type=world_type;
			thisReport.outpost_level=outpost_level;
			thisReport.present_frigates=present_frigates;
			thisReport.present_cruisers=present_cruisers;
			thisReport.present_battleships=present_battleships;
			thisReport.present_carriers=present_carriers;
			thisReport.present_minors=present_minors;
			thisReport.present_cannons=present_cannons;
			thisReport.present_artillery=present_artillery;
			thisReport.present_stations=present_stations;
			thisReport.owned_frigates=owned_frigates;
			thisReport.owned_cruisers=owned_cruisers;
			thisReport.owned_battleships=owned_battleships;
			thisReport.owned_carriers=owned_carriers;
			thisReport.owned_minors=owned_minors;
			thisReport.owned_cannons=owned_cannons;
			thisReport.owned_artillery=owned_artillery;
			thisReport.owned_stations=owned_stations;
			thisReport.owned_artifacts=owned_artifacts;
			thisReport.owned_strength=owned_strength;
			thisReport.owned_fleets=owned_fleets;
			thisReport.player_level=player_level;
			thisReport.outposts=outposts;
			thisReport.tech_tilt=tech_tilt;
			thisReport.alliance_bankers=alliance_bankers;
			thisReport.alliance_bank_hassium=alliance_bank_hassium;
			thisReport.alliance_bank_indium=alliance_bank_indium;
			thisReport.alliance_bank_strontium=alliance_bank_strontium;
			thisReport.alliance_bank_neodymium=alliance_bank_neodymium;
			thisReport.last_5_combats=last_5_combats;
			thisReport.score_rank=score_rank;
			thisReport.total_output=total_output;
			thisReport.present_shieldgens=present_shieldgens;
			thisReport.owned_shieldgens=owned_shieldgens;

			found=true;
		}
	}
	if (found==false){
		ad2460.intel.reports.push(new intelReport(report_id, mission_id, type, timestamp, user_id, user_alliance_id, planet_id, planet_name, planet_x, planet_y, planet_owner_id, planet_owner_alliance_id, planet_owner_alliance_name, planet_owner_name, planet_owner_homeworld_name, planet_owner_homeworld_x, planet_owner_homeworld_y, strength_present, fleets_present, stored_hassium, stored_strontium, stored_neodymium, stored_indium, world_type, outpost_level, present_frigates, present_cruisers, present_battleships, present_carriers, present_minors, present_cannons, present_artillery, present_stations, owned_frigates, owned_cruisers, owned_battleships, owned_carriers, owned_minors, owned_cannons, owned_artillery, owned_stations, owned_artifacts, owned_strength, owned_fleets, player_level, outposts, tech_tilt, alliance_bankers, alliance_bank_hassium, alliance_bank_indium, alliance_bank_strontium, alliance_bank_neodymium, last_5_combats, score_rank, total_output, present_shieldgens, owned_shieldgens));
	}
}

function initiateEspionageClick(){
	var planet_id=ad2460.starmap.currently_selected_planet_id;
	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	if (planet==false){
		systemFeedback('Radiation error', 'Please wait 5 seconds and try again.', 1, 3);
		loadClusterContent(ad2460.starmap.quadrantSquare, ad2460.starmap.sectorSquare, ad2460.starmap.clusterSquare, 1,ad2460.starmap.systemViewVars.currentPlanetSelect);
		return;
	}

	var agents=0;
	// We must check if he has available agents....
	// Add these checks server-side as well....
	if (checkFacilityRequirement(349)==true){
		agents++;
	}
	if (checkFacilityRequirement(350)==true){
		agents++;
		agents++;
	}
	if (checkFacilityRequirement(351)==true){
		agents++;
		agents++;
	}
	if (agents<1){
		systemFeedback('No agents', 'You need to build the facility Intelligence Branch Level 1 to use agents.', 1, 3);
		return;
	}

	var used_agents=0;
	var i=0;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		var thisMission=ad2460.intel.missions[i];
		if (thisMission.type=='espionage'){
			used_agents++;
		}
		if (thisMission.type=='spy-sweep'){
			used_agents++;
		}
	}

	if (used_agents>=agents){
		systemFeedback('No available agents', 'All your agents are currently busy.', 1, 3);
		return;
	}

	// My own planet???
	if (planet.owner_id==ad2460.user_id){
		systemFeedback('Failed logic', 'You may not spy on your own planets.', 1, 3);
		return;
	}

	// My allied planet???
	// Allow it anyway
	/*
	if (planet.alliance_id==ad2460.allianceData.id && ad2460.allianceData.id!=0){
		systemFeedback('Diplomacy error', 'You may not spy on an allied planet.', 1, 3);
		return;
	}
	*/

	$.post('actionhandler.pl', {action:'initiate_spy', planet_id:planet_id}, function(data){ parseInfo(data);});

	closeEspionagePanel();
}

function initiateInfiltrateClick(){
	var planet_id=ad2460.starmap.currently_selected_planet_id;
	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	if (planet==false){
		systemFeedback('Radiation error', 'Please wait 5 seconds and try again.', 1, 3);
		loadClusterContent(ad2460.starmap.quadrantSquare, ad2460.starmap.sectorSquare, ad2460.starmap.clusterSquare, 1,ad2460.starmap.systemViewVars.currentPlanetSelect);
		return;
	}

	var agents=0;
	// We must check if he has available agents....
	// Add these checks server-side as well....
	if (checkFacilityRequirement(349)==true){
		// Nothing
	}
	if (checkFacilityRequirement(350)==true){
		agents++;
	}
	if (checkFacilityRequirement(351)==true){
		agents++;
		agents++;
	}
	if (agents<1){
		systemFeedback('No agents', 'You need to build the facility Intelligence Branch Level 2 to use infiltrators.', 1, 3);
		return;
	}

	var used_agents=0;
	var i=0;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		var thisMission=ad2460.intel.missions[i];
		if (thisMission.type=='infiltration'){
			used_agents++;
		}
		if (thisMission.type=='infiltrator-sweep'){
			used_agents++;
		}
	}

	if (used_agents>=agents){
		systemFeedback('No available agents', 'All your agents are currently busy.', 1, 3);
		return;
	}

	// My own planet???
	if (planet.owner_id==ad2460.user_id){
		systemFeedback('Failed logic', 'You may not spy on your own planets.', 1, 3);
		return;
	}

	// My allied planet???
	// Allow it anyway
	/*
	if (planet.alliance_id==ad2460.allianceData.id && ad2460.allianceData.id!=0){
		systemFeedback('Diplomacy error', 'You may not spy on an allied planet.', 1, 3);
		return;
	}
	*/


	if (ad2460.resources.indium<5000){
		systemFeedback('Not enough Indium', 'Using an infiltrator costs 5000 Indium.', 1, 3);
		return;
	}


	$.post('actionhandler.pl', {action:'initiate_infiltrator', planet_id:planet_id}, function(data){ parseInfo(data);});


	closeEspionagePanel();
}

function zoomInToXY(x,y){

	var coordsObj=convertShortCoordsToLongCoords(x,y);
	//console.log(coordsObj.q, coordsObj.s, coordsObj.g, coordsObj.o, coordsObj.p-1);
	zoomInTo(coordsObj.q, coordsObj.s, coordsObj.g, coordsObj.o, coordsObj.p);
}

function createLinkToPlanet(planet_id){
	$.post('actionhandler.pl', {action:'create_link_to_planet', planet_id:planet_id}, function(data){ parseInfo(data);});
}

function instantCompleteProspecting(cluster_id){
	$.post('actionhandler.pl', {action:'instant_complete_prospecting', cluster_id:cluster_id}, function(data){ parseInfo(data);});
}

function loadDelayedClusterContent(q,s,c){

	var delay=3000;
	setTimeout('loadClusterContent('+q+','+s+','+c+')',delay);
}

function addPlayerLink(link_id, quadrant, sector, cluster, system, position, heading, body){
	ad2460.playerLinks.push(new playerLink(link_id, quadrant, sector, cluster, system, position, heading, body));
}

function fetchPlayerLinks(){
	ad2460.playerLinks=new Array;
	$.post('actionhandler.pl', {action:'fetch_player_links'}, function(data){ parseInfo(data);});

}

function renderPlayerLinks(){
	var parent=document.getElementById('link_scroller');
	removeChildNodes('link_scroller');

	var i=0;
	for (i=0;i<ad2460.playerLinks.length ;i++ ){
		var link=ad2460.playerLinks[i];
		var container=createSingleElement('div', 'starmap_entryline', 'link_'+link.link_id, '', '');
		var content1=createSingleElement('div', 'linkname', '', link.heading, 'starmapLinkNameClick('+link.link_id+')');
		var coordString="["+link.quadrant+":"+link.sector+":"+link.cluster+":"+link.system+":"+link.position+"]";
		var content2=createSingleElement('div', 'linkcoords', '', coordString, "zoomInTo("+link.quadrant+","+link.sector+","+link.cluster+","+link.system+","+parseInt(link.position)+")");

		container.appendChild(content1);
		container.appendChild(content2);

		parent.appendChild(container);
	}
	HideMapLinkInfo();
}

function starmapLinkNameClick(link_id){
	if (link_id==ad2460.universe.last_selected_link_id){
		HideMapLinkInfo();
		return;
	}

	var i=0;
	var link=false;
	for (i=0;i<ad2460.playerLinks.length ;i++ ){
		if (ad2460.playerLinks[i].link_id==link_id){
			link=ad2460.playerLinks[i];
			ad2460.universe.last_selected_link_id=link_id;
		}
	}
	if (link!=false){
		$("#starmap_player_link_head").val(link.heading);
		$("#starmap_player_link_body").val(link.body);
		$("#starmap_player_link_hidden_id").val(link.link_id);
	}

	if (ad2460.universe.link_details_panel_open==false){
		ShowMapLinkInfo();
	}
}

function saveMapLinkInfo(){
	if (ad2460.universe.last_selected_link_id>0){
		var heading=$("#starmap_player_link_head").val();
		var body=$("#starmap_player_link_body").val();
		var link_id=$("#starmap_player_link_hidden_id").val();
		$.post('actionhandler.pl', {action:'update_map_link_info',heading:heading,body:body,link_id:link_id}, function(data){ parseInfo(data);});
	}
}

function updateSelectedLinkData(){
	var heading=$("#starmap_player_link_head").val();
	var body=$("#starmap_player_link_body").val();
	var link_id=$("#starmap_player_link_hidden_id").val();

	for (i=0;i<ad2460.playerLinks.length ;i++ ){
		if (ad2460.playerLinks[i].link_id==link_id){
			ad2460.playerLinks[i].heading=heading;
			ad2460.playerLinks[i].body=body;
		}
	}
	renderPlayerLinks();
}

function deletePlayerLinkClick(){
	if (ad2460.universe.last_selected_link_id>0){

		var mainText="Are you sure you wish to delete this link?";
		var okText="Yes";
		var cancelText="No";
		var okClick="confirmedPlayerLinkDelete();hideConfirmationPopup();";

		showConfirmationPopup(mainText, okText, cancelText, okClick);
	}
}

function deletePlayerLinkClickById(id){
	$.post('actionhandler.pl', {action:'delete_player_link',link_id:id, reselect_planet:1}, function(data){ parseInfo(data);});
	for (i=0;i<ad2460.playerLinks.length ;i++ ){
		if (ad2460.playerLinks[i].link_id==id){
			ad2460.playerLinks.splice(i,1);
			i--;
		}
	}
}

function confirmedPlayerLinkDelete(){
	var link=false;
	for (i=0;i<ad2460.playerLinks.length ;i++ ){
		if (ad2460.playerLinks[i].link_id==ad2460.universe.last_selected_link_id){
			link=ad2460.playerLinks[i];
		}
	}

	if (link!=false){
		$("#link_"+link.link_id).remove();
		$.post('actionhandler.pl', {action:'delete_player_link',link_id:link.link_id}, function(data){ parseInfo(data);});

	}

	// Cleanup
	for (i=0;i<ad2460.playerLinks.length ;i++ ){
		if (ad2460.playerLinks[i].link_id==ad2460.universe.last_selected_link_id){
			ad2460.playerLinks.splice(i,1);
			i--;
		}
	}
	HideMapLinkInfo();
}

function ShowMapLinkInfo() {
	$(".link_note").stop().animate( { width : "218px" } );
	ad2460.universe.link_details_panel_open=true;
}

function HideMapLinkInfo(){
	$(".link_note").stop().animate( { width : "0px" } );
	ad2460.universe.link_details_panel_open=false;
	ad2460.universe.last_selected_link_id=0;
}

function searchUniverseClick(type){
	var phrase="";
	if (type == 'planet'){
		phrase=$("#starmap_search_input_planet").val().trim();
	}
	else if (type == 'player'){
		phrase=$("#starmap_search_input_player").val().trim();
	}
	else if (type == 'alliance'){
		phrase=$("#starmap_search_input_alliance").val().trim();
	}

	if (phrase.length<2){
		systemFeedback('Search-error', '2 characters minimum', 1, 2);
		return;
	}
	phrase=phrase.replace(/[^A-Za-z 0-9_]/g, '') ;


	// Now check local cache for the last 10 minutes to see if we might have it..
	for (i=0;i<ad2460.universeSearches.length ;i++ ){
		// purge old ones
		if (ad2460.universeSearches[i].timestamp<ad2460.serverTime-(10*60))	{
			// wipe it!
			ad2460.universeSearches.splice(i,1);
			i--;
		}
		else if (ad2460.universeSearches[i].phrase==phrase && ad2460.universeSearches[i].type==type && ad2460.universeSearches[i].timestamp>ad2460.serverTime-(10*60)){
			// We have it cached tbh!
			selectUniverseSearch(phrase,type);
			return;
		}
	}

	$.post('actionhandler.pl', {action:'initiate_universe_search',phrase:phrase,type:type}, function(data){ parseInfo(data);});
}

function selectUniverseSearch(phrase,type){
	for (i=0;i<ad2460.universeSearches.length ;i++ ){
		if (ad2460.universeSearches[i].phrase==phrase && ad2460.universeSearches[i].type==type){
			renderUniverseSearchResults(ad2460.universeSearches[i]);
			return;
		}
	}
}

function addUniverseSearchResult(phrase,type,timestamp){
	ad2460.universeSearches.push(new universeSearch(phrase,type,timestamp));
}

function addSearchDetails(dataobject){
	for (i=0;i<ad2460.universeSearches.length ;i++ ){
		if (ad2460.universeSearches[i].phrase==dataobject.phrase && ad2460.universeSearches[i].type==dataobject.type){
			// Got it...
			ad2460.universeSearches[i].results.push(dataobject);

		}
	}
}

function renderUniverseSearchResults(result){
	// the result-object is present, find the right parent and render away ;)
	var parent_id=false;
	if (result.type == 'player'){
		parent_id='sm_search_player_scroller';
	}
	 else if (result.type == 'planet'){
		parent_id='sm_search_planet_scroller';
	}
	else if (result.type == 'alliance'){
		parent_id='sm_search_alliance_scroller';
	}

	if (parent_id == false){
		return;
	}

	removeChildNodes(parent_id);
	var parent=document.getElementById(parent_id);
	var i=0;
	for (i=0;i<result.results.length ;i++ ){
		// Render based on type ;)
		if (result.type == 'player'){

			var container=createSingleElement('div', 'starmap_searchentryline', '', '', '');
			var content1=createSingleElement('div', 'linkname', '', result.results[i].nickname, 'loadPlayerInfo('+result.results[i].owner_id+')');
			content1.style.color='#FFE868';

			var c=convertShortCoordsToLongCoords(result.results[i].x,result.results[i].y);
			var coordString=c.coordString;
			var content2=createSingleElement('div', 'linkcoords', '', coordString, "zoomInTo("+c.q+","+c.s+","+c.g+","+c.o+","+parseInt(c.p)+")");

			container.appendChild(content1);
			container.appendChild(content2);

			parent.appendChild(container);
		}
		else if (result.type == 'planet'){
			var container=createSingleElement('div', 'starmap_searchentryline', '', '', '');
			var content1=createSingleElement('div', 'linkname', '', result.results[i].planet_name, '');
			content1.style.color='rgb(255, 200, 67)';


			var c=convertShortCoordsToLongCoords(result.results[i].x,result.results[i].y);
			var coordString=c.coordString;
			var content2=createSingleElement('div', 'linkcoords', '', coordString, "zoomInTo("+c.q+","+c.s+","+c.g+","+c.o+","+parseInt(c.p)+")");

			container.appendChild(content1);
			container.appendChild(content2);

			parent.appendChild(container);
		}
		else if (result.type == 'alliance'){
			var container=createSingleElement('div', 'starmap_searchentryline', '', '', '');
			var content1=createSingleElement('div', 'linkname', '', result.results[i].alliance_name, 'loadAllianceInfo('+result.results[i].alliance_id+')');
			content1.style.color='rgb(0, 255, 255)';
			// content1 needs an onclick to show the alliance-info...this is where it gets tricky....
			// in the server-handler, we have the fetch_alliance_data_by_id function that we might need to call.
			// Unless we have it cached ofc...But we have no way to be sure of that here...
			// However..if we check that here...and don't find it, fire of the request to the server, and we should get the results in time for the click ;)
			container.appendChild(content1);
			parent.appendChild(container);
			// The below function will check if we have stale or missing data, and reload it if needed ;)
			getAllianceData(result.results[i].alliance_id);
			// Might cause 15 server-calls this one!!! Beware!
		}
	}
}

function showAllianceInfo(alliance_id){
	// The details should be cached already, so just get it!
	var alliance=returnAllianceById(alliance_id);
	if (alliance!=false){
		// Fill in the data
		$("#small_alliance_slider_recruitment_officer").html("None");
		$("#small_alliance_slider_logo").attr("src","images/uploads/alliancelogos/"+alliance.logo_url);
		$("#small_alliance_slider_name").html(alliance.name);
		$("#small_alliance_slider_ranking").html(alliance.score_rank);
		$("#small_alliance_slider_members").html(alliance.members.length);
		var y=0;
		for (y=0;y<alliance.members.length ;y++ ){
			if (alliance.members[y].tag_string=='Alliance Leader'){
				$("#small_alliance_slider_leader").html(alliance.members[y].name);
				var coords=convertShortCoordsToLongCoords(alliance.members[y].x,alliance.members[y].y);
				var posnum=coords.p;
				document.getElementById('small_alliance_slider_leader').setAttribute("onclick","zoomInTo("+coords.q+","+coords.s+","+coords.g+","+coords.o+","+posnum+")");
			}
		}
		for (y=0;y<alliance.members.length ;y++ ){
			if (alliance.members[y].tag_string=='Recruitment Officer'){
				$("#small_alliance_slider_recruitment_officer").html(alliance.members[y].name);
				var coords=convertShortCoordsToLongCoords(alliance.members[y].x,alliance.members[y].y);
				var posnum=coords.p;
				document.getElementById('small_alliance_slider_recruitment_officer').setAttribute("onclick","zoomInTo("+coords.q+","+coords.s+","+coords.g+","+coords.o+","+posnum+")");
			}
		}

		// small_alliance_slider_richest_members_container
		// fill this one in if the intel is there...
		var richestContainer=document.getElementById('small_alliance_slider_richest_members_container');
		removeChildNodes('small_alliance_slider_richest_members_container');
		var thisIntel=returnLatestIntelReport(0,0,alliance_id);
		if (thisIntel!=false){
			if (thisIntel.alliance_bankers!=-1){
				var richestArray=thisIntel.alliance_bankers.split('||');
				var y=0;
				for (y=0;y<richestArray.length ;y++ ){
					var dataArray=richestArray[y].split('|');
					if (dataArray.length>1)	{
						var div1=createSingleElement('div','short_info_header', '', ''+dataArray[0], '');
						var div2=createSingleElement('div','short_info_entry_small', '', dataArray[1], '');

						var coordObject=convertShortCoordsToLongCoords(dataArray[2],dataArray[3]);
						var coordString='['+coordObject.q+':'+coordObject.s+':'+coordObject.g+':'+coordObject.o+'.'+coordObject.p+']';
						var div3=createSingleElement('div','short_info_entry_mid planetlink', '', ''+coordString, 'zoomInToXY('+dataArray[2]+','+dataArray[3]+')');

						div1.style.cursor='default';
						div2.style.cursor='default';

						richestContainer.appendChild(div1);
						richestContainer.appendChild(div2);
						richestContainer.appendChild(div3);
					}
				}

			}



		}
		else {
			var div1=createSingleElement('div','short_info_header', '', 'Not enough intel', '');
			richestContainer.appendChild(div1);
		}

		// Show the small panel coming up from below :)
		showPlanetOwnerAlliance();
	}
}

function toggleStarmapOverlay(id){
	if (id==1){
		ad2460.universe.starmaptoggles.topAlliances=1-ad2460.universe.starmaptoggles.topAlliances;
	}
	if (id==2){
		ad2460.universe.starmaptoggles.myAlliance=1-ad2460.universe.starmaptoggles.myAlliance;
	}
	if (id==3){
		ad2460.universe.starmaptoggles.highConflict=1-ad2460.universe.starmaptoggles.highConflict;
	}
	if (id==4){
		clearAllStarmapOverlayFlags();
	}

	updateToggleClasses();
	renderMapData("nodelay");

}

function updateToggleClasses(){
	$("#sm_layer_toggle_topalliances").removeClass('selected');
	$("#sm_layer_toggle_myalliance").removeClass('selected');
	$("#sm_layer_toggle_highconflict").removeClass('selected');
	$("#sm_layer_toggle_none").removeClass('selected');

	if (ad2460.universe.starmaptoggles.topAlliances==1)	{
		$("#sm_layer_toggle_topalliances").addClass('selected');
	}
	if (ad2460.universe.starmaptoggles.myAlliance==1)	{
		$("#sm_layer_toggle_myalliance").addClass('selected');
	}
	if (ad2460.universe.starmaptoggles.highConflict==1)	{
		$("#sm_layer_toggle_highconflict").addClass('selected');
	}
	if (ad2460.universe.starmaptoggles.topAlliances==0 && ad2460.universe.starmaptoggles.myAlliance==0 && ad2460.universe.starmaptoggles.highConflict==0){
		$("#sm_layer_toggle_none").addClass('selected');
	}
}

function zoomToHomeworld(){
	zoomInToXY(ad2460.homeworld.x,ad2460.homeworld.y);
}

function returnSolarSystemRenderType(quadrant, sector, cluster, system){

	var seed=1+quadrant+sector+cluster+system;
	var type=parseFloat('0.'+Math.sin(seed).toString().substr(6));
	// type is now anywhere from 0.01 something to 0.98
	// Pretty much the full range!
	if (type<0.17){
		return 1;
	}
	else if (type<0.34){
		return 2;
	}
	else if (type<0.50){
		return 3;
	}
	else if (type<0.67){
		return 4;
	}
	else if (type<0.84){
		return 5;
	}
	else if (type<1.00){
		return 6;
	}
	else {
		return 6;
	}
}

function returnRulingAlliance(){
	var aData=new Array;
	var currentMapZoomLevel=getCurrentZoomLevel();
	if (currentMapZoomLevel=='galaxy'){
		var q=0;
		var s=0;
		for (q=0;q<ad2460.universe.quadrants.length ;q++ ){
			for (s=0;s<ad2460.universe.quadrants[q].sectors.length ;s++ ){
				if (ad2460.universe.quadrants[q].sectors[s].s_ctrl_a_id<100000000 && ad2460.universe.quadrants[q].sectors[s].s_ctrl_a_id>0){
					var a=0;
					var found=false;
					for (a=0;a<aData.length ;a++ ){
						if (aData[a].alliance_id==ad2460.universe.quadrants[q].sectors[s].s_ctrl_a_id){
							aData[a].sectors++;
							found=true;
						}
					}
					if (found==false){
						aData.push({alliance_id:ad2460.universe.quadrants[q].sectors[s].s_ctrl_a_id, sectors:1});
					}
				}
			}
		}
	}

	if (currentMapZoomLevel=='quadrant'){
		var thisQuadrant=returnQuadrant(ad2460.starmap.quadrantSquare);
		var s=0;
		for (s=0;s<thisQuadrant.sectors.length ;s++ ){
			if (thisQuadrant.sectors[s].s_ctrl_a_id<100000000 && thisQuadrant.sectors[s].s_ctrl_a_id>0){
				var a=0;
				var found=false;
				for (a=0;a<aData.length ;a++ ){
					if (aData[a].alliance_id==thisQuadrant.sectors[s].s_ctrl_a_id){
						aData[a].sectors++;
						found=true;
					}
				}
				if (found==false){
					aData.push({alliance_id:thisQuadrant.sectors[s].s_ctrl_a_id, sectors:1});
				}
			}
		}
	}

	aData.sort(function(a, b){return b.sectors-a.sectors});



	if (aData.length>0){
		var alliance=returnAllianceById(aData[0].alliance_id);
		return alliance;
	}
	else {
		return false;
	}
}

function issueBountyClick(){
	var bounty=$("#credit_bounty_offer").val();
	var str=$("#bounty_destroy_amount").val();

	if (str<1){
		systemFeedback('Invalid Strength', 'You must select how much strength you wish to be destroyed for the bounty to paid!', 1, 3);
		return;
	}

	if (bounty<1){
		systemFeedback('Invalid Bounty', 'You must select how many credits you will spend on the bounty. Also, you will be charged 2 credits service-charge.', 1, 3);
		return;
	}

	if (bounty>20){
		systemFeedback('Invalid Bounty', 'The maximum bounty is 20 credits.', 1, 3);
		return;
	}

	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	if (planet){
		$.post('actionhandler.pl', {action:'place_bounty',str:str, bounty:bounty, target_id:planet.owner_id}, function(data){ parseInfo(data);});
	}
	else {
		systemFeedback('Error', 'Unknown error.', 1, 3);
		clearBountyIssue();
		hideBountyIssue();
		closeBountyIssue();

	}


}

function clearBountyIssue(){
	$("#credit_bounty_offer").val("");
	document.getElementById('bounty_destroy_amount').selectedIndex=0;
}

function hideBountyIssue(){
	clearBountyIssue();closeBountyIssue();
	$("#bounty_issue_container").hide();
}
function showBountyIssue(){
	clearBountyIssue();
	$("#bounty_issue_container").show();

}

function fixBuggedStarmap(){
	// ad2460.currentPageSectionId is "starmapslide"
	// ad2460.starmap.galaxyView is 1
	// ad2460.starmap.solIsShown is true
	//God damn Godbluffs starmap animations fuckshit!

	if (ad2460.starmap.galaxyView==1 && ad2460.starmap.solIsShown==true && ad2460.currentPageSectionId=='starmapslide'){
		// Indeed Houston, we have a problem!
		zoomToHomeworld();
	}
}

function zoomOut(){
	var m=ad2460.starmap;

	var current=getCurrentZoomLevel();

	if (current=='system'){
		zoomInTo(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,ad2460.starmap.clusterSquare);
	}
	if (current=='cluster'){
		zoomInTo(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare);
	}
	if (current=='sector'){
		zoomInTo(ad2460.starmap.quadrantSquare);
	}
	if (current=='quadrant'){
		zoomInTo();
	}
}
// Outpost functions
function clearOwnOutposts(){
	ad2460.outposts=new Array;
	ad2460.outpostVars.upgradeInProgress=false;
	ad2460.lostOutposts=new Array;
}

function fetchOwnOutposts(callbackString){
	$.post('actionhandler.pl', {action:'fetch_own_outposts'}, function(data){ parseInfo(data);eval(callbackString)});
}

function updateLostOutpost(planet_id, x, y, world_type,name, hassium_max_output,neodymium_max_output,strontium_max_output,indium_max_output,lost_time, new_owner_id, new_owner_name, new_owner_alliance_id, new_owner_alliance_name, taker_id, taker_name, taker_alliance_id, taker_alliance_name){
	var lost=new lostOutpost(planet_id, x, y, world_type,name, hassium_max_output,neodymium_max_output,strontium_max_output,indium_max_output,lost_time, new_owner_id, new_owner_name, new_owner_alliance_id, new_owner_alliance_name, taker_id, taker_name, taker_alliance_id, taker_alliance_name);
	var found=false;
	for (var i=0;i<ad2460.lostOutposts.length ;i++ ){
		if (ad2460.lostOutposts[i].planet_id==planet_id){
			found=true;
			ad2460.lostOutposts[i]=lost;
		}
	}
	if (found==false){
		ad2460.lostOutposts.push(lost);
	}
}

function updateOutpost(planet_id, x, y, level, world_type, name, stored_hassium, stored_neodymium, stored_strontium, stored_indium, current_output_hassium,  current_output_neodymium,  current_output_strontium,  current_output_indium, upgrading, upgrade_complete_timestamp, upgrade_started_timestamp, max_output_hassium,  max_output_neodymium,  max_output_strontium,  max_output_indium, call_for_def, auto_col_percent, auto_col_enabled, inactive, last_owner_change_time, planet_grace){
	// Loop-and-possibly-create-time
	var found=false;
	var i=0;
	if (upgrading>0){
		ad2460.outpostVars.upgradeInProgress=true;
	}

	for (i=0;i<ad2460.outposts.length ;i++ ){
		var outpost=ad2460.outposts[i];
		if (outpost.planet_id==planet_id){
			found=true;
			outpost.name=name;
			outpost.planet_grace=planet_grace;
			outpost.level=level;
			outpost.stored_hassium=stored_hassium;
			outpost.stored_neodymium=stored_neodymium;
			outpost.stored_strontium=stored_strontium;
			outpost.stored_indium=stored_indium;
			outpost.current_output_hassium=current_output_hassium;
			outpost.current_output_neodymium=current_output_neodymium;
			outpost.current_output_strontium=current_output_strontium;
			outpost.current_output_indium=current_output_indium;
			outpost.upgrading=upgrading;
			outpost.upgrade_complete_timestamp=upgrade_complete_timestamp;
			outpost.started_complete_timestamp=upgrade_started_timestamp;
			outpost.max_output_hassium=max_output_hassium;
			outpost.max_output_neodymium=max_output_neodymium;
			outpost.max_output_strontium=max_output_strontium;
			outpost.max_output_indium=max_output_indium;
			outpost.call_for_def=call_for_def;
			outpost.auto_col_percent=auto_col_percent;
			outpost.auto_col_enabled=auto_col_enabled;
			outpost.inactive=inactive;
			outpost.last_owner_change_time=last_owner_change_time;

			return;
		}
	}
	if (found==false){
		// create it
		ad2460.outposts.push(new Outpost(planet_id, x, y, level, world_type, name, stored_hassium, stored_neodymium, stored_strontium, stored_indium, current_output_hassium,  current_output_neodymium,  current_output_strontium,  current_output_indium, upgrading, upgrade_complete_timestamp, upgrade_started_timestamp, max_output_hassium,  max_output_neodymium,  max_output_strontium,  max_output_indium, call_for_def, auto_col_percent, auto_col_enabled, inactive, last_owner_change_time, planet_grace));
	}

	if (ad2460.selected_outpost_planet_id>0){
		selectOutpost(ad2460.selected_outpost_planet_id,false);
	}

	// Adding check for techpoint from outpost-levels
	checkUnclaimedTechPoints('player_update',7);
}


function transportOptionsMenuUp(){

	return;

	$("#transportoptionpanel").show();
	var configColumn1 = $("#transportColumn1").height();
	var configColumn2 = $("#transportColumn2").height();
	var configColumn3 = $("#transportColumn3").height();
	var configHeights= [configColumn1,configColumn2,configColumn3];
	fullheight = Math.max.apply( Math, configHeights );
	$("#transportColumn1").height(fullheight);
	$("#transportColumn2").height(fullheight);
	$("#transportColumn3").height(fullheight);
	$('.column_helptext').css( { position: 'absolute', bottom: '0px' } );
	$("#transportoptionpanel").animate({height: fullheight+12+"px"}, { duration: 400  ,  easing : easing });
	//console.log('Moving config panel up by ' + (fullheight+12)+'px.');
	ad2460.openQuickMenues.outpost_transport_panel=true;
	$("#transportoptionpanel").focus();
}
function transportOptionsMenuDown(){
	return;

	$("#transportoptionpanel").animate({height: "0px"}, { duration: 200  ,  easing : easing, complete: function() {
		$("#transportoptionpanel").hide();
		$('.column_helptext').css( { position: 'relative', bottom: 'auto' } );
		}
	});
	ad2460.openQuickMenues.outpost_transport_panel=false;

}

function updateOutpostOverview(){

	// Needed variables
	var outpostCount=0;
	var totalProduction=0;
	var totalStored=0;
	var hassiumProduction=0;
	var neodymiumProduction=0;
	var strontiumProduction=0;
	var indiumProduction=0;
	var hassiumStored=0;
	var neodymiumStored=0;
	var strontiumStored=0;
	var indiumStored=0;

	var hassiumProductionPercent=0;
	var neodymiumProductionPercent=0;
	var strontiumProductionPercent=0;
	var indiumProductionPercent=0;

	var i=0;
	for (i=0;i<ad2460.outposts.length ;i++ ){
		var thisOutpost=ad2460.outposts[i];
		outpostCount++;
		if (thisOutpost.inactive==0){
			hassiumProduction+=thisOutpost.current_output_hassium;
			neodymiumProduction+=thisOutpost.current_output_neodymium;
			strontiumProduction+=thisOutpost.current_output_strontium;
			indiumProduction+=thisOutpost.current_output_indium;
		}

		hassiumStored+=thisOutpost.stored_hassium;
		neodymiumStored+=thisOutpost.stored_neodymium;
		strontiumStored+=thisOutpost.stored_strontium;
		indiumStored+=thisOutpost.stored_indium;
	}

	totalProduction=hassiumProduction+neodymiumProduction+strontiumProduction+indiumProduction;
	if (totalProduction>0){
		hassiumProductionPercent=Math.round(hassiumProduction*100/totalProduction);
		neodymiumProductionPercent=Math.round(neodymiumProduction*100/totalProduction);
		strontiumProductionPercent=Math.round(strontiumProduction*100/totalProduction);
		indiumProductionPercent=Math.round(indiumProduction*100/totalProduction);
	}

	totalStored=hassiumStored+neodymiumStored+strontiumStored+indiumStored;

	var max_outposts=ad2460.max_outposts_by_level[ad2460.scores.level];

	$("#o_o_count").html(''+outpostCount);
	$("#o_o_max").html(''+max_outposts);

	$("#o_o_production").html(prettyPrint(totalProduction)+' u/h');
	$("#o_o_stored").html(prettyPrint(totalStored));

	$("#o_o_prod_percent_hs").html(hassiumProductionPercent+'%');
	$("#o_o_production_hs").html(shortenBigNumber(hassiumProduction)+' u/h');
	// $("#o_o_stored_hs").html(prettyPrint(hassiumStored));

	$("#o_o_prod_percent_in").html(indiumProductionPercent+'%');
	$("#o_o_production_in").html(shortenBigNumber(indiumProduction)+' u/h');
	// $("#o_o_stored_in").html(prettyPrint(indiumStored));

	$("#o_o_prod_percent_sr").html(strontiumProductionPercent+'%');
	$("#o_o_production_sr").html(shortenBigNumber(strontiumProduction)+' u/h');
	// $("#o_o_stored_sr").html(prettyPrint(strontiumStored));

	$("#o_o_prod_percent_nd").html(neodymiumProductionPercent+'%');
	$("#o_o_production_nd").html(shortenBigNumber(neodymiumProduction)+' u/h');
	// $("#o_o_stored_nd").html(prettyPrint(neodymiumStored));

}

function reRenderOutpostUpgradeAmounts(){
	// make sure these indicators stay updated!

	var i=0;
	for (i=0;i<ad2460.outposts.length ;i++ ){
		var outpost=ad2460.outposts[i];

		var hToUpdate='outpost_upgrade_cost_'+outpost.planet_id+'h';
		var nToUpdate='outpost_upgrade_cost_'+outpost.planet_id+'n';
		var sToUpdate='outpost_upgrade_cost_'+outpost.planet_id+'s';
		var iToUpdate='outpost_upgrade_cost_'+outpost.planet_id+'i';

		if (ad2460.resources.hassium	< ad2460.outpostUpgradeCosts[outpost.level].hassium){	$("#"+hToUpdate).addClass("notenough");	}
		else { $("#"+hToUpdate).removeClass("notenough"); }
		if (ad2460.resources.neodymium	< ad2460.outpostUpgradeCosts[outpost.level].neodymium){	$("#"+nToUpdate).addClass("notenough");	}
		else { $("#"+nToUpdate).removeClass("notenough"); }
		if (ad2460.resources.strontium	< ad2460.outpostUpgradeCosts[outpost.level].strontium){	$("#"+sToUpdate).addClass("notenough");	}
		else { $("#"+sToUpdate).removeClass("notenough"); }
		if (ad2460.resources.indium		< ad2460.outpostUpgradeCosts[outpost.level].indium){	$("#"+iToUpdate).addClass("notenough");	}
		else { $("#"+iToUpdate).removeClass("notenough"); }
	}
}

function reRenderOutpost(planet_id){
	console.log("running reRenderOutpost");
	//var currently_upgrading=false;
	for ( i=0; i<ad2460.outposts.length ; i++ ){
		if (planet_id==ad2460.outposts[i].planet_id){
			renderSingleOutpostPanel(ad2460.outposts[i],i);
		}

		//if (ad2460.outposts[i].upgrading>0)	{
		//	currently_upgrading=true;
		//}
	}
	/*
	if (currently_upgrading==false){
		$('#process_2_progress').css('width','0%');
		$('#process_2_eta').html('');
		$('#process_2_name').html('No outpost is upgrading');
		$('#process_2_colour').hide();
	}
	*/

	updateOutpostOverview();

}

function renderSingleOutpostPanel(outpost,count){
	console.log("returning first in renderSingleOutpostPanel");
	return;

	var paneContainer=document.getElementById('outposts_content');

	var mainContainerClass='main_container quartersize '+ad2460.outpostQuartClasses[count];
	var mainContainerId='outpost_'+count+'_panel';
	// lets try this in stead!
	mainContainerId='outpost_'+outpost.planet_id;

	$("#"+mainContainerId).remove();
	// Deleted!


	var mainContainer=createSingleElement('div', mainContainerClass, mainContainerId, '', '');

	var infoPanel=createSingleElement('div', 'infopanel', 'outpost_infopanel_'+count, '', '');
	var sidePanel=createSingleElement('div', 'sidepanel', 'outpost_sidepanel_'+count, '', '');
	var lowPanel=createSingleElement('div', 'lowpanel', 'outpost_lowpanel_'+count, '', '');
	var mainPanel=createSingleElement('div', 'main_panel outpost darkpanel', 'outpost_mainpanel_'+count, '', '');

	mainContainer.appendChild(infoPanel);
	mainContainer.appendChild(sidePanel);
	mainContainer.appendChild(lowPanel);
	mainContainer.appendChild(mainPanel);

	var fleetDetails=createSingleElement('div', 'outpost_fleet_info', 'outpost_fleetdetails_'+outpost.planet_id, '', '');
	var defenseOverview=createSingleElement('div', 'outpost_defense_overview', 'outpost_fleet_overview_'+outpost.planet_id, '', '');
	fleetDetails.style.display='none'; // hidden

	var infopanelContent=createSingleElement('div', 'infopanel_content', '', '', '');
	infoPanel.appendChild(infopanelContent);
	infopanelContent.appendChild(fleetDetails);
	infopanelContent.appendChild(defenseOverview);

	var mainPanelBG=createSingleElement('div', 'main_panel_bg', '', '', '');
	mainPanel.appendChild(mainPanelBG);
	var mainPanelContent=createSingleElement('div', 'main_panel_content', 'outpost_mainpanel_content_'+count, '', '');
	mainPanel.appendChild(mainPanelContent);

	var outpostMiniInfo=createSingleElement('div', 'outpost_mini_info', '', '', '');

	var total_output=outpost.current_output_hassium+outpost.current_output_neodymium+outpost.current_output_strontium+outpost.current_output_indium;
	var max_output=outpost.max_output_hassium+outpost.max_output_neodymium+outpost.max_output_strontium+outpost.max_output_indium;
	var output_percentage=ad2460.outpostOutputPercentages[outpost.level];

	var total_stored=outpost.stored_hassium+outpost.stored_neodymium+outpost.stored_strontium+outpost.stored_indium;

	var max_storage=return_outpost_storage(outpost.level);
	var stored_percentage=Math.floor(total_stored*100/max_storage);


	var free_storage=max_storage-total_stored;
	var timeToFull=free_storage/total_output;
	//console.log(free_storage, timeToFull, total_stored, total_output);
	var timeToFullString=Math.floor(timeToFull+1)+' hours';
	if (timeToFull==0){
		timeToFullString="Full!";
	}

	var output_percent_hassium=Math.round(outpost.current_output_hassium*100/total_output);
	var output_percent_neodymium=Math.round(outpost.current_output_neodymium*100/total_output);
	var output_percent_strontium=Math.round(outpost.current_output_strontium*100/total_output);
	var output_percent_indium=Math.round(outpost.current_output_indium*100/total_output);


	// Now calc the amount of cargo-space in transport-ships present at the outpost!
	var presentCargoSpace=0;
	var cargoSpaceBonusPercent=returnCargoCapacityBonusPercent();

	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].current_x==outpost.x && ad2460.myFleets[i].current_y==outpost.y && ad2460.myFleets[i].current_mission_target_type==0  && ad2460.myFleets[i].current_mission_target_type==0  && ad2460.myFleets[i].current_mission_target_x==0  && ad2460.myFleets[i].current_mission_target_y==0){
			// The fleet is at the outpost, hooraah!
			var thisFleet=ad2460.myFleets[i];
			var theShips=thisFleet.ships;
			var a=0;
			for (a=0;a<theShips.length ;a++ ){
				presentCargoSpace+=returnCargoCapacity(theShips[a].ship_type_id);
				presentCargoSpace+=Math.floor(presentCargoSpace*cargoSpaceBonusPercent/100)
				presentCargoSpace=presentCargoSpace-theShips[a].h_cargo-theShips[a].n_cargo-theShips[a].s_cargo-theShips[a].i_cargo;
			}
		}
	}


	var miniLevel=createSingleElement('div', 'outpost_mini_info_level', '', 'L'+outpost.level, '');
	var miniTitleHeader=createSingleElement('div', 'outpost_mini_info_title', '', 'Output:', '');
	var miniTitleEntry=createSingleElement('div', 'outpost_mini_info_entry', '', prettyPrint(total_output)+' u/h', '');
	var miniTitleHeader2=createSingleElement('div', 'outpost_mini_info_title', '', 'Utilization:', '');
	var miniTitleEntry2=createSingleElement('div', 'outpost_mini_info_entry', '', output_percentage+' %', '');

	outpostMiniInfo.appendChild(miniLevel);
	outpostMiniInfo.appendChild(miniTitleHeader);
	outpostMiniInfo.appendChild(miniTitleEntry);
	outpostMiniInfo.appendChild(miniTitleHeader2);
	outpostMiniInfo.appendChild(miniTitleEntry2);

	mainPanelContent.appendChild(outpostMiniInfo);

	var outpostImageSource='images/planets/outpost_planets/planettype'+outpost.world_type+'.jpg';

	var outpostImgContainer=createSingleElement('div', 'outpost_img_container', '', '', '');
	var outpostImg=createSingleElement('img', 'outpost_img', '', outpostImageSource, '');

	outpostImgContainer.appendChild(outpostImg);
	mainPanelContent.appendChild(outpostImgContainer);

	var outpostName=createSingleElement('div', 'main_header_title outpost_title', '', outpost.name, '');
	mainPanelContent.appendChild(outpostName);

	var mainHelptextContainer=createSingleElement('div', 'main_helptext helptext_small', '', '', '');
	var mainHelptext=createSingleElement('span', 'textchange', '', 'Click panel to expand', '');

	mainHelptextContainer.appendChild(mainHelptext);
	mainPanelContent.appendChild(mainHelptextContainer);

	var mainPanelDarkPanel=createSingleElement('div', 'main_panel_darkpanel', '', '', '');

	var mainPanelDarkPanelTitle1=createSingleElement('div', 'outpost_dp_title', '', 'Potential:', '');
	var mainPanelDarkPanelTitle2=createSingleElement('div', 'outpost_dp_title', '', 'Operating Capacity:', '');
	var mainPanelDarkPanelTitle3=createSingleElement('div', 'outpost_dp_title', '', 'Total storage:', '');
	var mainPanelDarkPanelTitle4=createSingleElement('div', 'outpost_dp_title', '', 'Stored resources:', '');
	var mainPanelDarkPanelTitle5=createSingleElement('div', 'outpost_dp_title', '', 'Time to max:', '');
	var mainPanelDarkPanelTitle6=createSingleElement('div', 'outpost_dp_title', '', 'Transport present:', '');
	var mainPanelDarkPanelTitle7=createSingleElement('div', 'outpost_dp_title', '', 'Transport-time:', '');

	var potential=return_output_potential(outpost.max_output_hassium+outpost.max_output_neodymium+outpost.max_output_strontium+outpost.max_output_indium);
	//var potential_string=return_output_potential_string(potential);
	var potential_string=potential+'/10';

	//var operating_capacity_percentage=Math.floor();

	var jump_range=1; // For all transport-vessels, will require more advanced calculations if they are tuned to be diffirent!
	var transportTime=calcEta(outpost.x, outpost.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, true, false );
	//var transportTime=returnTravelTimeInMinutes(jump_range, ad2460.homeworld.quadrant, ad2460.homeworld.sector, ad2460.homeworld.cluster, outpost.quadrant, outpost.sector, outpost.cluster);
	//transportTime+=(ad2460.statics.resource_fill_time/60);

	var transportTimeString=secondsToFullTimeNosecs(transportTime);

	var mainPanelDarkPanelEntry1=createSingleElement('div', 'outpost_dp_entry', '', ''+potential_string, '');
	var mainPanelDarkPanelEntry2=createSingleElement('div', 'outpost_dp_entry', '', ''+output_percentage+' %', '');
	var mainPanelDarkPanelEntry3=createSingleElement('div', 'outpost_dp_entry', '', ''+prettyPrint(max_storage), '');
	var mainPanelDarkPanelEntry4=createSingleElement('div', 'outpost_dp_entry', 'outpost_stored_total_'+outpost.planet_id, ''+prettyPrint(total_stored), '');
	var mainPanelDarkPanelEntry5=createSingleElement('div', 'outpost_dp_entry', 'outpost_time_to_max_'+outpost.planet_id, ''+timeToFullString, '');
	var mainPanelDarkPanelEntry6=createSingleElement('div', 'outpost_dp_entry', '', ''+presentCargoSpace, '');
	var mainPanelDarkPanelEntry7=createSingleElement('div', 'outpost_dp_entry', '', ''+transportTimeString, '');

	mainPanelDarkPanel.appendChild(mainPanelDarkPanelTitle1);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelEntry1);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelTitle2);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelEntry2);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelTitle3);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelEntry3);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelTitle4);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelEntry4);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelTitle5);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelEntry5);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelTitle6);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelEntry6);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelTitle7);
	mainPanelDarkPanel.appendChild(mainPanelDarkPanelEntry7);

	var outpostDpTab=createSingleElement('div', 'outpost_dp_tab', '', 'Resource Distribution', '');
	mainPanelDarkPanel.appendChild(outpostDpTab);

	var outpostDpResDistContainer=createSingleElement('div', 'outpost_dp_res_dist', '', '', '');

	var resContainerHassium=createSingleElement('div', 'outpost_dp_res_container', '', '', '');
	var resContainerHassiumImg=createSingleElement('img', 'outpost_dp_res_img', '', 'images/icons/elements/hs42.png', '');
	var resContainerHassiumPct=createSingleElement('div', 'outpost_dp_res_pct', '', '', '');
	var resContainerHassiumPctSpan1=createSingleElement('span', '', '', output_percent_hassium+'%', '');
	var resContainerHassiumPctSpan2=createSingleElement('span', 'resource_speed', '', outpost.current_output_hassium+' u/h', '');
	resContainerHassiumPct.appendChild(resContainerHassiumPctSpan1);
	resContainerHassiumPct.appendChild(resContainerHassiumPctSpan2);
	resContainerHassium.appendChild(resContainerHassiumImg);
	resContainerHassium.appendChild(resContainerHassiumPct);
	var spacerThing=createSingleElement('div', 'outpost_dp_spacer', '', '', '');
	outpostDpResDistContainer.appendChild(resContainerHassium);
	outpostDpResDistContainer.appendChild(spacerThing);

	var resContainerIndium=createSingleElement('div', 'outpost_dp_res_container', '', '', '');
	var resContainerIndiumImg=createSingleElement('img', 'outpost_dp_res_img', '', 'images/icons/elements/in42.png', '');
	var resContainerIndiumPct=createSingleElement('div', 'outpost_dp_res_pct', '', '', '');
	var resContainerIndiumPctSpan1=createSingleElement('span', '', '', output_percent_indium+'%', '');
	var resContainerIndiumPctSpan2=createSingleElement('span', 'resource_speed', '', outpost.current_output_indium+' u/h', '');
	resContainerIndiumPct.appendChild(resContainerIndiumPctSpan1);
	resContainerIndiumPct.appendChild(resContainerIndiumPctSpan2);
	resContainerIndium.appendChild(resContainerIndiumImg);
	resContainerIndium.appendChild(resContainerIndiumPct);
	var spacerThing=createSingleElement('div', 'outpost_dp_spacer', '', '', '');
	outpostDpResDistContainer.appendChild(resContainerIndium);
	outpostDpResDistContainer.appendChild(spacerThing);

	var resContainerStrontium=createSingleElement('div', 'outpost_dp_res_container', '', '', '');
	var resContainerStrontiumImg=createSingleElement('img', 'outpost_dp_res_img', '', 'images/icons/elements/sr42.png', '');
	var resContainerStrontiumPct=createSingleElement('div', 'outpost_dp_res_pct', '', '', '');
	var resContainerStrontiumPctSpan1=createSingleElement('span', '', '', output_percent_strontium+'%', '');
	var resContainerStrontiumPctSpan2=createSingleElement('span', 'resource_speed', '', outpost.current_output_strontium+' u/h', '');
	resContainerStrontiumPct.appendChild(resContainerStrontiumPctSpan1);
	resContainerStrontiumPct.appendChild(resContainerStrontiumPctSpan2);
	resContainerStrontium.appendChild(resContainerStrontiumImg);
	resContainerStrontium.appendChild(resContainerStrontiumPct);
	var spacerThing=createSingleElement('div', 'outpost_dp_spacer', '', '', '');
	outpostDpResDistContainer.appendChild(resContainerStrontium);
	outpostDpResDistContainer.appendChild(spacerThing);

	var resContainerNeodymium=createSingleElement('div', 'outpost_dp_res_container', '', '', '');
	var resContainerNeodymiumImg=createSingleElement('img', 'outpost_dp_res_img', '', 'images/icons/elements/nd42.png', '');
	var resContainerNeodymiumPct=createSingleElement('div', 'outpost_dp_res_pct', '', '', '');
	var resContainerNeodymiumPctSpan1=createSingleElement('span', '', '', output_percent_neodymium+'%', '');
	var resContainerNeodymiumPctSpan2=createSingleElement('span', 'resource_speed', '', outpost.current_output_neodymium+' u/h', '');
	resContainerNeodymiumPct.appendChild(resContainerNeodymiumPctSpan1);
	resContainerNeodymiumPct.appendChild(resContainerNeodymiumPctSpan2);
	resContainerNeodymium.appendChild(resContainerNeodymiumImg);
	resContainerNeodymium.appendChild(resContainerNeodymiumPct);
	var spacerThing=createSingleElement('div', 'outpost_dp_spacer', '', '', '');
	outpostDpResDistContainer.appendChild(resContainerNeodymium);

	mainPanelDarkPanel.appendChild(outpostDpResDistContainer);

	mainPanelContent.appendChild(mainPanelDarkPanel);


	var extendedContentContainer=createSingleElement('div', 'main_panel_extended_content', '', '', '');
	var outpostCoords=createSingleElement('div', 'outpost_coords', '', '['+outpost.quadrant+':'+outpost.sector+':'+outpost.cluster+':'+outpost.system+':'+outpost.position+']', "zoomInTo("+outpost.quadrant+","+outpost.sector+","+outpost.cluster+","+outpost.system+","+parseInt(outpost.position,10)+")");
	var currentResources=createSingleElement('div', '', '', 'Current resources', '');
	var outpostLevels=createSingleElement('div', 'outpost_levels', '', '', '');
	var resLevelHassium=createSingleElement('div', 'resouce_level hs_level', 'outpost_stored_hs_'+outpost.planet_id, prettyPrint(outpost.stored_hassium), '');
	var resLevelStrontium=createSingleElement('div', 'resouce_level sr_level', 'outpost_stored_sr_'+outpost.planet_id, prettyPrint(outpost.stored_strontium), '');
	var resLevelNeodymium=createSingleElement('div', 'resouce_level nd_level', 'outpost_stored_nd_'+outpost.planet_id, prettyPrint(outpost.stored_neodymium), '');
	var resLevelIndium=createSingleElement('div', 'resouce_level in_level', 'outpost_stored_in_'+outpost.planet_id, prettyPrint(outpost.stored_indium), '');

	outpostLevels.appendChild(resLevelHassium);
	outpostLevels.appendChild(resLevelStrontium);
	outpostLevels.appendChild(resLevelNeodymium);
	outpostLevels.appendChild(resLevelIndium);

	extendedContentContainer.appendChild(outpostCoords);
	extendedContentContainer.appendChild(currentResources);
	extendedContentContainer.appendChild(outpostLevels);

	mainPanelContent.appendChild(extendedContentContainer);

	var centerSlideInside=createSingleElement('div', 'centerslide_inside', '', '', '');
	var insideSlide=createSingleElement('div', 'insideslide', '', '', '');
	var slideImgSrc="images/tiles/outpostcornerinside0.png";
	var slideImgClass="zerofill";
	if (stored_percentage<10){			slideImgSrc="images/tiles/outpostcornerinside0.png";	slideImgClass="zerofill";	}
	else if (stored_percentage<30){		slideImgSrc="images/tiles/outpostcornerinside20.png";	slideImgClass="twentyfill";}
	else if (stored_percentage<50){		slideImgSrc="images/tiles/outpostcornerinside40.png";	slideImgClass="fortyfill";}
	else if (stored_percentage<70){		slideImgSrc="images/tiles/outpostcornerinside60.png";	slideImgClass="sixtyfill";}
	else if (stored_percentage<90){		slideImgSrc="images/tiles/outpostcornerinside80.png";	slideImgClass="eightyfill";}
	else							{	slideImgSrc="images/tiles/outpostcornerinside100.png";	slideImgClass="hundredfill";}

	var slideImg=createSingleElement('img', slideImgClass, 'outpost_fill_image_'+outpost.planet_id, slideImgSrc, '');

	centerSlideInside.appendChild(insideSlide);
	insideSlide.appendChild(slideImg);

	mainPanel.appendChild(centerSlideInside);

	var mainBorderTopRight=createSingleElement('div', 'mainborder_topright_outpost', '', '', '');
	var mainBorderRight=createSingleElement('div', 'mainborder_right_outpost', '', '', '');
	var centerSlideContainer=createSingleElement('div', 'centerslide_container', '', '', '');

	var centerSlideHigh=createSingleElement('div', 'centerslide_high_outpost', '', '', '');
	var centerSlideLow=createSingleElement('div', 'centerslide_low_outpost', '', '', '');
	var centerSlideMid=createSingleElement('div', 'centerslide_mid_outpost', '', '', '');

	centerSlideContainer.appendChild(centerSlideHigh);
	centerSlideContainer.appendChild(centerSlideLow);
	centerSlideContainer.appendChild(centerSlideMid);

	var mainBorderBottom=createSingleElement('div', 'mainborder_bottom_outpost', '', '', '');
	var mainBorderBottomRight=createSingleElement('div', 'mainborder_bottomright_outpost', '', '', '');

	var activeImg;
	if (stored_percentage<100){
		activeImg=createSingleElement('img', 'activeOutpost', 'outpost_status_corner_image'+outpost.planet_id, 'images/tiles/panelborders/bottomright.png', '');
	}
	else {
		activeImg=createSingleElement('img', 'inactiveOutpost', 'outpost_status_corner_image'+outpost.planet_id, 'images/tiles/panelborders/bottomrightoff.png', '');
	}

	if (outpost.upgrading>0){
		activeImg=createSingleElement('img', 'inactiveOutpost', 'outpost_status_corner_image'+outpost.planet_id, 'images/tiles/panelborders/bottomrightpaused.png', '');
	}

	var mainBorderBottomExtended=createSingleElement('div', 'mainborder_bottomextended_outpost', '', '', '');
	var mainBorderBottomLeft=createSingleElement('div', 'mainborder_bottomleft_outpost', '', '', '');

	mainBorderBottomRight.appendChild(activeImg);

	mainPanel.appendChild(mainBorderTopRight);
	mainPanel.appendChild(mainBorderRight);
	mainPanel.appendChild(centerSlideContainer);
	mainPanel.appendChild(mainBorderBottom);
	mainPanel.appendChild(mainBorderBottomRight);
	mainPanel.appendChild(mainBorderBottomExtended);
	mainPanel.appendChild(mainBorderBottomLeft);

	// And now, the sidepanel!
	var sidepanelBG=createSingleElement('div', 'sidepanel_bg', '', '', '');
	var sidepanelContent=createSingleElement('div', 'sidepanel_content', '', '', '');
	sidePanel.appendChild(sidepanelBG);
	sidePanel.appendChild(sidepanelContent);

	// Then add the content
	var outpostPictureContainer=createSingleElement('div', 'outpost_portrait', '', '', '');
	// Add support for different pictures here when the graphics is ready
	var imgSrc="images/fixed/outpostportrait200x200.jpg";
	if (outpost.level<4){
		imgSrc="images/fixed/outpost_lvl_1_3.jpg";
	}
	else if (outpost.level<7){
		imgSrc="images/fixed/outpost_lvl_4_6.jpg";
	}
	else if (outpost.level<11){
		imgSrc="images/fixed/outpost_lvl_7_9.jpg";
	}
	var outpostPicture=createSingleElement('img', '', '', imgSrc, '');
	outpostPictureContainer.appendChild(outpostPicture);
	sidepanelContent.appendChild(outpostPictureContainer);

	var typeTab=createSingleElement('div', 'selected_outpost_typetab', '', '', '');
	var outpostName=outpost.name;
	var typeTabName=createSingleElement('div', 'selected_item_name outpost_name', 'oname_'+outpost.planet_id, outpostName, '');
	typeTabName.contentEditable = true;
	typeTabName.spellcheck = false;
/*
	typeTabName.onkeypress=function(event){
		if (event.which==13 || event.keyCode==13) {
			updateOutpostName(this.innerText, this.id);
			//console.log(this.innerText, this.id);
			typeTabName.blur();
			return false;
		}
	}
*/
	// Lets get creative here


	typeTabName.onkeydown=function(event){
		if (event.which!=8 && event.keyCode!=8 && event.which!=16 && event.keyCode!=16 && event.which!=37 && event.keyCode!=37 && event.which!=38 && event.keyCode!=38 && event.which!=39 && event.keyCode!=39 && event.which!=40 && event.keyCode!=40 && event.which!=46 && event.keyCode!=46 && event.which!=36 && event.keyCode!=36 && event.which!=35 && event.keyCode!=35 ) {
			if (event.srcElement.innerHTML.length>16){
				//console.log("It's 16 long, stop !!!");
				event.preventDefault;
				return false;
			}
		}
		if (event.which==13 || event.keyCode==13) {
			event.preventDefault;
		}
	}

	typeTabName.onkeypress=function(event){
		if (event.which==13 || event.keyCode==13) {
			if (event.srcElement.innerHTML.length>3){
				console.log(event.srcElement.id);
				updateOutpostName(event.srcElement.innerHTML, event.srcElement.id);
				event.srcElement.blur();
				return false;
			}
			else {
				systemFeedback('Error','Too short!', 1, 3);
				var o=returnOutpostByPlanetId(ad2460.selected_outpost_planet_id);
				updateOutpostName(o.name, event.srcElement.id);
				return false;
			}
		}
	}


	typeTab.appendChild(typeTabName);
	sidepanelContent.appendChild(typeTab);

	var abandonContainer=createSingleElement('div', 'selected_outpost_abandon', '', '', '');
	var buttonContainer=createSingleElement('div', 'fixed_button fixed_button_140_condensed', 'outpost_abandon_button', '', 'showConfirmationPopup("Are you sure you wish to abandon this outpost? Any defending units will be obliterated along with the outpost so you might want to move any such units to another outpost.","Yes","No","abandonOutpostClick('+outpost.planet_id+');hideConfirmationPopup();")');

	var buttonRegular=createSingleElement('div', 'fixed_button_regular_condensed', '', '', '');
	var buttonHover=createSingleElement('div', 'fixed_button_hover red22', '', '', '');
	var buttonClick=createSingleElement('div', 'fixed_button_click red22', '', '', '');
	var buttonText=createSingleElement('div', 'dyna_button_text type3', '', 'Abandon', '');

	abandonContainer.appendChild(buttonContainer);
	buttonContainer.appendChild(buttonRegular);
	buttonContainer.appendChild(buttonHover);
	buttonContainer.appendChild(buttonClick);
	buttonContainer.appendChild(buttonText);

	sidepanelContent.appendChild(abandonContainer);

	var prepareTransportContainer=createSingleElement('div', 'selected_outpost_actionstab', '', '', '');
	var buttonContainer=createSingleElement('div', 'fixed_button fixed_button_160_double', 'transportoptionsbutton', '', 'prepareTransportClick('+outpost.planet_id+')');
	var buttonRegular=createSingleElement('div', 'fixed_button_regular_double', '', '', '');
	var buttonHover=createSingleElement('div', 'fixed_button_hover blue_double', '', '', '');
	var buttonClick=createSingleElement('div', 'fixed_button_click blue_double', '', '', '');
	var buttonText=createSingleElement('div', 'dyna_button_text type3', '', 'Prepare Transport', '');

	prepareTransportContainer.appendChild(buttonContainer);
	buttonContainer.appendChild(buttonRegular);
	buttonContainer.appendChild(buttonHover);
	buttonContainer.appendChild(buttonClick);
	buttonContainer.appendChild(buttonText);

	sidepanelContent.appendChild(prepareTransportContainer);

	var selectedOutpostCurrentInfo=createSingleElement('div', 'selected_outpost_current_info', '', '', '');
	var currentProductionHeader=createSingleElement('div', 'selected_outpost_stat', '', 'Current Production:', '');
	var unknownThing=createSingleElement('div', 'selected_outpost_statvalue', '', '', '');

	sidepanelContent.appendChild(selectedOutpostCurrentInfo);
	selectedOutpostCurrentInfo.appendChild(currentProductionHeader);
	selectedOutpostCurrentInfo.appendChild(unknownThing);

	var p=0;
	var tempArray=new Array;
	tempArray.push("first");
	tempArray.push("second");
	tempArray.push("third");
	tempArray.push("fourth");
	var nextValues=returnNextOutpostProductionOutput(outpost);

	var next_output_percentage=100;
	if (outpost.level<10){
		//console.log(nextValues);
		next_output_percentage=Math.floor((nextValues.hassiumAmount+nextValues.neodymiumAmount+nextValues.strontiumAmount+nextValues.indiumAmount)*100/max_output);
	}


	for (p=0;p<4 ;p++ ){

		var current_prod_value=outpost.current_output_hassium+' u/h';
		var next_prod_value=nextValues.hassium;

		if (p==1){
			current_prod_value=outpost.current_output_indium+' u/h';
			next_prod_value=nextValues.indium;
		}
		if (p==2){
			current_prod_value=outpost.current_output_strontium+' u/h';
			next_prod_value=nextValues.strontium;
		}
		if (p==3){
			current_prod_value=outpost.current_output_neodymium+' u/h';
			next_prod_value=nextValues.neodymium;
		}

		var elmBox=createSingleElement('div', 'outpost_element_box '+tempArray[p], '', '', '');
		var outpostElmProd=createSingleElement('div', 'outpost_element_prod', '', '', '');
		var outpostElmQuantity=createSingleElement('div', 'outpost_element_quantity', '', '', '');

		var amountTextShade=createSingleElement('div', 'px12shade', '', current_prod_value, '');
		var amountText=createSingleElement('div', 'px12quantity', '', current_prod_value, '');

		selectedOutpostCurrentInfo.appendChild(elmBox);
		elmBox.appendChild(outpostElmProd);
		elmBox.appendChild(outpostElmQuantity);
		outpostElmQuantity.appendChild(amountTextShade);
		outpostElmQuantity.appendChild(amountText);

		if (outpost.level<10){
			var elmUpgraded=createSingleElement('div', 'outpost_element_upgraded '+tempArray[p], '', '', '');
			var amountTextShade=createSingleElement('div', 'px12shade', '', next_prod_value, '');
			var amountText=createSingleElement('div', 'px12quantity', '', next_prod_value, '');

			selectedOutpostCurrentInfo.appendChild(elmUpgraded);
			elmUpgraded.appendChild(amountTextShade);
			elmUpgraded.appendChild(amountText);

		}
	}

	var upgradeTime=returnOutpostUpgradeTime(outpost);
	var upgradeTimeString='N/A';
	if (upgradeTime>0){
		upgradeTimeString=secondsToFullTimeNosecs(upgradeTime);
	}

	var maskDown=createSingleElement('div', 'selected_outpost_maskdown', '', '', '');
	var upgradeTitle=createSingleElement('div', 'selected_outpost_upgradetitle', '', 'Next Level', '');
	var maskUp=createSingleElement('div', 'selected_outpost_maskup', '', '', '');
	var upgradeInfoContainer=createSingleElement('div', 'selected_outpost_upgrade_info', '', '', '');
	var upgradeInfoStorageHeader=createSingleElement('div', 'selected_outpost_stat', '', 'Total Storage:', '');
	var upgradeInfoStorageValue=createSingleElement('div', 'selected_outpost_statvalue', '', ad2460.outpostStorageLevels[outpost.level+1], '');
	var upgradeInfoCapacityHeader=createSingleElement('div', 'selected_outpost_stat', '', 'New Operating Capacity:', '');
	var upgradeInfoCapacityValue=createSingleElement('div', 'selected_outpost_statvalue', '', next_output_percentage+'%', '');
	var upgradeInfoTimeHeader=createSingleElement('div', 'selected_outpost_stat', '', 'Upgrade-time:', '');
	var upgradeInfoTimeValue=createSingleElement('div', 'selected_outpost_statvalue', '', upgradeTimeString, '');

	var upgradeCostButtonContainer=createSingleElement('div', 'costfield outpost_upgrade_cost', 'outpostcost', '', '');
	var upgradeCostButton=createSingleElement('div', 'costbutton', 'upgradeoutpostbutton_'+outpost.planet_id, '', 'upgradeOutpostClick('+outpost.planet_id+')');
	var initiateButton=createSingleElement('div', 'initiatebutton', '', '', '');
	var initiateButtonHover=createSingleElement('div', 'initiatebuttonhover', '', '', '');
	var buttonText=createSingleElement('div', 'buttontext costtext', '', 'Upgrade', '');

	var HextraClassName=''; var NextraClassName=''; var SextraClassName=''; var IextraClassName='';
	if (ad2460.resources.hassium<ad2460.outpostUpgradeCosts[outpost.level].hassium){	HextraClassName='notenough';	}
	if (ad2460.resources.neodymium<ad2460.outpostUpgradeCosts[outpost.level].neodymium){	NextraClassName='notenough';	}
	if (ad2460.resources.strontium<ad2460.outpostUpgradeCosts[outpost.level].strontium){	SextraClassName='notenough';	}
	if (ad2460.resources.indium<ad2460.outpostUpgradeCosts[outpost.level].indium){	IextraClassName='notenough';	}

	var hUpgradeCostId='outpost_upgrade_cost_'+outpost.planet_id+'h';
	var nUpgradeCostId='outpost_upgrade_cost_'+outpost.planet_id+'n';
	var sUpgradeCostId='outpost_upgrade_cost_'+outpost.planet_id+'s';
	var iUpgradeCostId='outpost_upgrade_cost_'+outpost.planet_id+'i';


	var hsCost=createSingleElement('div', 'hscost '+HextraClassName, hUpgradeCostId, prettyPrint(ad2460.outpostUpgradeCosts[outpost.level].hassium), '');
	var ndCost=createSingleElement('div', 'ndcost '+NextraClassName, nUpgradeCostId, prettyPrint(ad2460.outpostUpgradeCosts[outpost.level].neodymium), '');
	var srCost=createSingleElement('div', 'srcost '+SextraClassName, sUpgradeCostId, prettyPrint(ad2460.outpostUpgradeCosts[outpost.level].strontium), '');
	var inCost=createSingleElement('div', 'incost '+IextraClassName, iUpgradeCostId, prettyPrint(ad2460.outpostUpgradeCosts[outpost.level].indium), '');

	if (outpost.upgrading==1){
		buttonText.innerHTML='Cancel Upgrade';
		hsCost.innerHTML='-';
		ndCost.innerHTML='-';
		srCost.innerHTML='-';
		inCost.innerHTML='-';
		upgradeCostButton.className='disablebutton';
		upgradeCostButton.style.display='block';
		//upgradeCostButton.onclick='cancelUpgrade('+outpost.planet_id+')';
		upgradeCostButton.setAttribute('onclick','cancelUpgrade('+outpost.planet_id+')');
		var timerId='currentOutpostUpgradeTimer';
		var new_level=outpost.level+1;
		$("#process_2_name").html(outpost.name+' upgrading to L '+new_level);
		$('#process_2_colour').show();
		registerNewTimer(timerId, ['process_2_eta'], ['process_2_progress'], outpost.upgrade_started_timestamp, outpost.upgrade_complete_timestamp, function(){fetchOwnOutposts();});
	}

	if (outpost.upgrading==0){
		// If this one is NOT upgrading, but other are, catch it!
		var o=0;
		var otherUpgrading=false;
		for (o=0;o<ad2460.outposts.length ;o++ ){
			if (ad2460.outposts[o].upgrading==1){
				otherUpgrading=true;
			}
		}

		if (otherUpgrading==true){
			buttonText.innerHTML='Busy';
			upgradeCostButton.className='disablebutton';
			upgradeCostButton.style.display='block';
			upgradeCostButton.onclick='';

		}

	}

	sidepanelContent.appendChild(maskDown);

	if (outpost.level<10){
		sidepanelContent.appendChild(upgradeTitle);
		sidepanelContent.appendChild(maskUp);
		sidepanelContent.appendChild(upgradeInfoContainer);
		upgradeInfoContainer.appendChild(upgradeInfoStorageHeader);
		upgradeInfoContainer.appendChild(upgradeInfoStorageValue);
		upgradeInfoContainer.appendChild(upgradeInfoCapacityHeader);
		upgradeInfoContainer.appendChild(upgradeInfoCapacityValue);
		upgradeInfoContainer.appendChild(upgradeInfoTimeHeader);
		upgradeInfoContainer.appendChild(upgradeInfoTimeValue);

		sidepanelContent.appendChild(upgradeCostButtonContainer);
		upgradeCostButtonContainer.appendChild(upgradeCostButton);
		upgradeCostButton.appendChild(initiateButton);
		upgradeCostButton.appendChild(initiateButtonHover);
		upgradeCostButton.appendChild(buttonText);
		upgradeCostButtonContainer.appendChild(hsCost);
		upgradeCostButtonContainer.appendChild(ndCost);
		upgradeCostButtonContainer.appendChild(srCost);
		upgradeCostButtonContainer.appendChild(inCost);
	}



	// And the borders...
	var sideBorderTopRight=createSingleElement('div', 'sideborder_topright', '', '', '');
	var sideBorderRight=createSingleElement('div', 'sideborder_right', '', '', '');
	var sideBorderBottomRight=createSingleElement('div', 'sideborder_bottomright', '', '', '');
	var sideBorderBottom=createSingleElement('div', 'sideborder_bottom', '', '', '');
	var sideBorderBottomExtended=createSingleElement('div', 'sideborder_bottomextended', '', '', '');

	sidePanel.appendChild(sideBorderTopRight);
	sidePanel.appendChild(sideBorderRight);
	sidePanel.appendChild(sideBorderBottomRight);
	sidePanel.appendChild(sideBorderBottom);
	sidePanel.appendChild(sideBorderBottomExtended);


	// Then the lowPanel
	var lowPanelBG=createSingleElement('div', 'lowpanel_bg', '', '', '');
	lowPanelBG.style.bottom="6px";
	lowPanel.appendChild(lowPanelBG);

	var lowPanelBGb1=createSingleElement('div', 'lowborder_right', '', '', '');
	var lowPanelBGb2=createSingleElement('div', 'lowborder_bottomright', '', '', '');
	var lowPanelBGb3=createSingleElement('div', 'lowborder_bottomleft', '', '', '');
	var lowPanelBGb4=createSingleElement('div', 'lowborder_bottom', '', '', '');

	lowPanel.appendChild(lowPanelBGb1);
	lowPanel.appendChild(lowPanelBGb2);
	lowPanel.appendChild(lowPanelBGb3);
	lowPanel.appendChild(lowPanelBGb4);

	var lowPanelContent=createSingleElement('div', 'lowpanel_content', '', '', '');
	lowPanelBG.appendChild(lowPanelContent);

	var lowPanelHeader=createSingleElement('div', 'lowpanel_header', '', 'Defensive fleets', '');
	lowPanelContent.appendChild(lowPanelHeader);

	var lowPanelTable=createSingleElement('div', 'lowpanel_table', '', '', '');
	lowPanelContent.appendChild(lowPanelTable);

	var lowPanelTableBorderwrapper=createSingleElement('div', 'lowpanel_table_borderwrapper scrollBG', '', '', '');
	lowPanelTable.appendChild(lowPanelTableBorderwrapper);

	var idForDataStorage='outpost_fleets_container_'+outpost.planet_id;

	var lowPanelTableContentlist=createSingleElement('div', 'lowpanel_table_contentlist footer lowpanel_scroll_content', idForDataStorage, '', '');
	lowPanelTableBorderwrapper.appendChild(lowPanelTableContentlist);
	// The content to be placed in here will be added by another function to allow for easy updating of these fleets
	// the ID to update is outpost_fleets_container_PLANETID


	// Keep going with the lowtable static content
	// lowPanelTableBorderwrapper is the parent now

	var lowPanelTableHeaders=createSingleElement('div', 'lowpanel_table_headers', '', '', '');

	var tableFleetName=createSingleElement('div', 'table_fleet_name outpost', '', 'Fleet-name', '');
	var tableFleetType=createSingleElement('div', 'table_fleet_type', '', '', '');
	var tableFleetSize=createSingleElement('div', 'table_fleet_size', '', 'Size', '');
	var tableFleetStrength=createSingleElement('div', 'table_fleet_strength', '', 'Power', '');

	lowPanelTableHeaders.appendChild(tableFleetName);
	lowPanelTableHeaders.appendChild(tableFleetType);
	lowPanelTableHeaders.appendChild(tableFleetSize);
	lowPanelTableHeaders.appendChild(tableFleetStrength);

	lowPanelTableBorderwrapper.appendChild(lowPanelTableHeaders);

	var tableFootersDefOverview=createSingleElement('div', 'lowpanel_table_footers def_overview', '', '', 'showOutpostDefensiveOverview('+outpost.planet_id+')');
	var tableFooterBG=createSingleElement('div', 'lowpanel_table_footer_bg', '', '', '');
	var tableFooterTitle=createSingleElement('div', 'lowpanel_table_footer_title', '', 'Defensive Overview and Tactics', '');
	tableFootersDefOverview.appendChild(tableFooterBG);
	tableFootersDefOverview.appendChild(tableFooterTitle);
	lowPanelTableBorderwrapper.appendChild(tableFootersDefOverview);


	var lowTBleft=createSingleElement('div', 'tableborderleft', '', '', '');
	var lowTBright=createSingleElement('div', 'tableborderright', '', '', '');
	var lowTBbottom=createSingleElement('div', 'tableborderbottom', '', '', '');
	var lowTBtop=createSingleElement('div', 'tablebordertop', '', '', '');

	var lowTBtopleft=createSingleElement('div', 'tablebordertopleft', '', '', '');
	var lowTBtopright=createSingleElement('div', 'tablebordertopright', '', '', '');
	var lowTBbottomleft=createSingleElement('div', 'tableborderbottomleft', '', '', '');
	var lowTBbottomright=createSingleElement('div', 'tableborderbottomright', '', '', '');

	lowPanelTableBorderwrapper.appendChild(lowTBleft);
	lowPanelTableBorderwrapper.appendChild(lowTBright);
	lowPanelTableBorderwrapper.appendChild(lowTBbottom);
	lowPanelTableBorderwrapper.appendChild(lowTBtop);

	lowPanelTableBorderwrapper.appendChild(lowTBtopleft);
	lowPanelTableBorderwrapper.appendChild(lowTBtopright);
	lowPanelTableBorderwrapper.appendChild(lowTBbottomleft);
	lowPanelTableBorderwrapper.appendChild(lowTBbottomright);

	var scrollButtons=createSingleElement('div', 'scrollbuttons', '', '', '');
	var buttonDown=createSingleElement('div', 'scrollbutton_down', idForDataStorage+'_up', '', 'myScroll("'+idForDataStorage+'",181,500,"scrollBG")');
	var buttonUp=createSingleElement('div', 'scrollbutton_up', idForDataStorage+'_down', '', 'myScroll("'+idForDataStorage+'",181,500,"scrollBG")');

	scrollButtons.appendChild(buttonUp);
	scrollButtons.appendChild(buttonDown);
	lowPanelTable.appendChild(scrollButtons);


	var lowTipHolder=createSingleElement('div', 'lowpanel_uitip_holder', '', '', '');
	var lowTip=createSingleElement('div', 'lowpanel_uitip', '', 'Click on a fleet name to view details.', '');

	lowTipHolder.appendChild(lowTip);
	lowPanelContent.appendChild(lowTipHolder);


	// Attaching to the outposts-pane
	paneContainer.appendChild(mainContainer);

	populateOutpostFleets(outpost);

	populateOutpostDefensiveOverview(outpost);

}

function populateOutpostDefensiveOverview(outpost){
	var x=outpost.x;
	var y=outpost.y;
	var planet_id=outpost.planet_id;

	// Required variables to fill in
	var summary_total_fleets=0;
	var summary_ship_count=0;
	var summary_firepower=0;
	var summary_minors=0;
	var summary_strength=0;
	var summary_defenses=0;
	var summary_tech_tilt="Neutral";
	var summary_allied_fleets=0;
	var summary_max_fleets=0;

	// Used for finding the total techtilt...
	var matterCount=0;
	var energyCount=0;
	var displacementCount=0;

	// Cheating!!!
	var highest_ranking_commander=new commander(0, 0, 0, "N/A", "N/A", 0, 0, 0, 0, 0, 0, 0, 0, 0, "Male", 0);

	var i=0;
	// Remember top add support for alliance-fleets here later when they are ready!
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].current_x==x && ad2460.myFleets[i].current_y==y){
			var thisFleet=ad2460.myFleets[i];

			for (var m =0; m<thisFleet.ships.length; m++) {
				if (thisFleet.ships[m].ship_type_id<=410) {
					summary_minors++;
				}
			};
			summary_total_fleets++;
			summary_ship_count+=thisFleet.shipcount;
			summary_strength+=thisFleet.strength;
			summary_firepower+=returnFleetFirepower(thisFleet);
			summary_defenses+=returnFleetHullstrength(thisFleet);
			summary_allied_fleets+=thisFleet.alliance_fleet;
			var ship=0;
			for (ship=0;ship<thisFleet.ships.length ;ship++ ){
				var id=thisFleet.ships[ship].ship_type_id;
				if (id==411 || id==414 || id==417 || id==420 || id==423 || id==424 || id==437 || id==501 || id==504 || id==507 || id==510 || id==513  ){
					matterCount++;
				}
				else if (id==412 || id==415 || id==418 || id==421 || id==425 || id==426 || id==427 || id==502 || id==505 || id==508 || id==511 || id==514  ){
					energyCount++;
				}
				else if (id==413 || id==416 || id==419 || id==422 || id==428 || id==429 || id==503 || id==506 || id==509 || id==512 || id==515  ){
					displacementCount++;
				}
			}
			if (thisFleet.commander!=null){
				if (thisFleet.commander.rank>-1){
					if (thisFleet.commander.rank>highest_ranking_commander.rank){
						highest_ranking_commander=thisFleet.commander;
					}
				}
			}
		}
	}

	if (matterCount>energyCount && matterCount>displacementCount){
		summary_tech_tilt='InTech';
	}
	else if (energyCount>matterCount && energyCount>displacementCount){
		summary_tech_tilt='StronTech';
	}
	else if (displacementCount>energyCount && displacementCount>matterCount){
		summary_tech_tilt='NeoTech';
	}
	else {
		summary_tech_tilt='Neutral';
	}

	//var cmdImages=returnCommanderGraphics(highest_ranking_commander);
	var cmdImages=returnOutpostCommanderGraphics(outpost)
	//console.log(highest_ranking_commander);
	//console.log(cmdImages);
	var rankObject=returnCommanderRankNameObject(outpost.returnCommanderRank());
	var name='Outpost Defense';
	$("#selected_outpost_commander_background").attr("src",cmdImages.bgImage);
	$("#selected_outpost_commander_uniform").attr("src",cmdImages.uniformImage);
	$("#selected_outpost_commander_head").attr("src",cmdImages.headImage);
	$("#selected_outpost_commander_name").html(returnShortName(name));
	$("#selected_outpost_commander_rank").html(rankObject.shortRank);
	if (rankObject.rank>0 && rankObject.rank<10){
		$("#selected_outpost_commander_rank_image").attr("src","images/icons/insignias/rank0"+rankObject.rank+".png").show();
	}
	else if (rankObject.rank==10){
		$("#selected_outpost_commander_rank_image").attr("src","images/icons/insignias/rank"+rankObject.rank+".png").show();
	}
	else {
		$("#selected_outpost_commander_rank_image").hide();
	}

	$("#selected_outpost_commander_stat_personality").html('Veteran');
	$("#selected_outpost_commander_stat_commanding").html("50");
	$("#selected_outpost_commander_stat_perception").html("50");
	$("#selected_outpost_commander_stat_tactics").html("50");
	$("#selected_outpost_commander_stat_morale").html("50");
	$("#selected_outpost_commander_stat_experience").html("0");

	$("#selected_outpost_commander_stat_ship_limit").html(returnShipLimit(rankObject.rank));
	$("#selected_outpost_commander_stat_fleet_limit").html(ad2460.commander_max_fleets[rankObject.rank]);

	$("#selected_outpost_total_fleets").html(summary_total_fleets);
	$("#selected_outpost_ship_count").html(summary_ship_count);
	$("#selected_outpost_minors_count").html(summary_minors);

	$("#selected_outpost_firepower").html(prettyPrint(summary_strength));
	//$("#selected_outpost_defenses").html(summary_defenses);
	$("#selected_outpost_total_techtilt").html(summary_tech_tilt);
	//$("#selected_outpost_allied_fleets").html(summary_allied_fleets);
	//$("#selected_outpost_max_fleets").html(summary_max_fleets);

}

function outpostDefensiveCommanderPanelClick(planet_id){

	var rowheight = 28;
	var itemheight = 150;
   	var itemdisplace = 0;
	var itemdisplaceleft = -210;
	var itemdisplaceright = 0;

	var tableid="selected_commander_outpost_"+planet_id;
	var tableid="selected_outpost_commander";

	if (document.getElementById(tableid).style.left=="0px" || document.getElementById(tableid).style.left==""){
		expandSelectedRow(tableid, itemheight, itemdisplace,itemdisplaceleft, itemdisplaceright);
		ad2460.outpostVars.fleet_overview_commander_open=true;
	}
	else {
		tableid="selected_outpost_commander";
		//element=$("#"+tableid+"");
		//rowheight = 150;
		minimizeSelectedRow(tableid,rowheight);
		ad2460.outpostVars.fleet_overview_commander_open=false;
	}
}

function outpostTacticsPanelClick(planet_id){
	// console.log("running outpostTacticsPanelClick");

	//var element=$("outpost_tac_simple_"+planet_id);
	var rowheight = 28;
	var itemheight = 150;
   	var itemdisplace = 0;
	var itemdisplaceleft = -210;
	var itemdisplaceright = 0;

	var tableid="outpost_tac_simple_"+planet_id;
	if (document.getElementById(tableid).style.height=="154px" || document.getElementById(tableid).style.height==""){
		expandSelectedRow(tableid, itemheight, itemdisplace,itemdisplaceleft, itemdisplaceright);
		ad2460.outpostVars.fleet_overview_tactics_open=true;
	}
	else {
		tableid="outpost_tac_simple_"+planet_id;
		//element=$("#"+tableid+"");
		//rowheight = 150;
		minimizeSelectedRow(tableid,rowheight);
		ad2460.outpostVars.fleet_overview_tactics_open=false;
	}
}

function populateOutpostFleets(outpost){
	var x=outpost.x;
	var y=outpost.y;
	var planet_id=outpost.planet_id;

	var parentContainer=document.getElementById('selected_outpost_fleets_container');
	removeChildNodes('selected_outpost_fleets_container');

	//console.log("populating outpost fleets");

	// Render the fleets present at the outpost
	// They could be mine, and they could belong to alliance-buddies
	// We will deal with my own ones right now, as they require no server-data, we already have them in ad2460.myFleets
	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		//console.log("checking x VS "+ad2460.myFleets[i].current_x+" and y VS "+ad2460.myFleets[i].current_y);
		if (ad2460.myFleets[i].current_x==x && ad2460.myFleets[i].current_y==y){
			//console.log("Match found");
			var thisFleet=ad2460.myFleets[i];

			var minor_count=0;
			var m=0;
			for (m=0;m<thisFleet.ships.length;m++){
				if (thisFleet.ships[m].ship_type_id<=410){
					minor_count++;
				}
			}

			var fleetContainer=document.createElement('div');
			var fleetNameContainer=document.createElement('div');
			var fleetTypeContainer=document.createElement('div');
			var fleetTypeImage=document.createElement('img');

			//var fleetLocationContainer=document.createElement('div');
			var fleetSizeContainer=document.createElement('div');
			var fleetMinorsContainer=document.createElement('div');
			var fleetStrengthContainer=document.createElement('div');

			var main_class='tableselection';
			if (i % 2 == 0){
				main_class+=' evenline';
			}
			else {
				main_class+=' oddline';
			}

			fleetContainer.setAttribute("class",main_class);
			fleetContainer.setAttribute("id","fleetline_"+thisFleet.fleet_id);
			fleetNameContainer.setAttribute("class","table_fleet_name outpost");
			fleetTypeContainer.setAttribute("class","table_fleet_type outpost");
			fleetContainer.setAttribute("onclick","selectOutpostFleet("+thisFleet.fleet_id+","+outpost.planet_id+")");

			// Set the correct image, based on location and mission-status
			var titleAndImage=returnFleetTitleAndImage(thisFleet);
			var title=titleAndImage.title;
			var imgsrc=titleAndImage.imgsrc;

			fleetTypeContainer.setAttribute("title",title);
			fleetTypeImage.setAttribute("src",imgsrc);

			//fleetLocationContainer.setAttribute("class","table_fleet_loc");
			fleetSizeContainer.setAttribute("class","table_fleet_size outpost");
			fleetMinorsContainer.setAttribute("class","table_fleet_size outpost");
			fleetStrengthContainer.setAttribute("class","table_fleet_strength outpost");

			fleetNameContainer.innerHTML=thisFleet.fleet_name;
			//fleetLocationContainer.innerHTML=thisFleet.location_string;
			fleetSizeContainer.innerHTML=thisFleet.shipcount;
			fleetMinorsContainer.innerHTML=minor_count;
			fleetStrengthContainer.innerHTML=prettyPrint(thisFleet.strength);

			fleetContainer.appendChild(fleetNameContainer);
			fleetContainer.appendChild(fleetTypeContainer);
			fleetTypeContainer.appendChild(fleetTypeImage);
			//fleetContainer.appendChild(fleetLocationContainer);
			fleetContainer.appendChild(fleetSizeContainer);
			fleetContainer.appendChild(fleetMinorsContainer);
			fleetContainer.appendChild(fleetStrengthContainer);

			parentContainer.appendChild(fleetContainer);
		}
	}


}

function reselectCurrentOutpost(){
	if (ad2460.selected_outpost_planet_id>0){
		selectOutpost(ad2460.selected_outpost_planet_id,false);
	}
}

function selectOutpostFleet(fleetId, planet_id){

	// Unselect fleet in fleet management to get rid of some objects etc..
	unselectFleet();
	// Now proceed

	var fleet=returnFleetById(fleetId);
	if (fleet==false){
		return;
	}

	var renderObjects=returnShipRenderObjects(fleet);

	var minor_count=0;
	for(var m=0;m<fleet.ships.length;m++){
		if (fleet.ships[m].ship_type_id<=410){
			minor_count++;
		}
	}


	// For the ship-renderings, the parent is 'outpost_fleetdetails_'+outpost.planet_id

	removeChildNodes('selected_outpost_fleetdetails');

	var parent=document.getElementById('selected_outpost_fleetdetails');

	var header=createSingleElement('div', 'infopanel_header', '', fleet.fleet_name, '');
	var overview=createSingleElement('div', 'outpost_fleet_overview', '', '', '');
	var overview_column=createSingleElement('div', 'outpost_fleet_overview_column', '', '', '');
	var cmdr_header=createSingleElement('div', 'header_', '', 'Commander', '');
	var cmdr_name=createSingleElement('div', 'entry_', '', 'N/A', '');
	if (fleet.commander!=null){
		cmdr_name=createSingleElement('div', 'entry_', '', ''+fleet.commander.name, '');
	}
	var ships_header=createSingleElement('div', 'header_', '', 'Strength', '');
	var ships_count=createSingleElement('div', 'entry_', '', ''+prettyPrint(fleet.strength), '');

	overview.appendChild(overview_column);
	overview_column.appendChild(cmdr_header);
	overview_column.appendChild(cmdr_name);
	overview_column.appendChild(ships_header);
	overview_column.appendChild(ships_count);

	var sep=createSingleElement('div', 'outpost_fleet_overview_separate', '', '', '');
	var sepimg=createSingleElement('img', 'outpost_fleet_overview_separate', '', 'images/fixed/fleetinfoseparator.png', '');
	sepimg.style.width='30px';

	sep.appendChild(sepimg);
	overview.appendChild(sep);

	var overview_column_2=createSingleElement('div', 'outpost_fleet_overview_column', '', '', '');
	var fpwr_header=createSingleElement('div', 'header_', '', 'Capital ships', '');
	var fpwr_number=createSingleElement('div', 'entry_', '', ''+prettyPrint(fleet.shipcount), '');
	var def_header=createSingleElement('div', 'header_', '', 'Minors', '');
	var def_number=createSingleElement('div', 'entry_', '', ''+minor_count, '');

	overview.appendChild(overview_column_2);
	overview_column_2.appendChild(fpwr_header);
	overview_column_2.appendChild(fpwr_number);
	overview_column_2.appendChild(def_header);
	overview_column_2.appendChild(def_number);

	var fleetShipsContainer=createSingleElement('div', 'outpost_fleet_ships_container', '', '', '');

	// And now create the renderObjects...
	for (i=0;i<renderObjects.length ;i++ ){
		var leftright='list_left';
		if (i % 2 != 0){
			leftright='list_right';
		}
		//var rowContainer=returnShipDomObject(leftright, renderObjects[i],"op_", "outpostships");
		var rowContainer=returnShipDomObjectNew(leftright, renderObjects[i], "fm_","");

//		// And hey presto, link the entry to the container...

		fleetShipsContainer.appendChild(rowContainer);
	}

	var infopanelHelp=createSingleElement('div', 'infopanel_help', '', 'Click on a ship type to view details.', '');

	parent.appendChild(header);
	//parent.appendChild(overview);
	parent.appendChild(fleetShipsContainer);
	parent.appendChild(infopanelHelp);

	$('#selected_outpost_fleet_overview').hide();
	$('#selected_outpost_fleetdetails').show();
}

function showOutpostDefensiveOverview(planet_id){

	$('#selected_outpost_fleetdetails').hide();
	$('#selected_outpost_fleet_overview').show();
}

function unmarkOutpostAsUpgrading(planet_id){
	var outpost=returnOutpostByPlanetId(planet_id);
	if (outpost==false){
		return;
	}
	outpost.upgrade_started_timestamp=0;
	outpost.upgrade_complete_timestamp=0;
	outpost.upgrading=0;

	renderOutpostList();

	selectOutpost(planet_id, false);
}

function markOutpostAsUpgrading(planet_id,upgrade_started_timestamp,upgrade_complete_timestamp){

	var outpost=returnOutpostByPlanetId(planet_id);
	if (outpost==false){
		console.log("Not found.");
		return;
	}
	outpost.upgrade_started_timestamp=upgrade_started_timestamp;
	outpost.upgrade_complete_timestamp=upgrade_complete_timestamp;
	outpost.upgrading=1;

	selectOutpost(planet_id, false);

	renderOutpostList();
}

function returnOutpostByPlanetId(planet_id){
	var i=0;
	for (i=0;i<ad2460.outposts.length ;i++ ){
		if (ad2460.outposts[i].planet_id==planet_id){
			thisOutpost=ad2460.outposts[i];
			return thisOutpost;
		}
	}
	return false;
}

function activateOutpost(){
	var planet_id=ad2460.selected_outpost_planet_id;
	var op=returnOutpostByPlanetId(planet_id);

	if (op!=false){
		if (op.inactive==1){
			$.post('actionhandler.pl', {action:'activate_outpost', planet_id:planet_id}, function(data){ parseInfo(data);});
		}
		else {
			$.post('actionhandler.pl', {action:'deactivate_outpost', planet_id:planet_id}, function(data){ parseInfo(data);});
		}
	}
	play_multi_sound("sfx_click3");
}

function upgradeOutpostClick(){
	var planet_id=ad2460.selected_outpost_planet_id;
	$.post('actionhandler.pl', {action:'initiate_outpost_upgrade', planet_id:planet_id}, function(data){ parseInfo(data);});
	//play_multi_sound("sfx_click3");
}

function abandonOutpostClick(){
	var planet_id=ad2460.selected_outpost_planet_id;
	closeOutpostPanels();
	$.post('actionhandler.pl', {action:'abandon_outpost', planet_id:planet_id}, function(data){ parseInfo(data);});
}


function closeOutpostPanels(){

	var i=0;
	for (i=0;i<ad2460.openPanels.length ;i++ ){
		//console.log(ad2460.openPanels[i].substr(0,7));
		if (ad2460.openPanels[i]=='selected_outpost_panel'){
			$("#selected_outpost_panel .main_panel").click();
		}
	}
}


function resetTransportGlobals(){

	ad2460.transportVars.current_transport_percent_hassium=0;
	ad2460.transportVars.current_transport_percent_neodymium=0;
	ad2460.transportVars.current_transport_percent_strontium=0;
	ad2460.transportVars.current_transport_percent_indium=0;

	ad2460.transportVars.current_transport_amount_hassium=0;
	ad2460.transportVars.current_transport_amount_neodymium=0;
	ad2460.transportVars.current_transport_amount_strontium=0;
	ad2460.transportVars.current_transport_amount_indium=0;

	var small=0;
	var large=0;
	var adamant=0;
	var base=returnBaseFleet();
	if (base){
		for (var i=0;i<base.ships.length ;i++ ){
			if (base.ships[i].ship_type_id==435){
				small++;
			}
			if (base.ships[i].ship_type_id==436){
				large++;
			}
		}
	}

	ad2460.transportVars.max_small_transports=small;
	ad2460.transportVars.max_large_transports=large;
	ad2460.transportVars.max_adamant_transports=adamant;

	ad2460.transportVars.currently_selected_small_transports=0;
	ad2460.transportVars.currently_selected_large_transports=0;
	ad2460.transportVars.currently_selected_adamant_transports=0;

}

function modifyTransportClick(ship_type_id,add){
	if (ship_type_id==435){
		if (add==1){
			if (ad2460.transportVars.currently_selected_small_transports<ad2460.transportVars.max_small_transports){
				ad2460.transportVars.currently_selected_small_transports++;
			}
		}
		else if (add==-1){
			if (ad2460.transportVars.currently_selected_small_transports>0){
				ad2460.transportVars.currently_selected_small_transports--;
			}
		}
	}
	if (ship_type_id==436){
		if (add==1){
			if (ad2460.transportVars.currently_selected_large_transports<ad2460.transportVars.max_large_transports){
				ad2460.transportVars.currently_selected_large_transports++;
			}
		}
		else if (add==-1){
			if (ad2460.transportVars.currently_selected_large_transports>0){
				ad2460.transportVars.currently_selected_large_transports--;
			}
		}
	}

	updateSelectedTransports();
}

function updateSelectedTransports(){
	$("#trans_top_435").html(ad2460.transportVars.currently_selected_small_transports);
	$("#trans_top_436").html(ad2460.transportVars.currently_selected_large_transports);
	//$("#trans_top_437").html(ad2460.transportVars.currently_selected_adamant_transports);

	// Calc the amount of resources being transported
	var outpost=returnOutpostByPlanetId(ad2460.transportVars.current_outpost_planet_id);
	var cargoBonusPercent=returnCargoCapacityBonusPercent();

	var total_res=outpost.stored_hassium+outpost.stored_indium+outpost.stored_strontium+outpost.stored_neodymium;

	if (total_res<1){
		return;
	}

	var total_cargo_capacity=0;
	total_cargo_capacity+=ad2460.transportVars.currently_selected_small_transports*25000;
	total_cargo_capacity+=ad2460.transportVars.currently_selected_large_transports*200000;
	//total_cargo_capacity+=ad2460.transportVars.currently_selected_adamant_transports*500000;
	total_cargo_capacity+=Math.floor(total_cargo_capacity*cargoBonusPercent/100);

	var spent_cargo_capacity=0;

	// distribution
	var hsp=(outpost.stored_hassium*100/total_res);
	var isp=(outpost.stored_indium*100/total_res);
	var ssp=(outpost.stored_strontium*100/total_res);
	var nsp=(outpost.stored_neodymium*100/total_res);

	/*
	if (hsp+isp+ssp+nsp<100){	hsp++;	}
	if (hsp+isp+ssp+nsp<100){	isp++;	}
	if (hsp+isp+ssp+nsp<100){	ssp++;	}
	if (hsp+isp+ssp+nsp<100){	nsp++;	}

	if (hsp+isp+ssp+nsp>100){	hsp--;	}
	if (hsp+isp+ssp+nsp>100){	isp--;	}
	if (hsp+isp+ssp+nsp>100){	ssp--;	}
	if (hsp+isp+ssp+nsp>100){	nsp--;	}
	*/

	var actual_cargo_total=total_res;
	if (total_cargo_capacity<total_res){
		actual_cargo_total=total_cargo_capacity;
	}

	var actual_hs=Math.round(actual_cargo_total*hsp/100);
	var actual_in=Math.round(actual_cargo_total*isp/100);
	var actual_sr=Math.round(actual_cargo_total*ssp/100);
	var actual_nd=Math.round(actual_cargo_total*nsp/100);

	//console.log(actual_hs, actual_in, actual_sr, actual_nd);

	// Fix some rounding-issues
	if (actual_hs+actual_in+actual_sr+actual_nd<actual_cargo_total && outpost.stored_hassium>actual_hs){ actual_hs++;	}
	if (actual_hs+actual_in+actual_sr+actual_nd<actual_cargo_total && outpost.stored_indium>actual_in){ actual_in++;	}
	if (actual_hs+actual_in+actual_sr+actual_nd<actual_cargo_total && outpost.stored_strontium>actual_sr){ actual_sr++;	}
	if (actual_hs+actual_in+actual_sr+actual_nd<actual_cargo_total && outpost.stored_neodymium>actual_nd){ actual_nd++;	}

	//console.log(actual_hs, actual_in, actual_sr, actual_nd);

	// Fix some rounding-issues
	if (actual_hs+actual_in+actual_sr+actual_nd>actual_cargo_total){ actual_hs--;	}
	if (actual_hs+actual_in+actual_sr+actual_nd>actual_cargo_total){ actual_in--;	}
	if (actual_hs+actual_in+actual_sr+actual_nd>actual_cargo_total){ actual_sr--;	}
	if (actual_hs+actual_in+actual_sr+actual_nd>actual_cargo_total){ actual_nd--;	}



	$("#current_transport_amount_hassium").html(prettyPrint(actual_hs));
	$("#current_transport_amount_indium").html(prettyPrint(actual_in));
	$("#current_transport_amount_strontium").html(prettyPrint(actual_sr));
	$("#current_transport_amount_neodymium").html(prettyPrint(actual_nd));

	$("#transport_amount").html(prettyPrint(actual_hs+actual_in+actual_sr+actual_nd));

	ad2460.transportVars.current_transport_amount_hassium=actual_hs;
	ad2460.transportVars.current_transport_amount_indium=actual_in;
	ad2460.transportVars.current_transport_amount_neodymium=actual_nd;
	ad2460.transportVars.current_transport_amount_strontium=actual_sr;


}

function prepareTransportClickNew(){

	return;

	var planet_id=ad2460.selected_outpost_planet_id;
	var outpost=returnOutpostByPlanetId(planet_id);
	var cargoBonusPercent=returnCargoCapacityBonusPercent();
	if (ad2460.openQuickMenues.outpost_transport_panel){
		transportOptionsMenuDown();
		return;
	}

	if (outpost!==false){
		resetTransportGlobals();
		$(".transport_option_transport_type").remove();
		ad2460.transportVars.selectedEscortFleetId=0;
		ad2460.transportVars.current_outpost_planet_id=planet_id;
		// We have all the data we need in the planet-object and the transportVars object
		if (ad2460.transportVars.max_small_transports+ad2460.transportVars.max_large_transports+ad2460.transportVars.max_adamant_transports==0){
			// Ain't got no transports at home!
			$(".transport_option_transport_type").hide();
			$(".transport_options_info").hide();
			$("#transport_option_transport_warning").show();
			$("#transportColumn2").hide();
			$("#transportColumn3").hide();
			transportOptionsMenuUp();
			return;
		}

		// Ok, we have some transports ready and waiting, SIR!

		$("#transport_option_transport_warning").hide();
		$(".transport_option_transport_type").show();
		$(".transport_options_info").show();
		$("#transportColumn2").show();
		$("#transportColumn3").show();

		if (ad2460.transportVars.max_small_transports>0){
			renderTransportShipEntry(435);
		}
		if (ad2460.transportVars.max_large_transports>0){
			renderTransportShipEntry(436);
		}

		updateSelectedTransports();

		var jump_range=1; // For all transport-vessels, will require more advanced calculations if they are tuned to be diffirent!
		var transportTime=calcEta(outpost.x, outpost.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, true, false );
		var transportTimeString=secondsToFullTimeNosecs(transportTime);
		$("#transport_eta").html(transportTimeString);

		// Escort-fleets ?
		var dropdown=document.getElementById('current_transport_escort_dropdown');
		dropdown.options.length = 0;
		dropdown.options[dropdown.options.length] = new Option('No escort', 0);
		var c=0;
		for (c=0;c<ad2460.myFleets.length ;c++ ){
			// IF the fleet is not storage and not the base-fleet and it is at home doing nothing
			var thisFleet=ad2460.myFleets[c];
			if (thisFleet.current_mission_type==0 && thisFleet.current_x==ad2460.homeworld.x && thisFleet.current_y==ad2460.homeworld.y && thisFleet.storage_fleet==0 && thisFleet.homeworld_fleet==0 && thisFleet.strength>0 && thisFleet.shipcount>0 )	{
				dropdown.options[dropdown.options.length] = new Option(thisFleet.fleet_name, thisFleet.fleet_id);
			}
		}
		// And remove any entry from the selected escort listing
		removeChildNodes('transport_selected_escort_listing');







	}
	transportOptionsMenuUp();
}

function renderTransportShipEntry(ship_type_id){
	var max=0;
	var current=0;
	if (ship_type_id==435){ max=ad2460.transportVars.max_small_transports;	current=ad2460.transportVars.currently_selected_small_transports;}
	if (ship_type_id==436){ max=ad2460.transportVars.max_large_transports;	current=ad2460.transportVars.currently_selected_large_transports;	}
	//if (ship_type_id==437){ max=ad2460.transportVars.max_adamant_transports;	current=ad2460.transportVars.currently_selected_adamant_transports;	}

	var unit=returnGameObjectById(ship_type_id);

	var top_number_div_id="trans_top_"+ship_type_id;
	var bottom_number_div_id="trans_bottom_"+ship_type_id;

	var outerContainer=document.getElementById("transport_ships_container");
	var innerContainer=createSingleElement('div', 'transport_option_transport_type', '', '', '');
	var shipTypeSelectMinor=createSingleElement('div', 'shiptype_select minor_ship', '', '', '');
	var shipName=createSingleElement('div', 'shiptype_name', '', unit.name, '');
	var imgContainer=createSingleElement('div', 'shiptype_img', '', '', '');
	// Only 1 ships to show so far, waiting for gfx....
	var imgSrc="images/icons/miniships/"+ship_type_id+"_mini.png";
	var img=createSingleElement('img', '', '', imgSrc, '');

	var countContainer=createSingleElement('div', 'resupply_count', '', '', '');
	var number1=createSingleElement('div', 'resupply_number', top_number_div_id, ''+current, '');
	var line=createSingleElement('div', 'resupply_line', '', '', '');
	var number2=createSingleElement('div', 'resupply_number', bottom_number_div_id, ''+max, '');

	var plusContainer=createSingleElement('div', 'fixed_button fixed_button_26_square', ship_type_id+'_transport_plus', '', 'modifyTransportClick('+ship_type_id+',1)');
	var plus1=createSingleElement('div', 'fixed_button_regular_square', ship_type_id+'_plus_1', '', '');
	var plus2=createSingleElement('div', 'fixed_button_hover square_green', ship_type_id+'_plus_2', '', '');
	var plus3=createSingleElement('div', 'fixed_button_click square_green', ship_type_id+'_plus_3', '', '');
	var plus4=createSingleElement('div', 'transportsbutton', ship_type_id+'_plus_4', '+', '');

	var minusContainer=createSingleElement('div', 'fixed_button fixed_button_26_square', ship_type_id+'_transport_minus', '', 'modifyTransportClick('+ship_type_id+',-1)');
	var minus1=createSingleElement('div', 'fixed_button_regular_square', ship_type_id+'_minus_1', '', '');
	var minus2=createSingleElement('div', 'fixed_button_hover square_green', ship_type_id+'_minus_2', '', '');
	var minus3=createSingleElement('div', 'fixed_button_click square_green', ship_type_id+'_minus_3', '', '');
	var minus4=createSingleElement('div', 'transportsbutton', ship_type_id+'_minus_4', '-', '');

	plusContainer.style.cursor='pointer';
	minusContainer.style.cursor='pointer';


	plusContainer.appendChild(plus1);
	plusContainer.appendChild(plus2);
	plusContainer.appendChild(plus3);
	plusContainer.appendChild(plus4);

	minusContainer.appendChild(minus1);
	minusContainer.appendChild(minus2);
	minusContainer.appendChild(minus3);
	minusContainer.appendChild(minus4);

	innerContainer.appendChild(shipTypeSelectMinor);
	shipTypeSelectMinor.appendChild(shipName);
	shipTypeSelectMinor.appendChild(imgContainer);
	imgContainer.appendChild(img);

	innerContainer.appendChild(countContainer);
	countContainer.appendChild(number1);
	countContainer.appendChild(line);
	countContainer.appendChild(number2);

	innerContainer.appendChild(plusContainer);
	innerContainer.appendChild(minusContainer);

	outerContainer.appendChild(innerContainer);



}

function prepareTransportClick(){
	var planet_id=ad2460.selected_outpost_planet_id;


	// needed variables
	var outpost=returnOutpostByPlanetId(planet_id);
	if (ad2460.openQuickMenues.outpost_transport_panel){
		transportOptionsMenuDown();
		return;
	}

	var cargoBonusPercent=returnCargoCapacityBonusPercent();


	if (outpost!==false){

		// Resetting some values for later use
		resetTransportGlobals();
		$(".transport_option_transport_type").remove();
		ad2460.transportVars.selectedEscortFleetId=0;
		ad2460.transportVars.current_outpost_planet_id=planet_id;

		// We need to find out what kind of transport-ships that are available in the base fleet.
		var baseFleet=returnBaseFleet();
		if (baseFleet==false){
			//console.error("baseFleet is FALSE!");
		}

		// Now I want an array of all available cargoships, grouped by type
		ad2460.transportVars.cargoShips=new Array;
		var cargoShips=ad2460.transportVars.cargoShips;

		for (i=0;i<baseFleet.ships.length ;i++ ){
			var ship_type_id=baseFleet.ships[i].ship_type_id;
			//console.log(ship_type_id);
			var a=0;
			for (a=0;a<ad2460.productionitems.length ;a++ ){

				if (ad2460.productionitems[a].id==ship_type_id && ad2460.productionitems[a].cargo_capacity>0 && ( ad2460.productionitems[a].id==435 ||  ad2460.productionitems[a].id==436 ) ){
					// We have a cargo-ship on our hands
					var x=0;
					var found=false;
					for (x=0;x<cargoShips.length ;x++ ){
						if (cargoShips[x].ship_type_id==ship_type_id){
							cargoShips[x].count++;
							//console.log("adding to existing cargoship entry");
							found=true;
						}
					}
					if (found==false){
						// console.log("adding new cargoship entry");
						cargoShips.push(new cargoShip(baseFleet.ships[i]));
					}
				}
			}
		}

		var total_available_cargo_capacity=0;

		for (i=0;i<cargoShips.length ;i++ )	{
			total_available_cargo_capacity+=(cargoShips[i].count*cargoShips[i].cargo_capacity);
		}

		//console.log("Total available cargo capacity: "+total_available_cargo_capacity);
		//console.log(cargoShips);
		var totalResourcesToTransport=outpost.stored_hassium+outpost.stored_neodymium+outpost.stored_strontium+outpost.stored_indium;

		//console.log("totalResourcesToTransport "+totalResourcesToTransport);
		//console.log("total_available_cargo_capacity "+total_available_cargo_capacity);

		if (totalResourcesToTransport>total_available_cargo_capacity){
			totalResourcesToTransport=total_available_cargo_capacity;
		}

		//console.log("totalResourcesToTransport "+totalResourcesToTransport);

		ad2460.transportVars.totalResToTransport=totalResourcesToTransport;

		var resourcesLeftToDistribute=totalResourcesToTransport;

		cargoShips.sort(function(a, b){ return b.cargo_capacity-a.cargo_capacity });

		//console.log(cargoShips);
		// There, cargoShips now holds the right array as we wanted it!
		if (cargoShips.length==0){
			// No available cargoships
			// Print no-cargoship-warning and 0 out the other stuff.
			$(".transport_option_transport_type").hide();
			$(".transport_options_info").hide();
			$("#transport_option_transport_warning").show();
			$("#transportColumn2").hide();
			$("#transportColumn3").hide();
		}
		else {
			// first we must find out how many of each cargoShip we will use....
			for (i=0;i<cargoShips.length ;i++ ){
				cargoShips[i].use_count=0;
				if (resourcesLeftToDistribute>0){
					cargoShips[i].use_count=Math.ceil(resourcesLeftToDistribute/cargoShips[i].cargo_capacity);
					if (cargoShips[i].use_count>cargoShips[i].count){
						cargoShips[i].use_count=cargoShips[i].count;
					}
					resourcesLeftToDistribute-=(cargoShips[i].use_count*cargoShips[i].cargo_capacity);

				}
			}

			var lowest_jump_range=10;

			// Render the lot

			$("#transport_option_transport_warning").hide();
			$(".transport_option_transport_type").show();
			$(".transport_options_info").show();
			$("#transportColumn2").show();
			$("#transportColumn3").show();

			var i=0;
			for (i=0;i<cargoShips.length ;i++ ){
				var outerContainer=document.getElementById("transport_ships_container");
				var innerContainer=createSingleElement('div', 'transport_option_transport_type', '', '', '');
				var shipTypeSelectMinor=createSingleElement('div', 'shiptype_select minor_ship', '', '', '');
				var shipName=createSingleElement('div', 'shiptype_name', '', cargoShips[i].name, '');
				var imgContainer=createSingleElement('div', 'shiptype_img', '', '', '');
				// Only 1 ships to show so far, waiting for gfx....
				var imgSrc="images/icons/miniships/transport03.png";
				var img=createSingleElement('img', '', '', imgSrc, '');

				var countContainer=createSingleElement('div', 'resupply_count', '', '', '');
				var number1=createSingleElement('div', 'resupply_number', '', ''+cargoShips[i].use_count, '');
				var line=createSingleElement('div', 'resupply_line', '', '', '');
				var number2=createSingleElement('div', 'resupply_number', '', ''+cargoShips[i].count, '');

				innerContainer.appendChild(shipTypeSelectMinor);
				shipTypeSelectMinor.appendChild(shipName);
				shipTypeSelectMinor.appendChild(imgContainer);
				imgContainer.appendChild(img);

				innerContainer.appendChild(countContainer);
				countContainer.appendChild(number1);
				countContainer.appendChild(line);
				countContainer.appendChild(number2);

				outerContainer.appendChild(innerContainer);

				if (cargoShips[i].jump_range<lowest_jump_range){
					lowest_jump_range=cargoShips[i].jump_range;
				}

			}
			$("#transport_amount").html(prettyPrint(totalResourcesToTransport));

			var jump_range=1; // For all transport-vessels, will require more advanced calculations if they are tuned to be diffirent!
			var transportTime=calcEta(outpost.x, outpost.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, true, false );
			var transportTimeString=secondsToFullTimeNosecs(transportTime);

			$("#transport_eta").html(transportTimeString);

			var overallTotal=outpost.stored_hassium+outpost.stored_neodymium+outpost.stored_strontium+outpost.stored_indium;
			selectAdjustedDistribution(outpost.planet_id,totalResourcesToTransport);

			document.getElementById('transport_even_button').setAttribute('onclick',"selectEvenDistribution("+outpost.planet_id+","+totalResourcesToTransport+")");
			document.getElementById('transport_adjusted_button').setAttribute('onclick',"selectAdjustedDistribution("+outpost.planet_id+","+totalResourcesToTransport+")");

			// Now prepare the dropdown holding possible escort-fleets
			// the id is 'current_transport_escort_dropdown'
			var dropdown=document.getElementById('current_transport_escort_dropdown');
			dropdown.options.length = 0;
			dropdown.options[dropdown.options.length] = new Option('No escort', 0);
			var c=0;
			for (c=0;c<ad2460.myFleets.length ;c++ ){
				// IF the fleet is not storage and not the base-fleet and it is at home doing nothing
				var thisFleet=ad2460.myFleets[c];
				if (thisFleet.current_mission_type==0 && thisFleet.current_x==ad2460.homeworld.x && thisFleet.current_y==ad2460.homeworld.y && thisFleet.storage_fleet==0 && thisFleet.homeworld_fleet==0 )	{
					// Seems valid enough...
					dropdown.options[dropdown.options.length] = new Option(thisFleet.fleet_name, thisFleet.fleet_id);
					//console.log('added fleet to dropdown');
				}
				else {
					//console.log('Fleet not valid');
				}
			}

			// And remove any entry from the selected escort listing
			removeChildNodes('transport_selected_escort_listing');



		}
		transportOptionsMenuUp();
	}
	else {
		//console.error("Outpost is FALSE!");
	}
}

function selectAdjustedDistribution(planet_id,totalResourcesToTransport){

	var outpost=returnOutpostByPlanetId(planet_id);

	resetTransportGlobals();

	var overallTotal=outpost.stored_hassium+outpost.stored_neodymium+outpost.stored_strontium+outpost.stored_indium;
	if (overallTotal>totalResourcesToTransport){
		ad2460.transportVars.current_transport_percent_hassium=(outpost.stored_hassium*100/overallTotal);
		ad2460.transportVars.current_transport_percent_indium=(outpost.stored_indium*100/overallTotal);
		ad2460.transportVars.current_transport_percent_neodymium=(outpost.stored_neodymium*100/overallTotal);
		ad2460.transportVars.current_transport_percent_strontium=(outpost.stored_strontium*100/overallTotal);


		ad2460.transportVars.current_transport_amount_hassium=Math.floor(totalResourcesToTransport*ad2460.transportVars.current_transport_percent_hassium/100);
		ad2460.transportVars.current_transport_amount_neodymium=Math.floor(totalResourcesToTransport*ad2460.transportVars.current_transport_percent_neodymium/100);
		ad2460.transportVars.current_transport_amount_strontium=Math.floor(totalResourcesToTransport*ad2460.transportVars.current_transport_percent_strontium/100);
		ad2460.transportVars.current_transport_amount_indium=totalResourcesToTransport-ad2460.transportVars.current_transport_amount_hassium-ad2460.transportVars.current_transport_amount_neodymium-ad2460.transportVars.current_transport_amount_strontium;
		if (ad2460.transportVars.current_transport_amount_indium>outpost.stored_indium){
			ad2460.transportVars.current_transport_amount_indium=outpost.stored_indium;
		}
	}
	else {
		ad2460.transportVars.current_transport_amount_hassium=outpost.stored_hassium;
		ad2460.transportVars.current_transport_amount_neodymium=outpost.stored_neodymium;
		ad2460.transportVars.current_transport_amount_strontium=outpost.stored_strontium;
		ad2460.transportVars.current_transport_amount_indium=outpost.stored_indium;
	}

	$("#current_transport_amount_hassium").html(prettyPrint(ad2460.transportVars.current_transport_amount_hassium));
	$("#current_transport_amount_neodymium").html(prettyPrint(ad2460.transportVars.current_transport_amount_neodymium));
	$("#current_transport_amount_strontium").html(prettyPrint(ad2460.transportVars.current_transport_amount_strontium));
	$("#current_transport_amount_indium").html(prettyPrint(ad2460.transportVars.current_transport_amount_indium));

}

function selectEvenDistribution(planet_id,totalResourcesToTransport){

	var outpost=returnOutpostByPlanetId(planet_id);
	resetTransportGlobals();
	var overallTotal=outpost.stored_hassium+outpost.stored_neodymium+outpost.stored_strontium+outpost.stored_indium;
	// Copy some variables to avoid confusion
	var Hs=outpost.stored_hassium;
	var Nd=outpost.stored_neodymium;
	var Sr=outpost.stored_strontium;
	var In=outpost.stored_indium;

	if (overallTotal>totalResourcesToTransport){
		var leftToFill=totalResourcesToTransport;
		// We will try to fill up evenly of all resources, which may ofc not be possible...
		while (leftToFill>0){
			if (leftToFill>0){
				if (Hs>0){
					ad2460.transportVars.current_transport_amount_hassium++;
					Hs--;
					leftToFill--;
				}
			}
			if (leftToFill>0){
				if (Nd>0){
					ad2460.transportVars.current_transport_amount_neodymium++;
					Nd--;
					leftToFill--;
				}
			}
			if (leftToFill>0){
				if (Sr>0){
					ad2460.transportVars.current_transport_amount_strontium++;
					Sr--;
					leftToFill--;
				}
			}
			if (leftToFill>0){
				if (In>0){
					ad2460.transportVars.current_transport_amount_indium++;
					In--;
					leftToFill--;
				}
			}
		} // End scary while-loop, hello infinate loop :-P
	}
	else {
		ad2460.transportVars.current_transport_amount_hassium=outpost.stored_hassium;
		ad2460.transportVars.current_transport_amount_neodymium=outpost.stored_neodymium;
		ad2460.transportVars.current_transport_amount_strontium=outpost.stored_strontium;
		ad2460.transportVars.current_transport_amount_indium=outpost.stored_indium;
	}

	$("#current_transport_amount_hassium").html(prettyPrint(ad2460.transportVars.current_transport_amount_hassium));
	$("#current_transport_amount_neodymium").html(prettyPrint(ad2460.transportVars.current_transport_amount_neodymium));
	$("#current_transport_amount_strontium").html(prettyPrint(ad2460.transportVars.current_transport_amount_strontium));
	$("#current_transport_amount_indium").html(prettyPrint(ad2460.transportVars.current_transport_amount_indium));

}

function addTransportEscortFleet(){

	var dropdown=document.getElementById('current_transport_escort_dropdown');
	// find the selected items value
	var selectedEscortFleetId=dropdown.options[dropdown.selectedIndex].value;
	//console.log(selectedEscortFleetId);
	ad2460.transportVars.selectedEscortFleetId=selectedEscortFleetId;
	// Now nuke any listed escort-fleet from the list
	removeChildNodes('transport_selected_escort_listing');
	var container=document.getElementById('transport_selected_escort_listing');
	if (selectedEscortFleetId>0){
		var thisFleet=returnFleetById(selectedEscortFleetId);
		if (thisFleet!=false){
			var nameDiv=createSingleElement('div', 'name', '', ''+thisFleet.fleet_name, '');
			var countDiv=createSingleElement('div', 'shipcount', '', ''+thisFleet.shipcount, '');
			var strengthDiv=createSingleElement('div', 'strength', '', ''+thisFleet.strength, '');
			container.appendChild(nameDiv);
			container.appendChild(countDiv);
			container.appendChild(strengthDiv);

		}
	}
}

function initiateTransportClick(){

	// Here we finally go
	//console.log("Initiating transport");
	var has=ad2460.transportVars.current_transport_amount_hassium;
	var ind=ad2460.transportVars.current_transport_amount_indium;
	var neo=ad2460.transportVars.current_transport_amount_neodymium;
	var str=ad2460.transportVars.current_transport_amount_strontium;
	var escortId=ad2460.transportVars.selectedEscortFleetId;
	var total=ad2460.transportVars.totalResToTransport;
	var planet_id=ad2460.transportVars.current_outpost_planet_id;

	var ship_string="";
	if (ad2460.transportVars.currently_selected_small_transports>0){
		ship_string+='435:'+ad2460.transportVars.currently_selected_small_transports+'|';
	}
	if (ad2460.transportVars.currently_selected_large_transports>0){
		ship_string+='436:'+ad2460.transportVars.currently_selected_large_transports+'|';
	}
	//if (ad2460.transportVars.currently_selected_adamant_transports>0){
	//	ship_string+='437:'+ad2460.transportVars.currently_selected_adamant_transports+'|';
	//}

	/*
	var i=0;
	for (i=0;i<ad2460.transportVars.cargoShips.length ;i++ ){
		var thisShipEntry=ad2460.transportVars.cargoShips[i];
		var thisShipTypeId=thisShipEntry.ship_type_id;
		var thisShipCount=thisShipEntry.use_count;
		ship_string+=thisShipTypeId+':'+thisShipCount+'|';
	}
	*/

	$.post('actionhandler.pl', {action:'initiate_transport',hassium:has, indium:ind,neodymium:neo,strontium:str,escort_id:escortId, total:total, planet_id:planet_id, ships:ship_string}, function(data){ parseInfo(data);});
}

function updateOutpostName(newName){
	// divId holds the id like oname_326571
	var outpostId=ad2460.selected_outpost_planet_id;
	newName=newName.replace('<br>','');
	newName=newName.replace('&nbsp;',' ');
	newName=newName.substr(0,16);
	if (newName.length<4){
		systemFeedback('Error','The name is too short. Try again.', 1, 3);
		return;
	}
	$.post('actionhandler.pl', {action:'rename_outpost',outpost_id:outpostId, new_name:newName }, function(data){ parseInfo(data);});
}

function updateSingleOutpost(planet_id, hassium, indium, strontium, neodymium){
	var outpost=returnOutpostByPlanetId(planet_id);
	outpost.stored_hassium=hassium;
	outpost.stored_indium=indium;
	outpost.stored_strontium=strontium;
	outpost.stored_neodymium=neodymium;

	var newTotal=hassium+indium+strontium+neodymium;

	$("#outpost_stored_total_"+planet_id).html(prettyPrint(newTotal));

	$("#outpost_stored_hs_"+planet_id).html(prettyPrint(hassium));
	$("#outpost_stored_in_"+planet_id).html(prettyPrint(indium));
	$("#outpost_stored_sr_"+planet_id).html(prettyPrint(strontium));
	$("#outpost_stored_nd_"+planet_id).html(prettyPrint(neodymium));

	var maxRes=ad2460.outpostStorageLevels[outpost.level];
	var stored_percentage=newTotal*100/maxRes;

	var fillImg=document.getElementById('outpost_fill_image_'+planet_id);
	if (fillImg){
		if (stored_percentage<10){		fillImg.src="images/tiles/outpostcornerinside0.png";	fillImg.setAttribute("class","zerofill");}
		else if (stored_percentage<30){		slideImgSrc="images/tiles/outpostcornerinside20.png";	fillImg.setAttribute("class","twentyfill");}
		else if (stored_percentage<50){		slideImgSrc="images/tiles/outpostcornerinside40.png";	fillImg.setAttribute("class","fortyfill");}
		else if (stored_percentage<70){		slideImgSrc="images/tiles/outpostcornerinside60.png";	fillImg.setAttribute("class","sixtyfill");}
		else if (stored_percentage<90){		slideImgSrc="images/tiles/outpostcornerinside80.png";	fillImg.setAttribute("class","eightyfill");}
		else				{	slideImgSrc="images/tiles/outpostcornerinside100.png";	fillImg.setAttribute("class","hundredfill");}

	}

	var available=maxRes-newTotal;
	var perHour=outpost.current_output_hassium+outpost.current_output_indium+outpost.current_output_neodymium+outpost.current_output_strontium;

	var timeToFull=available/perHour;
	var timeToFullString=Math.floor(timeToFull+1)+' hours';
	if (timeToFull==0){
		timeToFullString="Full!";
	}

	$("#outpost_time_to_max_"+planet_id).html(timeToFullString);

	updateOutpostOverview();
	// That should do it!
}

function cancelUpgrade(){
	var planet_id=ad2460.selected_outpost_planet_id;

	$.post('actionhandler.pl', {action:'cancel_outpost_upgrade',planet_id:planet_id}, function(data){ parseInfo(data);});
}

function clearOutpostTimer(){
	removeTimer('currentOutpostUpgradeTimer');
	$('#process_2_progress').css('width','0%');
	$('#process_2_eta').html('');
	$('#process_2_name').html('No outpost is upgrading');
	$('#process_2_colour').hide();
}

function handleOutpostRenameKeydown(event){
	if (event.which!=8 && event.keyCode!=8 && event.which!=16 && event.keyCode!=16 && event.which!=37 && event.keyCode!=37 && event.which!=38 && event.keyCode!=38 && event.which!=39 && event.keyCode!=39 && event.which!=40 && event.keyCode!=40 && event.which!=46 && event.keyCode!=46 && event.which!=36 && event.keyCode!=36 && event.which!=35 && event.keyCode!=35 ) {
		if (event.srcElement.innerHTML.length>16){
			event.preventDefault;
			return false;
		}
	}
	if (event.which==13 || event.keyCode==13) {
		event.preventDefault;
	}
}

function handleOutpostRenameKeypress(event){
	if (event.which==13 || event.keyCode==13) {
		if (event.srcElement.innerHTML.length>3){
			updateOutpostName(event.srcElement.innerHTML, event.srcElement.id);
			event.srcElement.blur();
			return false;
		}
		else {
			systemFeedback('Error','Too short!', 1, 3);
			var o=returnOutpostByPlanetId(ad2460.selected_outpost_planet_id);
			updateOutpostName(o.name, event.srcElement.id);
			return false;
		}
	}

}

function abandonOutpostClickFirst(){
	var planet_id=ad2460.selected_outpost_planet_id;
	var outpost=returnOutpostByPlanetId(planet_id);
	if (outpost==false){
		return;
	}

	showConfirmationPopup(translations.outpost_abandon_confirmation,translations.general_yes,translations.general_no,'abandonOutpostClick();hideConfirmationPopup();','hideConfirmationPopup();');

}


function renderOutpostList(){
	removeChildNodes('outpost_list_scroller');
	clearOutpostTimer();

	sortOutposts();
	var parent=document.getElementById('outpost_list_scroller');
	var i=0;
	for (i=0;i<ad2460.outposts.length ;i++ ){
		var outpost=ad2460.outposts[i];
		var coords=convertShortCoordsToLongCoords(outpost.x,outpost.y);
		var total_output=outpost.current_output_hassium+outpost.current_output_neodymium+outpost.current_output_strontium+outpost.current_output_indium;
		var max_output=outpost.max_output_hassium+outpost.max_output_neodymium+outpost.max_output_strontium+outpost.max_output_indium;
		var output_percentage=ad2460.outpostOutputPercentages[outpost.level];
		var total_stored=outpost.stored_hassium+outpost.stored_neodymium+outpost.stored_strontium+outpost.stored_indium;
		var max_storage=return_outpost_storage(outpost.level);
		var stored_percentage=Math.floor(total_stored*100/max_storage);
		var potential=return_output_potential(outpost.max_output_hassium+outpost.max_output_neodymium+outpost.max_output_strontium+outpost.max_output_indium);
		var jump_range=1; // For all transport-vessels, will require more advanced calculations if they are tuned to be diffirent!
		var transportTime=calcEta(outpost.x, outpost.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, false, false );
		var transportTimeString=secondsToFullTimeNosecs(transportTime);
		if (transportTime==0){
			transportTimeString='0';
		}

		var extraTextClass="";
		if (outpost.inactive==1){
			extraTextClass=' notenough';
			total_output=0;
		}

		var presentStrength=0;

		// lets see if we have the fleet-data present for this outpost!
		for (var f=0;f<ad2460.myFleets.length ;f++ ){
			if (ad2460.myFleets[f].current_x==outpost.x && ad2460.myFleets[f].current_y==outpost.y){
				presentStrength+=ad2460.myFleets[f].strength;
				//console.log("Found fleet with "+ad2460.myFleets[f].strength+" strength at "+outpost.name);
			}
		}

		var notEnoughDefClass='';
		var recommendedDef=Math.ceil(outpostPotentialToMaxDefStrength(potential)/5/10*outpost.level);
		if (recommendedDef>presentStrength){
			notEnoughDefClass='notenough';
		}


		var container_div=createSingleElement('div', 'outpost_list_planet_container', '', '', 'selectOutpost('+outpost.planet_id+',true)');
		// var lost_div=createSingleElement('div', 'outpost_list_lost', '', 'LOST', ''); // for later use
		var planet_image=createSingleElement('img', 'outpost_img outpost_list_planet_img', '', 'images/planets/outpost_planets/planettype'+outpost.world_type+'.jpg', '');
		var name_div=createSingleElement('div', 'main_header_title outpost_list_planet', '', ''+outpost.name, '');
		var coords_div=createSingleElement('div', 'outpost_list_coords', '', ''+coords.coordString, 'zoomInToXY('+outpost.x+','+outpost.y+')');
		//  var fill_div=createSingleElement('div', 'outpost_list_fill'+extraTextClass, '', stored_percentage+' %', '');
		var output_div=createSingleElement('div', 'outpost_list_output'+extraTextClass, '', prettyPrint(total_output)+' u/h', '');
		if (outpost.upgrading>0){
			output_div.innerHTML='Busy';
		}
		var potential_div=createSingleElement('div', 'outpost_list_potential'+extraTextClass, '', potential+'/10', '');
		var level_div=createSingleElement('div', 'outpost_list_level'+extraTextClass, '', ''+outpost.level, '');
		var transport_time_div=createSingleElement('div', 'outpost_list_tt'+extraTextClass, '', ''+transportTimeString, '');

		var def_added_class='';
		if (outpost.call_for_def==1){
			def_added_class=' selected';
		}

		//var def_div=createSingleElement('div', 'outpost_list_def_on'+def_added_class, '', '', 'upgradeOutpostFromList(event,'+outpost.planet_id+')');
		var def_div=createSingleElement('div', 'outpost_list_present_def '+extraTextClass+' ' +notEnoughDefClass, '', ''+shortenBigNumber(presentStrength) + ' / '+shortenBigNumber(outpost.returnMaxFleetStrength()), '');

		var nextLevelDefString="";
		if (outpost.level<10){
			var nextDef=Math.ceil(outpostPotentialToMaxDefStrength(potential)/5/10*(outpost.level+1));
			nextLevelDefString="If your outpost is upgraded to next level, it will need to be defended by "+prettyPrint(nextDef)+" strength.";
		}

		if (recommendedDef>presentStrength){
			def_div.setAttribute('title','This outpost needs more defense! Increase it to at least '+prettyPrint(recommendedDef)+' Strength.\n'+nextLevelDefString);
		}
		else {
			def_div.setAttribute('title',nextLevelDefString);
		}

		//container_div.appendChild(lost_div);   For later use!

		if (outpost.upgrading>0){
			//<div class="outpost_list_construction"><div>Upgrading...</div></div>
			// def_div=createSingleElement('div', 'outpost_list_def_on'+def_added_class, '', '', '');

			ad2460.outpostVars.upgradeInProgress=true;
			var upgrading_div=createSingleElement('div', 'outpost_list_construction', '', '', '');
			var upgradeCompleteTime=convertToUTC(outpost.upgrade_complete_timestamp);
			var upgrading_div_2=createSingleElement('div', '', '', 'Upgrading until '+formatShortTime(upgradeCompleteTime), '');
			upgrading_div.appendChild(upgrading_div_2);
			container_div.appendChild(upgrading_div);
			var curTimer=returnTimerById('currentOutpostUpgradeTimer');
			var createNewTimer=false;
			if (curTimer==false){
				createNewTimer=true;
			}
			else if (curTimer.end>outpost.upgrade_complete_timestamp){
				createNewTimer=true;
			}

			if (createNewTimer==true){
				clearOutpostTimer();
				var timerId='currentOutpostUpgradeTimer';
				var new_level=outpost.level+1;
				$("#process_2_name").html(outpost.name+' upgrading to L '+new_level);
				$('#process_2_colour').show();
				registerNewTimer(timerId, ['process_2_eta'], ['process_2_progress'], outpost.upgrade_started_timestamp, outpost.upgrade_complete_timestamp, function(){fetchOwnOutposts();});
			}

		}


		container_div.appendChild(planet_image);
		if (outpost.planet_grace>ad2460.serverTime){
			var grace_image=createSingleElement('img', 'outpost_list_grace_img', '', 'images/icons/grace_icon.png', '');
			container_div.appendChild(grace_image);
			var grace_text=createSingleElement('div', 'outpost_list_grace_txt', '', ''+secondsToFullTimeNosecs(outpost.planet_grace-ad2460.serverTime), '');
			container_div.appendChild(grace_text);

		}

		container_div.appendChild(name_div);
		container_div.appendChild(coords_div);
		// container_div.appendChild(fill_div);
		container_div.appendChild(output_div);
		container_div.appendChild(potential_div);
		container_div.appendChild(def_div);
		container_div.appendChild(level_div);
		container_div.appendChild(transport_time_div);


		var resTiltString=returnResourceTiltString(outpost.world_type);
		if (resTiltString.length==7){
			if (resTiltString.substr(5,2)=='Hs'){
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/hs42.png">', '');
				container_div.appendChild(resdiv);
			}
			if (resTiltString.substr(5,2)=='In'){
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/in42.png">', '');
				container_div.appendChild(resdiv);
			}
			if (resTiltString.substr(5,2)=='Sr'){
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/sr42.png">', '');
				container_div.appendChild(resdiv);
			}
			if (resTiltString.substr(5,2)=='Nd'){
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/nd42.png">', '');
				container_div.appendChild(resdiv);
			}
		}

		if (resTiltString.length==2 || resTiltString.length==7 ){
			if (resTiltString.substr(0,2)=='Hs'){
				// insert Nhsimage
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/hs42.png">', '');
				container_div.appendChild(resdiv);
			}
			if (resTiltString.substr(0,2)=='In'){
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/in42.png">', '');
				container_div.appendChild(resdiv);
			}
			if (resTiltString.substr(0,2)=='Sr'){
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/sr42.png">', '');
				container_div.appendChild(resdiv);

			}
			if (resTiltString.substr(0,2)=='Nd'){
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/nd42.png">', '');
				container_div.appendChild(resdiv);

			}
		}
		/*
		if (resTiltString.length==4){
			if (resTiltString.substr(0,4)=='Even'){
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/hs42.png">', '');
				container_div.appendChild(resdiv);
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/in42.png">', '');
				container_div.appendChild(resdiv);
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/sr42.png">', '');
				container_div.appendChild(resdiv);
				var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/nd42.png">', '');
				container_div.appendChild(resdiv);

			}
		}
		*/
		if (resTiltString=='Even'){
			var resdiv=createSingleElement('div', 'outpost_list_tilt', '', '<img src="images/icons/elements/even42.png">', '');
			container_div.appendChild(resdiv);

		}

		parent.appendChild(container_div);

	}

	// And add the lost outposts!!
	for (i=0;i<ad2460.lostOutposts.length ;i++ ){
		var outpost=ad2460.lostOutposts[i];
		var coords=convertShortCoordsToLongCoords(outpost.x,outpost.y);
		var total_output=outpost.current_output_hassium+outpost.current_output_neodymium+outpost.current_output_strontium+outpost.current_output_indium;
		var max_output=outpost.max_output_hassium+outpost.max_output_neodymium+outpost.max_output_strontium+outpost.max_output_indium;
		var output_percentage=ad2460.outpostOutputPercentages[outpost.level];
		var total_stored=0;
		var max_storage=0;
		var stored_percentage=0;
		var potential=return_output_potential(outpost.max_output_hassium+outpost.max_output_neodymium+outpost.max_output_strontium+outpost.max_output_indium);
		var jump_range=1; // For all transport-vessels, will require more advanced calculations if they are tuned to be diffirent!
		var transportTime=calcEta(outpost.x, outpost.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, true, false );
		var transportTimeString=secondsToFullTimeNosecs(transportTime);



		var container_div=createSingleElement('div', 'outpost_list_lost_planet', '', '', 'zoomInToXY('+outpost.x+','+outpost.y+')');
		var lost_div=createSingleElement('div', 'outpost_list_lost', '', 'LOST', '');
		var bg_div=createSingleElement('div', 'outpost_list_lost_bg', '', '', '');

		var planet_image=createSingleElement('img', 'outpost_img outpost_list_planet_img', '', 'images/planets/outpost_planets/planettype'+outpost.world_type+'.jpg', '');
		var name_div=createSingleElement('div', 'main_header_title outpost_list_planet', '', ''+outpost.name, '');
		var coords_div=createSingleElement('div', 'outpost_list_coords', '', ''+coords.coordString, '');
		var fill_div=createSingleElement('div', 'outpost_list_fill', '', stored_percentage, '');
		var output_div=createSingleElement('div', 'outpost_list_output', '', '', '');
		var potential_div=createSingleElement('div', 'outpost_list_potential', '', potential+'/10', '');
		var level_div=createSingleElement('div', 'outpost_list_level', '', '', '');
		var transport_time_div=createSingleElement('div', 'outpost_list_tt', '', ''+transportTimeString, '');
		var def_div=createSingleElement('div', 'outpost_list_def_on_lost', '', '', '');

		var taker_div=createSingleElement('div', 'outpost_lost_taker', '', '', '');
		var taker_string="";
		if (outpost.taker_id>0){
			taker_string+="Stolen by: "+outpost.taker_name+"";
			if (outpost.taker_alliance_id>0){
				taker_string+=" <span class='alliance'> ("+outpost.taker_alliance_name+")</span>";
			}
			taker_div.innerHTML=taker_string;
		}


		var new_owner_div=createSingleElement('div', 'outpost_lost_new_owner', '', '', '');
		var new_owner_string="";
		if (outpost.new_owner_id>0){
			new_owner_string+="Held by: "+outpost.new_owner_name+"";
			if (outpost.new_owner_alliance_id>0){
				new_owner_string+=" <span class='alliance'> ("+outpost.new_owner_alliance_name+")</span>";
			}
			new_owner_div.innerHTML=new_owner_string;
		}

		container_div.appendChild(bg_div);
		container_div.appendChild(lost_div);
		container_div.appendChild(planet_image);
		container_div.appendChild(name_div);
		container_div.appendChild(coords_div);
		container_div.appendChild(fill_div);
		container_div.appendChild(output_div);
		container_div.appendChild(potential_div);
		container_div.appendChild(level_div);
		container_div.appendChild(transport_time_div);
		container_div.appendChild(def_div);
		container_div.appendChild(taker_div);
		container_div.appendChild(new_owner_div);



		parent.appendChild(container_div);
	}


	//myScrollToTop('outpost_list_scroller');
	//checkScrollButtonStatus('outpost_list_scroller');
}

function toggleOutpostDefense(event,planet_id){
	event.stopPropagation();
	var outpost=returnOutpostByPlanetId(planet_id);
	if (outpost==false){
		return;
	}
	outpost.call_for_def=1-outpost.call_for_def;
	renderOutpostList();
	$.post('actionhandler.pl', {action:'toggle_outpost_defense',planet_id:planet_id}, function(data){ parseInfo(data);});

}

function upgradeOutpostFromList(event, planet_id){
	event.stopPropagation();
	$.post('actionhandler.pl', {action:'initiate_outpost_upgrade', planet_id:planet_id}, function(data){ parseInfo(data);});

}

function updateSelectedOutpostAbandonTime(){
	if (ad2460.selected_outpost_planet_id){
		var outpost=returnOutpostByPlanetId(ad2460.selected_outpost_planet_id);
		if (outpost==false){
			$("#sel_outpost_abandon_timer_string").html('--');
		}
		else {
			if (ad2460.serverTime<outpost.last_owner_change_time+( 2*24*3600 ) ) {
				var remaining=outpost.last_owner_change_time+( 2*24*3600 )-ad2460.serverTime;
				$("#sel_outpost_abandon_timer_string").html(secondsToFullTimeNosecs(remaining));
			}
			else {
				$("#sel_outpost_abandon_timer_string").html('Now');
			}

		}
	}
}

function selectDefaultOutpost(){
	var i=0;
	var id=0;
	for (i=0;i<ad2460.outposts.length ;i++ ){
		if (id==0){
			id=ad2460.outposts[i].planet_id;
		}
	}
	selectOutpost(id, false);
}

function selectOutpost(planet_id, openTheBox){
	var outpost=returnOutpostByPlanetId(planet_id);
	if (outpost==false){
		return;
	}

	ad2460.selected_outpost_planet_id=outpost.planet_id;
	/*
	We have a lot of id's to update here
	The main-panel first!
	selected_outpost_main_mini_level
	selected_outpost_main_total_output
	selected_outpost_main_utilization
	selected_outpost_main_name
	selected_outpost_status_corner_image
	selected_outpost_fill_image
	selected_outpost_planet_image
	*/
	updateSelectedOutpostAbandonTime();

	var upgradeDisabled=false;


	$("#selected_outpost_main_mini_level").html('L '+outpost.level);
	var total_output=outpost.current_output_hassium+outpost.current_output_indium+outpost.current_output_strontium+outpost.current_output_neodymium;
	$("#selected_outpost_main_total_output").html(prettyPrint(total_output)+' u/h');

	var max_total_output=outpost.max_output_hassium+outpost.max_output_indium+outpost.max_output_strontium+outpost.max_output_neodymium;
	var utilizationPercent=Math.round(total_output*100/max_total_output);

	$("#selected_outpost_main_utilization").html(utilizationPercent+' %');
	$("#selected_outpost_main_name").html(outpost.name);
	$("#selected_outpost_name").html(outpost.name);
	$("#selected_outpost_name").attr("contenteditable","true");
	var imgSrc="images/fixed/outpostportrait200x200.jpg";
	if (outpost.level<4){
		imgSrc="images/fixed/outpost_lvl_1_3.jpg";
	}
	else if (outpost.level<7){
		imgSrc="images/fixed/outpost_lvl_4_6.jpg";
	}
	else if (outpost.level<11){
		imgSrc="images/fixed/outpost_lvl_7_9.jpg";
	}

	$("#selected_outpost_portrait").attr("src",imgSrc);

	if (outpost.inactive==0){
		$("#new_outpost_activate_button").html("Deactivate outpost");
	}
	else {
		$("#new_outpost_activate_button").html("Activate outpost");
	}

	var typeTabName=document.getElementById('selected_outpost_name');
	typeTabName.onkeydown=function(event){
		if (event.which!=8 && event.keyCode!=8 && event.which!=16 && event.keyCode!=16 && event.which!=37 && event.keyCode!=37 && event.which!=38 && event.keyCode!=38 && event.which!=39 && event.keyCode!=39 && event.which!=40 && event.keyCode!=40 && event.which!=46 && event.keyCode!=46 && event.which!=36 && event.keyCode!=36 && event.which!=35 && event.keyCode!=35 ) {
			if (event.srcElement.innerHTML.length>16){
				//console.log("It's 16 long, stop !!!");
				event.preventDefault;
				return false;
			}
		}
		if (event.which==13 || event.keyCode==13) {
			event.preventDefault;
		}
	}


	document.getElementById('selected_outpost_name').onkeypress=function(event){
		if (event.which==13 || event.keyCode==13) {
			//console.log(event.which,event.keyCode);
			if (document.getElementById('selected_outpost_name').innerHTML.length>3){
				updateOutpostName(document.getElementById('selected_outpost_name').innerHTML);
				document.getElementById('selected_outpost_name').blur();
				return false;
			}
			else {
				systemFeedback('Error','Too short!', 1, 3);
				var o=returnOutpostByPlanetId(ad2460.selected_outpost_planet_id);
				removeChildNodes('selected_outpost_name');
				$("#selected_outpost_name").html(o.name);
				return false;

			}
		}
	}

/*	typeTabName.onkeypress=function(event){
		if (event.which==13 || event.keyCode==13) {
			if (event.srcElement.innerHTML.length>3){
				updateOutpostName(event.srcElement.innerHTML);
				event.srcElement.blur();
				return false;
			}
			else {
				systemFeedback('Error','Too short!', 1, 3);
			}
		}
	}
*/


	if (utilizationPercent>99){
		document.getElementById('selected_outpost_status_corner_image').src='images/tiles/panelborders/bottomrightoff.png';
	}
	else if (outpost.upgrading==1){
		document.getElementById('selected_outpost_status_corner_image').src='images/tiles/panelborders/bottomrightpaused.png';
	}
	else if (outpost.inactive==1){
		document.getElementById('selected_outpost_status_corner_image').src='images/tiles/panelborders/bottomrightoff.png';
	}
	else {
		document.getElementById('selected_outpost_status_corner_image').src='images/tiles/panelborders/bottomright.png';
	}

	var total_stored=outpost.stored_hassium+outpost.stored_neodymium+outpost.stored_strontium+outpost.stored_indium;
	var max_storage=return_outpost_storage(outpost.level);
	var stored_percentage=Math.floor(total_stored*100/max_storage);

	var className='zerofill';
	var imgSrc='images/tiles/outpostcornerinside0.png';

	if (stored_percentage<10){
		className='zerofill';
		imgSrc='images/tiles/outpostcornerinside0.png';
	}
	else if (stored_percentage<30){
		className='twentyfill';
		imgSrc='images/tiles/outpostcornerinside20.png';
	}
	else if (stored_percentage<50){
		className='fortyfill';
		imgSrc='images/tiles/outpostcornerinside40.png';
	}
	else if (stored_percentage<70){
		className='sixtyfill';
		imgSrc='images/tiles/outpostcornerinside60.png';
	}
	else if (stored_percentage<90){
		className='eightyfill';
		imgSrc='images/tiles/outpostcornerinside80.png';
	}
	else {
		className='hundredfill';
		imgSrc='images/tiles/outpostcornerinside100.png';
	}

	$("#selected_outpost_fill_image").attr("src",imgSrc).removeClass('zerofill').removeClass('twentyfill').removeClass('fortyfill').removeClass('sixtyfill').removeClass('eightyfill').removeClass('hundredfill').addClass(className);
	$("#selected_outpost_planet_image").attr("src",'images/planets/outpost_planets/planettype'+outpost.world_type+'.jpg');

	var coords=convertShortCoordsToLongCoords(outpost.x,outpost.y);
	$("#selected_outpost_coords").html(coords.coordString);
	$("#selected_outpost_coords").attr("onclick","specialOutpostZoom(event,"+outpost.x+","+outpost.y+")");
	// $("#selected_outpost_stored_hs").html(prettyPrint(outpost.stored_hassium));
	// $("#selected_outpost_stored_in").html(prettyPrint(outpost.stored_indium));
	// $("#selected_outpost_stored_sr").html(prettyPrint(outpost.stored_strontium));
	// $("#selected_outpost_stored_nd").html(prettyPrint(outpost.stored_neodymium));

	var potential=return_output_potential(outpost.max_output_hassium+outpost.max_output_neodymium+outpost.max_output_strontium+outpost.max_output_indium);

	var recommendedStrength=1000;

	var canAlwaysHitWith=Math.ceil(outpostPotentialToMaxDefStrength(potential)/5/10*outpost.level);
	if (canAlwaysHitWith>1000){
		recommendedStrength=canAlwaysHitWith;
	}

	var recommendedStrengthK=recommendedStrength/1000;


	$("#selected_outpost_potential").html(potential+'/10');
	$("#selected_outpost_operating_capacity").html(utilizationPercent+'%');
	$("#selected_outpost_recommended_defense").html(prettyPrint(recommendedStrength));

	// find the current present strength
	var i=0;
	var present_strength=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].current_x==outpost.x && ad2460.myFleets[i].current_y==outpost.y && ad2460.myFleets[i].current_mission_target_type==0  && ad2460.myFleets[i].current_mission_target_type==0  && ad2460.myFleets[i].current_mission_target_x==0  && ad2460.myFleets[i].current_mission_target_y==0){
				present_strength+=ad2460.myFleets[i].strength;
		}
	}

	$("#selected_outpost_present_defense").html(prettyPrint(present_strength));


	if (present_strength<recommendedStrength){
		$("#selected_outpost_present_defense").addClass("notenough");
	}
	else {
		$("#selected_outpost_present_defense").removeClass("notenough");
	}



	// $("#selected_outpost_total_storage").html(prettyPrint(max_storage));
	// $("#selected_outpost_stored_resources").html(prettyPrint(total_stored));

	var free_storage=max_storage-total_stored;
	var timeToFull=free_storage/total_output;
	//console.log(free_storage, timeToFull, total_stored, total_output);
	var timeToFullString=Math.floor(timeToFull+1)+' hours';
	if (timeToFull==0){
		timeToFullString="Full!";
	}


	// $("#selected_outpost_time_to_max").html(timeToFullString);

	var presentCargoSpace=0;
	var cargoSpaceBonusPercent=returnCargoCapacityBonusPercent();

	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].current_x==outpost.x && ad2460.myFleets[i].current_y==outpost.y && ad2460.myFleets[i].current_mission_target_type==0  && ad2460.myFleets[i].current_mission_target_type==0  && ad2460.myFleets[i].current_mission_target_x==0  && ad2460.myFleets[i].current_mission_target_y==0){
			// The fleet is at the outpost, hooraah!
			var thisFleet=ad2460.myFleets[i];
			var theShips=thisFleet.ships;
			var a=0;
			for (a=0;a<theShips.length ;a++ ){
				presentCargoSpace+=returnCargoCapacity(theShips[a].ship_type_id);
				presentCargoSpace+=Math.floor(presentCargoSpace*cargoSpaceBonusPercent/100)
				presentCargoSpace=presentCargoSpace-theShips[a].h_cargo-theShips[a].n_cargo-theShips[a].s_cargo-theShips[a].i_cargo;
			}
		}
	}


	// $("#selected_outpost_transport_present").html(prettyPrint(presentCargoSpace));

	var transportTime=calcEta(outpost.x, outpost.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, true, false );
	var transportTimeString=secondsToFullTimeNosecs(transportTime);
	// $("#selected_outpost_transport_time").html(transportTimeString);

	var hs_percent=Math.round(outpost.current_output_hassium*100/total_output);
	var in_percent=Math.round(outpost.current_output_indium*100/total_output);
	var sr_percent=Math.round(outpost.current_output_strontium*100/total_output);
	var nd_percent=Math.round(outpost.current_output_neodymium*100/total_output);

	$("#selected_outpost_output_percent_hs").html(hs_percent+'%');
	$("#selected_outpost_output_percent_in").html(in_percent+'%');
	$("#selected_outpost_output_percent_sr").html(sr_percent+'%');
	$("#selected_outpost_output_percent_nd").html(nd_percent+'%');

	$("#selected_outpost_output_hs").html(prettyPrint(outpost.current_output_hassium));
	$("#selected_outpost_output_in").html(prettyPrint(outpost.current_output_indium));
	$("#selected_outpost_output_sr").html(prettyPrint(outpost.current_output_strontium));
	$("#selected_outpost_output_nd").html(prettyPrint(outpost.current_output_neodymium));

	$("#selected_outpost_prod_hs_current").html(prettyPrint(outpost.current_output_hassium));
	$("#selected_outpost_prod_hs_current_shadow").html(prettyPrint(outpost.current_output_hassium));
	$("#selected_outpost_prod_in_current").html(prettyPrint(outpost.current_output_indium));
	$("#selected_outpost_prod_in_current_shadow").html(prettyPrint(outpost.current_output_indium));
	$("#selected_outpost_prod_sr_current").html(prettyPrint(outpost.current_output_strontium));
	$("#selected_outpost_prod_sr_current_shadow").html(prettyPrint(outpost.current_output_strontium));
	$("#selected_outpost_prod_nd_current").html(prettyPrint(outpost.current_output_neodymium));
	$("#selected_outpost_prod_nd_current_shadow").html(prettyPrint(outpost.current_output_neodymium));

	var upgradeTime=ad2460.outpostUpgradeTimeInHours[outpost.level];
	var nextPercent=ad2460.outpostOutputPercentages[outpost.level+1];
	var nextStorage=ad2460.outpostStorageLevels[outpost.level+1];
	var next_hassium_string="-";
	var next_inidum_string="-";
	var next_strontium_string="-";
	var next_neodymium_string="-";

	if (outpost.level<10){
		next_hassium_string=prettyPrint(Math.floor(outpost.max_output_hassium*nextPercent/100));
		next_inidum_string=prettyPrint(Math.floor(outpost.max_output_indium*nextPercent/100));
		next_strontium_string=prettyPrint(Math.floor(outpost.max_output_strontium*nextPercent/100));
		next_neodymium_string=prettyPrint(Math.floor(outpost.max_output_neodymium*nextPercent/100));
	}

	$("#selected_outpost_prod_hs_next").html(next_hassium_string);
	$("#selected_outpost_prod_hs_next_shadow").html(next_hassium_string);
	$("#selected_outpost_prod_in_next").html(next_inidum_string);
	$("#selected_outpost_prod_in_next_shadow").html(next_inidum_string);
	$("#selected_outpost_prod_sr_next").html(next_strontium_string);
	$("#selected_outpost_prod_sr_next_shadow").html(next_strontium_string);
	$("#selected_outpost_prod_nd_next").html(next_neodymium_string);
	$("#selected_outpost_prod_nd_next_shadow").html(next_neodymium_string);

	$("#selected_outpost_upgrade_cost_hs").removeClass("notenough");
	$("#selected_outpost_upgrade_cost_in").removeClass("notenough");
	$("#selected_outpost_upgrade_cost_sr").removeClass("notenough");
	$("#selected_outpost_upgrade_cost_nd").removeClass("notenough");


	if (ad2460.resources.hassium<ad2460.outpostUpgradeCosts[outpost.level].hassium){
		$("#selected_outpost_upgrade_cost_hs").addClass("notenough");
	}
	if (ad2460.resources.indium<ad2460.outpostUpgradeCosts[outpost.level].indium){
		$("#selected_outpost_upgrade_cost_in").addClass("notenough");
	}
	if (ad2460.resources.strontium<ad2460.outpostUpgradeCosts[outpost.level].strontium){
		$("#selected_outpost_upgrade_cost_sr").addClass("notenough");
	}
	if (ad2460.resources.neodymium<ad2460.outpostUpgradeCosts[outpost.level].neodymium){
		$("#selected_outpost_upgrade_cost_nd").addClass("notenough");
	}


	$("#selected_outpost_upgrade_cost_hs").html(prettyPrint(ad2460.outpostUpgradeCosts[outpost.level].hassium));
	$("#selected_outpost_upgrade_cost_in").html(prettyPrint(ad2460.outpostUpgradeCosts[outpost.level].indium));
	$("#selected_outpost_upgrade_cost_sr").html(prettyPrint(ad2460.outpostUpgradeCosts[outpost.level].strontium));
	$("#selected_outpost_upgrade_cost_nd").html(prettyPrint(ad2460.outpostUpgradeCosts[outpost.level].neodymium));

	// $("#selected_outpost_next_total_storage").html(prettyPrint(nextStorage));
	$("#selected_outpost_next_operating_capacity").html(nextPercent+' %');
	$("#selected_outpost_next_upgrade_time").html(secondsToFullTime(upgradeTime*3600));
	if (upgradeTime==0){
		// $("#selected_outpost_next_total_storage").html('Maxed out');
		$("#selected_outpost_next_operating_capacity").html('Maxed out');
		$("#selected_outpost_next_upgrade_time").html('Maxed out');

	}

	$("#present_amount").html(prettyPrint(outpost.stored_hassium+outpost.stored_indium+outpost.stored_strontium+outpost.stored_neodymium));

	$("#selected_outpost_upgrade_button").attr("onclick","upgradeOutpostClick()");
	$("#selected_outpost_upgrade_button_text").html("Upgrade");



	if (outpost.upgrading==1){
		$("#selected_outpost_upgrade_cost_hs").html('-');
		$("#selected_outpost_upgrade_cost_in").html('-');
		$("#selected_outpost_upgrade_cost_sr").html('-');
		$("#selected_outpost_upgrade_cost_nd").html('-');
		$("#selected_outpost_upgrade_button").attr("onclick","cancelUpgrade()");
		$("#selected_outpost_upgrade_button_text").html("Cancel upgrade");
		$("#selected_outpost_next_upgrade_time").html(secondsToFullTimeNosecs(outpost.upgrade_complete_timestamp-ad2460.serverTime));

	}
	/*else if (ad2460.outpostVars.upgradeInProgress==true){
		// Another one is being upgraded!
		$("#selected_outpost_upgrade_button_text").html("Busy");
		$("#selected_outpost_upgrade_button").hide();
		$("#selected_outpost_upgrade_button_disabled").show();
		$("#selected_outpost_upgrade_button_disabled_text").html("Busy");

	}
	*/

	if (outpost.inactive==1){
		$("#selected_outpost_upgrade_button").hide();
		$("#selected_outpost_upgrade_button_disabled").show();
		$("#selected_outpost_upgrade_cost_hs").html('-');
		$("#selected_outpost_upgrade_cost_in").html('-');
		$("#selected_outpost_upgrade_cost_sr").html('-');
		$("#selected_outpost_upgrade_cost_nd").html('-');
		$("#selected_outpost_upgrade_button").attr("onclick",null);
		$("#selected_outpost_upgrade_button_text").html("Inactive");
	}

	if (outpost.level==10){
		$("#selected_outpost_upgrade_button").hide();
		$("#selected_outpost_upgrade_button_disabled").show();
		$("#selected_outpost_upgrade_cost_hs").html('-');
		$("#selected_outpost_upgrade_cost_in").html('-');
		$("#selected_outpost_upgrade_cost_sr").html('-');
		$("#selected_outpost_upgrade_cost_nd").html('-');
		$("#selected_outpost_upgrade_button").attr("onclick",null);
		$("#selected_outpost_upgrade_button_disabled_text").html("Maxed out");
	}

	$("#selected_outpost_upgrade_button").show();
	$("#selected_outpost_upgrade_button_disabled").hide();

	var maxOpLevel=4;
	var dev1=returnGameObjectById(233);
	if (dev1.user_id==ad2460.user_id && dev1.upgrading==0){
		maxOpLevel=7;
	}
	var dev1=returnGameObjectById(234);
	if (dev1.user_id==ad2460.user_id && dev1.upgrading==0){
		maxOpLevel=10;
	}

	if (outpost.upgrading==0){
		if (outpost.level>=maxOpLevel){
			$("#selected_outpost_upgrade_button").hide();
			$("#selected_outpost_upgrade_button_disabled_text").html("Dev. required");
			$("#selected_outpost_upgrade_button_disabled").show();
			if(outpost.level==10){
				$("#selected_outpost_upgrade_button_disabled_text").html("Max level");
			}
		}
	}


	/*
		buttonText.innerHTML='Cancel Upgrade';
		hsCost.innerHTML='-';
		ndCost.innerHTML='-';
		srCost.innerHTML='-';
		inCost.innerHTML='-';
		upgradeCostButton.className='disablebutton';
		upgradeCostButton.style.display='block';
		//upgradeCostButton.onclick='cancelUpgrade('+outpost.planet_id+')';
		upgradeCostButton.setAttribute('onclick','cancelUpgrade('+outpost.planet_id+')');
	*/

	// Seems we need to render some fleets too...
	// if present: in 'selected_outpost_fleets_container' pls
	populateOutpostFleets(outpost);
	populateOutpostDefensiveOverview(outpost);

	if (openTheBox==true){
		$("#outpost_mainpanel").click();
		removeChildNodes('selected_outpost_fleetdetails');

		$("#selected_outpost_fleetdetails").hide();
		$("#selected_outpost_fleet_overview").show();
	}

}

function outpostUpgradeDisabledClick(){
	// this function must read the button text in order to pick up on the status!
	var button_text=$("#selected_outpost_upgrade_button_disabled_text").html();

	if (button_text=='Dev. required'){
		showSimpleBox("Development required","Upgrading an outpost beyond level 4 requires the development of the <span style='cursor:pointer;color:orange' onclick='showGameInfoBox(233,event)'>Advanced Outpost</span>. This requires Development Station Level 2 and the research <span style='cursor:pointer;color:orange' onclick='showGameInfoBox(111,event)'>Mass Volume Dynamics</span>.<br>Upgrading an outpost beyond level 7 requires the development of the <span style='cursor:pointer;color:orange' onclick='showGameInfoBox(234,event)'>Superior Outpost</span>. This requires Development Station Level 3 and the research <span style='cursor:pointer;color:orange' onclick='showGameInfoBox(117,event)'>Advanced Orbital Dynamics</span>.",'hideSimpleBox();')
	}
}

function specialOutpostZoom(event, x,y){
	zoomInToXY(x,y);
	event.stopPropagation();
	return false;

}

function setOutpostSorting(sorting){
	if (ad2460.outpostVars.sorting=='output' && sorting=='output' ){
		ad2460.outpostVars.sorting='output_reverse';
	}
	else if (ad2460.outpostVars.sorting=='level' && sorting=='level' ){
		ad2460.outpostVars.sorting='level_reverse';
	}
	else if (ad2460.outpostVars.sorting=='potential' && sorting=='potential' ){
		ad2460.outpostVars.sorting='potential_reverse';
	}
	else if (ad2460.outpostVars.sorting=='traveltime' && sorting=='traveltime' ){
		ad2460.outpostVars.sorting='traveltime_reverse';
	}
	else if (ad2460.outpostVars.sorting=='def' && sorting=='def' ){
		ad2460.outpostVars.sorting='def_reverse';
	}
	else {
		ad2460.outpostVars.sorting=sorting;
	}




	renderOutpostList();
}

function sortOutposts(){

	if (ad2460.outpostVars.sorting=='default'){
		ad2460.outposts.sort(potentialSort_reverse);
		ad2460.lostOutposts.sort(potentialSort_reverse);
	}
	if (ad2460.outpostVars.sorting=='level'){
		ad2460.outposts.sort(levelSort);
		ad2460.lostOutposts.sort(levelSort);
	}
	if (ad2460.outpostVars.sorting=='level_reverse'){
		ad2460.outposts.sort(levelSort_reverse);
		ad2460.lostOutposts.sort(levelSort_reverse);
	}

	if (ad2460.outpostVars.sorting=='fill'){
		ad2460.outposts.sort(fillSort);
		ad2460.lostOutposts.sort(potentialSort);
	}
	if (ad2460.outpostVars.sorting=='traveltime'){
		ad2460.outposts.sort(traveltimeSort);
		ad2460.lostOutposts.sort(traveltimeSort);
	}
	if (ad2460.outpostVars.sorting=='traveltime_reverse'){
		ad2460.outposts.sort(traveltimeSort_reverse);
		ad2460.lostOutposts.sort(traveltimeSort_reverse);
	}
	if (ad2460.outpostVars.sorting=='potential'){
		ad2460.outposts.sort(potentialSort);
		ad2460.lostOutposts.sort(potentialSort);
	}
	if (ad2460.outpostVars.sorting=='potential_reverse'){
		ad2460.outposts.sort(potentialSort_reverse);
		ad2460.lostOutposts.sort(potentialSort);
	}
	if (ad2460.outpostVars.sorting=='output'){
		ad2460.outposts.sort(outputSort);
		ad2460.lostOutposts.sort(potentialSort);
	}
	if (ad2460.outpostVars.sorting=='output_reverse'){
		ad2460.outposts.sort(outputSort_reverse);
		ad2460.lostOutposts.sort(potentialSort);
	}
	if (ad2460.outpostVars.sorting=='def'){
		ad2460.outposts.sort(defSort);
		ad2460.lostOutposts.sort(potentialSort);
	}
	if (ad2460.outpostVars.sorting=='def_reverse'){
		ad2460.outposts.sort(defSort_reverse);
		ad2460.lostOutposts.sort(potentialSort);
	}
}

function levelSort(a,b){
	if (a.level+(a.planet_id/10000000) < b.level+(b.planet_id/10000000)){
		return 1;
	}
	if (a.level+(a.planet_id/10000000) > b.level+(b.planet_id/10000000)){
		return -1;
	}
	return 0;
}

function levelSort_reverse(a,b){
	if (b.level+(b.planet_id/10000000) < a.level+(a.planet_id/10000000)){
		return 1;
	}
	if (b.level+(b.planet_id/10000000) > a.level+(a.planet_id/10000000)){
		return -1;
	}
	return 0;
}

function defSort(a,b){
	if (a.returnPresentStrength()+(a.planet_id/10000000) < b.returnPresentStrength()+(b.planet_id/10000000)){
		return 1;
	}
	if (a.returnPresentStrength()+(a.planet_id/10000000) > b.returnPresentStrength()+(b.planet_id/10000000)){
		return -1;
	}
	return 0;

}

function defSort_reverse(a,b){
	if (b.returnPresentStrength()+(b.planet_id/10000000) < a.returnPresentStrength()+(a.planet_id/10000000)){
		return 1;
	}
	if (b.returnPresentStrength()+(b.planet_id/10000000) > a.returnPresentStrength()+(a.planet_id/10000000)){
		return -1;
	}
	return 0;
}

function fillSort(a,b){
	if (a.returnFillPercent()+(a.planet_id/10000000) < b.returnFillPercent()+(b.planet_id/10000000)){
		return 1;
	}
	if (a.returnFillPercent()+(a.planet_id/10000000) > b.returnFillPercent()+(b.planet_id/10000000)){
		return -1;
	}
	return 0;
}
function traveltimeSort(a,b){
	if (a.returnTransportTime()+(a.planet_id/10000000) < b.returnTransportTime()+(b.planet_id/10000000)){
		return -1;
	}
	if (a.returnTransportTime()+(a.planet_id/10000000) > b.returnTransportTime()+(b.planet_id/10000000)){
		return 1;
	}
	return 0;
}
function traveltimeSort_reverse(a,b){
	if (b.returnTransportTime()+(b.planet_id/10000000) < a.returnTransportTime()+(a.planet_id/10000000)){
		return -1;
	}
	if (b.returnTransportTime()+(b.planet_id/10000000) > a.returnTransportTime()+(a.planet_id/10000000)){
		return 1;
	}
	return 0;
}



function potentialSort(a,b){
	if (a.returnPotential()+(a.planet_id/10000000) > b.returnPotential()+(b.planet_id/10000000)){
		return 1;
	}
	if (a.returnPotential()+(a.planet_id/10000000) < b.returnPotential()+(b.planet_id/10000000)){
		return -1;
	}
	return 0;
}

function potentialSort_reverse(a,b){
	if (b.returnPotential()+(b.planet_id/10000000) > a.returnPotential()+(a.planet_id/10000000)){
		return 1;
	}
	if (b.returnPotential()+(b.planet_id/10000000) < a.returnPotential()+(a.planet_id/10000000)){
		return -1;
	}
	return 0;
}

function outputSort(a,b){
	if (a.returnTotalOutput()+(a.planet_id/10000000) < b.returnTotalOutput()+(b.planet_id/10000000)){
		return 1;
	}
	if (a.returnTotalOutput()+(a.planet_id/10000000) > b.returnTotalOutput()+(b.planet_id/10000000)){
		return -1;
	}
	return 0;
}

function outputSort_reverse(a,b){
	if (b.returnTotalOutput()+(b.planet_id/10000000) < a.returnTotalOutput()+(a.planet_id/10000000)){
		return 1;
	}
	if (b.returnTotalOutput()+(b.planet_id/10000000) > a.returnTotalOutput()+(a.planet_id/10000000)){
		return -1;
	}
	return 0;
}

function initiateAutoTransport(){
	$.post('actionhandler.pl', {action:'auto_transport'}, function(data){ parseInfo(data);});
	play_multi_sound("sfx_click3");
}
// Military functions
function fetchMyFleets(callback_string){
	if (ad2460.fleetvars.lastFetch<ad2460.serverTime-1){
		$.post('actionhandler.pl', {action:'fetch_fleets'}, function(data){ parseInfo(data);eval(callback_string);});
		ad2460.fleetvars.lastFetch=ad2460.serverTime;
	}
}

function eraseMyFleets(){
	ad2460.myFleets=[];
}

function updateCapitalShipCount(){
	var counter=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].storage_fleet==0){
			counter=counter+ad2460.myFleets[i].shipcount;
		}
	}
	ad2460.fleetvars.total_capital_ship_count=counter;
}



function returnStorageFleet(){
	var i=0;
	for (i=0;i<ad2460.myFleets.length ; i++ ){
		if (ad2460.myFleets[i].storage_fleet==1){
			return ad2460.myFleets[i];
		}
	}
	return false;
}

function returnHomeworldFleet(){
	var i=0;
	for (i=0;i<ad2460.myFleets.length ; i++ ){
		if (ad2460.myFleets[i].homeworld_fleet==1){
			return ad2460.myFleets[i];
		}
	}
	return false;
}

function updateFleetManagementStats(){
	var sFleets=0;
	var sShips=0;
	var sStrength=0;
	var dStrength=0;

	var sWon=0;
	var sLost=0;
	var sUpkeep=0;
	ad2460.fleetvars.total_shortage_for_all_fleets=0;
	ad2460.fleetvars.fleets_with_shortage=0;

	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].storage_fleet==0){
			sFleets++;
			sShips+=ad2460.myFleets[i].shipcount;
			if (ad2460.myFleets[i].auto_def==0){
				sStrength+=ad2460.myFleets[i].strength;
			}
			else {
				dStrength+=ad2460.myFleets[i].strength;
			}
			sWon+=ad2460.myFleets[i].wins;
			sLost+=ad2460.myFleets[i].losses;
			ad2460.fleetvars.total_shortage_for_all_fleets+=ad2460.myFleets[i].shortage;
			if (ad2460.myFleets[i].shortage>0) {
				ad2460.fleetvars.fleets_with_shortage++;
			}

			if (ad2460.myFleets[i].bank_fleet==0){
				sUpkeep+=ad2460.myFleets[i].upkeep.hassium;
				sUpkeep+=ad2460.myFleets[i].upkeep.indium;
				sUpkeep+=ad2460.myFleets[i].upkeep.strontium;
				sUpkeep+=ad2460.myFleets[i].upkeep.neodymium;
			}
		}
	}

	$("#my_fleet_count").html(sFleets);
	$("#my_ship_count").html(sShips);
	$("#my_fleet_strength").html(prettyPrint(sStrength));
	$("#my_fleet_op_strength").html(prettyPrint(dStrength));
	$("#my_fleet_wins").html(sWon);
	$("#my_fleet_losses").html(sLost);
	$("#my_fleet_total_upkeep").html(prettyPrint(sUpkeep));

	$("#my_global_shortage").html(ad2460.fleetvars.total_shortage_for_all_fleets);
	$("#my_fleets_with_shortage").html(ad2460.fleetvars.fleets_with_shortage+' Fleets');

	updateMilitaryOverview();
	updateLiveScoutCounter();

	// Here we can check for possible invalid selected fleets, typically transport-fleets that no longer exists.
	if (ad2460.fleetvars.fleet_movement_selected_fleet_id>0){
		var test=returnFleetById(ad2460.fleetvars.fleet_movement_selected_fleet_id);
		if (test==false){
			fleetMovementSelectFleet(-1);
		}
		else{
			fleetMovementSelectFleet(ad2460.fleetvars.fleet_movement_selected_fleet_id);
		}
	}
	if (ad2460.fleetvars.selected_fleet_id>0){
		var test=returnFleetById(ad2460.fleetvars.selected_fleet_id);
		if (test==false){
			var fleet=returnBaseFleet();
			if (fleet!=false){
				selectFleet(fleet.fleet_id);
			}
		}
	}
}

function returnActualHangarSpace(ship_type_id,num){
	if (typeof num == "undefined"){
		num=1;
	}
	var unit=returnGameObjectById(ship_type_id);
	if (unit==false){
		return 0;
	}
	var hangar_space=unit.hangar_capacity;
	var o=returnGameObjectById(118);
	if (o.user_id=ad2460.user_id && o.upgrading==0){
		if (unit.vesselclass=='Carrier'){
			hangar_space+=2;
		}

	}
	var o=returnGameObjectById(125);
	if (o.user_id=ad2460.user_id && o.upgrading==0){
		if (unit.tech=='Matter'){
			if (unit.vesselclass=='Carrier'){
				hangar_space+=2;
			}
		}
	}
	var o=returnGameObjectById(137);
	if (o.user_id=ad2460.user_id && o.upgrading==0){
		if (unit.tech=='Matter'){
			if (unit.vesselclass=='Carrier'){
				hangar_space+=4;
			}
		}
	}

	var o=returnGameObjectById(841);
	if (unit.tech=='Matter'){
		if (unit.vesselclass=='Carrier'){
			// hangar_space+=(o.points*1);
		}
	}

	return hangar_space;
}

function updateMilitaryOverview(){
	var fleets=0;
	var capital_ships=0;
	var minor_ships=0;
	var firepower=0;
	var alliance_fleets=0;
	var active_alliance_fleets=0;
	var commanders=0;
	var top_rank=0;
	var active_intelligence=0;
	var active_missions=0;
	var active_alliance_missions=0;

	var total_upkeep_h=0;
	var total_upkeep_n=0;
	var total_upkeep_s=0;
	var total_upkeep_i=0;

	var total_hangar_capacity=0;



	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].storage_fleet==0 && ad2460.myFleets[i].auto_def==0){
			fleets++;
			capital_ships+=ad2460.myFleets[i].shipcount;
			var x=0;
			for (x=0;x<ad2460.myFleets[i].ships.length;x++){
				if(ad2460.myFleets[i].ships[x].ship_type_id>=400 && ad2460.myFleets[i].ships[x].ship_type_id<=410){
					minor_ships++;
				}
				total_hangar_capacity+=returnHangarCapacity(ad2460.myFleets[i].ships[x].ship_type_id);
			}
			firepower+=ad2460.myFleets[i].strength;
			total_upkeep_h+=ad2460.myFleets[i].upkeep.hassium;
			total_upkeep_n+=ad2460.myFleets[i].upkeep.neodymium;
			total_upkeep_s+=ad2460.myFleets[i].upkeep.strontium;
			total_upkeep_i+=ad2460.myFleets[i].upkeep.indium;
			if (ad2460.myFleets[i].alliance_fleet==1){
				alliance_fleets++;
				if (ad2460.myFleets[i].status==0){
					active_alliance_fleets++;
				}
			}
		}
	}

	for (i=0;i<ad2460.myCommanders.length ;i++ ){
		var c=ad2460.myCommanders[i];
		if (c.hired==1){
			commanders++;
			if (c.rank>top_rank){
				top_rank=c.rank;
			}
		}
	}

	active_intelligence=ad2460.intel.missions.length;

	// Note: Don't forget
	// var active_missions=0;
	// var active_alliance_missions=0;

	var topRankObj=returnCommanderRankNameObject(top_rank);
	var topRankString=topRankObj.longRank;

	$("#mo_fleets").html(fleets);
	$("#mo_capital_ships").html(capital_ships);
	$("#mo_minor_ships").html(minor_ships+' / '+total_hangar_capacity);
	$("#mo_firepower").html(prettyPrint(firepower));
	$("#mo_a_fleets").html(alliance_fleets);
	$("#mo_active_a_fleets").html(active_alliance_fleets);
	$("#mo_commanders").html(commanders);
	$("#mo_top_rank").html(topRankString);
	$("#mo_active_intelligence").html(active_intelligence);
	//$("#mo_active_missions").html(active_missions);
	//$("#mo_active_a_missions").html(active_alliance_missions);
	var obj=returnMaxAgents();
	$("#mo_spies_infiltrators").html(obj.spies+'/'+obj.infiltrators);

	$("#mo_upkeep_hassium").removeClass('notenough').html(prettyPrint(total_upkeep_h)+' u/h');
	$("#mo_upkeep_neodymium").removeClass('notenough').html(prettyPrint(total_upkeep_n)+' u/h');
	$("#mo_upkeep_strontium").removeClass('notenough').html(prettyPrint(total_upkeep_s)+' u/h');
	$("#mo_upkeep_indium").removeClass('notenough').html(prettyPrint(total_upkeep_i)+' u/h');

	if (ad2460.resources.hassium<total_upkeep_h){	$("#mo_upkeep_hassium").addClass('notenough');	}
	if (ad2460.resources.neodymium<total_upkeep_n){	$("#mo_upkeep_neodymium").addClass('notenough');	}
	if (ad2460.resources.strontium<total_upkeep_s){	$("#mo_upkeep_strontium").addClass('notenough');	}
	if (ad2460.resources.indium<total_upkeep_i){	$("#mo_upkeep_indium").addClass('notenough');	}


	var upkeepBonus=returnUpkeepBonusPercent();

	$("#current_upkeep_bonus").html(upkeepBonus+' %');

}


function addFleet(fleet_id, owner_id, fleet_name, commander_id, shipcount, strength, battles , wins,  losses, efficiency, shortage, current_x,current_y, org_mission_target_type,org_mission_target, org_mission_target_x, org_mission_target_y, org_mission_type, current_mission_target_type, current_mission_target,current_mission_target_x,current_mission_target_y,current_mission_type,next_mission_target_type, next_mission_target,next_mission_target_x,next_mission_target_y,next_mission_type, next_hyperspace_jump_time, last_hyperspace_jump_time, jump_range,mission_status,status,homeworld_fleet,storage_fleet,location_string,alliance_fleet,on_mission, upkeep_hassium, upkeep_neodymium, upkeep_strontium, upkeep_indium, eta, total_firepower, total_hull, auto_def, bank_fleet, fleet_alliance_id){
	// Add suppot for updating a fleet here, in case it exists already?
	var found=false;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].fleet_id==fleet_id){
			ad2460.myFleets[i].fleet_name=fleet_name;
			ad2460.myFleets[i].commander_id=commander_id;
			ad2460.myFleets[i].shipcount=shipcount;
			ad2460.myFleets[i].strength=strength;
			ad2460.myFleets[i].battles=battles;
			ad2460.myFleets[i].wins=wins;
			ad2460.myFleets[i].losses=losses;
			ad2460.myFleets[i].efficiency=efficiency;
			ad2460.myFleets[i].shortage=shortage;
			ad2460.myFleets[i].current_x=current_x;
			ad2460.myFleets[i].current_y=current_y;
			ad2460.myFleets[i].org_mission_target_type=org_mission_target_type;
			ad2460.myFleets[i].org_mission_target=org_mission_target;
			ad2460.myFleets[i].org_mission_target_x=org_mission_target_x;
			ad2460.myFleets[i].org_mission_target_y=org_mission_target_y;
			ad2460.myFleets[i].org_mission_type=org_mission_type;
			ad2460.myFleets[i].current_mission_target_type=current_mission_target_type;
			ad2460.myFleets[i].current_mission_target=current_mission_target;
			ad2460.myFleets[i].current_mission_target_x=current_mission_target_x;
			ad2460.myFleets[i].current_mission_target_y=current_mission_target_y;
			ad2460.myFleets[i].current_mission_type=current_mission_type;

			ad2460.myFleets[i].next_mission_target_type=next_mission_target_type;
			ad2460.myFleets[i].next_mission_target=next_mission_target;
			ad2460.myFleets[i].next_mission_target_x=next_mission_target_x;
			ad2460.myFleets[i].next_mission_target_y=next_mission_target_y;
			ad2460.myFleets[i].next_mission_type=next_mission_type;


			ad2460.myFleets[i].next_hyperspace_jump_time=next_hyperspace_jump_time;
			ad2460.myFleets[i].last_hyperspace_jump_time=last_hyperspace_jump_time;
			ad2460.myFleets[i].jump_range=jump_range;
			ad2460.myFleets[i].mission_status=mission_status;
			ad2460.myFleets[i].status=status;
			ad2460.myFleets[i].homeworld_fleet=homeworld_fleet;
			ad2460.myFleets[i].storage_fleet=storage_fleet;
			ad2460.myFleets[i].location_string=location_string;
			ad2460.myFleets[i].alliance_fleet=alliance_fleet;
			ad2460.myFleets[i].on_mission=on_mission;
			ad2460.myFleets[i].upkeep.hassium=upkeep_hassium;
			ad2460.myFleets[i].upkeep.neodymium=upkeep_neodymium;
			ad2460.myFleets[i].upkeep.strontium=upkeep_strontium;
			ad2460.myFleets[i].upkeep.indium=upkeep_indium;
			ad2460.myFleets[i].eta=eta;

			ad2460.myFleets[i].total_firepower=total_firepower;
			ad2460.myFleets[i].total_hull=total_hull;
			ad2460.myFleets[i].auto_def=auto_def;

			ad2460.myFleets[i].bank_fleet=bank_fleet;
			ad2460.myFleets[i].fleet_alliance_id=fleet_alliance_id;

			found=true;
		}
	}
	if (found==false){
		ad2460.myFleets.push(new fleet(fleet_id, owner_id, fleet_name, commander_id, shipcount, strength, battles , wins,  losses, efficiency, shortage, current_x,current_y, org_mission_target_type,org_mission_target, org_mission_target_x, org_mission_target_y, org_mission_type, current_mission_target_type, current_mission_target,current_mission_target_x,current_mission_target_y,current_mission_type, next_mission_target_type, next_mission_target, next_mission_target_x,next_mission_target_y, next_mission_type, next_hyperspace_jump_time, last_hyperspace_jump_time,jump_range,mission_status,status,homeworld_fleet,storage_fleet,location_string,alliance_fleet,on_mission, upkeep_hassium, upkeep_neodymium, upkeep_strontium, upkeep_indium, eta, total_firepower, total_hull, auto_def, bank_fleet, fleet_alliance_id));
	}
}

function addAllianceFleet(fleet_id, owner_id, fleet_name, commander_id, shipcount, strength, battles , wins,  losses, efficiency, shortage, current_x,current_y, org_mission_target_type,org_mission_target, org_mission_target_x, org_mission_target_y, org_mission_type, current_mission_target_type, current_mission_target,current_mission_target_x,current_mission_target_y,current_mission_type,next_mission_target_type, next_mission_target,next_mission_target_x,next_mission_target_y,next_mission_type, next_hyperspace_jump_time,last_hyperspace_jump_time,jump_range,mission_status,status,homeworld_fleet,storage_fleet,location_string,alliance_fleet,on_mission, upkeep_hassium, upkeep_neodymium, upkeep_strontium, upkeep_indium, eta, total_firepower, total_hull, auto_def, bank_fleet, fleet_alliance_id){
	// Add suppot for updating a fleet here, in case it exists already?
	var found=false;
	var x=0;
	for (x=0;x<ad2460.allianceData.memberlist.length ;x++ )	{
		if (ad2460.allianceData.memberlist[x].user_id==owner_id){
			var fleets=ad2460.allianceData.memberlist[x].allianceFleets;

			for (i=0;i<fleets.length ;i++ ){
				if (fleets[i].fleet_id==fleet_id){
					fleets[i].fleet_name=fleet_name;
					fleets[i].commander_id=commander_id;
					fleets[i].shipcount=shipcount;
					fleets[i].strength=strength;
					fleets[i].battles=battles;
					fleets[i].wins=wins;
					fleets[i].losses=losses;
					fleets[i].efficiency=efficiency;
					fleets[i].shortage=shortage;
					fleets[i].current_x=current_x;
					fleets[i].current_y=current_y;
					fleets[i].org_mission_target_type=org_mission_target_type;
					fleets[i].org_mission_target=org_mission_target;
					fleets[i].org_mission_target_x=org_mission_target_x;
					fleets[i].org_mission_target_y=org_mission_target_y;
					fleets[i].org_mission_type=org_mission_type;
					fleets[i].current_mission_target_type=current_mission_target_type;
					fleets[i].current_mission_target=current_mission_target;
					fleets[i].current_mission_target_x=current_mission_target_x;
					fleets[i].current_mission_target_y=current_mission_target_y;
					fleets[i].current_mission_type=current_mission_type;

					fleets[i].next_mission_target_type=next_mission_target_type;
					fleets[i].next_mission_target=next_mission_target;
					fleets[i].next_mission_target_x=next_mission_target_x;
					fleets[i].next_mission_target_y=next_mission_target_y;
					fleets[i].next_mission_type=next_mission_type;

					fleets[i].next_hyperspace_jump_time=next_hyperspace_jump_time;
					fleets[i].last_hyperspace_jump_time=last_hyperspace_jump_time;
					fleets[i].jump_range=jump_range;
					fleets[i].mission_status=mission_status;
					fleets[i].status=status;
					fleets[i].homeworld_fleet=homeworld_fleet;
					fleets[i].storage_fleet=storage_fleet;
					fleets[i].location_string=location_string;
					fleets[i].alliance_fleet=alliance_fleet;
					fleets[i].on_mission=on_mission;
					fleets[i].upkeep.hassium=upkeep_hassium;
					fleets[i].upkeep.neodymium=upkeep_neodymium;
					fleets[i].upkeep.strontium=upkeep_strontium;
					fleets[i].upkeep.indium=upkeep_indium;
					fleets[i].eta=eta;
					fleets[i].total_firepower=total_firepower;
					fleets[i].total_hull=total_hull;
					fleets[i].auto_def=auto_def;
					fleets[i].bank_fleet=bank_fleet;
					fleet[i].fleet_alliance_id=fleet_alliance_id;


					found=true;
				}
			}
			if (found==false){
				fleets.push(new fleet(fleet_id, owner_id, fleet_name, commander_id, shipcount, strength, battles , wins,  losses, efficiency, shortage, current_x,current_y, org_mission_target_type,org_mission_target, org_mission_target_x, org_mission_target_y, org_mission_type, current_mission_target_type, current_mission_target,current_mission_target_x,current_mission_target_y,current_mission_type, next_mission_target_type, next_mission_target, next_mission_target_x,next_mission_target_y, next_mission_type, next_hyperspace_jump_time, last_hyperspace_jump_time,jump_range,mission_status,status,homeworld_fleet,storage_fleet,location_string,alliance_fleet,on_mission, upkeep_hassium, upkeep_neodymium, upkeep_strontium, upkeep_indium, eta, total_firepower, total_hull, auto_def, bank_fleet, fleet_alliance_id));
			}

		}
	}

}

function addShipToFleet(unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410, relative_strength ){
	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].fleet_id==fleet_id){
			ad2460.myFleets[i].ships.push(new shipEntry(unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410, relative_strength));
		}
	}
}

function addShipToAllianceFleet(owner_id, unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410, relative_strength ){
	var i=0;
	for (i=0;i<ad2460.allianceData.memberlist.length ;i++ ){
		if (ad2460.allianceData.memberlist[i].user_id==owner_id){
			for (x=0;x<ad2460.allianceData.memberlist[i].allianceFleets.length ;x++ ){
				if (ad2460.allianceData.memberlist[i].allianceFleets[x].fleet_id==fleet_id){
					ad2460.allianceData.memberlist[i].allianceFleets[x].ships.push(new shipEntry(unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410, relative_strength));
					return true;
				}
			}
		}


	}
}


function sortMyFleets(sortby){
	if (sortby=="name"){
		ad2460.myFleets.sort(fleetsort2);
	}
}

function fleetsort(a,b){
	if (a.storage_fleet==1){
		return 1;
	}
	else if (b.storage_fleet==1){
		return -1;
	}
	else if (a.homeworld_fleet==1){
		return 0.7;
	}
	else if (b.homeworld_fleet==1){
		return -0.7;
	}
	else if (a.commander_id>0){
		return 0.6;
	}
	else if (b.commander_id>0){
		return -0.6;
	}
	else{
		return b.fleet_name-a.fleet_name;
	}
}

function fleetsort2(a,b){
	if (a.storage_fleet==1){
		return -1;
	}
	else if (b.storage_fleet==1){
		return 1;
	}

	if (a.homeworld_fleet==1){
		return -1;
	}
	else if (b.homeworld_fleet==1){
		return 1;
	}

	if (a.commander_id>0){
		return -1;
	}
	else if (b.commander_id>0){
		return 1;
	}
	return 0;
}

function fleetNameSort(a,b){
	var res=a.fleet_name.localeCompare(b.fleet_name);
	if (a.homeworld_fleet==1){
		res-=1000;
	}
	if (b.homeworld_fleet==1){
		res+=1000;
	}
	if (a.commander_id==0){
		res+=1000;
	}
	if (b.commander==0){
		res-=1000;
	}

	return res;
}

function fleetFirepowerSort(a,b){
	var res=(b.strength+b.homeworld_fleet*10000000+b.commander_id/10000000-a.strength-a.homeworld_fleet*10000000-a.commander_id/10000000)/1000000;

	return res;
}


function fleetStrengthSortPrevious(a,b){
	var res=(b.strength-a.strength)/1000000;
	if (a.homeworld_fleet==1){
		res-=1000;
	}
	if (b.homeworld_fleet==1){
		res+=1000;
	}

	if (a.commander_id==0){
		res+=1000;
	}
	if (b.commander==0){
		res-=1000;
	}

	//console.log(a.strength, res);
	return res;
}

function fleetStrengthSort(a,b){
	var res=(b.sortstrength-a.sortstrength);
	//console.log(a.strength, res);
	return res;
}


function fleetNameSortclick(){
	ad2460.myFleets.sort(fleetNameSort);
	renderMyFleets();
}
function fleetFirepowerSortclick(){
	ad2460.myFleets.sort(fleetStrengthSort);
	renderMyFleets();
}

function renderMyFleets(callbackString){
	var i=0;
	var parentContainer=document.getElementById('allYourFleets');
	removeChildNodes('allYourFleets');
	renderCommanders();
	var transports_counter=0;


	var drawnCounter=0;

	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var this_transports_counter=0;
		var this_minor_counter=0;
		var thisFleet=ad2460.myFleets[i];

		if (thisFleet.auto_def==1 && ad2460.scores.level<3){
			continue;
		}


		if (thisFleet.storage_fleet==1){
			continue;
		}
		if (thisFleet.homeworld_fleet==1){
			for (var s=0;s<thisFleet.ships.length ;s++ ){
				if (thisFleet.ships[s].ship_type_id==435 || thisFleet.ships[s].ship_type_id==436){
					transports_counter++;
				}
			}
		}

		for (var s=0;s<thisFleet.ships.length ;s++ ){
			if (thisFleet.ships[s].ship_type_id==435 || thisFleet.ships[s].ship_type_id==436){
				this_transports_counter++;
			}
			if (thisFleet.ships[s].ship_type_id<411){
				this_minor_counter++;
			}
		}


		var fleetContainer=document.createElement('div');
		var fleetNameContainer=document.createElement('div');
		var fleetTypeContainer=document.createElement('div');
		var fleetTypeImage=document.createElement('img');

		var fleetLocationContainer=document.createElement('div');
		var fleetSizeContainer=document.createElement('div');
		var fleetSizeContainer2=document.createElement('div');
		var fleetSizeContainer3=document.createElement('div');
		var fleetStrengthContainer=document.createElement('div');

		var main_class='tableselection';
		if (i % 2 == 0){
			main_class+=' evenline';
		}
		else {
			main_class+=' oddline';
		}

		fleetContainer.setAttribute("class",main_class);
		fleetContainer.setAttribute("id","fleetline_"+thisFleet.fleet_id);
		fleetNameContainer.setAttribute("class","table_fleet_name");
		fleetTypeContainer.setAttribute("class","table_fleet_type");
		fleetContainer.setAttribute("onclick","selectFleet("+thisFleet.fleet_id+")");

		// Set the correct image, based on location and mission-status
		var titleAndImage=returnFleetTitleAndImage(thisFleet);
		var title=titleAndImage.title;
		var imgsrc=titleAndImage.imgsrc;

		fleetTypeContainer.setAttribute("title",title);
		fleetTypeImage.setAttribute("src",imgsrc);

		fleetLocationContainer.setAttribute("class","table_fleet_loc");
		fleetSizeContainer.setAttribute("class","table_fleet_size");
		fleetSizeContainer2.setAttribute("class","table_fleet_size");
		fleetSizeContainer3.setAttribute("class","table_fleet_size");
		fleetStrengthContainer.setAttribute("class","table_fleet_strength");

		fleetNameContainer.innerHTML=thisFleet.fleet_name;
		fleetLocationContainer.innerHTML=thisFleet.location_string;
		fleetSizeContainer.innerHTML=''+thisFleet.shipcount;
		fleetSizeContainer2.innerHTML=''+this_minor_counter;
		fleetSizeContainer3.innerHTML=''+this_transports_counter;
		fleetStrengthContainer.innerHTML=prettyPrint(thisFleet.strength);

		fleetContainer.appendChild(fleetNameContainer);
		fleetContainer.appendChild(fleetTypeContainer);
		fleetTypeContainer.appendChild(fleetTypeImage);
		fleetContainer.appendChild(fleetLocationContainer);
		fleetContainer.appendChild(fleetSizeContainer);
		fleetContainer.appendChild(fleetSizeContainer2);
		fleetContainer.appendChild(fleetSizeContainer3);
		fleetContainer.appendChild(fleetStrengthContainer);

		parentContainer.appendChild(fleetContainer);

		if(thisFleet.commander_id>0 && thisFleet.homeworld_fleet==0){
			if(thisFleet.strength>thisFleet.commander.rank*10000){
				fleetStrengthContainer.setAttribute("class","table_fleet_strength notenough");
			}
		}

		if(thisFleet.shortage<0 && thisFleet.homeworld_fleet==0){
			fleetSizeContainer2.setAttribute("class","table_fleet_size notenough");
		}

		if (thisFleet.auto_def==1){
			// if strength is below the reocmmended minimum, set the class to notenough
			var o=0;
			for (o=0;o<ad2460.outposts.length ;o++ ){
				if (ad2460.outposts[o].x==thisFleet.current_x && ad2460.outposts[o].y==thisFleet.current_y){
					var recDef=ad2460.outposts[o].returnRecommendedDefenseStrength();
					var presentStr=thisFleet.strength;
					if (presentStr<recDef){
						fleetStrengthContainer.setAttribute("class","table_fleet_strength notenough");
						fleetStrengthContainer.setAttribute("title","This outpost-fleet needs more strength. Recommended strength : "+prettyPrint(recDef));
					}
				}
			}
		}

		drawnCounter++;

		// Then we can add a timer to reload them here, based on next_jump_time
		if (thisFleet.next_hyperspace_jump_time>0){
			var timerId='fleetTimer'+thisFleet.fleet_id;
			registerNewTimer(timerId, [], [], 0, thisFleet.next_hyperspace_jump_time+2, function(){fetchMyFleets();});
		}
	}

	renderPresentDefendingAlliedFleets(drawnCounter);

	renderBankFleets(drawnCounter);
	renderStationFleets(drawnCounter);

	checkScrollButtonStatus('allYourFleets');

	// Also render the fleets in fleet-movement
	renderFleetMovementList();

	// Finally, it would be good to check if the starmap is open and render the updated fleet-info...If I can...

	renderMapData('nodelay');

	if (callbackString){
		eval(callbackString);
	}

	updateMilitaryOverview();

	$("#outposts_transport_available_counter").html(''+transports_counter);
}

function renderBankFleets(previousDrawnCounter){
	var i=0;
	var parentContainer=document.getElementById('allYourFleets');

	if (ad2460.allianceData.id>0){
		if (ad2460.allianceData.bank.fleet){
			var thisFleet=ad2460.allianceData.bank.fleet;

			// Heck yeah, this is what we want!
			var this_transports_counter=0;
			var this_minors_counter=0;

			for (var s=0;s<thisFleet.ships.length ;s++ ){
				if (thisFleet.ships[s].ship_type_id==435 || thisFleet.ships[s].ship_type_id==436){
					this_transports_counter++;
				}
				if (thisFleet.ships[s].ship_type_id>400 && thisFleet.ships[s].ship_type_id<411){
					this_minors_counter++;
				}

			}

			var fleetContainer=document.createElement('div');
			var fleetNameContainer=document.createElement('div');
			var fleetTypeContainer=document.createElement('div');
			var fleetTypeImage=document.createElement('img');

			var fleetLocationContainer=document.createElement('div');
			var fleetSizeContainer=document.createElement('div');
			var fleetSizeContainer2=document.createElement('div');
			var fleetSizeContainer3=document.createElement('div');
			var fleetStrengthContainer=document.createElement('div');

			var main_class='tableselection';
			if (previousDrawnCounter % 2 == 0){
				main_class+=' evenline';
			}
			else {
				main_class+=' oddline';
			}

			main_class+=' fleet_list_bank_fleet';

			fleetContainer.setAttribute("class",main_class);
			fleetContainer.setAttribute("id","fleetline_"+thisFleet.fleet_id);
			fleetNameContainer.setAttribute("class","table_fleet_name");
			fleetTypeContainer.setAttribute("class","table_fleet_type");
			fleetContainer.setAttribute("onclick","selectFleet("+thisFleet.fleet_id+")");

			// Set the correct image, based on location and mission-status
			var titleAndImage=returnFleetTitleAndImage(thisFleet);
			var title=titleAndImage.title;
			var imgsrc=titleAndImage.imgsrc;

			fleetTypeContainer.setAttribute("title",title);
			fleetTypeImage.setAttribute("src",imgsrc);

			fleetLocationContainer.setAttribute("class","table_fleet_loc");
			fleetSizeContainer.setAttribute("class","table_fleet_size");
			fleetSizeContainer2.setAttribute("class","table_fleet_size");
			fleetSizeContainer3.setAttribute("class","table_fleet_size");
			fleetStrengthContainer.setAttribute("class","table_fleet_strength");

			fleetNameContainer.innerHTML=thisFleet.fleet_name;
			fleetLocationContainer.innerHTML=thisFleet.location_string;
			fleetSizeContainer.innerHTML=thisFleet.shipcount;
			fleetSizeContainer2.innerHTML=this_minors_counter;
			fleetSizeContainer3.innerHTML=this_transports_counter;

			fleetStrengthContainer.innerHTML=prettyPrint(thisFleet.strength);

			fleetContainer.appendChild(fleetNameContainer);
			fleetContainer.appendChild(fleetTypeContainer);
			fleetTypeContainer.appendChild(fleetTypeImage);
			fleetContainer.appendChild(fleetLocationContainer);
			fleetContainer.appendChild(fleetSizeContainer);
			fleetContainer.appendChild(fleetSizeContainer2);
			fleetContainer.appendChild(fleetSizeContainer3);
			fleetContainer.appendChild(fleetStrengthContainer);

			parentContainer.appendChild(fleetContainer);

			previousDrawnCounter++;

		}
	}
}

function renderStationFleets(previousDrawnCounter){
	var i=0;
	var parentContainer=document.getElementById('allYourFleets');

	if (ad2460.allianceData.id>0){
		for (i=0;i<ad2460.allianceData.stations.length ;i++ ){
			for (var f=0;f<ad2460.allianceData.stations[i].fleets.length ;f++ ){
				var thisFleet=ad2460.allianceData.stations[i].fleets[f];

				// Heck yeah, this is what we want!
				var this_transports_counter=0;
				var this_minors_counter=0;

				for (var s=0;s<thisFleet.ships.length ;s++ ){
					if (thisFleet.ships[s].ship_type_id==435 || thisFleet.ships[s].ship_type_id==436){
						this_transports_counter++;
					}
					if (thisFleet.ships[s].ship_type_id>400 && thisFleet.ships[s].ship_type_id<411){
						this_minors_counter++;
					}

				}

				var fleetContainer=document.createElement('div');
				var fleetNameContainer=document.createElement('div');
				var fleetTypeContainer=document.createElement('div');
				var fleetTypeImage=document.createElement('img');

				var fleetLocationContainer=document.createElement('div');
				var fleetSizeContainer=document.createElement('div');
				var fleetSizeContainer2=document.createElement('div');
				var fleetSizeContainer3=document.createElement('div');
				var fleetStrengthContainer=document.createElement('div');

				var main_class='tableselection';
				if (previousDrawnCounter % 2 == 0){
					main_class+=' evenline';
				}
				else {
					main_class+=' oddline';
				}

				main_class+=' fleet_list_station_fleet';

				fleetContainer.setAttribute("class",main_class);
				fleetContainer.setAttribute("id","fleetline_"+thisFleet.fleet_id);
				fleetNameContainer.setAttribute("class","table_fleet_name");
				fleetTypeContainer.setAttribute("class","table_fleet_type");
				fleetContainer.setAttribute("onclick","selectFleet("+thisFleet.fleet_id+")");

				// Set the correct image, based on location and mission-status
				var titleAndImage=returnFleetTitleAndImage(thisFleet);
				var title=titleAndImage.title;
				var imgsrc=titleAndImage.imgsrc;

				fleetTypeContainer.setAttribute("title",title);
				fleetTypeImage.setAttribute("src",imgsrc);

				fleetLocationContainer.setAttribute("class","table_fleet_loc");
				fleetSizeContainer.setAttribute("class","table_fleet_size");
				fleetSizeContainer2.setAttribute("class","table_fleet_size");
				fleetSizeContainer3.setAttribute("class","table_fleet_size");
				fleetStrengthContainer.setAttribute("class","table_fleet_strength");

				fleetNameContainer.innerHTML=thisFleet.fleet_name;
				fleetLocationContainer.innerHTML=thisFleet.location_string;
				fleetSizeContainer.innerHTML=thisFleet.shipcount;
				fleetSizeContainer2.innerHTML=this_minors_counter;
				fleetSizeContainer3.innerHTML=this_transports_counter;

				fleetStrengthContainer.innerHTML=prettyPrint(thisFleet.strength);

				fleetContainer.appendChild(fleetNameContainer);
				fleetContainer.appendChild(fleetTypeContainer);
				fleetTypeContainer.appendChild(fleetTypeImage);
				fleetContainer.appendChild(fleetLocationContainer);
				fleetContainer.appendChild(fleetSizeContainer);
				fleetContainer.appendChild(fleetSizeContainer2);
				fleetContainer.appendChild(fleetSizeContainer3);
				fleetContainer.appendChild(fleetStrengthContainer);

				parentContainer.appendChild(fleetContainer);

				previousDrawnCounter++;



			}
		}
	}
}

function renderPresentDefendingAlliedFleets(previousDrawnCounter){
	var i=0;
	var parentContainer=document.getElementById('allYourFleets');

	if (ad2460.allianceData.id>0){
		for (m=0;m<ad2460.allianceData.memberlist.length ;m++ ){
			if (ad2460.allianceData.memberlist[m].user_id!=ad2460.user_id){
				for (i=0;i<ad2460.allianceData.memberlist[m].allianceFleets.length ;i++ ){
					var thisFleet=ad2460.allianceData.memberlist[m].allianceFleets[i];
					if (thisFleet.storage_fleet==0 && thisFleet.homeworld_fleet==0 && thisFleet.status==4 && thisFleet.current_x==ad2460.homeworld.x && thisFleet.current_y==ad2460.homeworld.y){
						// Heck yeah, this is what we want!
						var this_transports_counter=0;
						var this_minors_counter=0;

						var owner_name=ad2460.allianceData.memberlist[m].name;
						for (var s=0;s<thisFleet.ships.length ;s++ ){
							if (thisFleet.ships[s].ship_type_id==435 || thisFleet.ships[s].ship_type_id==436){
								this_transports_counter++;
							}
							if (thisFleet.ships[s].ship_type_id>400 && thisFleet.ships[s].ship_type_id<411){
								this_minors_counter++;
							}

						}

						var fleetContainer=document.createElement('div');
						var fleetNameContainer=document.createElement('div');
						var fleetTypeContainer=document.createElement('div');
						var fleetTypeImage=document.createElement('img');

						var fleetLocationContainer=document.createElement('div');
						var fleetSizeContainer=document.createElement('div');
						var fleetSizeContainer2=document.createElement('div');
						var fleetSizeContainer3=document.createElement('div');
						var fleetStrengthContainer=document.createElement('div');

						var main_class='tableselection';
						if (previousDrawnCounter % 2 == 0){
							main_class+=' evenline';
						}
						else {
							main_class+=' oddline';
						}

						main_class+=' fleet_list_ally_def';

						fleetContainer.setAttribute("class",main_class);
						fleetContainer.setAttribute("id","fleetline_"+thisFleet.fleet_id);
						fleetNameContainer.setAttribute("class","table_fleet_name");
						fleetTypeContainer.setAttribute("class","table_fleet_type");
						fleetContainer.setAttribute("onclick","selectFleet("+thisFleet.fleet_id+")");

						// Set the correct image, based on location and mission-status
						var titleAndImage=returnFleetTitleAndImage(thisFleet);
						var title=titleAndImage.title;
						var imgsrc=titleAndImage.imgsrc;

						fleetTypeContainer.setAttribute("title",title);
						fleetTypeImage.setAttribute("src",imgsrc);

						fleetLocationContainer.setAttribute("class","table_fleet_loc");
						fleetSizeContainer.setAttribute("class","table_fleet_size");
						fleetSizeContainer2.setAttribute("class","table_fleet_size");
						fleetSizeContainer3.setAttribute("class","table_fleet_size");
						fleetStrengthContainer.setAttribute("class","table_fleet_strength");

						fleetNameContainer.innerHTML='('+owner_name+') '+thisFleet.fleet_name;
						fleetLocationContainer.innerHTML=thisFleet.location_string;
						fleetSizeContainer.innerHTML=thisFleet.shipcount;
						fleetSizeContainer2.innerHTML=this_minors_counter;
						fleetSizeContainer3.innerHTML=this_transports_counter;

						fleetStrengthContainer.innerHTML=prettyPrint(thisFleet.strength);

						fleetContainer.appendChild(fleetNameContainer);
						fleetContainer.appendChild(fleetTypeContainer);
						fleetTypeContainer.appendChild(fleetTypeImage);
						fleetContainer.appendChild(fleetLocationContainer);
						fleetContainer.appendChild(fleetSizeContainer);
						fleetContainer.appendChild(fleetSizeContainer2);
						fleetContainer.appendChild(fleetSizeContainer3);
						fleetContainer.appendChild(fleetStrengthContainer);

						parentContainer.appendChild(fleetContainer);

						previousDrawnCounter++;
					}
				}
			}
		}
	}
}

function renderFleetMovementList(){
	var i=0;
	var parentContainer=document.getElementById('moveYourFleets');
	//myScrollToTop('moveYourFleets');
	var total_cargo_in_transit=0;
	var h_cargo_in_transit=0;
	var i_cargo_in_transit=0;
	var s_cargo_in_transit=0;
	var n_cargo_in_transit=0;

	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var cargo=returnSpecifiedCargo(ad2460.myFleets[i].ships);
		total_cargo_in_transit+=cargo.total;
		h_cargo_in_transit+=cargo.hassium;
		i_cargo_in_transit+=cargo.indium;
		s_cargo_in_transit+=cargo.strontium;
		n_cargo_in_transit+=cargo.neodymium;
	}

	//$("#fleet_movement_total_cargo_in_transit").html(prettyPrint(total_cargo_in_transit)+ ' resources');

	$("#fm_cargo_h").html(prettyPrint(h_cargo_in_transit));
	$("#fm_cargo_i").html(prettyPrint(i_cargo_in_transit));
	$("#fm_cargo_s").html(prettyPrint(s_cargo_in_transit));
	$("#fm_cargo_n").html(prettyPrint(n_cargo_in_transit));

	removeChildNodes('moveYourFleets');
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var thisFleet=ad2460.myFleets[i];

		// Don't show the storage-fleet
		if (thisFleet.storage_fleet==1){
			continue;
		}
		// Don't show the homeworld-fleet
		if (thisFleet.homeworld_fleet==1){
			continue;
		}

		// Don't show the op-fleets
		if (thisFleet.auto_def==1){
			continue;
		}


		if (thisFleet.strength<1 && thisFleet.current_x==ad2460.homeworld.x && thisFleet.current_y==ad2460.homeworld.y){
			continue;
		}

		// Dont show fleets with any kind of status, I guess..
		// wrong!
		//if (thisFleet.status>0){
		//	continue;
		//}

		var fleetContainer=document.createElement('div');
		var fleetNameContainer=document.createElement('div');
		var fleetTypeContainer=document.createElement('div');
		var fleetTypeImage=document.createElement('img');

		var fleetLocationContainer=document.createElement('div');
		var fleetEtaContainer=document.createElement('div');
		var fleetDestinationContainer=document.createElement('div');

		var main_class='tableselection';
		if (i % 2 == 0){
			main_class+=' evenline';
		}
		else {
			main_class+=' oddline';
		}

		fleetContainer.setAttribute("class",main_class);
		fleetContainer.setAttribute("id","fm_fleetline_"+thisFleet.fleet_id);
		fleetNameContainer.setAttribute("class","table_fleet_name");
		fleetTypeContainer.setAttribute("class","table_fleet_type");
		fleetContainer.setAttribute("onclick","fleetMovementSelectFleet("+thisFleet.fleet_id+")");

		// Set the correct image, based on location and mission-status
		var titleAndImage=returnFleetTitleAndImage(thisFleet);
		var title=titleAndImage.title;
		var imgsrc=titleAndImage.imgsrc;

		fleetTypeContainer.setAttribute("title",title);
		fleetTypeImage.setAttribute("src",imgsrc);

		fleetLocationContainer.setAttribute("class","table_fleet_loc");
		fleetEtaContainer.setAttribute("class","table_fleet_eta");
		fleetEtaContainer.setAttribute("id","fleet_eta_"+thisFleet.fleet_id);
		fleetDestinationContainer.setAttribute("class","table_fleet_loc dest");

		fleetNameContainer.innerHTML=thisFleet.fleet_name;
		fleetLocationContainer.innerHTML=thisFleet.location_string;
		if (thisFleet.eta>ad2460.serverTime){
			fleetEtaContainer.innerHTML=secondsToFullTimeNosecs(thisFleet.eta-ad2460.serverTime);
		}
		else {
			fleetEtaContainer.innerHTML="";
		}

		if (thisFleet.current_mission_target_x>0){
			fleetDestinationContainer.innerHTML=returnLocationName(thisFleet.current_mission_target_x,thisFleet.current_mission_target_y);
		}
		else {
			fleetDestinationContainer.innerHTML="";
		}


		fleetContainer.appendChild(fleetNameContainer);
		fleetContainer.appendChild(fleetTypeContainer);
		fleetTypeContainer.appendChild(fleetTypeImage);
		fleetContainer.appendChild(fleetLocationContainer);
		fleetContainer.appendChild(fleetDestinationContainer);
		fleetContainer.appendChild(fleetEtaContainer);

		parentContainer.appendChild(fleetContainer);
	}
	checkScrollButtonStatus('moveYourFleets');
}

function updateFleetMoveEtas(){
	// look for ids of fleet_eta_"+thisFleet.fleet_id for each fleet, and set the content to secondsToFullTimeNosecs(thisFleet.eta-ad2460.serverTime);
	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var thisFleet=ad2460.myFleets[i];
		if (thisFleet.eta>ad2460.serverTime){
			if (document.getElementById('fleet_eta_'+thisFleet.fleet_id)){
				document.getElementById('fleet_eta_'+thisFleet.fleet_id).innerHTML=secondsToFullTimeNosecs(thisFleet.eta-ad2460.serverTime);
			}
		}
	}
}

function selectStorageFleet(){
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].storage_fleet==1){
			selectFleetSpecial(ad2460.myFleets[i].fleet_id);
			//selectFleet(ad2460.myFleets[i].fleet_id);

			break;
		}
	}
}

function updateStorageFleet(docked_401,docked_402,docked_403,docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410, docked_430, docked_431 ){
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].storage_fleet==1){
			var thisFleet=ad2460.myFleets[i];
			thisFleet.storage=new Array;
			thisFleet.storage.push(new Storage(401,docked_401));
			thisFleet.storage.push(new Storage(402,docked_402));
			thisFleet.storage.push(new Storage(403,docked_403));
			thisFleet.storage.push(new Storage(404,docked_404));
			thisFleet.storage.push(new Storage(405,docked_405));
			thisFleet.storage.push(new Storage(406,docked_406));
			thisFleet.storage.push(new Storage(407,docked_407));
			thisFleet.storage.push(new Storage(408,docked_408));
			thisFleet.storage.push(new Storage(409,docked_409));
			thisFleet.storage.push(new Storage(410,docked_410));
			thisFleet.storage.push(new Storage(430,docked_430));
			thisFleet.storage.push(new Storage(431,docked_431));
		}
	}

}

function selectFleetSpecial(fleetId){
	// This is for the special rendering of the storage-fleet...Small ships only!
	// Dont use for now until design is 100% ready

	var i=0;
	var parentContainer=document.getElementById('fleet_composition_container');
	removeChildNodes('fleet_composition_container');
	fleetAssignPanelDown();
	fleetResupplyPanelDown();
	fleetTacticsPanelDown();

	var renderObjects=new Array;
	// This one is much easier than the normal routines...
	// This fleet has only small ships, no individual ships to parse...
	// This fleet also has a special array, storage...which holds our render-groups pretty much by itself...

	// Each entry in this array must hold
	// ship_type_id, name, shipcount
	// firepower, shields, hull
	var thisFleet=returnFleetById(fleetId);
	if (thisFleet==false){
		return;
	}

	// We found the right fleet..Now handle the ships...
	ad2460.fleetvars.selected_fleet_id=fleetId;
	$("#fleet_infopanel_help").html("<div class='fleet_management_bonus_button general_button_blue' onclick='showSelectedFleetCompoBonuses()'>View Current Composition Bonuses</div>");

	var ship=0;
	var currentShipTypeId=0;
	$("#fleet_management_sidepanel_selected_fleet_name").html(thisFleet.fleet_name);
	for (ship=0 ; ship<thisFleet.storage.length ; ship++ ){
		thisShip=thisFleet.storage[ship];
		if (thisShip.counter>0){
			var shipname=returnUnitName(thisShip.ship_type_id);
			renderObjects.push(new fleetRenderObject(thisShip.ship_type_id,shipname));
			// Now update the data-struct
			renderObjects[renderObjects.length-1].shipcount=thisShip.counter;
		}
	}

	$("#fleet_management_sidepanel_selected_fleet_shipcount").html(thisFleet.strength);
	$("#fleet_management_sidepanel_selected_fleet_strength").html(thisFleet.total_firepower);
	$("#fleet_management_sidepanel_selected_fleet_techtilt").html(returnTechTilt(thisFleet));
	$("#fleet_management_sidepanel_selected_fleet_battles").html('');
	$("#fleet_management_sidepanel_selected_fleet_wins").html('');
	$("#fleet_management_sidepanel_selected_fleet_losses").html('');

	var thisFleetTotalUpkeep=thisFleet.upkeep.hassium+thisFleet.upkeep.neodymium+thisFleet.upkeep.strontium+thisFleet.upkeep.indium;
	thisFleetTotalUpkeep=prettyPrint(thisFleetTotalUpkeep);

	//$("#fleet_management_sidepanel_selected_fleet_upkeep").html(thisFleetTotalUpkeep);
	$("#fleet_management_sidepanel_selected_fleet_shortage").html('');


	// Ok, datastructure renderObjects should now be in place...
	// Now draw them!
	//console.log(renderObjects);
	// Add possible outposts first.
	if (ad2460.homeworld.orbit[0].count>0){
		renderObjects.push(new fleetRenderObject(ad2460.homeworld.orbit[0].id,ad2460.homeworld.orbit[0].name));
		renderObjects[renderObjects.length-1].shipcount=ad2460.homeworld.orbit[0].count;
	}
	if (ad2460.homeworld.orbit[1].count>0){
		renderObjects.push(new fleetRenderObject(ad2460.homeworld.orbit[1].id,ad2460.homeworld.orbit[1].name));
		renderObjects[renderObjects.length-1].shipcount=ad2460.homeworld.orbit[1].count;
	}
	if (ad2460.homeworld.orbit[2].count>0){
		renderObjects.push(new fleetRenderObject(ad2460.homeworld.orbit[2].id,ad2460.homeworld.orbit[2].name));
		renderObjects[renderObjects.length-1].shipcount=ad2460.homeworld.orbit[2].count;
	}

	// Done!

	for (i=0;i<renderObjects.length ;i++ ){
		var rowContainer=document.createElement('div');
		rowContainer.setAttribute("class","row_container");

		var fleetshipContainer=document.createElement('div');
		fleetshipContainer.setAttribute("id","fleetship"+i);
		fleetshipContainer.setAttribute("onclick","fleetshipClick('fleetship"+i+"')");

		var fleetship_class='row_entry reserve_ship ';


		if (i<1){
			//fleetship_class+='outpostships_top ';
		}

		fleetshipContainer.setAttribute("class",fleetship_class);
		//fleetshipContainer.setAttribute("onclick","doSomething("+renderObjects[i].ship_type_id+")");
		rowContainer.appendChild(fleetshipContainer);

		// So far so good!
		var fleetshipsContainer=document.createElement('div');
		fleetshipsContainer.setAttribute("class",'queue_entry_content_container');
		fleetshipContainer.appendChild(fleetshipsContainer);

		var shipnameContainer=document.createElement('div');
		shipnameContainer.setAttribute("class",'queue_entry_name');
		shipnameContainer.innerHTML=renderObjects[i].name;
		fleetshipsContainer.appendChild(shipnameContainer);


		var queueEntryReserve=document.createElement('div');
		queueEntryReserve.setAttribute("class",'queue_entry_reserve');
		fleetshipsContainer.appendChild(queueEntryReserve);

		var counterDiv=document.createElement('div');
		counterDiv.setAttribute("class",'counter');
		queueEntryReserve.appendChild(counterDiv);

		var needTitle=document.createElement('div');
		needTitle.setAttribute("class",'need');
		needTitle.innerHTML='Needed:';

		var total_need=ad2460.fleetvars.total_shortage_for_all_fleets;
		var thisOccuppies=1;
		if (renderObjects[i].vesselclass=='Fighter'){
			thisOccuppies=1;
		}
		if (renderObjects[i].vesselclass=='Corvette'){
			thisOccuppies=2;
		}

		var thisNeed=Math.floor(total_need/thisOccuppies);
		if (renderObjects[i].ship_type_id==430 || renderObjects[i].ship_type_id==431 || renderObjects[i].ship_type_id==438 || renderObjects[i].ship_type_id==439 || renderObjects[i].ship_type_id==440 ){
			thisNeed='N/A';
		}

		var needCounter=document.createElement('div');
		needCounter.setAttribute("class",'need_counter');
		needCounter.innerHTML=''+thisNeed;

		//if (renderObjects[i].ship_type_id!=430 && renderObjects[i].ship_type_id!=431){
		counterDiv.appendChild(needTitle);
		counterDiv.appendChild(needCounter);
		//}
		// 'my_global_shortage' holds the number...and we have it in
		// ad2460.fleetvars.total_shortage_for_all_fleets


		var availableTitle=document.createElement('div');
		availableTitle.setAttribute("class",'available');
		availableTitle.innerHTML='Available:';
		counterDiv.appendChild(availableTitle);

		var availableCounter=document.createElement('div');
		availableCounter.setAttribute("class",'available_counter');
		availableCounter.innerHTML=renderObjects[i].shipcount;
		counterDiv.appendChild(availableCounter);

		var reserveButton=document.createElement('div');
		reserveButton.setAttribute("class",'reserve_button');
		if (renderObjects[i].ship_type_id!=430 && renderObjects[i].ship_type_id!=431 && renderObjects[i].ship_type_id!=438 && renderObjects[i].ship_type_id!=439 && renderObjects[i].ship_type_id!=440){
			// Dont show this button for scout-shipps and prospecting ships. And outposts
			queueEntryReserve.appendChild(reserveButton);
		}


		reserveButton.setAttribute("onclick","resupplyAllClick("+renderObjects[i].ship_type_id+")");

		var columnButton=document.createElement('div');
		columnButton.setAttribute("class",'column_button reserve');
		reserveButton.appendChild(columnButton);

		var columnButtonName=document.createElement('div');
		columnButtonName.setAttribute("class",'column_button_name reserve');
		columnButtonName.innerHTML='Resupply all';
		columnButton.appendChild(columnButtonName);


		var fleetinfoBGContainer=document.createElement('div');
		fleetinfoBGContainer.setAttribute("class",'queue_entry_info fleet_info_bg');
		fleetshipsContainer.appendChild(fleetinfoBGContainer);

		var shade1=document.createElement('div');
		shade1.setAttribute("class",'shade');
		fleetinfoBGContainer.appendChild(shade1);

		var fleetshipInfo=document.createElement('div');
		fleetshipInfo.setAttribute("class",'fleet_ship_info');
		fleetinfoBGContainer.appendChild(fleetshipInfo);

		var fleetshipInfoCol1=document.createElement('div');
		fleetshipInfoCol1.setAttribute("class",'fleet_ship_info column_1');
		fleetshipInfo.appendChild(fleetshipInfoCol1);

		var fleet_ship_info_title_1=document.createElement('div');
		fleet_ship_info_title_1.setAttribute("class",'fleet_ship_info_title');
		fleet_ship_info_title_1.innerHTML='Firepower'+':';

		var fleet_ship_info_title_2=document.createElement('div');
		fleet_ship_info_title_2.setAttribute("class",'fleet_ship_info_title');
		fleet_ship_info_title_2.innerHTML='Shields'+':';

		var fleet_ship_info_title_3=document.createElement('div');
		fleet_ship_info_title_3.setAttribute("class",'fleet_ship_info_title');
		fleet_ship_info_title_3.innerHTML='Hull'+':';

		var fleet_ship_info_entry_1=document.createElement('div');
		fleet_ship_info_entry_1.setAttribute("class",'fleet_ship_info_entry');
		fleet_ship_info_entry_1.innerHTML=renderObjects[i].firepower;

		var fleet_ship_info_entry_2=document.createElement('div');
		fleet_ship_info_entry_2.setAttribute("class",'fleet_ship_info_entry');
		fleet_ship_info_entry_2.innerHTML=renderObjects[i].shieldstrength;

		var fleet_ship_info_entry_3=document.createElement('div');
		fleet_ship_info_entry_3.setAttribute("class",'fleet_ship_info_entry');
		fleet_ship_info_entry_3.innerHTML=renderObjects[i].hullstrength;

		fleetshipInfoCol1.appendChild(fleet_ship_info_title_1);
		fleetshipInfoCol1.appendChild(fleet_ship_info_entry_1);
		fleetshipInfoCol1.appendChild(fleet_ship_info_title_2);
		fleetshipInfoCol1.appendChild(fleet_ship_info_entry_2);
		fleetshipInfoCol1.appendChild(fleet_ship_info_title_3);
		fleetshipInfoCol1.appendChild(fleet_ship_info_entry_3);

		//Pheeewww

		// Ok so far!

		if (renderObjects[i].ship_type_id!=438 && renderObjects[i].ship_type_id!=439 && renderObjects[i].ship_type_id!=440){

			var columnButton2=document.createElement('div');
			columnButton2.setAttribute("class",'column_button reserve2');
			columnButton2.setAttribute("onclick","quickbuyClick("+renderObjects[i].ship_type_id+",event)");
			fleetinfoBGContainer.appendChild(columnButton2);


			var columnButton2Name=document.createElement('div');
			columnButton2Name.setAttribute("class",'column_button_name reserve');
			var buildstring='Order';
			if (ad2460.productionqueue.length>0){
				buildstring='Queue';
			}


			columnButton2Name.innerHTML=buildstring;
			columnButton2.appendChild(columnButton2Name);
		}

		var shipImageContainer=document.createElement('div');
		shipImageContainer.setAttribute("class",'queue_entry_img');
		fleetshipsContainer.appendChild(shipImageContainer);

		var shipImage=document.createElement('img');
		shipImage.setAttribute("src","images/icons/production/"+renderObjects[i].ship_type_id+".jpg");
		shipImageContainer.appendChild(shipImage);

		// And hey presto, link the entry to the container...
		parentContainer.appendChild(rowContainer);
	}
}

function updateFleetName(){
	var thisFleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	var enteredName=$("#fleet_management_sidepanel_selected_fleet_name").text();
	enteredName=enteredName.replace('<br>','');
	enteredName=enteredName.replace('<br type="_moz">','');
	enteredName=enteredName.replace(/(\r\n|\n|\r)/gm,"");
	document.getElementById('fleet_management_sidepanel_selected_fleet_name').innerHTML=enteredName;
	if (thisFleet!=false){
		$.post('actionhandler.pl', {action:'rename_fleet',fleet_id:ad2460.fleetvars.selected_fleet_id, fleet_name:enteredName}, function(data){ parseInfo(data);});
	}
}

function updateCommanderName(commander_id){
	var enteredName=$("#selected_commander_name").text();
	enteredName=enteredName.replace('<br>','');
	enteredName=enteredName.replace('<br type="_moz">','');
	enteredName=enteredName.replace(/(\r\n|\n|\r)/gm,"");
	document.getElementById('selected_commander_name').innerHTML=enteredName;
	$.post('actionhandler.pl', {action:'rename_commander',commander_id:commander_id, name:enteredName}, function(data){ parseInfo(data);});
}


function updateClientCommandername(commander_id,name){
	var thisCommander=returnCommanderById(commander_id);
	if (thisCommander!=false){
		thisCommander.name=name;
		renderMyFleets();
		renderCommanders();
		commanderClick(commander_id);
	}
}

function updateClientFleetname(fleet_id,name){
	var thisFleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	var prevSelectedFleet=ad2460.fleetvars.selected_fleet_id;
	if (thisFleet!=false){
		thisFleet.fleet_name=name;
		document.getElementById('fleet_management_sidepanel_selected_fleet_name').innerHTML=name;
		renderMyFleets();
		selectFleet(prevSelectedFleet);
	}
}

function returnTotalCargo(ships){
	var totalCargo=0;
	var i=0;
	for (i=0;i<ships.length ;i++ ){
		totalCargo=totalCargo+ships[i].h_cargo+ships[i].n_cargo+ships[i].s_cargo+ships[i].i_cargo;
	}
	return prettyPrint(totalCargo);
}

function returnSpecifiedCargo(ships){
	var retObj={hassium:0,indium:0, strontium:0, neodymium:0, total:0};
	var i=0;
	for (i=0;i<ships.length ;i++ ){
		retObj.hassium+=ships[i].h_cargo;
		retObj.indium+=ships[i].i_cargo;
		retObj.strontium+=ships[i].s_cargo;
		retObj.neodymium+=ships[i].n_cargo;
	}
	retObj.total=retObj.hassium+retObj.indium+retObj.strontium+retObj.neodymium;
	return retObj;
}


function fleetMovementSelectFleet(fleetId){
	var i=0;

	var fleet=returnFleetById(fleetId);
	if (fleet==false){
		$('#fleet_move_no_move').html('No fleet selected.');

		$('#fleet_move_no_move').show();
		$('#fleet_move_launch').hide();
		$('#move_to_preset_loc').hide();
		$('#fleet_move_launch_button').hide();
		$('#move_to_preset_selected_location_header').hide();
		$('#move_to_preset_loc_header').hide();
		$('fleet_move_selected_location').html("-");

		document.getElementById('fleet_move_selected_fleet_name').innerHTML='N/A';
		document.getElementById('fleet_move_selected_fleet_shipcount').innerHTML='';
		document.getElementById('fleet_move_selected_fleet_strength').innerHTML='';
		document.getElementById('fleet_move_selected_fleet_techtilt').innerHTML='';
		document.getElementById('fleet_move_selected_fleet_winslosses').innerHTML="";
		document.getElementById('fleet_move_selected_fleet_upkeep').innerHTML="";
		document.getElementById('fleet_move_selected_fleet_shortage').innerHTML='';

		document.getElementById('fleet_move_selected_fleet_cargo').innerHTML='';
		document.getElementById('fleet_move_loc_entry').innerHTML='';
		document.getElementById('fleet_move_selected_location').innerHTML='-';
		removeChildNodes('move_to_preset_loc');
		return;
	}

	ad2460.fleetvars.fleet_movement_selected_fleet_id=fleetId;

	if (fleet.auto_def==1){
		// Special case, this is an outpost-fleet!
		document.getElementById('fleet_move_selected_fleet_name').innerHTML=fleet.fleet_name;
		document.getElementById('fleet_move_selected_fleet_shipcount').innerHTML=fleet.shipcount;
		document.getElementById('fleet_move_selected_fleet_strength').innerHTML=prettyPrint(fleet.total_firepower);
		document.getElementById('fleet_move_selected_fleet_techtilt').innerHTML=returnTechTilt(fleet);
		document.getElementById('fleet_move_selected_fleet_winslosses').innerHTML=""+fleet.wins+"/"+fleet.losses;
		var total_upkeep=fleet.upkeep.hassium+fleet.upkeep.neodymium+fleet.upkeep.strontium+fleet.upkeep.indium;
		document.getElementById('fleet_move_selected_fleet_upkeep').innerHTML=""+prettyPrint(total_upkeep);

		var hangarData=calcHangarData(fleet);
		var total=hangarData.total;
		var spent=hangarData.spent;

		document.getElementById('fleet_move_selected_fleet_shortage').innerHTML=spent+' / '+total;
		document.getElementById('fleet_move_selected_fleet_cargo').innerHTML=returnTotalCargo(fleet.ships);
		document.getElementById('fleet_move_loc_entry').innerHTML=fleet.location_string;
		document.getElementById('fleet_move_selected_location').innerHTML='This fleet can not be moved.';
		return;
	}


	removeTimer('FleetMovementNextJumpTimer');

	document.getElementById('fleet_move_selected_fleet_name').innerHTML=fleet.fleet_name;
	document.getElementById('fleet_move_selected_fleet_shipcount').innerHTML=fleet.shipcount;
	document.getElementById('fleet_move_selected_fleet_strength').innerHTML=prettyPrint(fleet.total_firepower);
	document.getElementById('fleet_move_selected_fleet_techtilt').innerHTML=returnTechTilt(fleet);
	document.getElementById('fleet_move_selected_fleet_winslosses').innerHTML=""+fleet.wins+"/"+fleet.losses;
	var total_upkeep=fleet.upkeep.hassium+fleet.upkeep.neodymium+fleet.upkeep.strontium+fleet.upkeep.indium;
	document.getElementById('fleet_move_selected_fleet_upkeep').innerHTML=""+prettyPrint(total_upkeep);


	var hangarData=calcHangarData(fleet);
	var total=hangarData.total;
	var spent=hangarData.spent;


	document.getElementById('fleet_move_selected_fleet_shortage').innerHTML=spent+' / '+total;

	document.getElementById('fleet_move_selected_fleet_cargo').innerHTML=returnTotalCargo(fleet.ships);


	document.getElementById('fleet_move_loc_entry').innerHTML=fleet.location_string;

	document.getElementById('fleet_move_selected_location').innerHTML='-';

	removeChildNodes('move_to_preset_loc');
	//document.getElementById('fleet_move_quadrant').value='';
	//document.getElementById('fleet_move_sector').value='';
	//document.getElementById('fleet_move_cluster').value='';
	//document.getElementById('fleet_move_system').value='';
	//document.getElementById('fleet_move_position').value='';

	var dropdown=document.getElementById('move_to_preset_loc');

	// Now fill the listbox with options
	// First our homeworld
	// Entries are listed as location-names with a value like "x_y"
	//dropdown.options[dropdown.options.length] = new Option(ad2460.homeworld.name, ad2460.homeworld.x+'_'+ad2460.homeworld.y);
	if (fleet.current_x!=ad2460.homeworld.x || fleet.current_y!=ad2460.homeworld.y){
		dropdown.appendChild(new Option(ad2460.homeworld.name, ad2460.homeworld.x+'_'+ad2460.homeworld.y));
	}

	/* We can no longer move fleets to outposts

	// Forcing order
	ad2460.outposts.sort(levelSort);

	if (ad2460.outposts.length>0){
		var myOutposts = document.createElement("optgroup");
		myOutposts.label = "My outposts";

		for (i=0;i<ad2460.outposts.length ;i++ ){
			var name=ad2460.outposts[i].name+" (L"+ad2460.outposts[i].level+")";
			if (fleet.current_x!=ad2460.outposts[i].x || fleet.current_y!=ad2460.outposts[i].y){
				myOutposts.appendChild(new Option(name, ad2460.outposts[i].x+'_'+ad2460.outposts[i].y));
			}
		}

		dropdown.appendChild(myOutposts);
	}

	// Revert back to selected order
	sortOutposts();

	*/

	if (ad2460.allianceData.id>0){
		/* We can no longer move fleets to allies!
		var myAllies = document.createElement("optgroup");
		myAllies.label = "Allied homeworlds";
		for (var a=0;a<ad2460.allianceData.memberlist.length ;a++ ){
			if (ad2460.allianceData.memberlist[a].user_id!=ad2460.user_id){
				myAllies.appendChild(new Option(ad2460.allianceData.memberlist[a].name, ad2460.allianceData.memberlist[a].x+'_'+ad2460.allianceData.memberlist[a].y));
			}
		}
		dropdown.appendChild(myAllies);
		*/

		/* We can no longer move fleets to stations!
		var stations = document.createElement("optgroup");
		stations.label = "Stations";
		for (var a=0;a<ad2460.allianceData.stations.length ;a++ ){
			if (fleet.current_x!=ad2460.allianceData.stations[a].x || fleet.current_y!=ad2460.allianceData.stations[a].y){
				var coords=convertShortCoordsToLongCoords(ad2460.allianceData.stations[a].x,ad2460.allianceData.stations[a].y);
				var coordString=" ("+coords.q+":"+coords.s+":"+coords.g+")";
				stations.appendChild(new Option(ad2460.allianceData.stations[a].name+coordString, ad2460.allianceData.stations[a].x+'_'+ad2460.allianceData.stations[a].y));
			}
		}
		dropdown.appendChild(stations);

		*/
	}
	// Force the topmost item to be selected by default...
	document.getElementById('move_to_preset_loc').selectedIndex=-1;

	if (fleet.status==1 || fleet.status==2 || fleet.status==3){
		if (fleet.status==1){
			$('#fleet_move_no_move').html('Fleet is loading resources.'+'<br/>Next jump in <span id="fleetMovementNextJumpTimer">'+secondsToFullTime(fleet.next_hyperspace_jump_time-ad2460.serverTime)+'</span>');
			registerNewTimer('FleetMovementNextJumpTimer', ['fleetMovementNextJumpTimer'], [], fleet.next_hyperspace_jump_time-300, fleet.next_hyperspace_jump_time, function(){a=1;});
		}
		if (fleet.status==2){
			$('#fleet_move_no_move').html('Fleet is charging jumpengines.'+'<br/>Next jump in <span id="fleetMovementNextJumpTimer">'+secondsToFullTime(fleet.next_hyperspace_jump_time-ad2460.serverTime)+'</span>');
			registerNewTimer('FleetMovementNextJumpTimer', ['fleetMovementNextJumpTimer'], [], fleet.next_hyperspace_jump_time-600, fleet.next_hyperspace_jump_time, function(){a=1;});
		}
		if (fleet.status==3){
			$('#fleet_move_no_move').html('Fleet is in combat');
		}
		$('#fleet_move_no_move').show();
		$('#fleet_move_launch').hide();
		$('#move_to_preset_loc').hide();
		$('#fleet_move_launch_button').hide();
		$('#move_to_preset_selected_location_header').hide();
		$('#move_to_preset_loc_header').hide();
		$('fleet_move_selected_location').html("-");
	}
	else if (fleet.last_hyperspace_jump_time>ad2460.serverTime-600){
		$('#fleet_move_no_move').html('Fleet is charging jumpengines.'+'<br/>Recharged in <span id="fleetMovementNextJumpTimer">'+secondsToFullTime(fleet.last_hyperspace_jump_time+600-ad2460.serverTime)+'</span>');
		//console.log(fleet.last_hyperspace_jump_time+" "+parseInt(fleet.last_hyperspace_jump_time+600));
		//$("#fleetMovementNextJumpTimer").html(secondsToFullTime(fleet.last_hyperspace_jump_time+600));
		registerNewTimer('FleetMovementNextJumpTimer', ['fleetMovementNextJumpTimer'], [], fleet.last_hyperspace_jump_time, fleet.last_hyperspace_jump_time+600, function(){renderMyFleets();});
		$('#fleet_move_no_move').show();
		$('#fleet_move_launch').hide();
		$('#move_to_preset_loc').hide();
		$('#fleet_move_launch_button').hide();
		$('#move_to_preset_selected_location_header').hide();
		$('#move_to_preset_loc_header').hide();
		$('fleet_move_selected_location').html("-");

	}
	else {
		$('#fleet_move_no_move').hide();
		$('#fleet_move_launch').show();
		$('#move_to_preset_loc').show();
		$('#fleet_move_launch_button').show();
		$('#move_to_preset_selected_location_header').show();
		$('#move_to_preset_loc_header').show();

		//$('fleet_move_selected_location').show();
	}

	renderFleetLog(fleet.log,fleet.fleet_name);
}

function renderFleetLog(log,fleetName){
	removeChildNodes('fleetlog');
	var parent=document.getElementById('fleetlog');
	var i=0;
	for (i=0;i<log.length ;i++ ){
		var text="";
		if (log[i].log_type == 'arrival'){
			text=fillIn(translations.military_fleet_log_arrival_template,[fleetName,log[i].arrive_name]);
		}
		else if (log[i].log_type == 'departure'){
			if (log[i].escort_status=='false'){
				text=fillIn(translations.military_fleet_log_departure_template,[fleetName,log[i].depart_name,log[i].arrive_name]);
			}
			else {
				text=fillIn(translations.military_fleet_log_departure_escort_template,[fleetName,log[i].depart_name,log[i].arrive_name]);
			}
		}
		else if (log[i].log_type == 'launch'){
			//text="%1% launched on a hostile mission towards %2%.";
			text=fillIn(translations.military_fleet_log_launch_template,[fleetName,log[i].arrive_name]);
		}
		else if (log[i].log_type == 'midair'){
			//text="%1% was attacked at %2% while charging it's jumpengines.";
			text=fillIn(translations.military_fleet_log_midair_template,[fleetName,log[i].arrive_name]);
		}
		else if (log[i].log_type == 'missionlaunch'){
			//text="%1% has been sent to %2% on a mission.";
			text=fillIn(translations.military_fleet_log_missionlaunch_template,[fleetName,log[i].arrive_name]);

		}
		else if (log[i].log_type == 'missionreturn'){
			//text="%1% has returned to %2% after a mission.";
			text=fillIn(translations.military_fleet_log_missionreturn_template,[fleetName,log[i].arrive_name]);
		}


		var item=document.createElement('div');
		item.setAttribute("class",'fleetlog_entry');

		var imgContainer=document.createElement('div');
		imgContainer.setAttribute("class",'fleetlog_icon');

		// Not sure which icons to use to signify what here....
		var imgIcon=document.createElement('img');
		imgIcon.setAttribute("src",'images/icons/outpost_fleet_2.png');
		imgContainer.appendChild(imgIcon);

		item.appendChild(imgContainer);

		var content=document.createElement('div');
		content.setAttribute("class",'fleetlog_content');

		var mainText=document.createElement('span');
		mainText.innerHTML=text;

		var timeStamp=document.createElement('span');
		timeStamp.setAttribute("class",'fleetlog_timestamp');
		timeStamp.innerHTML=formatDateTime(convertToUTC(log[i].timestamp));

		content.appendChild(mainText);
		content.appendChild(timeStamp);

		item.appendChild(content);

		parent.appendChild(item);
	}


	//<div class="fleetlog_entry">
	//	<div class="fleetlog_icon">
	//		<img src="images/icons/outpost_fleet_2.png">
	//	</div>
	//	<div class="fleetlog_content">
	//		<span><b>Fleet 41</b> has arrived at <b>Homeworld</b> from <b>Hepp Hepp IV</b> They are out of fuel. They have no reason to go on another tour. Please make their next mission something other than babysitting a dead world with a garden hose for an outpost!</span>
	//		<span class="fleetlog_timestamp">23:55:12  12.11.2460</span>
	//	</div>
	//</div>

}

function fleetMovementDropdownChange(){
	var coordString=document.getElementById('move_to_preset_loc').options[document.getElementById('move_to_preset_loc').selectedIndex].value;
	//console.log(coordString);
	var xy=coordString.split("_");
	var x=xy[0];
	var y=xy[1];

	var coords=convertShortCoordsToLongCoords(x,y);

	document.getElementById('fleet_move_selected_location').innerHTML=document.getElementById('move_to_preset_loc').options[document.getElementById('move_to_preset_loc').selectedIndex].innerHTML;

	var i=0;
	if (ad2460.allianceData.id>0){
		for (i=0;i<ad2460.allianceData.memberlist.length ;i++ ){
			if (ad2460.allianceData.memberlist[i].x==x && ad2460.allianceData.memberlist[i].y==y){
				systemFeedback('Note','You can use a max of 50% of your strength to defend allies.', 3, 6);
			}
		}
	}


}

function fleetMoveLaunchClick(){

	var coordString=document.getElementById('move_to_preset_loc').options[document.getElementById('move_to_preset_loc').selectedIndex].value;
	//console.log(coordString);
	var xy=coordString.split("_");
	var x=xy[0];
	var y=xy[1];

	var f=returnFleetById(ad2460.fleetvars.fleet_movement_selected_fleet_id);
	if (f.auto_def==1){
		systemFeedback('Error','Outpost defense-fleet can not be moved.', 1, 1);
		return;
	}

	$.post('actionhandler.pl', {action:'fleet_move_launch', fleet_id:ad2460.fleetvars.fleet_movement_selected_fleet_id, x:x, y:y}, function(data){ parseInfo(data);});

}

function returnShipRenderObjects(fleet){
	var renderArray=new Array;
	var i=0;
	var ship=0;

	var currentShipTypeId=-1;

	for (ship=0 ; ship<fleet.ships.length ; ship++ ){
		thisShip=fleet.ships[ship];

		if (thisShip.ship_type_id!=currentShipTypeId){
			// Make a new entry
			var shipname=returnUnitName(thisShip.ship_type_id);
			renderArray.push(new fleetRenderObject(thisShip.ship_type_id,shipname));
			//console.log("Added fleetRenderObject "+thisShip.ship_type_id +' '+shipname);
		}

		// Now update the data-struct

		var unit=returnGameObjectById(thisShip.ship_type_id);
		renderArray[renderArray.length-1].vesselclass=unit.vesselclass;
		renderArray[renderArray.length-1].vesseltype=unit.vesseltype;
		renderArray[renderArray.length-1].tech=unit.tech;
		renderArray[renderArray.length-1].sort_value=thisShip.ship_type_id;
		if (unit.vesseltype=='Utility')	{
			renderArray[renderArray.length-1].sort_value=499;
		}
		if (unit.vesseltype=='Normal')	{
			if (unit.vesselclass=='Frigate')	{
				if (unit.tech=='None' || unit.tech=='' ){
					renderArray[renderArray.length-1].sort_value=415;
				}

				if (unit.tech=='Matter'){
					renderArray[renderArray.length-1].sort_value=420;
				}
				if (unit.tech=='Energy'){
					renderArray[renderArray.length-1].sort_value=425;
				}
				if (unit.tech=='Displacement'){
					renderArray[renderArray.length-1].sort_value=430;
				}

				//renderArray[renderArray.length-1].sort_value=499;
			}
			if (unit.vesselclass=='Cruiser')	{
				if (unit.tech=='Matter'){
					renderArray[renderArray.length-1].sort_value=440;
				}
				if (unit.tech=='Energy'){
					renderArray[renderArray.length-1].sort_value=445;
				}
				if (unit.tech=='Displacement'){
					renderArray[renderArray.length-1].sort_value=450;
				}
				//renderArray[renderArray.length-1].sort_value=499;
			}
			if (unit.vesselclass=='Battleship')	{
				if (unit.tech=='Matter'){
					renderArray[renderArray.length-1].sort_value=460;
				}
				if (unit.tech=='Energy'){
					renderArray[renderArray.length-1].sort_value=465;
				}
				if (unit.tech=='Displacement'){
					renderArray[renderArray.length-1].sort_value=470;
				}
				//renderArray[renderArray.length-1].sort_value=499;
			}
			if (unit.vesselclass=='Carrier')	{
				if (unit.tech=='Matter'){
					renderArray[renderArray.length-1].sort_value=480;
				}
				if (unit.tech=='Energy'){
					renderArray[renderArray.length-1].sort_value=482;
				}
				if (unit.tech=='Displacement'){
					renderArray[renderArray.length-1].sort_value=484;
				}
				//renderArray[renderArray.length-1].sort_value=499;
			}


		}

		var hullPercentage=getHullPercentage(thisShip);
		if (hullPercentage>99){
			renderArray[renderArray.length-1].ships_over_80_percent++;
		}
		else if (hullPercentage>90){
			renderArray[renderArray.length-1].ships_over_60_percent++;
		}
		else if (hullPercentage>80){
			renderArray[renderArray.length-1].ships_over_40_percent++;
		}
		else if (hullPercentage>75){
			renderArray[renderArray.length-1].ships_over_20_percent++;
		}
		else{
			renderArray[renderArray.length-1].ships_over_0_percent++;
		}

		var thisShipOrgHangarCapacity=returnHangarCapacity(thisShip.ship_type_id);
		renderArray[renderArray.length-1].hangar_capacity+=thisShipOrgHangarCapacity;
		renderArray[renderArray.length-1].used_hangar_capacity+=calculateDockedCapacityPoint(thisShip);
		renderArray[renderArray.length-1].shipcount++;

		currentShipTypeId=thisShip.ship_type_id;
	}

	var i=0;
	for (i=0;i<renderArray.length ;i++ ){

	}

	renderArray.sort(fleetRenderSort);

	return renderArray;
}

function fleetRenderSort(a,b){
	return (a.sort_value-b.sort_value);
}

function clearLaunchTactics(){
	$("#launchslide .tactical_list").removeClass("selected");
}

function renderLaunchTactics(){
	clearLaunchTactics();

	var t=ad2460.launchVars.tactics;
	if (t.target_priority=='Total firepower' || t.target_priority=='Primary firepower' )	{	$("#launch_target_priority_1").addClass("selected");		}
	//if (t.target_priority=='Primary firepower')	{	$("#launch_target_priority_2").addClass("selected");		}
	if (t.target_priority=='Least hull')		{	$("#launch_target_priority_3").addClass("selected");		}
	if (t.target_priority=='Most hull')			{	$("#launch_target_priority_4").addClass("selected");		}
	if (t.target_priority=='Least speed')		{	$("#launch_target_priority_5").addClass("selected");		}
	if (t.target_priority=='Most speed')		{	$("#launch_target_priority_6").addClass("selected");		}
	if (t.target_priority=='Closest ship')		{	$("#launch_target_priority_7").addClass("selected");		}

	if (t.target_switching=='no')				{	$("#launch_target_switching_1").addClass("selected");		}
	if (t.target_switching=='yes')				{	$("#launch_target_switching_2").addClass("selected");		}

	if (t.fighter_priority=='corvette defense')		{	$("#launch_fighter_priority_1").addClass("selected");		}
	if (t.fighter_priority=='capital ship defense')	{	$("#launch_fighter_priority_2").addClass("selected");		}
	if (t.fighter_priority=='ship to ship')			{	$("#launch_fighter_priority_3").addClass("selected");		}
	if (t.fighter_priority=='defend all')			{	$("#launch_fighter_priority_4").addClass("selected");		}

	if (t.corvette_priority=='defense')			{	$("#launch_corvette_priority_1").addClass("selected");		}
	if (t.corvette_priority=='offense')			{	$("#launch_corvette_priority_2").addClass("selected");		}

	if (t.retreat_percentage==0)				{	$("#launch_retreat_percentage_1").addClass("selected");		}
	if (t.retreat_percentage==15)				{	$("#launch_retreat_percentage_2").addClass("selected");		}
	if (t.retreat_percentage==30)				{	$("#launch_retreat_percentage_3").addClass("selected");		}
	if (t.retreat_percentage==45)				{	$("#launch_retreat_percentage_4").addClass("selected");		}
	if (t.retreat_percentage==60)				{	$("#launch_retreat_percentage_5").addClass("selected");		}
	if (t.retreat_percentage==75)				{	$("#launch_retreat_percentage_6").addClass("selected");		}
	if (t.retreat_percentage==90)				{	$("#launch_retreat_percentage_7").addClass("selected");		}

	if (t.retreat_type=='Total firepower' || t.retreat_type=='Total strength')		{	$("#launch_retreat_type_1").addClass("selected");		}
	if (t.retreat_type=='Capital ships')		{	$("#launch_retreat_type_2").addClass("selected");		}
	if (t.retreat_type=='Total hull')			{	$("#launch_retreat_type_3").addClass("selected");		}

	if (t.retreat_if_even=='no')				{	$("#launch_retreat_if_even_1").addClass("selected");		}
	if (t.retreat_if_even=='yes')				{	$("#launch_retreat_if_even_2").addClass("selected");		}

	if (t.retreat_if_unwinnable=='no')			{	$("#launch_retreat_if_unwinnable_1").addClass("selected");		}
	if (t.retreat_if_unwinnable=='yes')			{	$("#launch_retreat_if_unwinnable_2").addClass("selected");		}

}

function selectLaunchTactic(id){
	var t=ad2460.launchVars.tactics;

	if (id=='launch_target_priority_1')		{	t.target_priority='Total firepower';	}
	//else if (id=='launch_target_priority_2')	{	t.target_priority='Tot firepower';	}
	else if (id=='launch_target_priority_3')	{	t.target_priority='Least hull';	}
	else if (id=='launch_target_priority_4')	{	t.target_priority='Most hull';	}
	else if (id=='launch_target_priority_5')	{	t.target_priority='Least speed';	}
	else if (id=='launch_target_priority_6')	{	t.target_priority='Most speed';	}
	else if (id=='launch_target_priority_7')	{	t.target_priority='Closest ship';	}

	else if (id=='launch_target_switching_1')	{	t.target_switching='no';	}
	else if (id=='launch_target_switching_2')	{	t.target_switching='yes';	}

	else if (id=='launch_fighter_priority_1')	{	t.fighter_priority='corvette defense';	}
	else if (id=='launch_fighter_priority_2')	{	t.fighter_priority='capital ship defense';	}
	else if (id=='launch_fighter_priority_3')	{	t.fighter_priority='ship to ship';	}
	else if (id=='launch_fighter_priority_4')	{	t.fighter_priority='defend all';	}

	else if (id=='launch_corvette_priority_1')	{	t.corvette_priority='defense';	}
	else if (id=='launch_corvette_priority_2')	{	t.corvette_priority='offense';	}

	else if (id=='launch_retreat_percentage_1')	{	t.retreat_percentage=0;	}
	else if (id=='launch_retreat_percentage_2')	{	t.retreat_percentage=15;	}
	else if (id=='launch_retreat_percentage_3')	{	t.retreat_percentage=30;	}
	else if (id=='launch_retreat_percentage_4')	{	t.retreat_percentage=45;	}
	else if (id=='launch_retreat_percentage_5')	{	t.retreat_percentage=60;	}
	else if (id=='launch_retreat_percentage_6')	{	t.retreat_percentage=75;	}
	else if (id=='launch_retreat_percentage_7')	{	t.retreat_percentage=90;	}

	else if (id=='launch_retreat_type_1')		{	t.retreat_type='Total firepower';	}
	else if (id=='launch_retreat_type_2')		{	t.retreat_type='Capital ships';	}
	else if (id=='launch_retreat_type_3')		{	t.retreat_type='Total hull';	}

	else if (id=='launch_retreat_if_even_1')		{	t.retreat_if_even='no';		}
	else if (id=='launch_retreat_if_even_2')		{	t.retreat_if_even='yes';	}

	else if (id=='launch_retreat_if_unwinnable_1')		{	t.retreat_if_unwinnable='no';		}
	else if (id=='launch_retreat_if_unwinnable_2')		{	t.retreat_if_unwinnable='yes';	}

}

function clearSelectedFleetTactics(){
	$("#tacticspanel .tactical_list").removeClass("selected");
}

function renderSelectedFleetTactics(station, forced_tactics){
	var t=false;

	if (station=='station'){
		t=forced_tactics;
		$("#copy_tactics_to_all_op_fleets_button").hide();
	}
	else {
		var fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
		t=fleet.tactics;
		$("#copy_tactics_to_all_op_fleets_button").hide();
	}

	if (t!=false){
		clearSelectedFleetTactics();

		if (t.target_priority=='Total firepower' || t.target_priority=='Primary firepower')	{	$("#tac_target_priority_1").addClass("selected");		}
		//if (t.target_priority=='Primary firepower')	{	$("#tac_target_priority_2").addClass("selected");		}
		if (t.target_priority=='Least hull')		{	$("#tac_target_priority_3").addClass("selected");		}
		if (t.target_priority=='Most hull')			{	$("#tac_target_priority_4").addClass("selected");		}
		if (t.target_priority=='Least speed')		{	$("#tac_target_priority_5").addClass("selected");		}
		if (t.target_priority=='Most speed')		{	$("#tac_target_priority_6").addClass("selected");		}
		if (t.target_priority=='Closest ship')		{	$("#tac_target_priority_7").addClass("selected");		}

		if (t.target_switching=='no')				{	$("#tac_target_switching_1").addClass("selected");		}
		if (t.target_switching=='yes')				{	$("#tac_target_switching_2").addClass("selected");		}

		if (t.fighter_priority=='corvette defense')		{	$("#tac_fighter_priority_1").addClass("selected");		}
		if (t.fighter_priority=='capital ship defense')	{	$("#tac_fighter_priority_2").addClass("selected");		}
		if (t.fighter_priority=='ship to ship')			{	$("#tac_fighter_priority_3").addClass("selected");		}
		if (t.fighter_priority=='defend all')			{	$("#tac_fighter_priority_4").addClass("selected");		}

		if (t.corvette_priority=='defense')			{	$("#tac_corvette_priority_1").addClass("selected");		}
		if (t.corvette_priority=='offense')			{	$("#tac_corvette_priority_2").addClass("selected");		}

		if (t.retreat_percentage==0)				{	$("#tac_retreat_percentage_1").addClass("selected");		}
		if (t.retreat_percentage==15)				{	$("#tac_retreat_percentage_2").addClass("selected");		}
		if (t.retreat_percentage==30)				{	$("#tac_retreat_percentage_3").addClass("selected");		}
		if (t.retreat_percentage==45)				{	$("#tac_retreat_percentage_4").addClass("selected");		}
		if (t.retreat_percentage==60)				{	$("#tac_retreat_percentage_5").addClass("selected");		}
		if (t.retreat_percentage==75)				{	$("#tac_retreat_percentage_6").addClass("selected");		}
		if (t.retreat_percentage==90)				{	$("#tac_retreat_percentage_7").addClass("selected");		}

		if (t.retreat_type=='Total firepower' || t.retreat_type=='Total strength')		{	$("#tac_retreat_type_1").addClass("selected");		}
		if (t.retreat_type=='Capital ships')		{	$("#tac_retreat_type_2").addClass("selected");		}
		if (t.retreat_type=='Total hull')			{	$("#tac_retreat_type_3").addClass("selected");		}

		if (t.retreat_if_even=='no')				{	$("#tac_retreat_if_even_1").addClass("selected");		}
		if (t.retreat_if_even=='yes')				{	$("#tac_retreat_if_even_2").addClass("selected");		}

		if (t.retreat_if_unwinnable=='no')			{	$("#tac_retreat_if_unwinnable_1").addClass("selected");		}
		if (t.retreat_if_unwinnable=='yes')			{	$("#tac_retreat_if_unwinnable_2").addClass("selected");		}
	}
}

function selectTactic(id){
	var fleet=false;
	var t=false;

	var updateType='fleet';
	ok_to_update_tactics=true;

	if (ad2460.fleetvars.selected_fleet_id>0){
		fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
		t=fleet.tactics;
	}
	if (ad2460.fleetvars.selected_station_id>0){
		for (i=0;i<ad2460.allianceData.stations.length ;i++ ){
			if (ad2460.allianceData.stations[i].planet_id==ad2460.fleetvars.selected_station_id){
				t=ad2460.allianceData.stations[i].tactics;
				updateType='station';
				if (id=='tac_retreat_percentage_1' || id=='tac_retreat_percentage_2' || id=='tac_retreat_percentage_3' || id=='tac_retreat_percentage_4' || id=='tac_retreat_percentage_5' || id=='tac_retreat_percentage_6' || id=='tac_retreat_percentage_7' || id=='tac_retreat_type_1' || id=='tac_retreat_type_2' || id=='tac_retreat_type_3' || id=='tac_retreat_if_even_1' || id=='tac_retreat_if_even_2' || id=='tac_retreat_if_unwinnable_1' || id=='tac_retreat_if_unwinnable_2'){
					systemFeedback('Error','When defending a station, retreat is just not an option.', 1, 1);
					return;
				}
			}
		}
	}

	if (fleet){
		if (fleet.auto_def==1){
			if (id=='tac_retreat_percentage_1' || id=='tac_retreat_percentage_2' || id=='tac_retreat_percentage_3' || id=='tac_retreat_percentage_4' || id=='tac_retreat_percentage_5' || id=='tac_retreat_percentage_6' || id=='tac_retreat_percentage_7' || id=='tac_retreat_type_1' || id=='tac_retreat_type_2' || id=='tac_retreat_type_3' || id=='tac_retreat_if_even_1' || id=='tac_retreat_if_even_2' || id=='tac_retreat_if_unwinnable_1' || id=='tac_retreat_if_unwinnable_2'){
				ok_to_update_tactics=false;
				$("#tac_retreat_percentage_1").parent().children().removeClass('selected');
				$("#tac_retreat_percentage_1").addClass('selected');

				systemFeedback('Error','Outpost defense will not retreat.', 1, 1);
				return;
			}

		}
	}

	if (t!=false){
		if (id=='tac_target_priority_1' || id=='tac_target_priority_2' )		{	t.target_priority='Total firepower';	}
		//else if (id=='tac_target_priority_2')	{	t.target_priority='Primary firepower';	}
		else if (id=='tac_target_priority_3')	{	t.target_priority='Least hull';	}
		else if (id=='tac_target_priority_4')	{	t.target_priority='Most hull';	}
		else if (id=='tac_target_priority_5')	{	t.target_priority='Least speed';	}
		else if (id=='tac_target_priority_6')	{	t.target_priority='Most speed';	}
		else if (id=='tac_target_priority_7')	{	t.target_priority='Closest ship';	}

		else if (id=='tac_target_switching_1')	{	t.target_switching='no';	}
		else if (id=='tac_target_switching_2')	{	t.target_switching='yes';	}

		else if (id=='tac_fighter_priority_1')	{	t.fighter_priority='corvette defense';	}
		else if (id=='tac_fighter_priority_2')	{	t.fighter_priority='capital ship defense';	}
		else if (id=='tac_fighter_priority_3')	{	t.fighter_priority='ship to ship';	}
		else if (id=='tac_fighter_priority_4')	{	t.fighter_priority='defend all';	}

		else if (id=='tac_corvette_priority_1')	{	t.corvette_priority='defense';	}
		else if (id=='tac_corvette_priority_2')	{	t.corvette_priority='offense';	}

		else if (id=='tac_retreat_percentage_1')	{	t.retreat_percentage=0;	}
		else if (id=='tac_retreat_percentage_2')	{	t.retreat_percentage=15;	}
		else if (id=='tac_retreat_percentage_3')	{	t.retreat_percentage=30;	}
		else if (id=='tac_retreat_percentage_4')	{	t.retreat_percentage=45;	}
		else if (id=='tac_retreat_percentage_5')	{	t.retreat_percentage=60;	}
		else if (id=='tac_retreat_percentage_6')	{	t.retreat_percentage=75;	}
		else if (id=='tac_retreat_percentage_7')	{	t.retreat_percentage=90;	}

		else if (id=='tac_retreat_type_1')		{	t.retreat_type='Total firepower';	}
		else if (id=='tac_retreat_type_2')		{	t.retreat_type='Capital ships';	}
		else if (id=='tac_retreat_type_3')		{	t.retreat_type='Total hull';	}

		else if (id=='tac_retreat_if_even_1')		{	t.retreat_if_even='no';		}
		else if (id=='tac_retreat_if_even_2')		{	t.retreat_if_even='yes';	}

		else if (id=='tac_retreat_if_unwinnable_1')		{	t.retreat_if_unwinnable='no';		}
		else if (id=='tac_retreat_if_unwinnable_2')		{	t.retreat_if_unwinnable='yes';	}
	}

	if (fleet.auto_def==1){
		t.retreat_percentage=0;
		t.retreat_if_even='no';
		t.retreat_if_unwinnable='no';
		t.retreat_type='Total firepower';
		renderSelectedFleetTactics(false, false);
	}
	update_fleet_tactics(updateType);
}

function update_fleet_tactics(updateType){
	var t=false;
	var fleet=false;
	if (updateType=='fleet'){
		fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
		if (fleet!=false){
			t=fleet.tactics;
			if (t.hasOwnProperty('fighter_priority')){
				// We will assume it's ok
				if (ad2460.allianceData.id>0){
					if (fleet.fleet_id==ad2460.allianceData.bank.fleet.fleet_id){
						// Whoops, special case, it's the bank-fleet!
						$.post('actionhandler.pl', {action:'update_bank_tactics', fleet_id:t.fleet_id, target_priority:t.target_priority, target_switching:t.target_switching, minimize_movement:t.fleminimize_movementet_id, fighter_priority:t.fighter_priority, corvette_priority:t.corvette_priority, retreat_percentage:t.retreat_percentage, retreat_type:t.retreat_type, retreat_if_even:t.retreat_if_even, retreat_if_unwinnable:t.retreat_if_unwinnable }, function(data){ parseInfo(data);});
						return;
					}
				}

				$.post('actionhandler.pl', {action:'update_fleet_tactics', fleet_id:t.fleet_id, target_priority:t.target_priority, target_switching:t.target_switching, minimize_movement:t.fleminimize_movementet_id, fighter_priority:t.fighter_priority, corvette_priority:t.corvette_priority, retreat_percentage:t.retreat_percentage, retreat_type:t.retreat_type, retreat_if_even:t.retreat_if_even, retreat_if_unwinnable:t.retreat_if_unwinnable }, function(data){ parseInfo(data);});
				return;
			}
			else {
				//console.log("Oooops, selected fleet does not have valid tactics!!!!");
			}
		}
		else {
			//console.log("Ooops, fleet is false!");
		}
	}
	else if (updateType=='station'){
		for (i=0;i<ad2460.allianceData.stations.length ;i++ ){
			if (ad2460.allianceData.stations[i].planet_id==ad2460.fleetvars.selected_station_id){
				t=ad2460.allianceData.stations[i].tactics;
				updateType='station';
				if (t.hasOwnProperty('fighter_priority')){
					// We will assume it's ok
					$.post('actionhandler.pl', {action:'update_station_tactics', planet_id:t.planet_id, target_priority:t.target_priority, target_switching:t.target_switching, minimize_movement:t.fleminimize_movementet_id, fighter_priority:t.fighter_priority, corvette_priority:t.corvette_priority, retreat_percentage:t.retreat_percentage, retreat_type:t.retreat_type, retreat_if_even:t.retreat_if_even, retreat_if_unwinnable:t.retreat_if_unwinnable }, function(data){ parseInfo(data);});
				}
				else {
					//console.log("Oooops, selected fleet does not have valid tactics!!!!");
				}
				return;

			}
		}

	}
}

function calcHangarData(fleet){
	if (fleet!=false){
		var i=0;
		var totalCapacity=0;
		var spentCapacity=0;
		for (i=0;i<fleet.ships.length ;i++ ){
			totalCapacity+=returnActualHangarSpace(fleet.ships[i].ship_type_id,1);
			var s=returnGameObjectById(fleet.ships[i].ship_type_id);
			if (s.vesseltype=='Normal' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette')){
				spentCapacity++;
			}
		}
	}
	var returnObj={total:totalCapacity,spent:spentCapacity};
	return returnObj;
}

function showSelectedLaunchCompoBonuses(){
	var battleships=0;
	var cruisers=0;
	var carriers=0;
	var frigates=0;

	for (var i=0;i<ad2460.launchVars.selectedFleets.length ;i++ ){
		var thisFleet=ad2460.launchVars.selectedFleets[i];
		for (var x=0;x<thisFleet.ships.length ;x++ ){
			if (thisFleet.ships[x].ship_type_id==417 || thisFleet.ships[x].ship_type_id==418 || thisFleet.ships[x].ship_type_id==419 || thisFleet.ships[x].ship_type_id==424 ){
				battleships++;
			}
			else if (thisFleet.ships[x].ship_type_id==414 || thisFleet.ships[x].ship_type_id==415 || thisFleet.ships[x].ship_type_id==416 || thisFleet.ships[x].ship_type_id==426 || thisFleet.ships[x].ship_type_id==427 || thisFleet.ships[x].ship_type_id==428 || thisFleet.ships[x].ship_type_id==437){
				cruisers++;
			}
			else if (thisFleet.ships[x].ship_type_id==420 || thisFleet.ships[x].ship_type_id==421 || thisFleet.ships[x].ship_type_id==422){
				carriers++;
			}
			else if (thisFleet.ships[x].ship_type_id==434 || thisFleet.ships[x].ship_type_id==441 || thisFleet.ships[x].ship_type_id==411 || thisFleet.ships[x].ship_type_id==423 || thisFleet.ships[x].ship_type_id==442 || thisFleet.ships[x].ship_type_id==412 || thisFleet.ships[x].ship_type_id==425 || thisFleet.ships[x].ship_type_id==443 || thisFleet.ships[x].ship_type_id==413 || thisFleet.ships[x].ship_type_id==444){
				frigates++;
			}

		}
	}
	if (battleships>8){
		battleships=8;
	}
	if (cruisers>40){
		cruisers=40;
	}
	if (carriers>20){
		carriers=20;
	}
	if (frigates>80){
		frigates=80;
	}


	//Battleships RECEIVE the following bonuses:
	var bs_absorb_bonus=cruisers * 20;
	var bs_secondary_targeting_bonus= Math.floor(cruisers / 3);
	var bs_tertiary_targeting_bonus	= Math.floor(cruisers / 3);

	//Cruisers and Carriers RECEIVE the following bonuses:
	var cr_primary_targeting_bonus	= 1 * battleships;
	var cr_primary_damage_bonus		= 2 * battleships; //  %
	var cr_secondary_damage_bonus	= 2 * battleships; //  %
	var cr_tertiary_range_bonus		= 1 * battleships;
	var cr_tertiary_targeting_bonus	= 2 * battleships;

	//Frigates RECEIVE the following bonuses:

	var fr_primary_targeting_bonus	= 1 * battleships;
	var fr_primary_damage_bonus		= 2 * battleships; //  %
	var fr_secondary_targeting_bonus= Math.floor(cruisers / 3);
	var fr_maneuverability_bonus	= 1 * battleships;
	var fr_absorb_bonus				= 5* cruisers;

	//Corvettes RECEIVE the following bonuses:
	var co_absorb_bonus	= 1 * cruisers;
	var co_maneuverability_bonus	= 0.5 * carriers;
	var co_secondary_targeting_bonus= 1 * battleships;
	var co_shield_bonus		= 1 * frigates; //  %

	var string="<span style=\"font-size:13px;line-height: 17px; display: block;\">";

	string+="+"+bs_absorb_bonus+" Battleship Absorb Bonus<br>";
	string+="+"+bs_secondary_targeting_bonus+" Battleship Secondary Targeting Bonus<br>";
	string+="+"+bs_tertiary_targeting_bonus+" Battleship Tertiary Targeting Bonus<br><br>";

	string+="+"+cr_primary_targeting_bonus+" Cruiser Primary Targeting Bonus<br>";
	string+="+"+cr_primary_damage_bonus+"% Cruiser Primary Damage Bonus<br>";
	string+="+"+cr_secondary_damage_bonus+"% Cruiser Secondary Damage Bonus<br>";
	string+="+"+cr_tertiary_range_bonus+" Cruiser Tertiary Range Bonus<br>";
	string+="+"+cr_tertiary_targeting_bonus+" Cruiser Tertiary Targeting Bonus<br><br>";

	string+="+"+fr_primary_targeting_bonus+" Frigate Primary Targeting Bonus<br>";
	string+="+"+fr_primary_damage_bonus+"% Frigate Primary Damage Bonus<br>";
	string+="+"+fr_secondary_targeting_bonus+" Frigate Secondary Targeting Bonus<br>";
	string+="+"+fr_maneuverability_bonus+" Frigate Maneuverability Bonus<br>";
	string+="+"+fr_absorb_bonus+" Frigate Absorb Bonus<br><br>";

	string+="+"+co_absorb_bonus+" Corvette Absorb Bonus<br>";
	// string+="+"+co_maneuverability_bonus+" Corvette Manoeuverability Bonus<br>";
	string+="+"+co_secondary_targeting_bonus+" Corvette Secondary Targeting Bonus<br>";
	string+="+"+co_shield_bonus+" % Corvette Shield Bonus<br><br>";


	string+="Battleships and Cruisers provide different bonuses to different ships in a fleet. Please click the AD-INFO button below to learn more under FLEETS - SHIP TYPES.";
	string+="</span>";

	showSimpleBox('Current Bonuses for the selected fleet',string,'');

}

function showSelectedFleetCompoBonuses(){
	var thisFleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	if (fleet){
		var battleships=0;
		var cruisers=0;
		var carriers=0;
		var frigates=0;

		for (var x=0;x<thisFleet.ships.length ;x++ ){
			if (thisFleet.ships[x].ship_type_id==417 || thisFleet.ships[x].ship_type_id==418 || thisFleet.ships[x].ship_type_id==419 || thisFleet.ships[x].ship_type_id==424 || thisFleet.ships[x].ship_type_id==429 ){
				battleships++;
			}
			else if (thisFleet.ships[x].ship_type_id==414 || thisFleet.ships[x].ship_type_id==415 || thisFleet.ships[x].ship_type_id==416 || thisFleet.ships[x].ship_type_id==426 || thisFleet.ships[x].ship_type_id==427 || thisFleet.ships[x].ship_type_id==428 || thisFleet.ships[x].ship_type_id==437){
				cruisers++;
			}
			else if (thisFleet.ships[x].ship_type_id==420 || thisFleet.ships[x].ship_type_id==421 || thisFleet.ships[x].ship_type_id==422){
				carriers++;
			}
			else if (thisFleet.ships[x].ship_type_id==434 || thisFleet.ships[x].ship_type_id==441 || thisFleet.ships[x].ship_type_id==411 || thisFleet.ships[x].ship_type_id==423 || thisFleet.ships[x].ship_type_id==442 || thisFleet.ships[x].ship_type_id==412 || thisFleet.ships[x].ship_type_id==425 || thisFleet.ships[x].ship_type_id==443 || thisFleet.ships[x].ship_type_id==413 || thisFleet.ships[x].ship_type_id==444){
				frigates++;
			}
		}

		if (battleships>8){
			battleships=8;
		}
		if (cruisers>40){
			cruisers=40;
		}
		if (carriers>20){
			carriers=20;
		}
		if (frigates>80){
			frigates=80;
		}

		//Battleships RECEIVE the following bonuses:
		var bs_absorb_bonus=cruisers * 20;
		var bs_secondary_targeting_bonus= Math.floor(cruisers / 3);
		var bs_tertiary_targeting_bonus	= Math.floor(cruisers / 3);

		//Cruisers and Carriers RECEIVE the following bonuses:
		var cr_primary_targeting_bonus	= 1 * battleships;
		var cr_primary_damage_bonus		= 2 * battleships; //  %
		var cr_secondary_damage_bonus	= 2 * battleships; //  %
		var cr_tertiary_range_bonus		= 1 * battleships;
		var cr_tertiary_targeting_bonus	= 2 * battleships;

		//Frigates RECEIVE the following bonuses:

		var fr_primary_targeting_bonus	= 1 * battleships;
		var fr_primary_damage_bonus		= 2 * battleships; //  %
		var fr_secondary_targeting_bonus= Math.floor(cruisers / 3);
		var fr_maneuverability_bonus	= 1 * battleships;
		var fr_absorb_bonus				= 5* cruisers;

		//Corvettes RECEIVE the following bonuses:
		var co_absorb_bonus	= 1 * cruisers;
		var co_maneuverability_bonus	= 0.5 * carriers;
		var co_secondary_targeting_bonus= 1 * battleships;
		var co_shield_bonus		= 1 * frigates; //  %

		var string="<span style=\"font-size:13px;line-height: 17px; display: block;\">";

		string+="+"+bs_absorb_bonus+" Battleship Absorb Bonus<br>";
		string+="+"+bs_secondary_targeting_bonus+" Battleship Secondary Targeting Bonus<br>";
		string+="+"+bs_tertiary_targeting_bonus+" Battleship Tertiary Targeting Bonus<br><br>";

		string+="+"+cr_primary_targeting_bonus+" Cruiser Primary Targeting Bonus<br>";
		string+="+"+cr_primary_damage_bonus+"% Cruiser Primary Damage Bonus<br>";
		string+="+"+cr_secondary_damage_bonus+"% Cruiser Secondary Damage Bonus<br>";
		string+="+"+cr_tertiary_range_bonus+" Cruiser Tertiary Range Bonus<br>";
		string+="+"+cr_tertiary_targeting_bonus+" Cruiser Tertiary Targeting Bonus<br><br>";

		string+="+"+fr_primary_targeting_bonus+" Frigate Primary Targeting Bonus<br>";
		string+="+"+fr_primary_damage_bonus+"% Frigate Primary Damage Bonus<br>";
		string+="+"+fr_secondary_targeting_bonus+" Frigate Secondary Targeting Bonus<br>";
		string+="+"+fr_maneuverability_bonus+" Frigate Maneuverability Bonus<br>";
		string+="+"+fr_absorb_bonus+" Frigate Absorb Bonus<br><br>";

		string+="+"+co_absorb_bonus+" Corvette Absorb Bonus<br>";
		// string+="+"+co_maneuverability_bonus+" Corvette Manoeuverability Bonus<br>";
		string+="+"+co_secondary_targeting_bonus+" Corvette Secondary Targeting Bonus<br>";
		string+="+"+co_shield_bonus+" % Corvette Shield Bonus<br><br>";

		string+="Battleships and Cruisers provide different bonuses to different ships in a fleet. Please click the AD-INFO button below to learn more under FLEETS - SHIP TYPES.";
		string+="</span>";

		showSimpleBox('Current Bonuses for the selected fleet',string,'');
	}

}

function reselectCurrentFleet(){
	if (ad2460.fleetvars.selected_fleet_id>0){
		selectFleet(ad2460.fleetvars.selected_fleet_id, true)
	}
}

function selectFleet(fleetId, autoselect){
	var i=0;
	if (fleetId<1){
		return;
	}

	if(autoselect==true && ad2460.openQuickMenues.selected_fleet_reassign==true && ad2460.fleetvars.selected_fleet_id>0){
		return;
	}

	if(autoselect==true && ad2460.openQuickMenues.selected_fleet_tactics==true && ad2460.fleetvars.selected_fleet_id>0){
		return;
	}

	if(autoselect==true && ad2460.openQuickMenues.selected_fleet_resupply==true && ad2460.fleetvars.selected_fleet_id>0){
		return;
	}



	fleetAssignPanelDown();
	fleetResupplyPanelDown();
	fleetTacticsPanelDown();

	var parentContainer=document.getElementById('fleet_composition_container');
	removeChildNodes('fleet_composition_container');

	// Clearing out the content of the resupply-panel...
	removeChildNodes('resupply_ship_select_outer_container');

	removeTimer('FleetManagementNextJumpTimer');

	var renderObjects=new Array;
	// renderobjects are the visible boxes
	// On our first pass, we build this structure with the required data
	// Each entry in this array must hold
	// ship_type_id, name, shipcount!
	// ships_over_80_percent, ships_over_60_percent,ships_over_40_percent,ships_over_20_percent,ships_over_0_percent,
	// firepower, shields, hull, hangarspace,

	var total_fleet_shortage=0;

	var thisFleet=returnFleetById(fleetId);

	if (thisFleet==false){
		return;
	}

	// We found the right fleet..Now handle the ships...
	ad2460.fleetvars.selected_fleet_id=fleetId;
	ad2460.fleetvars.selected_station_id=0;
	// Clearing the reassignmentorders...
	ad2460.fleetvars.reassignmentOrders=new Array;


	$("#selected_fleet_tactics_button").css({opacity:1});
	$("#selected_fleet_ship_disband_button").css({opacity:1});

	if (thisFleet.homeworld_fleet==1){
		$("#selected_fleet_ship_disband_button").css({opacity:0.3});
	}

	// lets set the right label on the disband-button
	if (thisFleet.homeworld_fleet==1){
		$("#selected_fleet_ship_disband_button_text").html("Disband");
	}
	else if (thisFleet.ships.length==0){
		$("#selected_fleet_ship_disband_button_text").html("Disband");
	}
	else{
		$("#selected_fleet_ship_disband_button_text").html("Empty");
	}


	if (thisFleet.homeworld_fleet==1 || thisFleet.alliance_fleet==1 || thisFleet.status>0){
		$("#selected_fleet_resupply_button").css({opacity:0.3});
	}
	else {
		$("#selected_fleet_resupply_button").css({opacity:1});
	}

	if (thisFleet.last_hyperspace_jump_time>ad2460.serverTime-600){
		$("#selected_fleet_shipreassign_button").css({opacity:0.3});
	}
	else {
		$("#selected_fleet_shipreassign_button").css({opacity:1});
	}

	if (thisFleet.last_hyperspace_jump_time>ad2460.serverTime-600){
		//$('#fleet_move_no_move').html('Fleet is charging jumpengines.'+'<br/>Recharged in <span id="fleetMovementNextJumpTimer">'+secondsToFullTime(fleet.last_hyperspace_jump_time+600-ad2460.serverTime)+'</span>');
		$("#fleet_management_sidepanel_selected_fleet_recharge").html(secondsToFullTime(thisFleet.last_hyperspace_jump_time+600-ad2460.serverTime));
		registerNewTimer('FleetManagementNextJumpTimer', ['fleet_management_sidepanel_selected_fleet_recharge'], [], thisFleet.last_hyperspace_jump_time, thisFleet.last_hyperspace_jump_time+600, function(){renderMyFleets();});
	}
	else {
		$("#fleet_management_sidepanel_selected_fleet_recharge").html("Ready");
	}



	//$("#auto_fill_fleet_button").remove();
	if (thisFleet.homeworld_fleet==0 && thisFleet.status==0 && thisFleet.auto_def==0 && thisFleet.commander.dead==0 && thisFleet.commander_id>0 && thisFleet.storage_fleet==0 && thisFleet.owner_id==ad2460.user_id) {
		$("#fleet_infopanel_help").html("<div class='fleet_management_bonus_button general_button_blue' onclick='showSelectedFleetCompoBonuses()'>View Current Composition Bonuses</div><div class='general_button_blue fleet_management_auto_fill_button' id='auto_fill_fleet_button' onclick='autoFillFleet(ad2460.fleetvars.selected_fleet_id);'>AutoFill</div>");
	}
	else {
		$("#fleet_infopanel_help").html("<div class='fleet_management_bonus_button general_button_blue' onclick='showSelectedFleetCompoBonuses()'>View Current Composition Bonuses</div>");
	}

	var ship=0;
	var currentShipTypeId=0;
	$("#fleet_management_sidepanel_selected_fleet_name").html(thisFleet.fleet_name);
	if (  (thisFleet.commander_id>0 || thisFleet.auto_def==1) && thisFleet.owner_id==ad2460.user_id){
		document.getElementById('fleet_management_sidepanel_selected_fleet_name').contentEditable='true';
		document.getElementById('fleet_management_sidepanel_selected_fleet_name').onkeydown=function(event){
			if (event.which!=8 && event.keyCode!=8 && event.which!=16 && event.keyCode!=16 && event.which!=37 && event.keyCode!=37 && event.which!=38 && event.keyCode!=38 && event.which!=39 && event.keyCode!=39 && event.which!=40 && event.keyCode!=40 && event.which!=46 && event.keyCode!=46 && event.which!=36 && event.keyCode!=36 && event.which!=35 && event.keyCode!=35 ) {
				if (document.getElementById('fleet_management_sidepanel_selected_fleet_name').innerHTML.length>20){
					event.preventDefault;
					systemFeedback('Error','The name is too long!', 1, 1);
					return false;
				}
				//console.log(event.which,event.keyCode);
			}
			if (event.which==13 || event.keyCode==13) {
				event.preventDefault;
			}
		}
	}
	else {
		document.getElementById('fleet_management_sidepanel_selected_fleet_name').contentEditable='false';
	}

	document.getElementById('fleet_management_sidepanel_selected_fleet_name').onkeypress=function(event){
		if (event.which==13 || event.keyCode==13) {
			//console.log(event.which,event.keyCode);
			if (document.getElementById('fleet_management_sidepanel_selected_fleet_name').innerHTML.length>3){
				updateFleetName();
				document.getElementById('fleet_management_sidepanel_selected_fleet_name').blur();
				return false;
			}
			else {
				systemFeedback('Error','Too short!', 1, 3);
				return false;
			}
		}
	}
	var commander=returnCommanderById(thisFleet.commander_id);
	var maxShips=0;
	var maxStrength=0;

	if (commander){
		maxStrength=returnStrengthLimit(commander.rank);
	}
	else {
		if (thisFleet.auto_def==1){
			for (var t=0;t<ad2460.outposts.length ;t++ ){
				if (ad2460.outposts[t].x==thisFleet.current_x && ad2460.outposts[t].y==thisFleet.current_y){
					maxStrength=ad2460.outposts[t].returnMaxFleetStrength();
				}
			}
		}
	}

	if (maxStrength>0){
		$("#fleet_management_sidepanel_selected_fleet_shipcount").html(prettyPrint(thisFleet.strength)+"/"+prettyPrint(maxStrength));
	}
	else {
		$("#fleet_management_sidepanel_selected_fleet_shipcount").html(prettyPrint(thisFleet.strength));
	}


	if (thisFleet.homeworld_fleet==1 && thisFleet.auto_def==0){
		$("#fleet_management_sidepanel_selected_fleet_shipcount").html(prettyPrint(thisFleet.strength));
	}
	$("#fleet_management_sidepanel_selected_fleet_strength").html(prettyPrint(thisFleet.total_firepower));
	$("#fleet_management_sidepanel_selected_fleet_techtilt").html(returnTechTilt(thisFleet));
	$("#fleet_management_sidepanel_selected_fleet_battles").html(thisFleet.battles);
	$("#fleet_management_sidepanel_selected_fleet_wins").html(thisFleet.wins);
	$("#fleet_management_sidepanel_selected_fleet_losses").html(thisFleet.losses);
	var thisFleetTotalUpkeep=thisFleet.upkeep.hassium+thisFleet.upkeep.neodymium+thisFleet.upkeep.strontium+thisFleet.upkeep.indium;
	thisFleetTotalUpkeep=prettyPrint(thisFleetTotalUpkeep);

	$("#fleet_management_sidepanel_selected_fleet_upkeep").html(prettyPrint(thisFleetTotalUpkeep)+' u/h');

	var hangarData=calcHangarData(thisFleet);
	var total=hangarData.total;
	var spent=hangarData.spent;

	if (thisFleet.homeworld_fleet==1){
		total='N/A';
	}
	if (thisFleet.bank_fleet==1){
		total=1500;
	}

	//$("#fleet_management_sidepanel_selected_fleet_upkeep").html(thisFleetTotalUpkeep);
	$("#fleet_management_sidepanel_selected_fleet_shortage").html(spent+' / '+total);


	document.getElementById("toggle_alliance_fleet_status").selectedIndex=thisFleet.alliance_fleet;
	//document.getElementById("toggle_defense_fleet_status").selectedIndex=thisFleet.auto_def;

	if (thisFleet.storage_fleet==1 || thisFleet.homeworld_fleet==1 ){
		//$("#toggle_alliance_fleet_status_container").hide();
		//$("#toggle_defense_fleet_status_container").hide();
		document.getElementById("toggle_alliance_fleet_status").disabled=true;
		//document.getElementById("toggle_defense_fleet_status").disabled=true;
	}
	else {
		//$("#toggle_alliance_fleet_status_container").show();
		//$("#toggle_defense_fleet_status_container").show();
		document.getElementById("toggle_alliance_fleet_status").disabled=false;
		//document.getElementById("toggle_defense_fleet_status").disabled=false;
	}

	// If the fleet isnt at home, you don't get to make it into an alliance-fleet
	if (thisFleet.current_x!=ad2460.homeworld.x || thisFleet.current_y!=ad2460.homeworld.y ){
		document.getElementById("toggle_alliance_fleet_status").disabled=true;
	}

	var thisCommander=returnCommanderById(thisFleet.commander_id);
	//var portrait_src=returnCommanderPortraitSrc(thisCommander);

	var cmdImages=returnCommanderGraphics(thisCommander);

	if (thisCommander){
		var fullname=thisCommander.name;
		var lastname=extractLastName(fullname);
		var rankObject=returnCommanderRankNameObject(thisCommander.rank);
		$("#selected_fleet_commander_rank_and_name").html(rankObject.shortRank+" "+lastname);
		$("#selected_fleet_commander_rank").html("Rank "+thisCommander.rank);
		//$("#fleet_management_commander_image").attr("src",portrait_src);

		$("#fm_selected_commander_bg").attr("src",cmdImages.bgImage);
		$("#fm_selected_commander_uniform").attr("src",cmdImages.uniformImage);
		$("#fm_selected_commander_head").attr("src",cmdImages.headImage);
		if (thisFleet.owner_id==ad2460.user_id){
			document.getElementById('fm_selected_commander_head').setAttribute("onclick","goFromFleetToCommander('"+thisFleet.fleet_id+"')");
		}
	}
	else {
		$("#selected_fleet_commander_rank_and_name").html("N/A");
		$("#selected_fleet_commander_rank").html("N/A");
		$("#fm_selected_commander_bg").attr("src","images/commanders/nobg.jpg");
		$("#fm_selected_commander_uniform").attr("src","images/commanders/nouniform.png");
		$("#fm_selected_commander_head").attr("src","images/commanders/nohead.png");
		document.getElementById('fm_selected_commander_head').setAttribute("onclick",null);

		if (thisFleet.bank_fleet==1){
			$("#fm_selected_commander_bg").attr("src","images/commanders/bankbattle.jpg");
			$("#selected_fleet_commander_rank_and_name").html("Director");
			$("#selected_fleet_commander_rank").html("Sloan");
		}
		if (thisFleet.auto_def==1){
			$("#fm_selected_commander_bg").attr("src","images/commanders/bankbattle.jpg");
			$("#selected_fleet_commander_rank_and_name").html("OP Defense System");
			// Now get the rank based on OP Potential
			for (var op=0;op<ad2460.outposts.length ;op++ ){
				if (ad2460.outposts[op].x==thisFleet.current_x && ad2460.outposts[op].y==thisFleet.current_y){
					var rankObject=returnCommanderRankNameObject(ad2460.outposts[op].returnCommanderRank());
					var lastname='OP Defense System';
					$("#selected_fleet_commander_rank_and_name").html(lastname);
					$("#selected_fleet_commander_rank").html("Rank "+ad2460.outposts[op].returnCommanderRank());
				}
			}


			//$("#selected_fleet_commander_rank").html("Sloan");

		}

	}
	$("#reassign_free_slots").html(thisFleet.shortage);

	if (thisFleet.alliance_fleet>0){
		$("#selected_fleet_shipreassign_button").css({opacity:0.4});
	}
	else {
		$("#selected_fleet_shipreassign_button").css({opacity:1.0});
	}

	if (thisFleet.owner_id!=ad2460.user_id){
		$("#selected_fleet_resupply_button").css({opacity:0.3});
		$("#selected_fleet_shipreassign_button").css({opacity:0.3});

		$("#selected_fleet_tactics_button").css({opacity:0.3});
		$("#selected_fleet_ship_disband_button").css({opacity:0.3});

		document.getElementById("toggle_alliance_fleet_status").disabled=true;
		//document.getElementById("toggle_defense_fleet_status").disabled=true;
	}

	if(thisFleet.commander_id>0 && thisFleet.homeworld_fleet==0){

		if(thisFleet.strength>thisFleet.commander.rank*10000 && combat_test_mode!=1 ){
			systemFeedback('Error',"There is a strength-problem with this fleet and it's current commander.",1, 3);
		}

	}
	if(thisFleet.shortage<0 && thisFleet.homeworld_fleet==0 && thisFleet.status!=3){
		systemFeedback('Error',"There is a hangarspace-problem with this fleet.",1, 3);
	}

	if (thisFleet.bank_fleet==1){
		var access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_military;
		if (access==1){
			$("#selected_fleet_shipreassign_button").css({opacity:1.0});
			$("#selected_fleet_tactics_button").css({opacity:1.0});
		}

	}



	renderObjects=returnShipRenderObjects(thisFleet);

	// Here we need to deal with the disband-button...
	// Don't display for the homeworld-fleet
	// Don't display for the storage-fleet, but that's a different function!
	// For fleets located on outposts, it should be a fill-button in stead!
	// hide disband_button_container
	// show load_cargo_button_container

	// Lets determine if it is at my own outpost
	var isAtOutpost=false;
	var o=0;
	for (o=0;o<ad2460.outposts.length ;o++ ){
		if (thisFleet.current_x==ad2460.outposts[o].x && thisFleet.current_y==ad2460.outposts[o].y)	{
			isAtOutpost=true;
		}
	}

	if (isAtOutpost){
		$("#disband_button_container").hide();
		$("#load_cargo_button_container").show();
	}
	else {
		$("#load_cargo_button_container").hide();
		$("#disband_button_container").show();
	}

	renderSelectedFleetTactics(); // Hopefully this is the best to call this function...


	// Ok, datastructure renderObjects should now be in place...
	// Now draw them!

	for (i=0;i<renderObjects.length ;i++ ){
		var leftright='list_left';
		if (i % 2 != 0){
			leftright='list_right';
		}
		var rowContainer=returnShipDomObjectNew(leftright, renderObjects[i], "fm_","");

//		// And hey presto, link the entry to the container...

		parentContainer.appendChild(rowContainer);
	}

	renderResupplyPanelContent(fleetId);
}

function outpostPotentialToCommanderRank(potential){
	if (potential==10){	return potential;	}
	if (potential==9){	return potential;	}
	if (potential==8){	return potential;	}
	if (potential==7){	return potential;	}
	if (potential==6){	return potential;	}
	if (potential==5){	return 5;	}
	if (potential==4){	return 5;	}
	if (potential==3){	return 5;	}
	if (potential==2){	return 5;	}
	if (potential==1){	return 5;	}
}

function toggleAllianceFleet(){
	var fleet_id=ad2460.fleetvars.selected_fleet_id;
	$.post('actionhandler.pl', {action:'toggle_alliance_fleet', fleet_id:fleet_id}, function(data){ parseInfo(data);});
}
function disableAllianceFleetUse(){
	document.getElementById("toggle_alliance_fleet_status").selectedIndex=0;

}

function toggleDefenseFleet(){
	var fleet_id=ad2460.fleetvars.selected_fleet_id;
	var newValue=$("#toggle_defense_fleet_status").val();
	$.post('actionhandler.pl', {action:'toggle_defense_fleet', fleet_id:fleet_id, status:newValue}, function(data){ parseInfo(data);});
}

function toggleFleetDefStatus(fleet_id,new_status){
	var fleet=returnFleetById(fleet_id);
	if (fleet!=false){
		fleet.auto_def=new_status;

		selectFleet(ad2460.fleetvars.selected_fleet_id);
	}
}

function selected_fleet_load_cargo_button_click(){
	return;
	/*
	var fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	if (fleet==false){
		systemFeedback('Error','No fleet selected', 1, 3);
		return;
	}

	// Ok, we have a valid fleet selected.
	// Lets pass the call to the backend and let that do the required checks before loading up the resources!
	$.post('actionhandler.pl', {action:'manual_load_cargo', fleet_id:ad2460.fleetvars.selected_fleet_id}, function(data){ parseInfo(data);});
	*/
}

function returnShipDomObjectNew(rowEntryExtraCssClass, renderObject, idPrefix, rowEntrySpecialClass){
	// Not sure I need those incoming params much now, well, the renderObject I do need ofc which holds the ship_type_id , vesselclass etc.
	/* We want to end up with something like this:
	<div class='new_fm_ship_container'>
		<div class="battle_capital_ship_entry normal_ships" onclick="showGameInfoBox(417)">
			<div class="ship_battle_icon ship_417 normal_ships"></div>
			<div class="capital_ship_count normal_ships">1</div>
		</div>
		<div class="fleet_ship_ministatus_container">
			<div class="ministatus100" style="width: 100%;"></div>
			<div class="ministatus80" style="width: 0%;"></div>
			<div class="ministatus60" style="width: 0%;"></div>
			<div class="ministatus40" style="width: 0%;"></div>
			<div class="ministatus20" style="width: 0%;"></div>
		</div>
	</div>
	*/

	var shipClass='battle_capital_ship_entry';
	var sizeClass='few_ships';

	if (renderObject.ship_type_id>=498){
		shipClass='battle_capital_ship_entry defense_entries';
	}
	else if (renderObject.ship_type_id<=410){
		shipClass='battle_capital_ship_entry fighter_entries';
	}
	else if (renderObject.ship_type_id==432 || renderObject.ship_type_id==433 || renderObject.ship_type_id==435 || renderObject.ship_type_id==436 ){
		shipClass='battle_capital_ship_entry utility_entries';
	}

	var container=document.createElement('div');
	container.setAttribute("class","new_fm_ship_container");
	container.setAttribute("onclick","showGameInfoBox("+renderObject.ship_type_id+")");
	container.setAttribute("id","fm_ship_box_"+renderObject.ship_type_id);

	var inner1=document.createElement('div');
	inner1.setAttribute("class",shipClass+" "+sizeClass);

	if (renderObject.ship_type_id==432 || renderObject.ship_type_id==433 || renderObject.ship_type_id==435 || renderObject.ship_type_id==436 ){
		inner1.style.background='none';
		inner1.style.backgroundColor='rgba(128,128,128,0.8)';
	}

	var icon=document.createElement('div');
	icon.setAttribute("class","ship_battle_icon ship_"+renderObject.ship_type_id+" "+sizeClass);

	var shipcounter=document.createElement('div');
	shipcounter.setAttribute("class","capital_ship_count"+" "+sizeClass);
	shipcounter.innerHTML=""+renderObject.shipcount;

	inner1.appendChild(icon);
	inner1.appendChild(shipcounter);
	container.appendChild(inner1);

	var inner2=document.createElement('div');
	inner2.setAttribute("class","fleet_ship_ministatus_container");

	var mini1=document.createElement('div');
	mini1.setAttribute("class","ministatus100");

	var mini2=document.createElement('div');
	mini2.setAttribute("class","ministatus80");

	var mini3=document.createElement('div');
	mini3.setAttribute("class","ministatus60");

	var mini4=document.createElement('div');
	mini4.setAttribute("class","ministatus40");

	var mini5=document.createElement('div');
	mini5.setAttribute("class","ministatus20");

	// Now calc the relative percentages of the ships in the different damage-categories...
	var hull_above_80_percent=0;
	var hull_above_60_percent=0;
	var hull_above_40_percent=0;
	var hull_above_20_percent=0;
	var hull_above_0_percent=0;

	if (renderObject.shipcount>0){
		hull_above_80_percent=Math.floor(renderObject.ships_over_80_percent*100/renderObject.shipcount);
		hull_above_60_percent=Math.floor(renderObject.ships_over_60_percent*100/renderObject.shipcount);
		hull_above_40_percent=Math.floor(renderObject.ships_over_40_percent*100/renderObject.shipcount);
		hull_above_20_percent=Math.floor(renderObject.ships_over_20_percent*100/renderObject.shipcount);
		hull_above_0_percent= Math.floor(renderObject.ships_over_0_percent*100/renderObject.shipcount);
	}

	mini1.style.width = hull_above_80_percent+'%';
	mini2.style.width  = hull_above_60_percent+'%';
	mini3.style.width  = hull_above_40_percent+'%';
	mini4.style.width  = hull_above_20_percent+'%';
	mini5.style.width  = hull_above_0_percent+'%';

	inner2.appendChild(mini1);
	inner2.appendChild(mini2);
	inner2.appendChild(mini3);
	inner2.appendChild(mini4);
	inner2.appendChild(mini5);

	container.appendChild(inner2);

	return container;





}

function returnShipDomObject(rowEntryExtraCssClass, renderObject, idPrefix, rowEntrySpecialClass){
	// the first param is typically "list_left" or "list_right"
	// the second is the renderObject itself, containing the ship-type-data
	// returns a row_container dom-object that can be appended to the desired parent

	var transportClassAddon='';

	var rowContainer=document.createElement('div');
	rowContainer.setAttribute("class","row_container expanderrow_half");
	rowContainer.style.width='223px';

	var fleetshipContainer=document.createElement('div');
	fleetshipContainer.setAttribute("id", idPrefix+"fleetship"+renderObject.ship_type_id);
	fleetshipContainer.setAttribute("onclick","fleetshipClick('"+idPrefix+"fleetship"+renderObject.ship_type_id+"')");

	if (renderObject.ship_type_id==435 || renderObject.ship_type_id==436){
		transportClassAddon=' transport';
	}

	var fleetship_class='row_entry '+rowEntryExtraCssClass+" "+rowEntrySpecialClass+transportClassAddon;
	fleetshipContainer.setAttribute("class",fleetship_class);

	rowContainer.appendChild(fleetshipContainer);

	var shipcountContainer=document.createElement('div');
	shipcountContainer.setAttribute("class","fleet_ship_number");
	shipcountContainer.innerHTML='X'+renderObject.shipcount;
	fleetshipContainer.appendChild(shipcountContainer);

	var ministatusContainer=document.createElement('div');
	ministatusContainer.setAttribute("class",'fleet_ship_ministatus_container');

	fleetshipContainer.appendChild(ministatusContainer);

	var ministatus100=document.createElement('div');
	ministatus100.setAttribute("class",'ministatus100');
	var ministatus80=document.createElement('div');
	ministatus80.setAttribute("class",'ministatus80');
	var ministatus60=document.createElement('div');
	ministatus60.setAttribute("class",'ministatus60');
	var ministatus40=document.createElement('div');
	ministatus40.setAttribute("class",'ministatus40');
	var ministatus20=document.createElement('div');
	ministatus20.setAttribute("class",'ministatus20');

	// Now calc the relative percentages of the ships in the different damage-categories...
	var hull_above_80_percent=0;
	var hull_above_60_percent=0;
	var hull_above_40_percent=0;
	var hull_above_20_percent=0;
	var hull_above_0_percent=0;

	if (renderObject.shipcount>0){
		hull_above_80_percent=Math.floor(renderObject.ships_over_80_percent*100/renderObject.shipcount);
		hull_above_60_percent=Math.floor(renderObject.ships_over_60_percent*100/renderObject.shipcount);
		hull_above_40_percent=Math.floor(renderObject.ships_over_40_percent*100/renderObject.shipcount);
		hull_above_20_percent=Math.floor(renderObject.ships_over_20_percent*100/renderObject.shipcount);
		hull_above_0_percent= Math.floor(renderObject.ships_over_0_percent*100/renderObject.shipcount);
	}

	ministatus100.style.width = hull_above_80_percent+'%';
	ministatus80.style.width  = hull_above_60_percent+'%';
	ministatus60.style.width  = hull_above_40_percent+'%';
	ministatus40.style.width  = hull_above_20_percent+'%';
	ministatus20.style.width  = hull_above_0_percent+'%';

	ministatusContainer.appendChild(ministatus100);
	ministatusContainer.appendChild(ministatus80);
	ministatusContainer.appendChild(ministatus60);
	ministatusContainer.appendChild(ministatus40);
	ministatusContainer.appendChild(ministatus20);

	// So far so good!
	var fleetshipsContainer=document.createElement('div');
	fleetshipsContainer.setAttribute("class",'queue_entry_content_container fleet_ships');
	fleetshipContainer.appendChild(fleetshipsContainer);

	var shipnameContainer=document.createElement('div');
	shipnameContainer.setAttribute("class",'queue_entry_name');
	if (renderObject.ship_type_id>=401 && renderObject.ship_type_id<=410 ){
		shipnameContainer.innerHTML=renderObject.name+'-wing';
	}
	else {
		shipnameContainer.innerHTML=renderObject.name;
	}

	fleetshipsContainer.appendChild(shipnameContainer);

	var fleetinfoBGContainer=document.createElement('div');
	fleetinfoBGContainer.setAttribute("class",'queue_entry_info fleet_info_bg');
	fleetshipsContainer.appendChild(fleetinfoBGContainer);

	var shade1=document.createElement('div');
	shade1.setAttribute("class",'shade');
	fleetinfoBGContainer.appendChild(shade1);

	var fleetshipInfo=document.createElement('div');
	fleetshipInfo.setAttribute("class",'fleet_ship_info');
	fleetinfoBGContainer.appendChild(fleetshipInfo);

	var fleetshipInfoCol1=document.createElement('div');
	fleetshipInfoCol1.setAttribute("class",'fleet_ship_info column_1');
	fleetshipInfo.appendChild(fleetshipInfoCol1);

	var fleet_ship_info_title_0=document.createElement('div');
	fleet_ship_info_title_0.setAttribute("class",'fleet_ship_info_title');
	fleet_ship_info_title_0.innerHTML='Class'+':';

	var fleet_ship_info_title_1=document.createElement('div');
	fleet_ship_info_title_1.setAttribute("class",'fleet_ship_info_title');
	fleet_ship_info_title_1.innerHTML='Firepower'+':';

	var fleet_ship_info_title_2=document.createElement('div');
	fleet_ship_info_title_2.setAttribute("class",'fleet_ship_info_title');
	fleet_ship_info_title_2.innerHTML='Shields'+':';

	var fleet_ship_info_title_3=document.createElement('div');
	fleet_ship_info_title_3.setAttribute("class",'fleet_ship_info_title');
	fleet_ship_info_title_3.innerHTML='Hull'+':';

	var fleet_ship_info_title_4=document.createElement('div');
	fleet_ship_info_title_4.setAttribute("class",'fleet_ship_info_title');
	fleet_ship_info_title_4.innerHTML='Minor ships'+':';

	var fleet_ship_info_entry_0=document.createElement('div');
	fleet_ship_info_entry_0.setAttribute("class",'fleet_ship_info_entry');
	fleet_ship_info_entry_0.innerHTML=renderObject.vesselclass;

	var fleet_ship_info_entry_1=document.createElement('div');
	fleet_ship_info_entry_1.setAttribute("class",'fleet_ship_info_entry');
	fleet_ship_info_entry_1.innerHTML=renderObject.firepower;

	var fleet_ship_info_entry_2=document.createElement('div');
	fleet_ship_info_entry_2.setAttribute("class",'fleet_ship_info_entry');
	fleet_ship_info_entry_2.innerHTML=renderObject.shieldstrength;

	var fleet_ship_info_entry_3=document.createElement('div');
	fleet_ship_info_entry_3.setAttribute("class",'fleet_ship_info_entry');
	fleet_ship_info_entry_3.innerHTML=renderObject.hullstrength;

	var fleet_ship_info_entry_4=document.createElement('div');
	fleet_ship_info_entry_4.setAttribute("class",'fleet_ship_info_entry');
	fleet_ship_info_entry_4.innerHTML=renderObject.used_hangar_capacity +'/'+renderObject.hangar_capacity;

	fleetshipInfoCol1.appendChild(fleet_ship_info_title_0);
	fleetshipInfoCol1.appendChild(fleet_ship_info_entry_0);
	fleetshipInfoCol1.appendChild(fleet_ship_info_title_1);
	fleetshipInfoCol1.appendChild(fleet_ship_info_entry_1);
	fleetshipInfoCol1.appendChild(fleet_ship_info_title_2);
	fleetshipInfoCol1.appendChild(fleet_ship_info_entry_2);
	fleetshipInfoCol1.appendChild(fleet_ship_info_title_3);
	fleetshipInfoCol1.appendChild(fleet_ship_info_entry_3);
	fleetshipInfoCol1.appendChild(fleet_ship_info_title_4);
	fleetshipInfoCol1.appendChild(fleet_ship_info_entry_4);

	//Pheeewww
	var fleetshipInfoCol2=document.createElement('div');
	fleetshipInfoCol2.setAttribute("class",'fleet_ship_info column_2');

	var condHeader=document.createElement('div');
	condHeader.setAttribute("class",'fleet_ship_info_title condition');
	condHeader.innerHTML="Condition Report";
	fleetshipInfoCol2.appendChild(condHeader);
	//<div class="fleet_ship_info_title condition">Condition Report</div>

	var fleetshipMover=document.createElement('div');
	fleetshipMover.setAttribute("class",'fleet_mover');

	//var shipConditionContainer=document.createElement('div');
	//shipConditionContainer.setAttribute("class",'shipconditioncontainer');


	fleetinfoBGContainer.appendChild(fleetshipInfoCol2);
	fleetshipInfoCol2.appendChild(fleetshipMover);
	//fleetshipMover.appendChild(shipConditionContainer);

	// 100-80 %
	var shipConditionTitle100=document.createElement('div');
	shipConditionTitle100.setAttribute("class",'shipconditiontitle');
	shipConditionTitle100.innerHTML='&gt;80%';

	var shipConditionContainer100=document.createElement('div');
	shipConditionContainer100.setAttribute("class",'shipconditioncontainer');

	var shipConditionBar100=document.createElement('div');
	shipConditionBar100.setAttribute("class",'shipcondition100');
	shipConditionBar100.style.width = hull_above_80_percent+'%';

	shipConditionContainer100.appendChild(shipConditionBar100);

	var shipConditionCounter100=document.createElement('div');
	shipConditionCounter100.setAttribute("class",'shipconditioncount');
	shipConditionCounter100.innerHTML=renderObject.ships_over_80_percent;

	fleetshipMover.appendChild(shipConditionTitle100);
	fleetshipMover.appendChild(shipConditionContainer100);
	fleetshipMover.appendChild(shipConditionCounter100);
	// done

	// 80-60 %
	var shipConditionTitle80=document.createElement('div');
	shipConditionTitle80.setAttribute("class",'shipconditiontitle');
	shipConditionTitle80.innerHTML='&gt;60%';

	var shipConditionContainer80=document.createElement('div');
	shipConditionContainer80.setAttribute("class",'shipconditioncontainer');

	var shipConditionBar80=document.createElement('div');
	shipConditionBar80.setAttribute("class",'shipcondition80');
	shipConditionBar80.style.width = hull_above_60_percent+'%';

	shipConditionContainer80.appendChild(shipConditionBar80);

	var shipConditionCounter80=document.createElement('div');
	shipConditionCounter80.setAttribute("class",'shipconditioncount');
	shipConditionCounter80.innerHTML=renderObject.ships_over_60_percent;

	fleetshipMover.appendChild(shipConditionTitle80);
	fleetshipMover.appendChild(shipConditionContainer80);
	fleetshipMover.appendChild(shipConditionCounter80);
	// done

	// 60-40 %
	var shipConditionTitle60=document.createElement('div');
	shipConditionTitle60.setAttribute("class",'shipconditiontitle');
	shipConditionTitle60.innerHTML='&gt;40%';

	var shipConditionContainer60=document.createElement('div');
	shipConditionContainer60.setAttribute("class",'shipconditioncontainer');

	var shipConditionBar60=document.createElement('div');
	shipConditionBar60.setAttribute("class",'shipcondition60');
	shipConditionBar60.style.width = hull_above_40_percent+'%';

	shipConditionContainer60.appendChild(shipConditionBar60);

	var shipConditionCounter60=document.createElement('div');
	shipConditionCounter60.setAttribute("class",'shipconditioncount');
	shipConditionCounter60.innerHTML=renderObject.ships_over_40_percent;

	fleetshipMover.appendChild(shipConditionTitle60);
	fleetshipMover.appendChild(shipConditionContainer60);
	fleetshipMover.appendChild(shipConditionCounter60);
	// done

	// 40-20 %
	var shipConditionTitle40=document.createElement('div');
	shipConditionTitle40.setAttribute("class",'shipconditiontitle');
	shipConditionTitle40.innerHTML='&gt;20%';

	var shipConditionContainer40=document.createElement('div');
	shipConditionContainer40.setAttribute("class",'shipconditioncontainer');

	var shipConditionBar40=document.createElement('div');
	shipConditionBar40.setAttribute("class",'shipcondition40');
	shipConditionBar40.style.width = hull_above_20_percent+'%';

	shipConditionContainer40.appendChild(shipConditionBar40);

	var shipConditionCounter40=document.createElement('div');
	shipConditionCounter40.setAttribute("class",'shipconditioncount');
	shipConditionCounter40.innerHTML=renderObject.ships_over_20_percent;

	fleetshipMover.appendChild(shipConditionTitle40);
	fleetshipMover.appendChild(shipConditionContainer40);
	fleetshipMover.appendChild(shipConditionCounter40);
	// done

	// 20-0 %
	var shipConditionTitle20=document.createElement('div');
	shipConditionTitle20.setAttribute("class",'shipconditiontitle');
	shipConditionTitle20.innerHTML='&gt;0%';

	var shipConditionContainer20=document.createElement('div');
	shipConditionContainer20.setAttribute("class",'shipconditioncontainer');

	var shipConditionBar20=document.createElement('div');
	shipConditionBar20.setAttribute("class",'shipcondition20');
	shipConditionBar20.style.width = hull_above_0_percent+'%';

	shipConditionContainer20.appendChild(shipConditionBar20);

	var shipConditionCounter20=document.createElement('div');
	shipConditionCounter20.setAttribute("class",'shipconditioncount');
	shipConditionCounter20.innerHTML=renderObject.ships_over_0_percent;

	fleetshipMover.appendChild(shipConditionTitle20);
	fleetshipMover.appendChild(shipConditionContainer20);
	fleetshipMover.appendChild(shipConditionCounter20);
	// done


	/*
	var shipConditionTitle=document.createElement('div');
	shipConditionTitle.setAttribute("class",'shipconditiontitle');
	shipConditionTitle.innerHTML='&gt;80%<br>&gt;60%<br>&gt;40%<br>&gt;20%<br>&gt;0%';

	shipConditionContainer.appendChild(shipConditionTitle);

	var shipCondition=document.createElement('div');
	shipCondition.setAttribute("class",'shipcondition');
	shipConditionContainer.appendChild(shipCondition);

	var shipCondition100=document.createElement('div');
	shipCondition100.setAttribute("class",'shipcondition100');
	shipCondition.appendChild(shipCondition100);

	var shipCondition80=document.createElement('div');
	shipCondition80.setAttribute("class",'shipcondition80');
	shipCondition.appendChild(shipCondition80);

	var shipCondition60=document.createElement('div');
	shipCondition60.setAttribute("class",'shipcondition60');
	shipCondition.appendChild(shipCondition60);

	var shipCondition40=document.createElement('div');
	shipCondition40.setAttribute("class",'shipcondition40');
	shipCondition.appendChild(shipCondition40);

	var shipCondition20=document.createElement('div');
	shipCondition20.setAttribute("class",'shipcondition20');
	shipCondition.appendChild(shipCondition20);

	shipCondition100.style.width = hull_above_80_percent+'%';
	shipCondition80.style.width  = hull_above_60_percent+'%';
	shipCondition60.style.width  = hull_above_40_percent+'%';
	shipCondition40.style.width  = hull_above_20_percent+'%';
	shipCondition20.style.width  = hull_above_0_percent+'%';

	var shipConditionCount=document.createElement('div');
	shipConditionCount.setAttribute("class",'shipconditioncount');
	shipConditionContainer.appendChild(shipConditionCount);

	var shipConditionCounter1=document.createElement('div');
	shipConditionCounter1.setAttribute("class",'counter');
	shipConditionCounter1.innerHTML=renderObject.ships_over_80_percent;

	var shipConditionCounter2=document.createElement('div');
	shipConditionCounter2.setAttribute("class",'counter');
	shipConditionCounter2.innerHTML=renderObject.ships_over_60_percent;

	var shipConditionCounter3=document.createElement('div');
	shipConditionCounter3.setAttribute("class",'counter');
	shipConditionCounter3.innerHTML=renderObject.ships_over_40_percent;

	var shipConditionCounter4=document.createElement('div');
	shipConditionCounter4.setAttribute("class",'counter');
	shipConditionCounter4.innerHTML=renderObject.ships_over_20_percent;

	var shipConditionCounter5=document.createElement('div');
	shipConditionCounter5.setAttribute("class",'counter');
	shipConditionCounter5.innerHTML=renderObject.ships_over_0_percent;

	shipConditionCount.appendChild(shipConditionCounter1);
	shipConditionCount.appendChild(shipConditionCounter2);
	shipConditionCount.appendChild(shipConditionCounter3);
	shipConditionCount.appendChild(shipConditionCounter4);
	shipConditionCount.appendChild(shipConditionCounter5);
	*/
	var shipImageContainer=document.createElement('div');
	shipImageContainer.setAttribute("class",'queue_entry_img');
	fleetshipsContainer.appendChild(shipImageContainer);

	var shipImage=document.createElement('img');
	shipImage.setAttribute("src","images/icons/production/"+renderObject.ship_type_id+".jpg");
	shipImageContainer.appendChild(shipImage);

	return rowContainer;

}

function renderResupplyPanelContent(fleetId){
	var container=document.getElementById("resupply_ship_select_outer_container");
	var fleet=returnFleetById(fleetId);
	if (fleet==false){
		return;
	}
	if (fleet.owner_id!=ad2460.user_id){
		return;
	}

	var renderCount=0;
	if (fleet){
		//console.log("Rendering resupply-content...");
		var storage_fleet=returnHomeworldFleet();
		if (storage_fleet){
			//console.log("storage fleet found");
			var s=0;
			var renderArray=new Array;
			renderArray.push({ship_type_id:401,counter:0});
			renderArray.push({ship_type_id:402,counter:0});
			renderArray.push({ship_type_id:403,counter:0});
			renderArray.push({ship_type_id:404,counter:0});
			renderArray.push({ship_type_id:405,counter:0});
			renderArray.push({ship_type_id:406,counter:0});
			renderArray.push({ship_type_id:407,counter:0});
			renderArray.push({ship_type_id:408,counter:0});
			renderArray.push({ship_type_id:409,counter:0});
			renderArray.push({ship_type_id:410,counter:0});

			for (s=0;s<storage_fleet.ships.length ;s++ ){
				var slot=storage_fleet.ships[s];
				for (var x=0;x<renderArray.length ;x++ ){
					if (renderArray[x].ship_type_id==slot.ship_type_id){
						renderArray[x].counter++;
					}
				}
			}
			for (var x=0;x<renderArray.length ;x++ ){
				if (renderArray[x].counter>0){
					renderCount++;
					var prodItem=returnUnit(renderArray[x].ship_type_id);

					var itemContainer=createSingleElement('div', 'resupply_ship_select_container', '', '', '');
					var div1=createSingleElement('div', 'shiptype_select minor_ship', '', '', '');
					var nameDiv=createSingleElement('div', 'shiptype_name', '', prodItem.name, '');
					var imgDiv=createSingleElement('div', 'shiptype_img', '', '', '');
					var img=createSingleElement('img', '', '', 'images/icons/miniships/100x100/'+renderArray[x].ship_type_id+'.png', '');

					div1.appendChild(nameDiv);
					div1.appendChild(imgDiv);
					imgDiv.appendChild(img);
					itemContainer.appendChild(div1);

					var currentCountOfThisShipTypeInFleet=returnShiptypeCountFromFleet(renderArray[x].ship_type_id, fleet);
					var availableCountOfThisShipTypeInStorage=renderArray[x].counter;

					var div2=createSingleElement('div', 'resupply_count', '', '', '');
					var countHeader=createSingleElement('div', 'resupply_header', '', 'C', '');
					var countLine=createSingleElement('div', 'resupply_line', '', '', '');
					var countNumber=createSingleElement('div', 'resupply_number', '', ''+currentCountOfThisShipTypeInFleet, '');

					div2.appendChild(countHeader);
					div2.appendChild(countLine);
					div2.appendChild(countNumber);

					itemContainer.appendChild(div2);

					var div3=createSingleElement('div', 'shiptype_select minor_ship_assign', '', '', '');
					var inputBox=createSingleElement('input', 'input_styling minor_ship_assign_input', 'reassign_input_'+renderArray[x].ship_type_id, '0', '');
					inputBox.setAttribute("onkeyup","updateReassignFreeSlots()");
					div3.appendChild(inputBox);

					itemContainer.appendChild(div3);

					var div4=createSingleElement('div', 'resupply_count available available', '', '', '');
					var availableHeader=createSingleElement('div', 'resupply_header', '', 'A', '');
					var availableLine=createSingleElement('div', 'resupply_line', '', '', '');
					var availableNumber=createSingleElement('div', 'resupply_number', '', ''+availableCountOfThisShipTypeInStorage, '');

					div4.appendChild(availableHeader);
					div4.appendChild(availableLine);
					div4.appendChild(availableNumber);

					itemContainer.appendChild(div4);

					if (renderCount % 2 == 1){
						var spacer=createSingleElement('div', 'shipsupplyspacer', '', '', '');
						itemContainer.appendChild(spacer);
					}

					container.appendChild(itemContainer);

				}
			}
		}
	}
}

function returnShiptypeCountFromFleet(ship_type_id, fleet){
	// Oh dear...We have our work cut out for us...
	//console.log("returnShiptypeCountFromFleet called with ship_type_id "+ship_type_id);
	var count=0;
	var i=0;
	if (fleet){
		for (i=0;i<fleet.ships.length ;i++ ){
			if (fleet.ships[i].ship_type_id==ship_type_id){
				count++;
			}
			// capital ship counted
			// But maybe I'm counting a stored small ship!
			if		(ship_type_id==401){	count+=fleet.ships[i].docked_401; }
			else if (ship_type_id==402){	count+=fleet.ships[i].docked_402; }
			else if (ship_type_id==403){	count+=fleet.ships[i].docked_403; }
			else if (ship_type_id==404){	count+=fleet.ships[i].docked_404; }
			else if (ship_type_id==405){	count+=fleet.ships[i].docked_405; }
			else if (ship_type_id==406){	count+=fleet.ships[i].docked_406; }
			else if (ship_type_id==407){	count+=fleet.ships[i].docked_407; }
			else if (ship_type_id==408){	count+=fleet.ships[i].docked_408; }
			else if (ship_type_id==409){	count+=fleet.ships[i].docked_409; }
			else if (ship_type_id==410){	count+=fleet.ships[i].docked_410; }
			// There, that should include the valid small ships...

		}
	}
	//console.log("Return count of "+count+ " for ship_type_id "+ship_type_id);
	return count;
}


function clearReassignmentOrders(){
	ad2460.fleetvars.selectedFleetReassignArray=new Array;
	ad2460.fleetvars.reassignmentOrders=new Array;
	removeChildNodes('reassignmentListContainer');
}


function fleetshipClick(tableid){
	var element=$("#"+tableid+"");
	var itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight(),10)+35;
	var itemdisplace = -35;
	var itemdisplaceleft = 10;
	var itemdisplaceright = 10;
	var rowheight = 28;

	if (ad2460.fleetvars.selected_shiptype_row_id=='') {
		ad2460.fleetvars.selected_shiptype_row_id=tableid;
		if (element.hasClass("outpostships")) {
			itemheight =  120//parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
			itemdisplace = -35;
		};
		if (element.hasClass("outpostships_top")) {
			itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
			itemdisplace = -5;
		};
		if (element.hasClass("outpostships_bottom")) {
			itemdisplace = -65;
		};
		if (element.hasClass("list_right")) {
			itemdisplaceleft= -(parseInt($("#"+tableid+".row_entry").outerWidth(),10)-6);
		};
		if (element.hasClass("list_left")) {
			itemdisplaceright= -(parseInt($("#"+tableid+".row_entry").outerWidth(),10))+6;
		};
		if (element.hasClass("commander_entry")) {
			$("#"+tableid+" .defensive_commander_img").animate( { left: "5px" }, 300);
			$("#"+tableid+" .defensive_commander_name").animate( { left: "5px" }, 300);
			$("#"+tableid+" .def_commander_statcontainer").delay(200).animate( { opacity: 1 }, 300);
			itemheight = 150;
	    	itemdisplace = 0;
			itemdisplaceleft = -210;
			itemdisplaceright = 0;
		};
		if (element.hasClass("def_tactics_entry")) {
			itemheight = 265;
	    	itemdisplace = -155;
			itemdisplaceleft = 0;
			itemdisplaceright = 0;

			var tmp=0;
			var tactical_rows=$(this).children(".tactical_row");

			for (tmp=0;tmp<tactical_rows.size();tmp++){
				var myElement=tactical_rows[tmp];
				var def_tactical_options=$(myElement).children('.def_tactical_options');
				// id 0 av disse skal ha høyden
				var tmpHeight=0;
				var tmp2=0;
				for (tmp2=0;tmp2<def_tactical_options.size();tmp2++){
					var myElement2=def_tactical_options[tmp2];
					var tactical_wrapper=$(myElement2).children('.tactical_wrapper:first');
					var thisHeight=$(tactical_wrapper[0]).height();
					tmpHeight+=thisHeight;
				}
				$(def_tactical_options[0]).stop().delay(50).animate({ height: (tmpHeight-18)+"px" },300);

			}
		$(".def_current_tactic").stop().delay(50).animate( { height: "0px" }, 300);
		//$("#"+tableid+" .def_tactical_options").each( function() {
		//$("#"+tableid+" .def_tactical_options").stop().animate( { height: ($('.tactical_wrapper').height()) }, 450);
		//});
		};

		if (element.hasClass("reserve_ship")) {
			$("#"+tableid+" .queue_entry_reserve").animate({width: '100px'},350);
			$("#"+tableid+" .column_button.reserve").animate({opacity: 0},{duration :100, complete: function() {$("#"+tableid+" .column_button.reserve").css({top: '30px', right: '5px', width: '150px'});}}).delay(100).animate({opacity: 1},300);
			$("#"+tableid+" .column_button.reserve2").show().animate({opacity: 1},400);
		};

		expandSelectedRow(tableid, itemheight, itemdisplace,itemdisplaceleft, itemdisplaceright);

	}

	else {
		tableid=ad2460.fleetvars.selected_shiptype_row_id;
		element=$("#"+tableid+"");
		if (element.hasClass("commander_entry")) {
			$("#"+tableid+" .defensive_commander_img").animate( { left: "25px" }, 300);
			$("#"+tableid+" .defensive_commander_name").animate( { left: "25px" }, 300);
			$("#"+tableid+" .def_commander_statcontainer").animate( { opacity: 0 }, 100);
			rowheight = 150;
		};
		if (element.hasClass("def_tactics_entry")) {
			rowheight = 110;
			$("#"+tableid+" .def_tactical_options").each( function() {
			$('.def_tactical_options').stop().animate( { height: "18px" }, 300);
			$(".def_current_tactic").stop().animate( { height: "18px" }, 300);
		});
		$("#"+tableid+" .retreat_condition").stop().animate( { height: "0px" }, 300);
		};

		if (element.hasClass("reserve_ship")) {
			$("#"+tableid+" .queue_entry_reserve").animate({width: '220px'},350);
			$("#"+tableid+" .column_button.reserve").animate({opacity: 0},{duration :200, complete: function() {$("#"+tableid+" .column_button.reserve").css({top: '-3px', right: '0px', width: '120px',zIndex: 3});}}).delay(100).animate({opacity: 1},400);
			$("#"+tableid+" .column_button.reserve2").animate({opacity: 0},{duration :100, complete: function() {$("#"+tableid+" .column_button.reserve2").css({zIndex: 0}).hide();}});
		};

		minimizeSelectedRow(tableid,rowheight);
		ad2460.fleetvars.selected_shiptype_row_id='';
	}
}

function resupplyAllClick(ship_type_id){
//	console.log("Resupply all clicked for ship_type_id "+ship_type_id);
	if (ship_type_id>0){
		$.post('actionhandler.pl', {action:'resupply_all', ship_type_id:ship_type_id}, function(data){ parseInfo(data);});
	}
	event.stopPropagation();
	return false;
}



function assembleAllShipsQuickMenu(paramObject){
	var capitalShips=new Array;
	var defenseShips=new Array;
	var utility1Ships=new Array;
	var utility2Ships=new Array;
	var minorShips=new Array;

	var skipOutpostFleets=false;

	if (paramObject){
		if (paramObject.hasOwnProperty('skipOutposts')){
			skipOutpostFleets=true;
		}
	}

	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].auto_def==1 && skipOutpostFleets==true){
			// skip it!
			continue;
		}
		var ship=0;
		for (ship=0;ship<ad2460.myFleets[i].ships.length ;ship++ ){
			var obj=returnGameObjectById(ad2460.myFleets[i].ships[ship].ship_type_id);

			if (obj.vesseltype=='Utility')	{
				if (obj.id==430 || obj.id==431)	{
					var found=false;
					for (x=0;x<utility2Ships.length ;x++ ){
						if (utility2Ships[x].id==obj.id){
							utility2Ships[x].counter++;
							found=true;
						}
					}
					if (found==false){
						obj.counter=1;
						utility2Ships.push(obj);
					}
				}
				else {
					var found=false;
					for (x=0;x<utility1Ships.length ;x++ ){
						if (utility1Ships[x].id==obj.id){
							utility1Ships[x].counter++;
							found=true;
						}
					}
					if (found==false){
						obj.counter=1;
						utility1Ships.push(obj);
					}

				}
			}
			else if (obj.id>500){
				var found=false;
				for (x=0;x<defenseShips.length ;x++ ){
					if (defenseShips[x].id==obj.id){
						defenseShips[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					defenseShips.push(obj);
				}

			}
			else if (obj.vesselclass=='Fighter' ||obj.vesselclass=='Corvette' ){
				var found=false;
				for (x=0;x<minorShips.length ;x++ ){
					if (minorShips[x].id==obj.id){
						minorShips[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					minorShips.push(obj);
				}
			}
			else {
				var found=false;
				for (x=0;x<capitalShips.length ;x++ ){
					if (capitalShips[x].id==obj.id){
						capitalShips[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					capitalShips.push(obj);
				}
			}
		}

		if (ad2460.myFleets[i].storage_fleet==1){
			var s=0;
			for (s=0;s<ad2460.myFleets[i].storage.length ;s++ ){
				var thisStorage=ad2460.myFleets[i].storage[s];

				// And the scouts and prospector then...
				if (thisStorage.ship_type_id==430 || thisStorage.ship_type_id==431){
					var obj=returnGameObjectById(thisStorage.ship_type_id);
					var found=false;
					for (x=0;x<utility2Ships.length ;x++ ){
						if (utility2Ships[x].id==obj.id){
							utility2Ships[x].counter+=thisStorage.counter;
							found=true;
						}
					}
					if (found==false){
						obj.counter=thisStorage.counter;
						utility2Ships.push(obj);
					}
				}
			}
		}
		// Storage handeled, phew!
	}

	// We're ready to draw!
	removeChildNodes('ship_overview_capital_ships_container');
	removeChildNodes('ship_overview_defense_container');
	removeChildNodes('ship_overview_utility1_container');
	removeChildNodes('ship_overview_utility2_container');
	removeChildNodes('ship_overview_minor_ships_container');

	minorShips.sort(function(a, b){ return a.id-b.id });
	capitalShips.sort(function(a, b){ return a.time_cost-b.time_cost });

	var lvl1OutpostUnits=0;
	var lvl4OutpostUnits=0;
	var lvl7OutpostUnits=0;
	var i=0;
	for (i=0;i<ad2460.homeworld.orbit.length ;i++ ){
		if (ad2460.homeworld.orbit[i].id==438){
			lvl1OutpostUnits=ad2460.homeworld.orbit[i].count;
		}
		if (ad2460.homeworld.orbit[i].id==439){
			lvl4OutpostUnits=ad2460.homeworld.orbit[i].count;
		}
		if (ad2460.homeworld.orbit[i].id==440){
			lvl7OutpostUnits=ad2460.homeworld.orbit[i].count;
		}
	}




	var parent=document.getElementById('ship_overview_capital_ships_container');
	for (i=0;i<capitalShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+capitalShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', capitalShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+capitalShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+capitalShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}
	var parent=document.getElementById('ship_overview_defense_container');
	for (i=0;i<defenseShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+defenseShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', defenseShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+defenseShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+defenseShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	var parent=document.getElementById('ship_overview_utility1_container');
	for (i=0;i<utility1Ships.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
				outer.setAttribute("onclick","showGameInfoBox("+utility1Ships[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', utility1Ships[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+utility1Ships[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+utility1Ships[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	var parent=document.getElementById('ship_overview_utility2_container');
	for (i=0;i<utility2Ships.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+utility2Ships[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', utility2Ships[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+utility2Ships[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+utility2Ships[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	// We need a special-case to deal with the possible outposts here as well
		var unitId=438;
		var unit=returnGameObjectById(unitId);
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+unitId+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', unit.name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/438.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+lvl1OutpostUnits, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);

		var unitId=439;
		var unit=returnGameObjectById(unitId);
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+unitId+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', unit.name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/439.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+lvl4OutpostUnits, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);

		var unitId=440;
		var unit=returnGameObjectById(unitId);
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+unitId+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', unit.name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/440.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+lvl7OutpostUnits, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);




	var parent=document.getElementById('ship_overview_minor_ships_container');
	for (i=0;i<minorShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+minorShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', minorShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+minorShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+minorShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}
}

function assembleAllShipsQuickMenuStationcontingent(planet_id){
	for (var s=0;s<ad2460.allianceData.stations.length ;s++ ){
		if (ad2460.allianceData.stations[s].planet_id==planet_id){
			renderFleetArray(ad2460.allianceData.stations[s].fleets, true);
			return;
		}
	}


}

function renderFleetArray(array, stationView){
	var capitalShips=new Array;
	var defenseShips=new Array;
	var utility1Ships=new Array;
	var utility2Ships=new Array;
	var minorShips=new Array;

	var i=0;
	for (i=0;i<array.length ;i++ ){
		var ship=0;
		for (ship=0;ship<array[i].ships.length ;ship++ ){
			var obj=returnGameObjectById(array[i].ships[ship].ship_type_id);

			if (obj.vesseltype=='Utility')	{
				if (obj.id==430 || obj.id==431)	{
					var found=false;
					for (x=0;x<utility2Ships.length ;x++ ){
						if (utility2Ships[x].id==obj.id){
							utility2Ships[x].counter++;
							found=true;
						}
					}
					if (found==false){
						obj.counter=1;
						utility2Ships.push(obj);
					}
				}
				else {
					var found=false;
					for (x=0;x<utility1Ships.length ;x++ ){
						if (utility1Ships[x].id==obj.id){
							utility1Ships[x].counter++;
							found=true;
						}
					}
					if (found==false){
						obj.counter=1;
						utility1Ships.push(obj);
					}

				}
			}
			else if (obj.id>=499){
				var found=false;
				for (x=0;x<defenseShips.length ;x++ ){
					if (defenseShips[x].id==obj.id){
						defenseShips[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					defenseShips.push(obj);
				}

			}
			else if (obj.vesselclass=='Fighter' ||obj.vesselclass=='Corvette' ){
				var found=false;
				for (x=0;x<minorShips.length ;x++ ){
					if (minorShips[x].id==obj.id){
						minorShips[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					minorShips.push(obj);
				}
			}
			else {
				var found=false;
				for (x=0;x<capitalShips.length ;x++ ){
					if (capitalShips[x].id==obj.id){
						capitalShips[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					capitalShips.push(obj);
				}
			}
		}
	}

	// We're ready to draw!
	removeChildNodes('ship_overview_capital_ships_container');
	removeChildNodes('ship_overview_defense_container');
	removeChildNodes('ship_overview_utility1_container');
	removeChildNodes('ship_overview_utility2_container');
	removeChildNodes('ship_overview_minor_ships_container');

	minorShips.sort(function(a, b){ return a.id-b.id });
	capitalShips.sort(function(a, b){ return a.time_cost-b.time_cost });



	var parent=document.getElementById('ship_overview_capital_ships_container');
	for (i=0;i<capitalShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+capitalShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', capitalShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+capitalShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+capitalShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}
	var parent=document.getElementById('ship_overview_defense_container');
	if (stationView==true){
		parent=document.getElementById('ship_overview_minor_ships_container');
		$("#ship_overview_sep_1").show();
	}
	for (i=0;i<defenseShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+defenseShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', defenseShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+defenseShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+defenseShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	var parent=document.getElementById('ship_overview_utility1_container');
	for (i=0;i<utility1Ships.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+utility1Ships[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', utility1Ships[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+utility1Ships[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+utility1Ships[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	var parent=document.getElementById('ship_overview_utility2_container');
	for (i=0;i<utility2Ships.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+utility2Ships[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', utility2Ships[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+utility2Ships[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+utility2Ships[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	var parent=document.getElementById('ship_overview_defense_container');

	for (i=0;i<minorShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+minorShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', minorShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+minorShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+minorShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}
}

function assembleAllShipsQuickMenuLaunchcontingent(){
	renderFleetArray(ad2460.launchVars.selectedFleets);
}

function assembleAllShipsQuickMenuLaunchcontingentOld(){
	var capitalShips=new Array;
	var defenseShips=new Array;
	var utility1Ships=new Array;
	var utility2Ships=new Array;
	var minorShips=new Array;

	var i=0;
	for (i=0;i<ad2460.launchVars.selectedFleets.length ;i++ ){
		var ship=0;
		for (ship=0;ship<ad2460.launchVars.selectedFleets[i].ships.length ;ship++ ){
			var obj=returnGameObjectById(ad2460.launchVars.selectedFleets[i].ships[ship].ship_type_id);

			if (obj.vesseltype=='Utility')	{
				if (obj.id==430 || obj.id==431)	{
					var found=false;
					for (x=0;x<utility2Ships.length ;x++ ){
						if (utility2Ships[x].id==obj.id){
							utility2Ships[x].counter++;
							found=true;
						}
					}
					if (found==false){
						obj.counter=1;
						utility2Ships.push(obj);
					}
				}
				else {
					var found=false;
					for (x=0;x<utility1Ships.length ;x++ ){
						if (utility1Ships[x].id==obj.id){
							utility1Ships[x].counter++;
							found=true;
						}
					}
					if (found==false){
						obj.counter=1;
						utility1Ships.push(obj);
					}

				}
			}
			else if (obj.id>500){
				var found=false;
				for (x=0;x<defenseShips.length ;x++ ){
					if (defenseShips[x].id==obj.id){
						defenseShips[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					defenseShips.push(obj);
				}

			}
			else if (obj.vesselclass=='Fighter' ||obj.vesselclass=='Corvette' ){
				var found=false;
				for (x=0;x<minorShips.length ;x++ ){
					if (minorShips[x].id==obj.id){
						minorShips[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					minorShips.push(obj);
				}
			}
			else {
				var found=false;
				for (x=0;x<capitalShips.length ;x++ ){
					if (capitalShips[x].id==obj.id){
						capitalShips[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					capitalShips.push(obj);
				}
			}
		}
	}

	// We're ready to draw!
	removeChildNodes('ship_overview_capital_ships_container');
	removeChildNodes('ship_overview_defense_container');
	removeChildNodes('ship_overview_utility1_container');
	removeChildNodes('ship_overview_utility2_container');
	removeChildNodes('ship_overview_minor_ships_container');

	minorShips.sort(function(a, b){ return a.id-b.id });
	capitalShips.sort(function(a, b){ return a.time_cost-b.time_cost });



	var parent=document.getElementById('ship_overview_capital_ships_container');
	for (i=0;i<capitalShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+capitalShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', capitalShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+capitalShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+capitalShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}
	var parent=document.getElementById('ship_overview_defense_container');
	for (i=0;i<defenseShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+defenseShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', defenseShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+defenseShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+defenseShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	var parent=document.getElementById('ship_overview_utility1_container');
	for (i=0;i<utility1Ships.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
				outer.setAttribute("onclick","showGameInfoBox("+utility1Ships[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', utility1Ships[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+utility1Ships[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+utility1Ships[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	var parent=document.getElementById('ship_overview_utility2_container');
	for (i=0;i<utility2Ships.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+utility2Ships[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', utility2Ships[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+utility2Ships[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+utility2Ships[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	var parent=document.getElementById('ship_overview_defense_container');
	for (i=0;i<minorShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+minorShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', minorShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+minorShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+minorShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}
}





function assembleAllShipsQuickMenuLaunchfleet(fleet){
	var capitalShips=new Array;
	var defenseShips=new Array;
	var utility1Ships=new Array;
	var utility2Ships=new Array;
	var minorShips=new Array;

	var i=0;

	//console.log(fleet);

	var ship=0;
	for (ship=0;ship<fleet.ships.length ;ship++ ){
		var obj=returnGameObjectById(fleet.ships[ship].ship_type_id);

		if (obj.vesseltype=='Utility')	{
			if (obj.id==430 || obj.id==431)	{
				var found=false;
				for (x=0;x<utility2Ships.length ;x++ ){
					if (utility2Ships[x].id==obj.id){
						utility2Ships[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					utility2Ships.push(obj);
				}
			}
			else {
				var found=false;
				for (x=0;x<utility1Ships.length ;x++ ){
					if (utility1Ships[x].id==obj.id){
						utility1Ships[x].counter++;
						found=true;
					}
				}
				if (found==false){
					obj.counter=1;
					utility1Ships.push(obj);
				}

			}
		}
		else if (obj.id>500){
			var found=false;
			for (x=0;x<defenseShips.length ;x++ ){
				if (defenseShips[x].id==obj.id){
					defenseShips[x].counter++;
					found=true;
				}
			}
			if (found==false){
				obj.counter=1;
				defenseShips.push(obj);
			}

		}
		else if (obj.vesselclass=='Fighter' ||obj.vesselclass=='Corvette' ){
			var found=false;
			for (x=0;x<minorShips.length ;x++ ){
				if (minorShips[x].id==obj.id){
					minorShips[x].counter++;
					found=true;
				}
			}
			if (found==false){
				obj.counter=1;
				minorShips.push(obj);
			}
		}
		else {
			var found=false;
			for (x=0;x<capitalShips.length ;x++ ){
				if (capitalShips[x].id==obj.id){
					capitalShips[x].counter++;
					found=true;
				}
			}
			if (found==false){
				obj.counter=1;
				capitalShips.push(obj);
			}
		}
	}


	// We're ready to draw!
	removeChildNodes('ship_overview_capital_ships_container');
	removeChildNodes('ship_overview_defense_container');
	removeChildNodes('ship_overview_utility1_container');
	removeChildNodes('ship_overview_utility2_container');
	removeChildNodes('ship_overview_minor_ships_container');

	minorShips.sort(function(a, b){ return a.id-b.id });
	capitalShips.sort(function(a, b){ return a.time_cost-b.time_cost });



	var parent=document.getElementById('ship_overview_capital_ships_container');
	for (i=0;i<capitalShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+capitalShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', capitalShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+capitalShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+capitalShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}
	/*
	var parent=document.getElementById('ship_overview_defense_container');
	for (i=0;i<defenseShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+defenseShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', defenseShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+defenseShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+defenseShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}
	*/

	var parent=document.getElementById('ship_overview_utility1_container');
	for (i=0;i<utility1Ships.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
				outer.setAttribute("onclick","showGameInfoBox("+utility1Ships[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', utility1Ships[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+utility1Ships[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+utility1Ships[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	var parent=document.getElementById('ship_overview_utility2_container');
	for (i=0;i<utility2Ships.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+utility2Ships[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', utility2Ships[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+utility2Ships[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+utility2Ships[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}

	//var parent=document.getElementById('ship_overview_minor_ships_container');
	var parent=document.getElementById('ship_overview_defense_container');
	ship_overview_defense_container
	for (i=0;i<minorShips.length ;i++ ){
		var outer=createSingleElement('div', 'shiptype_select overview', '', '', '');
		outer.setAttribute("onclick","showGameInfoBox("+minorShips[i].id+",event)");
		var inner1=createSingleElement('div', 'shiptype_name', '', minorShips[i].name, '');
		var innerimg=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+minorShips[i].id+'.png', '');
		var inner2=createSingleElement('div', 'ship_overview_ship_count', '', ''+minorShips[i].counter, '');
		outer.appendChild(inner1);		outer.appendChild(innerimg);		outer.appendChild(inner2);		parent.appendChild(outer);
	}
}

function shipListUpLaunchfleet(fleet){
	$("#ship_overview_h1").html(fleet.fleet_name);
	$("#ship_overview_h2").html("Minor Ships");
	$("#ship_overview_h3").html("Utility Ships");

	$("#ship_overview_sep_1").hide();
	$("#ship_overview_sep_3").hide();

	//$("#ship_overview_panel").css("height", "0px");

	assembleAllShipsQuickMenuLaunchfleet(fleet);
	$('#ship_overview_panel').show();
	var shipsColumn1 = document.getElementById('shipsColumn1').scrollHeight;
	var shipsColumn2 = document.getElementById('shipsColumn2').scrollHeight;
	var shipsColumn3 = document.getElementById('shipsColumn3').scrollHeight;

	var shipListHeights=[shipsColumn1,shipsColumn2,shipsColumn3];
	var fullheight = Math.max.apply( Math, shipListHeights );

	if (fullheight < 100){fullheight = 100};
	//$("#ship_overview_panel").animate({height: fullheight+22+"px"}, { duration: 400  ,  easing : easing });
	$("#ship_overview_panel").animate({height: fullheight+"px"}, { duration: 200  ,  easing : easing });
	ad2460.openQuickMenues.all_ships=true;
	ad2460.launchVars.currentShipView='single';
}

function showStationShipsBreakdown(){
}

function shipListUpStationBreakdown(){
	shipListDown();
	$("#station_ship_breakdown_panel").show();
	var height = document.getElementById('station_ship_breakdown_container').scrollHeight;
	if (height<100){
		height=100;
	}
	if (ad2460.openQuickMenues.station_breakdown==false){
		height+=35;
	}
	if (height>500){
		height=500;
	}

	$("#station_ship_breakdown_panel").animate({height: height+"px"}, { duration: 200  ,  easing : easing });
	ad2460.openQuickMenues.station_breakdown=true;
}

function shipListDownStationBreakdown(){
	$("#station_ship_breakdown_panel").animate({height: "0px"}, { duration: 200  ,  easing : easing, complete: function() {$('#station_ship_breakdown_panel').hide();} });
	ad2460.openQuickMenues.station_breakdown=false;

}

function shipListUpLaunchcontingent(){
	$("#ship_overview_h1").html("All selected fleets");
	$("#ship_overview_h2").html("Minor Ships");
	$("#ship_overview_h3").html("Utility Ships");

	$("#ship_overview_sep_1").hide();
	$("#ship_overview_sep_3").hide();

	//$("#ship_overview_panel").css("height", "0px");

	assembleAllShipsQuickMenuLaunchcontingent();
	$('#ship_overview_panel').show();
	var shipsColumn1 = document.getElementById('shipsColumn1').scrollHeight;
	var shipsColumn2 = document.getElementById('shipsColumn2').scrollHeight;
	var shipsColumn3 = document.getElementById('shipsColumn3').scrollHeight;

	var shipListHeights=[shipsColumn1,shipsColumn2,shipsColumn3];
	var fullheight = Math.max.apply( Math, shipListHeights );

	if (fullheight < 100){fullheight = 100};
	$("#ship_overview_panel").animate({height: fullheight+10+"px"}, { duration: 200  ,  easing : easing });
	ad2460.openQuickMenues.all_ships=true;
	ad2460.launchVars.currentShipView='all';
}

function shipListUpStationcontingent(planet_id){
	$("#ship_overview_h1").html("Capital Units");
	$("#ship_overview_h2").html("Minor Ships");
	$("#ship_overview_h3").html("Utility Ships");

	$("#ship_overview_sep_1").hide();
	$("#ship_overview_sep_3").hide();

	//$("#ship_overview_panel").css("height", "0px");

	assembleAllShipsQuickMenuStationcontingent(planet_id);
	$('#ship_overview_panel').show();
	var shipsColumn1 = document.getElementById('shipsColumn1').scrollHeight;
	var shipsColumn2 = document.getElementById('shipsColumn2').scrollHeight;
	var shipsColumn3 = document.getElementById('shipsColumn3').scrollHeight;

	var shipListHeights=[shipsColumn1,shipsColumn2,shipsColumn3];
	var fullheight = Math.max.apply( Math, shipListHeights );

	if (fullheight < 100){fullheight = 100};
	$("#ship_overview_panel").animate({height: fullheight+10+"px"}, { duration: 200  ,  easing : easing });
	ad2460.openQuickMenues.all_ships=true;
	ad2460.launchVars.currentShipView='station';

	activateBreakdownButton(planet_id);
}

function activateBreakdownButton(planet_id){
	return;
	// no longer needed functionality
	// var breakdownButton=document.getElementById('breakdownButton')
	// breakdownButton.setAttribute("onclick",'prepareShipBreakdown('+planet_id+')');
	// $("#breakdownButton").show();
}

function prepareShipBreakdown(planet_id){
	// ad2460.allianceData.stationFleets
	// We need to use returnAllianceMember(owner_id) for each fleet
	var parent=document.getElementById('station_ship_breakdown_container');
	// first we clear the content
	$("#station_ship_breakdown_container").empty();
	ad2460.allianceData.stationFleets.sort(function(a,b){return a.owner_id-b.owner_id;});
	var i=0;
	for (i=0;i<ad2460.allianceData.stationFleets.length ;i++ ){
		var f=ad2460.allianceData.stationFleets[i];
		f.ships.sort(function(a,b){return b.ship_type_id-a.ship_type_id;});
		var name='Station-fleet';
		var m=returnAllianceMember(f.owner_id);
		if (m!=false){
			name=m.name;
		}
		var strength=f.strength;

		var entry=createSingleElement('div', 'station_ship_breakdown_entry', '', '', '');
		var nameCell=createSingleElement('div', 'station_ship_breakdown_name', '', name, '');
		var strengthCell=createSingleElement('div', 'station_ship_breakdown_strength', '', prettyPrint(strength), '');
		// and now all the icons, whee!
		var renderObjects=returnShipRenderObjects(f);
		// XXYY
		entry.appendChild(nameCell);
		entry.appendChild(strengthCell);

		var iconsCell=createSingleElement('div', 'station_ship_breakdown_icon_container many_ships', '', '', '');

		var s=0;
		for (s=0;s<renderObjects.length ;s++ ){
			// <div class='battle_capital_ship_entry defense_entries'><div class='ship_battle_icon ship_502'></div><div class='capital_ship_count'>1</div></div>
			var icon_container=createSingleElement('div', 'battle_capital_ship_entry defense_entries  many_ships', '', '', '');
			var icon=createSingleElement('div', 'ship_battle_icon ship_'+renderObjects[s].ship_type_id+'  many_ships', '', '', '');
			var number=createSingleElement('div', 'capital_ship_count  many_ships', '', ''+renderObjects[s].shipcount, '');

			icon_container.appendChild(icon);
			icon_container.appendChild(number);
			iconsCell.appendChild(icon_container);
		}
		entry.appendChild(iconsCell);
		parent.appendChild(entry);

	}
	shipListUpStationBreakdown();
}

function shipListUp(paramObject){
	$("#ship_overview_h1").html("Ship Overview");
	$("#ship_overview_h2").html("Defences");
	$("#ship_overview_h3").html("Utility Ships");

	$("#ship_overview_sep_1").show();
	$("#ship_overview_sep_3").show();

	assembleAllShipsQuickMenu(paramObject);
	$('#ship_overview_panel').show();
	var shipsColumn1 = document.getElementById('shipsColumn1').scrollHeight;
	var shipsColumn2 = document.getElementById('shipsColumn2').scrollHeight;
	var shipsColumn3 = document.getElementById('shipsColumn3').scrollHeight;

	var shipListHeights=[shipsColumn1,shipsColumn2,shipsColumn3];
	var fullheight = Math.max.apply( Math, shipListHeights );

	if (fullheight < 100){fullheight = 100};
	$("#ship_overview_panel").animate({height: fullheight+22+"px"}, { duration: 400  ,  easing : easing });
	ad2460.openQuickMenues.all_ships=true;
}
function shipListDown(){
	$("#ship_overview_panel").animate({height: "0px"}, { duration: 200  ,  easing : easing, complete: function() {$('#ship_overview_panel').hide();} });
	ad2460.openQuickMenues.all_ships=false;
	ad2460.launchVars.currentShipView='none';
	$("#breakdownButton").hide();
}



function fleetAssignPanelUp(){

	if (ad2460.scores.level>=2){
		$("#fm_noob_help_1").hide();
		$("#fm_noob_help_2").hide();
		$("#fm_noob_help_3").hide();
		//$("#set_reassign").css("marginBottom","5px;");
	}
	else {
		$("#fm_noob_help_1").html(ad2460.fmCol1Text).show();
		$("#fm_noob_help_2").html(ad2460.fmCol2Text).show();
		$("#fm_noob_help_3").html(ad2460.fmCol3Text).show();
		//$("#set_reassign").css("margin-bottom","35px");

	}

	//	if (ad2460.openQuickMenues.selected_fleet_reassign){		fleetAssignPanelDown();	}
	if (ad2460.openQuickMenues.selected_fleet_resupply){		fleetResupplyPanelDown();	}
	if (ad2460.openQuickMenues.selected_fleet_configuration){	fleetConfigPanelDown();	}
	if (ad2460.openQuickMenues.selected_fleet_tactics){		fleetTacticsPanelDown();	}
	$("#shipreassignpanel").show();
	var test1=$("#reasignment_ship_select_container").height();
	if (test1>300){
		$("#reasignment_ship_select_container").css({height:"300px"});
		$("#reasignment_ship_select_container").css({height:"auto"});
	}

	var assignColumn1 = $("#assignColumn1").height();
	var assignColumn2 = $("#assignColumn2").height();
	var assignColumn3 = $("#assignColumn3").height();
	var assignHeights= [assignColumn1,assignColumn2,assignColumn3];
	var fullheight = Math.max.apply( Math, assignHeights );
	$("#shipreassignpanel").animate({height: fullheight+12+"px"}, { duration: 400  ,  easing : easing });
	ad2460.openQuickMenues.selected_fleet_reassign=true;
	$("#reassign_selected_shiptype_name").html('No ship selected');
	ad2460.fleetvars.selectedFleetReassignShipType=0;
	ad2460.fleetvars.takeOnlySurplus=false;


}

function fleetAssignPanelDown(){
	$("#shipreassignpanel").animate({height: "0px"}, { duration: 200  ,  easing : easing, complete:function(){$("#shipreassignpanel").hide();} });
	ad2460.openQuickMenues.selected_fleet_reassign=false;
	ad2460.fleetvars.selectedFleetReassignShipType=0;
	ad2460.fleetvars.takeOnlySurplus=false;
	ad2460.fleetvars.selectedFleetReassignArray=new Array;
	ad2460.fleetvars.reassignmentOrders=new Array;
	renderReassignmentOrders();

}

function fleetResupplyPanelUp(){
	if (ad2460.openQuickMenues.selected_fleet_reassign){		fleetAssignPanelDown();	}
	//if (ad2460.openQuickMenues.selected_fleet_resupply){		fleetResupplyPanelDown();	}
	// if (ad2460.openQuickMenues.selected_fleet_configuration){	fleetConfigPanelDown();	}
	if (ad2460.openQuickMenues.selected_fleet_tactics){		fleetTacticsPanelDown();	}
	$("#resupplypanel").show();
	var resupplyColumn1 = $("#resupplyColumn1").height();
	var resupplyColumn2 = $("#resupplyColumn2").height();
	var resupplyColumn3 = $("#resupplyColumn3").height();
	var resupplyHeights= [resupplyColumn1,resupplyColumn2,resupplyColumn3];
	var fullheight = Math.max.apply( Math, resupplyHeights );
	$("#resupplypanel").animate({height: fullheight+12+"px"}, { duration: 400  ,  easing : easing });

	ad2460.openQuickMenues.selected_fleet_resupply=true;

}
function fleetResupplyPanelDown(){
	$("#resupplypanel").animate({height: "0px"}, { duration: 200  ,  easing : easing, complete:function(){$("#resupplypanel").hide();} });
	ad2460.openQuickMenues.selected_fleet_resupply=false;

}

function fleetTacticsPanelUp(){
	if (ad2460.openQuickMenues.selected_fleet_reassign)		{	fleetAssignPanelDown();	}
	if (ad2460.openQuickMenues.selected_fleet_resupply)		{	fleetResupplyPanelDown();	}
	if (ad2460.openQuickMenues.selected_fleet_configuration){	fleetConfigPanelDown();	}
	if (ad2460.openQuickMenues.selected_fleet_tactics)		{	fleetTacticsPanelDown();	}
	$("#tacticspanel").show();
	$("#tacticspanel").animate({height: "245px"}, { duration: 300  ,  easing : easing });
	ad2460.openQuickMenues.selected_fleet_tactics=true;

}
function fleetTacticsPanelDown(){
	$("#tacticspanel").animate({height: "0px"}, { duration: 300  ,  easing : easing, complete:function(){$("#tacticspanel").hide();} });
	ad2460.openQuickMenues.selected_fleet_tactics=false;

}

function viewAllShipsClick(paramObject){
	if (ad2460.openQuickMenues.all_ships==false){
		shipListUp(paramObject);
	}
	else {
		shipListDown();
	}
}

function selected_fleet_shipreassign_button_click(){
	if (ad2460.openQuickMenues.selected_fleet_reassign==false){
		if (ad2460.fleetvars.selected_fleet_id>0){
			var thisFleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
			if (thisFleet.alliance_fleet==1){
				return;
			}
			if (thisFleet.homeworld_fleet==1 && thisFleet.current_x!=ad2460.homeworld.x && thisFleet.current_y!=ad2460.homeworld.y){
				return;
			}

			if (thisFleet.owner_id!=ad2460.user_id && thisFleet.bank_fleet==0){
				return;
			}
			if (thisFleet.bank_fleet==1){
				var access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_military;
				if (access<1){
					return;
				}
			}


			if (thisFleet!=false){
				// Render the shiptypes
					removeChildNodes('reasignment_ship_type_select_container');
					removeChildNodes('reasignment_ship_select_container');

					// make a rendering-array with capital ships
					var renderArray=new Array;
					var thisCount=0;
					for (i=0;i<thisFleet.ships.length ;i++ ){
						var thisShipTypeId=thisFleet.ships[i].ship_type_id;
						if (thisShipTypeId>=401 && thisShipTypeId<=410){
							continue; // Skip the minor ships for now!
						}
						var found=false;
						for (var x=0;x<renderArray.length ;x++ ){
							if (thisShipTypeId==renderArray[x].ship_type_id){
								found=true;
							}
						}
						if (found==false){
							var s=returnGameObjectById(thisFleet.ships[i].ship_type_id);
							var sort_value=s.id;

							thisCount=0;
							for (var y=0;y<thisFleet.ships.length ;y++ ){
								if (thisFleet.ships[i].ship_type_id == thisFleet.ships[y].ship_type_id){
									thisCount++;
								}
							}

							if (s.vesseltype=='Utility')	{
								sort_value=499;
								if (s.id==435){
									sort_value=497;
								}
								if (s.id==436){
									sort_value=498;
								}
							}
							else if (s.vesseltype=='Normal')	{
								if (s.vesselclass=='Frigate')	{
									if (s.tech=='None' || s.tech=='' ){
										sort_value=415;
									}
									if (s.tech=='Matter'){
										sort_value=420;
									}
									if (s.tech=='Energy'){
										sort_value=425;
									}
									if (s.tech=='Displacement'){
										sort_value=430;
									}
								}
								if (s.vesselclass=='Cruiser')	{
									if (s.tech=='Matter'){
										sort_value=440;
									}
									if (s.tech=='Energy'){
										sort_value=445;
									}
									if (s.tech=='Displacement'){
										sort_value=450;
									}
								}
								if (s.vesselclass=='Battleship')	{
									if (s.tech=='Matter'){
										sort_value=460;
									}
									if (s.tech=='Energy'){
										sort_value=465;
									}
									if (s.tech=='Displacement'){
										sort_value=470;
									}
								}
								if (s.vesselclass=='Carrier')	{
									if (s.tech=='Matter'){
										sort_value=480;
									}
									if (s.tech=='Energy'){
										sort_value=482;
									}
									if (s.tech=='Displacement'){
										sort_value=484;
									}
								}
							}

							renderArray.push({ship_type_id:s.id, vesselclass:s.vesselclass,  vesseltype:s.vesseltype,  tech:s.tech, sort_value:sort_value, count:thisCount });
						}
					}

					renderArray.sort(function(a,b){return a.sort_value-b.sort_value});

					var container=document.getElementById('reasignment_ship_type_select_container');

					for (var r=0;r<renderArray.length ;r++ ){
						var outerDiv=createSingleElement('div', 'shiptype_select', 'shipTypeSelect'+renderArray[r].ship_type_id, '', 'reassignShiptypeClick('+renderArray[r].ship_type_id+')');
						var nameDiv=createSingleElement('div', 'shiptype_name', 'reassignShipTypeSelectGlow'+renderArray[r].ship_type_id, renderArray[r].count+' X '+shortenUnitTechName(returnUnitName(renderArray[r].ship_type_id)), '');
						var imgDiv=createSingleElement('div', 'shiptype_img', '', '', '');
						var img=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+renderArray[r].ship_type_id+'.png', '');

						outerDiv.appendChild(nameDiv);
						outerDiv.appendChild(imgDiv);
						imgDiv.appendChild(img);
						container.appendChild(outerDiv);

					}

					var i=0;
					var renderedShiptypes=new Array;
					var sepDiv=createSingleElement('div', 'separator_line', '', '', '');
					container.appendChild(sepDiv);

					for (i=0;i<thisFleet.ships.length ;i++ ){
						// Avoid rendering turrets etc
						var thisShipTypeId=thisFleet.ships[i].ship_type_id;
						if (thisShipTypeId>410){
							continue; // We only draw the minors here....
						}
						var alreadyRendered=false;
						for (a=0;a<renderedShiptypes.length ;a++ ){
							if (renderedShiptypes[a]==thisShipTypeId){
								alreadyRendered=true;
							}
						}
						if (alreadyRendered==false){
							var thisCount=0;
							for (var y=0;y<thisFleet.ships.length ;y++ ){
								if (thisFleet.ships[i].ship_type_id == thisFleet.ships[y].ship_type_id){
									thisCount++;
								}
							}

							renderedShiptypes.push(thisFleet.ships[i].ship_type_id);
							var outerDiv=createSingleElement('div', 'shiptype_select', 'shipTypeSelect'+thisShipTypeId, '', 'reassignShiptypeClick('+thisShipTypeId+')');
							var nameDiv=createSingleElement('div', 'shiptype_name', 'reassignShipTypeSelectGlow'+thisShipTypeId, thisCount+' X '+shortenUnitTechName(returnUnitName(thisFleet.ships[i].ship_type_id)), '');
							var imgDiv=createSingleElement('div', 'shiptype_img', '', '', '');
							var img=createSingleElement('img', 'shiptype_img', '', 'images/icons/miniships/100x100/'+thisFleet.ships[i].ship_type_id+'.png', '');

							outerDiv.appendChild(nameDiv);
							outerDiv.appendChild(imgDiv);
							imgDiv.appendChild(img);
							container.appendChild(outerDiv);

						}

					}

				// At this point, we must populate the reassign_to_location and reassign_to_fleet dropdowns....
				// Parse the fleets and skip the storage-fleets and any fleet on a mission I guess...
				// Extract unique destinations
				// Then when a destination is selected, populate the reassign_to_fleet with the fleets present at that location....

				populateReassignmentLocationDropdown();


				fleetAssignPanelUp();
				if (thisFleet.last_hyperspace_jump_time>ad2460.serverTime-600){
					systemFeedback('Warning','No ships can be moved to or from this fleet while recharging engines.', 0, 4);
				}
			}

		}
		else {
			systemFeedback('Error','No fleet selected', 1, 3);
		}
	}
	else {
		fleetAssignPanelDown();
	}
}

function reassignFleetChange(){
	// helper-function to fill in the new recommended string
	$("#fm_op_recommended_strength").html("-");
	$("#fm_op_recommended_strength_container").hide();
	$("#fm_op_recommended_strength_container").removeClass("notenough");

	// Now we need to know something about the fleet selected here
	var fid=$("#reassign_to_fleet").val();
	var thisFleet=returnFleetById(fid);
	if (thisFleet){
		if (thisFleet.auto_def==1){
			var o=0;
			for (o=0;o<ad2460.outposts.length ;o++ ){
				if (ad2460.outposts[o].x==thisFleet.current_x && ad2460.outposts[o].y==thisFleet.current_y){
					var present=thisFleet.strength;
					var recommended=ad2460.outposts[o].returnRecommendedDefenseStrength();

					$("#fm_op_recommended_strength").html(prettyPrint(recommended));
					$("#fm_op_recommended_strength_container").show();

					if (recommended>present){
						$("#fm_op_recommended_strength_container").addClass("notenough");
					}

				}
			}

		}
	}
}

function populateReassignmentLocationDropdown(){
	var dropdown=document.getElementById('reassign_to_location');
	dropdown.options.length = 0;

	// An extra cleaning of the fleet-selector should be done here too!
	var dropdown2=document.getElementById('reassign_to_fleet');
	dropdown2.options.length = 0;
	// Done

	dropdown.options[dropdown.options.length] = new Option('Select location', -1);

	var locations=new Array;
	// Each location has a location-name (from the fleets location-string) , and x and a y (current_x, current_y)

	// Hm, myFleets have no planet-id...hmm
	// Uhm, but they have a location-string ffs!! Haha!

	// This has to change
	// Check the selected fleet's location.

	// If it is at home, it can indeed send ships to all locations.
	// If it is not, it can only send ships to other fleets at the same location.

	var selectedFleetIsHome=false;
	var selectedFleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	if (selectedFleet.current_x==ad2460.homeworld.x && selectedFleet.current_y==ad2460.homeworld.y ){
		selectedFleetIsHome=true;
	}
	var c=0;

	var addedHomeLocation=false;

	for (c=0;c<ad2460.myFleets.length ;c++ ){
		// IF the fleet is not storage and not the base-fleet and it is at home doing nothing
		var thisFleet=ad2460.myFleets[c];
		if (thisFleet.current_mission_type==0 && thisFleet.storage_fleet==0 && thisFleet.fleet_id!=ad2460.fleetvars.selected_fleet_id && thisFleet.status==0 && thisFleet.auto_def==0)	{
			// Now the new check
			if ( ( selectedFleetIsHome==true ) || (selectedFleet.current_x==thisFleet.current_x && selectedFleet.current_y==thisFleet.current_y  ) ){
				if ( selectedFleet.last_hyperspace_jump_time<(ad2460.serverTime-600)){
					// We either have selected a home-based fleet or the fleets are at the same coords..
					// Seems valid enough...
					if (selectedFleet.auto_def!=1){
						var a=0;
						var foundLocation=false;
						for (a=0;a<locations.length ;a++ ){
							if (locations[a].x==thisFleet.current_x && locations[a].y==thisFleet.current_y ){
								foundLocation=true;
							}
						}
						if (foundLocation==false){
							if (thisFleet.current_x==ad2460.homeworld.x && thisFleet.current_y==ad2460.homeworld.y){
								locations.unshift({name:thisFleet.location_string,x:thisFleet.current_x, y:thisFleet.current_y});
								addedHomeLocation=true;
							}
							else {
								locations.push({name:thisFleet.location_string,x:thisFleet.current_x, y:thisFleet.current_y});
							}

						}
					}
				}
			}
			//console.log('added fleet to dropdown');
		}
	}
	var i=0;
	for (i=0;i<locations.length ;i++ ){
		dropdown.options[dropdown.options.length] = new Option(locations[i].name, locations[i].x+'_'+locations[i].y);
	}

	if (ad2460.allianceData.id>0){
		if (selectedFleet.homeworld_fleet==1){
			dropdown.options[dropdown.options.length] = new Option('Bank defense fleet', ad2460.allianceData.bank.x+'_'+ad2460.allianceData.bank.y);
			if (ad2460.allianceData.stations.length>0){
				dropdown.options[dropdown.options.length] = new Option('Station defense', 'STATION');
			}
		}
	}

	if (ad2460.outposts.length>0){
		if (selectedFleet.homeworld_fleet==1 && ad2460.scores.level>2){
			dropdown.options[dropdown.options.length] = new Option('Outpost Defense', 'OUTPOST');
		}
		else if (selectedFleet.auto_def==1 && ad2460.scores.level>2){
			dropdown.options[dropdown.options.length] = new Option('Outpost Defense', 'OUTPOST');
		}

	}

	if (selectedFleet.homeworld_fleet==1 || selectedFleet.auto_def==1){
		dropdown.options[dropdown.options.length] = new Option('Scrapyard', 0);
	}
	if (selectedFleet.bank_fleet==1){
		var access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_military;
		if (access>0){
			dropdown.options[dropdown.options.length] = new Option('Scrapyard', 0);
		}
	}

	/*
	if (dropdown.options.length==2){
		dropdown.selectedIndex=dropdown.options.length-1;
		dropdown.onchange();
	}
	*/

	if (addedHomeLocation==true){
		dropdown.selectedIndex=1;
		dropdown.onchange();
	}
	else {
		dropdown.selectedIndex=0;
		dropdown.onchange();
	}

	if (selectedFleet.auto_def==1){
		dropdown.selectedIndex=1;
		dropdown.onchange();
	}



}

function populateReassignToFleet(){
	var coordString=document.getElementById('reassign_to_location').options[document.getElementById('reassign_to_location').selectedIndex].value;
	var dropdown=document.getElementById('reassign_to_fleet');
	dropdown.options.length = 0;

	var selectedFleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	if (selectedFleet==false){
		return;
	}
	if (selectedFleet.alliance_fleet!=1){
		if (coordString != '0' && coordString != '-1' && coordString != 'OUTPOST' && coordString != 'STATION'){
			var coords=coordString.split("_");
			var x=coords[0];
			var y=coords[1];
			//console.log('Looking for fleets at '+x+' '+y);
			// Now find the fleets at that x and y
			var c=0;
			for (c=0;c<ad2460.myFleets.length ;c++ ){
				// IF the fleet is not storage and not the base-fleet and it is at home doing nothing
				var thisFleet=ad2460.myFleets[c];
				var hangar=calcHangarData(thisFleet);
				var current_strength=thisFleet.strength;
				var max_strength=0;
				var commander=returnCommanderById(thisFleet.commander_id);
				if (commander!=false){
					max_strength=returnStrengthLimit(commander.rank);
				}
				if (thisFleet.current_mission_type==0 && thisFleet.storage_fleet==0 && thisFleet.fleet_id!=ad2460.fleetvars.selected_fleet_id && thisFleet.status==0 && thisFleet.current_x==x && thisFleet.current_y==y && thisFleet.alliance_fleet!=1 && thisFleet.last_hyperspace_jump_time<ad2460.serverTime-600 )	{
					// Got one!
					//console.log('fleet found, inserting!');
					dropdown.options[dropdown.options.length] = new Option(thisFleet.fleet_name+'  (STR: '+current_strength+'/'+max_strength+') (MIN '+hangar.spent+'/'+hangar.total+')', thisFleet.fleet_id);
				}
				else {
					//console.log('Invalid data for fleet');
					//console.log(thisFleet);
				}
			}
			if (selectedFleet.homeworld_fleet==1){
				// I guess we can add the bank-fleet here
				if (ad2460.allianceData.id>0){
					if (x==ad2460.allianceData.bank.x && y==ad2460.allianceData.bank.y){
						thisFleet=ad2460.allianceData.bank.fleet;
						var current_strength=thisFleet.strength;
						var max_strength=1000000;
						var hangar=calcHangarData(thisFleet);
						hangar.total=1500;
						dropdown.options[dropdown.options.length] = new Option(thisFleet.fleet_name+'  (STR: '+current_strength+'/'+max_strength+') (MIN '+hangar.spent+'/'+hangar.total+')', thisFleet.fleet_id);
					}
				}
			}
		}
		else {
			if (coordString=='0'){
				// Scrapyard selected
				dropdown.options[dropdown.options.length] = new Option('Scrapyard', 0);
			}
			else if (coordString=='OUTPOST'){
				// Now we can have fun listing all the new outpost defense fleets, in the order of the potential I suppose

				// In order to sort this properly, store the data in a temporary array!
				var fleetDropdownTemp=new Array;


				for (var c=0;c<ad2460.myFleets.length ;c++ ){
					if (ad2460.myFleets[c].auto_def==1 && ad2460.myFleets[c].fleet_id!=ad2460.fleetvars.selected_fleet_id){
						var thisFleet=ad2460.myFleets[c];
						var hangar=calcHangarData(thisFleet);
						var current_strength=thisFleet.strength;
						var max_strength=0;

						for (var op=0;op<ad2460.outposts.length ;op++ ){
							if (ad2460.outposts[op].x==thisFleet.current_x && ad2460.outposts[op].y==thisFleet.current_y){
								var pot=ad2460.outposts[op].returnPotential();
								var thisCmdRank=outpostPotentialToCommanderRank(pot);
								max_strength=ad2460.outposts[op].returnMaxFleetStrength();
							}
						}

						if (thisFleet.fleet_id!=ad2460.fleetvars.selected_fleet_id && thisFleet.status==0 && thisFleet.alliance_fleet!=1){
							// Got one!
							fleetDropdownTemp.push({fleet_name:thisFleet.fleet_name, current_strength:current_strength, max_strength:max_strength, hangar_spent:hangar.spent, hangar_total:hangar.total, fleet_id:thisFleet.fleet_id});
							//dropdown.options[dropdown.options.length] = new Option(thisFleet.fleet_name+'  (STR: '+current_strength+'/'+max_strength+') (MIN '+hangar.spent+'/'+hangar.total+')', thisFleet.fleet_id);
						}
					}
				}

				// Now go through the temp-array, sort by max strength, and chuck the entries into the dropdown
				fleetDropdownTemp.sort(function(a, b){ return b.max_strength-a.max_strength });
				for (var t=0;t<fleetDropdownTemp.length ;t++ ){
					dropdown.options[dropdown.options.length] = new Option(fleetDropdownTemp[t].fleet_name+'  (STR: '+fleetDropdownTemp[t].current_strength+'/'+fleetDropdownTemp[t].max_strength+') (MIN '+fleetDropdownTemp[t].hangar_spent+'/'+fleetDropdownTemp[t].hangar_total+')', fleetDropdownTemp[t].fleet_id);
				}

			}
			else if (coordString=='STATION'){
				// Now we can have fun listing all the station defense fleets

				// In order to sort this properly, store the data in a temporary array!
				var fleetDropdownTemp=new Array;
				for (var s=0; s<ad2460.allianceData.stations.length ;s++ ){
					for (var f=0; f<ad2460.allianceData.stations[s].fleets.length ;f++ ){
						var thisFleet=ad2460.allianceData.stations[s].fleets[f];
						var hangar=calcHangarData(thisFleet);
						var current_strength=thisFleet.strength;
						var max_strength=1000000;

						fleetDropdownTemp.push({fleet_name:thisFleet.fleet_name, current_strength:current_strength, max_strength:max_strength, hangar_spent:hangar.spent, hangar_total:hangar.total, fleet_id:thisFleet.fleet_id});

					}
				}

				// Now go through the temp-array, sort by max strength, and chuck the entries into the dropdown
				fleetDropdownTemp.sort(function(a, b){ return b.max_strength-a.max_strength });
				for (var t=0;t<fleetDropdownTemp.length ;t++ ){
					dropdown.options[dropdown.options.length] = new Option(fleetDropdownTemp[t].fleet_name+'  (STR: '+fleetDropdownTemp[t].current_strength+'/'+fleetDropdownTemp[t].max_strength+') (MIN '+fleetDropdownTemp[t].hangar_spent+'/'+fleetDropdownTemp[t].hangar_total+')', fleetDropdownTemp[t].fleet_id);
				}

			}
		}
	}
	else {

	}

	reassignFleetChange();
}

function resetTakeOnlySurplusButton(){
	ad2460.fleetvars.takeOnlySurplus=false;
	$("#reassign_option_4 .fixed_button_click").hide();

}

function reassignShiptypeClick(ship_type_id){
	$("#reasignment_ship_type_select_container .shiptype_name").removeClass('assignSelectedGlow');
	$("#reassignShipTypeSelectGlow"+ship_type_id).addClass('assignSelectedGlow');
	removeChildNodes('reasignment_ship_select_container');

	var container=document.getElementById('reasignment_ship_select_container');
	resetTakeOnlySurplusButton();
	$("#reassign_selected_shiptype_name").html(returnUnitName(ship_type_id));

	// Emptying the global array for selected individual ships
	ad2460.fleetvars.selectedFleetReassignArray=new Array;

	//if (ship_type_id==432){
	//	var groundedDiv=createSingleElement('div', 'notenough', '', 'Your salvage-ships are bound to the base-fleet and can not be moved elsewhere.', '');
	//	groundedDiv.style.fontSize='13px';
	//	container.appendChild(groundedDiv);
	//	return;
	//}


	var thisFleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	if (thisFleet!=false){
		// Render the boxes for each ship of the selected type
		var i=0;
		for (i=0;i<thisFleet.ships.length ;i++ ){
			var thisShip=thisFleet.ships[i];
			if (thisShip.ship_type_id==ship_type_id){
				//console.log(thisShip);
				// Hm, cool, we have the right ship
				ad2460.fleetvars.selectedFleetReassignShipType=ship_type_id;
				// Now draw it

				// actually, check if it has already been added to a reassignment-order...
				var alreadyMoved=false;
				var x=0;
				for (x=0;x<ad2460.fleetvars.reassignmentOrders.length ;x++ ){
					var a=0;
					for (a=0;a<ad2460.fleetvars.reassignmentOrders[x].shipIds.length ;a++ ){
						if (ad2460.fleetvars.reassignmentOrders[x].shipIds[a]==thisShip.unique_id){
							alreadyMoved=true;
						}
					}
				}

				if (alreadyMoved==false){
					var outerDiv=createSingleElement('div', 'shipreassignselect', 'reassignSingleShip'+thisShip.unique_id, '', 'reassignSingleShipClick('+thisShip.unique_id+')');
					var conditionDiv=createSingleElement('div', 'condition', '', '', '');
					var hangar_string='N/A';
					if (thisShip.max_hangar_capacity>0)	{
						hangar_string=thisShip.spent_hangar_capacity+'/'+thisShip.max_hangar_capacity;
					}
					hangar_string=prettyPrint(shipToStrength(thisShip.ship_type_id));
					var supplyDiv=createSingleElement('div', 'supply', '', hangar_string, '');

					var conditionPercent=Math.floor(thisShip.hullstrength*100/thisShip.max_hullstrength);
					// correcting a little rendering flaw
					//if (conditionPercent>85){
					//	conditionPercent=85;
					//}
					if (conditionPercent>99){
						conditionDiv.style.backgroundColor='#9F0';
					}
					else if (conditionPercent>90){
						conditionDiv.style.backgroundColor='cyan';
					}
					else if (conditionPercent>80){
						conditionDiv.style.backgroundColor='yellow';
					}
					else if (conditionPercent>70){
						conditionDiv.style.backgroundColor='orange';
					}
					else {
						conditionDiv.style.backgroundColor='red';
					}

					conditionPercent=Math.floor(conditionPercent*0.85);

					conditionDiv.style.width=conditionPercent+'%';
					outerDiv.style.marginRight='3px';

					outerDiv.appendChild(conditionDiv);
					outerDiv.appendChild(supplyDiv);
					container.appendChild(outerDiv);

				}


			}
		}
	}
	var test1=$("#reasignment_ship_select_container").height();
	if (test1>300){
		$("#reasignment_ship_select_container").css({height:"300px"});
		$("#reasignment_ship_select_container").css({height:"auto"});
	}

	var assignColumn1 = $("#assignColumn1").height();
	var assignColumn2 = $("#assignColumn2").height();
	var assignColumn3 = $("#assignColumn3").height();
	var assignHeights= [assignColumn1,assignColumn2,assignColumn3];
	var fullheight = Math.max.apply( Math, assignHeights );
	fullheight+=12;

	if (fullheight>497){
		fullheight=497;
	}

	if ($("#shipreassignpanel").height()<fullheight){
		$("#shipreassignpanel").animate({height: fullheight+"px"}, { duration: 200  ,  easing : easing });
	}

	reassignSelectPercentDynamic();
}

function toggleTakeOnlySurplusButton(){
	ad2460.fleetvars.takeOnlySurplus=!ad2460.fleetvars.takeOnlySurplus;
	if (ad2460.fleetvars.takeOnlySurplus==true){
		$("#reassign_option_4 .fixed_button_hover").show();
	}
	else {
		$("#reassign_option_4 .fixed_button_hover").hide();
	}
}

function returnOutpostMaxStrength(x,y){
	var value=0;
	for (var i=0;i<ad2460.outposts.length ;i++ ){
		if (ad2460.outposts[i].x==x && ad2460.outposts[i].y==y ){
			value=ad2460.outposts[i].returnMaxFleetStrength();
			return value;
		}
	}

}

function setReassignmentClick(){
	if (ad2460.fleetvars.selectedFleetReassignShipType==0){
		systemFeedback('Error','No ship-type selected.', 1, 6);
		$(".shiptype_select").addClass('notenough');
		window.setTimeout('$(".shiptype_select").removeClass("notenough")', 250);
		return;
	}

	var fromFleetId=ad2460.fleetvars.selected_fleet_id;
	var fromFleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	var fromFleetName=fromFleet.fleet_name;

	var toFleetId=document.getElementById('reassign_to_fleet').options[document.getElementById('reassign_to_fleet').selectedIndex].value;
	var toFleet=returnFleetById(toFleetId);
	var toFleetName=toFleet.fleet_name;

	if (ad2460.fleetvars.selectedFleetReassignShipType>499 && toFleetId!=0 && toFleet.auto_def==0){
		systemFeedback('Error','Defensive units may only be moved to Outpost-defense fleets or the Scrapyard.', 1, 6);
		return;
	}

	if (toFleetId==0){
		showOkPopup("WARNING: You are now sending ships to the scrapyard where they will be destroyed. This action is irreversible.", "I know", "")
		toFleetName='Scrapyard';
	}

	var actualToFleetAvailableHangarSpace=toFleet.shortage;
	for (x=0;x<ad2460.fleetvars.reassignmentOrders.length ;x++ ){
		if (ad2460.fleetvars.reassignmentOrders[x].toFleetId==toFleetId){
			if (toFleet.bank_fleet==0){
				//actualToFleetAvailableHangarSpace+=(returnHangarCapacity(ad2460.fleetvars.reassignmentOrders[x].ship_type_id)*ad2460.fleetvars.reassignmentOrders[x].ship_count);
				actualToFleetAvailableHangarSpace+=(returnActualHangarSpace(ad2460.fleetvars.reassignmentOrders[x].ship_type_id)*ad2460.fleetvars.reassignmentOrders[x].ship_count);
			}

		}
	}

	var minorShipsBeingMovedToThisFleet=0;
	for (x=0;x<ad2460.fleetvars.reassignmentOrders.length ;x++ ){
		if (ad2460.fleetvars.reassignmentOrders[x].toFleetId==toFleetId){
			if (ad2460.fleetvars.reassignmentOrders[x].ship_type_id<411){
				minorShipsBeingMovedToThisFleet+=ad2460.fleetvars.reassignmentOrders[x].ship_count;
			}
		}
	}
	if (ad2460.fleetvars.selectedFleetReassignShipType<411){
		minorShipsBeingMovedToThisFleet+=ad2460.fleetvars.selectedFleetReassignArray.length;
	}


	var thisShipCount=ad2460.fleetvars.selectedFleetReassignArray.length;
	if (thisShipCount==0){
		systemFeedback('Error','No ships selected.', 1, 6);
		$(".shipreassignselect").addClass('notenough');
		window.setTimeout('$(".shipreassignselect").removeClass("notenough")', 250);
		return;
	}

	var shipCount=ad2460.fleetvars.selectedFleetReassignArray.length;

	var addingStrength=shipToStrength(ad2460.fleetvars.selectedFleetReassignShipType)*ad2460.fleetvars.selectedFleetReassignArray.length;


	// check other orders for movements to the same fleet.
	var x=0;
	for (x=0;x<ad2460.fleetvars.reassignmentOrders.length ;x++ ){
		if (ad2460.fleetvars.reassignmentOrders[x].toFleetId==toFleetId){
			shipCount+=ad2460.fleetvars.reassignmentOrders[x].ship_count;
			addingStrength+=shipToStrength(ad2460.fleetvars.reassignmentOrders[x].ship_type_id)*ad2460.fleetvars.reassignmentOrders[x].ship_count;
		}
	}
	if (shipCount==0){
		systemFeedback('Error','No ships selected.', 1, 6);
		$(".shipreassignselect").addClass('notenough');
		window.setTimeout('$(".shipreassignselect").removeClass("notenough")', 250);
		return;
	}
	var shipType=returnGameObjectById(ad2460.fleetvars.selectedFleetReassignShipType);

	var maxShipsForCommander=0;
	var maxStrengthForCommander=0;

	if (toFleetId>0){
		maxShipsForCommander=5;

		if (toFleet.commander){
			maxShipsForCommander=5+toFleet.commander.rank*5;
			maxStrengthForCommander=returnStrengthLimit(toFleet.commander.rank);
		}

		if (toFleet.bank_fleet==1){
			maxStrengthForCommander=1000000;
		}
		if (toFleet.auto_def==1){
			maxStrengthForCommander=returnOutpostMaxStrength(toFleet.current_x,toFleet.current_y);
		}

		if (toFleet.strength+addingStrength>maxStrengthForCommander && toFleet.homeworld_fleet==0){
			var overflow_strength=toFleet.strength+addingStrength-maxStrengthForCommander;
			if (toFleet.bank_fleet==1){
				systemFeedback('Error','The bank-fleet can not handle more than '+prettyPrint(maxStrengthForCommander)+' strength. Remove '+overflow_strength+' and try again.', 1, 6);
			}
			else {
				systemFeedback('Error','The commander of that fleet can not handle more than '+prettyPrint(maxStrengthForCommander)+' strength in total. Remove '+overflow_strength+' and try again.', 1, 6);
			}
			return;
		}
		if (shipType.vesseltype=='Normal'){
			if (shipType.vesselclass=='Fighter' ||shipType.vesselclass=='Corvette'  ){
				//console.log(actualToFleetAvailableHangarSpace, minorShipsBeingMovedToThisFleet);
				if (actualToFleetAvailableHangarSpace<minorShipsBeingMovedToThisFleet && toFleet.homeworld_fleet==0)	{
					var remove=minorShipsBeingMovedToThisFleet-actualToFleetAvailableHangarSpace;
					systemFeedback('Error','Insufficient hangar-space. Remove '+remove+' minors and try again.', 1, 3);
					return;
				}
			}
		}
	}

	if (toFleetId==0){
		maxShipsForCommander=999999;
		maxStrengthForCommander=999999;
	}


	if (ad2460.fleetvars.reassignmentOrders.length>=10){
		systemFeedback('Error','You must complete the pending move-orders before you can add more.', 1, 3);
		return;
	}

	ad2460.fleetvars.reassignmentOrders.push(new reassignmentOrder(ad2460.fleetvars.selectedFleetReassignShipType, fromFleetId, fromFleetName, toFleetId, toFleetName, ad2460.fleetvars.takeOnlySurplus, toFleet.type));

	resetTakeOnlySurplusButton();

	renderReassignmentOrders();
	// And get rid of the selected ships

	var i=0;
	for (i=0;i<ad2460.fleetvars.selectedFleetReassignArray.length ;i++ ){
		$("#reassignSingleShip"+ad2460.fleetvars.selectedFleetReassignArray[i]).remove();
	}


	var test1=$("#reasignment_ship_select_container").height();
	if (test1>300){
		$("#reasignment_ship_select_container").css({height:"300px"});
		$("#reasignment_ship_select_container").css({height:"auto"});
	}

	//console.log("height: "+test1);

	var assignColumn1 = $("#assignColumn1").height();
	var assignColumn2 = $("#assignColumn2").height();
	var assignColumn3 = $("#assignColumn3").height();

	var assignHeights= [assignColumn1,assignColumn2,assignColumn3];
	var fullheight = Math.max.apply( Math, assignHeights );

	fullheight+=12;
	if (fullheight>497){
		fullheight=497;
	}

	$("#shipreassignpanel").animate({height: fullheight+"px"}, { duration: 400  ,  easing : easing });

	ad2460.fleetvars.selectedFleetReassignArray=new Array;
	play_multi_sound("sfx_click2");

}

function removeReassignmentOrder(id){
	for (i=0;i<ad2460.fleetvars.reassignmentOrders.length ;i++ ){
		var thisOrder=ad2460.fleetvars.reassignmentOrders[i];
		if (thisOrder.id==id){
			var ship_type_id=ad2460.fleetvars.reassignmentOrders[i].ship_type_id;
			ad2460.fleetvars.reassignmentOrders.splice(i,1);
			i--;
			reassignShiptypeClick(ship_type_id);
		}
	}
	renderReassignmentOrders();
}

function renderReassignmentOrders(){
	removeChildNodes('reassignmentListContainer');
	var container=document.getElementById('reassignmentListContainer');

	var i=0;
	for (i=0;i<ad2460.fleetvars.reassignmentOrders.length ;i++ ){
		var thisOrder=ad2460.fleetvars.reassignmentOrders[i];

		var thisStrength=shipToStrength(thisOrder.ship_type_id)*thisOrder.ship_count;
		var thisStrengthString=''+thisStrength;
		if (thisStrength>1000){
			var tmp=Math.round(thisStrength/1000);
			thisStrengthString=tmp+' K';
		}


		var entry=createSingleElement('div', 'reassignlistentry', '', '', '');
		var type=createSingleElement('div', 'reassigntype', '', thisOrder.ship_count +' X '+ shortenUnitTechName(thisOrder.ship_name),'');
		var strength=createSingleElement('div', 'reassignstrength', '', thisStrengthString, '');
		var arrow=createSingleElement('div', 'reassignarrow', '', '--&gt;', '');
		var dest=createSingleElement('div', 'reassigndest', '', thisOrder.toFleetName, '');
		var cancel=createSingleElement('div', 'reassigncancel', '', 'X', 'removeReassignmentOrder('+thisOrder.id+')');

		entry.appendChild(type);
		entry.appendChild(strength);
		entry.appendChild(arrow);
		entry.appendChild(dest);
		entry.appendChild(cancel);
		container.appendChild(entry);
	}

}

function reassignSingleShipClick(ship_id){
	// Check if the ship-id exists in the global array holding the selected ship-ids
	// If it doesn't exist, add it and mark it visually
	// If it does, remove it, and remove the visible mark
	// ad2460.fleetvars.selectedFleetReassignArray
	var i=0;
	var found=-1;
	for (i=0;i<ad2460.fleetvars.selectedFleetReassignArray.length ;i++ ){
		if (ad2460.fleetvars.selectedFleetReassignArray[i]==ship_id){
			found=i;
			// Now unmark it visually
			$("#reassignSingleShip"+ship_id).removeClass("assignSelectedGlow");
			ad2460.fleetvars.selectedFleetReassignArray.splice(i,1);
			updateReassignNumbers();
			return true;
		}
	}

	if (found==-1){
		// We didn't find it, so we must add it and mark it visually as selected
		ad2460.fleetvars.selectedFleetReassignArray.push(ship_id);
		$("#reassignSingleShip"+ship_id).addClass("assignSelectedGlow");
		updateReassignNumbers();
	}
}

function autoFillFleet(fleet_id){
	$.post('actionhandler.pl', {action:'auto_fill_fleet', fleet_id:fleet_id}, function(data){ parseInfo(data);});
}

function moveMinorsToBaseFleetClick(){
	if (ad2460.fleetvars.selected_fleet_id==0){
		systemFeedback('Error','No fleet selected', 1, 3);
		return;
	}
	var fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);

	if (fleet==false){
		systemFeedback('Error','No fleet selected', 1, 3);
		return;
	}

	if (fleet.current_x!=ad2460.homeworld.x || fleet.current_y!=ad2460.homeworld.y){
		systemFeedback('Error','Only fleets at your homeworld may do this', 1, 3);
		return;
	}

	if (fleet.status!=0){
		systemFeedback('Error','This fleet is too busy now', 1, 3);
		return;
	}

	if (fleet.homeworld_fleet==1){
		systemFeedback('Error','Your Base-fleet may not be emptied like this.', 1, 3);
		return;
	}

	$.post('actionhandler.pl', {action:'empty_minor_ships', fleet_id:ad2460.fleetvars.selected_fleet_id}, function(data){ parseInfo(data);});

}

function selected_fleet_resupply_button_click(){
	// You can only resupply fleets who are at home and have status 0
	if (ad2460.fleetvars.selected_fleet_id==0){
		systemFeedback('Error','No fleet selected', 1, 3);
		return;
	}

	var fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);

	if (fleet==false){
		systemFeedback('Error','No fleet selected', 1, 3);
		return;
	}

	if (fleet.homeworld_fleet==1 && fleet.current_x!=ad2460.homeworld.x && fleet.current_y!=ad2460.homeworld.y){
		return;
	}

	if ( fleet.auto_def==0 &&  (fleet.current_x!=ad2460.homeworld.x || fleet.current_y!=ad2460.homeworld.y)){
		systemFeedback('Error','Only fleets at your homeworld may be re-supplied', 1, 3);
		return;
	}

	if (fleet.status!=0){
		systemFeedback('Error','Only idle fleets may be re-supplied', 1, 3);
		return;
	}

	if (fleet.homeworld_fleet==1){
		systemFeedback('Error','Your Base-fleet may not be re-supplied, it IS your supply-source.', 1, 3);
		return;
	}

	if (fleet.alliance_fleet>0){
		systemFeedback('Error','Your alliance-fleets may not be re-supplied. Disable alliance-use first and try again.', 1, 3);
		return;
	}

	resupply_option_click(5); // Resetting the option to default.
	if (ad2460.openQuickMenues.selected_fleet_resupply==false){
		if (ad2460.fleetvars.selected_fleet_id>0){
			fleetResupplyPanelUp();
		}
		else {
			systemFeedback('Error','No fleet selected', 1, 3);
		}
	}
	else {
		fleetResupplyPanelDown();
	}
}

function reloadAllMilitaryData(reload_feedback,callback_string){
	$.post('actionhandler.pl', {action:'reload_all_military_data', reload_feedback:reload_feedback}, function(data){ parseInfo(data); eval(callback_string);});
}

function selected_fleet_disband_button_click(){
	var fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	if (fleet==false){
		systemFeedback('Error','No fleet selected', 1, 3);
		return;
	}
	if (fleet.homeworld_fleet==1 && fleet.current_x!=ad2460.homeworld.x && fleet.current_y!=ad2460.homeworld.y){
		systemFeedback('Error','You can not disband a station-fleet.', 1, 3);
		return;
	}
	if (fleet.homeworld_fleet==1){
		systemFeedback('Error','You can not disband your base-fleet.', 1, 3);
		return;
	}
	if (fleet.bank_fleet==1){
		systemFeedback('Error','You can not empty or disband your bank-fleet.', 1, 3);
		return;
	}

	var selectedFleetIsHome=false;
	if (fleet.current_x==ad2460.homeworld.x && fleet.current_y==ad2460.homeworld.y ){
		selectedFleetIsHome=true;
	}
	if (!selectedFleetIsHome){
		systemFeedback('Error','A fleet must be at your homeworld before you can empty or disband it.', 1, 3);
		return;
	}
	if (fleet.homeworld_fleet==1){
		systemFeedback('Error','You can not empty or disband your base-fleet.', 1, 3);
		return;
	}
	if (fleet.status!=0){
		systemFeedback('Error','Only idle fleets can be emptied or disbanded.', 1, 3);
		return;
	}


	if (ad2460.fleetvars.selected_fleet_id>0){
		// yes/no dialogue here please...
		var mainText="This will transfer the content of the fleet into your base-fleet and delete the fleet permanently. Are you sure you wish to do this?";
		if (fleet.strength>0){
			mainText="This will transfer the content of the selected fleet into your base-fleet. Are you sure you wish to do this?";
		}
		var okText="Yes";
		var cancelText="No";
		var okClick="confirmedFleetDisband();hideConfirmationPopup();";

		showConfirmationPopup(mainText, okText, cancelText, okClick);
	}
}

function confirmedFleetDisband(){
	if (ad2460.fleetvars.selected_fleet_id>0){
		$.post('actionhandler.pl', {action:'disband_fleet', fleet_id:ad2460.fleetvars.selected_fleet_id}, function(data){ parseInfo(data);});
	}
}

function selected_fleet_tactics_button_click(){
	if (ad2460.openQuickMenues.selected_fleet_tactics==false){
		if (ad2460.fleetvars.selected_fleet_id>0){
			var fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
			if (fleet==false){
				return;
			}

			if (fleet.owner_id!=ad2460.user_id && fleet.bank_fleet==0)	{
				return;
			}
			if (fleet.homeworld_fleet==1 && fleet.current_x!=ad2460.homeworld.x && fleet.current_y!=ad2460.homeworld.y){
				return;
			}
			if (fleet.owner_id!=ad2460.user_id && fleet.bank_fleet==1)	{
				var access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_military;
				if (access<1){
					return;
				}
			}

			if (fleet.auto_def==1){
				$("#copy_tactics_to_all_op_fleets_button").show();
			}
			else {
				$("#copy_tactics_to_all_op_fleets_button").hide();
			}

			fleetTacticsPanelUp();
		}
		else {
			systemFeedback('Error','No fleet selected', 1, 3);
		}
	}
	else {
		fleetTacticsPanelDown();
	}
}

function copyTacticsToAllOutpostFleets(){
	if (ad2460.fleetvars.selected_fleet_id>0){
		var fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
		if (fleet==false){
			return;
		}

		if (fleet.auto_def==1){
			$.post('actionhandler.pl', {action:'copy_tactics_to_all_op_fleets', fleet_id:ad2460.fleetvars.selected_fleet_id}, function(data){ parseInfo(data);});
		}

	}
}

function modifySmallShipStorage(id,modifier){
	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var thisFleet=ad2460.myFleets[i];
		if (thisFleet.storage_fleet==1){
			var x=0;
			for (x=0;x<thisFleet.storage.length ; x++){
				if (thisFleet.storage[x].ship_type_id==id){
					thisFleet.storage[x].counter+=modifier;
				}
			}
		}
	}
}

function modifyOrbitalUnitCount(id,modifier){
	var i=0;
	for (i=0;i<ad2460.homeworld.orbit.length ;i++ ){
		var thisOrbital=ad2460.homeworld.orbit[i];
		if (thisOrbital.id==id){
			thisOrbital.count+=modifier;
		}
	}
}

function createFleetClick(){
	$.post('actionhandler.pl', {action:'create_fleet'}, function(data){ parseInfo(data);});
}

function executeReassignmentClick(){
	// This is going to lead to a nasty little buildup here
	// could be a lot of ships involved

	if (ad2460.fleetvars.reassignmentOrders.length==0){
		systemFeedback('Error','No reassignment-orders found.', 1, 3);
		return;
	}

	var dataString="";
	var i=0;
	for (i=0;i<ad2460.fleetvars.reassignmentOrders.length ;i++ ){
		var order=ad2460.fleetvars.reassignmentOrders[i];
		dataString+='-resorder-'+order.fromFleetId+'|'+order.toFleetId+'|'+order.shipIds.toString()+'|'+order.ship_type_id+'|'+order.takeOnlySurplusFighters+'|'+order.toFleetType;
	}
	$.post('actionhandler.pl', {action:'execute_fleet_reassignment',data_string:dataString}, function(data){ parseInfo(data);});
	play_multi_sound("sfx_click3");
}

function resupply_option_click(option){
	if (option==1){
		ad2460.resupplyVars.normal_distribution=true;
		ad2460.resupplyVars.fighters_only=false;
		ad2460.resupplyVars.corvettes_only=false;
		ad2460.resupplyVars.tier_2_only=false;
		ad2460.resupplyVars.tier_1_fighters_only=false;
	}
	else if (option==2){
		ad2460.resupplyVars.normal_distribution=false;
		ad2460.resupplyVars.fighters_only=true;
		ad2460.resupplyVars.corvettes_only=false;
		ad2460.resupplyVars.tier_2_only=false;
		ad2460.resupplyVars.tier_1_fighters_only=false;
	}
	else if (option==3){
		ad2460.resupplyVars.normal_distribution=false;
		ad2460.resupplyVars.fighters_only=false;
		ad2460.resupplyVars.corvettes_only=true;
		ad2460.resupplyVars.tier_2_only=false;
		ad2460.resupplyVars.tier_1_fighters_only=false;
	}
	else if (option==4){
		ad2460.resupplyVars.normal_distribution=false;
		ad2460.resupplyVars.fighters_only=false;
		ad2460.resupplyVars.corvettes_only=false;
		ad2460.resupplyVars.tier_2_only=true;
		ad2460.resupplyVars.tier_1_fighters_only=false;
	}
	else if (option==5){
		ad2460.resupplyVars.normal_distribution=false;
		ad2460.resupplyVars.fighters_only=false;
		ad2460.resupplyVars.corvettes_only=false;
		ad2460.resupplyVars.tier_2_only=false;
		ad2460.resupplyVars.tier_1_fighters_only=true;

	}
	updateResupplyOptionsButtons();
	reassignAutoFillClick();


}

function updateResupplyOptionsButtons(){
	//console.log("updating buttons");
	if (ad2460.resupplyVars.normal_distribution==true){
		$("#resupply_option_1 .fixed_button_click").css("opacity","1");
	}
	else {
		$("#resupply_option_1 .fixed_button_click").css("opacity","0");
	}
	if (ad2460.resupplyVars.fighters_only==true){
		$("#resupply_option_2 .fixed_button_click").css("opacity","1");
	}
	else {
		$("#resupply_option_2 .fixed_button_click").css("opacity","0");
	}
	if (ad2460.resupplyVars.corvettes_only==true){
		$("#resupply_option_3 .fixed_button_click").css("opacity","1");
	}
	else {
		$("#resupply_option_3 .fixed_button_click").css("opacity","0");
	}
	if (ad2460.resupplyVars.tier_2_only==true){
		$("#resupply_option_4 .fixed_button_click").css("opacity","1");
	}
	else {
		$("#resupply_option_4 .fixed_button_click").css("opacity","0");
	}

	if (ad2460.resupplyVars.tier_1_fighters_only==true){
		$("#resupply_option_5 .fixed_button_click").css("opacity","1");
	}
	else {
		$("#resupply_option_5 .fixed_button_click").css("opacity","0");
	}

}

function calcAndFillResupplyShips(){
	var fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	var storage=returnHomeworldFleet(); // data is in the array storage.storage where each entry is an object like {ship_type_id:401, counter:0}
	// Now make a copy of storage.storage to tempstorage
	var curStr=fleet.strength;
	var maxStr=0;
	if (fleet.commander) {
		maxStr=returnStrengthLimit(fleet.commander.rank);
	}
	var addStr=0;

	var tempstorage=new Array;
	tempstorage.push({ship_type_id:401,counter:0, strength:shipToStrength(401)});
	tempstorage.push({ship_type_id:402,counter:0, strength:shipToStrength(402)});
	tempstorage.push({ship_type_id:403,counter:0, strength:shipToStrength(403)});
	tempstorage.push({ship_type_id:404,counter:0, strength:shipToStrength(404)});
	tempstorage.push({ship_type_id:405,counter:0, strength:shipToStrength(405)});
	tempstorage.push({ship_type_id:406,counter:0, strength:shipToStrength(406)});
	tempstorage.push({ship_type_id:407,counter:0, strength:shipToStrength(407)});
	tempstorage.push({ship_type_id:408,counter:0, strength:shipToStrength(408)});
	tempstorage.push({ship_type_id:409,counter:0, strength:shipToStrength(409)});
	tempstorage.push({ship_type_id:410,counter:0, strength:shipToStrength(410)});

	for (s=0;s<storage.ships.length ;s++ ){
		var slot=storage.ships[s];
		for (var x=0;x<tempstorage.length ;x++ ){
			if (tempstorage[x].ship_type_id==slot.ship_type_id){
				tempstorage[x].counter++;
			}
		}
	}

	var total_fill_slots_spent=0; // Used at the end of the function to update the counter in the DOM

	var fillships=new Array; // will hold objects like {ship_type_id:401, counter:0}
	fillships.push({ship_type_id:401, counter:0, strength:shipToStrength(401)});
	fillships.push({ship_type_id:402, counter:0, strength:shipToStrength(402)});
	fillships.push({ship_type_id:403, counter:0, strength:shipToStrength(403)});
	fillships.push({ship_type_id:404, counter:0, strength:shipToStrength(404)});
	fillships.push({ship_type_id:405, counter:0, strength:shipToStrength(405)});
	fillships.push({ship_type_id:406, counter:0, strength:shipToStrength(406)});
	fillships.push({ship_type_id:407, counter:0, strength:shipToStrength(407)});
	fillships.push({ship_type_id:408, counter:0, strength:shipToStrength(408)});
	fillships.push({ship_type_id:409, counter:0, strength:shipToStrength(409)});
	fillships.push({ship_type_id:410, counter:0, strength:shipToStrength(410)});

	if (fleet!=false){
		if (ad2460.resupplyVars.normal_distribution==true){
			// Lets do things in a proper order here
			// Vars needed

			var number_of_slots_to_fill=fleet.shortage;
			var maxpasses=number_of_slots_to_fill; // Avoid infinite loop

			for (pass=0;pass<maxpasses ;pass++ ){
				for (i=0;i<tempstorage.length ;i++ ){
					if (number_of_slots_to_fill>0){
						if (tempstorage[i].ship_type_id>=401 && tempstorage[i].ship_type_id<=410 && tempstorage[i].counter>0){
							var thisRequiresSlots=1;
							if (thisRequiresSlots<=number_of_slots_to_fill && curStr+addStr+tempstorage[i].strength<maxStr){
								// We want this ship!!!
								number_of_slots_to_fill-=thisRequiresSlots;
								tempstorage[i].counter--;
								addStr+=tempstorage[i].strength;
								var t=0;
								for (t=0;t<fillships.length ;t++ ){
									if (fillships[t].ship_type_id==tempstorage[i].ship_type_id){
										fillships[t].counter++;
									}
								}
							}
						}
					}
				}
			}

			var c=0;
			resetAllResupplyInputs();

			for (c=0;c<fillships.length ;c++ ){
				if (fillships[c].counter>0){
					var domId="reassign_input_"+fillships[c].ship_type_id;
					document.getElementById(domId).value=""+fillships[c].counter;

				}
			}
		}
		else if (ad2460.resupplyVars.fighters_only==true){
			// Lets do things in a proper order here
			// Vars needed

			var number_of_slots_to_fill=fleet.shortage;
			var maxpasses=number_of_slots_to_fill; // Avoid infinite loop

			for (pass=0;pass<maxpasses ;pass++ ){
				for (i=0;i<tempstorage.length ;i++ ){
					if (number_of_slots_to_fill>0){
						var unit=returnUnit(tempstorage[i].ship_type_id);
						if (tempstorage[i].counter>0 && unit.vesselclass=='Fighter' && unit.vesseltype=='Normal' ){
							var thisRequiresSlots=1;
							if (thisRequiresSlots<=number_of_slots_to_fill && curStr+addStr+tempstorage[i].strength<maxStr){
								// We want this ship!!!
								number_of_slots_to_fill-=thisRequiresSlots;
								tempstorage[i].counter--;
								addStr+=tempstorage[i].strength;
								var t=0;
								for (t=0;t<fillships.length ;t++ ){
									if (fillships[t].ship_type_id==tempstorage[i].ship_type_id){
										fillships[t].counter++;
									}
								}
							}
						}
					}
				}
			}

			var c=0;
			resetAllResupplyInputs();
			for (c=0;c<fillships.length ;c++ ){
				if (fillships[c].counter>0){
					var domId="reassign_input_"+fillships[c].ship_type_id;
					document.getElementById(domId).value=""+fillships[c].counter;
				}
			}


		}
		else if (ad2460.resupplyVars.corvettes_only==true){
			// Lets do things in a proper order here
			// Vars needed

			var number_of_slots_to_fill=fleet.shortage;
			var maxpasses=number_of_slots_to_fill; // Avoid infinite loop

			for (pass=0;pass<maxpasses ;pass++ ){
				for (i=0;i<tempstorage.length ;i++ ){
					if (number_of_slots_to_fill>0){
						var unit=returnUnit(tempstorage[i].ship_type_id);
						if (tempstorage[i].counter>0 && unit.vesselclass=='Corvette' && unit.vesseltype=='Normal' ){
							var thisRequiresSlots=1;
							if (thisRequiresSlots<=number_of_slots_to_fill && curStr+addStr+tempstorage[i].strength<maxStr){
								// We want this ship!!!
								number_of_slots_to_fill-=thisRequiresSlots;
								tempstorage[i].counter--;
								addStr+=tempstorage[i].strength;
								var t=0;
								for (t=0;t<fillships.length ;t++ ){
									if (fillships[t].ship_type_id==tempstorage[i].ship_type_id){
										fillships[t].counter++;
									}
								}
							}
						}
					}
				}
			}

			var c=0;
			resetAllResupplyInputs();
			for (c=0;c<fillships.length ;c++ ){
				if (fillships[c].counter>0){
					var domId="reassign_input_"+fillships[c].ship_type_id;
					document.getElementById(domId).value=""+fillships[c].counter;
				}
			}

		}
		else if (ad2460.resupplyVars.tier_1_fighters_only==true){
			// Lets do things in a proper order here
			// Vars needed

			var number_of_slots_to_fill=fleet.shortage;
			var maxpasses=number_of_slots_to_fill; // Avoid infinite loop

			for (pass=0;pass<maxpasses ;pass++ ){
				for (i=0;i<tempstorage.length ;i++ ){
					if (number_of_slots_to_fill>0){
						var unit=returnUnit(tempstorage[i].ship_type_id);
						if (tempstorage[i].counter>0 && unit.vesselclass=='Fighter' && unit.vesseltype=='Normal' && (unit.id==401 || unit.id==403 || unit.id==405) ){
							var thisRequiresSlots=1;
							if (thisRequiresSlots<=number_of_slots_to_fill && curStr+addStr+tempstorage[i].strength<maxStr){
								// We want this ship!!!
								number_of_slots_to_fill-=thisRequiresSlots;
								tempstorage[i].counter--;
								addStr+=tempstorage[i].strength;
								var t=0;
								for (t=0;t<fillships.length ;t++ ){
									if (fillships[t].ship_type_id==tempstorage[i].ship_type_id){
										fillships[t].counter++;
									}
								}
							}
						}
					}
				}
			}

			var c=0;
			resetAllResupplyInputs();
			for (c=0;c<fillships.length ;c++ ){
				if (fillships[c].counter>0){
					var domId="reassign_input_"+fillships[c].ship_type_id;
					document.getElementById(domId).value=""+fillships[c].counter;
				}
			}
		}
		else if (ad2460.resupplyVars.tier_2_only==true){
			// Lets do things in a proper order here
			// Vars needed

			var number_of_slots_to_fill=fleet.shortage;
			var maxpasses=number_of_slots_to_fill; // Avoid infinite loop

			for (pass=0;pass<maxpasses ;pass++ ){
				for (i=0;i<tempstorage.length ;i++ ){
					if (number_of_slots_to_fill>0){
						var unit=returnUnit(tempstorage[i].ship_type_id);
						if (tempstorage[i].counter>0 && (unit.id==402 || unit.id==404 || unit.id==406 || unit.id==407 ) ){
							var thisRequiresSlots=1;
							if (thisRequiresSlots<=number_of_slots_to_fill && curStr+addStr+tempstorage[i].strength<maxStr){
								// We want this ship!!!
								number_of_slots_to_fill-=thisRequiresSlots;
								tempstorage[i].counter--;
								addStr+=tempstorage[i].strength;
								var t=0;
								for (t=0;t<fillships.length ;t++ ){
									if (fillships[t].ship_type_id==tempstorage[i].ship_type_id){
										fillships[t].counter++;
									}
								}
							}
						}
					}
				}
			}

			var c=0;
			resetAllResupplyInputs();
			for (c=0;c<fillships.length ;c++ ){
				if (fillships[c].counter>0){
					var domId="reassign_input_"+fillships[c].ship_type_id;
					document.getElementById(domId).value=""+fillships[c].counter;
				}
			}


		}
		// common...
		updateReassignFreeSlots();
	}
}

function updateReassignFreeSlots(){
	var fleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	var freeSlots=fleet.shortage;
	if (fleet==false){
		return;
	}

	$("#resupply_ship_select_outer_container .minor_ship_assign_input").each(function(index) {
		var ship_type_id=parseInt($(this).attr("id").substr(15),10 );
		var count=parseInt($(this).val(),10);

		var slots_used=1*count;

		freeSlots-=slots_used;

	});

	$("#reassign_free_slots").html(""+freeSlots);

}

function resetAllResupplyInputs(){
	$("#resupply_ship_select_outer_container .minor_ship_assign_input").val("0");
}

function reassignAutoFillClick(){
	calcAndFillResupplyShips();
}

function activateRessuplyClick(){
	// Fun fun fun (-:
	// Pick up the data, shape them into a string, and throw it at the server
	var dataString="";
	$("#resupply_ship_select_outer_container .minor_ship_assign_input").each(function(index) {
		if (parseInt($(this).val(),10)>0){
			var ship_type_id=parseInt($(this).attr("id").substr(15),10);
			var count=parseInt($(this).val(),10);
			dataString+=ship_type_id+":"+count+"|";
		}

	});

	dataString=dataString.slice(0, -1);
	$.post('actionhandler.pl', {action:'execute_fleet_resupply', fleet_id: ad2460.fleetvars.selected_fleet_id, data_string:dataString}, function(data){ parseInfo(data);});

}

function unselectFleet(){
	ad2460.fleetvars.selected_fleet_id=0;
	removeChildNodes('fleet_composition_container');
	$("#fleet_infopanel_help").html('No fleet selected.');

	document.getElementById('fleet_management_sidepanel_selected_fleet_name').contentEditable='false';
	$("#fleet_management_sidepanel_selected_fleet_name").html("No fleet selected");
	$("#fleet_management_sidepanel_selected_fleet_shipcount").html("N/A");
	$("#fleet_management_sidepanel_selected_fleet_strength").html("N/A");
	$("#fleet_management_sidepanel_selected_fleet_techtilt").html("N/A");
	$("#fleet_management_sidepanel_selected_fleet_battles").html("0");
	$("#fleet_management_sidepanel_selected_fleet_wins").html("0");
	$("#fleet_management_sidepanel_selected_fleet_losses").html("0");
	//$("#fleet_management_sidepanel_selected_fleet_upkeep").html("N/A");
	$("#fleet_management_sidepanel_selected_fleet_shortage").html("N/A");
	$("#fleet_management_sidepanel_selected_fleet_recharge").html("N/A");


}

function fetchOwnCommanders(callbackString){
	$.post('actionhandler.pl', {action:'fetch_own_commanders'}, function(data){ parseInfo(data);eval(callbackString);});
}


function deleteCommanders(){
	ad2460.myCommanders=new Array;
}

function unrenderCommanders(){
	unrenderHiredCommanders();
	unrenderAcademyRecruits();
}

function unrenderHiredCommanders(){
	removeChildNodes('allYourCommanders');
}

function unrenderAcademyRecruits(){
	removeChildNodes('academy_recruits_container');
}

function renderCommanders(){
	renderCommandersSummary();
	renderHiredCommanders();
	renderAcademyRecruits();
	linkCommandersToFleets();
	//renderOutpostsContainers();
	updateMilitaryOverview();
	//ladyHelperMain('renderCommanders');
	if (ad2460.vip_status>0){
		$("#comm_custom_helptext").html("This feature is FREE for VIPs.");
	}
}

function linkCommandersToFleets(){
	// Check each fleets commander_id and attach the commander-object that corresponds..
	// Then reattach them
	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var fleet=ad2460.myFleets[i];
		fleet.commander=null;
		if (fleet.commander_id>0){
			fleet.commander=returnCommanderById(fleet.commander_id);
		}
	}
}

function linkCommandersToAllianceFleets(){
	// Check each fleets commander_id and attach the commander-object that corresponds..
	// Then reattach them
	var i=0;
	var x=0;
	for (i=0;i<ad2460.allianceData.memberlist.length ;i++ ){
		for (x=0;x<ad2460.allianceData.memberlist[i].allianceFleets.length ;x++ ){
			var fleet=ad2460.allianceData.memberlist[i].allianceFleets[x];
			fleet.commander=null;
			if (fleet.commander_id>0){
				fleet.commander=returnCommanderById(fleet.commander_id);
			}
		}
	}
}

function addFleetTactics(fleet_id, target_priority, target_switching, minimize_movement, fighter_priority, corvette_priority, retreat_percentage, retreat_type, retreat_if_even, retreat_if_unwinnable){
	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var fleet=ad2460.myFleets[i];
		if (fleet.fleet_id==fleet_id){
			fleet.tactics=new tacticSetup(fleet_id, target_priority, target_switching, minimize_movement, fighter_priority, corvette_priority, retreat_percentage, retreat_type, retreat_if_even, retreat_if_unwinnable);
		}
	}
}


function updateCommander(commander_id, owner_id, hired, name, personality, tactics, commanding, perception, morale, rank, experience, wins, losses, image_id, sex, fleet_id, missions, dead, uniform, points ){
	var i=0;
	var found=false;

	if (owner_id==ad2460.user_id){
		for (i=0;i<ad2460.myCommanders.length ;i++ ){
			if (ad2460.myCommanders[i].commander_id==commander_id){
				// found him, just update the bastard.
				var thisCommander=ad2460.myCommanders[i];
				thisCommander.owner_id=owner_id;
				thisCommander.hired=hired;
				thisCommander.name=name;
				thisCommander.personality=personality;
				thisCommander.tactics=tactics;
				thisCommander.commanding=commanding;
				thisCommander.perception=perception;
				thisCommander.morale=morale;
				thisCommander.rank=rank;
				thisCommander.experience=experience;
				thisCommander.wins=wins;
				thisCommander.losses=losses;
				thisCommander.image_id=image_id;
				thisCommander.sex=sex;
				thisCommander.fleet_id=fleet_id;
				thisCommander.missions=missions;
				thisCommander.dead=dead;
				thisCommander.uniform=uniform;
				thisCommander.points=points;
				found=true;
			}
		}
		if (!found){
			ad2460.myCommanders.push(new commander(commander_id, owner_id, hired, name, personality, tactics, commanding, perception, morale, rank, experience, wins, losses, image_id, sex, fleet_id, missions, dead, uniform, points));
		}

	}
	else {
		for (i=0;i<ad2460.commanderCache.length ;i++ ){
			if (ad2460.commanderCache[i].commander_id==commander_id){
				// found him, just update the bastard.
				var thisCommander=ad2460.commanderCache[i];
				thisCommander.owner_id=owner_id;
				thisCommander.hired=hired;
				thisCommander.name=name;
				thisCommander.personality=personality;
				thisCommander.tactics=tactics;
				thisCommander.commanding=commanding;
				thisCommander.perception=perception;
				thisCommander.morale=morale;
				thisCommander.rank=rank;
				thisCommander.experience=experience;
				thisCommander.wins=wins;
				thisCommander.losses=losses;
				thisCommander.image_id=image_id;
				thisCommander.sex=sex;
				thisCommander.fleet_id=fleet_id;
				thisCommander.missions=missions;
				thisCommander.uniform=uniform;
				thisCommander.points=points;
				found=true;
			}
		}
		if (!found){
			ad2460.commanderCache.push(new commander(commander_id, owner_id, hired, name, personality, tactics, commanding, perception, morale, rank, experience, wins, losses, image_id, sex, fleet_id, missions, dead, uniform, points));
		}

	}
}

function renderHiredCommanders(){
	var i=0;
	unrenderHiredCommanders();
	var outerContainer=document.getElementById('allYourCommanders');
	for (i=0;i<ad2460.myCommanders.length ;i++ ){
		var thisCommander=ad2460.myCommanders[i];
		if (thisCommander.hired==0){
			continue;
		}

		var main_class='tableselection';
		if (i % 2 == 0){ main_class+=' evenline';	}
		else {main_class+=' oddline';	}

		if (thisCommander.dead==1){
			main_class+=' notenough';
		}

		var innerContainer=createSingleElement('div', main_class, '', '', 'commanderClick('+thisCommander.commander_id+')');

		var activeDiv=createSingleElement('div', 'table_comm_active', '', '', '');

		var activeImageSrc='images/icons/inactivecommander.png';
		if (thisCommander.fleet_id>0){
			activeImageSrc='images/icons/activecommander.png';
		}
		if (thisCommander.dead==1){
			activeImageSrc='images/icons/deadcommander.png';
		}
		var activeImg=createSingleElement('img', '', '', activeImageSrc, '');

		var rankNameObj=returnCommanderRankNameObject(thisCommander.rank);

		var nameString=rankNameObj.shortRank+' '+thisCommander.name;

		if (thisCommander.points>0){
			nameString="<span style='color:yellow;font-weight:bold;'> + </span>"+nameString;
		}
		var rankNameDiv=createSingleElement('div', 'table_comm_name', '', nameString, '');

		var titleString="";
		var fleetImageSrc="";

		var fleetName="No fleet";
		var shipcount=0;
		var max_shipcount=returnShipLimit(thisCommander.rank);
		var isHomeworldFleet=false;

		var maxStrength=returnStrengthLimit(thisCommander.rank);
		var thisStrength=0;

		if (thisCommander.fleet_id>0){
			var fleet=returnFleetById(thisCommander.fleet_id);
			if (fleet!=false){
				var imageTitleObject=returnFleetTitleAndImage(fleet);
				titleString=imageTitleObject.title;
				fleetImageSrc=imageTitleObject.imgsrc;
				fleetName=fleet.fleet_name;
				shipcount=fleet.shipcount;
				thisStrength=fleet.strength;
				if (fleet.homeworld_fleet==1){
					isHomeworldFleet=true;
				}
			}
		}

		var fleetTypeDiv=createSingleElement('div', 'table_fleet_type', '', '', '');
		if (fleetImageSrc!=""){
			fleetTypeImg=createSingleElement('img', '', '', fleetImageSrc, '');
			fleetTypeDiv.setAttribute("title",titleString);
			fleetTypeDiv.appendChild(fleetTypeImg);
		}

		var fleetNameDiv=createSingleElement('div', 'table_comm_name fleetname', '', fleetName, '');
		var fleetSizeDiv;
		if (isHomeworldFleet==true){
			fleetSizeDiv=createSingleElement('div', 'table_comm_fleet_size str', '', ''+thisStrength, '');
		}
		else {
			fleetSizeDiv=createSingleElement('div', 'table_comm_fleet_size str', '', ''+thisStrength+' / '+maxStrength, '');
		}


		activeDiv.appendChild(activeImg);
		innerContainer.appendChild(activeDiv);
		innerContainer.appendChild(rankNameDiv);
		innerContainer.appendChild(fleetTypeDiv);
		innerContainer.appendChild(fleetNameDiv);
		innerContainer.appendChild(fleetSizeDiv);

		outerContainer.appendChild(innerContainer);
	}
	checkScrollButtonStatus('allYourCommanders');
	// We have to re-render outposts with updated commander-info!!
	checkUnclaimedTechPoints('player_update',8);
}

function resetSelectedCommander(){
	$("#selected_commander_rank_name").html("");
	$("#selected_commander_name").html("No commander selected");
	document.getElementById('selected_commander_name').contentEditable='false';
	document.getElementById('selected_commander_name').onkeypress=null;
	$("#selected_commander_personality").html("N/A");
	$("#selected_commander_commanding").html("N/A");
	$("#selected_commander_perception").html("N/A");
	$("#selected_commander_tactics").html("N/A");
	$("#selected_commander_morale").html("N/A");
	$("#selected_commander_experience").html('-/-');
	$("#selected_commander_ship_limit").html("N/A");
	$("#selected_commander_fleet_limit").html('N/A');
	$("#selected_commander_portrait").attr("src","images/fixed/nocommanderselected.jpg");
	hideMyRecruits();

	$("#selected_commander_fleet_manage_button").hide();
	$("#selected_commander_retire_button").show();

	$("#commander_current_assignment_section").hide();
	$("#selected_commander_history_battles").html("N/A");
	$("#selected_commander_history_battles_won").html("N/A");
	$("#selected_commander_history_battles_lost	").html("N/A");
	$("#selected_commander_history_missions_completed").html("N/A");

	$("#selected_commander_bg").attr("src","images/commanders/nobg.jpg");
	$("#selected_commander_uniform").attr("src","images/commanders/nouniform.png");
	$("#selected_commander_head").attr("src","images/commanders/nohead.png");

	$("#commander_stat_plus_button_commanding").hide();
	$("#commander_stat_plus_button_perception").hide();
	$("#commander_stat_plus_button_tactics").hide();
	$("#commander_stat_plus_button_morale").hide();

	$("#commander_stat_plus_button_commanding_5").hide();
	$("#commander_stat_plus_button_perception_5").hide();
	$("#commander_stat_plus_button_tactics_5").hide();
	$("#commander_stat_plus_button_morale_5").hide();

	ad2460.selectedCommanderId=0;

}

function returnMissionCommanderGraphics(commander){
	var returnObj={};
	returnObj.bgImage="images/missioncommanders/nobg.jpg";
	returnObj.uniformImage="images/missioncommanders/nouniform.png";
	returnObj.headImage="images/missioncommanders/nohead.png";

	if (commander.commander_id==0){
		return returnObj;
	}
	if (commander.dead==1){
		returnObj.bgImage="images/missioncommanders/dead_commander.jpg";
		returnObj.uniformImage="images/blank.gif";
		returnObj.headImage="images/blank.gif";
		return returnObj;
	}

	// The background
	if (commander.hired==0){
		returnObj.bgImage="images/missioncommanders/comm_bg_02.jpg";

	}
	else {
		var test=commander.commander_id%8;
		if (test==0){	returnObj.bgImage="images/missioncommanders/comm_bg_01.jpg";		}
		if (test==1){	returnObj.bgImage="images/missioncommanders/comm_bg_03.jpg";		}
		if (test==2){	returnObj.bgImage="images/missioncommanders/comm_bg_04.jpg";		}
		if (test==3){	returnObj.bgImage="images/missioncommanders/comm_bg_05.jpg";		}
		if (test==4){	returnObj.bgImage="images/missioncommanders/comm_bg_06.jpg";		}
		if (test==5){	returnObj.bgImage="images/missioncommanders/comm_bg_07.jpg";		}
		if (test==6){	returnObj.bgImage="images/missioncommanders/comm_bg_08.jpg";		}
		if (test==7){	returnObj.bgImage="images/missioncommanders/comm_bg_09.jpg";		}

	}

	// The uniform
	if (commander.sex=='Male'){
		returnObj.uniformImage="images/missioncommanders/male/rank"+zeroPad(commander.rank)+".png";
	}
	else if (commander.sex=='Female'){
		returnObj.uniformImage="images/missioncommanders/female/rank"+zeroPad(commander.rank)+".png";
	}
	//The head
	if (commander.sex=='Male'){
		returnObj.headImage="images/missioncommanders/male/heads/m";
		returnObj.headImage+=zeroPad(commander.image_id);

		if (commander.rank<4){	returnObj.headImage+='r01';		}
		else if (commander.rank<7){	returnObj.headImage+='r02';		}
		else if (commander.rank<10){	returnObj.headImage+='r03';		}
		else {	returnObj.headImage+='r04';		}

		returnObj.headImage+='.png';
	}

	else if (commander.sex=='Female'){
		returnObj.headImage="images/missioncommanders/female/heads/f";
		returnObj.headImage+=zeroPad(commander.image_id);

		if (commander.rank<5){	returnObj.headImage+='r01';		}
		else if (commander.rank<10){	returnObj.headImage+='r02';		}
		else {	returnObj.headImage+='r03';		}

		returnObj.headImage+='.png';
	}

	return returnObj;
}

function returnOutpostCommanderGraphics(outpost){
	var returnObj={};
	returnObj.bgImage="images/commanders/nobg.jpg";
	returnObj.uniformImage="images/commanders/nouniform.png";
	returnObj.headImage="images/commanders/nohead.png";

	var rank=outpost.returnCommanderRank();

	var test=outpost.planet_id%4;
	if (test==0){	returnObj.bgImage="images/commanders/comm_bg_01.jpg";		}
	if (test==1){	returnObj.bgImage="images/commanders/comm_bg_03.jpg";		}
	if (test==2){	returnObj.bgImage="images/commanders/comm_bg_04.jpg";		}
	if (test==3){	returnObj.bgImage="images/commanders/comm_bg_05.jpg";		}
	if (test==4){	returnObj.bgImage="images/commanders/comm_bg_06.jpg";		}

	returnObj.bgImage="images/planets/outpost_planets/planettype"+outpost.world_type+".jpg";

	var image_id=outpost.planet_id%7;
	var uniform="brown";
	var sex=outpost.planet_id%2;
	// The uniform
	if (sex==0){
		returnObj.uniformImage="images/commanders/male/"+uniform+"/rank"+zeroPad(rank)+".png";
	}
	else{
		returnObj.uniformImage="images/commanders/female/"+uniform+"/rank"+zeroPad(rank)+".png";
	}
	//The head
	if (sex==0){
		returnObj.headImage="images/commanders/male/heads/m";
		returnObj.headImage+=zeroPad(1+image_id);

		if (commander.rank<4){	returnObj.headImage+='r01';		}
		else if (commander.rank<7){	returnObj.headImage+='r02';		}
		else if (commander.rank<10){	returnObj.headImage+='r03';		}
		else {	returnObj.headImage+='r04';		}

		returnObj.headImage+='.png';
	}

	else{
		returnObj.headImage="images/commanders/female/heads/f";
		returnObj.headImage+=zeroPad(1+image_id);

		if (commander.rank<5){	returnObj.headImage+='r01';		}
		else if (commander.rank<10){	returnObj.headImage+='r02';		}
		else {	returnObj.headImage+='r03';		}

		returnObj.headImage+='.png';
	}

	return returnObj;


}

function returnCommanderGraphics(commander){
	var returnObj={};
	returnObj.bgImage="images/commanders/nobg.jpg";
	returnObj.uniformImage="images/commanders/nouniform.png";
	returnObj.headImage="images/commanders/nohead.png";

	if (commander.commander_id==0){
		return returnObj;
	}
	if (commander.dead==1){
		returnObj.bgImage="images/commanders/dead_commander.jpg";
		returnObj.uniformImage="images/blank.gif";
		returnObj.headImage="images/blank.gif";
		return returnObj;
	}

	// The background
	if (commander.hired==0){
		returnObj.bgImage="images/commanders/comm_bg_02.jpg";

	}
	else {
		var test=commander.commander_id%8;
		if (test==0){	returnObj.bgImage="images/commanders/comm_bg_01.jpg";		}
		if (test==1){	returnObj.bgImage="images/commanders/comm_bg_03.jpg";		}
		if (test==2){	returnObj.bgImage="images/commanders/comm_bg_04.jpg";		}
		if (test==3){	returnObj.bgImage="images/commanders/comm_bg_05.jpg";		}
		if (test==4){	returnObj.bgImage="images/commanders/comm_bg_06.jpg";		}
		if (test==5){	returnObj.bgImage="images/commanders/comm_bg_07.jpg";		}
		if (test==6){	returnObj.bgImage="images/commanders/comm_bg_08.jpg";		}
		if (test==7){	returnObj.bgImage="images/commanders/comm_bg_09.jpg";		}

	}

	// The uniform
	if (commander.sex=='Male'){
		returnObj.uniformImage="images/commanders/male/"+commander.uniform+"/rank"+zeroPad(commander.rank)+".png";
	}
	else if (commander.sex=='Female'){
		returnObj.uniformImage="images/commanders/female/"+commander.uniform+"/rank"+zeroPad(commander.rank)+".png";
	}
	//The head
	if (commander.sex=='Male'){
		returnObj.headImage="images/commanders/male/heads/m";
		returnObj.headImage+=zeroPad(commander.image_id);

		if (commander.rank<4){	returnObj.headImage+='r01';		}
		else if (commander.rank<7){	returnObj.headImage+='r02';		}
		else if (commander.rank<10){	returnObj.headImage+='r03';		}
		else {	returnObj.headImage+='r04';		}

		returnObj.headImage+='.png';
	}

	else if (commander.sex=='Female'){
		returnObj.headImage="images/commanders/female/heads/f";
		returnObj.headImage+=zeroPad(commander.image_id);

		if (commander.rank<5){	returnObj.headImage+='r01';		}
		else if (commander.rank<10){	returnObj.headImage+='r02';		}
		else {	returnObj.headImage+='r03';		}

		returnObj.headImage+='.png';
	}

	return returnObj;
}

function commanderClick(id){
	removeChildNodes('selected_commander_fleet_dropdown');

	var cmd=returnCommanderById(id);
	if (cmd){
		ad2460.selectedCommanderId=id;
		ad2460.editCommander=new commander(cmd.commander_id, cmd.owner_id, cmd.hired, cmd.name, cmd.personality, cmd.tactics, cmd.commanding, cmd.perception, cmd.morale, cmd.rank, cmd.experience, cmd.wins, cmd.losses, cmd.image_id, cmd.sex, cmd.fleet_id, cmd.missions, cmd.dead, cmd.uniform, cmd.points);
		if (cmd.hired==1){
			$("#customize_commander_container").show();
			$("#customize_commander_container_none").hide();
			$("#customize_commander_container_dead").hide();
		}
		else {
			$("#customize_commander_container").hide();
			$("#customize_commander_container_none").show();
			$("#customize_commander_container_dead").hide();
		}
		if (cmd.dead==1){
			$("#customize_commander_container").hide();
			$("#customize_commander_container_none").hide();
			$("#customize_commander_container_dead").show();
		}

		if (cmd.points>0 && cmd.hired>0){
			if (cmd.commanding<100){
				$("#commander_stat_plus_button_commanding").show();
			}
			if (cmd.perception<100){
				$("#commander_stat_plus_button_perception").show();
			}
			if (cmd.tactics<100){
				$("#commander_stat_plus_button_tactics").show();
			}
			if (cmd.morale<100){
				$("#commander_stat_plus_button_morale").show();
			}
		}
		else {
			$("#commander_stat_plus_button_commanding").hide();
			$("#commander_stat_plus_button_perception").hide();
			$("#commander_stat_plus_button_tactics").hide();
			$("#commander_stat_plus_button_morale").hide();

		}

		if (cmd.points>=5 && cmd.hired>0){
			if (cmd.commanding<=95){
				$("#commander_stat_plus_button_commanding_5").show();
			}
			if (cmd.perception<=95){
				$("#commander_stat_plus_button_perception_5").show();
			}
			if (cmd.tactics<=95){
				$("#commander_stat_plus_button_tactics_5").show();
			}
			if (cmd.morale<=95){
				$("#commander_stat_plus_button_morale_5").show();
			}
		}
		else {
			$("#commander_stat_plus_button_commanding_5").hide();
			$("#commander_stat_plus_button_perception_5").hide();
			$("#commander_stat_plus_button_tactics_5").hide();
			$("#commander_stat_plus_button_morale_5").hide();

		}


		// techpoint-check!
		checkUnclaimedTechPoints('academy_use',0);
		// Done!
		// update the stats ++
		var button=document.getElementById('selected_commander_fleet_manage_button');
		var retireButton=document.getElementById('selected_commander_retire_button');
		var rankObject=returnCommanderRankNameObject(cmd.rank);

		$("#selected_commander_rank_name").html(rankObject.longRank);
		$("#selected_commander_name").html(cmd.name);

		document.getElementById('selected_commander_name').contentEditable='true';

		document.getElementById('selected_commander_name').onkeydown=function(event){
			if (event.which!=8 && event.keyCode!=8 && event.which!=16 && event.keyCode!=16 && event.which!=37 && event.keyCode!=37 && event.which!=38 && event.keyCode!=38 && event.which!=39 && event.keyCode!=39 && event.which!=40 && event.keyCode!=40 && event.which!=46 && event.keyCode!=46 && event.which!=36 && event.keyCode!=36 && event.which!=35 && event.keyCode!=35 ) {
				if (document.getElementById('selected_commander_name').innerHTML.length>20){
					event.preventDefault;
					return false;
				}
				//console.log(event.which,event.keyCode);
			}
			if (event.which==13 || event.keyCode==13) {
				event.preventDefault;
			}
		}

		document.getElementById('selected_commander_name').onkeypress=function(event){
			if (event.which==13 || event.keyCode==13) {
				//console.log(event.which,event.keyCode);
				event.preventDefault;
				var enteredName=$("#selected_commander_name").text();

				enteredName=enteredName.replace('<br>','');
				enteredName=enteredName.replace('<br type="_moz">','');
				enteredName=enteredName.replace(/(\r\n|\n|\r)/gm,"");
				document.getElementById('selected_commander_name').innerHTML=enteredName;

				if (document.getElementById('selected_commander_name').innerHTML.length>4){
					updateCommanderName(cmd.commander_id);
					document.getElementById('selected_commander_name').blur();
					return false;
				}
				else {
					systemFeedback('Error','Too short!', 1, 3);
					return false;
				}
			}
		}


		$("#selected_commander_personality").html(cmd.personality);
		if (cmd.dead==1){
			$("#selected_commander_personality").html('K.I.A');
		}
		$("#selected_commander_commanding").html(cmd.commanding);
		$("#selected_commander_perception").html(cmd.perception);
		$("#selected_commander_tactics").html(cmd.tactics);
		$("#selected_commander_morale").html(cmd.morale);
		$("#selected_commander_statpoints").html(cmd.points);

		var cmd_xp_string=''+cmd.experience;
		if (cmd.experience>99999){
			var temp=(cmd.experience/1000).toFixed(0);
			temp=temp+' K';
			cmd_xp_string=temp;
		}


		$("#selected_commander_experience").html(cmd_xp_string+' / '+ad2460.commander_xp_levels[cmd.rank]);
		$("#selected_commander_ship_limit").html(returnStrengthLimit(cmd.rank));
		$("#selected_commander_fleet_limit").html(ad2460.commander_max_fleets[cmd.rank]);
		//$("#selected_commander_portrait").attr("src","images/fixed/commander180x217.jpg");

		var cmdImages=returnCommanderGraphics(cmd);

		$("#selected_commander_bg").attr("src",cmdImages.bgImage);
		$("#selected_commander_uniform").attr("src",cmdImages.uniformImage);
		$("#selected_commander_head").attr("src",cmdImages.headImage);


		if (cmd.hired>0)	{
			hideMyRecruits();
			$("#commander_current_assignment_section").show();
			$("#selected_commander_history_battles").html(parseInt(cmd.wins+cmd.losses,10));
			$("#selected_commander_history_battles_won").html(cmd.wins);
			$("#selected_commander_history_battles_lost	").html(cmd.losses);
			$("#selected_commander_history_missions_completed").html(cmd.missions);

			$("#selected_commander_fleet_manage_button").hide();
			$("#selected_commander_retire_button").show();
			retireButton.setAttribute("onclick",'retireCommanderClick('+cmd.commander_id+')');
			$("#selected_commander_retire_button .fixed_button_click.red22").css({opacity:0});
			$("#selected_commander_retire_button").css({opacity:1.0});

			if (cmd.fleet_id>0){
				button.setAttribute("onclick",'manageFleetForCommander('+cmd.commander_id+')');
				$("#selected_commander_fleet_manage_button .buttontext24").html('Manage Fleet');
				$("#selected_commander_fleet_manage_button").show();
				//$("#selected_commander_retire_button .fixed_button_click.red22").css({opacity:0.5});
				$("#selected_commander_retire_button").css({opacity:0.5});
				var fleet=returnFleetById(cmd.fleet_id);
				if (fleet){
					$("#selected_commander_fleet_name").html(fleet.fleet_name);
					$("#selected_commander_location").html(returnLocationName(fleet.current_x,fleet.current_y));
					// $("#selected_commander_subordinate_fleets").html("No idea");
				}
			}
			else {
				$("#selected_commander_fleet_name").html("N/A");
				$("#selected_commander_location").html(ad2460.homeworld.name);
				// $("#selected_commander_subordinate_fleets").html("N/A");
			}
			// Now add the valid reassignment-fleets in the dropdown
			// Go through all fleets, who are at the homeworld, and check if he can handle the ship-count, and check if the commander in the swapping fleet can handle this fleets shipcount.
			// If both are ok, swap'em!
			var dropdown=document.getElementById('selected_commander_fleet_dropdown');
			dropdown.setAttribute("onchange","reassignCommander("+cmd.commander_id+")");
			dropdown.appendChild(new Option("-", '-1'));
			var i=0;
			var currentFleet=returnFleetById(cmd.fleet_id);
			for (i=0;i<ad2460.myFleets.length ;i++ ){
				var fleet=ad2460.myFleets[i];
				if (fleet.current_x==ad2460.homeworld.x && fleet.current_y==ad2460.homeworld.y && currentFleet.current_x==ad2460.homeworld.x && currentFleet.current_y==ad2460.homeworld.y && fleet.fleet_id!=cmd.fleet_id && fleet.storage_fleet==0){
					//console.log("fleet location check ok for fleet "+fleet.fleet_name);
					if (fleet.strength<=returnStrengthLimit(cmd.rank) || fleet.homeworld_fleet==1) {
						var otherCommander=returnCommanderById(fleet.commander_id);
						if (currentFleet){
							// there is a current-fleet
							if (currentFleet.strength>returnStrengthLimit(otherCommander.rank) && currentFleet.homeworld_fleet==0){
								continue;
							}

						}
						dropdown.appendChild(new Option(fleet.fleet_name, ''+fleet.fleet_id));
					}

				}

			}
		}
		else {
			showMyRecruits();
			$("#commander_current_assignment_section").hide();
			button.setAttribute("onclick",'hireCommanderClick('+cmd.commander_id+')');
			$("#selected_commander_fleet_manage_button .buttontext24").html('Activate');
			$("#selected_commander_fleet_manage_button").show();
			$("#selected_commander_retire_button").hide();
			retireButton.setAttribute("onclick",null);
		}
	}
	else {
		// Reset everything
		resetSelectedCommander();
	}
}

function reassignCommander(commander_id){
	var dropdown=document.getElementById('selected_commander_fleet_dropdown');
	var to_fleet_id=parseInt(dropdown.options[dropdown.selectedIndex].value,10);
	var toFleet=returnFleetById(to_fleet_id);
	var commander=returnCommanderById(commander_id);
	var fromFleet=returnFleetById(commander.fleet_id);
	var otherCommander=returnCommanderById(toFleet.commander_id);

	//console.log("Reassigning not complete........");
	//console.log(fromFleet, commander, toFleet, otherCommander);

	if (fromFleet && commander && toFleet && otherCommander){
		//console.log("all true");
		$.post('actionhandler.pl', {action:'reassign_commander', commander_id: commander_id, to_fleet_id:toFleet.fleet_id}, function(data){ parseInfo(data);});

	}
	else {
		//console.log("all not true, do nothing.");
	}

}

function manageFleetForCommander(commander_id){
	var commander=returnCommanderById(commander_id);
	if (commander){
	// close the comanders_main_panel
		if (commander.fleet_id>0){
			closePanels();
			setTimeout('$("#fleet_management_main_panel").click()',900);
			setTimeout('selectFleet('+commander.fleet_id+')',1800);
		}
	}
}

function specialSelectCommander(id){
	var commander=returnCommanderById(id);
	if (commander){
		$("#militarybutton").click();
		setTimeout('$("#commanders_main_panel").click()',900);
		setTimeout('commanderClick('+id+')',1800);
	}
}

function retireCommanderClick(commander_id){
	var commander=returnCommanderById(commander_id);
	if (commander){
		if (commander.fleet_id>0){
			systemFeedback('Error','You can not retire active commanders that are in control of a fleet.', 1, 3);
			return;
		}
		var mainText="This will terminate the contract with the selcted commander, and he or she will be permanently gone. Are you sure you wish to do this?";
		var okText="Yes";
		var cancelText="No";
		var okClick="confirmedCommanderSack("+commander_id+");hideConfirmationPopup();";
		showConfirmationPopup(mainText, okText, cancelText, okClick);
	}
}

function confirmedCommanderSack(commander_id){
	$.post('actionhandler.pl', {action:'retire_commander', commander_id: commander_id}, function(data){ parseInfo(data);});
}

function hireCommanderClick(commander_id){
	var commander=returnCommanderById(commander_id);
	if (commander){
		if (commander.hired>0){
			systemFeedback('Error','This commander is already hired.', 1, 3);
			fetchOwnCommanders();
			return;
		}
		var mainText="Are you sure you wish to promote and activate this fresh commander?";
		var okText="Yes";
		var cancelText="No";
		var okClick="confirmedCommanderHire("+commander_id+");hideConfirmationPopup();hideHelpCommander();";
		showConfirmationPopup(mainText, okText, cancelText, okClick);
	}
}

function confirmedCommanderHire(commander_id){
	$.post('actionhandler.pl', {action:'hire_commander', commander_id: commander_id}, function(data){ parseInfo(data); });
}


function showMyRecruits(){
	$("#commander_history").hide();
	$("#academy_recruits").show();

	$("#customize_commander_container").hide();
	$("#customize_commander_container_none").show();
	$("#customize_commander_container_dead").hide();

}

function hideMyRecruits(){
	$("#academy_recruits").hide();
	$("#commander_history").show();
}

function returnShipLimit(rank){
	var max_shipcount=10+((rank-1)*5);
	return max_shipcount;
}

function returnStrengthLimit(rank){
	var limit=rank*10000;
	if (combat_test_mode==1){
		limit=rank*30000;
	}
	return limit;
}


function returnCommanderById(id){
	var i=0;
	for (i=0;i<ad2460.myCommanders.length ;i++ ){
		if (ad2460.myCommanders[i].commander_id==id){
			return ad2460.myCommanders[i];
		}
	}

	for (i=0;i<ad2460.commanderCache.length ;i++ ){
		if (ad2460.commanderCache[i].commander_id==id){
			return ad2460.commanderCache[i];
		}
	}

	return false;
}

function renderAcademyRecruits(){
	var i=0;
	unrenderAcademyRecruits();
	var outerContainer=document.getElementById('academy_recruits_container');
	for (i=0;i<ad2460.myCommanders.length ;i++ ){
		var thisCommander=ad2460.myCommanders[i];
		if (thisCommander.hired>0){
			continue;
		}

		// Old style
		// var recruitDiv=createSingleElement('div', 'commander_recruits', '', thisCommander.name, 'commanderClick('+thisCommander.commander_id+')');
		//outerContainer.appendChild(recruitDiv);

		// New style
		var recruitDiv=createSingleElement('div', 'commander_recruits', '', '', 'commanderClick('+thisCommander.commander_id+')');
		var secondDiv=createSingleElement('div', 'selected_commander_img recruit', '', '', '');
		var cmdImages=returnCommanderGraphics(thisCommander);
		var img1=createSingleElement('img', 'selected_commander_bg recruit', '', cmdImages.bgImage, '');
		var img2=createSingleElement('img', 'selected_commander_uniform recruit', '', cmdImages.uniformImage, '');
		var img3=createSingleElement('img', 'selected_commander_head recruit', '', cmdImages.headImage, '');
		var nameDiv=createSingleElement('div', 'recruit_commander_name', '', thisCommander.name, '');

		recruitDiv.appendChild(secondDiv);
		secondDiv.appendChild(img1);
		secondDiv.appendChild(img2);
		secondDiv.appendChild(img3);
		recruitDiv.appendChild(nameDiv);
		outerContainer.appendChild(recruitDiv);
	/*

			<div class="commander_recruits" id="recruit_1">
				<div class="selected_commander_img recruit">
					<img class="selected_commander_bg recruit" src="../images/commanders/comm_bg_02.jpg">
					<img class="selected_commander_uniform recruit" src="../images/commanders/female/rank01.png">
					<img class="selected_commander_head recruit" src="../images/commanders/female/heads/f01r01.png">
				</div>
				<div class="recruit_commander_name">Nauthainiel Hawethronest</div>
			</div>
*/

	}
		// And that's it, too easy really...

}

function returnFleetTitleAndImage(fleet){
		var title="";
		var imgsrc='images/icons/homeworld_fleet_0.png';
		if (fleet.homeworld_fleet==1 && fleet.current_x==ad2460.homeworld.x && fleet.current_y==ad2460.homeworld.y){
			title="This is your base-fleet";
			imgsrc='images/icons/homeworld_fleet_0.png';
		}
		else if (fleet.homeworld_fleet==1){
			title="This is a station-defense fleet";
			imgsrc='images/icons/station_fleet_icon.png';

		}

		else if (fleet.storage_fleet==1){
			title="This is your planetary small-ships-storage";
		}
		else if (fleet.alliance_fleet>0){
			title="This fleet can be controlled by your alliance";
			imgsrc='images/icons/alliance_fleet_3.png';
		}
		else if (fleet.on_mission>0){
			title="This fleet is out on a special mission";
			imgsrc='images/icons/mission_fleet_0.png';
		}
		else {
			title="This is a normal fleet";
		}

		var isAtMyOutpost=false;
		var o=0;
		for (o=0;o<ad2460.outposts.length ;o++ ){
			if (fleet.current_x==ad2460.outposts[o].x && fleet.current_y==ad2460.outposts[o].y)	{
				title="Parked at outpost";
				imgsrc='images/icons/outpost_fleet_0.png';
				isAtMyOutpost=true;
			}
		}

		if (fleet.auto_def==1 && fleet.owner_id==ad2460.user_id)	{
			title="Outpost Defense Fleet";
			imgsrc='images/icons/outpost_fleet_0.png';
			isAtMyOutpost=true;
		}


		if (fleet.status==1){
			title="Taking on mined resources";
			imgsrc='images/icons/fill_fleet_0.png';
		}
		if (fleet.status==2){
			title="Charging jump-engines";
			imgsrc='images/icons/transit_fleet_0.png';
		}

		if (fleet.status==3){
			title="In combat";
			imgsrc='images/icons/combat_fleet_0.png';
		}

		if (fleet.status==4 && fleet.owner_id==ad2460.user_id){
			title="Defending ally";
			imgsrc='images/icons/alliance_fleet_3.png';
		}
		else if (fleet.status==4 && fleet.owner_id!=ad2460.user_id){
			title="Alliance defense";
			imgsrc='images/icons/alliance_fleet_inuse.png';


		}

		if (fleet.status==0 && fleet.last_hyperspace_jump_time>(ad2460.serverTime-600)){
			title="Charging jump-engines";
			imgsrc='images/icons/transit_fleet_0.png';
		}

		if (fleet.bank_fleet==1){
			title="The alliance bank-fleet";
			imgsrc='images/icons/bank_icon.png';
		}



		var returnObject={};
		returnObject.title=title;
		returnObject.imgsrc=imgsrc;

		return returnObject;
}

function returnCommanderRankNameObject(rank){
	var shortRank="";
	var longRank="";
	if (rank==0){ shortRank="Rct.";		longRank="Recruit";	}
	if (rank==1){ shortRank="2.Cmd.";	longRank="2nd Commander";	}
	if (rank==2){ shortRank="1.Cmd.";	longRank="1st Commander";	}
	if (rank==3){ shortRank="Cpt.";		longRank="Captain";	}
	if (rank==4){ shortRank="F.Maj.";	longRank="Fleet Major";	}
	if (rank==5){ shortRank="V.Mar.";	longRank="Vice Marshal";	}
	if (rank==6){ shortRank="F.Mar.";	longRank="Fleet Marshal";	}
	if (rank==7){ shortRank="V.Com.";	longRank="Vice Commodore";	}
	if (rank==8){ shortRank="C.Com.";	longRank="Chief Commodore";	}
	if (rank==9){ shortRank="M.Com.";	longRank="Master Commodore";	}
	if (rank==10){ shortRank="V.Adm.";	longRank="Vice Admiral";	}
	if (rank==11){ shortRank="Adm.";	longRank="Admiral";	}

	var returnObj={};
	returnObj.shortRank=shortRank;
	returnObj.longRank=longRank;
	returnObj.rank=rank;

	return returnObj;
}

function renderCommandersSummary(){
	// variables needed
	var commanders_count=0;
	var commanders_active=0;
	var commanders_inactive=0;
	var commanders_ship_capacity=0;
	var commanders_highest_rank=0;
	var commanders_war_academy_level=1;
	var commanders_recruits_available=0;

	var i=0;
	for (i=0;i<ad2460.myCommanders.length ;i++ ){
		var thisCommander=ad2460.myCommanders[i];
		if (thisCommander.hired>0 && thisCommander.dead==0){
			commanders_count++;
			commanders_ship_capacity+=returnStrengthLimit(thisCommander.rank);
		}
		else {
			if (thisCommander.dead==0){
				commanders_recruits_available++;
			}

		}

		if (thisCommander.fleet_id>0 && thisCommander.dead==0){
			commanders_active++;
		}
		else {
			if (thisCommander.hired>0 && thisCommander.dead==0){
				commanders_inactive++;
			}
		}

		if (thisCommander.rank>commanders_highest_rank && thisCommander.dead==0)	{
			if (thisCommander.hired>0){
				commanders_highest_rank=thisCommander.rank;
			}
		}
	}

	// Must check facilities for the war academy...
	var level1Academy=returnFacilityById(364);
	if (level1Academy.user_id>0){
		commanders_war_academy_level=1;
	}

	var level2Academy=returnFacilityById(365);
	if (level2Academy.user_id>0){
		commanders_war_academy_level=2;
	}

	var level3Academy=returnFacilityById(366);
	if (level3Academy.user_id>0){
		commanders_war_academy_level=3;
	}

	// That's pretty much it...
	// Time to render these numbers
	document.getElementById('commanders_count').innerHTML=''+commanders_count+'/'+ad2460.playerLevelMaxCommanders[ad2460.scores.level];
	document.getElementById('commanders_active').innerHTML=''+commanders_active;
	document.getElementById('commanders_inactive').innerHTML=''+commanders_inactive;
	document.getElementById('commanders_ship_capacity').innerHTML=prettyPrint(commanders_ship_capacity);
	document.getElementById('commanders_highest_rank').innerHTML=''+commanders_highest_rank;
	document.getElementById('commanders_war_academy_level').innerHTML=''+commanders_war_academy_level;
	document.getElementById('commanders_recruits_available').innerHTML=''+commanders_recruits_available;

	updateMilitaryOverview();
}

function returnCommanderPortraitSrc(commander){
	if (commander){
		return "images/fixed/commander180x217.jpg";
	}
	else {
		return "images/fixed/nocommanderselected.jpg";
	}
}

function updateAllianceFleetStatus(fleet_id,alliance_fleet_status){
	var thisFleet=returnFleetById(ad2460.fleetvars.selected_fleet_id);
	if (thisFleet){
		thisFleet.alliance_fleet=alliance_fleet_status;
	}
}

function renderCurrentOperations(){
	// ad2460.intel.missions.length
	removeChildNodes('spyMissions');
	var container=document.getElementById('spyMissions');
	var i=0;

	var entries=new Array;

	// temp store in entries to sort on ETA?
	// What about "recurring ETA"?
	// - Pending scout-missions
	// - Pending espionage-missions
	// - Pending infiltration-missions
	// - Ongoing infiltration-missions

	var active_intelligence=0;

	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		entries.push(ad2460.intel.missions[i]);
	}

	entries.sort(spyMissionsSort);
	entries.reverse();

	for (i=0;i<entries.length ;i++ ){
		var typeString="Undefined";
		var iconSrc="images/icons/intel_scout.png";

		if (entries[i].type=='scout'){
			typeString="Scout";
			iconSrc="images/icons/intel_scout.png";
		}
		if (entries[i].type=='espionage'){
			typeString="Espionage";
			iconSrc="images/icons/intel_spy.png";
		}
		if (entries[i].type=='infiltration'){
			typeString="Infiltration";
			iconSrc="images/icons/intel_infiltration.png";
		}
		if (entries[i].type=='spy-sweep'){
			typeString="Spy Sweep";
			iconSrc="images/icons/intel_spy.png";
		}
		if (entries[i].type=='infiltrator-sweep'){
			typeString="Infiltrator Sweep";
			iconSrc="images/icons/intel_infiltration.png";
		}

		var lineClass='evenline';
		if (i%2==0)	{
			lineClass='oddline';
		}

		var timestring=secondsToFullTimeNosecs(entries[i].next_report_timestamp-ad2460.serverTime);
		if (entries[i].next_report_timestamp-ad2460.serverTime<0){
			timestring='....';
		}

		var itemContainer=createSingleElement('div', 'tableselection '+lineClass, '', '', 'currentIntelMissionClick('+entries[i].mission_id+')');
		var targetName=createSingleElement('div', 'table_spy_target', '', entries[i].planet_name, '');
		var iconContainer=createSingleElement('div', 'table_fleet_type', '', '', '');
		var icon=createSingleElement('img', '', '', iconSrc, '');
		var typeDiv=createSingleElement('div', 'table_spy_type', '', typeString, '');
		var timeDiv=createSingleElement('div', 'table_spy_eta', '', timestring, '');

		itemContainer.appendChild(targetName);
		itemContainer.appendChild(iconContainer);
		iconContainer.appendChild(icon);
		itemContainer.appendChild(typeDiv);
		itemContainer.appendChild(timeDiv);

		container.appendChild(itemContainer);

		/*
		<div class="tableselection evenline">
			<div class="table_spy_target">Evon V</div>
			<div class="table_fleet_type" title="This fleet is at an outpost.">
				<img src="images/icons/outpost_fleet_1.png">
			</div>
			<div class="table_spy_type">Espionage</div>
			<div class="table_spy_eta">2h13m</div>
		</div>
		*/
	}
	checkScrollButtonStatus('spyMissions');

	// Add a hook to update the current selected planet if we have the systemview open ;)
	if (ad2460.starmap.systemView==1 && ad2460.starmap.currently_selected_planet_id>0){
		updateStarmapSelectedPlanetInfo();
	}

	var a=returnMaxAgents();
	// a.spies and a.infiltrators
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		if (ad2460.intel.missions[i].type=='espionage' || ad2460.intel.missions[i].type=='spy-sweep'){
			a.spies--;
		}
		if (ad2460.intel.missions[i].type=='infiltration' || ad2460.intel.missions[i].type=='infiltrator-sweep'){
			a.infiltrators--;
		}
	}
	if (a.spies==0){
		$("#anti_spy_button").addClass("disabled");
	}
	else{
		$("#anti_spy_button").removeClass("disabled");
	}
	if (a.infiltrators==0){
		$("#anti_infiltrator_button").addClass("disabled");
	}
	else{
		$("#anti_infiltrator_button").removeClass("disabled");
	}


}

function spyMissionsSort(a,b){
	if (a.next_report_timestamp>b.next_report_timestamp){
		return -1;
	}
	if (a.next_report_timestamp<b.next_report_timestamp){
		return 1;
	}
	return 0;
}

function spyReportsSort(a,b){
	if (a.timestamp>b.timestamp){
		return -1;
	}
	if (a.timestamp<b.timestamp){
		return 1;
	}
	return 0;
}

function renderIntelligenceLog(target_user_id, target_planet_name){
	// Function has two modes, one for a valid user-id higher than 0 and one for 0.
	var i=0;
	var panelIsOpen=false;
	for (i=0;i<ad2460.openPanels.length ;i++ ){
		if (ad2460.openPanels[i]=='intelligence_panel')	{
			panelIsOpen=true;
		}
	}
	if (panelIsOpen==true){
		//reduceFullInfoPanel('intelligence_panel');
	}

	myScrollToTop('spyLog');
	removeChildNodes('spyLog');

	ad2460.intel.last_log_view_param=target_user_id;
	ad2460.intel.last_log_view_param_2=target_planet_name;

	var container=document.getElementById('spyLog');

	container.style.display='none';

	var i=0;
	var entries=new Array;

	for (i=0;i<ad2460.intel.reports.length ;i++ ){
		//if(entries.length<50){
			entries.push(ad2460.intel.reports[i]);
		//}
	}

	entries.sort(spyReportsSort);

	var drawncounter=0;

	for (i=0;i<entries.length ;i++ ){
		if (drawncounter<50){
			if (target_user_id>0 && entries[i].planet_owner_id==target_user_id)	{
				drawncounter+=renderSingleIntLogEntry(entries[i]);
			}
			else if (!target_user_id)	{
				drawncounter+=renderSingleIntLogEntry(entries[i]);
			}
		}
	}

	//$("#single_infiltration_report").hide();
	$("#full_spy_log").delay(400).fadeIn(300);
	updateLiveAgentCounters();
	if (target_user_id>0){
		$("#intelligence_log_header").html("Intelligence-log for "+target_planet_name);
	}
	else {
		$("#intelligence_log_header").html("Full Intelligence-log");
	}

	container.style.display='block';

}

function renderSingleIntLogEntry(entry){
	var container=document.getElementById('spyLog');

	if (!entry){
		return;
	}

	var proceed=false;

	if (entry.type=='scout-report'){
		if (entry.user_id==ad2460.user_id && ad2460.intel.view_own_scouts==true){
			proceed=true;
		}
		if (entry.user_id!=ad2460.user_id && ad2460.intel.view_ally_scouts==true){
			proceed=true;
		}
	}
	if (entry.type=='espionage-report'){
		if (entry.user_id==ad2460.user_id && ad2460.intel.view_own_spies==true){
			proceed=true;
		}
		if (entry.user_id!=ad2460.user_id && ad2460.intel.view_ally_spies==true){
			proceed=true;
		}
	}
	if (entry.type=='infiltration-report'){
		if (entry.user_id==ad2460.user_id && ad2460.intel.view_own_infiltrators==true){
			proceed=true;
		}
		if (entry.user_id!=ad2460.user_id && ad2460.intel.view_ally_infiltrators==true){
			proceed=true;
		}
	}


	if (proceed==false){
		return 0;
	}

	var type="Undefined";
	var iconSrc="undefined.png";
	var shortString="Undefined type, unable to render properly.";

	if (entry.type=='scout-report'){
		type="Scout";
		iconSrc="intel_scout.png";
		shortString="My scout-report from "+entry.planet_name+".";
		if (entry.user_id!=ad2460.user_id){
			shortString="Allied scout-report from "+entry.planet_name+".";
			iconSrc="intel_scout_alliance.png";
		}
	}


	if (entry.type=='espionage-report'){
		type="Espionage";
		iconSrc="intel_spy.png";
		shortString="My espionage-report from "+entry.planet_name+".";
		if (entry.user_id!=ad2460.user_id){
			shortString="Allied espionage-report from "+entry.planet_name+".";
			iconSrc="intel_spy_alliance.png";
		}
	}
	if (entry.type=='infiltration-report'){
		type="Infiltration";
		iconSrc="intel_infiltration.png";
		shortString="My infiltration-report from "+entry.planet_name+".";
		if (entry.user_id!=ad2460.user_id){
			shortString="Allied infiltration-report from "+entry.planet_name+".";
			iconSrc="intel_infiltration_alliance.png";
		}
	}
	if (entry.type=='infiltration-report' && entry.mission_id==0){
		type="Infiltration";
		iconSrc="intel_infiltration.png";
		shortString="Captured infiltrator reported on "+entry.planet_name+".";
	}

/*  Oldschool
	var itemContainer=createSingleElement('div', 'fleetlog_entry spy_entry', '', '', '');
	var iconContainer=createSingleElement('div', 'fleetlog_icon', '', '', '');
	var icon=createSingleElement('img', '', '', 'images/icons/'+iconSrc, '');

	var subContainer=createSingleElement('div', 'fleetlog_content spy_content', '', '', '');
	var mainDescription=createSingleElement('span', '', '', shortString, '');
	var linkSpan=createSingleElement('span', 'fleetlog_timestamp report', '', 'View full report &gt;&gt;', 'ad2460.read_intel_reports.push('+entry.report_id+');updateSpyReportParentNodes(this);this.className+=" read_report";viewIntelReport('+entry.report_id+',-1,-1,-1,"intel")');

	//<div style="position:absolute;left:200px;color:red">Delete report</div>
	var timeSpan=createSingleElement('span', 'fleetlog_timestamp', '', formatDateTimeShort(convertToUTC(entry.timestamp)), '');
	timeSpan.innerHTML=formatShortMessageTimestamp(entry.timestamp);

*/

	var itemContainer=createSingleElement('div', 'fleetlog_entry intelbox', '', '', 'ad2460.read_intel_reports.push('+entry.report_id+');updateSpyReportParentNodes(this);this.className+=" read_report";viewIntelReport('+entry.report_id+',-1,-1,-1,"intel")');
	var iconContainer=createSingleElement('div', 'fleetlog_icon', '', '', '');
	var icon=createSingleElement('img', '', '', 'images/icons/'+iconSrc, '');

	var inteltype=createSingleElement('div', 'inteltype', '', type, '');
	var locationContainer=createSingleElement('div', 'intellocation', '', '', '');
	var locationImage=createSingleElement('img', '', '', 'images/planets/notification/planettype'+zeroPad(entry.world_type)+'.jpg', '');

	var intelOwnerName=createSingleElement('div', 'intel_owner_name_player', '', entry.planet_owner_name, '');

	if (entry.world_type==60 || entry.world_type==70){
		intelOwnerName.innerHTML=entry.planet_owner_alliance_name;
		intelOwnerName.className='intel_owner_name_alliance';
	}

	var intelName=createSingleElement('div', 'intel_planet_name', '', entry.planet_name, '');
	var inteltime=createSingleElement('div', 'intelbox_timestamp', '', formatShortMessageTimestamp(entry.timestamp), '');

	itemContainer.appendChild(iconContainer);
	iconContainer.appendChild(icon);

	itemContainer.appendChild(inteltype);

	itemContainer.appendChild(locationContainer);
	locationContainer.appendChild(locationImage);


	itemContainer.appendChild(intelOwnerName);
	itemContainer.appendChild(intelName);
	itemContainer.appendChild(inteltime);

	if (entry.user_id==ad2460.user_id){
		var delIcon=createSingleElement('img', '', '', 'images/fixed/cancel.png', 'deleteIntelReport('+entry.report_id+',event);');
		delIcon.style.position='absolute';
		delIcon.style.bottom='0px';

		itemContainer.appendChild(delIcon);

	}

	container.appendChild(itemContainer);

	/* Newschool

	<div class="fleetlog_entry intelbox">
		<div class="fleetlog_icon">
			<img src="images/icons/intel_scout.png">
		</div>
		<div class="inteltype">Espionage</div>
		<div class="intellocation">
			<img src="images/planets/notification/planettype12.jpg">
		</div>
		<div class="intel_planet_name">Makkapakka Prime</div>
		<div class="intelbox_timestamp">20m</div>
	</div>

	*/

	for (var r=0;r<ad2460.read_intel_reports.length ;r++ ){
		if (ad2460.read_intel_reports[r]==entry.report_id){
			itemContainer.className+=" read_report";
		}
	}

	if (ad2460.read_intel_reports.length>0){
		if (ad2460.read_intel_reports[ad2460.read_intel_reports.length-1]==entry.report_id)	{
			itemContainer.className+=" latestReadReport";
		}
	}

	return 1;
}

function updateSpyReportParentNodes(elm){
	// on the click that is!
	// here we should removeClass lastSelected from all fleetlog_content spy_content
	// and add it only to this one!
	$("#spyLog .latestReadReport").removeClass('latestReadReport');
	elm.className+=" latestReadReport";
}


function deleteIntelReport(report_id,event){
	//event.preventDefault();
	event.stopPropagation();
	$.post('actionhandler.pl', {action:'delete_intel_report',report_id:report_id}, function(data){ parseInfo(data);});
	var i=0;
	for (i=0;i<ad2460.intel.reports.length ;i++ ){
		if (ad2460.intel.reports[i].report_id==report_id){
			ad2460.intel.reports.splice(i,1);
			i--;
		}
	}
	renderIntelligenceLog(ad2460.intel.last_log_view_param,ad2460.intel.last_log_view_param_2 );
	return false;
}

function getIntelReportById(report_id){
	var i=0;
	for (i=0;i<ad2460.intel.reports.length ;i++ ){
		if (ad2460.intel.reports[i].report_id==report_id){
			return ad2460.intel.reports[i];
		}
	}
	return false;
}

function toggleIntelViewFilter(id){
	if (id==1){			ad2460.intel.view_own_scouts=!ad2460.intel.view_own_scouts;	}
	else if (id==2){	ad2460.intel.view_own_spies=!ad2460.intel.view_own_spies;	}
	else if (id==3){	ad2460.intel.view_own_infiltrators=!ad2460.intel.view_own_infiltrators;	}
	else if (id==4){	ad2460.intel.view_ally_scouts=!ad2460.intel.view_ally_scouts;	}
	else if (id==5){	ad2460.intel.view_ally_spies=!ad2460.intel.view_ally_spies;	}
	else if (id==6){	ad2460.intel.view_ally_infiltrators=!ad2460.intel.view_ally_infiltrators;	}

	updateIntelViewToggleButtons();

	renderIntelligenceLog(ad2460.intel.last_log_view_param, ad2460.intel.last_log_view_param_2);
}

function updateIntelViewToggleButtons(){
	if (ad2460.intel.view_own_scouts==true){		$("#intel_view_clicker_1").removeClass("square_red_small").addClass("square_blue_small");	}
	else {											$("#intel_view_clicker_1").removeClass("square_blue_small").addClass("square_red_small");	}

	if (ad2460.intel.view_own_spies==true){			$("#intel_view_clicker_2").removeClass("square_red_small").addClass("square_blue_small");	}
	else {											$("#intel_view_clicker_2").removeClass("square_blue_small").addClass("square_red_small");	}

	if (ad2460.intel.view_own_infiltrators==true){	$("#intel_view_clicker_3").removeClass("square_red_small").addClass("square_blue_small");	}
	else {											$("#intel_view_clicker_3").removeClass("square_blue_small").addClass("square_red_small");	}

	if (ad2460.intel.view_ally_scouts==true){		$("#intel_view_clicker_4").removeClass("square_red_small").addClass("square_blue_small");	}
	else {											$("#intel_view_clicker_4").removeClass("square_blue_small").addClass("square_red_small");	}

	if (ad2460.intel.view_ally_spies==true){		$("#intel_view_clicker_5").removeClass("square_red_small").addClass("square_blue_small");	}
	else {											$("#intel_view_clicker_5").removeClass("square_blue_small").addClass("square_red_small");	}

	if (ad2460.intel.view_ally_infiltrators==true){	$("#intel_view_clicker_6").removeClass("square_red_small").addClass("square_blue_small");	}
	else {											$("#intel_view_clicker_6").removeClass("square_blue_small").addClass("square_red_small");	}

}

function clearIntelReportDisplay(){
	document.getElementById("intel_report_type_location").innerHTML="N/A";
	document.getElementById("intel_report_target_coordinates").innerHTML="[]";
	document.getElementById("intel_report_planet_type").setAttribute("src","images/planets/outpost_planets/planettype10.jpg");
	removeChildNodes("recent_battles_container");
	$("#recent_battles_container").html("Only available in Infiltration-reports");
	document.getElementById("intel_report_present_strength").innerHTML="N/A";
	document.getElementById("intel_report_present_fleets").innerHTML="N/A";
	document.getElementById("intel_report_cannons").innerHTML="N/A";
	document.getElementById("intel_report_present_artillery").innerHTML="N/A";
	document.getElementById("intel_report_present_stations").innerHTML="N/A";
	document.getElementById("intel_report_present_frigates").innerHTML="N/A";
	document.getElementById("intel_report_present_cruisers").innerHTML="N/A";
	document.getElementById("intel_report_present_battleships").innerHTML="N/A";
	document.getElementById("intel_report_present_carriers").innerHTML="N/A";
	document.getElementById("intel_report_present_minors").innerHTML="N/A";

	document.getElementById("intel_report_own_hassium").innerHTML="N/A";
	document.getElementById("intel_report_own_strontium").innerHTML="N/A";
	document.getElementById("intel_report_own_neodymium").innerHTML="N/A";
	document.getElementById("intel_report_own_indium").innerHTML="N/A";

	document.getElementById("intel_report_alliance_hassium").innerHTML="N/A";
	document.getElementById("intel_report_alliance_strontium").innerHTML="N/A";
	document.getElementById("intel_report_alliance_neodymium").innerHTML="N/A";
	document.getElementById("intel_report_alliance_indium").innerHTML="N/A";

	document.getElementById("intel_report_owner_name").innerHTML="N/A";
	document.getElementById("intel_report_owner_alliance_name").innerHTML="N/A";
	document.getElementById("intel_report_present_strength").innerHTML="N/A";

	removeChildNodes("intel_report_outpost_list");
	$("#intel_report_outpost_list").html("Only available in Espionage and Infiltration-reports");

	document.getElementById("intel_report_owned_strength").innerHTML="N/A";
	document.getElementById("intel_report_owned_fleets").innerHTML="N/A";
	document.getElementById("intel_report_player_level").innerHTML="N/A";
	document.getElementById("intel_report_player_score_ranking").innerHTML="N/A";
	document.getElementById("intel_report_tech_tilt").innerHTML="N/A";
	document.getElementById("intel_report_owned_frigates").innerHTML="N/A";
	document.getElementById("intel_report_owned_cruisers").innerHTML="N/A";
	document.getElementById("intel_report_owned_battleships").innerHTML="N/A";
	document.getElementById("intel_report_owned_carriers").innerHTML="N/A";
	document.getElementById("intel_report_owned_minors").innerHTML="N/A";


	// Add the dummy-info here
	//$("#intel_report_bankers_container").innerHTML="<div class='planetspy_info_heading'>Alliance Info</div><div class='planetspy_info_title bold'>Bankers:</div><div class='planetspy_info_entry travel bold'>TT</div>	<div class='planetspy_info_entry str bold'>STR</div>";

	// removeChildNodes("intel_top_bankers_list");
	// $("#intel_top_bankers_list").html("<span>Only available in Infiltration-reports</span>");


	document.getElementById("intel_report_outpost_level").innerHTML="N/A";
	document.getElementById("intel_report_outpost_output").innerHTML="N/A";
	document.getElementById("intel_report_outpost_potential").innerHTML="N/A";
	document.getElementById("intel_report_outpost_resource_tilt").innerHTML="N/A";
	document.getElementById("intel_report_outpost_traveltime").innerHTML="N/A";

	// the default behaviour is to hide the alliance-stuff and the outpost-stuff alltogether
	$("#intel_report_alliance_section").hide();
	$("#intel_report_outpost_section").hide();
	// Just remember to show the right one for the selected report

}

function openLaunchIntel(){
	var p=ad2460.launchVars.planet;
	if (p!=false){
		viewIntelReport(0,p.planet_id, p.owner_id, p.alliance_id, 'launch')
	}

}

function viewIntelReport(report_id,planet_id, owner_id, alliance_id, open_from_source){
	//console.log("Showing intel-report id "+report_id+ ".");
	// The last 3 params is to support a generated report from returnLatestIntelReport



	if(open_from_source=='starmap'){
		$("#single_infiltration_report").css('left','273px');
	}
	else if(open_from_source=='intel'){
		$("#single_infiltration_report").css('left','121px');
	}
	else if(open_from_source=='launch'){
		$("#single_infiltration_report").css('left','316px');
	}

	else{
		$("#single_infiltration_report").css('left','422px');
	}

	var report=getIntelReportById(report_id);
	if (!report){
		report=returnLatestIntelReport(planet_id, owner_id, alliance_id);
	}
	if (!report){
		return false;
	}

	if (report.planet_id==-1 || report.planet_owner_id==-1){
		systemFeedback('Error','You need at least one scout-report on this planet before you can view any intel on it.', 1, 2);
		return;
	}

	ad2460.intel.selectedReport=report;

	clearIntelReportDisplay();

	var typeNameString="";

	if (report.type=='scout-report'){	typeNameString=translations.military_intel_report_type_scout+' : '+report.planet_name;	}
	if (report.type=='espionage-report'){	typeNameString=translations.military_intel_report_type_espionage+' : '+report.planet_name;	}
	if (report.type=='infiltration-report'){	typeNameString=translations.military_intel_report_type_infiltration+' : '+report.planet_name;	}

	if ( report.hasOwnProperty('scoutTimestamp') ) {
		if ( (report.scoutTimestamp>0 && report.espionageTimestamp>0) ||  (report.scoutTimestamp>0 && report.infiltrationTimestamp>0) || (report.infiltrationTimestamp>0 && report.espionageTimestamp>0) ){
			typeNameString='Combined Intel-report'+' : '+report.planet_name;
			report.type='infiltration-report';
		}
	}

	document.getElementById("intel_report_type_location").innerHTML=typeNameString;
	document.getElementById("intel_report_planet_type").setAttribute("src","images/planets/outpost_planets/planettype"+zeroPad(report.world_type)+".jpg");

	document.getElementById("intel_report_present_strength").innerHTML=prettyPrint(report.strength_present);
	document.getElementById("intel_report_present_fleets").innerHTML=prettyPrint(report.fleets_present);

	document.getElementById("intel_report_cannons").innerHTML=prettyPrint(report.present_cannons);
	document.getElementById("intel_report_present_shieldgens").innerHTML=prettyPrint(report.present_shieldgens);
	document.getElementById("intel_report_present_artillery").innerHTML=prettyPrint(report.present_artillery);
	document.getElementById("intel_report_present_stations").innerHTML=prettyPrint(report.present_stations);

	document.getElementById("intel_report_present_frigates").innerHTML=prettyPrint(report.present_frigates);
	document.getElementById("intel_report_present_cruisers").innerHTML=prettyPrint(report.present_cruisers);
	document.getElementById("intel_report_present_battleships").innerHTML=prettyPrint(report.present_battleships);
	document.getElementById("intel_report_present_carriers").innerHTML=prettyPrint(report.present_carriers);
	document.getElementById("intel_report_present_minors").innerHTML=prettyPrint(report.present_minors);

	document.getElementById("intel_report_own_hassium").innerHTML=prettyPrint(report.stored_hassium);
	document.getElementById("intel_report_own_strontium").innerHTML=prettyPrint(report.stored_strontium);
	document.getElementById("intel_report_own_neodymium").innerHTML=prettyPrint(report.stored_neodymium);
	document.getElementById("intel_report_own_indium").innerHTML=prettyPrint(report.stored_indium);

	document.getElementById("intel_report_owner_name").innerHTML=report.planet_owner_name;
	document.getElementById("intel_report_owner_name").setAttribute('onclick','zoomInToXY('+report.planet_owner_homeworld_x+','+report.planet_owner_homeworld_y+')');
	document.getElementById("intel_report_owner_alliance_name").innerHTML=report.planet_owner_alliance_name;
	if (report.planet_owner_alliance_id>0){
		document.getElementById("intel_report_owner_alliance_name").setAttribute('onclick','loadAllianceInfo('+report.planet_owner_alliance_id+')');
	}

	var obj=convertShortCoordsToLongCoords(report.planet_x, report.planet_y);
	document.getElementById("intel_report_target_coordinates").innerHTML=obj.coordString;
	document.getElementById("intel_report_target_coordinates").setAttribute('onclick','zoomInToXY('+report.planet_x+','+report.planet_y+')');

	if (report.type=='espionage-report' || report.type=='infiltration-report'){
		document.getElementById("intel_report_owned_strength").innerHTML=prettyPrint(report.owned_strength);
		document.getElementById("intel_report_owned_fleets").innerHTML=prettyPrint(report.owned_fleets);
		document.getElementById("intel_report_player_level").innerHTML=prettyPrint(report.player_level);
		document.getElementById("intel_report_player_score_ranking").innerHTML=prettyPrint(report.score_rank);

		var techTiltString=translations.general_unknown;
		if (report.tech_tilt=='Even'){
			techTiltString=translations.general_balanced;
		}
		if (report.tech_tilt=='Matter'){
			techTiltString=translations.general_matter;
		}
		if (report.tech_tilt=='Energy'){
			techTiltString=translations.general_energy;
		}
		if (report.tech_tilt=='Displacement'){
			techTiltString=translations.general_displacement;
		}

		document.getElementById("intel_report_tech_tilt").innerHTML=techTiltString;
		document.getElementById("intel_report_owned_frigates").innerHTML=prettyPrint(report.owned_frigates);
		document.getElementById("intel_report_owned_cruisers").innerHTML=prettyPrint(report.owned_cruisers);
		document.getElementById("intel_report_owned_battleships").innerHTML=prettyPrint(report.owned_battleships);
		document.getElementById("intel_report_owned_carriers").innerHTML=prettyPrint(report.owned_carriers);
		document.getElementById("intel_report_owned_minors").innerHTML=prettyPrint(report.owned_minors);

		removeChildNodes("intel_report_outpost_list");
		var outpostContainer=document.getElementById("intel_report_outpost_list");
		//report.outposts
		/*
		<div class="planetspy_info_title">Greppaloopi</div>
		<div class="planetspy_info_def">
			<img src="../images/icons/defense_beacon_select.png" height="15">
		</div>
		<div class="planetspy_info_entry coords">[ 12:08:14:2.1 ]</div>
		*/
		if (report.outposts!= '-1' && report.outposts!= 'Unknown' & report.outposts!=''){
			var outpostArray=report.outposts.split('||');
			var y=0;
			for (y=0;y<outpostArray.length ;y++ ){
				var dataArray=outpostArray[y].split('|');
				if (dataArray.length>1)	{
					var div1=createSingleElement('div','planetspy_info_title', '', ''+dataArray[0], '');
					var div2=createSingleElement('div','planetspy_info_def', '', ''+'', '');
					var def=dataArray[4];
					if (def==1){
						var img=createSingleElement('img','','','images/icons/defense_beacon_select.png','');
						img.style.height="15px";
						div2.appendChild(img);
					}
					var coordObject=convertShortCoordsToLongCoords(dataArray[2],dataArray[3]);
					var coordString='['+coordObject.coordString+']';
					var div3=createSingleElement('div','planetspy_info_entry coords', '', ''+coordString, 'zoomInToXY('+dataArray[2]+','+dataArray[3]+')');

					div1.style.cursor='default';
					div2.style.cursor='default';
					div3.style.cursor='pointer';

					outpostContainer.appendChild(div1);
					outpostContainer.appendChild(div2);
					outpostContainer.appendChild(div3);

				}
			}
		}
		else {
			outpostContainer.appendChild( createSingleElement('div','', '', 'No outposts found.', '') );
		}

	}

	if (report.type=='infiltration-report'){
		if (report.alliance_bank_hassium>-1){
			document.getElementById("intel_report_alliance_hassium").innerHTML=prettyPrint(report.alliance_bank_hassium);
			document.getElementById("intel_report_alliance_strontium").innerHTML=prettyPrint(report.alliance_bank_strontium);
			document.getElementById("intel_report_alliance_neodymium").innerHTML=prettyPrint(report.alliance_bank_neodymium);
			document.getElementById("intel_report_alliance_indium").innerHTML=prettyPrint(report.alliance_bank_indium);
		}
		else {
			document.getElementById("intel_report_alliance_hassium").innerHTML="N/A";
			document.getElementById("intel_report_alliance_strontium").innerHTML="N/A";
			document.getElementById("intel_report_alliance_neodymium").innerHTML="N/A";
			document.getElementById("intel_report_alliance_indium").innerHTML="N/A";
		}

		removeChildNodes("recent_battles_container");
		var battlesContainer=document.getElementById("recent_battles_container");
		if (report.last_5_combats != '' && report.last_5_combats != '-1' && report.last_5_combats != -1 && report.last_5_combats != "Unknown"){
			var battles=report.last_5_combats.split('||');
			var y=0;
			for (y=0;y<battles.length ;y++ ){
				var dataArray=battles[y].split('|');
				if (dataArray.length>1)	{
					var view_id=dataArray[0];
					var launch_timestamp=dataArray[1];
					var opponent=dataArray[2];
					var seconds_ago=ad2460.serverTime-launch_timestamp;

					if (view_id>0 && launch_timestamp>0){
						var entryContainer=createSingleElement('div','recent_battle_container', '', '', '');
						var div1=createSingleElement('div','recent_battle_vs', '', 'vs. ', '');
						var div2=createSingleElement('div','recent_battle_opponent', '', ''+opponent, '');
						var div3=createSingleElement('div','recent_battle_time', '', secondsToFullTime(seconds_ago), '');
						entryContainer.setAttribute("onclick","loadFirstDataForCombat("+view_id+")");
						entryContainer.appendChild(div1);
						entryContainer.appendChild(div2);
						entryContainer.appendChild(div3);
						battlesContainer.appendChild(entryContainer);
					}
				}
			}
		}
		else {
			battlesContainer.appendChild( createSingleElement('div','', '', 'No recent battles found.', ''));
		}

		/*
		removeChildNodes("intel_top_bankers_list");
		var bankersContainer=document.getElementById("intel_top_bankers_list");
		if (report.alliance_bankers != '' && report.alliance_bankers != '-1' && report.alliance_bankers != -1 && report.alliance_bankers != "Unknown"){
			var bankers=report.alliance_bankers.split('||');
			var y=0;
			for (y=0;y<bankers.length ;y++ ){
				var dataArray=bankers[y].split('|');
				if (dataArray.length>1)	{
					var name=dataArray[0];
					var strength=dataArray[1];
					var target_x=dataArray[2];
					var target_y=dataArray[3];
					var target_id=0;
					if (dataArray.length>3){
						target_id=dataArray[4];
					}
					var p1={x:target_x, y:target_y};
					var p2={x:ad2460.homeworld.x, y:ad2460.homeworld.y};

					var estimated_travel_time=calcEta(ad2460.homeworld.x, ad2460.homeworld.y, target_x, target_y, 1, false, false);
					var estimated_travel_time_string=secondsToFullTimeNosecs(estimated_travel_time);

					//var traveltime=returnTravelTimeInMinutesNew(1,p1,p2);

					if (name!='' && strength!=-1){
						var elmContainer=createSingleElement('div','banker_entry', '', '', 'loadPlayerInfo('+target_id+');return false;');
						var div1=createSingleElement('div','planetspy_info_title banker', '', ''+name, '');
						var div2=createSingleElement('div','planetspy_info_entry travel', '', ''+estimated_travel_time_string, '');
						var div3=createSingleElement('div','planetspy_info_entry str', '', prettyPrint(strength), '');

						div1.setAttribute("onclick","zoomInToXY("+target_x+","+target_y+")");

						elmContainer.appendChild(div1);
						elmContainer.appendChild(div2);
						elmContainer.appendChild(div3);
						bankersContainer.appendChild(elmContainer);
					}
				}
			}
		}
		*/


		// add bankers info

	}
	// Add the dummy-info here

	if (report.world_type==60){
		$("#intel_report_stored_res_container").hide();
		$("#intel_report_ally_res_container").hide();
	}
	else if (report.world_type==70){
		$("#intel_report_stored_res_container").hide();



		$("#intel_report_alliance_hassium").html(prettyPrint(report.stored_hassium));
		$("#intel_report_alliance_indium").html(prettyPrint(report.stored_indium));
		$("#intel_report_alliance_strontium").html(prettyPrint(report.stored_strontium));
		$("#intel_report_alliance_neodymium").html(prettyPrint(report.stored_neodymium));


		$("#intel_report_ally_res_container").show();
	}
	else {
		$("#intel_report_stored_res_container").show();
		$("#intel_report_ally_res_container").show();
	}

	if (report.world_type>10 && report.world_type<60){
		var calced_output=0+" u/h";
		var p1={x:report.planet_x, y:report.planet_y};
		var p2={x:ad2460.homeworld.x, y:ad2460.homeworld.y};

		var traveltime=returnTravelTimeInMinutesNew(1,p1,p2);
		var potential=return_output_potential(report.total_output);
		var potential_string=potential+'/10';
		var outputPercent=ad2460.outpostOutputPercentages[report.outpost_level];
		calced_output=parseInt(report.total_output*outputPercent/100);
		calced_output=prettyPrint(calced_output)+" u/h";


		document.getElementById("intel_report_outpost_level").innerHTML=report.outpost_level;
		document.getElementById("intel_report_outpost_output").innerHTML=calced_output;
		document.getElementById("intel_report_outpost_potential").innerHTML=potential_string;
		document.getElementById("intel_report_outpost_resource_tilt").innerHTML=returnResourceTiltString(report.world_type);
		document.getElementById("intel_report_outpost_traveltime").innerHTML=traveltime+" m";
	}


	// the default behaviour is to hide the alliance-stuff and the outpost-stuff alltogether
	$("#intel_report_alliance_section").hide();
	$("#intel_report_outpost_section").hide();
	// Just remember to show the right one for the selected report

	if (report.world_type>10 && report.world_type<60){
		$("#intel_report_outpost_section").show();
	}
	if (report.type=='infiltration-report'){
		$("#intel_report_alliance_section").show();
	}

	//$("#full_spy_log").hide();
	//showFullInfoPanel('intelligence_panel');
	$('#single_infiltration_report').fadeIn(300);
	//$("#single_infiltration_report").show();


	return;

}

function closeSingleIntelReport(){
	//$("#full_spy_log").show();
	$("#single_infiltration_report").hide();
	$("#full_spy_log").delay(400).fadeIn(300);
	//reduceFullInfoPanel('intelligence_panel');

}

function currentIntelMissionClick(mission_id){
	//console.log("Showing intel-mission id "+mission_id+ ".");
	var i=0;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		var selectedIntel=ad2460.intel.missions[i];
		if (selectedIntel.mission_id==mission_id){
			var allianceName='N/A';
			if (selectedIntel.planet_owner_alliance_id>0){
				var alliance=returnAllianceById(selectedIntel.planet_owner_alliance_id);
				if (alliance){
					allianceName=alliance.name;
				}
			}

			var timestring=secondsToFullTimeNosecs(selectedIntel.next_report_timestamp-ad2460.serverTime);
			if (selectedIntel.next_report_timestamp-ad2460.serverTime<0){
				timestring='....';
			}

			var typeString='';
			if (selectedIntel.type=='scout'){
				typeString=translations.military_intel_type_scout;
			}
			if (selectedIntel.type=='espionage'){
				typeString=translations.military_intel_type_espionage;
			}
			if (selectedIntel.type=='infiltration'){
				typeString=translations.military_intel_type_infiltration;
			}
			if (selectedIntel.type=='spy-sweep'){
				typeString=translations.military_intel_type_spy_sweep;
			}
			if (selectedIntel.type=='infiltrator-sweep'){
				typeString=translations.military_intel_type_infiltration_sweep;
			}


			document.getElementById('sel_intel_report_planet_name').innerHTML=selectedIntel.planet_name;
			document.getElementById('sel_intel_report_planet_name').setAttribute("onclick","zoomInToXY("+selectedIntel.x+","+selectedIntel.y+")");

			document.getElementById('sel_intel_report_owner_name').innerHTML=selectedIntel.owner_name;
			document.getElementById('sel_intel_report_alliance_name').innerHTML=allianceName;
			document.getElementById('sel_intel_report_mission_type').innerHTML=typeString;
			document.getElementById('sel_intel_report_detection_chance').innerHTML=selectedIntel.detection_chance+' %';
			document.getElementById('sel_intel_report_next_update_timestamp').innerHTML=timestring;
			var filename='planettype'+zeroPad(selectedIntel.world_type)+'.jpg';
			$("#intel_selected_mission_image").attr("src","images/planets/notification/"+filename);

			document.getElementById('abort_spy').setAttribute("onclick","abortIntelMission("+selectedIntel.mission_id+")");
			$("#abort_spy_container").show();

			renderIntelligenceLog(selectedIntel.planet_owner_id, selectedIntel.planet_name);
		}
	}
}

function abortIntelMission(mission_id){
	var i=0;
	var mission=false;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		if (ad2460.intel.missions[i].mission_id==mission_id){
			mission=ad2460.intel.missions[i];
		}
	}
	if (mission){
		$.post('actionhandler.pl', {action:'abort_intel_mission',mission_id:mission_id}, function(data){ parseInfo(data);});
	}
	else {
		loadAllIntel();
	}
}

function clearSelectedIntelMission(){
	document.getElementById('sel_intel_report_planet_name').innerHTML='No mission selected';
	document.getElementById('sel_intel_report_planet_name').setAttribute("onclick",null);
	document.getElementById('sel_intel_report_owner_name').innerHTML='-';
	document.getElementById('sel_intel_report_alliance_name').innerHTML='-';
	document.getElementById('sel_intel_report_mission_type').innerHTML='-';
	document.getElementById('sel_intel_report_detection_chance').innerHTML='-';
	document.getElementById('sel_intel_report_next_update_timestamp').innerHTML='-';
	$("#abort_spy_container").hide();
	document.getElementById('intel_selected_mission_image').src='images/planets/notification/notify_espionage.jpg';


}

function removeIntelMission(mission_id){
	var i=0;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		if (ad2460.intel.missions[i].mission_id==mission_id){
			ad2460.intel.missions.splice(i,1);
			i--;
		}
	}
}

function clearIntelMissions(){
	ad2460.intel.missions=new Array;

}
function clearIntelReports(){
	ad2460.intel.reports=new Array;
}

function loadCombatLogs(){

	$.post('actionhandler.pl', {action:'load_combat_log'}, function(data){ parseInfo(data);});
}

function addCombatLogEntry(launch_id ,  launcher_id ,  target_type ,  target_id ,  target_org_owner_id ,  target_x ,  target_y , launch_time ,  last_update ,  att_org_ship_count ,  att_org_firepower ,  def_org_ship_count ,  def_org_firepower ,  combat_id ,  attacker_nickname ,  attacker_alliance_name ,  attacker_alliance_image ,  attacking_commander_name ,  attacking_commander_rank ,  attacking_commander_image_id ,  attacking_commander_sex ,  defender_nickname ,  defender_alliance_name ,  defender_alliance_image ,  defending_commander_name ,  defending_commander_rank ,  defending_commander_image_id ,  defending_commander_sex ,  location_name    ,  location_planet_type ,  attacking_fighters ,  attacking_corvettes ,  attacking_utility ,  attacking_transports ,  attacking_fleets ,  attacking_capital_ships ,  attacking_strength ,  defending_fighters ,  defending_corvettes ,  defending_utility ,  defending_transports ,  defending_fleets ,  defending_capital_ships ,  defending_strength ,  defending_flak ,  defending_artillery ,  defending_shield_gens ,  defending_battle_stations ,  attacking_frigates ,  attacking_cruisers ,  attacking_battleships ,  attacking_carriers ,  defending_frigates ,  defending_cruisers ,  defending_battleships ,  defending_carriers ,  duration ,  result ,  outpost_takeover ,  att_fighters_lost ,  att_corvettes_lost ,  att_frigates_lost ,  att_cruisers_lost ,  att_battleships_lost ,  att_carriers_lost ,  att_utlity_lost ,  att_transports_lost ,  def_fighters_lost ,  def_corvettes_lost ,  def_frigates_lost ,  def_cruisers_lost ,  def_battleships_lost ,  def_carriers_lost ,  def_utlity_lost ,  def_transports_lost ,  def_flak_lost ,  def_artillery_lost ,  def_shield_gens_lost ,  def_battle_stations_lost, alliance_launch, taken_h, taken_n, taken_s, taken_i, att_xp, def_xp, attacking_commander_uniform, defending_commander_uniform, view_id, bonus_res){
	var i=0;
	for (i=0;i<ad2460.combatLogs.length ;i++ ){
		if (ad2460.combatLogs[i].launch_id==launch_id){
			return;
		}
	}
	ad2460.combatLogs.push(new combatLog(launch_id ,  launcher_id ,  target_type ,  target_id ,  target_org_owner_id ,  target_x ,  target_y , launch_time ,  last_update ,  att_org_ship_count ,  att_org_firepower ,  def_org_ship_count ,  def_org_firepower ,  combat_id ,  attacker_nickname ,  attacker_alliance_name ,  attacker_alliance_image ,  attacking_commander_name ,  attacking_commander_rank ,  attacking_commander_image_id ,  attacking_commander_sex ,  defender_nickname ,  defender_alliance_name ,  defender_alliance_image ,  defending_commander_name ,  defending_commander_rank ,  defending_commander_image_id ,  defending_commander_sex ,  location_name    ,  location_planet_type ,  attacking_fighters ,  attacking_corvettes ,  attacking_utility ,  attacking_transports ,  attacking_fleets ,  attacking_capital_ships ,  attacking_strength ,  defending_fighters ,  defending_corvettes ,  defending_utility ,  defending_transports ,  defending_fleets ,  defending_capital_ships ,  defending_strength ,  defending_flak ,  defending_artillery ,  defending_shield_gens ,  defending_battle_stations ,  attacking_frigates ,  attacking_cruisers ,  attacking_battleships ,  attacking_carriers ,  defending_frigates ,  defending_cruisers ,  defending_battleships ,  defending_carriers ,  duration ,  result ,  outpost_takeover ,  att_fighters_lost ,  att_corvettes_lost ,  att_frigates_lost ,  att_cruisers_lost ,  att_battleships_lost ,  att_carriers_lost ,  att_utlity_lost ,  att_transports_lost ,  def_fighters_lost ,  def_corvettes_lost ,  def_frigates_lost ,  def_cruisers_lost ,  def_battleships_lost ,  def_carriers_lost ,  def_utlity_lost ,  def_transports_lost ,  def_flak_lost ,  def_artillery_lost ,  def_shield_gens_lost ,  def_battle_stations_lost, alliance_launch, taken_h, taken_n, taken_s, taken_i, att_xp, def_xp, attacking_commander_uniform, defending_commander_uniform, view_id, bonus_res));
}

function clearCombatLog(){
	ad2460.combatLogs=new Array;
	removeChildNodes('combat_log_container');
}

function unrenderCombatLogList(){
	removeChildNodes('combat_log_container');
}

function renderCombatLogList(){
	removeChildNodes('combat_log_container');
	var parent=document.getElementById('combat_log_container');

	ad2460.combatLogs.sort(function(a, b){ return b.launch_time-a.launch_time });

	var i=0;

	for (i=0;i<ad2460.combatLogs.length ;i++ ){
		// create the dom-objects and place them in the parent!

		var lineClass='evenline';
		if (i%2==0)	{
			lineClass='oddline';
		}

		if (ad2460.militarysettings.selectedCombatLogId==ad2460.combatLogs[i].launch_id){
			lineClass+="_selected";
		}

		var item=ad2460.combatLogs[i];

		var timestamp=formatShortMessageTimestamp(item.launch_time);
		var opponent=item.attacker_nickname;
		if (item.launcher_id==ad2460.user_id){
			opponent=item.defender_nickname;
		}
		if (item.alliance_launch==true){
			opponent=item.defender_nickname;
		}
		var type='Att';

		var locationstring=item.location_name;

		var resultString="?";

		if (item.alliance_launch==false){
			if (ad2460.combatLogs[i].result==1 || ad2460.combatLogs[i].result==4){
				if (item.launcher_id==ad2460.user_id){
					resultString='W';
					lineClass+=" attlog";
					type='Att';
				}
				else {
					resultString='L';
					lineClass+=" deflog";
					type='Def';
				}
			}
			else if (ad2460.combatLogs[i].result==2 || ad2460.combatLogs[i].result==5){
				if (item.launcher_id==ad2460.user_id){
					resultString='L';
					lineClass+=" attlog";
					type='Att';
				}
				else {
					resultString='W';
					lineClass+=" deflog";
					type='Def';
				}

			}
			else if (ad2460.combatLogs[i].result==3){
				resultString='D';
				if (item.launcher_id==ad2460.user_id){
					lineClass+=" attlog";
					type='Att';
				}
				else {
					lineClass+=" deflog";
					type='Def';
				}
			}
		}
		else if (item.alliance_launch==true){
			// For now, we are always the attackers in these cases
			// that may change if we allow defending together, so beware then!
			if (ad2460.combatLogs[i].result==1 || ad2460.combatLogs[i].result==4){
				resultString='W';
				lineClass+=" allylog";
				type='A-A';
			}
			else {
				resultString='L';
				lineClass+=" allylog";
				type='A-A';
			}
		}

		var iconClass="";
		if (item.target_type=='Homeworld'){
			iconClass="homeworld";
		}
		if (item.target_type=='Outpost'){
			iconClass="outpost";
		}
		if (item.target_type=='Unknown'){
			iconClass="station";
		}
		if (item.target_type=='Wargame'){
			iconClass="wargame";
			type=' ';
		}

		var iconExtraClass="";
		if (item.alliance_launch==true){
			iconExtraClass="alliance_use";
		}

		var itemcontainer=createSingleElement('div','tableselection'+' '+lineClass, 'com_log_'+ad2460.combatLogs[i].view_id, '', 'selectCombatLog('+ad2460.combatLogs[i].view_id+')');
		var col1=createSingleElement('div','table_combat_log_timestamp', '', ''+timestamp, '');
		var col2=createSingleElement('div','table_combat_log_opponent', '', ''+opponent, '');
		var col2b=createSingleElement('div','table_combat_log_icon '+iconClass+' '+iconExtraClass, '', ''+type, '');
		var col3=createSingleElement('div','table_combat_log_location', '', ''+locationstring, '');
		var col4=createSingleElement('div','table_combat_log_outcome', '', resultString, '');

		itemcontainer.appendChild(col1);
		itemcontainer.appendChild(col2);
		itemcontainer.appendChild(col2b);
		itemcontainer.appendChild(col3);
		itemcontainer.appendChild(col4);

		parent.appendChild(itemcontainer);

		//<div class="tableselection evenline" id="show_selected_combat_log" onclick="loadFirstDataForCombat(69)">
		//	<div class="table_combat_log_timestamp">7d</div>
		//	<div class="table_combat_log_opponent">vs. Warmonger</div>
		//	<div class="table_combat_log_location">Bullshade</div>
		//	<div class="table_combat_log_outcome">Loss</div>
		//</div>

	}
	checkScrollButtonStatus('combat_log_container');
}

function selectCombatLog(view_id){
	var i=0;
	for (i=0;i<ad2460.combatLogs.length ;i++ ){
		if (ad2460.combatLogs[i].view_id==view_id){
			ad2460.militarysettings.selectedCombatLogId=view_id;

			$("#combat_log_container .evenline_selected").removeClass("evenline_selected").addClass("evenline");
			$("#combat_log_container .oddline_selected").removeClass("oddline_selected").addClass("oddline");

			if ($("#com_log_"+view_id).hasClass("evenline")){
				$("#com_log_"+view_id).addClass("evenline_selected");
			}
			else if ($("#com_log_"+view_id).hasClass("oddline")){
				$("#com_log_"+view_id).addClass("oddline_selected");
			}


			var thisLog=ad2460.combatLogs[i];

			var coords=convertShortCoordsToLongCoords(thisLog.target_x,thisLog.target_y);

			$('#sel_cl_location_name').html(thisLog.location_name);
			$('#sel_cl_att_name').html(thisLog.attacker_nickname);
			$('#sel_cl_def_name').html(thisLog.defender_nickname);
			$('#sel_cl_att_alliance_name').html(thisLog.attacker_alliance_name);
			$('#sel_cl_def_alliance_name').html(thisLog.defender_alliance_name);
			$('#sel_cl_att_cmd_rank').html(returnCommanderRankNameObject(thisLog.attacking_commander_rank).shortRank);
			$('#sel_cl_def_cmd_rank').html(returnCommanderRankNameObject(thisLog.defending_commander_rank).shortRank);
			$('#sel_cl_att_fleets').html(thisLog.attacking_fleets);
			$('#sel_cl_def_fleets').html(thisLog.defending_fleets);
			$('#sel_cl_att_ships').html(thisLog.attacking_capital_ships);
			$('#sel_cl_def_ships').html(thisLog.defending_capital_ships);
			// Waiting for summary to be completed!
			var attCapShipsLost=thisLog.att_battleships_lost+thisLog.att_carriers_lost+thisLog.att_cruisers_lost+thisLog.att_frigates_lost;
			var defCapShipsLost=thisLog.def_battleships_lost+thisLog.def_carriers_lost+thisLog.def_cruisers_lost+thisLog.def_frigates_lost;
			$('#sel_cl_att_losses').html(''+attCapShipsLost);
			$('#sel_cl_def_losses').html(''+defCapShipsLost);

			$('combat_log_att_result_big').html();
			$('combat_log_def_result_big').html();

			// Mind this bit, only support for female commander so far ;)

			// create some fake commander placeholders!
			var attCommander=new commander(1, 0, 1, "Unknown", "Unknown", 0, 0, 0, 0, thisLog.attacking_commander_rank, 0, 0, 0, thisLog.attacking_commander_image_id, thisLog.attacking_commander_sex, 0, 0, 0, thisLog.attacking_commander_uniform);
			var defCommander=new commander(1, 0, 1, "Unknown", "Unknown", 0, 0, 0, 0, thisLog.defending_commander_rank, 0, 0, 0, thisLog.defending_commander_image_id, thisLog.defending_commander_sex, 0, 0, 0, thisLog.defending_commander_uniform);
			var cmdImagesAtt=returnCommanderGraphics(attCommander);
			var cmdImagesDef=returnCommanderGraphics(defCommander);

			$('#cl_att_commander_bg').attr('src',cmdImagesAtt.bgImage);
			$('#cl_att_commander_uniform').attr('src',cmdImagesAtt.uniformImage);
			$('#cl_att_commander_head').attr('src',cmdImagesAtt.headImage);

			$('#cl_def_commander_bg').attr('src',cmdImagesDef.bgImage).show();
			$('#cl_def_commander_uniform').attr('src',cmdImagesDef.uniformImage).show();
			$('#cl_def_commander_head').attr('src',cmdImagesDef.headImage).show();

			if (thisLog.defending_commander_image_id==255){
				$('#cl_def_commander_bg').attr('src','images/commanders/station.jpg').show();
				$('#cl_def_commander_uniform').hide();
				$('#cl_def_commander_head').hide();
			}
			if (thisLog.defending_commander_image_id==200){
				$('#cl_def_commander_bg').attr('src','images/commanders/bankbattle.jpg').show();
				$('#cl_def_commander_uniform').hide();
				$('#cl_def_commander_head').hide();
			}

			var tmp=new Date;
			var timestring=formatDateTime(thisLog.launch_time+(tmp.getTimezoneOffset()*60));
			timestring=formatDateTime(convertToUTC(thisLog.launch_time));
			$('#sel_cl_timestamp').html(timestring);
			$('#sel_cl_location_coordinates').html('['+coords.coordString+']');
			document.getElementById('sel_cl_view_battle_button').setAttribute("onclick","loadFirstDataForCombat("+thisLog.view_id+")");

			var navilink='zoomInTo('+coords.q+','+coords.s+','+coords.g+','+coords.o+','+(coords.p)+')';
			document.getElementById('sel_cl_location_coordinates').setAttribute("onclick",''+navilink);
			//$('#sel_cl_view_battle_button').html('');
			if (thisLog.location_planet_type>0){
				var zeroPaddedPlanetType=zeroPad(thisLog.location_planet_type);
				document.getElementById('combat_log_bg_image').src='images/planets/planettype'+zeroPaddedPlanetType+'.png';
				$("#combat_log_bg_image").show();
			}
			else {
				$("#combat_log_bg_image").hide();
			}

			var total_att_ships=thisLog.attacking_frigates+thisLog.attacking_cruisers+thisLog.attacking_battleships+thisLog.attacking_carriers+thisLog.attacking_transports+thisLog.attacking_utility;
			var total_att_lost=thisLog.att_frigates_lost+thisLog.att_cruisers_lost+thisLog.att_battleships_lost+thisLog.att_carriers_lost+thisLog.att_transports_lost+thisLog.att_utlity_lost;

			var total_def_units=thisLog.defending_flak+thisLog.defending_artillery+thisLog.defending_shield_gens+thisLog.defending_battle_stations;
			var total_def_units_lost=thisLog.def_flak_lost+thisLog.def_artillery_lost+thisLog.def_shield_gens_lost+thisLog.def_battle_stations_lost;

			var total_def_ships=thisLog.defending_frigates+thisLog.defending_cruisers+thisLog.defending_battleships+thisLog.defending_carriers+thisLog.defending_transports+thisLog.defending_utility+total_def_units;
			var total_def_lost=thisLog.def_frigates_lost+thisLog.def_cruisers_lost+thisLog.def_battleships_lost+thisLog.def_carriers_lost+thisLog.def_transports_lost+thisLog.def_utlity_lost+total_def_units_lost;


			document.getElementById('cl_bs_att_frigates_total').innerHTML=thisLog.attacking_frigates;
			document.getElementById('cl_bs_att_frigates_lost').innerHTML=thisLog.att_frigates_lost;
			document.getElementById('cl_bs_att_cruisers_total').innerHTML=thisLog.attacking_cruisers;
			document.getElementById('cl_bs_att_cruisers_lost').innerHTML=thisLog.att_cruisers_lost;
			document.getElementById('cl_bs_att_battleships_total').innerHTML=thisLog.attacking_battleships;
			document.getElementById('cl_bs_att_battleships_lost').innerHTML=thisLog.att_battleships_lost;
			document.getElementById('cl_bs_att_carriers_total').innerHTML=thisLog.attacking_carriers;
			document.getElementById('cl_bs_att_carriers_lost').innerHTML=thisLog.att_carriers_lost;
			document.getElementById('cl_bs_att_transports_total').innerHTML=thisLog.attacking_transports;
			document.getElementById('cl_bs_att_transports_lost').innerHTML=thisLog.att_transports_lost;
			document.getElementById('cl_bs_att_utility_total').innerHTML=thisLog.attacking_utility;
			document.getElementById('cl_bs_att_utility_lost').innerHTML=thisLog.att_utlity_lost;
			document.getElementById('cl_bs_att_defenses_total').innerHTML='-';
			document.getElementById('cl_bs_att_defenses_lost').innerHTML='-';

			document.getElementById('cl_bs_def_frigates_total').innerHTML=thisLog.defending_frigates;
			document.getElementById('cl_bs_def_frigates_lost').innerHTML=thisLog.def_frigates_lost;
			document.getElementById('cl_bs_def_cruisers_total').innerHTML=thisLog.defending_cruisers;
			document.getElementById('cl_bs_def_cruisers_lost').innerHTML=thisLog.def_cruisers_lost;
			document.getElementById('cl_bs_def_battleships_total').innerHTML=thisLog.defending_battleships;
			document.getElementById('cl_bs_def_battleships_lost').innerHTML=thisLog.def_battleships_lost;
			document.getElementById('cl_bs_def_carriers_total').innerHTML=thisLog.defending_carriers;
			document.getElementById('cl_bs_def_carriers_lost').innerHTML=thisLog.def_carriers_lost;
			document.getElementById('cl_bs_def_transports_total').innerHTML=thisLog.defending_transports;
			document.getElementById('cl_bs_def_transports_lost').innerHTML=thisLog.def_transports_lost;
			document.getElementById('cl_bs_def_utility_total').innerHTML=thisLog.defending_utility;
			document.getElementById('cl_bs_def_utility_lost').innerHTML=thisLog.def_utlity_lost;
			document.getElementById('cl_bs_def_defenses_total').innerHTML=total_def_units;
			document.getElementById('cl_bs_def_defenses_lost').innerHTML=total_def_units_lost;

			document.getElementById('cl_bs_att_total').innerHTML=total_att_ships;
			document.getElementById('cl_bs_att_lost').innerHTML=total_att_lost;
			document.getElementById('cl_bs_def_total').innerHTML=total_def_ships;
			document.getElementById('cl_bs_def_lost').innerHTML=total_def_lost;

			document.getElementById('cl_bs_att_fighters_total').innerHTML=thisLog.attacking_fighters;
			document.getElementById('cl_bs_att_fighters_lost').innerHTML=thisLog.att_fighters_lost;
			document.getElementById('cl_bs_att_corvettes_total').innerHTML=thisLog.attacking_corvettes;
			document.getElementById('cl_bs_att_corvettes_lost').innerHTML=thisLog.att_corvettes_lost;

			document.getElementById('cl_bs_def_fighters_total').innerHTML=thisLog.defending_fighters;
			document.getElementById('cl_bs_def_fighters_lost').innerHTML=thisLog.def_fighters_lost;
			document.getElementById('cl_bs_def_corvettes_total').innerHTML=thisLog.defending_corvettes;
			document.getElementById('cl_bs_def_corvettes_lost').innerHTML=thisLog.def_corvettes_lost;
			document.getElementById('cl_bs_commander_details_text_container').innerHTML='';
			if (thisLog.target_type=='Outpost' && thisLog.outpost_takeover==1){
				document.getElementById('cl_bs_commander_details_text_container').innerHTML='! Outpost stolen !';
			}


			document.getElementById('cl_bs_stolen_h').innerHTML=prettyPrint(thisLog.taken_h);
			document.getElementById('cl_bs_stolen_i').innerHTML=prettyPrint(thisLog.taken_i);
			document.getElementById('cl_bs_stolen_s').innerHTML=prettyPrint(thisLog.taken_s);
			document.getElementById('cl_bs_stolen_n').innerHTML=prettyPrint(thisLog.taken_n);

			var bonus_res_per_type=Math.round(thisLog.bonus_res/4);

			document.getElementById('cl_bs_bonus_h').innerHTML=prettyPrint(bonus_res_per_type);
			document.getElementById('cl_bs_bonus_i').innerHTML=prettyPrint(bonus_res_per_type);
			document.getElementById('cl_bs_bonus_s').innerHTML=prettyPrint(bonus_res_per_type);
			document.getElementById('cl_bs_bonus_n').innerHTML=prettyPrint(bonus_res_per_type);


			document.getElementById('cl_bs_att_xp').innerHTML=prettyPrint(thisLog.att_xp);
			document.getElementById('cl_bs_def_xp').innerHTML=prettyPrint(thisLog.def_xp);


			if (thisLog.result==1 || thisLog.result==4)	{
				$("#combat_log_att_result_big").removeClass('combat_loss_col').addClass('combat_win_col').html("WIN");
				$("#combat_log_def_result_big").removeClass('combat_win_col').addClass('combat_loss_col').html("LOSE");
			}
			else if (thisLog.result==2 || thisLog.result==5)	{
				$("#combat_log_def_result_big").removeClass('combat_loss_col').addClass('combat_win_col').html("WIN");
				$("#combat_log_att_result_big").removeClass('combat_win_col').addClass('combat_loss_col').html("LOSE");
			}
			else if (thisLog.result==3)	{
				$("#combat_log_def_result_big").removeClass('combat_loss_col').removeClass('combat_win_col').html("DRAW");
				$("#combat_log_att_result_big").removeClass('combat_loss_col').removeClass('combat_win_col').html("DRAW");
			}

			document.getElementById('cl_share_container_1').setAttribute("onclick","shareCombat("+thisLog.view_id+")");
			document.getElementById('cl_share_container_2').setAttribute("onclick","linkCombat("+thisLog.view_id+")");
			$("#cl_share_container_1").show();
			$("#cl_share_container_2").show();
		}
	}

}

function viewCombat(view_id){
	hideSimpleBox();
	hideSimpleBoxLarge();

	loadFirstDataForCombat(view_id);
}

function addFleetLogEntry(fleet_id, timestamp, log_type, escort, alliance_usage, arrive_x, arrive_y, arrive_name, depart_x, depart_y, depart_name, midair_result){
	// Get the fleet
	var fleet=returnFleetById(fleet_id);
	if (fleet!=false){
		var i=0;
		for (i=0;i<fleet.log.length ;i++ ){
			if (fleet.log[i].timestamp==timestamp && fleet.log[i].log_type==log_type ){
				// Duplicate
				return true;
			}
		}

		fleet.log.push(new fleetLogEntry(fleet_id, timestamp, log_type, escort, alliance_usage, arrive_x, arrive_y, arrive_name, depart_x, depart_y, depart_name, midair_result));
	}
}

function goFromFleetToCommander(fleet_id){
	var fleet=returnFleetById(fleet_id);
	var commander=returnCommanderById(fleet.commander_id);
	if (commander){
		if (commander.fleet_id>0){
			closePanels();
			setTimeout('$("#commanders_main_panel").click()',900);
			setTimeout('commanderClick('+fleet.commander_id+')',1800);
		}
	}
}

function reassignSelectAll(){
	// Check if the ship-id exists in the global array holding the selected ship-ids
	// If it doesn't exist, add it and mark it visually
	// ad2460.fleetvars.selectedFleetReassignArray

	var elements=document.getElementsByClassName('shipreassignselect');
	for (i=0;i<elements.length ;i++ ){
		elm=elements[i];
		var id=parseInt(elements[i].id.replace('reassignSingleShip',''));
		var found=-1;
		for (x=0;x<ad2460.fleetvars.selectedFleetReassignArray.length ;x++ ){
			if (ad2460.fleetvars.selectedFleetReassignArray[x]==id){
				found=x;
			}
		}
		if (found==-1){
			ad2460.fleetvars.selectedFleetReassignArray.push(id);
			$("#reassignSingleShip"+id).addClass("assignSelectedGlow");
		}
	}
}

function reassignSelectNone(){
	// Check if the ship-id exists in the global array holding the selected ship-ids
	// If it doesn't exist, add it and mark it visually
	// ad2460.fleetvars.selectedFleetReassignArray

	var elements=document.getElementsByClassName('shipreassignselect');
	for (i=0;i<elements.length ;i++ ){
		elm=elements[i];
		var id=parseInt(elements[i].id.replace('reassignSingleShip',''));
		var found=-1;
		for (x=0;x<ad2460.fleetvars.selectedFleetReassignArray.length ;x++ ){
			if (ad2460.fleetvars.selectedFleetReassignArray[x]==id){
				found=x;
			}
		}
		if (found>-1){
			$("#reassignSingleShip"+id).removeClass("assignSelectedGlow");
			ad2460.fleetvars.selectedFleetReassignArray.splice(found,1);
		}
	}
}


function reassignSelectPercentDynamic(){
	var percent=parseInt($("#reassign_number_input").val());
	if (percent<0){	percent=0;	}
	if (percent>100){	percent=100;	}

	//console.log(percent);

	reassignSelectPercent(percent);
}

function reassignSelectShipsDynamic(){
	var ships=parseInt($("#reassign_ship_count_text_ships").val());
	if (ships<0){
		ships=0;
	}
	reassignSelectShips(ships);
}

function reassignSelectShips(ships){
	reassignSelectNone(); // clearing everything
	var selectedNum=0;
	var elements=document.getElementsByClassName('shipreassignselect');
	var myNum=ships;

	for (i=0;i<elements.length ;i++ ){
		elm=elements[i];
		var id=parseInt(elements[i].id.replace('reassignSingleShip',''));
		var found=-1;
		for (x=0;x<ad2460.fleetvars.selectedFleetReassignArray.length ;x++ ){
			if (ad2460.fleetvars.selectedFleetReassignArray[x]==id){
				found=x;
			}
		}
		if (found==-1 && selectedNum<myNum){
			ad2460.fleetvars.selectedFleetReassignArray.push(id);
			$("#reassignSingleShip"+id).addClass("assignSelectedGlow");
			selectedNum++;
		}
	}

	updateReassignNumbersShips();
}


function reassignSelectPercent(percent){
	// ad2460.fleetvars.selectedFleetReassignArray
	if(percent<0){
		percent=0;
	}
	if(percent>100){
		percent=100;
	}

	reassignSelectNone(); // clearing everything

	var selectedNum=0;
	var elements=document.getElementsByClassName('shipreassignselect');
	var myNum=Math.floor(elements.length*percent/100);

	// It's cleared!

	for (i=0;i<elements.length ;i++ ){
		elm=elements[i];
		var id=parseInt(elements[i].id.replace('reassignSingleShip',''));
		var found=-1;
		for (x=0;x<ad2460.fleetvars.selectedFleetReassignArray.length ;x++ ){
			if (ad2460.fleetvars.selectedFleetReassignArray[x]==id){
				found=x;
			}
		}
		if (found==-1 && selectedNum<myNum){
			ad2460.fleetvars.selectedFleetReassignArray.push(id);
			$("#reassignSingleShip"+id).addClass("assignSelectedGlow");
			selectedNum++;
		}
	}

	$("#reassign_number_input").val(""+percent);

	updateReassignNumbers();
}

function updateReassignNumbersShips(){
	var shipcount=ad2460.fleetvars.selectedFleetReassignArray.length;
	var shiptype=ad2460.fleetvars.selectedFleetReassignShipType;

	var strength=0;

	if (shiptype>0){
		strength+=(shipToStrength(shiptype)*shipcount);
	}

	//$("#reassign_ship_count_text").html("Units: "+shipcount);
	$("#reassign_strength_count_text").html("Str:"+prettyPrint(strength));

}

function updateReassignNumbers(){
	var shipcount=ad2460.fleetvars.selectedFleetReassignArray.length;
	var shiptype=ad2460.fleetvars.selectedFleetReassignShipType;

	var strength=0;

	if (shiptype>0){
		strength+=(shipToStrength(shiptype)*shipcount);
	}

	$("#reassign_ship_count_text").html("Units:"+shipcount);
	$("#reassign_strength_count_text").html("Str:"+prettyPrint(strength));


}

function targetSearchClick(){
	var alliance_name=$("#target_search_aname").val();
	var bounty=$("#target_search_bounty").val();
	var distance=$("#target_search_distance").val();
	var quadrant=$("#target_search_quadrant").val();
	var strength=$("#target_search_strength").val();

	$.post('actionhandler.pl', {action:'target_search',alliance_name:alliance_name, bounty:bounty, distance:distance, quadrant:quadrant, strength:strength}, function(data){ parseInfo(data);});
}

function targetSearchClickSpecial(){
	var alliance_name=$("#target_search_aname").val();
	var bounty=$("#target_search_bounty").val();
	var distance=$("#target_search_distance").val();
	var quadrant=$("#target_search_quadrant").val();
	var strength=$("#target_search_strength").val();

	$.post('actionhandler.pl', {action:'target_search_special',alliance_name:alliance_name, bounty:bounty, distance:distance, quadrant:quadrant, strength:strength}, function(data){ parseInfo(data);});
}

function targetSearchClickOutposts(){
	var alliance_name=$("#target_search_aname").val();
	var bounty=$("#target_search_bounty").val();
	var distance=$("#target_search_distance").val();
	var quadrant=$("#target_search_quadrant").val();
	var strength=$("#target_search_strength").val();

	$.post('actionhandler.pl', {action:'target_search_outposts',alliance_name:alliance_name, bounty:bounty, distance:distance, quadrant:quadrant, strength:strength}, function(data){ parseInfo(data);});
}

function setTargetSearchColumnTexts(type){
	if (type==1)	{
		$("#target_search_col_1").html("Name");
		$("#target_search_col_2").html("Alliance");
		$("#target_search_col_3").html("Strength");
		$("#target_search_col_4").html("Travel");
		$("#target_search_col_5").html("");
	}
	else if (type==2)	{
		$("#target_search_col_1").html("Owner");
		$("#target_search_col_2").html("Alliance");
		$("#target_search_col_3").html("Strength");
		$("#target_search_col_4").html("Pot");
		$("#target_search_col_5").html("T");
	}
	else {
		$("#target_search_col_1").html("Player");
		$("#target_search_col_2").html("Alliance");
		$("#target_search_col_3").html("Strength");
		$("#target_search_col_4").html("Lvl");
		$("#target_search_col_5").html("Bty");

	}
}

function clearTargetSearchData(){
	ad2460.targetSearch=new Array;
	myScrollToTop('target_search_container',0);
}

function unrenderTargetSearchResults(){
	removeChildNodes('target_search_container');
	myScrollToTop('target_search_container',0);
}

function addTargetSearchEntry(user_id, nickname, alliance_id , alliance_name, strength, level, planet_id, x, y, planet_name, bounty, world_type ) {
	ad2460.targetSearch.push({user_id:user_id,nickname:nickname,alliance_id:alliance_id,alliance_name:alliance_name, strength:strength, level:level, planet_id:planet_id, x:x, y:y, planet_name:planet_name, bounty:bounty, world_type:world_type});
}

function resStrToSortOrder(resStr){
	if (resStr=='N/A')	{ return 0;	}
	if (resStr=='Hs')	{ return 1;	}
	if (resStr=='In')	{ return 2;	}
	if (resStr=='Sr')	{ return 3;	}
	if (resStr=='Nd')	{ return 4;	}
	if (resStr=='Hs + In')	{ return 5;	}
	if (resStr=='Hs + Sr')	{ return 6;	}
	if (resStr=='Hs + Nd')	{ return 7;	}
	if (resStr=='In + Hs')	{ return 8;	}
	if (resStr=='In + Sr')	{ return 9;	}
	if (resStr=='In + Nd')	{ return 10;	}
	if (resStr=='Sr + Hs')	{ return 11;	}
	if (resStr=='Sr + In')	{ return 12;	}
	if (resStr=='Sr + Nd')	{ return 13;	}
	if (resStr=='Nd + Hs')	{ return 14;	}
	if (resStr=='Nd + In')	{ return 15;	}
	if (resStr=='Nd + Sr')	{ return 16;	}

	return 100;

}

function sortTargetSearch(parameter){
	if (ad2460.targetSearch.length>0){
		// Reset
		ad2460.targetSearch.sort(function(a, b){ return b.planet_id-a.planet_id});

		// need support for travel-time sort!
		if (parameter == 'level' && ad2460.targetSearch[0].world_type>=60){
			// step through them and add a travel-time entry for all of them
			var t=0;
			for (t=0;t<ad2460.targetSearch.length ;t++ ){
				var tt=calcEta(ad2460.targetSearch[t].x, ad2460.targetSearch[t].y, ad2460.homeworld.x, ad2460.homeworld.y, 1, false, false);
				ad2460.targetSearch[t].tt=tt;
			}
			ad2460.targetSearch.sort(function(a, b){ return a.tt-b.tt});

		}
		else if (parameter=='strength' && ad2460.targetSearch[0].world_type>=60){
			ad2460.targetSearch.sort(function(a, b){ return b.strength-a.strength});
		}
		else if (parameter=='strength' && ad2460.targetSearch[0].world_type>10){
			//console.log('this');
			ad2460.targetSearch.sort(function(a, b){ return b.strength-a.strength});
		}
		else if (parameter=='nickname' && ad2460.targetSearch[0].world_type>=60){
			ad2460.targetSearch.sort(function(a, b){ return a.planet_name.localeCompare(b.planet_name)});
		}
		else if (parameter=='nickname' && ad2460.targetSearch[0].world_type>10){
			ad2460.targetSearch.sort(function(a, b){ return a.nickname.localeCompare(b.nickname)});
		}
		else if (parameter=='nickname'){
			ad2460.targetSearch.sort(function(a, b){ return a.nickname.localeCompare(b.nickname)});
		}
		else if (parameter=='alliance'){
			ad2460.targetSearch.sort(function(a, b){ return a.alliance_name.localeCompare(b.alliance_name)});
		}
		else if (parameter=='strength'){
			ad2460.targetSearch.sort(function(a, b){ return a.strength-b.strength});
		}
		else if (parameter=='level'  && ad2460.targetSearch[0].world_type<60 && ad2460.targetSearch[0].world_type>10){
			ad2460.targetSearch.sort(function(a, b){
				if (b.level < a.level) return -1;
				if (b.level > a.level) return 1;
				if (a.resSortNum < b.resSortNum) return -1;
				if (a.resSortNum > b.resSortNum) return 1;
				return 0;
			});
		}
		else if (parameter=='level'){
			ad2460.targetSearch.sort(function(a, b){ return a.level-b.level});
		}
		else if (parameter=='bounty'&& ad2460.targetSearch[0].world_type<60 && ad2460.targetSearch[0].world_type>10){
			assignResSortNums();
			ad2460.targetSearch.sort(function(a, b){
				// return a.resSortNum-b.resSortNum;
				if (a.resSortNum < b.resSortNum) return -1;
				if (a.resSortNum > b.resSortNum) return 1;
				if (b.level < a.level) return -1;
				if (b.level > a.level) return 1;
				return 0;
			});
		}
		else if (parameter=='bounty'){
			ad2460.targetSearch.sort(function(a, b){ return b.world_type-a.world_type});
		}
		else if (parameter=='world_type'){
			ad2460.targetSearch.sort(function(a, b){ return a.world_type-b.world_type});
		}

		unrenderTargetSearchResults();
		renderTargetSearchResult();
	}
}

function assignResSortNums(){
	for (var i=0;i<ad2460.targetSearch.length ;i++ ){
		var resStr=returnResourceTiltString(ad2460.targetSearch[i].world_type);
		ad2460.targetSearch[i].resSortNum=resStrToSortOrder(resStr);
	}
}

function renderTargetSearchResult(){
	var parent=document.getElementById('target_search_container');

	var i=0;
	for (i=0;i<ad2460.targetSearch.length ;i++ ){
		var target_json=JSON.stringify(ad2460.targetSearch[i]);
		//var target_string=ad2460.targetSearch[i].planet_id+','+ad2460.targetSearch[i].user_id+','+ad2460.targetSearch[i].alliance_id;
		var rowclass='tableselection ';
		if (i%2==0){
			rowclass+='evenline';
		}
		else {
			rowclass+='oddline';
		}
		var container=createSingleElement('div', rowclass, '', '', 'selectTargetSearchEntry('+target_json+')');

		var div1;
		var div2;
		var div3;
		var div4;
		var div5;

		if (ad2460.targetSearch[i].world_type<=10){
			div1=createSingleElement('div', 'table_target_search_player', '', ad2460.targetSearch[i].nickname, '');
			div2=createSingleElement('div', 'table_target_search_alliance', '', ad2460.targetSearch[i].alliance_name, '');
			div3=createSingleElement('div', 'table_target_search_strength', '', prettyPrint(ad2460.targetSearch[i].strength), '');
			div4=createSingleElement('div', 'table_target_search_level', '', ad2460.targetSearch[i].level, '');
			div5=createSingleElement('div', 'table_target_search_bounty', '', ''+ad2460.targetSearch[i].bounty, '');

			container.appendChild(div1);
			container.appendChild(div2);
			container.appendChild(div3);
			container.appendChild(div4);
			container.appendChild(div5);
		}
		else if (ad2460.targetSearch[i].world_type<60){
			div1=createSingleElement('div', 'table_target_search_player', '', ad2460.targetSearch[i].nickname, '');
			div2=createSingleElement('div', 'table_target_search_alliance', '', ad2460.targetSearch[i].alliance_name, '');
			div3=createSingleElement('div', 'table_target_search_strength', '', prettyPrint(ad2460.targetSearch[i].strength), '');
			div4=createSingleElement('div', 'table_target_search_level', '', ad2460.targetSearch[i].level, '');
			div5=createSingleElement('div', 'table_target_search_bounty', '', '', '');

			var resStr=returnResourceTiltString(ad2460.targetSearch[i].world_type);
			var resImgs=resourceTiltStringToImages(resStr);

			for (var a=0;a<resImgs.length ;a++ ){
				div5.appendChild(resImgs[a]);
			}

			container.appendChild(div1);
			container.appendChild(div2);
			container.appendChild(div3);
			container.appendChild(div4);
			container.appendChild(div5);
		}

		else {
			div1=createSingleElement('div', 'table_target_search_player tsbg'+ad2460.targetSearch[i].world_type, '', ad2460.targetSearch[i].planet_name, '');
			div2=createSingleElement('div', 'table_target_search_alliance', '', ad2460.targetSearch[i].alliance_name, '');
			var str=ad2460.targetSearch[i].strength;
			if (str==-1){
				str=returnLatestIntelReport(ad2460.targetSearch[i].planet_id,-1,-1).strength_present;
			}
			if (str==-1){
				str='--';
			}
			div3=createSingleElement('div', 'table_target_search_strength', '', prettyPrint(str), '');
			var tt=secondsToFullTimeNosecs(calcEta(ad2460.targetSearch[i].x, ad2460.targetSearch[i].y, ad2460.homeworld.x, ad2460.homeworld.y,1,false,false));
			div4=createSingleElement('div', 'table_target_search_level', '', tt, '');

			div4.style.width='52px';

			container.appendChild(div1);
			container.appendChild(div2);
			container.appendChild(div3);
			container.appendChild(div4);

		}

		parent.appendChild(container);
	}
	checkScrollButtonStatus('target_search_container');


}

function selectTargetSearchEntry(target_json){
	var target = eval(target_json);

	//var intel=returnLatestIntelReport(target.planet_id, target.user_id, target.alliance_id);
	var intel=returnLatestIntelReport(target.planet_id, target.user_id, null);
	var coords=convertShortCoordsToLongCoords(target.x,target.y);

	target.nickname=target.nickname.substring(0, 20);
	target.alliance_name=target.alliance_name.substring(0, 20);

	//console.log(target);
	//var latest=returnLatestIntelReport(target.planet_id, target.user_id, target.alliance_id);
	var latest=returnLatestIntelReport(target.planet_id, target.user_id, null);

	// images/icons/buttons/buildinfo_button_slot2_icon.png


	if (target.alliance_id>0){
		$("#target_search_infopanel_header").html("<span class='' style='color:#FFE868;cursor:pointer;' onclick='loadPlayerInfo("+target.user_id+")'>"+target.nickname+"</span> of <span class='' style='color:cyan;cursor:pointer;' onclick='loadAllianceInfo("+target.alliance_id+")'>"+target.alliance_name+"</span>");
	}
	else {
		$("#target_search_infopanel_header").html("<span class='' style='color:#FFE868' onclick='loadPlayerInfo("+target.user_id+")'>"+target.nickname+"</span>");
	}

	$("#target_search_infopanel_header").css('fontSize','14px');

	if (target.nickname.length+target.alliance_name.length > 30){
		$("#target_search_infopanel_header").css('fontSize','13px');
	}

	if (target.nickname.length+target.alliance_name.length > 35){
		$("#target_search_infopanel_header").css('fontSize','12px');
	}

	$("#target_search_infopanel_header" ).append( "<img id='ts_scout_icon' class='ts_scout_icon' onclick='initiateDirectScout("+target.x+","+target.y+")' title='Scout target' src='images/icons/production/430.jpg'>" );
	if (target.world_type<11){
		$("#target_search_infopanel_header" ).append( "<img id='ts_spy_icon' class='ts_spy_icon' onclick='initiateDirectSpy("+target.x+","+target.y+")' src='images/fixed/espionage_icon.png' title='Send spy'>" );
	}

	for (var m=0;m<ad2460.intel.missions.length ;m++ ){
		if (ad2460.intel.missions[m].x==target.x && ad2460.intel.missions[m].y==target.y){
			if (ad2460.intel.missions[m].type=='scout'){
				$("#ts_scout_icon").css("border", "cyan solid 2px");

			}
			else if (ad2460.intel.missions[m].type=='espionage'){
				$("#ts_spy_icon").css("border", "cyan solid 2px");

			}

		}
	}

	$("#target_search_infopanel_coordsdiv").html("<span style='color:#FFC843'>"+target.planet_name+"</span> <span style='color:white;'>at</span> "+coords.coordString);
	$("#target_search_infopanel_coordsdiv").attr("onclick","zoomInToXY("+target.x+","+target.y+")");


	if (intel==false){
		$('#target_search_infopanel_content').html("No recent intel found");
		return;
	}

	$('#target_search_infopanel_content').html("");
	// cleared!

	var lcontainer=createSingleElement('div', '', 'target_search_infopanel_left', '', '');
	var rcontainer=createSingleElement('div', '', 'target_search_infopanel_right', '', '');

	var parent=document.getElementById('target_search_infopanel_content');
	parent.appendChild(lcontainer);
	parent.appendChild(rcontainer);

	// left container first!

	var heading1=createSingleElement('div', 'target_search_info_heading', '', 'Military details', '');
	//heading1.setAttribute("onclick","viewIntelReport("+latest.report_id+","+target.planet_id+", "+target.user_id+", "+target.alliance_id+", 'intel');");

	var infoIcon=createSingleElement('img', 'target_search_intel_icon', '', 'images/icons/buttons/buildinfo_button_slot2_icon.png', '');
	//infoIcon.setAttribute("onclick","viewIntelReport("+latest.report_id+","+target.planet_id+", "+target.user_id+", "+target.alliance_id+", 'intel');");
	infoIcon.setAttribute("onclick","viewIntelReport("+latest.report_id+","+target.planet_id+", "+target.user_id+", null, 'intel');");

	heading1.appendChild(infoIcon);

	lcontainer.appendChild(heading1);

	//if (intel.type=='scout-report'){
		if (intel.strength_present>-1){
			var title=createSingleElement('div', 'target_search_info_title', '', 'Present strength', '');
			var entry=createSingleElement('div', 'target_search_info_entry', '', prettyPrint(intel.strength_present), '');
			lcontainer.appendChild(title);
			lcontainer.appendChild(entry);
		}
		if (intel.fleets_present>-1){
			var title=createSingleElement('div', 'target_search_info_title', '', 'Present fleets', '');
			var entry=createSingleElement('div', 'target_search_info_entry', '', prettyPrint(intel.fleets_present), '');
			lcontainer.appendChild(title);
			lcontainer.appendChild(entry);
		}
		var present_capital_units=intel.present_artillery+intel.present_cannons+intel.present_stations+intel.present_frigates+intel.present_cruisers+intel.present_battleships+intel.present_carriers;
		var present_minor_units=intel.present_minors;

		var presentCapitalUnitsString="Unknown";
		if (present_capital_units>-1){
			presentCapitalUnitsString=prettyPrint(present_capital_units);
		}
		var presentMinorUnitsString="Unknown";
		if (present_minor_units>-1){
			presentMinorUnitsString=prettyPrint(present_minor_units);
		}

		var title=createSingleElement('div', 'target_search_info_title', '', 'Present cap. units', '');
		var entry=createSingleElement('div', 'target_search_info_entry', '', presentCapitalUnitsString, '');
		lcontainer.appendChild(title);
		lcontainer.appendChild(entry);
		var title=createSingleElement('div', 'target_search_info_title', '', 'Present min. units', '');
		var entry=createSingleElement('div', 'target_search_info_entry', '', presentMinorUnitsString, '');
		lcontainer.appendChild(title);
		lcontainer.appendChild(entry);
	//}

	if (intel.capital_ships_owned>-1){
		var capitals_owned_title=createSingleElement('div', 'target_search_info_title', '', 'Capital ships', '');
		var capitals_owned_entry=createSingleElement('div', 'target_search_info_entry', '', ''+intel.capital_ships_owned, '');
		lcontainer.appendChild(capitals_owned_title);
		lcontainer.appendChild(capitals_owned_entry);
	}
	if (intel.firepower_owned>-1){
		var ship_strength_title=createSingleElement('div', 'target_search_info_title', '', 'Ship strength', '');
		var ship_strength_entry=createSingleElement('div', 'target_search_info_entry', '', ''+prettyPrint(intel.firepower_owned), '');
		lcontainer.appendChild(ship_strength_title);
		lcontainer.appendChild(ship_strength_entry);
	}
	if (intel.defensive_unit_count>-1){
		var def_owned_title=createSingleElement('div', 'target_search_info_title', '', 'Defensinve units', '');
		var def_owned_entry=createSingleElement('div', 'target_search_info_entry', '', ''+intel.defensive_unit_count, '');
		lcontainer.appendChild(def_owned_title);
		lcontainer.appendChild(def_owned_entry);
	}
	if (intel.firepower_owned>-1){
		var def_strength_title=createSingleElement('div', 'target_search_info_title', '', 'Defense strength', '');
		var def_strength_entry=createSingleElement('div', 'target_search_info_entry', '', ''+prettyPrint(intel.defense_present), '');
		lcontainer.appendChild(def_strength_title);
		lcontainer.appendChild(def_strength_entry);
	}

	var break1_title=createSingleElement('div', 'target_search_info_title', '', '', '');
	var break1_entry=createSingleElement('div', 'target_search_info_entry', '', '', '');
	lcontainer.appendChild(break1_title);
	lcontainer.appendChild(break1_entry);

	//translations.general_balanced
	//translations.general_matter
	//translations.general_energy
	//translations.general_displacement
	var techTiltString=translations.general_unknown;
	if (intel.tech_tilt=='Even'){
		techTiltString=translations.general_balanced;
	}
	if (intel.tech_tilt=='Matter'){
		techTiltString=translations.general_matter;
	}
	if (intel.tech_tilt=='Energy'){
		techTiltString=translations.general_energy;
	}
	if (intel.tech_tilt=='Displacement'){
		techTiltString=translations.general_displacement;
	}

	var techtilt_title=createSingleElement('div', 'target_search_info_title', '', 'Tech tilt', '');
	var techtilt_entry=createSingleElement('div', 'target_search_info_entry', '', techTiltString, '');
	lcontainer.appendChild(techtilt_title);
	lcontainer.appendChild(techtilt_entry);

	var break1_title=createSingleElement('div', 'target_search_info_title', '', '', '');
	var break1_entry=createSingleElement('div', 'target_search_info_entry', '', '', '');
	lcontainer.appendChild(break1_title);
	lcontainer.appendChild(break1_entry);

	var heading2=createSingleElement('div', 'target_search_info_heading', '', 'Resources', '');
	lcontainer.appendChild(heading2);

	var resContainer=createSingleElement('div', 'outpost_levels search_holdings', '', '', '');
	var hsContainer=createSingleElement('div', 'resouce_level hs_level', '', prettyPrint(intel.stored_hassium), '');
	var inContainer=createSingleElement('div', 'resouce_level in_level', '', prettyPrint(intel.stored_indium), '');
	var srContainer=createSingleElement('div', 'resouce_level sr_level', '', prettyPrint(intel.stored_strontium), '');
	var ndContainer=createSingleElement('div', 'resouce_level nd_level', '', prettyPrint(intel.stored_neodymium), '');

	resContainer.appendChild(hsContainer);
	resContainer.appendChild(inContainer);
	resContainer.appendChild(srContainer);
	resContainer.appendChild(ndContainer);
	lcontainer.appendChild(resContainer);

	//console.log(intel);

	var lastScoutedString='Latest Scout: N/A';
	if (intel.scoutTimestamp>0 && intel.planet_id>0){
		lastScoutedString='Latest Scout: '+secondsToFullTime(ad2460.serverTime-intel.scoutTimestamp);
	}
	var lastScouted=createSingleElement('div', 'target_search_last_scouted', '', lastScoutedString, '');
	lcontainer.appendChild(lastScouted);

	/*

	var stored_hs_title=createSingleElement('div', 'target_search_info_title', '', 'Stored HS', '');
	var stored_hs_entry=createSingleElement('div', 'target_search_info_entry', '', ''+prettyPrint(intel.stored_hassium), '');

	var stored_in_title=createSingleElement('div', 'target_search_info_title', '', 'Stored IN', '');
	var stored_in_entry=createSingleElement('div', 'target_search_info_entry', '', ''+prettyPrint(intel.stored_indium), '');

	var stored_sr_title=createSingleElement('div', 'target_search_info_title', '', 'Stored SR', '');
	var stored_sr_entry=createSingleElement('div', 'target_search_info_entry', '', ''+prettyPrint(intel.stored_strontium), '');

	var stored_nd_title=createSingleElement('div', 'target_search_info_title', '', 'Stored ND', '');
	var stored_nd_entry=createSingleElement('div', 'target_search_info_entry', '', ''+prettyPrint(intel.stored_neodymium), '');


	lcontainer.appendChild(stored_hs_title);
	lcontainer.appendChild(stored_hs_entry);
	lcontainer.appendChild(stored_in_title);
	lcontainer.appendChild(stored_in_entry);
	lcontainer.appendChild(stored_sr_title);
	lcontainer.appendChild(stored_sr_entry);
	lcontainer.appendChild(stored_nd_title);
	lcontainer.appendChild(stored_nd_entry);
	*/
	var heading3=createSingleElement('div', 'target_search_info_heading', '', 'Top Outposts', '');
	rcontainer.appendChild(heading3);

	if (intel.outposts!=-1){
		var outpostArray=intel.outposts.split('||');

		var y=0;
		for (y=0;y<outpostArray.length ;y++ ){
			if (y<15){
				var dataArray=outpostArray[y].split('|');
				if (dataArray.length>1)	{
					var div1=createSingleElement('div','target_search_info_title', '', ''+dataArray[0]+' ('+dataArray[1]+')', '');
					var coordObject=convertShortCoordsToLongCoords(dataArray[2],dataArray[3]);
					var coordString=''+coordObject.q+':'+coordObject.s+':'+coordObject.g+':'+coordObject.o+'.'+coordObject.p+'';
					var div2=createSingleElement('div','target_search_info_entry maplink', '', ''+coordString, 'zoomInToXY('+dataArray[2]+','+dataArray[3]+')');
					div1.style.cursor='default';
					//div2.style.cursor='url(/css/smbutton.png), auto';
					div2.style.cursor='pointer';
					div2.style.color='#45D6EB';
					rcontainer.appendChild(div1);
					rcontainer.appendChild(div2);
				}

			}

		}

	}

	if (target.world_type>=60 && target.world_type<=70 ){
		$("#target_search_infopanel_right").hide();
	}
	else {
		$("#target_search_infopanel_right").show();
	}

}

function directShowIntelReport(id){
	var i=0;
	var found=false;

	for (var i = 0; i < ad2460.intel.reports.length; i++) {
		if (ad2460.intel.reports[i].report_id==id) {
			found=true;
		}
	}

	if (found==true) {
		specialProcessOpenPanel('intelligence',0,false);
		//var functionString="document.getElementById('"+panelId+"').click()";
		//setTimeout(functionString,900);
		var functionString2="viewIntelReport("+id+",-1,-1,-1,'intel')";
		setTimeout(functionString2,2500);

	};
}

function nextUniformClick(){
	var c=ad2460.editCommander;
	if (c!==false){
		// find the next step
		var i=0;
		for (i=0;i<ad2460.commander_colours.length ;i++ ){
			if (ad2460.commander_colours[i]==c.uniform){
				if (i<ad2460.commander_colours.length-1){
					c.uniform=ad2460.commander_colours[i+1];
					reRenderEditCommander();
					return;
				}
				else {
					c.uniform=ad2460.commander_colours[0];
					reRenderEditCommander();
					return;

				}
			}
		}
	}

}

function prevUniformClick(){
	var c=ad2460.editCommander;
	if (c!==false){
		// find the previous step
		var i=0;
		for (i=0;i<ad2460.commander_colours.length ;i++ ){
			if (ad2460.commander_colours[i]==c.uniform){
				if (i>0){
					c.uniform=ad2460.commander_colours[i-1];
					reRenderEditCommander();
					return;

				}
				else {
					c.uniform=ad2460.commander_colours[ad2460.commander_colours.length-1];
					reRenderEditCommander();
					return;

				}
			}
		}
	}
	reRenderEditCommander();
}

function nextFaceClick(){
	var c=ad2460.editCommander;
	if (c!==false){
		if (c.image_id<40){
			c.image_id++;
			reRenderEditCommander();
			return;
		}
		else {
			c.image_id=1;
			reRenderEditCommander();
			return;
		}
	}
}

function prevFaceClick(){
	var c=ad2460.editCommander;
	if (c!==false){
		if (c.image_id>1){
			c.image_id--;
			reRenderEditCommander();
			return;
		}
		else {
			c.image_id=40;
			reRenderEditCommander();
			return;
		}
	}
}

function saveCustomCommander(){
	var c=ad2460.editCommander;
	if (c==false){
		systemFeedback('Error','No uniform or commander selected.', 1, 1);
		return;
	}

	if (ad2460.vip_status>ad2460.serverTime){
		confirmedCustomCommanderSave();
		return;
	}

	if (ad2460.credits<2){
		systemFeedback('Error','Insufficient credits.', 1, 1);
		return;
	}
	var mainText="Saving your custom commander will cost 2 credits. Are you sure you wish to do this?";
	var okText="Yes";
	var cancelText="No";
	var okClick="confirmedCustomCommanderSave();hideConfirmationPopup();";

	showConfirmationPopup(mainText, okText, cancelText, okClick);

}

function confirmedCustomCommanderSave(){
	var c=ad2460.editCommander;
	if (c==false){
		systemFeedback('Error','No uniform or commander selected.', 1, 1);
		return;
	}

	$.post('actionhandler.pl', {action:'save_custom_commander',commander_id:ad2460.editCommander.commander_id, uniform:ad2460.editCommander.uniform, image_id:ad2460.editCommander.image_id}, function(data){ parseInfo(data);});
	// Just make sure on the server that he is not paying for a uniform he, or she, already has!
	// then clear the currently selected commander-id, update the commanders, and re-select the same one
	// set the ad2460.editCommander to false when done. Actually we don't need to do that.
}

function reRenderEditCommander(){
	var commander=ad2460.editCommander;
	var cmdImages=returnCommanderGraphics(commander);

	$("#selected_commander_bg").attr("src",cmdImages.bgImage);
	$("#selected_commander_uniform").attr("src",cmdImages.uniformImage);
	$("#selected_commander_head").attr("src",cmdImages.headImage);
}

function updateSelectedCommander(commander_id, uniform, image_id){
	var c=returnCommanderById(commander_id);
	if (c!=false){
		c.uniform=uniform;
		c.image_id=image_id;
		commanderClick(commander_id);
	}
}

function updateWargame(obj){
	// nothing
	for (i=0;i<ad2460.wargames.length ;i++ ){
		if (ad2460.wargames[i].id==obj.id){
			ad2460.wargames[i]=obj;
			return;
		}
	}
	ad2460.wargames.push(obj);
}

function returnWargameById(id){
	for (i=0;i<ad2460.wargames.length ;i++ ){
		if (ad2460.wargames[i].id==id){
			return ad2460.wargames[i];
		}
	}

	return false;
}

function selectWargame(id){
	$("#wargame_infopanel_content").empty();
	var w=returnWargameById(id);
	if (w==false){	return;	}

	var opponent_name=w.receiver_nickname;
	var opponent_avatar=w.receiver_avatar;
	if (w.receiver_id==ad2460.user_id){
		opponent_name=w.challenger_nickname;
		opponent_avatar=w.challenger_avatar;
	}

	// We need to render different content based on whehter this is a challenge I made, or one sent to me
	var parent=document.getElementById('wargame_infopanel_content');
	if (w.challenger_id==ad2460.user_id){
		// I sent the challenge
		// I can cancel it, and that is pretty much it...
		$("#wargame_infopanel_header").html("Challenge sent to "+opponent_name);

		var avImg=createSingleElement('img', 'wargame_avatar', '', 'images/uploads/avatars/'+opponent_avatar, '');
		var nameDiv=createSingleElement('div', 'wargame_challenger_name', '', opponent_name, '');
		var strContainer=createSingleElement('div', 'wargame_str_range_container_green', '', '', '');
		var strHead=createSingleElement('div', 'wargame_str_range_heading', '', 'Strength', '');
		var strValue=createSingleElement('div', 'wargame_str_range', '', ''+prettyPrint(w.max_strength), '');
		strContainer.appendChild(strHead);
		strContainer.appendChild(strValue);

		var infoText=createSingleElement('div', 'wargame_infotext', '', w.receiver_nickname+" has yet to respond.", '');

		var withdrawButton=createSingleElement('div', 'lightbutton160 red', '', 'Withdraw', 'withdrawWargame('+w.id+')');

		parent.appendChild(avImg);
		parent.appendChild(nameDiv);
		parent.appendChild(strContainer);
		parent.appendChild(infoText);
		parent.appendChild(withdrawButton);

	}
	else {
		// Someone challenged me!
		// I can accept it with a selected valid fleet
		$("#wargame_infopanel_header").html("Challenged by "+opponent_name);
		var min_def_strength=Math.floor(w.max_strength*0.8);
		var max_def_strength=Math.floor(w.max_strength*1.02);

		var avImg=createSingleElement('img', 'wargame_avatar', '', 'images/uploads/avatars/'+opponent_avatar, '');
		var nameDiv=createSingleElement('div', 'wargame_challenger_name', '', opponent_name, '');
		var strContainer=createSingleElement('div', 'wargame_str_range_container', '', '', '');
		var strHead=createSingleElement('div', 'wargame_str_range_heading', '', 'Strength Range', '');
		var strValue=createSingleElement('div', 'wargame_str_range', '', ''+prettyPrint(min_def_strength)+' - '+prettyPrint(max_def_strength), '');
		strContainer.appendChild(strHead);
		strContainer.appendChild(strValue);

		var infoText=createSingleElement('div', 'wargame_infotext', '', "In order to accept the challenge, you need to have a fleet available with a strength value within the allowed range.<br><br>Remember to set the tactics for the fleet before you click 'accept'. The chosen tactics for the fleet will be used in the wargame.", '');

		var dropContainer=createSingleElement('div', 'wargame_fleetselect', '', '', '');

		var acceptButton=createSingleElement('div', 'lightbutton160 green', '', 'Accept', 'acceptWargame('+w.id+')');

		var fleetDropdown=document.createElement('select');
		fleetDropdown.setAttribute("id","acceptWargameFleetDropdown");
		fleetDropdown.appendChild(new Option('Select Fleet', 0));

		var f=0;
		for (f=0;f<ad2460.myFleets.length ;f++ ){
			if (ad2460.myFleets[f].status==0 && ad2460.myFleets[f].storage_fleet==0 && ad2460.myFleets[f].homeworld_fleet==0 && ad2460.myFleets[f].commander_id>0 &&  ad2460.myFleets[f].current_x==ad2460.homeworld.x && ad2460.myFleets[f].current_y==ad2460.homeworld.y && ad2460.myFleets[f].strength>=min_def_strength && ad2460.myFleets[f].strength<=max_def_strength){
				fleetDropdown.appendChild(new Option(ad2460.myFleets[f].fleet_name +'  ('+prettyPrint(ad2460.myFleets[f].strength)+')', ad2460.myFleets[f].fleet_id));
			}
		}

		dropContainer.appendChild(fleetDropdown);

		parent.appendChild(avImg);
		parent.appendChild(nameDiv);
		parent.appendChild(strContainer);
		parent.appendChild(infoText);
		parent.appendChild(dropContainer);
		parent.appendChild(acceptButton);
	}

	$("#wargames_selected_opponent_header").html("VS "+opponent_name);

	fetchPersonalWargameStats(w);
}

function fetchPersonalWargameStats(wargame){
	var idToCheck=wargame.receiver_id;
	if (wargame.receiver_id==ad2460.user_id){
		idToCheck=wargame.challenger_id;
	}
	$.post('actionhandler.pl', {action:'fetch_personal_wargame_stats',opponent_id:idToCheck}, function(data){ parseInfo(data);});
}

function renderPersonalWargameHistory(wins, losses){
	var total=wins+losses;
	var percentage='-';
	if (total>0){
		percentage=Math.floor(wins*100/total);
	}
	$("#my_wargames_won").html(""+wins);
	$("#my_wargames_lost").html(""+losses);
	$("#my_wargames_won_percent").html(""+percentage);
}

function clearWarGames(){
	$("#wargame_container").empty();
}

function clearWargamesInfo(){
	$("#wargame_infopanel_content").empty();
	$("#my_wargames_won").html("-");
	$("#my_wargames_lost").html("-");
	$("#my_wargames_won_percent").html("-");
	$("#wargames_selected_opponent_header").html("Selected opponent");
	$("#wargame_infopanel_header").html("Selected Wargame");


}

function renderWargames(){
	// we don't consider the possible launch-id...if its displayed with one that is!
	var i=0;
	clearWarGames();
	var parent=document.getElementById('wargame_container');

	// sorting-stuff
	for (i=0;i<ad2460.wargames.length ;i++ ){
		if (ad2460.wargames[i].challenger_id==ad2460.user_id){
			ad2460.wargames[i].sortNum=0;
		}
		else {
			ad2460.wargames[i].sortNum=1000000;
		}
		ad2460.wargames[i].sortNum+=ad2460.wargames[i].max_strength;
	}
	ad2460.wargames.sort(function(a, b){return b.sortNum-a.sortNum});

	for (i=0;i<ad2460.wargames.length ;i++ ){
		var w=ad2460.wargames[i];
		var evenOrOdd='evenline';
		if (i%2==0){
			evenOrOdd='oddline';
		}

		var min_def_strength=Math.floor(w.max_strength*0.8);
		var max_def_strength=Math.floor(w.max_strength*1.02);

		var itemContainer=createSingleElement('div', 'tableselection '+evenOrOdd+' wargame_entry_container', '', '', 'selectWargame('+w.id+')');
		if (w.challenger_id==ad2460.user_id){
			c1=createSingleElement('div', 'wargame_entry_opponent', '', w.receiver_nickname, '');
			c1b=createSingleElement('div', 'wargame_entry_icon', '', '<img src=\"images/icons/outwargame.png\">', '');
			c2=createSingleElement('div', 'wargame_entry_strenght', '', prettyPrint(min_def_strength)+' - '+prettyPrint(max_def_strength), '');
			itemContainer.appendChild(c1);
			itemContainer.appendChild(c1b);
			itemContainer.appendChild(c2);
			parent.appendChild(itemContainer);
		}
		else {
			c1=createSingleElement('div', 'wargame_entry_opponent', '', w.challenger_nickname, '');
			c1b=createSingleElement('div', 'wargame_entry_icon', '', '<img src=\"images/icons/incwargame.png\">', '');
			c2=createSingleElement('div', 'wargame_entry_strenght', '', prettyPrint(min_def_strength)+' - '+prettyPrint(max_def_strength), '');
			itemContainer.appendChild(c1);
			itemContainer.appendChild(c1b);
			itemContainer.appendChild(c2);
			parent.appendChild(itemContainer);
		}
	}
	updateChallengeFleets();
}

function showWargamePopup(nickname, strength, timestamp, num){
	var mainText=nickname+" has challenged you to a Wargame with "+prettyPrint(strength)+" strength!";
	mainText+="<br><br>You have "+num+" challenge(s) waiting for you.";

	var okText="Show me";
	var cancelText="Close";
	var okClick="specialProcessOpenPanel('wargame', 0, false);hideConfirmationPopup();";

	play_multi_sound("challenge");

	showConfirmationPopup(mainText, okText, cancelText, okClick,'',false, true);
}

function playerInfoChallengeClick(nickname){
	$("#challenge_nickname").val(nickname);
	hidePlayerInfoPopup();
	specialProcessOpenPanel('wargame', 0, false);
	blinkElementById('challenge_nickname_fleet_dropdown');

}

function withdrawWargame(id){
	$.post('actionhandler.pl', {action:'cancel_wargame',challenge_id:id}, function(data){ parseInfo(data);});
}

function acceptWargame(id){
	var fleet_id=$("#acceptWargameFleetDropdown").val();
	if (fleet_id>0 && id>0){
		$.post('actionhandler.pl', {action:'accept_wargame',challenge_id:id, fleet_id:fleet_id}, function(data){ parseInfo(data);});
	}
}

function showWargameAcceptedPopup(view_id, opponent_name){
	play_multi_sound('challenge');
	showConfirmationPopup("Wargame Challenge Accepted!<br><br>"+opponent_name+" has accepted your Wargame challenge, and the fighting has begun!", "Watch now", "Watch later", "loadFirstDataForCombat("+view_id+");hideConfirmationPopup();", "",false, true);
}

function renderGeneralWargameStats(){
	var total_wargames_won_percent=0;
	if (ad2460.scores.wargames_won>0){
		total_wargames_won_percent=Math.floor(ad2460.scores.wargames_won*100/(ad2460.scores.wargames_won+ad2460.scores.wargames_lost));
	}

	$("#total_wargames_won").html(prettyPrint(ad2460.scores.wargames_won));
	$("#total_wargames_lost").html(prettyPrint(ad2460.scores.wargames_lost));
	$("#wargames_won_rank").html(prettyPrint(ad2460.scores.wargames_won_rank));
	$("#total_wargames_won_percent").html(total_wargames_won_percent+' %');
	$("#wargames_today").html(ad2460.wargames_today);

}

function updateChallengeFleets(){
	var dropdown=document.getElementById('challenge_nickname_fleet_dropdown');
	removeChildNodes('challenge_nickname_fleet_dropdown');
	dropdown.appendChild(new Option('Select fleet', 0));
	dropdown.selectedIndex =0;
	var f=0;
	for (f=0;f<ad2460.myFleets.length ;f++ ){
		if (ad2460.myFleets[f].strength>=5000 && ad2460.myFleets[f].status==0 && ad2460.myFleets[f].storage_fleet==0 && ad2460.myFleets[f].homeworld_fleet==0 && ad2460.myFleets[f].commander_id>0 &&  ad2460.myFleets[f].current_x==ad2460.homeworld.x && ad2460.myFleets[f].current_y==ad2460.homeworld.y){
			dropdown.appendChild(new Option(ad2460.myFleets[f].fleet_name +'  ('+prettyPrint(ad2460.myFleets[f].strength)+')', ad2460.myFleets[f].fleet_id));
		}
	}
}

function challengeByNicknameClick(){
	var nickname=$("#challenge_nickname").val();
	var fleet_id=$("#challenge_nickname_fleet_dropdown").val();

	if (fleet_id<1){
		systemFeedback('Error','Please select a fleet first!', 1, 1);
		return;
	}
	if (nickname==''){
		systemFeedback('Error','Empty nickname!', 1, 1);
		return;
	}
	$.post('actionhandler.pl', {action:'wargame_challenge_by_nickname',fleet_id:fleet_id, nickname:nickname}, function(data){ parseInfo(data);});
}

function antiSpySweepClick(){
	// any spy used against the player while this is running will have a much higher chance of failing!
	// works continously for 2 hours
	var agents=returnMaxAgents().spies;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		if (ad2460.intel.missions[i].type=='espionage' || ad2460.intel.missions[i].type=='spy-sweep'){
			agents--;
		}
	}
	if (agents>0){
		$.post('actionhandler.pl', {action:'initiate_anti_spy'}, function(data){ parseInfo(data);});
	}

}

function antiInfiltratorSweepClick(){
	// allow a spy to search for pending and present infiltrators and eliminate them
	// should take 30 minutes to complete, same as normal infiltrator-jobs
	var agents=returnMaxAgents().infiltrators;
	for (i=0;i<ad2460.intel.missions.length ;i++ ){
		if (ad2460.intel.missions[i].type=='infiltration' || ad2460.intel.missions[i].type=='infiltrator-sweep'){
			agents--;
		}
	}
	if (agents>0){
		$.post('actionhandler.pl', {action:'initiate_anti_infiltrator'}, function(data){ parseInfo(data);});
	}

}

function reloadBounties(){
	$.post('actionhandler.pl', {action:'reload_bounties'}, function(data){ parseInfo(data);});
}

function plusCommanderStat(statname){
	// just send the request to the server and let it deal with the logic and checking
	$.post('actionhandler.pl', {action:'increase_commander_stat',commander_id:ad2460.selectedCommanderId, statname:statname}, function(data){ hideHelpCommander();parseInfo(data);renderHiredCommanders();checkForUnspentCommanderPoints();});
}

function plusCommanderStatFive(statname){
	// just send the request to the server and let it deal with the logic and checking
	$.post('actionhandler.pl', {action:'increase_commander_stat_five',commander_id:ad2460.selectedCommanderId, statname:statname}, function(data){ hideHelpCommander();parseInfo(data);renderHiredCommanders();checkForUnspentCommanderPoints();});
}

function checkForUnspentCommanderPoints(){

	if (ad2460.currentPageSectionId!='military_content'){
		return;
	}

	var i=0;
	var points=false;
	for (i=0;i<ad2460.myCommanders.length ;i++ ){
		if (ad2460.myCommanders[i].points>0 && ad2460.myCommanders[i].hired==1){
			points=true;
		}
	}

	if (points==true){
		if( $("#commander_points_blink").is(':animated') ) {
			return;
		}
		$("#commander_points_blink").stop().delay(1000).fadeIn(400).fadeOut(400).fadeIn(400).fadeOut(400).fadeIn(400).fadeOut(400).fadeIn(400);
	}
	else {
		$("#commander_points_blink").hide();
	}
}

function viewNemesisClick(){
	$.post('actionhandler.pl', {action:'fetch_nemesis'}, function(data){ parseInfo(data);});
}

function renderNemesisList(){
	showSimpleBoxNemesis("Nemesis List","");
	var container=document.getElementById("nemesis_main_text");
	var htmlCode="<div class='nemesis_container'>";


	if (ad2460.nemesisList){
		if (ad2460.nemesisList.length>0){
			htmlCode+="<table><tr><th class='left'>Player</th><th class='left'>Alliance</th><th class='right'>Kill-value</th><th class='right'>Steal-value</th></tr>";
			for (var i=0;i<ad2460.nemesisList.length;i++ ){
				htmlCode+="<tr><td class='left nickname' onclick='loadPlayerInfo("+ad2460.nemesisList[i].user_id+")'>"+ad2460.nemesisList[i].nickname+"</td><td class='left alliance_name' onclick='loadAllianceInfo("+ad2460.nemesisList[i].alliance_id+")'>"+ad2460.nemesisList[i].alliance_name+"</td><td class='right'>"+prettyPrint(ad2460.nemesisList[i].def_lost_value)+"</td><td class='right'>"+prettyPrint(ad2460.nemesisList[i].taken_res)+"</td></tr>";
			}
			htmlCode+="</table>";
		}
		else {
			// No nemesis!! No attacks on me!
		}
	}

	htmlCode+="<div style='font-size:11px;font-style:italic;'><hr>The Nemesis-list shows the players who have hurt you the most through attacks on your homeworld and outposts.<br>Kill-value tells you how much resource-value they have destroyed by killing units.<br>Steal-value is how much resources they have stolen.</div>";

	htmlCode+="</div>";

	container.innerHTML=htmlCode;
}

function fetchFleetDonationLog(fleet_id){
	$.post('actionhandler.pl', {action:'fetch_fleet_donation_log', fleet_id:fleet_id}, function(data){ parseInfo(data);});
}

function renderFleetDonationLog(){
	showSimpleBoxNemesis("Ship Donation Log","");
	var container=document.getElementById("nemesis_main_text");
	var htmlCode="<div class='nemesis_container'>";

	if (ad2460.fleet_donation_log){
		if (ad2460.fleet_donation_log.length>0){
			htmlCode+="<table><tr><th class='left'>Player</th><th class='left'>Ship</th><th class='right'>Counter</th><th class='right'>Timestamp</th></tr>";
			for (var i=0;i<ad2460.fleet_donation_log.length;i++ ){
				htmlCode+="<tr><td class='left nickname' onclick='loadPlayerInfo("+ad2460.fleet_donation_log[i].user_id+")'>"+ad2460.fleet_donation_log[i].nickname+"</td><td class='left'>"+returnGameObjectById(ad2460.fleet_donation_log[i].ship_type_id).name+"</td><td class='right'>"+ad2460.fleet_donation_log[i].counter+"</td><td class='right'>"+formatDateTimeShort(convertToUTC(ad2460.fleet_donation_log[i].timestamp))+"</td></tr>";
			}
			htmlCode+="</table>";
		}
		else {
			// No entries in the log
			htmlCode+="<h3>No recent ship donations recorded for this fleet.</h3>";
		}
	}

	htmlCode+="<div style='font-size:11px;font-style:italic;'><hr>This log shows all recent ship-donations to the selected fleet.</div>";

	htmlCode+="</div>";

	container.innerHTML=htmlCode;

}

function fetchConversations(){
	$.post('actionhandler.pl', {action:'fetch_conversations'}, function(data){ parseInfo(data);});
	// Server must update the ad2460.updateTimes.lastMailFetch with a new timestamp when done
}

function fetchNewConversations(){
	var i=0;
	var found=false;
	for (i=0;i<ad2460.openSlides.length ;i++ ){
		if (ad2460.openSlides[i]=='mailslide'){
			found=true;
		}
	}
	
	if (found==false){
		var randomnumber=Math.floor(Math.random()*100);
		if (randomnumber<85){
			return;
		}
	}


	// removed updateConversations(); from the below function
	$.post('actionhandler.pl', {action:'fetch_updated_conversations',last_fetch:ad2460.updateTimes.lastMailFetch}, function(data){ parseInfo(data);checkNewMailStatus();});
	// Server must update the ad2460.updateTimes.lastMailFetch with a new timestamp when done
}

function addConversationEntry(conversation_id, user_id_1, nickname_1, avatar_1, user_id_2, nickname_2, avatar_2, last_update, blocked){
	// Lets make sure we are not adding the sae one twice here, would be daft...
	var i=0;
	var found=0;
	for (i=0;i<ad2460.conversations.length ;i++ ){
		if (ad2460.conversations[i].conversation_id==conversation_id){
			found=1;
			// Might as well update it's content then, so we can use this function for updates too
			// The only thing that can be updated here, is actually the time....
			ad2460.conversations[i].last_update=last_update;
		}
	}
	
	if (found==0){
		var user_1=new ConversationUser(user_id_1, nickname_1, avatar_1);
		var user_2=new ConversationUser(user_id_2, nickname_2, avatar_2);
		ad2460.conversations.push(new Conversation(conversation_id, last_update, user_1, user_2, blocked));
	}
}

function addConversationMessageEntry(msg_id, conversation_id, user_id, timestamp, unread, body){
	// Here we will add the message to the right conversation, and thats pretty much it.
	// Check if it exists first though!
	// Lets start by finding the right conversation :)
	var i=0;
	var thisConv;
	var found=0;
	for (i=0;i<ad2460.conversations.length ;i++ ){
		if (ad2460.conversations[i].conversation_id==conversation_id){
			thisConv=ad2460.conversations[i];
			found=1;
		}
	}
	if (found==1){
		// Now check if the message exists in there already...
		var found2=0;
		var i=0;
		for (i=0;i<thisConv.messages.length ;i++ ){
			if (thisConv.messages[i].msg_id==msg_id){
				found2=1;
			}
		}
		if (found2==0){
			// We didn't find it, goodie, lets add it!
			// Override the unread-bit if user_id is the current users id....
			if (user_id==ad2460.user_id){
				unread=0;
			}
			thisConv.messages.push(new ConversationMessage(msg_id, conversation_id, user_id, timestamp, body, unread));
		}
	}
}

function clearConversations(){
	ad2460.conversations=[];
}

function renderConversations(){
	// Start off with clearing them out? Delete all children of the id 'convlist'

	sortConversations();

	$(".convnames_list").remove();
	var parentContainer=document.getElementById('convlist');
	var i=0;

	var foundUnread=false;
	var unreads=0;

	for (i=0;i<ad2460.conversations.length ;i++ ){
		// Create the 5 divs
		var myclass='convnames_list';
		if (ad2460.conversations[i].messages[ad2460.conversations[i].messages.length-1].unread==1 && ad2460.conversations[i].messages[ad2460.conversations[i].messages.length-1].user_id!=ad2460.user_id){
			myclass+=' unread';
			foundUnread=true;
			unreads++;
		}
		if (i % 2 == 0){
			myclass+=' odd';
		}
		else {
			myclass+=' even';
		}
		var convListEntry=document.createElement('div');
		convListEntry.setAttribute("class",myclass);
		convListEntry.setAttribute("id",'conversation_container_'+ad2460.conversations[i].conversation_id);
		convListEntry.setAttribute("onclick","selectConversation("+ad2460.conversations[i].conversation_id+")");
		
		var convFav=document.createElement('div');
		convFav.setAttribute("class",'convfav');

		var convName=document.createElement('div');
		convName.setAttribute("class",'convname');

		var convNameString=ad2460.conversations[i].user_1.nickname;
		if (ad2460.conversations[i].user_1.user_id==ad2460.user_id){
			convNameString=ad2460.conversations[i].user_2.nickname;
		}
		convName.innerHTML=convNameString;

		var convUnread=document.createElement('div');
		convUnread.setAttribute("class",'conv_unread');
		
		var convTime=document.createElement('div');
		convTime.setAttribute("class",'convtime');
		//console.log("last update value is : "+ad2460.conversations[i].last_update);
		convTime.innerHTML=formatMessageTimestamp(ad2460.conversations[i].last_update);

		convListEntry.appendChild(convFav);
		convListEntry.appendChild(convName);
		//convListEntry.appendChild(convUnread); // Not needed
		convListEntry.appendChild(convTime);

		parentContainer.appendChild(convListEntry);
	}
	if (foundUnread==true){
		$("#points_msg_unread_msg_indicator").html(''+unreads).show();
	}
	else {
		$("#points_msg_unread_msg_indicator").hide();
	}

	checkScrollButtonStatus('convlist');

}

function countUnreadMessages(){
	var unread=0;
	for (var i=0;i<ad2460.conversations.length ;i++ ){
		var conv=ad2460.conversations[i];
		for (var m=0 ; m<conv.messages.length ; m++ ){
			if (conv.messages[m].unread>0){
				unread++;
			}
		}
	}
	return unread;
}

function sortConversations(){
	ad2460.conversations.sort(function(a, b){ return b.last_update-a.last_update });
}

function fetchConversationsUpdates(){
	// ad2460.updateTimes.lastMailFetch is important here :)
}

function renderConversation(){
	
}

function showNoConversationsWarning(){
	$("#noconvpanel1").css('display', 'table-cell');
	$("#noconvpanel2").css('display', 'table-cell');
}

function hideNoConversationsWarning(){
	$("#noconvpanel1").hide();
	$("#noconvpanel2").hide();
}

function newConversationClick(){
	$("#conversation_with_name").hide();
	$("#conversation_with_input").show().val('');
	removeConversationMessages();
	ad2460.selectedConversationId=0;
}

function initiateConversationWithName(name){
	// Here we will loop through all conversations to look for a match on name, and if we find one, we open it.
	// If we don't find a match, we open the new conversation thingie, and enter the right name in the input-field....
	// Lets determine if the slide is open here before we decide on that
	var itsOpen=false;
	var i=0;
	for (i=0;i<ad2460.openSlides.length ;i++ ){
		if (ad2460.openSlides[i]=='mailslide'){
			itsOpen=true;
		}
	}
	
	
	var foundConversation=false;
	for (i=0;i<ad2460.conversations.length ;i++ ){
		if (ad2460.conversations[i].user_1.nickname==name || ad2460.conversations[i].user_2.nickname==name){
			foundConversation=ad2460.conversations[i];
			
		}
	}

	if (foundConversation!=false){
		if (itsOpen==false){
			openSlide('mailslide');
		}

		selectConversation(foundConversation.conversation_id);
		return;
	}
	else {
		if (itsOpen==false){
			openSlide('mailslide');
		}
		newConversationClick();
		document.getElementById('conversation_with_input').value=name;
	}

}

function removeConversationMessages(){
	removeChildNodes('currentconv');
}

function clearConversationMessageTextarea(){
	document.getElementById('conversation_textarea_body').value='';
}

function reselectSelectedConversation(){
	if (ad2460.selectedConversationId>0){
		selectConversation(ad2460.selectedConversationId);
	}
}

function updateConversations(scrollToBottom){
	renderConversations();
	reselectSelectedConversation();
	if (scrollToBottom==true){
		scrollToBottomConvMessage();
	}
}


function selectConversation(conversation_id){
	// Find out if the mailslide is currently open first, if not, open it!
	var i=0;
	
	$("#conversation_with_input").hide().val('');
	$("#conversation_with_name").show();

	var curScrollPos=$("#currentconv").css("top");
	//myScrollToTop('currentconv',0);
	
	var scrollToBottom=false;
	if (ad2460.selectedConversationId!=conversation_id){
		scrollToBottom=true;
	}

	ad2460.selectedConversationId=conversation_id;
	// And then do the work...
	// console.log("Conversation selected: "+conversation_id);
	var thisConv;

	for (i=0;i<ad2460.conversations.length ;i++ ){
		if (ad2460.conversations[i].conversation_id==conversation_id){
			thisConv=ad2460.conversations[i];
			removeConversationMessages();

			var x=0;
			for (x=0;x<thisConv.messages.length ;x++ ){
				var thisUser=thisConv.user_1;
				thisConv.messages[x].unread=0;
				if (thisConv.messages[x].user_id==thisConv.user_2.user_id){
					thisUser=ad2460.conversations[i].user_2;
				}

				$(".selected_conv").removeClass('selected_conv');
				$("#conversation_container_"+conversation_id).removeClass('unread').addClass('selected_conv');
				//$("#conversation_container_"+conversation_id).addClass('selected_conv');
				renderConvMessage(thisConv.messages[x],thisUser);
			}
			var nameToPrint=thisConv.user_1.nickname;
			if (thisConv.user_1.user_id==ad2460.user_id){
				nameToPrint=thisConv.user_2.nickname;
			}
			$("#conversation_with_name").html(nameToPrint);

			$("#blockConversationButton").css({opacity:1});
			if (thisConv.blocked==0){
				$("#blockConversationButton").html("Block");
			}
			else if(thisConv.blocked==ad2460.user_id){
				$("#blockConversationButton").html("Unblock");
			}
			else {
				$("#blockConversationButton").html("Blocked");
			}

			if (thisConv.last_marked_as_read<thisConv.last_update){
				markConversationAsRead(conversation_id);
				thisConv.last_marked_as_read=ad2460.serverTime;
			}
		}
	}
	checkNewMailStatus();
	// $("#currentconv").css("top",curScrollPos);
	
	//checkScrollButtonStatus('currentconv');

	if (scrollToBottom==true){
		scrollToBottomConvMessage();
	}


}

function markConversationAsRead(conversation_id){
	$.post('actionhandler.pl', {action:'mark_conversation_as_read',conversation_id:conversation_id}, function(data){ parseInfo(data);});
}

function renderConvMessage(message,user){
	var parent=document.getElementById('currentconv');

	var myclass='conventry_other';
	if (message.user_id==ad2460.user_id){
		myclass='conventry_own';
	}

	var msgContainer=document.createElement('div');
	msgContainer.setAttribute("class",myclass);

	var msgAvatarContainer=document.createElement('div');
	msgAvatarContainer.setAttribute("class","convavatar");


	// Remember to set the right avatar from the user here....
	var avatarSrc="images/uploads/avatars/"+user.avatar;
	if (user.avatar==""){
		avatarSrc="images/uploads/avatars/none.jpg";
	}
	//if (message.user_id==ad2460.user_id){
	//	avatarSrc="images/fixed/conversationavatar.png";
	//}

	var msgAvatarImage=document.createElement('img');
	msgAvatarImage.setAttribute("src",avatarSrc);
	msgAvatarImage.style.width='50px';
	msgAvatarImage.style.height='50px';
	msgAvatarImage.style.borderRadius='5px';


	var namedateContainer=document.createElement('div');
	namedateContainer.setAttribute("class","convnamedate");

	var nameContainer=document.createElement('span');
	nameContainer.innerHTML=user.nickname;
	nameContainer.setAttribute("onclick","loadPlayerInfo("+user.user_id+")");
	nameContainer.style.cursor='pointer';
	nameContainer.style.color="rgb(255, 200, 67)";

	var dateContainer=document.createElement('div');
	dateContainer.setAttribute("class","convdatestamp");
	dateContainer.innerHTML=formatMessageTimestamp(message.timestamp);

	var bodyContainer=document.createElement('span');
	bodyContainer.setAttribute("class","msgbody");
	bodyContainer.innerHTML=iconify(message.body);

	msgContainer.appendChild(msgAvatarContainer);
		msgAvatarContainer.appendChild(msgAvatarImage);
	msgContainer.appendChild(namedateContainer);
		namedateContainer.appendChild(nameContainer);
		namedateContainer.appendChild(dateContainer);
	msgContainer.appendChild(bodyContainer);

	parent.appendChild(msgContainer);

	/*<div class='conventry_own'> 
		<div class='convavatar'> 
			<img src='images/fixed/conversationavatar.png' /> 
		</div> 
		<div class='convnamedate'>
			<span>Deg</span>
			<div class='convdatestamp'>13. Aug. 2013 12:44:21</div>
		</div> 
		<span>
			Ja, så var det vel ikke noe annet å gjøre enn å angripe Tulleballiansen igjen da. De r jo så forbanna noobe i hue at de ikke engang skjønner hvor mange skip de må ha for å beskytte seg, men det er iallefall morro når de går til motangrep. hehe	
		</span>
	</div>*/
}

function conversationSendClick(){
	// data to keep in mind:
	// ad2460.selectedConversationId
	// the element with id conversation_with_input if ad2460.selectedConversationId==0
	// the element conversation_textarea_body which holds the message to send....
	// Lets allow the javascript here pick up on a few things before we bother the server...
	fetchNewConversations();
	var nowDate=new Date;

	var timeSinceLastSendClick=(nowDate-ad2460.lastConvSendTime)/1000;
	if (timeSinceLastSendClick<2){
		return 0;
	}
	
	ad2460.lastConvSendTime=nowDate;

	var body=document.getElementById('conversation_textarea_body').value;
	var conversation_id=ad2460.selectedConversationId;
	var receiver=document.getElementById('conversation_with_input').value;

	if (receiver.toLowerCase()=='*alliance*'){
		conversationSendClickAlliance();
		return;
	}

	if (body.length<2){
		systemFeedback('Error','Message is too short!', 1, 3);
		return;
	}

	if (conversation_id==0){
		if (receiver.length<2){
			systemFeedback('Error','Send this to who???', 1, 3);
			return;
		}
	}

	// Fair enough, let's push it through	
	$.post('actionhandler.pl', {action:'send_conversation_message',conversation_id:conversation_id, receiver:receiver, body:body}, function(data){ parseInfo(data);});
}

function conversationSendClickAlliance(){
	fetchNewConversations();
	var body=document.getElementById('conversation_textarea_body').value;

	if (body.length<2){
		systemFeedback('Error','Message is too short!', 1, 3);
		return;
	}
	if (ad2460.allianceData.id<1){
		systemFeedback('Error','You are not part of an alliance', 1, 3);
		return;
	}

	// Fair enough, let's push it through	
	$.post('actionhandler.pl', {action:'send_alliance_message', body:body}, function(data){ parseInfo(data);});
	$("#conversation_with_input").val('');
}

function checkMessageReceiverForAlliance(){
	var value=$("#conversation_with_input").val();
	if (value=='*Alliance*'){
		systemFeedback('Note','Alliance-wide messages cost 2 credits to send.', 3, 7);
	}
}

function blockConversationClick(){
	if (ad2460.selectedConversationId>0){
		$.post('actionhandler.pl', {action:'block_conversation',conversation_id:ad2460.selectedConversationId}, function(data){ parseInfo(data);});
	}
}

function markConversationAsBlocked(conversation_id){
	var i=0;
	for (i=0;i<ad2460.conversations.length ;i++ ){
		if (ad2460.conversations[i].conversation_id==conversation_id){
			ad2460.conversations[i].blocked=ad2460.user_id;
		}
	}
	reselectSelectedConversation();
}
function markConversationAsUnblocked(conversation_id){
	var i=0;
	for (i=0;i<ad2460.conversations.length ;i++ ){
		if (ad2460.conversations[i].conversation_id==conversation_id){
			ad2460.conversations[i].blocked=0;
		}
	}
	reselectSelectedConversation();
}

function indicateNewMail(){
	//$("#messagesbutton .buttonhover").animate( { opacity: 1 }, {duration :1000, easing : easing, complete: function() { $("#messagesbutton .buttonhover").animate({opacity:0},{duration:1000})}});
	//$("#messagesbutton .buttonhover").css( { opacity: 1 });
	checkNewMailStatus();
}

function checkNewMailStatus(){
	var newMail=false;
	var unreads=0;
	for (i=0;i<ad2460.conversations.length ;i++ ){
		if (ad2460.conversations[i].messages[ad2460.conversations[i].messages.length-1].unread==1 && ad2460.conversations[i].messages[ad2460.conversations[i].messages.length-1].user_id!=ad2460.user_id){
			newMail=true;
			unreads++;
		}
	}
	if (newMail==true){
		$("#points_msg_unread_msg_indicator").html(''+unreads).show();
		renderConversations();
	}
	else {
		$("#points_msg_unread_msg_indicator").hide();
	}
}


function specialMsgOpenSlide(id){
	// If it's open, don't do anything
	var i=0;
	var found=false;
	for (i=0;i<ad2460.openSlides.length; i++ ){
		if (ad2460.openSlides[i]=='mailslide'){
			found=true;
		}
	}
	if (found==false){
		$("#messagesbutton").click();
	}
	//closeSlides();
}

function renderLatestConversations(){
	return;
}

function unrenderCurrentConversation(){
	removeChildNodes('currentconv');
	renderConversations();
	$("#conversation_with_name").html("");
	$("#blockConversationButton").css({opacity:0.5});
}
function updateMoonNew(){
	var d=new Date;
	var minute=d.getMinutes();
	var hour=d.getHours();
	updateMoon(hour,minute);
}

function updateMoonTest(){
	moontestcounter++;
	var hour=Math.floor(moontestcounter / 60);
	var minute=moontestcounter-(hour*60);
	if (hour==24) {
		moontestcounter=0;
		hour=Math.floor(moontestcounter / 60);
		minute=moontestcounter-(hour*60);
	}

	//updateMoon(hour,minute);
	updateMoon(23,0);
	//document.getElementById('homeworld_planet_name').innerHTML=zeroPad(hour)+':'+zeroPad(minute);
}


function updateMoon(hour,minute){
	var x=ad2460.moonhoursX[hour];
	var y=ad2460.moonhoursY[hour];
	var zIndex=0;
	if (hour<=9) {
		x=x+Math.floor(minute);
		zIndex=1;
	}
	else {
		x=x-Math.floor(minute);
	}
	if (hour<6) {
		y=y+Math.floor(minute/6*1.2);
	}
	else if (hour<18) {
		y=y-Math.floor(minute/6*1.2);
	}
	else {
		y=y+Math.floor(minute/6*1.2);
	}

	var global_y_modifier=-100;
	y=y+global_y_modifier;

	document.getElementById('spinnermoon').style.zIndex=zIndex;
	document.getElementById('spinnermoon').style.left=x+'px';
	document.getElementById('spinnermoon').style.top=y+'px';
	document.getElementById('spinnermoon').style.display='block';
}

function checkReloadFleetFlag(callback){
	$.post('actionhandler.pl', {action:'check_fleet_reload_flag',last_update:ad2460.updateTimes.lastPlayerUpdateFetch}, function(data){ parseInfo(data);if(typeof(callback) === 'function') {callback();}});
}

function fetchAllTechData(callback){
	$.post('actionhandler.pl', {action:'fetch_all_tech_data'}, function(data){ parseInfo(data);if(typeof(callback) === 'function') {callback();}});
}

function fetchXpLog(){
	$.post('actionhandler.pl', {action:'fetch_xp_log'}, function(data){ parseInfo(data); });
}

function renderXpLog(){
	showSimpleBox("XP log (last 3 days)","");
	var container=document.getElementById("simple_main_text");

	if (ad2460.xpLog.length==0){
		$("#simple_main_text").html("No entries found for the past 3 days.");
		return;
	}

	// I'm thinking XP Description Timestamp

	var i=0;


	var headerContainer=createSingleElement('div', 'xplog_header_container', '', '', '');
	var h1=createSingleElement('div', 'xplog_col_1', '', 'XP', '');
	var h2=createSingleElement('div', 'xplog_col_2', '', 'Description', '');
	var h3=createSingleElement('div', 'xplog_col_3', '', 'Time', '');


	headerContainer.appendChild(h1);
	headerContainer.appendChild(h2);
	headerContainer.appendChild(h3);

	container.appendChild(headerContainer);

	for (i=0;i<ad2460.xpLog.length ;i++ ){

		var outer=createSingleElement('div', 'xplog_entry_container', '', '', '');
		var col1=createSingleElement('div', 'xplog_col_1', '', prettyPrint(ad2460.xpLog[i].xp), '');
		var col2=createSingleElement('div', 'xplog_col_2', '', ''+ad2460.xpLog[i].description, '');
		var col3=createSingleElement('div', 'xplog_col_3', '', formatDateTimeShort(convertToUTC(ad2460.xpLog[i].timestamp)), '');

		outer.appendChild(col1);
		outer.appendChild(col2);
		outer.appendChild(col3);

		container.appendChild(outer);
	}
}

function clearDevelopments(){
	ad2460.developments=[];
}

function removeDevelopments(){
	$(".development_item").remove();
}

function clearResearches(){
	ad2460.researches=[];
}

function removeResearches(){
	$(".research_item").remove();
}

function clearFacilities(){
	ad2460.facilities=[];
}

function removeFacilities(){
	$(".facility_item").remove();
}

function clearProductionitems(){
	ad2460.productionitems=[];
}

function removeProductionitems(){
	$(".production_item").remove();
}

function performDefaultFacilitySelection(){
	var facility=returnUpgradingFacility();
	if (facility){
		//var parent=returnFacilityById(facility.parent_id);
		var parent=returnGameObjectById(facility.parent_id);


		facilityContainerClick(parent.facility_id,parent.building_id);
	}
	else {
		facilityContainerClick(301,1);
	}
}

function returnInternalFacilityId(externalId){
	var i=0;
	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].id==externalId)	{
			return (i);
		}
	}
}

function find_addon_level(rootId,addon_group){
	var level=0;
	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].user_id>0)	{
			if (ad2460.facilities[i].parent_id==rootId)	{
				if (ad2460.facilities[i].addon_group==addon_group)	{
					if (ad2460.facilities[i].level>level)	{
						level=ad2460.facilities[i].level;
					}
				}
			}
		}
	}
	return (level);
}

function find_addon_details(rootId,addon_group){
	//console.log("Find addon details called. "+rootId+" "+addon_group);
	var details={};
	var level=-1;
	details.level=level;
	details.name='unknown';
	details.id=-1;
	details.upgrading=0;

	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].user_id>0)	{
			if (ad2460.facilities[i].parent_id==rootId)	{
				if (ad2460.facilities[i].addon_group==addon_group)	{
					if (ad2460.facilities[i].level>level)	{
						level=ad2460.facilities[i].level;
						details.level=ad2460.facilities[i].level;
						details.name=ad2460.facilities[i].name;
						details.id=ad2460.facilities[i].id;
						details.upgrading=ad2460.facilities[i].upgrading;
						//console.log("Details updated. ID:  "+details.id);
					}
				}
			}
		}
	}

	if (details.level==-1){
		// Special case
		for (i=0;i<ad2460.facilities.length;i++ ){
			//if (ad2460.facilities[i].user_id>0)	{
				if (ad2460.facilities[i].parent_id==rootId)	{
					if (ad2460.facilities[i].addon_group==addon_group)	{
						if (ad2460.facilities[i].level==1)	{
							level=ad2460.facilities[i].level;
							details.level=0;
							details.name=ad2460.facilities[i].name;
							details.id=ad2460.facilities[i].id;
							details.upgrading=ad2460.facilities[i].upgrading;
							//console.log("Details updated. ID:  "+details.id);
						}
					}
				}
			//}
		}
	}

	return (details);
}


function find_facility_level(rootId){
	var level=1;
	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].user_id>0)	{
			if (ad2460.facilities[i].parent_id==rootId)	{
				if (ad2460.facilities[i].addon_group==0)	{
					if (ad2460.facilities[i].level>level)	{
						level=ad2460.facilities[i].level;
					}
				}
			}
		}
	}


	return (level);
}


function renderFacilities(view){
	var rootIdsWithAddons=[301, 316, 331, 346, 364, 367, 385, 388, 391, 394, 397 ,382];

	var rootIdsWithoutAddons=[364, 385, 388, 391, 394, 397, 382];
	var specialIds=[382];

	removeChildNodes('facility_list_container');

	var container=document.getElementById('facility_list_container');
	var i=0;
	for (i=0;i<rootIdsWithAddons.length;i++ ){ // Just go through the root IDS.
		// To check an ID, simply look up the ad2460.facilities[returnInternalFacilityId(id)]

		var renderAddons=true;
		var x=0;
		for (x=0;x<rootIdsWithoutAddons.length;x++ ){
			if (rootIdsWithoutAddons[x]==rootIdsWithAddons[i]){
				renderAddons=false;
			}
		}

		var thisFacility=ad2460.facilities[returnInternalFacilityId(rootIdsWithAddons[i])];



		if (thisFacility.user_id>0){
			// Should be rendered..But might be under upgrade!
			// We start with level 1 in all of these...
			var itemContainer=document.createElement('div');
			itemContainer.setAttribute("class","facility_item");
			itemContainer.setAttribute("onclick","facilityContainerClick("+rootIdsWithAddons[i]+","+thisFacility.building_id+",event)");
			itemContainer.setAttribute("id","facility_item_"+rootIdsWithAddons[i]);
			itemContainer.setAttribute("title",thisFacility.name);
			itemContainer.setAttribute("alt",thisFacility.name);

			var bgimage=document.createElement('img');
			bgimage.setAttribute("class","facility_item_bg_img");
			bgimage.setAttribute("src","images/icons/facility/"+rootIdsWithAddons[i]+".jpg");

			itemContainer.appendChild(bgimage);

			var itemNameField=document.createElement('div');
			itemNameField.setAttribute("class","facility_item_name_field");

			var itemName=document.createElement('div');
			itemName.setAttribute("class","facility_item_name");
			itemName.innerHTML=thisFacility.shortname;

			itemNameField.appendChild(itemName);
			itemContainer.appendChild(itemNameField);

			var mainLevel=document.createElement('div');
			mainLevel.setAttribute("class","facility_main_status");
			if (thisFacility.upgrading==1){
				mainLevel.setAttribute("class","facility_main_status facility_main_status_upgrade");
			}
			// No, that won't work properly.
			// We're not seeing the actual facility in thisFacility, we see the root!
			// We need to grab the ACTUAL facility somehow.
			// with addon_group 0
			// and check for anyone with upgrading == 1
			var u=0;
			var ufound=false;
			for (u=0;u<ad2460.facilities.length ;u++ ){
				var ufacility=ad2460.facilities[u];
				if (ufacility.parent_id==thisFacility.id && ufacility.addon_group==0 && ufacility.upgrading==1 ){
					ufound=true;
				}
			}
			if (ufound==true){
				mainLevel.setAttribute("class","facility_main_status facility_main_status_upgrade");
			}

			mainLevel.innerHTML=''+find_facility_level(rootIdsWithAddons[i]);



			if (renderAddons===true){
				var addon1=document.createElement('div');
				addon1.setAttribute("class","facility_addon_status addon_1");
				addon1.innerHTML=''+find_addon_level(rootIdsWithAddons[i],1);
				var details=find_addon_details(rootIdsWithAddons[i],1);
				if (details.upgrading==1){
					addon1.setAttribute("class","facility_addon_status addon_1 facility_addon_status_upgrade");
				}

				var addon2=document.createElement('div');
				addon2.setAttribute("class","facility_addon_status addon_2");
				addon2.innerHTML=''+find_addon_level(rootIdsWithAddons[i],2);
				var details=find_addon_details(rootIdsWithAddons[i],2);
				if (details.upgrading==1){
					addon2.setAttribute("class","facility_addon_status addon_2 facility_addon_status_upgrade");
				}


				var addon3=document.createElement('div');
				addon3.setAttribute("class","facility_addon_status addon_3");
				addon3.innerHTML=''+find_addon_level(rootIdsWithAddons[i],3);
				var details=find_addon_details(rootIdsWithAddons[i],3);
				if (details.upgrading==1){
					addon3.setAttribute("class","facility_addon_status addon_3 facility_addon_status_upgrade");
				}


				var addon4=document.createElement('div');
				addon4.setAttribute("class","facility_addon_status addon_4");
				addon4.innerHTML=''+find_addon_level(rootIdsWithAddons[i],4);
				var details=find_addon_details(rootIdsWithAddons[i],4);
				if (details.upgrading==1){
					addon4.setAttribute("class","facility_addon_status addon_4 facility_addon_status_upgrade");
				}


				itemContainer.appendChild(addon1);
				itemContainer.appendChild(addon2);
				itemContainer.appendChild(addon3);
				itemContainer.appendChild(addon4);
			}
			itemContainer.appendChild(mainLevel);
			// Is there an upgrade in progress???
			// If so we must add the new thing...
			//<div class="facility_current_upgrade">
			//	<span>Here goes the upgrade timer</span>
			//	<img class="facility_current_cancel" src="images/fixed/cancel.png" onclick="cancelFacilityClick()">
			//</div>
			//itemContainer.appendChild(currentUpgradeThing);
			container.appendChild(itemContainer);
		}
	}

	// Adding support for the special entries which requires a certain flag...

	var currently_building=false;
	for (i=0;i<ad2460.facilities.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.facilities[i];
		if (thisItem.upgrading==1){
			// We are facilitying stuff!
			currently_building=true;
			var container=document.getElementById('infopanel_current_facility_container');

			// Here we need to register a timer, somehow, and then tie it to this DOM-node.
			var timerId='currentFacilityProgressTimer';
			registerNewTimer(timerId, ['process_1_eta','current_upgrade_timer_2'], ['process_1_progress'], thisItem.start_time, thisItem.end_time, function(){fetchAllTechData();});
			$('#process_1_name').html(thisItem.name);
			$('#process_1_progress').show();
		}
	}
	if (currently_building==false){
		$("#current_faciliy_helptext").html('Your construction-teams are currently idle.');
		$('#process_1_progress').css('width','0%');
		$('#process_1_progress').hide();
		$('#process_1_colour').hide();

		$('#process_1_eta').html('');
		$('#process_1_name').html('No facility under construction');
	}
	//checkScrollButtonStatus('facility_list_container')
}

function reSelectFacilityItem(){
	facilityContainerClick(ad2460.homeworldSelectedItems.facility_id, ad2460.homeworldSelectedItems.building_id, true);
	if (ad2460.homeworldSelectedItems.facility_info_id>0){
		facilityInfoClick(ad2460.homeworldSelectedItems.facility_info_id, ad2460.homeworldSelectedItems.facility_info_level,null);
	}

}

function facilityContainerClick(facilityId, building_id, reselect){

	var rootIdsWithAddons=[301, 316, 331, 346, 364, 367, 385, 388, 391, 394 , 397,  382];
	var rootIdsWithoutAddons=[364, 385, 388, 391, 394, 397, 382];
	var specialIds=[382];

	//console.log("facilityContainerClick "+facilityId+" "+building_id);
	ad2460.temp.clickedFacilityId=facilityId;
	ad2460.temp.clickedBuildingId=building_id;
	ad2460.homeworldSelectedItems.facility_id=facilityId;
	ad2460.homeworldSelectedItems.building_id=building_id;

	// Remember that the facilityID coming in here is the ROOT id, not the actual ID
	// We need that ACTUAL facility as well further down!

	var i=0;
	var actualFacility={};
	var temp_level=-1;

	var specialCaseInProgress=0;

	for (i=0;i<ad2460.facilities.length ;i++ ){
		if (ad2460.facilities[i].building_id==building_id && ad2460.facilities[i].user_id>0 && ad2460.facilities[i].level>temp_level){
			temp_level=ad2460.facilities[i].level;
			actualFacility=ad2460.facilities[i];
		}
	}

	//console.log("Found ACTUAL facility id "+actualFacility.id);

	var info_container=document.getElementById('facilities_infopanel_content');
	// Clear out old data...
	$("#facilities_infopanel_content .facilitybg_addons").remove();
	$("#facilities_infopanel_content .facilitybg_noaddons").remove();
	// Prepare to render the new stuff

	var i=0;
	for (i=0;i<rootIdsWithAddons.length;i++ ){ // Just go through the root IDS.
		if (facilityId==rootIdsWithAddons[i]){
			var renderAddons=true;
			var x=0;
			for (x=0;x<rootIdsWithoutAddons.length;x++ ){
				if (rootIdsWithoutAddons[x]==rootIdsWithAddons[i]){
					renderAddons=false;
				}
			}

			var thisFacility=ad2460.facilities[returnInternalFacilityId(rootIdsWithAddons[i])];

			//console.log(thisFacility);


			if (thisFacility.user_id>0 || thisFacility.id==382 ){
				if (renderAddons===true){
					//console.log("Rendering addons too");
					// This requires one rendering model...
					var details1=find_addon_details(facilityId,1);
					var details2=find_addon_details(facilityId,2);
					var details3=find_addon_details(facilityId,3);
					var details4=find_addon_details(facilityId,4);

					var addon1Name=details1.name;
					var addon2Name=details2.name;
					var addon3Name=details3.name;
					var addon4Name=details4.name;

					var addon1Level=details1.level;
					var addon2Level=details2.level;
					var addon3Level=details3.level;
					var addon4Level=details4.level;

					var addon1Id=details1.id;
					var addon2Id=details2.id;
					var addon3Id=details3.id;
					var addon4Id=details4.id;

					var mainName=thisFacility.name;
					var mainLevel=actualFacility.level;
					var mainId=thisFacility.id;

					var outerContainer=document.createElement('div');
					outerContainer.setAttribute("class","facilitybg_addons");

					var imageContainer=document.createElement('div');
					imageContainer.setAttribute("class","facility_image_container");

					var facilityImage=document.createElement('img');
					facilityImage.setAttribute("src","images/tiles/facilitycenter01.png");

					var mainSelected=document.createElement('div');
					mainSelected.setAttribute("class","facility_main_selected");
					mainSelected.setAttribute("id","facility_main_selected");

					var addon1Selected=document.createElement('div');
					addon1Selected.setAttribute("class","facility_1_selected");
					addon1Selected.setAttribute("id","facility_1_selected");

					var addon2Selected=document.createElement('div');
					addon2Selected.setAttribute("class","facility_2_selected");
					addon2Selected.setAttribute("id","facility_2_selected");

					var addon3Selected=document.createElement('div');
					addon3Selected.setAttribute("class","facility_3_selected");
					addon3Selected.setAttribute("id","facility_3_selected");

					var addon4Selected=document.createElement('div');
					addon4Selected.setAttribute("class","facility_4_selected");
					addon4Selected.setAttribute("id","facility_4_selected");

					var mainUpgrade=document.createElement('div');
					mainUpgrade.setAttribute("class","facility_main_upgrade");

					var addon1Upgrade=document.createElement('div');
					addon1Upgrade.setAttribute("class","facility_1_upgrade");

					var addon2Upgrade=document.createElement('div');
					addon2Upgrade.setAttribute("class","facility_2_upgrade");

					var addon3Upgrade=document.createElement('div');
					addon3Upgrade.setAttribute("class","facility_3_upgrade");

					var addon4Upgrade=document.createElement('div');
					addon4Upgrade.setAttribute("class","facility_4_upgrade");

					var mainFacilityHeader=document.createElement('div');
					mainFacilityHeader.setAttribute("class","facility_main_facility_box");
					mainFacilityHeader.setAttribute("id","facilities_info_main_facility_header");
					mainFacilityHeader.setAttribute("onclick","facilityInfoClick("+mainId+","+mainLevel+",event)");
					mainFacilityHeader.innerHTML=mainName;

					var mainFacilitySubHeader=document.createElement('div');
					mainFacilitySubHeader.setAttribute("class","sub_facility_help_text");
					//mainFacilityHeader.setAttribute("id","facilities_info_main_facility_header");
					//mainFacilityHeader.setAttribute("onclick","facilityInfoClick("+mainId+","+mainLevel+")");
					mainFacilitySubHeader.innerHTML='Click any of the 4 facility sub-sections to select it';



					var facilityAddonBox1=document.createElement('div');
					facilityAddonBox1.setAttribute("class","facility_addon box_1");
					facilityAddonBox1.setAttribute("onclick","facilityInfoClick("+addon1Id+","+addon1Level+",event)");
					facilityAddonBox1.setAttribute("id","facility_addon box_1");

					var facilityAddonTable1=document.createElement('table');
					facilityAddonTable1.setAttribute("class","full_width_height");
					var facilityAddonTbody1=document.createElement('tbody');
					var facilityAddonTr1=document.createElement('tr');
					var facilityAddonTd1=document.createElement('td');
					facilityAddonTd1.setAttribute("id","facilities_info_addon_header_1");
					facilityAddonTd1.innerHTML=addon1Name;


					var facilityAddonBox2=document.createElement('div');
					facilityAddonBox2.setAttribute("class","facility_addon box_2");
					facilityAddonBox2.setAttribute("onclick","facilityInfoClick("+addon2Id+","+addon2Level+",event)");
					facilityAddonBox2.setAttribute("id","facility_addon box_2");
					var facilityAddonTable2=document.createElement('table');
					facilityAddonTable2.setAttribute("class","full_width_height");
					var facilityAddonTbody2=document.createElement('tbody');
					var facilityAddonTr2=document.createElement('tr');
					var facilityAddonTd2=document.createElement('td');
					facilityAddonTd2.setAttribute("id","facilities_info_addon_header_2");
					facilityAddonTd2.innerHTML=addon2Name;

					var facilityAddonBox3=document.createElement('div');
					facilityAddonBox3.setAttribute("class","facility_addon box_3");
					facilityAddonBox3.setAttribute("onclick","facilityInfoClick("+addon3Id+","+addon3Level+",event)");
					facilityAddonBox3.setAttribute("id","facility_addon box_3");
					var facilityAddonTable3=document.createElement('table');
					facilityAddonTable3.setAttribute("class","full_width_height");
					var facilityAddonTbody3=document.createElement('tbody');
					var facilityAddonTr3=document.createElement('tr');
					var facilityAddonTd3=document.createElement('td');
					facilityAddonTd3.setAttribute("id","facilities_info_addon_header_3");
					facilityAddonTd3.innerHTML=addon3Name;

					var facilityAddonBox4=document.createElement('div');
					facilityAddonBox4.setAttribute("class","facility_addon box_4");
					facilityAddonBox4.setAttribute("onclick","facilityInfoClick("+addon4Id+","+addon4Level+",event)");
					facilityAddonBox4.setAttribute("id","facility_addon box_4");
					var facilityAddonTable4=document.createElement('table');
					facilityAddonTable4.setAttribute("class","full_width_height");
					var facilityAddonTbody4=document.createElement('tbody');
					var facilityAddonTr4=document.createElement('tr');
					var facilityAddonTd4=document.createElement('td');
					facilityAddonTd4.setAttribute("id","facilities_info_addon_header_4");
					facilityAddonTd4.innerHTML=addon4Name;

					var mainLevelDiv=document.createElement('div');
					mainLevelDiv.setAttribute("class","facility_main_level facility_level");
					mainLevelDiv.setAttribute("id","facilities_info_main_facility_level");
					mainLevelDiv.innerHTML=mainLevel;

					var addon1LevelDiv=document.createElement('div');
					addon1LevelDiv.setAttribute("class","addon_1_level facility_level");
					addon1LevelDiv.setAttribute("id","facilities_info_addon_level_1");
					addon1LevelDiv.innerHTML=addon1Level;

					var addon2LevelDiv=document.createElement('div');
					addon2LevelDiv.setAttribute("class","addon_2_level facility_level");
					addon2LevelDiv.setAttribute("id","facilities_info_addon_level_2");
					addon2LevelDiv.innerHTML=addon2Level;

					var addon3LevelDiv=document.createElement('div');
					addon3LevelDiv.setAttribute("class","addon_3_level facility_level");
					addon3LevelDiv.setAttribute("id","facilities_info_addon_level_3");
					addon3LevelDiv.innerHTML=addon3Level;

					var addon4LevelDiv=document.createElement('div');
					addon4LevelDiv.setAttribute("class","addon_4_level facility_level");
					addon4LevelDiv.setAttribute("id","facilities_info_addon_level_4");
					addon4LevelDiv.innerHTML=addon4Level;

					outerContainer.appendChild(imageContainer);
						imageContainer.appendChild(facilityImage);
					outerContainer.appendChild(mainSelected);
					outerContainer.appendChild(addon1Selected);
					outerContainer.appendChild(addon2Selected);
					outerContainer.appendChild(addon3Selected);
					outerContainer.appendChild(addon4Selected);
					outerContainer.appendChild(mainUpgrade);
					outerContainer.appendChild(addon1Upgrade);
					outerContainer.appendChild(addon2Upgrade);
					outerContainer.appendChild(addon3Upgrade);
					outerContainer.appendChild(addon4Upgrade);
					outerContainer.appendChild(mainFacilitySubHeader);
					outerContainer.appendChild(mainFacilityHeader);


					facilityAddonBox1.appendChild(facilityAddonTable1);	facilityAddonTable1.appendChild(facilityAddonTbody1); facilityAddonTbody1.appendChild(facilityAddonTr1); facilityAddonTr1.appendChild(facilityAddonTd1);
					facilityAddonBox2.appendChild(facilityAddonTable2);	facilityAddonTable2.appendChild(facilityAddonTbody2); facilityAddonTbody2.appendChild(facilityAddonTr2); facilityAddonTr2.appendChild(facilityAddonTd2);
					facilityAddonBox3.appendChild(facilityAddonTable3);	facilityAddonTable3.appendChild(facilityAddonTbody3); facilityAddonTbody3.appendChild(facilityAddonTr3); facilityAddonTr3.appendChild(facilityAddonTd3);
					facilityAddonBox4.appendChild(facilityAddonTable4);	facilityAddonTable4.appendChild(facilityAddonTbody4); facilityAddonTbody4.appendChild(facilityAddonTr4); facilityAddonTr4.appendChild(facilityAddonTd4);

					outerContainer.appendChild(facilityAddonBox1);
					outerContainer.appendChild(facilityAddonBox2);
					outerContainer.appendChild(facilityAddonBox3);
					outerContainer.appendChild(facilityAddonBox4);
					outerContainer.appendChild(mainLevelDiv);
					outerContainer.appendChild(addon1LevelDiv);
					outerContainer.appendChild(addon2LevelDiv);
					outerContainer.appendChild(addon3LevelDiv);
					outerContainer.appendChild(addon4LevelDiv);

					info_container.appendChild(outerContainer);

					// this is where we must light up potential ongoing upgrades, methinks...
					if (actualFacility.upgrading>0){
						$(".facility_main_upgrade").stop().animate({opacity: 1},1000);
						$(".facility_1_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_2_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_3_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_4_upgrade").stop().animate({opacity: 0},1000);
					}
					if (details1.upgrading>0){
						$(".facility_main_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_1_upgrade").stop().animate({opacity: 1},1000);
						$(".facility_2_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_3_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_4_upgrade").stop().animate({opacity: 0},1000);

					}
					if (details2.upgrading>0){
						$(".facility_main_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_1_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_2_upgrade").stop().animate({opacity: 1},1000);
						$(".facility_3_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_4_upgrade").stop().animate({opacity: 0},1000);

					}
					if (details3.upgrading>0){
						$(".facility_main_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_1_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_2_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_3_upgrade").stop().animate({opacity: 1},1000);
						$(".facility_4_upgrade").stop().animate({opacity: 0},1000);

					}
					if (details4.upgrading>0){
						$(".facility_main_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_1_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_2_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_3_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_4_upgrade").stop().animate({opacity: 1},1000);

					}

					var currentupgradediv=document.createElement('div');
					currentupgradediv.setAttribute("class","facility_current_upgrade");

					var currentupgradename=document.createElement('div');
					currentupgradename.setAttribute("class","facility_current_upgrade_name");
					currentupgradename.innerHTML='No upgrade in progress';

					var currentupgradetimer=document.createElement('div');
					currentupgradetimer.setAttribute("class","queue_entry_eta facility");
					currentupgradetimer.setAttribute("id","current_upgrade_timer_2");
					currentupgradetimer.innerHTML='--:--';

					var currentupgradecancel=document.createElement('img');
					currentupgradecancel.setAttribute("class","facility_current_cancel");
					currentupgradecancel.setAttribute("src","images/fixed/cancel.png");
					currentupgradecancel.setAttribute("onclick","cancelCurrentFacilityUpgrade(event)");

					var fac=returnUpgradingFacility();
					//if (ad2460.facilityInProgress==true){
					if (fac){
						var current_name="";
						var time_left=0;
						var i=0;
						for (i=0;i<ad2460.facilities.length ;i++ ){
							if (ad2460.facilities[i].upgrading>0){
								current_name=ad2460.facilities[i].name;
								time_left=ad2460.facilities[i].end_time-ad2460.serverTime;
							}
						}
						currentupgradename.innerHTML=current_name;
						currentupgradetimer.innerHTML=secondsToFullTime(time_left);
						currentupgradediv.appendChild(currentupgradecancel);
						currentupgradediv.appendChild(currentupgradename);
						currentupgradediv.appendChild(currentupgradetimer);
						outerContainer.appendChild(currentupgradediv);
					}



				}
				else {
					// Render one with no addons
					//console.log("Not rendering addons");
					var mainName=thisFacility.name;
					var mainLevel=actualFacility.level;
					var mainId=thisFacility.id;

					if (specialCaseInProgress==1){
						mainLevel=0;
					}

					if (mainId==382){
						//console.log("Clicked on reverse engineering facility");
						//console.log(thisFacility);
						//console.log(actualFacility);
					}

					var outerContainer=document.createElement('div');
					outerContainer.setAttribute("class","facilitybg_noaddons");

					var imageContainer=document.createElement('div');
					imageContainer.setAttribute("class","facility_image_container");

					var facilityImage=document.createElement('img');
					facilityImage.setAttribute("src","images/tiles/facilitycenter01.png");

					var mainSelected=document.createElement('div');
					mainSelected.setAttribute("class","facility_main_selected");
					mainSelected.setAttribute("id","facility_main_selected");

					var mainUpgrade=document.createElement('div');
					mainUpgrade.setAttribute("class","facility_main_upgrade");

					var mainFacilityHeader=document.createElement('div');
					mainFacilityHeader.setAttribute("class","facility_main_facility_box");
					mainFacilityHeader.setAttribute("id","facilities_info_main_facility_header");
					mainFacilityHeader.setAttribute("onclick","facilityInfoClick("+mainId+","+mainLevel+",event)");
					mainFacilityHeader.innerHTML=mainName;

					var mainLevelDiv=document.createElement('div');
					mainLevelDiv.setAttribute("class","facility_main_level facility_level");
					mainLevelDiv.setAttribute("id","facilities_info_main_facility_level");
					mainLevelDiv.innerHTML=mainLevel;

					outerContainer.appendChild(imageContainer);
						imageContainer.appendChild(facilityImage);
					outerContainer.appendChild(mainSelected);
					outerContainer.appendChild(mainUpgrade);
					outerContainer.appendChild(mainFacilityHeader);
					outerContainer.appendChild(mainLevelDiv);
					info_container.appendChild(outerContainer);

					// this is where we must light up potential ongoing upgrades, methinks...
					if (actualFacility.upgrading>0){
						$(".facility_main_upgrade").stop().animate({opacity: 1},1000);
						$(".facility_1_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_2_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_3_upgrade").stop().animate({opacity: 0},1000);
						$(".facility_4_upgrade").stop().animate({opacity: 0},1000);
					}

					var currentupgradediv=document.createElement('div');
					currentupgradediv.setAttribute("class","facility_current_upgrade");

					var currentupgradename=document.createElement('div');
					currentupgradename.setAttribute("class","facility_current_upgrade_name");
					currentupgradename.innerHTML='No upgrade in progress';

					var currentupgradetimer=document.createElement('div');
					currentupgradetimer.setAttribute("class","queue_entry_eta facility");
					currentupgradetimer.setAttribute("id","current_upgrade_timer_2");
					currentupgradetimer.innerHTML='--:--';

					var currentupgradecancel=document.createElement('img');
					currentupgradecancel.setAttribute("class","facility_current_cancel");
					currentupgradecancel.setAttribute("src","images/fixed/cancel.png");
					currentupgradecancel.setAttribute("onclick","cancelCurrentFacilityUpgrade(event)");

					var fac=returnUpgradingFacility();
					if (fac){
					//if (ad2460.facilityInProgress==true){
						var current_name="";
						var time_left=0;
						var i=0;
						for (i=0;i<ad2460.facilities.length ;i++ ){
							if (ad2460.facilities[i].upgrading>0){
								current_name=ad2460.facilities[i].name;
								time_left=ad2460.facilities[i].end_time-ad2460.serverTime;
							}
						}
						currentupgradename.innerHTML=current_name;
						currentupgradetimer.innerHTML=secondsToFullTime(time_left);
						currentupgradediv.appendChild(currentupgradecancel);
						currentupgradediv.appendChild(currentupgradename);
						currentupgradediv.appendChild(currentupgradetimer);
						outerContainer.appendChild(currentupgradediv);
					}

				}
				//info_container.appendChild(mainFacilityBox);
			}
			//console.log("Calling facilityInfoClick("+thisFacility.id+","+find_facility_level(thisFacility.id)+")");
			//facilityInfoClick(thisFacility.id,thisFacility.level);



			if (reselect!=true){
				facilityInfoClick(thisFacility.id,find_facility_level(thisFacility.id));
			}
		}

	}
}

function clearCurrentFacilityUpgradeElements(){
	$(".facility_current_upgrade").remove();
}

function cancelCurrentFacilityUpgrade(event){
	var mainText='Are you sure you wish to cancel this Facility-upgrade?<br>(If you can not store all the returned resources, some resources might be lost.)';
	var okText='Yes';
	var cancelText='No';
	var okClick='cancelCurrentFacilityUpgradeConfirmed();hideConfirmationPopup();';
	var cancelClick='hideConfirmationPopup();';

	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick);
}

function cancelCurrentFacilityUpgradeConfirmed(event){
	var facility=returnUpgradingFacility();
	if (facility){
		$.post('actionhandler.pl', {action:'cancel_current_facility'}, function(data){ parseInfo(data);clearCurrentFacilityUpgradeElements();});
	}
}


function returnUpgradingFacility(){
	var facility=false;
	var i=0;
	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].upgrading>0){
			facility=ad2460.facilities[i];
		}
	}

	return facility;
}

function returnFacilityImage(id){
	var f=returnGameObjectById(id);
	if (f.parent_id==0){
		return id+".jpg";
	}
	else {
		return f.parent_id+".jpg";
	}
}

function facilityInfoClick(facilityId,currentLevel,event){
	// console.log("facilityInfoClick("+facilityId+","+currentLevel+") called");

	/*
		#facility_img src
		#facilityslidebutton onclick?? Show some slide? or not?
		#selected_facility_description innerHTML
		#current_facility_bonus_description innerHTML
		#next_facility_bonus_description innerHTML
		#selected_facility_name innerHTML
		#facility_upgrade_button  show / hide ?
	*/

	ad2460.homeworldSelectedItems.facility_info_id=facilityId;
	ad2460.homeworldSelectedItems.facility_info_level=currentLevel;


	var thisFacility=ad2460.facilities[returnInternalFacilityId(facilityId)];
	var nextFacility=findNextFacility(thisFacility,currentLevel);
	// console.log(nextFacility.name+" Lvl:"+nextFacility.level);

	if (event){
		if(event.shiftKey) {
			handleShiftClickObjectWithId(facilityId);
			return;
		}
	}

	var currentActualFacility={};
	// Find the right facility by matching up thisFacility.building_id and level+1
	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].building_id==thisFacility.building_id && ad2460.facilities[i].level==currentLevel){
			currentActualFacility=ad2460.facilities[i];
		}
	}


	// Check for empty nextFacility in case it's at the max level
	var emptyNext=true;
	if(nextFacility.hasOwnProperty('level')){
		emptyNext=false;
	}

	var facility_image_source='';
	var facility_slide_button_onclick='';
	var selected_facility_description='';
	var current_facility_bonus_description='N/A';
	var next_facility_bonus_description='';
	var next_facility_time_description='';
	var selected_facility_name='';

	var facilityUpgradeInProgress=false;
	var i=0;
	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].upgrading>0)	{
			facilityUpgradeInProgress=true;
		}
	}

	facility_image_source=returnFacilityImage(facilityId);

	facility_image_source='images/icons/facility/'+returnFacilityImage(facilityId);
	selected_facility_name=ad2460.facilities[returnInternalFacilityId(facilityId)].name+" Level "+currentLevel;

	if (currentLevel==0){
		selected_facility_description=ad2460.facilities[returnInternalFacilityId(facilityId)].description;
		current_facility_bonus_description=ad2460.facilities[returnInternalFacilityId(facilityId)].bonus_description;
		current_facility_bonus_description='This facility-addon is not yet active. Upgrade it to level 1 to activate it.';

	}

	if (currentLevel>0){
		selected_facility_description=currentActualFacility.description;
		//current_facility_bonus_description=ad2460.facilities[returnInternalFacilityId(facilityId)].bonus_description;
		current_facility_bonus_description=currentActualFacility.bonus_description;
	}


	if (emptyNext===false)	{
		next_facility_bonus_description=nextFacility.bonus_description;
		// Implement support for time-bonuses provided by research 194
		var timeBonus=0;
		var r=returnGameObjectById(194);
		if (r){
			if (r.user_id==ad2460.user_id && r.upgrading==0){
				timeBonus+=10;
			}
		}
		var r=returnGameObjectById(106);
		if (r){
			if (r.user_id==ad2460.user_id && r.upgrading==0){
				timeBonus+=5;
			}
		}

		var r=returnGameObjectById(187);
		if (r){
			if (r.user_id==ad2460.user_id && r.upgrading==0){
				timeBonus+=10;
			}
		}

		var cost_bonus_percent=0;
		var r=returnGameObjectById(102);
		if (r){
			if (r.user_id==ad2460.user_id && r.upgrading==0){
				cost_bonus_percent+=5;
			}
		}

		var obj=returnGameObjectById(622);
		if (obj!=false){
			if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 ){
				timeBonus+=10;
				cost_bonus_percent+=10;
			}
		}

		var obj=returnGameObjectById(623);
		if (obj!=false){
			if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 ){
				timeBonus+=10;
				cost_bonus_percent+=10;
			}
		}

		var obj=returnGameObjectById(624);
		if (obj!=false){
			if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 ) {
				timeBonus+=10;
				cost_bonus_percent+=10;
			}
		}

		var timeCost=nextFacility.time_cost-Math.floor(nextFacility.time_cost*timeBonus/100);
		next_facility_time_description=secondsToFullTime(timeCost);

		var h_cost=Math.floor(nextFacility.h_cost-(nextFacility.h_cost*cost_bonus_percent/100));
		var i_cost=Math.floor(nextFacility.i_cost-(nextFacility.i_cost*cost_bonus_percent/100));
		var s_cost=Math.floor(nextFacility.s_cost-(nextFacility.s_cost*cost_bonus_percent/100));
		var n_cost=Math.floor(nextFacility.n_cost-(nextFacility.n_cost*cost_bonus_percent/100));

		document.getElementById('fac_hscost').innerHTML=prettyPrint(h_cost);
		document.getElementById('fac_incost').innerHTML=prettyPrint(i_cost);
		document.getElementById('fac_srcost').innerHTML=prettyPrint(s_cost);
		document.getElementById('fac_ndcost').innerHTML=prettyPrint(n_cost);

		var hasEnoughRes=true;

		if (h_cost>ad2460.resources.hassium)	{	hasEnoughRes=false;	$("#fac_hscost").addClass("notenough");	} else { $("#fac_hscost").removeClass("notenough");	}
		if (n_cost>ad2460.resources.neodymium)	{	hasEnoughRes=false;	$("#fac_ndcost").addClass("notenough");	} else { $("#fac_ndcost").removeClass("notenough");	}
		if (s_cost>ad2460.resources.strontium)	{	hasEnoughRes=false;	$("#fac_srcost").addClass("notenough");	} else { $("#fac_srcost").removeClass("notenough");	}
		if (i_cost>ad2460.resources.indium)	{	hasEnoughRes=false;	$("#fac_incost").addClass("notenough");	} else { $("#fac_incost").removeClass("notenough");	}

		// var available=checkAvailability(thisFacility);
		var available=checkAvailability(nextFacility);
		//console.log("Available = "+available);
		if (currentLevel>0){
			$('#faccost div.buttontext').html('Upgrade');
		}
		else {
			$('#faccost div.buttontext').html('Build');
		}

		if ( (available==true) && (ad2460.facilityInProgress==false) && (emptyNext==false) && (hasEnoughRes==true)){

			activateFacilityOrderButton(nextFacility.id);
		}
		else {
			if (facilityUpgradeInProgress==true){
				deactivateFacilityOrderButton(translations.homeworld_facility_already_building);
			}
			else if (hasEnoughRes==false){
				deactivateFacilityOrderButton(translations.homeworld_facility_not_enough_res);
			}
			else if (available==false){
				deactivateFacilityOrderButton(translations.homeworld_facility_requirements_not_met);
			}
			else {
				deactivateFacilityOrderButton(translations.general_error);
			}


		}
		$('#faccost').show();

		var reqObj=checkAllRequirementsForItemId(nextFacility.id);
		if (reqObj.development && reqObj.research && reqObj.facility && reqObj.techtree && reqObj.special){
			$("#selected_fac_item_available_info").removeClass("red").addClass("green");
		}
		else {
			$("#selected_fac_item_available_info").removeClass("green").addClass("red");
		}
		$("#selected_fac_item_available_info").show();
		document.getElementById('selected_fac_item_available_info').setAttribute("onclick","showBuildTreeInfo("+nextFacility.id+",event, true)");


	}
	else {
		next_facility_bonus_description="No further upgrades are available.";
		$('#faccost').hide();
		$("#selected_fac_item_available_info").hide();
	}


	document.getElementById('facility_sidepanel_selected_facility_image').setAttribute("src",facility_image_source);

	document.getElementById('facility_selected_item_stat_facilitydescription').innerHTML=selected_facility_description;
	document.getElementById('current_facility_bonus_description').innerHTML=current_facility_bonus_description;
	document.getElementById('next_facility_bonus_description').innerHTML=next_facility_bonus_description;
	document.getElementById('next_facility_selected_item_stat_time').innerHTML=next_facility_time_description;
	document.getElementById('facility_selected_item_stat_facilityname').innerHTML=selected_facility_name;

	// Now I need to turn on the selected-thingie...
	if (thisFacility.addon_group==0){
		$("#facility_1_selected").stop().animate({opacity: 0},600);
		$("#facility_2_selected").stop().animate({opacity: 0},600);
		$("#facility_3_selected").stop().animate({opacity: 0},600);
		$("#facility_4_selected").stop().animate({opacity: 0},600);
		$("#facility_main_selected").stop().animate({opacity: 1},200);
	}
	else if (thisFacility.addon_group==1){
		$("#facility_1_selected").stop().animate({opacity: 1},200);
		$("#facility_2_selected").stop().animate({opacity: 0},600);
		$("#facility_3_selected").stop().animate({opacity: 0},600);
		$("#facility_4_selected").stop().animate({opacity: 0},600);
		$("#facility_main_selected").stop().animate({opacity: 0},600);
	}
	else if (thisFacility.addon_group==2){
		$("#facility_1_selected").stop().animate({opacity: 0},600);
		$("#facility_2_selected").stop().animate({opacity: 1},200);
		$("#facility_3_selected").stop().animate({opacity: 0},600);
		$("#facility_4_selected").stop().animate({opacity: 0},600);
		$("#facility_main_selected").stop().animate({opacity: 0},600);
	}
	else if (thisFacility.addon_group==3){
		$("#facility_1_selected").stop().animate({opacity: 0},600);
		$("#facility_2_selected").stop().animate({opacity: 0},600);
		$("#facility_3_selected").stop().animate({opacity: 1},200);
		$("#facility_4_selected").stop().animate({opacity: 0},600);
		$("#facility_main_selected").stop().animate({opacity: 0},600);
	}
	else if (thisFacility.addon_group==4){
		$("#facility_1_selected").stop().animate({opacity: 0},600);
		$("#facility_2_selected").stop().animate({opacity: 0},600);
		$("#facility_3_selected").stop().animate({opacity: 0},600);
		$("#facility_4_selected").stop().animate({opacity: 1},200);
		$("#facility_main_selected").stop().animate({opacity: 0},600);
	}

}

function findNextFacility(thisFacility,currentLevel){
	var nextFacility={};
	var i=0;

	//console.log("findNextFacility called: Building-id"+thisFacility.building_id);

	var currentActualFacility={};
	// Find the right facility by matching up thisFacility.building_id and level+1
	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].building_id==thisFacility.building_id && ad2460.facilities[i].level==currentLevel){
			currentActualFacility=ad2460.facilities[i];
		}
		if (ad2460.facilities[i].building_id==thisFacility.building_id && ad2460.facilities[i].level==(currentLevel+1)){
			nextFacility=ad2460.facilities[i];
		}
	}

	//console.log("Returning "+nextFacility.id);
	return nextFacility;
}

function facilityUpgradeButtonClick(facilityId,currentLevel,event){
	// make the call!
}

function updateHomeworldCenterSliders(){
	var i=0;

	var sliderStatus='center_blank';
	ad2460.facilityInProgress=false;
	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].user_id<0)	{
			// ignore the unused energy stations
			if (ad2460.facilities[i].id!=361 && ad2460.facilities[i].id!=362 && ad2460.facilities[i].id!=363 ) {
				sliderStatus='center_idle';
			}
		}
	}
	for (i=0;i<ad2460.facilities.length;i++ ){
		if (ad2460.facilities[i].upgrading==1)	{
			sliderStatus='center_progress';
			ad2460.facilityInProgress=true;
		}
	}
	$("#facility_center_slider div").removeClass('center_blank').removeClass('center_idle').removeClass('center_progress').addClass(sliderStatus);


	sliderStatus='center_blank';
	ad2460.researchInProgress=false;
	for (i=0;i<ad2460.researches.length;i++ ){
		if (ad2460.researches[i].user_id<0)	{
			sliderStatus='center_idle';
		}
	}
	for (i=0;i<ad2460.researches.length;i++ ){
		if (ad2460.researches[i].upgrading==1)	{
			sliderStatus='center_progress';
			ad2460.researchInProgress=true;
		}
	}
	$("#research_center_slider div").removeClass('center_blank').removeClass('center_idle').removeClass('center_progress').addClass(sliderStatus);

	sliderStatus='center_blank';
	ad2460.developmentInProgress=false;
	for (i=0;i<ad2460.developments.length;i++ ){
		if (ad2460.developments[i].user_id<0)	{
			sliderStatus='center_idle';
		}
	}
	for (i=0;i<ad2460.developments.length;i++ ){
		if (ad2460.developments[i].upgrading==1)	{
			sliderStatus='center_progress';
			ad2460.developmentInProgress=true;
		}
	}
	$("#development_center_slider div").removeClass('center_blank').removeClass('center_idle').removeClass('center_progress').addClass(sliderStatus);

	// We need to add the same logic to the production-slider as well, but that functionality is not yet ready...
	// Don't forget it though!

	var maxProdQueueLength=10;
	var f1=returnGameObjectById(343);
	if (f1.user_id>0 && f1.upgrading==0){	maxProdQueueLength=20;	}
	var f2=returnGameObjectById(344);
	if (f2.user_id>0  && f2.upgrading==0){	maxProdQueueLength=30;	}
	var f3=returnGameObjectById(345);
	if (f3.user_id>0 && f3.upgrading==0) {	maxProdQueueLength=40;	}


	sliderStatus='center_blank';
	ad2460.productionInProgress=false;
	if (ad2460.productionqueue.length==0){
		sliderStatus='center_idle';
	}
	if (ad2460.productionqueue.length>0 && ad2460.productionqueue.length<maxProdQueueLength){
		sliderStatus='center_full';
		ad2460.productionInProgress=true;
	}
	if (ad2460.productionqueue.length==maxProdQueueLength){
		sliderStatus='center_progress';
		ad2460.productionInProgress=true;
	}


	$("#production_center_slider div").removeClass('center_blank').removeClass('center_idle').removeClass('center_progress').removeClass('center_full').addClass(sliderStatus);




}

function checkDevelopmentRequirement(required_development_id){
	// Check if the user has this development completed. If so, return true. Else, return false.
	// If the required_development_id is 0, return true
	var i=0;
	if (required_development_id==0)	{
		return true;
	}

	var x=returnGameObjectById(required_development_id);
	if (x.id==required_development_id && x.user_id>0 && x.upgrading==0){
		return true;
	}

	return false;
}

function checkFacilityRequirement(required_facility_id){
	// Check if the user has this facility completed. If so, return true. Else, return false.
	// If the required_facility_id is 0, return true
	var i=0;
	if (required_facility_id==0)	{
		return true;
	}

	var x=returnGameObjectById(required_facility_id);
	if (x.id==required_facility_id && x.user_id>0 && x.upgrading==0){
		return true;
	}

	return false;
}

function checkResearchRequirement(required_research_id){
	// Check if the user has this research completed. If so, return true. Else, return false.
	// If the required_research_id is 0, return true
	var i=0;
	if (required_research_id==0)	{
		return true;
	}

	var x=returnGameObjectById(required_research_id);
	if (x.id==required_research_id && x.user_id>0 && x.upgrading==0){
		return true;
	}

	return false;
}

function checkSpecialRequirement(special_requirement){
	// Check if the user has this special completed. If so, return true. Else, return false.
	// If it's 0, return true
	if (special_requirement==0){
		return true;
	}

	if (special_requirement<100){
		// level-check
		if (ad2460.scores.level>=special_requirement){
			return true;
		}
		else {
			return false;
		}
	}

	// If the special requirement is between 101 and 199, it is just an extra research-check..
	if (special_requirement>100 && special_requirement<200){
		var resCheck=checkResearchRequirement(special_requirement);
		return resCheck;
	}

	if (special_requirement>=800 && special_requirement<900){
		var obj=returnGameObjectById(special_requirement);
		if (obj!=false){
			if (obj.points==obj.max_points){
				return true;
			}
			else return false;
		}
	}

	// Lets check the playerflags then, for these specials...
	var i=0;
	for (i=0;i<ad2460.playerflags ;i++ ){
		if (special_requirement==ad2460.playerflags[i])	{
			return true;
		}
	}



	return false;

}

function checkTechtreeRequirement(required_points_tree,required_tech_tree_points){
	if (required_points_tree=='None'){
		return true;
	}
	if (required_tech_tree_points==0){
		return true;
	}

	if (required_points_tree=='Matter'){
		if (ad2460.techVariables.spentTechPointsMatter>=required_tech_tree_points){
			return true;
		}
		else {
			return false;
		}
	}
	if (required_points_tree=='Energy'){
		if (ad2460.techVariables.spentTechPointsEnergy>=required_tech_tree_points){
			return true;
		}
		else {
			return false;
		}
	}
	if (required_points_tree=='Displacement'){
		if (ad2460.techVariables.spentTechPointsDisplacement>=required_tech_tree_points){
			return true;
		}
		else {
			return false;
		}
	}
	if (required_points_tree=='General'){
		if (ad2460.techVariables.spentTechPointsMatter+ad2460.techVariables.spentTechPointsEnergy+ad2460.techVariables.spentTechPointsDisplacement  >= required_tech_tree_points){
			return true;
		}
		else {
			return false;
		}
	}

}

function renderFacilities_current(view){
	// This is fairly straight forward..Almost...
	// We must render the different panels individually here..

	// Traverse the ad2460.facilities and figure out what to draw in the lowpanel
	// The view (optional) decides what to render.
	// If view is undefined, it means "available"
	// Completed researches should never be rendered here.

	removeChildNodes('facility_list_container');
	removeChildNodes('infopanel_current_facility_container');
	removeChildNodes('infopanel_completed_facility_container');

	myScrollToTop('facility_list_container',150);

	var i=0;
	var renderMode='available';
	if (view == 'all'){ renderMode='all'; }
	if (view == 'unavailable'){ renderMode='unavailable'; }

	var firstRenderedId=-1;

	var container=document.getElementById('facility_list_container');
	var i=0;
	if (renderMode=='all'){
		$("#facility_unitselection").html('All facilities');
		$("#facility_filter_button_all").attr('src','images/fixed/radioselect.png');
		$("#facility_filter_button_available").attr('src','images/fixed/radiounselect.png');
		$("#facility_filter_button_unavailable").attr('src','images/fixed/radiounselect.png');

		// Simple, never mind the requirements, all but the completed ones should be rendered
		for (i=0;i<ad2460.facilities.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.facilities[i];
			if (thisItem.user_id<1)	{
				// Render it!
				if (firstRenderedId==-1){
					firstRenderedId=thisItem.id;
				}

				var facilityItem=document.createElement('div');
				facilityItem.setAttribute("class","selectionitem");
				facilityItem.setAttribute("onclick","facilityItemClick("+thisItem.id+",event)");

				var facilityPicture=document.createElement('img');

				facilityPicture.setAttribute("src","images/icons/facility/"+thisItem.id+".jpg");
				// HACK TO MAKE IT WORK WHILE WAITING FOR THE IMAGES...
				//var fakeId=101+ (thisItem.id % 2);
				//facilityPicture.setAttribute("src","images/icons/facility/"+fakeId+".jpg");
				// END HACK

				facilityPicture.setAttribute("class","selectionitem_img");

				facilityItem.appendChild(facilityPicture);
				container.appendChild(facilityItem);
			}
		}
	}
	else if (renderMode == 'unavailable'){
		$("#facility_unitselection").html('Unavailable facilities');
		$("#facility_filter_button_all").attr('src','images/fixed/radiounselect.png');
		$("#facility_filter_button_available").attr('src','images/fixed/radiounselect.png');
		$("#facility_filter_button_unavailable").attr('src','images/fixed/radioselect.png');

		// Not so simple...We need to perform all checks on requirements, and if ALL fail, we can draw it :)
		for (i=0;i<ad2460.facilities.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.facilities[i];
			if (thisItem.user_id<1)	{
				var renderItem=true;
				var requiredDevelopmentIdCheck	=	checkDevelopmentRequirement(thisItem.required_development_id);
				var requiredFacilityIdCheck		=	checkFacilityRequirement(thisItem.required_facility_id);
				var requiredResearchIdCheck		=	checkResearchRequirement(thisItem.required_research_id);
				var requiredSpecialIdCheck		=	checkSpecialRequirement(thisItem.special_requirement);
				var requiredTechPointsCheck		=	checkTechtreeRequirement(thisItem.required_points_tree,thisItem.required_tech_tree_points);

				// If one of the checks return false, it's unavailable, and should be drawn...
				if (requiredDevelopmentIdCheck===false || requiredFacilityIdCheck===false || requiredResearchIdCheck===false || requiredSpecialIdCheck===false || requiredTechPointsCheck===false ){
					if (firstRenderedId==-1){
						firstRenderedId=thisItem.id;
					}


					var facilityItem=document.createElement('div');
					facilityItem.setAttribute("class","selectionitem");
					facilityItem.setAttribute("onclick","facilityItemClick("+thisItem.id+",event)");

					var facilityPicture=document.createElement('img');

					facilityPicture.setAttribute("src","images/icons/facility/"+thisItem.id+".jpg");
					// HACK TO MAKE IT WORK WHILE WAITING FOR THE IMAGES...
					//var fakeId=101+ (thisItem.id % 2);
					//facilityPicture.setAttribute("src","images/icons/facility/"+fakeId+".jpg");
					// END HACK

					facilityPicture.setAttribute("class","selectionitem_img");

					facilityItem.appendChild(facilityPicture);
					container.appendChild(facilityItem);
				}
			}
		}
	}
	else if (renderMode == 'available'){
		$("#facility_unitselection").html('Available facilities');
		$("#facility_filter_button_all").attr('src','images/fixed/radiounselect.png');
		$("#facility_filter_button_available").attr('src','images/fixed/radioselect.png');
		$("#facility_filter_button_unavailable").attr('src','images/fixed/radiounselect.png');
		// Here, all checks must return true
		for (i=0;i<ad2460.facilities.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.facilities[i];
			if (thisItem.user_id<1)	{
				var renderItem=true;
				var requiredDevelopmentIdCheck	=	checkDevelopmentRequirement(thisItem.required_development_id);
				var requiredFacilityIdCheck		=	checkFacilityRequirement(thisItem.required_facility_id);
				var requiredResearchIdCheck		=	checkResearchRequirement(thisItem.required_research_id);
				var requiredSpecialIdCheck		=	checkSpecialRequirement(thisItem.special_requirement);
				var requiredTechPointsCheck		=	checkTechtreeRequirement(thisItem.required_points_tree,thisItem.required_tech_tree_points);

				// If one of the checks return false, it's unavailable, and should be drawn...
				if (requiredDevelopmentIdCheck===true && requiredFacilityIdCheck===true && requiredResearchIdCheck===true && requiredSpecialIdCheck===true && requiredTechPointsCheck===true ){
					if (firstRenderedId==-1){
						firstRenderedId=thisItem.id;
					}

					var facilityItem=document.createElement('div');
					facilityItem.setAttribute("class","selectionitem");
					facilityItem.setAttribute("onclick","facilityItemClick("+thisItem.id+",event)");

					var facilityPicture=document.createElement('img');

					facilityPicture.setAttribute("src","images/icons/facility/"+thisItem.id+".jpg");
					// HACK TO MAKE IT WORK WHILE WAITING FOR THE IMAGES...
					//var fakeId=101+ (thisItem.id % 2);
					//facilityPicture.setAttribute("src","images/icons/facility/"+fakeId+".jpg");
					// END HACK

					facilityPicture.setAttribute("class","selectionitem_img");

					facilityItem.appendChild(facilityPicture);
					container.appendChild(facilityItem);
				}
			}
		}
	}


	// That should complete all render-methods for the lowpanel

	// The infopanel can be rendered next. Just list the current ongoing research, if any.
	// Then the list of completed ones beneath. Simple.
	var currently_building=false;
	for (i=0;i<ad2460.facilities.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.facilities[i];
		if (thisItem.upgrading==1){

			// We are facilitying stuff!
			currently_building=true;
			var container=document.getElementById('infopanel_current_facility_container');

			var queueContainer=document.createElement('div');
			var queueEntryTop=document.createElement('div');
			var queueEntryContentContainer=document.createElement('div');
			var queueEntryName=document.createElement('div');
			var queueEntryEta=document.createElement('div');
			var queueEntryEtaSpan=document.createElement('span');
			var queueEntryCancelDiv=document.createElement('div');
			var queueEntryCancelImg=document.createElement('img');
			var queueEntryInfo=document.createElement('div');
			var queueEntryImgDiv=document.createElement('div');
			var queueEntryImg=document.createElement('img');

			queueContainer.setAttribute("class","queue_container");
			queueEntryTop.setAttribute("class","queue_entry_top");
			queueEntryTop.setAttribute("id","current_facility_expand_row");

			queueEntryContentContainer.setAttribute("class","queue_entry_content_container");
			queueEntryName.setAttribute("class","queue_entry_name");
			queueEntryEta.setAttribute("class","queue_entry_eta");
			// queueEntryEtaSpan.setAttribute("class","infopanel_header");
			queueEntryCancelDiv.setAttribute("class","queue_entry_icons");
			queueEntryInfo.setAttribute("class","queue_entry_info");
			queueEntryImgDiv.setAttribute("class","queue_entry_img");

			queueEntryCancelImg.setAttribute("src","images/fixed/cancel.png");
			queueEntryCancelImg.setAttribute("onclick","cancelCurrentFacilityClick(event)");
			queueEntryImg.setAttribute("src","images/icons/facility/"+thisItem.id+".jpg");

			queueEntryName.innerHTML=thisItem.name+' Lvl '+thisItem.level;
			queueEntryInfo.innerHTML=thisItem.description;


			queueEntryTop.onclick=function(){
				if (expanderOpen==0) {
					openSelectedRowTop('current_facility_expand_row');
				}
				else if (expanderOpen==1) {
					closeSelectedRow('current_facility_expand_row');
				}
			};

			// Here we need to register a timer, somehow, and then tie it to this DOM-node.
			var timerId='currentFacilityProgressTimer';
			queueEntryEtaSpan.setAttribute('id',timerId);
			queueEntryEtaSpan.setAttribute('class','longtime');
			registerNewTimer(timerId, ['process_1_eta','current_upgrade_timer_2'], ['process_1_progress'], thisItem.start_time, thisItem.end_time, function(){fetchAllTechData();});


			queueContainer.appendChild(queueEntryTop);
			queueEntryTop.appendChild(queueEntryContentContainer);
			queueEntryContentContainer.appendChild(queueEntryName);
			queueEntryContentContainer.appendChild(queueEntryEta);
			queueEntryEta.appendChild(queueEntryEtaSpan);
			queueEntryEta.appendChild(queueEntryCancelDiv);
			queueEntryCancelDiv.appendChild(queueEntryCancelImg);
			queueEntryContentContainer.appendChild(queueEntryInfo);
			queueEntryContentContainer.appendChild(queueEntryImgDiv);
			queueEntryImgDiv.appendChild(queueEntryImg);

			container.appendChild(queueContainer);

		}
	}


	// Then the list of completed ones beneath. Simple.

	// Sorting by end_time
	ad2460.facilities.sort(function(a, b){ return b.end_time-a.end_time });

	var foundCompletedFacilities=false;

	var numberOfCompletedFacilities=0;
	for (i=0;i<ad2460.facilities.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.facilities[i];
		if (thisItem.user_id>0 && thisItem.upgrading==0){
			foundCompletedFacilities=true;

			numberOfCompletedFacilities++;

			// Render it in the list of completed facilities...Quite simple this one...

			// Errrr...Container....Deletion-issues....Reload-issues...We need something magical here....
			var container=document.getElementById('infopanel_completed_facility_container');

			var completedFacilityContainer=document.createElement('div');
			var completedFacilityName=document.createElement('div');
			var completedFacilityTimestamp=document.createElement('div');

			completedFacilityContainer.setAttribute("class","rescomp_entry");
			completedFacilityName.setAttribute("class","rescomp_name");
			completedFacilityTimestamp.setAttribute("class","rescomp_timestamp");

			completedFacilityName.innerHTML=thisItem.name+' Lvl '+thisItem.level;
			completedFacilityTimestamp.innerHTML=formatDateTime(thisItem.end_time);

			completedFacilityContainer.appendChild(completedFacilityName);
			completedFacilityContainer.appendChild(completedFacilityTimestamp);

			container.appendChild(completedFacilityContainer);
		}
	}

	// re-Sorting by id
	ad2460.facilities.sort(function(a, b){ return b.id-a.id });


	if (foundCompletedFacilities===true){
		$("#completed_facility_helptext").html('Click on the completed facility to view it in the build-tree.');
	}
	else {
		$("#completed_facility_helptext").html('You have no completed facility-projects.');
	}

	if (numberOfCompletedFacilities>5){
		$("#completed_facilities_scrollbar_down").show();
		$("#completed_facilities_scrollbar_up").show();
	}

	// Then decide what to auto-click in the lowpanel..
	// If there is a facility in progress, auto-click it to update the sidepanel.
	// If not, click the first one in the list of visible items in the lowpanel. Use the facilityItemClick(id) function
	var foundOne=false;
	for (i=0;i<ad2460.facilities.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.facilities[i];
		if (thisItem.upgrading==1){
			facilityItemClick(thisItem.id);
			foundOne=true;
			$("#current_facility_helptext").html('Click on the facility to view more details.');
			$('#process_1_name').html(thisItem.name);
			$('#process_1_colour').show();

		}
	}

	if (foundOne===false){
		$("#current_faciliy_helptext").html('Your construction-teams are currently idle.');
		$('#process_1_progress').css('width','0%');
		$('#process_1_eta').html('');
		$('#process_1_colour').hide();
		$('#process_1_name').html('No facility under construction');
	}
}

function facilityItemClick(id,event){
	//console.log("facilityItemClick called with ",id);
	// play_multi_sound('sfx_click1');
	// console.log("facilityItemClick("+id+") called");
	// Traverse the facilities, and plot the info in the sidepanel
	if (event){
		if(event.shiftKey) {
			handleShiftClickObjectWithId(id);
			return;
		}
	}


	var i=0;
	for (i=0;i<ad2460.facilities.length ;i++ ){
		thisItem=ad2460.facilities[i];
		if (thisItem.id==id){
			$("#facility_selected_item_stat_facilityname").html(thisItem.name+' Lvl '+thisItem.level);
			$("#facility_selected_item_stat_facilitydescription").html(thisItem.description);
			$("#current_facility_bonus_description").html(thisItem.bonus_description);

			$("#facility_selected_item_stat_time").html(secondsToFullTimeLong(thisItem.time_cost));

			document.getElementById('fac_hscost').innerHTML=prettyPrint(thisItem.h_cost);
			document.getElementById('fac_ndcost').innerHTML=prettyPrint(thisItem.n_cost);
			document.getElementById('fac_srcost').innerHTML=prettyPrint(thisItem.s_cost);
			document.getElementById('fac_incost').innerHTML=prettyPrint(thisItem.i_cost);

			var hasEnoughRes=true;

			if (thisItem.h_cost>ad2460.resources.hassium)	{	hasEnoughRes=false;	$("#fac_hscost").addClass("notenough");	} else { $("#fac_hscost").removeClass("notenough");	}
			if (thisItem.n_cost>ad2460.resources.neodymium)	{	hasEnoughRes=false;	$("#fac_ndcost").addClass("notenough");	} else { $("#fac_ndcost").removeClass("notenough");	}
			if (thisItem.s_cost>ad2460.resources.strontium)	{	hasEnoughRes=false;	$("#fac_srcost").addClass("notenough");	} else { $("#fac_srcost").removeClass("notenough");	}
			if (thisItem.i_cost>ad2460.resources.indium)	{	hasEnoughRes=false;	$("#fac_incost").addClass("notenough");	} else { $("#fac_incost").removeClass("notenough");	}

			var available=checkAvailability(thisItem);
			if (available==true && ad2460.facilityInProgress==false && hasEnoughRes==true){
				activateFacilityOrderButton(thisItem.id);
			}
			else {
				if (ad2460.facilityInProgress==true){
					deactivateFacilityOrderButton('Upgrading...');
				}
				else if (hasEnoughRes==false){
					deactivateFacilityOrderButton('Not enough resources');
				}
				else if (available==false){
					deactivateFacilityOrderButton('Not yet available');
				}
				else {
					deactivateFacilityOrderButton('');
				}
				//deactivateFacilityOrderButton();
			}
		}
	}
}


// PRODUCTION
function setProductionitemsStatusbits(){
	var i=0;
	for (i=0;i<ad2460.productionitems.length;i++ ){ // Traversing-time!

		thisItem=ad2460.productionitems[i];

		var requiredDevelopmentIdCheck	=	checkDevelopmentRequirement(thisItem.required_development_id);
		var requiredFacilityIdCheck		=	checkFacilityRequirement(thisItem.required_facility_id);
		var requiredResearchIdCheck		=	checkResearchRequirement(thisItem.required_research_id);
		var requiredSpecialIdCheck		=	checkSpecialRequirement(thisItem.special_requirement);
		var requiredTechPointsCheck		=	checkTechtreeRequirement(thisItem.required_points_tree,thisItem.required_tech_tree_points);

		if (requiredDevelopmentIdCheck == true && requiredFacilityIdCheck==true && requiredResearchIdCheck==true && requiredSpecialIdCheck==true && requiredTechPointsCheck==true){
			thisItem.user_id=user_id;
		}
		else {
			thisItem.user_id=0;

		}
	}
}


function renderProductionitems(view){
	// This is fairly straight forward..Almost...
	// We must render the different panels individually here..

	// Traverse the ad2460.productionitems and figure out what to draw in the lowpanel
	// The view (optional) decides what to render.
	// If view is undefined, it means "available"

	if (view!='available' && view!='unavailable' && view!='all' ){
		if (ad2460.homeworldSelectedItems.production_view!=''){
			view=ad2460.homeworldSelectedItems.production_view;
		}
	}

	ad2460.homeworldSelectedItems.production_view=view;

	removeChildNodes('production_list_container');
	removeChildNodes('infopanel_current_production_container');
	removeChildNodes('infopanel_completed_production_container');

	//myScrollToTop('production_list_container',0);


	//$("#production_list_container").css({opacity:0}).transition({opacity:1},500);


	setProductionitemsStatusbits();

	var i=0;
	var renderMode='available';
	if (view == 'all'){ renderMode='all'; }
	if (view == 'unavailable'){ renderMode='unavailable'; }

	if (renderMode=='available'){
		$('#production_filter_slider').transition({x: '0px'},300, 'cubic-bezier(0.500, 0.500, 0.500, 1.000)');
	}
	else if (renderMode=='unavailable'){
		$('#production_filter_slider').transition({x: '-113px'},300, 'cubic-bezier(0.500, 0.500, 0.500, 1.000)');
	}
	else if (renderMode=='all'){
		$('#production_filter_slider').transition({x: '113px'},300, 'cubic-bezier(0.500, 0.500, 0.500, 1.000)');
	}

	var firstRenderedId=-1;

	var container=document.getElementById('production_list_container');
	var i=0;

	for (i=0;i<ad2460.productionitems.length;i++ ){
		var thisItem=ad2460.productionitems[i];
		if (thisItem.id==499){
			thisItem.sortOrder=5;
		}
		if (thisItem.vesseltype=='Normal'){
			if (thisItem.vesselclass=='Fighter' || thisItem.vesselclass=='Corvette'){
				thisItem.sortOrder=2;
			}
			else {
				thisItem.sortOrder=1;
			}
		}
		else if (thisItem.vesseltype=='Satelite'){
			if (thisItem.vesselclass=='None'){
				thisItem.sortOrder=5;
			}
			else {
				thisItem.sortOrder=3;
			}
		}
		else if (thisItem.vesseltype=='Utility' || thisItem.vesseltype=='Probe' || thisItem.vesseltype=='Prospecting' ){
			thisItem.sortOrder=4;
		}
	}

	ad2460.productionitems.sort(prodSort);

	// Sorting should be done properly!


	if (renderMode=='all'){
		$("#production_unitselection").html('All units');

		// Simple, never mind the requirements, all but the completed ones should be rendered
		var lastSortOrder=0;

		for (i=0;i<ad2460.productionitems.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.productionitems[i];
			if (thisItem.id==499){
				continue;
			}

			if (1==1)	{
				var renderItem=true;
				if (firstRenderedId==-1){
					firstRenderedId=thisItem.id;
				}
				if (lastSortOrder!=thisItem.sortOrder){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML=ad2460.sepDivText[thisItem.sortOrder];
					container.appendChild(sepdiv);
				}

				var productionItem=document.createElement('div');
				productionItem.setAttribute("class","selectionitem");
				productionItem.setAttribute("onclick","productionItemClick("+thisItem.id+",event)");

				var productionPicture=document.createElement('img');
				var resClass='';
				if (thisItem.tech=='Matter'){	resClass='matter';	}
				if (thisItem.tech=='Energy'){	resClass='energy';	}
				if (thisItem.tech=='Displacement'){	resClass='displacement';	}

				if (thisItem.user_id<1){
					productionItem.style.opacity='0.40';
					resClass='none';
				}


				productionPicture.setAttribute("src","images/icons/production/"+thisItem.id+".jpg");
				productionPicture.setAttribute("class","selectionitem_img "+resClass);
				productionPicture.setAttribute("title",thisItem.name);
				productionPicture.setAttribute("alt",thisItem.name);


				productionItem.appendChild(productionPicture);
				container.appendChild(productionItem);
				lastSortOrder=thisItem.sortOrder;
			}
		}
	}
	else if (renderMode == 'unavailable'){
		$("#production_unitselection").html('Unavailable units');

		var lastSortOrder=0;

		for (i=0;i<ad2460.productionitems.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.productionitems[i];
			if (thisItem.id==499){
				continue;
			}

			if (thisItem.user_id<1)	{
				var renderItem=true;
				var requiredDevelopmentIdCheck	=	checkDevelopmentRequirement(thisItem.required_development_id);
				var requiredFacilityIdCheck		=	checkFacilityRequirement(thisItem.required_facility_id);
				var requiredResearchIdCheck		=	checkResearchRequirement(thisItem.required_research_id);
				var requiredSpecialIdCheck		=	checkSpecialRequirement(thisItem.special_requirement);
				var requiredTechPointsCheck		=	checkTechtreeRequirement(thisItem.required_points_tree,thisItem.required_tech_tree_points);

				if (requiredDevelopmentIdCheck===false || requiredFacilityIdCheck===false || requiredResearchIdCheck===false || requiredSpecialIdCheck===false || requiredTechPointsCheck===false ){

					if (firstRenderedId==-1){
						firstRenderedId=thisItem.id;
					}
					if (lastSortOrder!=thisItem.sortOrder){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML=ad2460.sepDivText[thisItem.sortOrder];
						container.appendChild(sepdiv);
					}

					var productionItem=document.createElement('div');
					productionItem.setAttribute("class","selectionitem");
					productionItem.setAttribute("onclick","productionItemClick("+thisItem.id+",event)");

					var productionPicture=document.createElement('img');
					var resClass='';
					if (thisItem.tech=='Matter'){	resClass='matter';	}
					if (thisItem.tech=='Energy'){	resClass='energy';	}
					if (thisItem.tech=='Displacement'){	resClass='displacement';	}

					productionPicture.setAttribute("src","images/icons/production/"+thisItem.id+".jpg");
					productionPicture.setAttribute("class","selectionitem_img "+resClass);
					productionPicture.setAttribute("title",thisItem.name);
					productionPicture.setAttribute("alt",thisItem.name);

					productionItem.appendChild(productionPicture);
					container.appendChild(productionItem);
					lastSortOrder=thisItem.sortOrder;
				}
			}
		}
	}
	else if (renderMode == 'available'){
		$("#production_unitselection").html('Available units');
		// We'd like all normal ships first, preferably sorted by cheap to expensive?
		// why don't we go through them all one time, and assign a sorting-order...
		// Then we draw them?

		var lastSortOrder=0;

		for (i=0;i<ad2460.productionitems.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.productionitems[i];
			if (thisItem.id==499){
				continue;
			}

			if (thisItem.user_id>0)	{
				var renderItem=true;
				if (firstRenderedId==-1){
					firstRenderedId=thisItem.id;
				}
				if (lastSortOrder!=thisItem.sortOrder){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML=ad2460.sepDivText[thisItem.sortOrder];
					container.appendChild(sepdiv);
				}

				var productionItem=document.createElement('div');
				productionItem.setAttribute("class","selectionitem");
				productionItem.setAttribute("onclick","productionItemClick("+thisItem.id+",event)");

				var productionPicture=document.createElement('img');
				var resClass='';
				if (thisItem.tech=='Matter'){	resClass='matter';	}
				if (thisItem.tech=='Energy'){	resClass='energy';	}
				if (thisItem.tech=='Displacement'){	resClass='displacement';	}

				productionPicture.setAttribute("src","images/icons/production/"+thisItem.id+".jpg");
				productionPicture.setAttribute("class","selectionitem_img "+resClass);
				productionPicture.setAttribute("title",thisItem.name);
				productionPicture.setAttribute("alt",thisItem.name);

				productionItem.appendChild(productionPicture);
				container.appendChild(productionItem);
				lastSortOrder=thisItem.sortOrder;
			}
		}
	}

	checkScrollButtonStatus('production_list_container');
	renderProductionQueue();
}

function shipClassToSortNum(shipClass){
	if (shipClass=='Frigate'){
		return 0.1;
	}
	if (shipClass=='Cruiser'){
		return 0.2;
	}
	if (shipClass=='Battleship'){
		return 0.3;
	}
	if (shipClass=='Carrier'){
		return 0.4;
	}
	return 0;
}

function shipTechToSortNum(tech){
	if (tech=='Matter'){
		return 0.01;
	}
	if (tech=='Energy'){
		return 0.02;
	}
	if (tech=='Displacement'){
		return 0.03;
	}

	return 0;
}


function prodSort(a,b) {
	if (a.sortOrder+shipClassToSortNum(a.vesselclass)+shipTechToSortNum(a.tech)+(a.id/100000) < b.sortOrder+shipClassToSortNum(b.vesselclass)+shipTechToSortNum(b.tech)+(b.id/100000))
		return -1;
	if (a.sortOrder+shipClassToSortNum(a.vesselclass)+shipTechToSortNum(a.tech)+(a.id/100000) > b.sortOrder+shipClassToSortNum(b.vesselclass)+shipTechToSortNum(b.tech)+(b.id/100000))
		return 1;
	return 0;
}

function prodSort2(a,b){
	var acost=a.h_cost+a.i_cost+a.s_cost+a.n_cost;
	var bcost=b.h_cost+b.i_cost+b.s_cost+b.n_cost;

	return (acost-bcost);
}

// END PRODUCTION

function renderProductionQueue(){
	var currently_producing=false;
	// Resetting "global" variable to keep track of the open row

	removeTimer('currentProductionProgressTimer');
	removeTimer('queueProductionProgressTimer1');
	removeTimer('queueProductionProgressTimer2');
	removeTimer('queueProductionProgressTimer3');
	removeTimer('queueProductionProgressTimer4');
	removeTimer('queueProductionProgressTimer5');
	removeTimer('queueProductionProgressTimer6');
	removeTimer('queueProductionProgressTimer7');
	removeTimer('queueProductionProgressTimer8');
	removeTimer('queueProductionProgressTimer9');
	removeTimer('queueProductionProgressTimer10');
	removeTimer('queueProductionProgressTimer11');
	removeTimer('queueProductionProgressTimer12');
	removeTimer('queueProductionProgressTimer13');
	removeTimer('queueProductionProgressTimer14');
	removeTimer('queueProductionProgressTimer15');
	removeTimer('queueProductionProgressTimer16');
	removeTimer('queueProductionProgressTimer17');
	removeTimer('queueProductionProgressTimer18');
	removeTimer('queueProductionProgressTimer19');
	removeTimer('queueProductionProgressTimer20');
	removeTimer('queueProductionProgressTimer21');
	removeTimer('queueProductionProgressTimer22');
	removeTimer('queueProductionProgressTimer23');
	removeTimer('queueProductionProgressTimer24');

	productionQueueExpanderOpen='';

	var container=document.getElementById('infopanel_production_queue_container');
	removeChildNodes('infopanel_production_queue_container');
	deleteProductionTimers();
	ad2460.productionqueue.sort(function(a, b){ return a.priority-b.priority });

	var accumulated_build_time=0;
	var added_init_time=ad2460.serverTime;

	if (ad2460.productionqueue.length>0){
		added_init_time=ad2460.productionqueue[0].start_time;
	}

	var last_item_finishes_in=0;
	var total_prod_queue_string='Empty';

	var queue_cost_hs=0;
	var queue_cost_in=0;
	var queue_cost_sr=0;
	var queue_cost_nd=0;

	for (i=0;i<ad2460.productionqueue.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.productionqueue[i];
		var thisUnit=returnUnit(thisItem.id);

		// Now just print all queue-items

		var queueContainer=document.createElement('div');
		var queueEntryTop=document.createElement('div');
		var queueEntryContentContainer=document.createElement('div');
		//var queueEntryOrdernum=document.createElement('div');
		var queueEntryName=document.createElement('div');
		var queueEntryEta=document.createElement('div');
		var queueEntryEtaSpan=document.createElement('span');
		var queueEntryCancelDiv=document.createElement('div');
		var queueEntryCancelImg=document.createElement('img');
		var queueEntryInfo=document.createElement('div');
		var queueEntryImgDiv=document.createElement('div');
		var queueEntryImg=document.createElement('img');

		var queueEntryHelpDiv=document.createElement('div');

		var orderNum=i+1;

		var homefleet=returnBaseFleet();
		queueEntryHelpDiv.setAttribute('class','queue_entry_help');
		queueEntryHelpDiv.innerHTML=' --&gt;&gt; '+homefleet.fleet_name;

		if (thisItem.id == 430 || thisItem.id == 431 || thisItem.id == 438 || thisItem.id == 439 || thisItem.id == 440){
			queueEntryHelpDiv.innerHTML=' --&gt;&gt; Non-Combatant';
		}

		if (thisItem.building==1){
			// We are producing stuff!
			currently_producing=true;
			var timerId='currentProductionProgressTimer';
			queueEntryEtaSpan.setAttribute('id',timerId);
			queueEntryEtaSpan.setAttribute('class','noseconds');
			// registerNewTimer(timerId, [timerId,'process_6_eta'], ['process_6_progress'], thisItem.start_time, thisItem.finish_time+1, function(){reloadAllMilitaryData();reloadProductionQueue();});
			registerNewTimer(timerId, [timerId,'process_6_eta'], ['process_6_progress'], thisItem.start_time, thisItem.finish_time+1, function(){fetchMyFleets();reloadProductionQueue();});

			//$('#process_2_name').html(thisUnit.name);
			$('#process_6_colour').show();
			added_init_time=thisItem.finish_time;

			last_item_finishes_in+=thisItem.finish_time-ad2460.serverTime;
		}
		else {
			queue_cost_hs+=thisItem.h_cost;
			queue_cost_in+=thisItem.i_cost;
			queue_cost_sr+=thisItem.s_cost;
			queue_cost_nd+=thisItem.n_cost;

			accumulated_build_time+=ad2460.productionqueue[i].est_build_time;
			var expected_finish_time=added_init_time+accumulated_build_time;
			var expected_start_time=expected_finish_time-ad2460.productionqueue[i].est_build_time;
			//last_item_finishes_in=thisItem.finish_time-ad2460.serverTime;
			last_item_finishes_in+=ad2460.productionqueue[i].est_build_time;

			var timerId='queueProductionProgressTimer'+thisItem.priority;
			queueEntryEtaSpan.setAttribute('id',timerId);
			queueEntryEtaSpan.setAttribute('class','noseconds');
			registerNewTimer(timerId, [timerId], [], expected_start_time, expected_finish_time, function(){fetchMyFleets();reloadProductionQueue();});
		}

		//queueContainer.setAttribute("class","row_container ally_dev");
		queueContainer.setAttribute("class","row_container ally_dev");
		queueEntryTop.setAttribute("class","row_entry dev_bonus_entry queue");


		var rowId="production_queue_expand_row_"+thisItem.queue_id;
		queueEntryTop.setAttribute("id",rowId);

		queueEntryContentContainer.setAttribute("class","queue_entry_content_container");
		//queueEntryOrdernum.setAttribute("class","queue_entry_help");
		//queueEntryOrdernum.style.right='271px';
		//queueEntryOrdernum.innerHTML='[#'+orderNum+']';


		queueEntryName.setAttribute("class","queue_entry_name");
		queueEntryEta.setAttribute("class","queue_entry_eta");
		// queueEntryEtaSpan.setAttribute("class","infopanel_header");
		queueEntryCancelDiv.setAttribute("class","queue_entry_icons");
		queueEntryInfo.setAttribute("class","queue_entry_info");
		queueEntryImgDiv.setAttribute("class","queue_entry_img");

		if (thisItem.priority==1){
			var queueEntryUpImg=document.createElement('img');
			var queueEntryDownImg=document.createElement('img');
			queueEntryUpImg.setAttribute("src","images/fixed/spacer.gif");
			queueEntryUpImg.setAttribute("width","20px");
			queueEntryUpImg.setAttribute("height","20px");
			queueEntryDownImg.setAttribute("src","images/fixed/spacer.gif");
			queueEntryDownImg.setAttribute("width","20px");
			queueEntryDownImg.setAttribute("height","20px");
			queueEntryCancelDiv.appendChild(queueEntryUpImg);
			queueEntryCancelDiv.appendChild(queueEntryDownImg);
		}
		else if (thisItem.priority==2 && thisItem.priority<ad2460.productionqueue.length){
			// console.log('Unf');
			var queueEntryUpImg=document.createElement('img');
			var queueEntryDownImg=document.createElement('img');
			queueEntryUpImg.setAttribute("src","images/fixed/spacer.gif");
			queueEntryUpImg.setAttribute("width","20px");
			queueEntryUpImg.setAttribute("height","20px");
			queueEntryDownImg.setAttribute("src","images/fixed/downqueue.png");
			queueEntryDownImg.setAttribute("onclick","productionQueueItemMoveClick("+thisItem.queue_id+",1,event)");
			queueEntryCancelDiv.appendChild(queueEntryUpImg);
			queueEntryCancelDiv.appendChild(queueEntryDownImg);

		}
		else if (thisItem.priority>2 && thisItem.priority<ad2460.productionqueue.length){
			var queueEntryUpImg=document.createElement('img');
			var queueEntryDownImg=document.createElement('img');
			queueEntryUpImg.setAttribute("src","images/fixed/upqueue.png");
			queueEntryUpImg.setAttribute("onclick","productionQueueItemMoveClick("+thisItem.queue_id+",-1,event)");
			queueEntryDownImg.setAttribute("src","images/fixed/downqueue.png");
			queueEntryDownImg.setAttribute("onclick","productionQueueItemMoveClick("+thisItem.queue_id+",1,event)");
			queueEntryCancelDiv.appendChild(queueEntryUpImg);
			queueEntryCancelDiv.appendChild(queueEntryDownImg);
		}
		else if (thisItem.priority>2 && thisItem.priority==ad2460.productionqueue.length){
			var queueEntryUpImg=document.createElement('img');
			var queueEntryTopImg=document.createElement('img');
			queueEntryUpImg.setAttribute("src","images/fixed/upqueue.png");
			queueEntryUpImg.setAttribute("onclick","productionQueueItemMoveClick("+thisItem.queue_id+",-1,event)");
			queueEntryTopImg.setAttribute("src","images/fixed/topqueue.png");
			queueEntryTopImg.setAttribute("onclick","productionQueueItemMoveClick("+thisItem.queue_id+",2,event)");
			queueEntryCancelDiv.appendChild(queueEntryUpImg);
			queueEntryCancelDiv.appendChild(queueEntryTopImg);
		}

		else if (thisItem.priority>1 && thisItem.priority==ad2460.productionqueue.length){
			var queueEntryUpImg=document.createElement('img');
			var queueEntryDownImg=document.createElement('img');
			queueEntryUpImg.setAttribute("src","images/fixed/spacer.gif");
			queueEntryUpImg.setAttribute("width","20px");
			queueEntryUpImg.setAttribute("height","20px");
			queueEntryDownImg.setAttribute("src","images/fixed/spacer.gif");
			queueEntryDownImg.setAttribute("width","20px");
			queueEntryDownImg.setAttribute("height","20px");
			queueEntryCancelDiv.appendChild(queueEntryUpImg);
			queueEntryCancelDiv.appendChild(queueEntryDownImg);
		}


		queueEntryCancelImg.setAttribute("src","images/fixed/cancel.png");
		queueEntryCancelImg.setAttribute("onclick","cancelProductionClick("+thisItem.queue_id+",event)");

		queueEntryImg.setAttribute("src","images/icons/production/"+thisUnit.id+".jpg");
		if (thisItem.id == 401 || thisItem.id == 402 || thisItem.id == 403 || thisItem.id == 404 || thisItem.id == 405 || thisItem.id == 406){
			queueEntryName.innerHTML='<span style="color:#BBBBBB">[#'+zeroPad(orderNum)+']</span> '+"5 "+thisUnit.name+" wings";
		}
		else if ( thisItem.id == 407 || thisItem.id == 408 || thisItem.id == 409 || thisItem.id == 410 ) {
			queueEntryName.innerHTML='<span style="color:#BBBBBB">[#'+zeroPad(orderNum)+']</span> '+"2 "+thisUnit.name+" wings";
		}
		else {
			queueEntryName.innerHTML='<span style="color:#BBBBBB">[#'+zeroPad(orderNum)+']</span> '+thisUnit.name;
		}

		queueEntryInfo.innerHTML=thisUnit.description;

		queueEntryTop.onclick=function(){
			if (ad2460.productionQueueExpanderOpen=='') {
				ad2460.productionQueueExpanderOpen=this.id;
				expandSelectedRow(this.id);
			}
			else if(ad2460.productionQueueExpanderOpen==this.id){
				minimizeSelectedRow(this.id);
				ad2460.productionQueueExpanderOpen='';
			}
			else {
				closeSelectedRow(ad2460.productionQueueExpanderOpen);
				ad2460.productionQueueExpanderOpen=this.id;
				setTimeout("expandSelectedRow(ad2460.productionQueueExpanderOpen)",250);
			}
		};

		// Here we need to register a timer, somehow, and then tie it to this DOM-node.

		queueContainer.appendChild(queueEntryTop);
		queueEntryTop.appendChild(queueEntryContentContainer);
		queueEntryContentContainer.appendChild(queueEntryName);
		//queueEntryContentContainer.appendChild(queueEntryOrdernum);
		queueEntryContentContainer.appendChild(queueEntryEta);
		queueEntryEta.appendChild(queueEntryEtaSpan);
		queueEntryEta.appendChild(queueEntryCancelDiv);
		queueEntryContentContainer.appendChild(queueEntryHelpDiv);
		queueEntryCancelDiv.appendChild(queueEntryCancelImg);
		queueEntryContentContainer.appendChild(queueEntryInfo);
		queueEntryContentContainer.appendChild(queueEntryImgDiv);
		queueEntryImgDiv.appendChild(queueEntryImg);

		container.appendChild(queueContainer);
	}

	if (ad2460.productionqueue.length>0 && currently_producing==false){
		document.getElementById('process_6_progress').style.backgroundColor='red';
		document.getElementById('process_6_name').style.color='red';
		document.getElementById('process_6_eta').innerHTML='Paused';
	}
	else {
		document.getElementById('process_6_progress').style.backgroundColor='rgba(30,255,0,0.8)';
		document.getElementById('process_6_name').style.color='white';
	}

	// Then decide what to auto-click in the lowpanel..
	// If there is a research in progress, auto-click it to update the sidepanel.
	// If not, click the first one in the list of visible items in the lowpanel. Use the researchItemClick(id) function
	var foundOne=false;
	for (i=0;i<ad2460.productionqueue.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.productionqueue[i];
		if (thisItem.priority==1){
			//productionItemClick(thisItem.id);
			foundOne=true;
			$("#current_production_helptext").html('Click on the unit to view more details.');
			thisUnit=returnUnit(thisItem.id);
			$('#process_6_name').html(thisUnit.name);
			$('#process_6_colour').show();
		}
	}

	if (foundOne==false){
		$("#current_production_helptext").html('Your production-facilities are currently idle.');
		$('#process_6_progress').css('width','0%');
		$('#process_6_eta').html('');
		$('#process_6_name').html('No production in progress');
		$('#process_6_colour').hide();
	}

	checkScrollButtonStatus('infopanel_production_queue_container');
	handleTimersNoUpdate();
	if (last_item_finishes_in>0){
		total_prod_queue_string=secondsToFullTimeNosecs(last_item_finishes_in);
	}
	var prod_queue_count_string="";
	if (ad2460.productionqueue.length>1){
		prod_queue_count_string="("+ad2460.productionqueue.length+" units)   <img alt='Delete Queue' title='Delete Queue' style='vertical-align: middle;' src='images/fixed/cancel.png' height='25' onclick='wipeProductionQueue()'>";
	}
	$("#production_queue_header").html("Production queue ("+total_prod_queue_string+") "+prod_queue_count_string);

	if (queue_cost_hs+queue_cost_in+queue_cost_sr+queue_cost_nd>0){
		$("#prod_queue_hs").html(prettyPrint(queue_cost_hs));
		$("#prod_queue_in").html(prettyPrint(queue_cost_in));
		$("#prod_queue_sr").html(prettyPrint(queue_cost_sr));
		$("#prod_queue_nd").html(prettyPrint(queue_cost_nd));
		$("#prod_queue_res_cost").show();
	}
	else {
		$("#prod_queue_res_cost").hide();
	}
}

var last_prod_queue_fetch=0;

function reloadProductionQueue(){
	if (last_prod_queue_fetch<ad2460.serverTime-1){
		last_prod_queue_fetch=ad2460.serverTime;
		$.post('actionhandler.pl', {action:'reload_production_queue'}, function(data){ parseInfo(data);});
	}
}

function deleteProductionQueueItem(queue_id){
	var i=0;
	for (i=0;i<ad2460.productionqueue.length;i++ ){ // Traversing-time!
		if (ad2460.productionqueue[i].queue_id==queue_id){
			ad2460.productionqueue.splice(i,1);
			i--;
		}
	}

	var rowId="production_queue_expand_row_"+queue_id;
	$("#"+rowId).remove();

	// And now assign new priorities....
	ad2460.productionqueue.sort(function(a, b){ return a.priority-b.priority });
	for (i=0;i<ad2460.productionqueue.length;i++ ){ // Traversing-time again!
		ad2460.productionqueue[i].priority=i+1;
	}
	// Priorities reset, all good.
	myScrollToTop('infopanel_production_queue_container');
	renderProductionQueue();
}

function wipeProductionQueue(){
	$.post('actionhandler.pl', {action:'wipe_production_queue'}, function(data){ parseInfo(data);fetchAllTechData();});
}

function renderResearches(view){
	// This is fairly straight forward..Almost...
	// We must render the different panels individually here..

	// Traverse the ad2460.researches and figure out what to draw in the lowpanel
	// The view (optional) decides what to render.
	// If view is undefined, it means "available"
	// Completed researches should never be rendered here.

	// sort by required_tech_tree
	// then by time_cost

	if (view!='available' && view!='unavailable' && view!='all' ){
		if (ad2460.homeworldSelectedItems.research_view!=''){
			view=ad2460.homeworldSelectedItems.research_view;
		}
	}

	ad2460.homeworldSelectedItems.research_view=view;

	for (i=0;i<ad2460.researches.length;i++ ){ // Traversing-time!
		if (ad2460.researches[i].required_points_tree=='General')	{
			ad2460.researches[i].sortNum=0;
		}
		if (ad2460.researches[i].required_points_tree=='Matter')	{
			ad2460.researches[i].sortNum=1;
		}
		if (ad2460.researches[i].required_points_tree=='Energy')	{
			ad2460.researches[i].sortNum=2;
		}
		if (ad2460.researches[i].required_points_tree=='Displacement')	{
			ad2460.researches[i].sortNum=3;
		}
		ad2460.researches[i].sortNum+=ad2460.researches[i].time_cost/10000000;
		ad2460.researches[i].sortNum+=ad2460.researches[i].id/100000000;

	}

	ad2460.researches.sort(function(a, b){ return a.sortNum-b.sortNum });



	removeChildNodes('research_list_container');
	removeChildNodes('infopanel_current_research_container');
	removeChildNodes('infopanel_completed_research_container');

	myScrollToTop('research_list_container',0);

	var renderedGeneralHeader=false;
	var renderedMatterHeader=false;
	var renderedEnergyHeader=false;
	var renderedDisplacementHeader=false;



	var i=0;
	var renderMode='available';
	if (view == 'all'){ renderMode='all'; }
	if (view == 'unavailable'){ renderMode='unavailable'; }

	if (renderMode=='available'){
		$('#research_filter_slider').transition({x: '0px'},300, 'cubic-bezier(0.500, 0.500, 0.500, 1.000)');
	}
	else if (renderMode=='unavailable'){
		$('#research_filter_slider').transition({x: '-113px'},300, 'cubic-bezier(0.500, 0.500, 0.500, 1.000)');
	}
	else if (renderMode=='all'){
		$('#research_filter_slider').transition({x: '113px'},300, 'cubic-bezier(0.500, 0.500, 0.500, 1.000)');
	}

	var firstRenderedId=-1;

	var container=document.getElementById('research_list_container');
	$("#research_list_container").css({opacity:0}).transition({opacity:1},500);

	var i=0;
	if (renderMode=='all'){
		$("#research_unitselection").html('All projects');

		// Simple, never mind the requirements, all but the completed ones should be rendered
		for (i=0;i<ad2460.researches.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.researches[i];
			if (1==1)	{
				// Render it!
				if (firstRenderedId==-1){
					firstRenderedId=thisItem.id;
				}

				if (ad2460.researches[i].required_points_tree=='General' && renderedGeneralHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="General";
					container.appendChild(sepdiv);
					renderedGeneralHeader=true;
				}
				if (ad2460.researches[i].required_points_tree=='Matter' && renderedMatterHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="InTech";
					container.appendChild(sepdiv);
					renderedMatterHeader=true;
				}
				if (ad2460.researches[i].required_points_tree=='Energy' && renderedEnergyHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="StronTech";
					container.appendChild(sepdiv);
					renderedEnergyHeader=true;
				}
				if (ad2460.researches[i].required_points_tree=='Displacement' && renderedDisplacementHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="NeoTech";
					container.appendChild(sepdiv);
					renderedDisplacementHeader=true;
				}

				var researchItem=document.createElement('div');
				researchItem.setAttribute("class","selectionitem");
				researchItem.setAttribute("onclick","researchItemClick("+thisItem.id+",event)");
				researchItem.setAttribute("id","research_"+thisItem.id);


				var researchPicture=document.createElement('img');

				researchPicture.setAttribute("src","images/icons/research/"+thisItem.id+".jpg");
				var resClass='';
				if (thisItem.required_points_tree=='Matter'){	resClass='matter';	}
				if (thisItem.required_points_tree=='Energy'){	resClass='energy';	}
				if (thisItem.required_points_tree=='Displacement'){	resClass='displacement';	}
				researchPicture.setAttribute("class","selectionitem_img "+resClass);
				researchPicture.setAttribute("title",thisItem.name);
				researchPicture.setAttribute("alt",thisItem.name);

				researchItem.appendChild(researchPicture);
				container.appendChild(researchItem);
			}
		}
	}
	else if (renderMode == 'unavailable'){
		$("#research_unitselection").html('Unavailable projects');

		// Not so simple...We need to perform all checks on requirements, and if ALL fail, we can draw it :)
		for (i=0;i<ad2460.researches.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.researches[i];
			if (thisItem.user_id<1)	{
				var renderItem=true;
				var requiredDevelopmentIdCheck	=	checkDevelopmentRequirement(thisItem.required_development_id);
				var requiredFacilityIdCheck		=	checkFacilityRequirement(thisItem.required_facility_id);
				var requiredResearchIdCheck		=	checkResearchRequirement(thisItem.required_research_id);
				var requiredSpecialIdCheck		=	checkSpecialRequirement(thisItem.special_requirement);
				var requiredTechPointsCheck		=	checkTechtreeRequirement(thisItem.required_points_tree,thisItem.required_tech_tree_points);

				// If one of the checks return false, it's unavailable, and should be drawn...
				if (requiredDevelopmentIdCheck===false || requiredFacilityIdCheck===false || requiredResearchIdCheck===false || requiredSpecialIdCheck===false || requiredTechPointsCheck===false ){
					if (firstRenderedId==-1){
						firstRenderedId=thisItem.id;
					}

					if (ad2460.researches[i].required_points_tree=='General' && renderedGeneralHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="General";
						container.appendChild(sepdiv);
						renderedGeneralHeader=true;
					}
					if (ad2460.researches[i].required_points_tree=='Matter' && renderedMatterHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="InTech";
						container.appendChild(sepdiv);
						renderedMatterHeader=true;
					}
					if (ad2460.researches[i].required_points_tree=='Energy' && renderedEnergyHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="StronTech";
						container.appendChild(sepdiv);
						renderedEnergyHeader=true;
					}
					if (ad2460.researches[i].required_points_tree=='Displacement' && renderedDisplacementHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="NeoTech";
						container.appendChild(sepdiv);
						renderedDisplacementHeader=true;
					}


					var researchItem=document.createElement('div');
					researchItem.setAttribute("class","selectionitem");
					researchItem.setAttribute("onclick","researchItemClick("+thisItem.id+",event)");
					researchItem.setAttribute("id","research_"+thisItem.id);


					var researchPicture=document.createElement('img');

					researchPicture.setAttribute("src","images/icons/research/"+thisItem.id+".jpg");
					var resClass='';
					if (thisItem.required_points_tree=='Matter'){	resClass='matter';	}
					if (thisItem.required_points_tree=='Energy'){	resClass='energy';	}
					if (thisItem.required_points_tree=='Displacement'){	resClass='displacement';	}
					researchPicture.setAttribute("class","selectionitem_img "+resClass);
					researchPicture.setAttribute("title",thisItem.name);
					researchPicture.setAttribute("alt",thisItem.name);

					researchItem.appendChild(researchPicture);
					container.appendChild(researchItem);
				}
			}
		}
	}
	else if (renderMode == 'available'){
		$("#research_unitselection").html('Available projects');
		// Here, all checks must return true
		for (i=0;i<ad2460.researches.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.researches[i];
			if (thisItem.user_id<1 || thisItem.upgrading==1)	{
				var renderItem=true;
				var requiredDevelopmentIdCheck	=	checkDevelopmentRequirement(thisItem.required_development_id);
				var requiredFacilityIdCheck		=	checkFacilityRequirement(thisItem.required_facility_id);
				var requiredResearchIdCheck		=	checkResearchRequirement(thisItem.required_research_id);
				var requiredSpecialIdCheck		=	checkSpecialRequirement(thisItem.special_requirement);
				var requiredTechPointsCheck		=	checkTechtreeRequirement(thisItem.required_points_tree,thisItem.required_tech_tree_points);

				// If one of the checks return false, it's unavailable, and should be drawn...
				if (requiredDevelopmentIdCheck===true && requiredFacilityIdCheck===true && requiredResearchIdCheck===true && requiredSpecialIdCheck===true && requiredTechPointsCheck===true ){
					if (firstRenderedId==-1){
						firstRenderedId=thisItem.id;
					}

					if (ad2460.researches[i].required_points_tree=='General' && renderedGeneralHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="General";
						container.appendChild(sepdiv);
						renderedGeneralHeader=true;
					}
					if (ad2460.researches[i].required_points_tree=='Matter' && renderedMatterHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="InTech";
						container.appendChild(sepdiv);
						renderedMatterHeader=true;
					}
					if (ad2460.researches[i].required_points_tree=='Energy' && renderedEnergyHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="StronTech";
						container.appendChild(sepdiv);
						renderedEnergyHeader=true;
					}
					if (ad2460.researches[i].required_points_tree=='Displacement' && renderedDisplacementHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="NeoTech";
						container.appendChild(sepdiv);
						renderedDisplacementHeader=true;
					}

					var researchItem=document.createElement('div');
					researchItem.setAttribute("class","selectionitem");
					researchItem.setAttribute("onclick","researchItemClick("+thisItem.id+",event)");
					researchItem.setAttribute("id","research_"+thisItem.id);

					var researchPicture=document.createElement('img');

					researchPicture.setAttribute("src","images/icons/research/"+thisItem.id+".jpg");
					var resClass='';
					if (thisItem.required_points_tree=='Matter'){	resClass='matter';	}
					if (thisItem.required_points_tree=='Energy'){	resClass='energy';	}
					if (thisItem.required_points_tree=='Displacement'){	resClass='displacement';	}
					researchPicture.setAttribute("class","selectionitem_img "+resClass);
					researchPicture.setAttribute("title",thisItem.name);
					researchPicture.setAttribute("alt",thisItem.name);

					researchItem.appendChild(researchPicture);
					container.appendChild(researchItem);
				}
			}
		}
	}


	// That should complete all render-methods for the lowpanel



	// The infopanel can be rendered next. Just list the current ongoing research, if any.
	// Then the list of completed ones beneath. Simple.
	var currently_researching=false;
	for (i=0;i<ad2460.researches.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.researches[i];
		if (thisItem.upgrading==1){

			// We are researching stuff!
			currently_researching=true;
			var container=document.getElementById('infopanel_current_research_container');

			var queueContainer=document.createElement('div');
			var queueEntryTop=document.createElement('div');
			var queueEntryContentContainer=document.createElement('div');
			var queueEntryName=document.createElement('div');
			var queueEntryEta=document.createElement('div');
			var queueEntryEtaSpan=document.createElement('span');
			var queueEntryCancelDiv=document.createElement('div');
			var queueEntryCancelImg=document.createElement('img');
			var queueEntryInfo=document.createElement('div');
			var queueEntryImgDiv=document.createElement('div');
			var queueEntryImg=document.createElement('img');

			queueContainer.setAttribute("class","queue_container");
			queueEntryTop.setAttribute("class","queue_entry_top");
			queueEntryTop.setAttribute("id","current_research_expand_row");

			queueEntryContentContainer.setAttribute("class","queue_entry_content_container");
			queueEntryName.setAttribute("class","queue_entry_name");
			queueEntryEta.setAttribute("class","queue_entry_eta");
			// queueEntryEtaSpan.setAttribute("class","infopanel_header");
			queueEntryCancelDiv.setAttribute("class","queue_entry_icons");
			queueEntryInfo.setAttribute("class","queue_entry_info");
			queueEntryImgDiv.setAttribute("class","queue_entry_img");

			queueEntryCancelImg.setAttribute("src","images/fixed/cancel.png");
			queueEntryCancelImg.setAttribute("onclick","cancelCurrentResearchClick(event)");
			queueEntryImg.setAttribute("src","images/icons/research/"+thisItem.id+".jpg");

			queueEntryName.innerHTML=thisItem.name;
			queueEntryInfo.innerHTML=thisItem.description;


			queueEntryTop.onclick=function(){
				if (expanderOpen==0) {
					openSelectedRowTop('current_research_expand_row');
				}
				else if (expanderOpen==1) {
					closeSelectedRow('current_research_expand_row');
				}
			};

			// Here we need to register a timer, somehow, and then tie it to this DOM-node.
			var timerId='currentResearchProgressTimer';
			queueEntryEtaSpan.setAttribute('id',timerId);
			queueEntryEtaSpan.setAttribute('class','longtime');

			registerNewTimer(timerId,[timerId,'process_3_eta'], ['process_3_progress'], thisItem.start_time, thisItem.end_time,function(){fetchAllTechData();});
			$('#process_3_colour').show();


			queueContainer.appendChild(queueEntryTop);
			queueEntryTop.appendChild(queueEntryContentContainer);
			queueEntryContentContainer.appendChild(queueEntryName);
			queueEntryContentContainer.appendChild(queueEntryEta);
			queueEntryEta.appendChild(queueEntryEtaSpan);
			queueEntryEta.appendChild(queueEntryCancelDiv);
			queueEntryCancelDiv.appendChild(queueEntryCancelImg);
			queueEntryContentContainer.appendChild(queueEntryInfo);
			queueEntryContentContainer.appendChild(queueEntryImgDiv);
			queueEntryImgDiv.appendChild(queueEntryImg);

			container.appendChild(queueContainer);

		}
	}


	// Then the list of completed ones beneath. Simple.
	var foundCompletedResearches=false;
	var numberOfCompletedResearches=0;

	// Now sort the stupid array by end_time
	ad2460.researches.sort(function(a, b){ return b.end_time-a.end_time });

	// When we are done, we must re-sort it back by id


	for (i=0;i<ad2460.researches.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.researches[i];
		if (thisItem.user_id>0 && thisItem.upgrading==0){
			foundCompletedResearches=true;

			numberOfCompletedResearches++;

			// Render it in the list of completed researches...Quite simple this one...

			var extraClass=' notech';
			if (thisItem.required_points_tree=='Matter'){
				extraClass=' intech';
			}
			if (thisItem.required_points_tree=='Energy'){
				extraClass=' strontech';
			}
			if (thisItem.required_points_tree=='Displacement'){
				extraClass=' neotech';
			}


			var container=document.getElementById('infopanel_completed_research_container');
			// new style
			var item=createSingleElement('div', 'row_container new_completed_research'+extraClass, '', thisItem.name, 'showGameInfoBox('+thisItem.id+')');
			item.setAttribute("title",thisItem.bonus_description);
			item.setAttribute("alt",thisItem.bonus_description);

			container.appendChild(item);


		}
	}

	ad2460.researches.sort(function(a, b){ return a.id-b.id });

	if (foundCompletedResearches===true){
		$("#completed_research_helptext").html('Click on the completed research to view the details.');
	}
	else {
		$("#completed_research_helptext").html('You have no completed research-projects.');
	}

	if (numberOfCompletedResearches>5){
		$("#completed_researches_scrollbar_down").show();
		$("#completed_researches_scrollbar_up").show();
	}

	// Then decide what to auto-click in the lowpanel..
	// If there is a research in progress, auto-click it to update the sidepanel.
	// If not, click the first one in the list of visible items in the lowpanel. Use the researchItemClick(id) function
	var foundOne=false;
	for (i=0;i<ad2460.researches.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.researches[i];
		if (thisItem.upgrading==1){
			//researchItemClick(thisItem.id);
			foundOne=true;
			$("#current_research_helptext").html('Click on the research to view more details.');
			$('#process_3_name').html(thisItem.name);
			$('#process_3_colour').show();
		}
	}

	if (foundOne===false){
		$("#current_research_helptext").html('Your research-lab is currently idle.');
		$('#process_3_progress').css('width','0%');
		$('#process_3_eta').html('');
		$('#process_3_name').html('No research in progress');
		$('#process_3_colour').hide();
	}

	checkScrollButtonStatus('research_list_container');
	checkScrollButtonStatus('infopanel_completed_research_container');
}

function reSelectResearchItem(){
	researchItemClick(ad2460.homeworldSelectedItems.research);
}

function researchItemClick(id,event){

	//play_multi_sound('sfx_click2');
	// Traverse the researches, and plot the info in the sidepanel
	if (event){
		if(event.shiftKey) {
			handleShiftClickObjectWithId(id);
			return;
		}
	}


	var i=0;
	for (i=0;i<ad2460.researches.length ;i++ ){
		thisItem=ad2460.researches[i];
		if (thisItem.id==id){
			ad2460.homeworldSelectedItems.research=id;

			// time to do some bonus calculations!
			var h_cost=thisItem.h_cost;
			var n_cost=thisItem.n_cost;
			var s_cost=thisItem.s_cost;
			var i_cost=thisItem.i_cost;
			var time_cost=thisItem.time_cost;

			var res_cost_bonus_percent=0;
			var time_cost_bonus_percent=0;

			var obj=returnGameObjectById(103);
			if (obj!=false){
				if (obj.user_id==ad2460.user_id && obj.upgrading==0){
					res_cost_bonus_percent+=5;
				}
			}

			var obj=returnGameObjectById(186);
			if (obj!=false){
				if (obj.user_id==ad2460.user_id && obj.upgrading==0){
					time_cost_bonus_percent+=5;
				}
			}
			var obj=returnGameObjectById(358);
			if (obj!=false){
				if (obj.user_id==ad2460.user_id && obj.upgrading==0){
					time_cost_bonus_percent+=5;
				}
			}
			var obj=returnGameObjectById(359);
			if (obj!=false){
				if (obj.user_id==ad2460.user_id && obj.upgrading==0){
					time_cost_bonus_percent+=5;
				}
			}
			var obj=returnGameObjectById(360);
			if (obj!=false){
				if (obj.user_id==ad2460.user_id && obj.upgrading==0){
					time_cost_bonus_percent+=5;
				}
			}


			var obj=returnGameObjectById(800);
			if (obj!=false){
				if (obj.user_id==ad2460.user_id && obj.points>0){
					time_cost_bonus_percent+=(obj.points*1);
				}
			}

			var obj=returnGameObjectById(803);
			if (obj!=false){
				if (obj.user_id==ad2460.user_id && obj.points>0){
					time_cost_bonus_percent+=(obj.points*1);
				}
			}

			var obj=returnGameObjectById(806);
			if (obj!=false){
				if (obj.user_id==ad2460.user_id && obj.points>0){
					time_cost_bonus_percent+=(obj.points*1);
				}
			}

			var obj=returnGameObjectById(614);
			if (obj!=false){
				if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 ){
					time_cost_bonus_percent+=10;
					res_cost_bonus_percent+=10;
				}
			}

			var obj=returnGameObjectById(615);
			if (obj!=false){
				if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 ){
					time_cost_bonus_percent+=10;
					res_cost_bonus_percent+=10;
				}
			}

			var obj=returnGameObjectById(616);
			if (obj!=false){
				if (obj.alliance_id>0 && obj.upgrading==0 && obj.end_time>0 ) {
					time_cost_bonus_percent+=10;
					res_cost_bonus_percent+=10;
				}
			}

			h_cost=h_cost-Math.floor(h_cost*res_cost_bonus_percent/100);
			n_cost=n_cost-Math.floor(n_cost*res_cost_bonus_percent/100);
			s_cost=s_cost-Math.floor(s_cost*res_cost_bonus_percent/100);
			i_cost=i_cost-Math.floor(i_cost*res_cost_bonus_percent/100);

			time_cost=time_cost-Math.floor(time_cost*time_cost_bonus_percent/100);

			$("#research_selected_item_stat_researchname").html(thisItem.name);
			$("#research_selected_item_stat_researchdescription").html(thisItem.description);

			var bonus_desc=thisItem.bonus_description;

			var enables=[];

			var y=0;
			for (y=0;y<ad2460.researches.length ;y++ ){
				if (ad2460.researches[y].required_research_id == id){
					enables.push(ad2460.researches[y]);
				}
			}

			if (enables.length>0){
				bonus_desc+="<br>Required for ";
			}
			for (var y=0;y<enables.length ;y++ ){
				bonus_desc+="<a href='#' class='nicklink' onclick='showGameInfoBox("+enables[y].id+",event)'>"+enables[y].name+"</a>";
				//bonus_desc+=enables[y].name;
				if (y<enables.length-2){
					bonus_desc+=', ';
				}
				else if (y<enables.length-1){
					bonus_desc+=' and ';
				}
				else {
					bonus_desc+='.';
				}
			}

			var y=0;
			for (y=0;y<ad2460.techpointsList.length ;y++ ){
				if (ad2460.techpointsList[y].type =='research' && ad2460.techpointsList[y].num_var==id){
					bonus_desc+="<br>* This research grants a techpoint!";
				}
			}
			$("#current_research_bonus_description").html(bonus_desc);


			$("#research_selected_item_stat_time").html(secondsToFullTimeLong(time_cost));

			var source="images/icons/wide_research/"+thisItem.id+".jpg";
			$("#research_sidepanel_selected_research_image").attr("src",source);

			document.getElementById('res_hscost').innerHTML=prettyPrint(h_cost);
			document.getElementById('res_ndcost').innerHTML=prettyPrint(n_cost);
			document.getElementById('res_srcost').innerHTML=prettyPrint(s_cost);
			document.getElementById('res_incost').innerHTML=prettyPrint(i_cost);

			var hasEnoughRes=true;

			if (h_cost>ad2460.resources.hassium)	{	hasEnoughRes=false;	$("#res_hscost").addClass("notenough");	} else { $("#res_hscost").removeClass("notenough");	}
			if (n_cost>ad2460.resources.neodymium)	{	hasEnoughRes=false;	$("#res_ndcost").addClass("notenough");	} else { $("#res_ndcost").removeClass("notenough");	}
			if (s_cost>ad2460.resources.strontium)	{	hasEnoughRes=false;	$("#res_srcost").addClass("notenough");	} else { $("#res_srcost").removeClass("notenough");	}
			if (i_cost>ad2460.resources.indium)	{	hasEnoughRes=false;	$("#res_incost").addClass("notenough");	} else { $("#res_incost").removeClass("notenough");	}

			var available=checkAvailability(thisItem);
			if (available==true && ad2460.researchInProgress==false && hasEnoughRes==true){
				activateResearchOrderButton(thisItem.id);
			}
			else {
				deactivateResearchOrderButton('You are unable to start this research now.');
			}

			if (thisItem.user_id>0 && thisItem.upgrading==0){
				deactivateResearchOrderButton('You have already completed this research.',true);
			}


			var reqObj=checkAllRequirementsForItemId(thisItem.id);
			if (reqObj.development && reqObj.research && reqObj.facility && reqObj.techtree && reqObj.special){
				$("#selected_res_item_available_info").removeClass("red").addClass("green");
			}
			else {
				$("#selected_res_item_available_info").removeClass("green").addClass("red");
			}
			$("#selected_res_item_available_info").show();
			document.getElementById('selected_res_item_available_info').setAttribute("onclick","showBuildTreeInfo("+thisItem.id+",event, true)");
		}
	}
}

function reSelectProductionItem(){
	productionItemClick(ad2460.homeworldSelectedItems.production);
}

function returnNewTechName(oldName){
	if (oldName=='Matter'){
		return "InTech";
	}
	if (oldName=='Energy'){
		return "StronTech";
	}
	if (oldName=='Displacement'){
		return "NeoTech";
	}

	return oldName;
}

function productionItemClick(id,event){
	if (event){
		if(event.shiftKey) {
			handleShiftClickObjectWithId(id);
			return;
		}
	}
	//play_multi_sound('sfx_click3');
	// Traverse the researches, and plot the info in the sidepanel
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		thisItem=ad2460.productionitems[i];
		if (thisItem.id==id){
			ad2460.homeworldSelectedItems.production=id;
			$("#panel_slot_1").show();
			$("#panel_slot_2").show();

			$("#shipslidebutton_old").off("click");
			$("#shipslidebutton").off("click");
			document.getElementById('shipslidebutton').onclick=function(){openShipSlide(id);}
			document.getElementById('shipslidebutton_old').onclick=function(){openShipSlide(id);}

			$("#production_selected_ship_stat_shipname").html(thisItem.name);
			if (thisItem.vesseltype=='Normal' && thisItem.vesselclass=='Fighter'){
				$("#production_selected_ship_stat_shipname").html("5 "+thisItem.name+" wings");
			}
			if (thisItem.vesseltype=='Normal' && thisItem.vesselclass=='Corvette'){
				$("#production_selected_ship_stat_shipname").html("2 "+thisItem.name+" wings");
			}

			var desc_string=thisItem.description;
			var desc_split=desc_string.split("<br/><br/>");
			desc_string=desc_split[0];
			$("#production_selected_item_stat_description").html(desc_string);
			//$("#current_research_bonus_description").html(thisItem.bonus_description);
			$("#production_selected_ship_stat_pri_weapon_type").html(shortTechType(thisItem.primary_weapontype));
			//$("#production_selected_ship_stat_pri_weaponstrength").html(thisItem.primary_weaponstrength);
			$("#production_selected_ship_stat_pri_weaponstrength").html(thisItem.primary_guns+"*"+thisItem.primary_rateoffire+"*"+thisItem.primary_weaponstrength);

			if (thisItem.primary_guns==0 || thisItem.primary_rateoffire==0 || thisItem.primary_weaponstrength==0){
				$("#production_selected_ship_stat_pri_weaponstrength").html('None');
			}

			if (thisItem.id==434){
				$("#production_selected_ship_stat_pri_weaponstrength").html('Sabotage');
			}

			$("#production_selected_ship_stat_sec_weapon_type").html(shortTechType(thisItem.secondary_weapontype));
			$("#production_selected_ship_stat_sec_weaponstrength").html(thisItem.secondary_guns+"*"+thisItem.secondary_rateoffire+"*"+thisItem.secondary_weaponstrength);

			if (thisItem.secondary_guns==0 || thisItem.secondary_rateoffire==0 || thisItem.secondary_weaponstrength==0){
				$("#production_selected_ship_stat_sec_weaponstrength").html('None');
			}


			$("#production_selected_ship_stat_ter_weapon_type").html(shortTechType(thisItem.tertiary_weapontype));
			$("#production_selected_ship_stat_ter_weaponstrength").html(thisItem.tertiary_guns+"*"+thisItem.tertiary_rateoffire+"*"+thisItem.tertiary_weaponstrength);

			if (thisItem.tertiary_guns == 0 || thisItem.tertiary_rateoffire == 0 || thisItem.tertiary_weaponstrength==0){
				$("#production_selected_ship_stat_ter_weaponstrength").html('None');
			}


			// $("#production_selected_ship_stat_shield_type").html(shortTechType(thisItem.shieldtype));
			// $("#production_selected_ship_stat_shields").html(thisItem.shieldstrength);
			$("#production_selected_ship_stat_hull").html(prettyPrint(thisItem.hullstrength)+' / '+prettyPrint(thisItem.shieldstrength));

			$("#production_selected_ship_stat_maneuverability").html(thisItem.maneuverability);

			if (thisItem.vesseltype=='Normal'){
				var numberString="";
				if (thisItem.vesselclass=='Fighter' ){
					numberString=" wing";
				}
				else if (thisItem.vesselclass=='Corvette'){
					numberString=" wing";
				}
				//$("#production_selected_ship_stat_shiptype_class").html(thisItem.primary_weapontype+" "+thisItem.vesselclass+numberString);
				$("#production_selected_ship_stat_shiptype_class").html(returnNewTechName(thisItem.tech)+" "+thisItem.vesselclass+numberString);
			}
			else if (thisItem.vesseltype=='Utility'){
				$("#production_selected_ship_stat_shiptype_class").html('Utility ship');
			}
			else if (thisItem.vesseltype=='Prospecting'){
				$("#production_selected_ship_stat_shiptype_class").html('Prospecting ship');
			}
			else if (thisItem.vesseltype=='Probe'){
				$("#production_selected_ship_stat_shiptype_class").html('Utility ship');
			}
			else if (thisItem.vesseltype=='Satelite'){
				if (thisItem.vesselclass=='None'){
					$("#production_selected_ship_stat_shiptype_class").html('Outpost');
				}
				else {
					$("#production_selected_ship_stat_shiptype_class").html('Orbital Defense ('+thisItem.vesselclass+')');
				}


			}


			if (thisItem.hangar_capacity>0){
				$("#production_selected_ship_stat_hangar_cargo_header").html('Hangar capacity:');
				$("#production_selected_ship_stat_hangar_cargo_capacity").html(thisItem.hangar_capacity);
			}
			else {
				$("#production_selected_ship_stat_hangar_cargo_header").html('Cargo capacity:');
				var cargoCapacityBonusPercent=returnCargoCapacityBonusPercent();
				var thisCargoCapacity=thisItem.cargo_capacity+Math.floor(thisItem.cargo_capacity*cargoCapacityBonusPercent/100)
				$("#production_selected_ship_stat_hangar_cargo_capacity").html(thisItem.cargo_capacity);
			}

			$("#production_selected_ship_stat_jump_range").html(prettyPrint(shipToStrength(id)));

			var upkeepBonusPercent=returnUpkeepBonusPercent();

			var actual_upkeep_h=thisItem.h_upkeep_cost-Math.floor(thisItem.h_upkeep_cost*upkeepBonusPercent/100);
			var actual_upkeep_n=thisItem.n_upkeep_cost-Math.floor(thisItem.n_upkeep_cost*upkeepBonusPercent/100);
			var actual_upkeep_s=thisItem.s_upkeep_cost-Math.floor(thisItem.s_upkeep_cost*upkeepBonusPercent/100);
			var actual_upkeep_i=thisItem.i_upkeep_cost-Math.floor(thisItem.i_upkeep_cost*upkeepBonusPercent/100);

			var total_upkeep=actual_upkeep_h+actual_upkeep_i+actual_upkeep_s+actual_upkeep_n;

			//$("#production_selected_item_stat_h_upkeep").html(actual_upkeep_h);
			//$("#production_selected_item_stat_n_upkeep").html(actual_upkeep_n);
			//$("#production_selected_item_stat_s_upkeep").html(actual_upkeep_s);
			//$("#production_selected_item_stat_i_upkeep").html(actual_upkeep_i);
			$("#production_selected_item_stat_total_upkeep").html(prettyPrint(total_upkeep)+' res/h');

			var source="images/icons/wide_production/"+thisItem.id+".jpg";
			$("#production_sidepanel_selected_ship_image").attr("src",source);

			var prodCost_h=thisItem.h_cost;
			var prodCost_n=thisItem.n_cost;
			var prodCost_s=thisItem.s_cost;
			var prodCost_i=thisItem.i_cost;

			var timeCost=thisItem.time_cost;


			if (thisItem.vesseltype=='Normal'){
				if (thisItem.vesselclass=='Fighter' ){
					prodCost_h=thisItem.h_cost*5;
					prodCost_n=thisItem.n_cost*5;
					prodCost_s=thisItem.s_cost*5;
					prodCost_i=thisItem.i_cost*5;
					timeCost=thisItem.time_cost*5;

				}
				else if (thisItem.vesselclass=='Corvette'){
					prodCost_h=thisItem.h_cost*2;
					prodCost_n=thisItem.n_cost*2;
					prodCost_s=thisItem.s_cost*2;
					prodCost_i=thisItem.i_cost*2;
					timeCost=thisItem.time_cost*2;
				}
			}


			// Now check for possible discounts through the corresponding research 188
			var costBonus=0;
			var timecostBonus=0;

			var playerlevel=ad2460.scores.level;
			if (playerlevel>=6){
				timecostBonus+=5;
			}
			if (playerlevel>=8){
				timecostBonus+=5;
			}
			if (playerlevel>=10){
				timecostBonus+=5;
			}
			if (playerlevel>=12){
				timecostBonus+=5;
			}
			if (playerlevel>=14){
				timecostBonus+=5;
			}
			if (playerlevel>=16){
				timecostBonus+=5;
			}
			if (playerlevel>=18){
				timecostBonus+=5;
			}
			if (playerlevel>=20){
				timecostBonus+=5;
			}

			var r=returnGameObjectById(188);
			if (r){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					costBonus+=2;
				}
			}
			var r=returnGameObjectById(353);
			if (r){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					costBonus+=5;
				}
			}

			var r=returnGameObjectById(183);
			if (r){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					timecostBonus+=5;
				}
			}
			var r=returnGameObjectById(193);
			if (r){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					timecostBonus+=15;
				}
			}
			var r=returnGameObjectById(360);
			if (r){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					timecostBonus+=5;
				}
			}
			// Also check for tech-point bonuses if the ship is of type "Matter", "Energy" or "Displacement"
			//			822 825 828
			if (thisItem.tech=='Matter'){
				var r=returnGameObjectById(822);
				if (r){
					if (r.points==1){	timecostBonus+=r.bonus_modifier_1;		}
					if (r.points==2){	timecostBonus+=r.bonus_modifier_2;		}
					if (r.points==3){	timecostBonus+=r.bonus_modifier_3;		}
					if (r.points==4){	timecostBonus+=r.bonus_modifier_4;		}
					if (r.points==5){	timecostBonus+=r.bonus_modifier_5;		}
				}
			}

			if (thisItem.tech=='Energy'){
				var r=returnGameObjectById(825);
				if (r){
					if (r.points==1){	timecostBonus+=r.bonus_modifier_1;		}
					if (r.points==2){	timecostBonus+=r.bonus_modifier_2;		}
					if (r.points==3){	timecostBonus+=r.bonus_modifier_3;		}
					if (r.points==4){	timecostBonus+=r.bonus_modifier_4;		}
					if (r.points==5){	timecostBonus+=r.bonus_modifier_5;		}
				}
			}

			if (thisItem.tech=='Displacement'){
				var r=returnGameObjectById(828);
				if (r){
					if (r.points==1){	timecostBonus+=r.bonus_modifier_1;		}
					if (r.points==2){	timecostBonus+=r.bonus_modifier_2;		}
					if (r.points==3){	timecostBonus+=r.bonus_modifier_3;		}
					if (r.points==4){	timecostBonus+=r.bonus_modifier_4;		}
					if (r.points==5){	timecostBonus+=r.bonus_modifier_5;		}
				}
			}

			var r=returnGameObjectById(800);
			if (r){
				timecostBonus+=r.points;
			}
			var r=returnGameObjectById(803);
			if (r){
				timecostBonus+=r.points;
			}
			var r=returnGameObjectById(806);
			if (r){
				timecostBonus+=r.points;
			}

			if (thisItem.vesseltype=='Normal'){
				if (thisItem.vesselclass=='Frigate' || thisItem.vesselclass=='Cruiser' || thisItem.vesselclass=='Battleship' || thisItem.vesselclass=='Carrier'  ){
					if (ad2460.allianceData.id>0){
						costBonus+=ad2460.allianceData.sectorBonuses.production_cost;
					}
				}
			}

			prodCost_h-=Math.floor(prodCost_h*costBonus/100);
			prodCost_n-=Math.floor(prodCost_n*costBonus/100);
			prodCost_s-=Math.floor(prodCost_s*costBonus/100);
			prodCost_i-=Math.floor(prodCost_i*costBonus/100);

			var showSpecialStar=false;

			if (ad2460.amnestyUntilTime>ad2460.serverTime){
				//timeCost=Math.round(timeCost/2);
				timeCost=Math.floor(timeCost*60/100);
				showSpecialStar=true;
			}


			// Here we can add VIP-based extra bonus, taking off 20% base time
			if (ad2460.vip_status>=ad2460.serverTime) {
				timeCost=timeCost*0.8;
			}

			if (timecostBonus>90){
				timecostBonus=90;
			}

			timeCost=timeCost-Math.floor(timeCost*timecostBonus/100);

			if (showSpecialStar==true){
				$("#production_selected_item_stat_time").html("<span id='special_prod_speed_indicator' style='cursor:help;color:yellow;margin-right:10px;' title='During your grace-time you produce units 25% faster.'>* </span> "+secondsToFullTimeLong(timeCost));
				blinkElementById('special_prod_speed_indicator');
			}
			else {
				$("#production_selected_item_stat_time").html(secondsToFullTimeLong(timeCost));
			}



			document.getElementById('prod_hscost').innerHTML=prettyPrint(prodCost_h);
			document.getElementById('prod_ndcost').innerHTML=prettyPrint(prodCost_n);
			document.getElementById('prod_srcost').innerHTML=prettyPrint(prodCost_s);
			document.getElementById('prod_incost').innerHTML=prettyPrint(prodCost_i);

			var hasEnoughRes=true;

			if (prodCost_h>ad2460.resources.hassium)	{	hasEnoughRes=false;	$("#prod_hscost").addClass("notenough");	} else { $("#prod_hscost").removeClass("notenough");	}
			if (prodCost_n>ad2460.resources.neodymium)	{	hasEnoughRes=false;	$("#prod_ndcost").addClass("notenough");	} else { $("#prod_ndcost").removeClass("notenough");	}
			if (prodCost_s>ad2460.resources.strontium)	{	hasEnoughRes=false;	$("#prod_srcost").addClass("notenough");	} else { $("#prod_srcost").removeClass("notenough");	}
			if (prodCost_i>ad2460.resources.indium)	{	hasEnoughRes=false;	$("#prod_incost").addClass("notenough");	} else { $("#prod_incost").removeClass("notenough");	}

			var available=checkAvailability(thisItem);
			if ((available==true && hasEnoughRes==true) || (available==true && ad2460.productionqueue.length>0) ){
				activateProductionOrderButton(thisItem.id);
			}
			else {
				if (available!=true){
					deactivateProductionOrderButton('Requirements not met');
				}
				else {
					deactivateProductionOrderButton('Insufficient resources');
				}

			}



			var reqObj=checkAllRequirementsForItemId(thisItem.id);
			if (reqObj.development && reqObj.research && reqObj.facility && reqObj.techtree && reqObj.special){
				$("#selected_prod_item_available_info").removeClass("red").addClass("green");
			}
			else {
				$("#selected_prod_item_available_info").removeClass("green").addClass("red");
			}
			$("#selected_prod_item_available_info").show();
			document.getElementById('selected_prod_item_available_info').setAttribute("onclick","showBuildTreeInfo("+thisItem.id+",event,true)");

			if (event){
				if (ad2460.scores.level<4 && ad2460.scores.level>1){
					blinkElementById('shipslidebutton');
				}
			}
		}
	}
}


function deleteProductionTimers(){
	removeTimer('currentProductionProgressTimer');
	removeTimer('queueProductionProgressTimer2');
	removeTimer('queueProductionProgressTimer3');
	removeTimer('queueProductionProgressTimer4');
	removeTimer('queueProductionProgressTimer5');
}

function researchItemUnclick(){
	// Clear the selected research and revert to the N/As etc
	$("#research_selected_item_stat_researchname").html('No item selected');
	$("#research_selected_item_stat_researchdescription").html('Select an item in the list below and to the left.');
	$("#current_research_bonus_description").html('');
	var source="images/fixed/spacer.gif";
	$("#research_sidepanel_selected_research_image").attr("src",source);
	$("#rescost").hide();
}

function developmentItemUnclick(){
	// Clear the selected research and revert to the N/As etc
	$("#development_selected_item_stat_developmentname").html('No item selected');
	$("#development_selected_item_stat_developmentdescription").html('Select an item in the list below and to the left.');
	$("#current_development_bonus_description").html('');
	var source="images/fixed/spacer.gif";
	$("#development_sidepanel_selected_development_image").attr("src",source);
	$("#devcost").hide();
}

function facilityItemUnclick(){
	// Clear the selected research and revert to the N/As etc
	$("#facility_selected_item_stat_facilityname").html('No item selected');
	$("#facility_selected_item_stat_facilitydescription").html('Select an item in the list below and to the left.');
	$("#current_facility_bonus_description").html('');
	var source="images/fixed/spacer.gif";
	$("#facility_sidepanel_selected_facility_image").attr("src",source);

	ad2460.temp.clickedFacilityId=0;
	ad2460.temp.clickedBuildingId=0;
	$("#faccost").hide();
}

function reclickFacilityContainer(){
	if (ad2460.temp.clickedFacilityId>0){
		facilityContainerClick(ad2460.temp.clickedFacilityId,ad2460.temp.clickedBuildingId);
	}
}

function productionItemUnclick(){
	$("#production_selected_ship_stat_shipname").html('No unit selected');
	$("#production_selected_item_stat_description").html('Select a unit in the list below and to the left');
	$("#production_selected_ship_stat_pri_weapon_type").html('');
	$("#production_selected_ship_stat_pri_weaponstrength").html('N/A');
	$("#production_selected_ship_stat_sec_weapon_type").html('');
	$("#production_selected_ship_stat_sec_weaponstrength").html('N/A');
	$("#production_selected_ship_stat_shield_type").html('N/A');
	$("#production_selected_ship_stat_shields").html('N/A');
	$("#production_selected_ship_stat_hull").html('N/A');
	$("#production_selected_ship_stat_maneuverability").html('N/A');
	$("#production_selected_ship_stat_hangar_cargo_capacity").html('N/A');
	$("#production_selected_ship_stat_jump_range").html('N/A');
	$("#production_selected_item_stat_time").html('N/A');
	$("#production_selected_item_stat_h_upkeep").html('');
	$("#production_selected_item_stat_n_upkeep").html('');
	$("#production_selected_item_stat_s_upkeep").html('');
	$("#production_selected_item_stat_i_upkeep").html('');
	var source="images/fixed/spacer.gif";
	$("#production_sidepanel_selected_ship_image").attr("src",source);
	$("#prodcost").hide();
}

function checkAvailability(item){

	var requiredDevelopmentIdCheck	=	checkDevelopmentRequirement(item.required_development_id);
	var requiredFacilityIdCheck		=	checkFacilityRequirement(item.required_facility_id);
	var requiredResearchIdCheck		=	checkResearchRequirement(item.required_research_id);
	var requiredSpecialIdCheck		=	checkSpecialRequirement(item.special_requirement);
	var requiredTechPointsCheck		=	checkTechtreeRequirement(item.required_points_tree,item.required_tech_tree_points);
	var userIdCheck=true;
	if (item.user_id>0)	{
		userIdCheck=false;
	}


	if ( item instanceof ship || item instanceof defense ){
		userIdCheck=false;
		if (item.user_id>0)	{
			userIdCheck=true;
		}
	}

	//console.log(requiredDevelopmentIdCheck);
	//console.log(requiredFacilityIdCheck);
	//console.log(requiredResearchIdCheck);
	//console.log(requiredSpecialIdCheck);
	//console.log(requiredTechPointsCheck);

	// If all checks are true, its available, return true
	if (requiredDevelopmentIdCheck==true && requiredFacilityIdCheck==true && requiredResearchIdCheck==true && requiredSpecialIdCheck==true && requiredTechPointsCheck==true && userIdCheck==true){
		return true;
	}
	else {
		return false;
	}

}

function renderDevelopments(view){
	// This is fairly straight forward..Almost...
	// We must render the different panels individually here..

	// Traverse the ad2460.researches and figure out what to draw in the lowpanel
	// The view (optional) decides what to render.
	// If view is undefined, it means "available"

	if (view!='available' && view!='unavailable' && view!='all' ){
		if (ad2460.homeworldSelectedItems.development_view!=''){
			view=ad2460.homeworldSelectedItems.development_view;
		}
	}

	ad2460.homeworldSelectedItems.development_view=view;


	removeChildNodes('development_list_container');
	removeChildNodes('infopanel_current_development_container');
	removeChildNodes('infopanel_completed_development_container');

	myScrollToTop('development_list_container',0);
	$("#development_list_container").css({opacity:0}).transition({opacity:1},500);

	for (i=0;i<ad2460.developments.length;i++ ){ // Traversing-time!
		if (ad2460.developments[i].required_points_tree=='General')	{
			ad2460.developments[i].sortNum=0;
		}
		if (ad2460.developments[i].required_points_tree=='Matter')	{
			ad2460.developments[i].sortNum=1;
		}
		if (ad2460.developments[i].required_points_tree=='Energy')	{
			ad2460.developments[i].sortNum=2;
		}
		if (ad2460.developments[i].required_points_tree=='Displacement')	{
			ad2460.developments[i].sortNum=3;
		}
		ad2460.developments[i].sortNum+=ad2460.developments[i].time_cost/10000000;
		ad2460.developments[i].sortNum+=ad2460.developments[i].id/100000000;

	}

	ad2460.developments.sort(function(a, b){ return a.sortNum-b.sortNum });

	var renderedGeneralHeader=false;
	var renderedMatterHeader=false;
	var renderedEnergyHeader=false;
	var renderedDisplacementHeader=false;

	var i=0;
	var renderMode='available';
	if (view == 'all'){ renderMode='all'; }
	if (view == 'unavailable'){ renderMode='unavailable'; }

	if (renderMode=='available'){
		$('#development_filter_slider').transition({x: '0px'},300, 'cubic-bezier(0.500, 0.500, 0.500, 1.000)');
	}
	else if (renderMode=='unavailable'){
		$('#development_filter_slider').transition({x: '-113px'},300, 'cubic-bezier(0.500, 0.500, 0.500, 1.000)');
	}
	else if (renderMode=='all'){
		$('#development_filter_slider').transition({x: '113px'},300, 'cubic-bezier(0.500, 0.500, 0.500, 1.000)');
	}


	var firstRenderedId=-1;

	var container=document.getElementById('development_list_container');
	var i=0;
	if (renderMode=='all'){
		$("#development_unitselection").html('All projects');

		// Simple, never mind the requirements, all but the completed ones should be rendered
		for (i=0;i<ad2460.developments.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.developments[i];
			if (1==1)	{
				// Render it!
				if (firstRenderedId==-1){
					firstRenderedId=thisItem.id;
				}

				if (ad2460.developments[i].required_points_tree=='General' && renderedGeneralHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="General";
					container.appendChild(sepdiv);
					renderedGeneralHeader=true;
				}
				if (ad2460.developments[i].required_points_tree=='Matter' && renderedMatterHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="InTech";
					container.appendChild(sepdiv);
					renderedMatterHeader=true;
				}
				if (ad2460.developments[i].required_points_tree=='Energy' && renderedEnergyHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="StronTech";
					container.appendChild(sepdiv);
					renderedEnergyHeader=true;
				}
				if (ad2460.developments[i].required_points_tree=='Displacement' && renderedDisplacementHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="NeoTech";
					container.appendChild(sepdiv);
					renderedDisplacementHeader=true;
				}


				var developmentItem=document.createElement('div');
				developmentItem.setAttribute("class","selectionitem");
				developmentItem.setAttribute("onclick","developmentItemClick("+thisItem.id+",event)");
				developmentItem.setAttribute("id","development_"+thisItem.id);

				var developmentPicture=document.createElement('img');

				developmentPicture.setAttribute("src","images/icons/development/"+thisItem.id+".jpg");
				developmentPicture.setAttribute("title",thisItem.name);
				developmentPicture.setAttribute("alt",thisItem.name);

				var resClass='';
				if (thisItem.required_points_tree=='Matter'){	resClass='matter';	}
				if (thisItem.required_points_tree=='Energy'){	resClass='energy';	}
				if (thisItem.required_points_tree=='Displacement'){	resClass='displacement';	}
				developmentPicture.setAttribute("class","selectionitem_img "+resClass);

				developmentItem.appendChild(developmentPicture);
				container.appendChild(developmentItem);
			}
		}
	}
	else if (renderMode == 'unavailable'){
		$("#development_unitselection").html('Unavailable projects');

		// Not so simple...We need to perform all checks on requirements, and if ALL fail, we can draw it :)
		for (i=0;i<ad2460.developments.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.developments[i];
			if (thisItem.user_id<1)	{
				var renderItem=true;
				var requiredDevelopmentIdCheck	=	checkDevelopmentRequirement(thisItem.required_development_id);
				var requiredFacilityIdCheck		=	checkFacilityRequirement(thisItem.required_facility_id);
				var requiredResearchIdCheck		=	checkResearchRequirement(thisItem.required_research_id);
				var requiredSpecialIdCheck		=	checkSpecialRequirement(thisItem.special_requirement);
				var requiredTechPointsCheck		=	checkTechtreeRequirement(thisItem.required_points_tree,thisItem.required_tech_tree_points);

				// If one of the checks return false, it's unavailable, and should be drawn...
				if (requiredDevelopmentIdCheck===false || requiredFacilityIdCheck===false || requiredResearchIdCheck===false || requiredSpecialIdCheck===false || requiredTechPointsCheck===false ){
					if (firstRenderedId==-1){
						firstRenderedId=thisItem.id;
					}

				if (ad2460.developments[i].required_points_tree=='General' && renderedGeneralHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="General";
					container.appendChild(sepdiv);
					renderedGeneralHeader=true;
				}
				if (ad2460.developments[i].required_points_tree=='Matter' && renderedMatterHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="InTech";
					container.appendChild(sepdiv);
					renderedMatterHeader=true;
				}
				if (ad2460.developments[i].required_points_tree=='Energy' && renderedEnergyHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="StronTech";
					container.appendChild(sepdiv);
					renderedEnergyHeader=true;
				}
				if (ad2460.developments[i].required_points_tree=='Displacement' && renderedDisplacementHeader==false){
					var sepdiv=document.createElement('div');
					sepdiv.setAttribute("class","prod_sep");
					sepdiv.innerHTML="NeoTech";
					container.appendChild(sepdiv);
					renderedDisplacementHeader=true;
				}

					var developmentItem=document.createElement('div');
					developmentItem.setAttribute("class","selectionitem");
					developmentItem.setAttribute("onclick","developmentItemClick("+thisItem.id+",event)");
					developmentItem.setAttribute("id","development_"+thisItem.id);

					var developmentPicture=document.createElement('img');

					developmentPicture.setAttribute("src","images/icons/development/"+thisItem.id+".jpg");
					developmentPicture.setAttribute("title",thisItem.name);
					developmentPicture.setAttribute("alt",thisItem.name);

					var resClass='';
					if (thisItem.required_points_tree=='Matter'){	resClass='matter';	}
					if (thisItem.required_points_tree=='Energy'){	resClass='energy';	}
					if (thisItem.required_points_tree=='Displacement'){	resClass='displacement';	}

					developmentPicture.setAttribute("class","selectionitem_img "+resClass);

					developmentItem.appendChild(developmentPicture);
					container.appendChild(developmentItem);
				}
			}
		}
	}
	else if (renderMode == 'available'){
		$("#development_unitselection").html('Available projects');
		// Here, all checks must return true
		for (i=0;i<ad2460.developments.length;i++ ){ // Traversing-time!
			var thisItem=ad2460.developments[i];
			if (thisItem.user_id<1)	{
				var renderItem=true;
				var requiredDevelopmentIdCheck	=	checkDevelopmentRequirement(thisItem.required_development_id);
				var requiredFacilityIdCheck		=	checkFacilityRequirement(thisItem.required_facility_id);
				var requiredResearchIdCheck		=	checkResearchRequirement(thisItem.required_research_id);
				var requiredSpecialIdCheck		=	checkSpecialRequirement(thisItem.special_requirement);
				var requiredTechPointsCheck		=	checkTechtreeRequirement(thisItem.required_points_tree,thisItem.required_tech_tree_points);

				// If one of the checks return false, it's unavailable, and should be drawn...
				if (requiredDevelopmentIdCheck===true && requiredFacilityIdCheck===true && requiredResearchIdCheck===true && requiredSpecialIdCheck===true && requiredTechPointsCheck===true ){

					if (firstRenderedId==-1){
						firstRenderedId=thisItem.id;
					}

					if (ad2460.developments[i].required_points_tree=='General' && renderedGeneralHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="General";
						container.appendChild(sepdiv);
						renderedGeneralHeader=true;
					}
					if (ad2460.developments[i].required_points_tree=='Matter' && renderedMatterHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="InTech";
						container.appendChild(sepdiv);
						renderedMatterHeader=true;
					}
					if (ad2460.developments[i].required_points_tree=='Energy' && renderedEnergyHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="StronTech";
						container.appendChild(sepdiv);
						renderedEnergyHeader=true;
					}
					if (ad2460.developments[i].required_points_tree=='Displacement' && renderedDisplacementHeader==false){
						var sepdiv=document.createElement('div');
						sepdiv.setAttribute("class","prod_sep");
						sepdiv.innerHTML="NeoTech";
						container.appendChild(sepdiv);
						renderedDisplacementHeader=true;
					}

					var developmentItem=document.createElement('div');
					developmentItem.setAttribute("class","selectionitem");
					developmentItem.setAttribute("onclick","developmentItemClick("+thisItem.id+",event)");
					developmentItem.setAttribute("id","development_"+thisItem.id);

					var developmentPicture=document.createElement('img');

					developmentPicture.setAttribute("src","images/icons/development/"+thisItem.id+".jpg");
					developmentPicture.setAttribute("title",thisItem.name);
					developmentPicture.setAttribute("alt",thisItem.name);

					var resClass='';
					if (thisItem.required_points_tree=='Matter'){	resClass='matter';	}
					if (thisItem.required_points_tree=='Energy'){	resClass='energy';	}
					if (thisItem.required_points_tree=='Displacement'){	resClass='displacement';	}

					developmentPicture.setAttribute("class","selectionitem_img "+resClass);

					developmentItem.appendChild(developmentPicture);
					container.appendChild(developmentItem);
				}
			}
		}
	}


	// That should complete all render-methods for the lowpanel



	// The infopanel can be rendered next. Just list the current ongoing research, if any.
	// Then the list of completed ones beneath. Simple.
	var currently_developing=false;
	for (i=0;i<ad2460.developments.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.developments[i];
		if (thisItem.upgrading==1){

			// We are researching stuff!
			currently_developing=true;
			var container=document.getElementById('infopanel_current_development_container');

		//	var currentItemHeader=document.createElement('div');
		//	currentItemHeader.setAttribute("class","infopanel_header");
		//	currentItemHeader.innerHTML='Ongoing Research';

		//	container.appendChild(currentItemHeader);

			var queueContainer=document.createElement('div');
			var queueEntryTop=document.createElement('div');
			var queueEntryContentContainer=document.createElement('div');
			var queueEntryName=document.createElement('div');
			var queueEntryEta=document.createElement('div');
			var queueEntryEtaSpan=document.createElement('span');
			var queueEntryCancelDiv=document.createElement('div');
			var queueEntryCancelImg=document.createElement('img');
			var queueEntryInfo=document.createElement('div');
			var queueEntryImgDiv=document.createElement('div');
			var queueEntryImg=document.createElement('img');

			queueContainer.setAttribute("class","queue_container");
			queueEntryTop.setAttribute("class","queue_entry_top");
			queueEntryTop.setAttribute("id","current_development_expand_row");

			queueEntryContentContainer.setAttribute("class","queue_entry_content_container");
			queueEntryName.setAttribute("class","queue_entry_name");
			queueEntryEta.setAttribute("class","queue_entry_eta");
			// queueEntryEtaSpan.setAttribute("class","infopanel_header");
			queueEntryCancelDiv.setAttribute("class","queue_entry_icons");
			queueEntryInfo.setAttribute("class","queue_entry_info");
			queueEntryImgDiv.setAttribute("class","queue_entry_img");

			queueEntryCancelImg.setAttribute("src","images/fixed/cancel.png");
			queueEntryCancelImg.setAttribute("onclick","cancelCurrentDevelopmentClick(event)");
			queueEntryImg.setAttribute("src","images/icons/development/"+thisItem.id+".jpg");

			queueEntryName.innerHTML=thisItem.name;
			queueEntryInfo.innerHTML=thisItem.description;

			queueEntryTop.onclick=function(){
				if (expanderOpen==0) {
					openSelectedRowTop('current_development_expand_row');
				}
				else if (expanderOpen==1) {
					closeSelectedRow('current_development_expand_row');
				}
			};

			// Here we need to register a timer, somehow, and then tie it to this DOM-node.
			var timerId='currentDevelopmentProgressTimer';
			queueEntryEtaSpan.setAttribute('id',timerId);
			queueEntryEtaSpan.setAttribute('class','longtime');
			registerNewTimer(timerId,[timerId,'process_5_eta'], ['process_5_progress'], thisItem.start_time, thisItem.end_time,function(){fetchAllTechData();});
			$('#process_5_colour').show();

			queueContainer.appendChild(queueEntryTop);
			queueEntryTop.appendChild(queueEntryContentContainer);
			queueEntryContentContainer.appendChild(queueEntryName);
			queueEntryContentContainer.appendChild(queueEntryEta);
			queueEntryEta.appendChild(queueEntryEtaSpan);
			queueEntryEta.appendChild(queueEntryCancelDiv);
			queueEntryCancelDiv.appendChild(queueEntryCancelImg);
			queueEntryContentContainer.appendChild(queueEntryInfo);
			queueEntryContentContainer.appendChild(queueEntryImgDiv);
			queueEntryImgDiv.appendChild(queueEntryImg);

			container.appendChild(queueContainer);
		}
	}


	// Then the list of completed ones beneath. Simple.
	var foundCompletedDevelopments=false;
	var numberOfCompletedDevelopments=0;

	// Sorting by end_time
	ad2460.developments.sort(function(a, b){ return b.end_time-a.end_time });

	for (i=0;i<ad2460.developments.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.developments[i];
		if (thisItem.user_id>0 && thisItem.upgrading==0){
			foundCompletedDevelopments=true;
			numberOfCompletedDevelopments++;
			// Render it in the list of completed researches...Quite simple this one...

			// Errrr...Container....Deletion-issues....Reload-issues...We need something magical here....
			var container=document.getElementById('infopanel_completed_development_container');

			var extraClass=' notech';
			if (thisItem.required_points_tree=='Matter'){
				extraClass=' intech';
			}
			if (thisItem.required_points_tree=='Energy'){
				extraClass=' strontech';
			}
			if (thisItem.required_points_tree=='Displacement'){
				extraClass=' neotech';
			}

			var item=createSingleElement('div', 'row_container new_completed_research'+extraClass, '', thisItem.name, 'showGameInfoBox('+thisItem.id+')');
			item.setAttribute("title",thisItem.bonus_description);


			container.appendChild(item);
		}
	}

	// Sorting by id
	ad2460.developments.sort(function(a, b){ return a.id-b.id });


	if (foundCompletedDevelopments===true){
		$("#completed_development_helptext").html('Click on the completed development-item to view details.');
	}
	else {
		$("#completed_development_helptext").html('You have no completed development-projects.');
	}

	if (numberOfCompletedDevelopments>5){
		$("#completed_development_scrollbar_down").show();
		$("#completed_development_scrollbar_up").show();
	}

	// Then decide what to auto-click in the lowpanel..
	// If there is a research in progress, auto-click it to update the sidepanel.
	// If not, click the first one in the list of visible items in the lowpanel. Use the researchItemClick(id) function
	var foundOne=false;
	for (i=0;i<ad2460.developments.length;i++ ){ // Traversing-time!
		var thisItem=ad2460.developments[i];
		if (thisItem.upgrading==1){
			//developmentItemClick(thisItem.id);
			foundOne=true;
			$("#current_development_helptext").html('Click on the development-icon to view more details.');
			$('#process_5_name').html(thisItem.name);
			$('#process_5_colour').show();
		}
	}

	if (foundOne===false){
		$("#current_development_helptext").html('Your developers are currently idle.');
		$('#process_5_progress').css('width','0%');
		$('#process_5_eta').html('');
		$('#process_5_name').html('No development in progress');
		$('#process_5_colour').hide();
	}

	checkScrollButtonStatus('development_list_container');
	checkScrollButtonStatus('infopanel_completed_development_container');

}

function reSelectDevelopmentItem(){
	developmentItemClick(ad2460.homeworldSelectedItems.development);
}

function developmentItemClick(id,event){
	//play_multi_sound('sfx_click2');
	// Traverse the developments, and plot the info in the sidepanel
	if (event){
		if(event.shiftKey) {
			handleShiftClickObjectWithId(id);
			return;
		}
	}
	var i=0;
	for (i=0;i<ad2460.developments.length ;i++ ){
		thisItem=ad2460.developments[i];
		if (thisItem.id==id){

			ad2460.homeworldSelectedItems.development=id;

			$("#development_selected_item_stat_developmentname").html(thisItem.name);
			$("#develpoment_selected_item_stat_developmentdescription").html(thisItem.description);
			$("#current_development_bonus_description").html(thisItem.bonus_description);

			var y=0;
			for (y=0;y<ad2460.techpointsList.length ;y++ ){
				if (ad2460.techpointsList[y].type =='development' && ad2460.techpointsList[y].num_var==id){
					$("#current_development_bonus_description").html(thisItem.bonus_description+"<br><br>This development provides a techpoint when completed.");
				}
			}

			//Research-id 196 provides 5% bonus to dev-time for all developments!
			var time_cost=thisItem.time_cost;
			var time_bonus_percent=0;
			var r=returnGameObjectById(196);
			if (r!=false){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					time_bonus_percent+=15;
				}
			}
			var r=returnGameObjectById(182);
			if (r!=false){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					time_bonus_percent+=5;
				}
			}
			var r=returnGameObjectById(328);
			if (r!=false){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					time_bonus_percent+=10;
				}
			}
			var r=returnGameObjectById(329);
			if (r!=false){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					time_bonus_percent+=10;
				}
			}
			var r=returnGameObjectById(330);
			if (r!=false){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					time_bonus_percent+=10;
				}
			}






			var r=returnGameObjectById(359);
			if (r!=false){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					time_bonus_percent+=5;
				}
			}
			var r=returnGameObjectById(360);
			if (r!=false){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					time_bonus_percent+=5;
				}
			}

			var cost_bonus_percent=0;

			var r=returnGameObjectById(352);
			if (r!=false){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					cost_bonus_percent+=5;
				}
			}

			var r=returnGameObjectById(104);
			if (r!=false){
				if (r.user_id==ad2460.user_id && r.upgrading==0){
					cost_bonus_percent+=5;
				}
			}

			time_cost=time_cost-Math.floor(time_cost*time_bonus_percent/100);

			var h_cost=Math.floor(thisItem.h_cost-(thisItem.h_cost*cost_bonus_percent/100));
			var i_cost=Math.floor(thisItem.i_cost-(thisItem.i_cost*cost_bonus_percent/100));
			var s_cost=Math.floor(thisItem.s_cost-(thisItem.s_cost*cost_bonus_percent/100));
			var n_cost=Math.floor(thisItem.n_cost-(thisItem.n_cost*cost_bonus_percent/100));


			$("#development_selected_item_stat_time").html(secondsToFullTimeLong(time_cost));

			var source="images/icons/wide_development/"+thisItem.id+".jpg";

			$("#development_sidepanel_selected_development_image").attr("src",source);

			document.getElementById('dev_hscost').innerHTML=prettyPrint(h_cost);
			document.getElementById('dev_ndcost').innerHTML=prettyPrint(n_cost);
			document.getElementById('dev_srcost').innerHTML=prettyPrint(s_cost);
			document.getElementById('dev_incost').innerHTML=prettyPrint(i_cost);

			var hasEnoughRes=true;

			if (h_cost>ad2460.resources.hassium)	{	hasEnoughRes=false;	$("#dev_hscost").addClass("notenough");	} else { $("#dev_hscost").removeClass("notenough");	}
			if (n_cost>ad2460.resources.neodymium)	{	hasEnoughRes=false;	$("#dev_ndcost").addClass("notenough");	} else { $("#dev_ndcost").removeClass("notenough");	}
			if (s_cost>ad2460.resources.strontium)	{	hasEnoughRes=false;	$("#dev_srcost").addClass("notenough");	} else { $("#dev_srcost").removeClass("notenough");	}
			if (i_cost>ad2460.resources.indium)	{	hasEnoughRes=false;	$("#dev_incost").addClass("notenough");	} else { $("#dev_incost").removeClass("notenough");	}

			var available=checkAvailability(thisItem);
			if ((available==true) && (ad2460.developmentInProgress==false) && (hasEnoughRes==true)){
				activateDevelopmentOrderButton(thisItem.id);
			}
			else {
				deactivateDevelopmentOrderButton('You are not able to initiate this Development-project now.',false);
			}

			if (thisItem.user_id>0 && thisItem.upgrading==0){
				deactivateDevelopmentOrderButton('You have already completed this development-project.',true);
			}


			var reqObj=checkAllRequirementsForItemId(thisItem.id);
			if (reqObj.development && reqObj.research && reqObj.facility && reqObj.techtree && reqObj.special){
				$("#selected_dev_item_available_info").removeClass("red").addClass("green");
			}
			else {
				$("#selected_dev_item_available_info").removeClass("green").addClass("red");
			}
			$("#selected_dev_item_available_info").show();
			document.getElementById('selected_dev_item_available_info').setAttribute("onclick","showBuildTreeInfo("+thisItem.id+",event, true)");
		}
	}
}

/*
function cancelCurrentDevelopmentClick(event){
	$.post('actionhandler.pl', {action:'cancel_current_development'}, function(data){ parseInfo(data);});
	event.stopPropagation();
	return false;
}
*/

function cancelCurrentDevelopmentClick(event){
	var mainText='Are you sure you wish to cancel this development?<br>(If you can not store all the returned resources, some resources might be lost.)';
	var okText='Yes';
	var cancelText='No';
	var okClick='cancelCurrentDevelopmentClickConfirmed();hideConfirmationPopup();';
	var cancelClick='hideConfirmationPopup();';

	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick);
	event.stopPropagation();
	return false;

}

function cancelCurrentDevelopmentClickConfirmed(event){
	$.post('actionhandler.pl', {action:'cancel_current_development'}, function(data){ parseInfo(data);clearCurrentFacilityUpgradeElements();});
}


function cancelCurrentResearchClick(event){
	var mainText='Are you sure you wish to cancel this research?<br>(If you can not store all the returned resources, some resources might be lost.)';
	var okText='Yes';
	var cancelText='No';
	var okClick='cancelCurrentResearchConfirmed();hideConfirmationPopup();';
	var cancelClick='hideConfirmationPopup();';

	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick);
	event.stopPropagation();
	return false;

}

function cancelCurrentResearchConfirmed(event){
	var res=ad2460.researchInProgress;
	if (res){
		$.post('actionhandler.pl', {action:'cancel_current_research'}, function(data){ parseInfo(data);});
	}
}

/*
function cancelCurrentResearchClick(event){
	$.post('actionhandler.pl', {action:'cancel_current_research'}, function(data){ parseInfo(data);});
	event.stopPropagation();
	play_multi_sound("sfx_click1");
	return false;
}

function cancelCurrentFacilityClick(event){
	$.post('actionhandler.pl', {action:'cancel_current_facility'}, function(data){ parseInfo(data);});
	event.stopPropagation();
	play_multi_sound("sfx_click1");
	return false;
}
*/
function cancelProductionClick(queue_id,event){
	$.post('actionhandler.pl', {action:'cancel_current_production',queue_id:queue_id}, function(data){ parseInfo(data);});
	event.stopPropagation();
	play_multi_sound("sfx_click1");
	return false;
}

function productionQueueItemMoveClick(queue_id,direction,event){
	$.post('actionhandler.pl', {action:'production_queue_move',queue_id:queue_id,direction:direction}, function(data){ parseInfo(data);});
	event.stopPropagation();
	play_multi_sound("sfx_click2");
	return false;
}


function activateResearchOrderButton(itemId){
	document.getElementById('rescost').setAttribute("onclick","initiateResearchClick("+itemId+",event)");
	$("#rescost").show();
	$("#rescost div.costbutton").show();
	$("#rescost div.disablebutton").hide();
}

function deactivateResearchOrderButton(string,alreadyCompleted){
	document.getElementById('rescost').setAttribute("onclick","systemFeedback('Error','"+string+"', 1, 3);");
	$("#rescost").show();
	$("#rescost div.costbutton").hide();
	if (alreadyCompleted==true){
		$("#rescost div.disablebutton .buttontext").html('Completed');
	}
	else {
		$("#rescost div.disablebutton .buttontext").html('N/A');
	}
	$("#rescost div.disablebutton").show();
}

function activateDevelopmentOrderButton(itemId){
	document.getElementById('devcost').setAttribute("onclick","initiateDevelopmentClick("+itemId+",event)");
	$("#devcost").show();
	$("#devcost div.costbutton").show();
	$("#devcost div.disablebutton").hide();
}

function deactivateDevelopmentOrderButton(string,alreadyCompleted){
	document.getElementById('devcost').setAttribute("onclick","systemFeedback('Error','"+string+"', 1, 3);");
	$("#devcost").show();
	$("#devcost div.costbutton").hide();
	if (alreadyCompleted==true){
		$("#devcost div.disablebutton .buttontext").html('Completed');
	}
	else {
		$("#devcost div.disablebutton .buttontext").html('N/A');
	}

	$("#devcost div.disablebutton").show();
}

function activateFacilityOrderButton(itemId){
	document.getElementById('faccost').setAttribute("onclick","initiateFacilityClick("+itemId+",event)");
	$("#faccost").show();
	$("#faccost div.costbutton").show();
	$("#faccost div.disablebutton").hide();
}

function deactivateFacilityOrderButton(string){
	document.getElementById('faccost').setAttribute("onclick","systemFeedback('Error','"+string+"', 1, 3);");
	$("#faccost").show();
	$("#faccost div.costbutton").hide();
	$("#faccost div.disablebutton").show();
}


function activateProductionOrderButton(itemId){
	document.getElementById('prodcostbutton').setAttribute("onclick","initiateProductionClick("+itemId+",1,event)");
	document.getElementById('prodcostbutton5').setAttribute("onclick","initiateProductionClick("+itemId+",5,event)");
	document.getElementById('prodcostbutton10').setAttribute("onclick","initiateProductionClick("+itemId+",10,event)");

	$("#prodcost").show();
	$("#prodcost div.costbutton").show();
	$("#prodcost div.costbutton5").show();
	$("#prodcost div.costbutton10").show();
	$("#prodcost div.disablebutton").hide();
}

function deactivateProductionOrderButton(string){
	document.getElementById('prodcostbutton').setAttribute("onclick","systemFeedback('Error','"+string+"', 1, 3);");
	$("#prodcost").show();
	$("#prodcost div.costbutton").hide();
	$("#prodcost div.costbutton5").hide();
	$("#prodcost div.costbutton10").hide();
	$("#prodcost div.disablebutton").show();
}

function initiateResearchClick(id){
	if (id>0){
		hideHelpCommander();
		$.post('actionhandler.pl', {action:'initiate_research', id:id}, function(data){ parseInfo(data);});
	}
	play_multi_sound("sfx_click3");
}

function initiateDevelopmentClick(id){
	if (id>0){
		hideHelpCommander();
		$.post('actionhandler.pl', {action:'initiate_development', id:id}, function(data){ parseInfo(data);});
	}
	play_multi_sound("sfx_click3");
}

function initiateFacilityClick(id){
	if (id>0){
		hideHelpCommander();
		$.post('actionhandler.pl', {action:'initiate_facility', id:id, facility_id:ad2460.temp.clickedFacilityId, building_id:ad2460.temp.clickedBuildingId}, function(data){ parseInfo(data);});
	}
	play_multi_sound("sfx_click3");
}

function initiateProductionClick(id,num,event){
	if (typeof(event)=='undefined'){
		return;
	}

	// check for full queue
	var maxProdQueueLength=10;
	var f1=returnGameObjectById(343);
	if (f1.user_id>0 && f1.upgrading==0){	maxProdQueueLength=20;	}
	var f2=returnGameObjectById(344);
	if (f2.user_id>0  && f2.upgrading==0){	maxProdQueueLength=30;	}
	var f3=returnGameObjectById(345);
	if (f3.user_id>0 && f3.upgrading==0) {	maxProdQueueLength=40;	}

	if (ad2460.productionqueue.length>=maxProdQueueLength) {
		if (maxProdQueueLength<40) {
			systemFeedback("Error", "Production queue full. Upgrade your Assembly Line Facility to increase capacity.", 1, 2);
			return false;
		}
		else {
			systemFeedback("Error", "Production queue full.", 1, 2);
			return false;
		}
	}

	if (id>0){
		hideHelpCommander();
		$.post('actionhandler.pl', {action:'initiate_production', id:id, num:num}, function(data){ parseInfo(data);});
	}
	play_multi_sound("sfx_click3");
	event.stopPropagation();
	return false;

}

function addProductionQueueItem(id, time, finish_time, priority, h_cost, n_cost, s_cost, i_cost,queue_id, building, est_build_time){
	ad2460.productionqueue.push(new productionQueueItem(id, time, finish_time, priority, h_cost, n_cost, s_cost, i_cost, queue_id, building, est_build_time));
	checkScrollButtonStatus('infopanel_production_queue_container');
}

function updateCurrentResearch(id,time,finish_time,upgrading,user_id){
	var i=0;
	for (i=0;i<ad2460.researches.length ;i++ ){
		if (ad2460.researches[i].id==id){
			ad2460.researches[i].upgrading=upgrading;
			ad2460.researches[i].start_time=time;
			ad2460.researches[i].end_time=finish_time;
			ad2460.researches[i].user_id=user_id;

		}
	}
	renderResearches(ad2460.homeworldSelectedItems.research_view);
}

function removeProductionQueueItems(){
	removeChildNodes('production_queue_container');
}

function updateCurrentDevelopment(id,time,finish_time,upgrading,user_id){
	var i=0;
	for (i=0;i<ad2460.developments.length ;i++ ){
		if (ad2460.developments[i].id==id){
			ad2460.developments[i].upgrading=upgrading;
			ad2460.developments[i].start_time=time;
			ad2460.developments[i].end_time=finish_time;
			ad2460.developments[i].user_id=user_id;

		}
	}
	renderDevelopments(ad2460.homeworldSelectedItems.development_view);
}

function updateCurrentFacility(id,time,finish_time,upgrading,user_id){
	var i=0;
	for (i=0;i<ad2460.facilities.length ;i++ ){
		if (ad2460.facilities[i].id==id){
			ad2460.facilities[i].upgrading=upgrading;
			ad2460.facilities[i].start_time=time;
			ad2460.facilities[i].end_time=finish_time;
			ad2460.facilities[i].user_id=user_id;

		}
	}
	renderFacilities('available');
}

function returnSpecialAbilityName(ability_id){
	var string='None';
	if (ability_id==1){		string='Boosts nearby shields';	}
	if (ability_id==2){		string='Creates singularity';	}
	if (ability_id==3){		string='Anti-Minor EMP blast';	}
	if (ability_id==4){		string='Soaks up shield-damage';	}
	if (ability_id==5){		string='Cloaking';	}
	if (ability_id==6){		string='Shoots down missiles';	}

	return string;
}

function returnUnitBonuses(ship_type_id){
	var retObj={};
	var s=returnGameObjectById(ship_type_id);
	if (s!=false) {
		var hullBonusPercent=0;
		var priWdamageBonusPercent=0;
		var secWdamageBonusPercent=0;
		var terWdamageBonusPercent=0;
		var shieldBonusPercent=0;
		var shieldRegenPercent=0;

		retObj.hullBonus=0;
		retObj.absorbBonus=0;


		retObj.shieldBonus=0;


		retObj.shieldRegenBonus=0;

		retObj.priWdamageBonus=0;
		retObj.priWrangeBonus=0;
		retObj.priWtargetingBonus=0;
		retObj.priWcritBonus=0;

		retObj.secWdamageBonus=0;
		retObj.secWrangeBonus=0;
		retObj.secWtargetingBonus=0;
		retObj.secWcritBonus=0;

		retObj.terWdamageBonus=0;
		retObj.terWrangeBonus=0;
		retObj.terWtargetingBonus=0;
		retObj.terWcritBonus=0;

		retObj.cargoBonus=0;
		retObj.hangarBonus=0;

		retObj.volatilityBonus=0;
		retObj.manBonus=0;

		var o=returnGameObjectById(103); // all units +2 % hull
		// ## CHANGED TO SOMETHING COMPLETELY DIFFERENT!
		// if (o.user_id>0 && o.upgrading==0){
		//	hullBonusPercent+=2;
		// }
		var o=returnGameObjectById(121); // all matter units +2 % hull
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Matter'){
				hullBonusPercent+=2;
			}
		}
		var o=returnGameObjectById(130); // all matter pds +10 % hull
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Matter' && s.vesseltype=='Satelite'){
				hullBonusPercent+=10;
			}
		}
		var o=returnGameObjectById(134); // all matter ships +5 % hull
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Matter' && s.vesseltype=='Normal'){
				hullBonusPercent+=5;
			}
		}

		var o=returnGameObjectById(139); // all matter minor ships +10 % hull
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Matter' && s.vesseltype=='Normal' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette') ){
				hullBonusPercent+=10;
			}
		}

		var o=returnGameObjectById(802); // all capital ships +1 % hull per point
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				hullBonusPercent+=o.points;
			}
		}

		var o=returnGameObjectById(809); // all minor ships +5 % hull per point
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Normal' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette' ) && s.id!= 407 ) {
				//except ghosts 407 ofc
				hullBonusPercent+=o.points*5;
			}
		}

		var o=returnGameObjectById(832); // new pds bonuses
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Satelite' && s.tech=='Matter'){
				hullBonusPercent+=o.points*5;
				priWdamageBonusPercent+=o.points*2;
			}
		}

		var o=returnGameObjectById(835); // new pds bonuses
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Satelite'   && s.tech=='Energy'){
				shieldBonusPercent+=o.points*10;
				priWdamageBonusPercent+=o.points*2;
			}
		}

		var o=returnGameObjectById(838); // new pds bonuses
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Satelite'  && s.tech=='Displacement'){
				shieldBonusPercent+=o.points*5;
				hullBonusPercent+=o.points*2;
				priWdamageBonusPercent+=o.points*2;
			}
		}

		// phew!

		if(s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
			if (ad2460.allianceData.id>0){
				retObj.absorbBonus+=(s.hullshield*ad2460.allianceData.sectorBonuses.absorbption/100);
			}
		}


		var o=returnGameObjectById(119); // capital ships get + 10 absorbBonus
		if (o.user_id>0 && o.upgrading==0){
			if(s.vesseltype=='Normal'){
				if (s.vesselclass=='Frigate'){
					retObj.absorbBonus+=20;
				}
				if (s.vesselclass=='Cruiser' || s.vesselclass=='Carrier'){
					retObj.absorbBonus+=80;
				}
				if (s.vesselclass=='Battleship'){
					retObj.absorbBonus+=150;
				}
			}
		}

		// done
		//retObj.shieldBonus=0;
		//var shieldBonusPercent=0;
		var o=returnGameObjectById(104); // all units +2 % shield
		// ## CHANGED TO SOMETHING COMPLETELY DIFFERENT!
		//if (o.user_id>0 && o.upgrading==0){
		//	shieldBonusPercent+=2;
		//}

		var o=returnGameObjectById(122); // all matter units +2 % shield
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Matter' ){
				shieldBonusPercent+=2;
			}
		}

		var o=returnGameObjectById(135); // all matter capitals +3 % shield
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Matter' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				shieldBonusPercent+=3;
			}
		}

		var o=returnGameObjectById(142); // all energy units +2 % shield
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Energy' ){
				shieldBonusPercent+=2;
			}
		}

		var o=returnGameObjectById(151); // all energy capitals +4 % shield
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Energy' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				shieldBonusPercent+=4;
			}
		}

		var o=returnGameObjectById(161); // +2% shieldstrength for ALL displacement UNITS
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Displacement' ){
				shieldBonusPercent+=2;
			}
		}

		var o=returnGameObjectById(805); // All capital ships +1% shieldstrength per point! All techs!
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				shieldBonusPercent+=1*o.points;
			}
		}

		var o=returnGameObjectById(813); // All minor ships +5% shieldstrength per point! All techs!
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Normal' && (s.tech=='Matter' || s.tech=='Energy' || s.tech=='Displacement' ) && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette' ) ){
				shieldBonusPercent+=5*o.points;
			}
		}

		var o=returnGameObjectById(815); // All energy capital ships +2% shieldstrength per point
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Normal' && ( s.tech=='Energy' ) && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier' ) ){
				shieldBonusPercent+=2*o.points;
			}
		}

		var o=returnGameObjectById(835); // Energy shield-booster 10% more shields per point
		if (o.user_id>0 && o.points>0){
			if( ship_type_id==505 ){
				shieldBonusPercent+=10*o.points;
			}
		}


		// Phew, thats the shield!

		// Regen-time!

		if(s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
			if (ad2460.allianceData.id>0){
				shieldRegenPercent+=ad2460.allianceData.sectorBonuses.shield_regen;
			}
		}


		var o=returnGameObjectById(136); // +6 percent shield-recharge for all matter capital ships (so not PDS)
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Matter' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				shieldRegenPercent+=6;
			}
		}

		var o=returnGameObjectById(143); // +4 percent shieldrecharge to all energy units
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Energy' ){
				shieldRegenPercent+=4;
			}
		}

		var o=returnGameObjectById(156); // +10% Energy Shield Recharge for energy capital ships
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Energy' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				shieldRegenPercent+=10;
			}
		}

		var o=returnGameObjectById(176); // +15% shield regen for all displacement capital ships
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Displacement' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				shieldRegenPercent+=15;
			}
		}

		retObj.shieldRegenBonus=Math.floor(s.shieldrecharge*shieldRegenPercent/100);

		var o=returnGameObjectById(110); // +2 weaponrange (all)
		if (o.user_id>0 && o.upgrading==0){
			retObj.priWrangeBonus+=2;
			retObj.secWrangeBonus+=2;
			retObj.terWrangeBonus+=2;
		}

		var o=returnGameObjectById(153); // +5 weaponrange for all energy capital ships all weapons (description sounds like primaries tbh)
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Energy' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				retObj.priWrangeBonus+=5;
				retObj.secWrangeBonus+=5;
				retObj.terWrangeBonus+=5;
			}
		}

		var o=returnGameObjectById(173); // +3 range for all displacement capital ships and pds
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Displacement' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				retObj.priWrangeBonus+=3;
				retObj.secWrangeBonus+=3;
				retObj.terWrangeBonus+=3;
			}
		}


		var o=returnGameObjectById(839); // All matter battleships gets +1 range on primary weapons per point
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Normal' && ( s.tech=='Matter' ) && (s.vesselclass=='Battleship') ){
				retObj.priWrangeBonus+=1*o.points;
			}
		}

		var o=returnGameObjectById(842); // All energy frigates gets 1 range on primary weapons
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Normal' && ( s.tech=='Energy' ) && (s.vesselclass=='Frigate') ){
				retObj.priWrangeBonus+=1*o.points;
			}
		}

		var o=returnGameObjectById(845); // All displacement Cruisers 1 extra range per point
		if (o.user_id>0 && o.points>0){
			if(s.vesseltype=='Normal' && ( s.tech=='Displacement' ) && (s.vesselclass=='Cruiser') ){
				retObj.priWrangeBonus+=1*o.points;
			}
		}

		// Damage-time

		if(s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
			if (ad2460.allianceData.id>0){
				priWdamageBonusPercent+=ad2460.allianceData.sectorBonuses.primary_damage;
				secWdamageBonusPercent+=ad2460.allianceData.sectorBonuses.secondary_damage;
				terWdamageBonusPercent+=ad2460.allianceData.sectorBonuses.tertiary_damage;
			}
		}

		var o=returnGameObjectById(115); // +5 percent secondary weaponstrength for all capital ships (so not PDS)
		if (o.user_id>0 && o.upgrading==0){
			if(s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				secWdamageBonusPercent+=5;
			}
		}


		var o=returnGameObjectById(123); // +2 percent damage to all matter weapons
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Matter' ) {
				priWdamageBonusPercent+=2;
				secWdamageBonusPercent+=2;
				terWdamageBonusPercent+=2;
			}
		}

		var o=returnGameObjectById(131); //  +4% weaponstrength to all Matter ships
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Matter' && s.vesseltype=='Normal' ) {
				priWdamageBonusPercent+=4;
				secWdamageBonusPercent+=4;
				terWdamageBonusPercent+=4;
			}
		}

		var o=returnGameObjectById(137); // all matter capital ships +10 % secondary damage
		if (o.user_id>0 && o.upgrading==0){
			if(s.tech == 'Matter' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				secWdamageBonusPercent+=10;
			}
		}


		var o=returnGameObjectById(138); //  138) { ### +4 percent primary weapon damage for all matter capital ships (so not PDS)
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Matter' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ) {
				priWdamageBonusPercent+=4;
			}
		}


		var o=returnGameObjectById(141); //  +2 percent damage to all energy units
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Energy') {
				priWdamageBonusPercent+=2;
				secWdamageBonusPercent+=2;
				terWdamageBonusPercent+=2;
			}
		}

		var o=returnGameObjectById(150); //  +3 % Energy PDS firepower
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Energy' && s.vesseltype=='Satelite') {
				priWdamageBonusPercent+=3;
				secWdamageBonusPercent+=3;
				terWdamageBonusPercent+=3;
			}
		}

		var o=returnGameObjectById(155); //  +10 % tertiary weaponstrength for all energy capital ships
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Energy' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ) {
				terWdamageBonusPercent+=10;
			}
		}

		var o=returnGameObjectById(158); //  +4% primary damage energy capital ships
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Energy' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ) {
				priWdamageBonusPercent+=4;
			}
		}

		var special_primary_damage=0;
		var o=returnGameObjectById(159); //  +7 damage for energy minor ships primary weapon...shit...7 points, not percent...
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Energy' && s.vesseltype=='Normal' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette' ) ) {
				special_primary_damage=7;
				//console.log("added the 7 points static primary damage");
			}
		}

		// 162) { ### +2% weaponstrength for ALL displacement UNITS
		var o=returnGameObjectById(162); //  +2% weaponstrength for ALL displacement UNITS
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Displacement' ) {
				priWdamageBonusPercent+=2;
				secWdamageBonusPercent+=2;
				terWdamageBonusPercent+=2;
			}
		}

		var o=returnGameObjectById(170); //  +5% weaponstrength for displacement-pds
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Displacement' && s.vesseltype=='Satelite') {
				priWdamageBonusPercent+=5;
				secWdamageBonusPercent+=5;
				terWdamageBonusPercent+=5;
			}
		}

		var o=returnGameObjectById(171); //  +4% weaponstrength to all Displacement ships
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Displacement') {
				priWdamageBonusPercent+=4;
				secWdamageBonusPercent+=4;
				terWdamageBonusPercent+=4;
			}
		}

		var o=returnGameObjectById(178); //  +8% primary weaponstrength for displacement capital ships
		if (o.user_id>0 && o.upgrading==0){
			if ( s.tech=='Displacement' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ) {
				priWdamageBonusPercent+=8;
			}
		}


		var o=returnGameObjectById(801); // All matter units +1% weaponstrength per point
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Matter' ){
				priWdamageBonusPercent+=o.points;
				secWdamageBonusPercent+=o.points;
				terWdamageBonusPercent+=o.points;
			}
		}

		var o=returnGameObjectById(804); // All energy units +1% weaponstrength per point
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Energy' ){
				priWdamageBonusPercent+=o.points;
				secWdamageBonusPercent+=o.points;
				terWdamageBonusPercent+=o.points;
			}
		}

		var o=returnGameObjectById(807); // All displacement units +1% weaponstrength per point
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Displacement' ){
				priWdamageBonusPercent+=o.points;
				secWdamageBonusPercent+=o.points;
				terWdamageBonusPercent+=o.points;
			}
		}

		var o=returnGameObjectById(810); // Matter minor ships +5% weaponstrength per point!
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Matter' && s.vesseltype=='Normal' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette' ) ){
				priWdamageBonusPercent+=o.points*5;
				secWdamageBonusPercent+=o.points*5;
				terWdamageBonusPercent+=o.points*5;
			}
		}

		var o=returnGameObjectById(811); // all matter capital ships +2 % secondary damage per point
		if (o.user_id>0 && o.points>0){
			if(s.tech=='Matter' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				secWdamageBonusPercent+=o.points*2;
			}
		}


		var o=returnGameObjectById(814); // Energy minor ships +5% weaponstrength per point!
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Energy' && s.vesseltype=='Normal' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette' ) ){
				priWdamageBonusPercent+=o.points*5;
				secWdamageBonusPercent+=o.points*5;
				terWdamageBonusPercent+=o.points*5;
			}
		}

		var o=returnGameObjectById(818); // Displacement minor ships +5% weaponstrength per point!
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Displacement' && s.vesseltype=='Normal' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette' ) ){
				priWdamageBonusPercent+=o.points*5;
				secWdamageBonusPercent+=o.points*5;
				terWdamageBonusPercent+=o.points*5;
			}
		}

		// 812  All matter capital ships +1% primary damage per point
		var o=returnGameObjectById(812); // All matter capital ships +1% primary damage per point
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Matter' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier' ) ){
				priWdamageBonusPercent+=o.points*1;
			}
		}

		// 816  All energy capital ships +1% primary damage per point
		var o=returnGameObjectById(816); // All energy capital ships +1% primary damage per point
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Energy' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier' ) ){
				priWdamageBonusPercent+=o.points*1;
			}
		}

		// 820  All displacement capital ships +1% primary weaponstrength per point
		var o=returnGameObjectById(820); // All displacement capital ships +1% primary damage per point
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Displacement' && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier' ) ){
				priWdamageBonusPercent+=o.points*1;
			}
		}



		// Targeting

		var o=returnGameObjectById(101); //  +2 targetting all units..
		// ## CHANGED TO SOMETHING COMPLETELY DIFFERENT!
		if (o.user_id>0 && o.upgrading==0){
			// retObj.priWtargetingBonus+=2;
			// retObj.secWtargetingBonus+=2;
			// retObj.terWtargetingBonus+=2;
		}

		var o=returnGameObjectById(128); //  +2 targetting for secondary matter weapons
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Matter'){
				retObj.secWtargetingBonus+=2;
			}
		}

		var o=returnGameObjectById(145); //  +2 targetting to primary weapons of energy SHIPs
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Energy' && s.vesseltype=='Normal'){
				retObj.priWtargetingBonus+=2;
			}
		}

		var o=returnGameObjectById(165); //  +2 targeting on tertiary displacement weapons
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Displacement' ){
				retObj.terWtargetingBonus+=2;
			}
		}

		// Crits

		var o=returnGameObjectById(124); //  +2 critical chance to secondary weapons of minor matter ships
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Matter' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette'  ) ){
				retObj.secWcritBonus+=2;
			}
		}

		var o=returnGameObjectById(140); //  +1 critical chance for all matter capital ships (so not PDS) all weapons
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Matter' && s.vesseltype=='Normal' &&  (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				retObj.priWcritBonus+=1;
				retObj.secWcritBonus+=1;
				retObj.terWcritBonus+=1;
			}
		}

		var o=returnGameObjectById(144); //  +1 critical chance to minor energy ships (all weapons)
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Energy' && s.vesseltype=='Normal' &&  (s.vesselclass=='Fighter' || s.vesselclass=='Corvette' ) ){
				retObj.priWcritBonus+=1;
				retObj.secWcritBonus+=1;
				retObj.terWcritBonus+=1;
			}
		}

		var o=returnGameObjectById(160); //  +2 critical chance on all energy units weapons, ships and pds!
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Energy' &&  (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier' ) ){
				retObj.priWcritBonus+=2;
				retObj.secWcritBonus+=2;
				retObj.terWcritBonus+=2;
			}
		}

		var o=returnGameObjectById(164); //  +1 crit-chance for secondaries on minor displacement ships
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Displacement' && s.vesseltype=='Normal' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette' ) ){
				retObj.secWcritBonus+=1;
			}
		}
		var o=returnGameObjectById(175); //  +2 critical chance on tertiary weapons capital displacement ships and pds
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Displacement'  && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier'  ) ){
				retObj.terWcritBonus+=2;
			}
		}

		var o=returnGameObjectById(180); //  +2% crit-chance for secondary wepons, all displacement ships
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Displacement'  && s.vesseltype=='Normal' ){
				retObj.secWcritBonus+=2;
			}
		}


		// retObj.manBonus
		var o=returnGameObjectById(102); //  +3 maneuverability all ships
		// ## CHANGED TO SOMETHING COMPLETELY DIFFERENT!
		// if (o.user_id>0 && o.upgrading==0){
		//	if( s.vesseltype=='Normal' ){
		//		 retObj.manBonus+=3;
		//	}
		// }

		var o=returnGameObjectById(163); //  +2 maneuverability for ALL displacement ships
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Displacement'  && s.vesseltype=='Normal' ){
				retObj.manBonus+=2;
			}
		}
		var o=returnGameObjectById(177); //  +3 maneuverability displacement capital ships
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Displacement'  && s.vesseltype=='Normal'){
				if (s.vesselclass=='Frigate'){
					retObj.manBonus+=4;
				}
				if (s.vesselclass=='Cruiser'){
					retObj.manBonus+=2;
				}
				if (s.vesselclass=='Battleship'){
					retObj.manBonus+=1;
				}
			}


		}
		var o=returnGameObjectById(179); //  +5 maneuverability for displacement minor ships
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Displacement'  && s.vesseltype=='Normal'  && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette' ) ){
				retObj.manBonus+=5;
			}
		}

		var o=returnGameObjectById(808); // All capital ships +1 maneuverability per point! All techs!
		if (o.user_id>0 && o.points>0){
			if ( s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier' ) ){
				retObj.manBonus+=o.points*1;
			}
		}

		var o=returnGameObjectById(817); // All minor ships +5 maneuverability per point! All techs!
		if (o.user_id>0 && o.points>0){
			if( (s.tech=='Matter' || s.tech=='Energy' || s.tech=='Displacement' ) && s.vesseltype=='Normal' && (s.vesselclass=='Fighter' || s.vesselclass=='Corvette') ){
				retObj.manBonus+=o.points*3;
			}
		}

		var o=returnGameObjectById(819); // All displacement capital ships +1 maneuverability per point
		if (o.user_id>0 && o.points>0){
			if( ( s.tech=='Displacement' ) && s.vesseltype=='Normal' && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier' ) ){
				retObj.manBonus+=o.points*1;
			}
		}

		/*
		retObj.volatilityBonus=0;
		*/

		var o=returnGameObjectById(133); //  -2 Volatility to all Matter Ships
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Matter'  && s.vesseltype=='Normal'  && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier') ){
				retObj.volatilityBonus-=2
			}
		}

		var o=returnGameObjectById(154); //  -4 StronTech volatility capital ships
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Energy'  && s.vesseltype=='Normal'  && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier') ){
				retObj.volatilityBonus-=4
			}
		}

		var o=returnGameObjectById(174); //  -2 volatility, all displacement ships
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Displacement'  && s.vesseltype=='Normal'  && (s.vesselclass=='Frigate' || s.vesselclass=='Cruiser' || s.vesselclass=='Battleship' || s.vesselclass=='Carrier') ){
				retObj.volatilityBonus-=2
			}
		}

		// Hangarspace

		var o=returnGameObjectById(118); // All carriers of all techs +2 hangarspace
		if (o.user_id>0 && o.upgrading==0){
			if( s.vesseltype=='Normal'  && (s.vesselclass=='Carrier') ){
				retObj.hangarBonus+=2;
			}
		}

		var o=returnGameObjectById(125); // Matter carrier +2 hangar space
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Matter' && s.vesseltype=='Normal'  && (s.vesselclass=='Carrier') ){
				retObj.hangarBonus+=2;
			}
		}

		var o=returnGameObjectById(137); // Matter carrier +4 hangar space
		if (o.user_id>0 && o.upgrading==0){
			if( s.tech=='Matter' && s.vesseltype=='Normal'  && (s.vesselclass=='Carrier') ){
				retObj.hangarBonus+=4;
			}
		}

		var o=returnGameObjectById(841); // Matter carrier +1 hangar space per point
		if (o.user_id>0 && o.points>0){
			if( s.tech=='Matter' && s.vesseltype=='Normal'  && (s.vesselclass=='Carrier') ){
				// retObj.hangarBonus+=o.points*1;
			}
		}

		// retObj.cargoBonus=0;
		var cargoBonusPercent=0;

		var o=returnGameObjectById(109); // +4% cargo
		if (o.user_id>0 && o.upgrading==0){
			if( ship_type_id==435 || ship_type_id==436 ){
				cargoBonusPercent+=4;
			}
		}

		var o=returnGameObjectById(111); // +10% cargo
		if (o.user_id>0 && o.upgrading==0){
			if( ship_type_id==435 || ship_type_id==436 ){
				cargoBonusPercent+=10;
			}
		}

		var o=returnGameObjectById(841); // +10% cargo per point
		if (o.user_id>0 && o.points>0){
			if( ship_type_id==435 || ship_type_id==436 ){
				// cargoBonusPercent+=o.points*10;
			}
		}

		var o=returnGameObjectById(823); // + 5% Absorb PP for all PDS, + 10% SecFP for all PDS, + Shield Eff as is.
		if (o.user_id>0 && o.points>0){
			if( s.vesseltype=='Satelite' && (s.tech=='Matter') ){
				retObj.absorbBonus+=(o.points*2*s.hullshield/100);
				secWdamageBonusPercent+=(o.points*2);
			}
		}

		var o=returnGameObjectById(826); // + 5% Absorb PP for all PDS, + 10% SecFP for all PDS, + Shield Eff as is.
		if (o.user_id>0 && o.points>0){
			if( s.vesseltype=='Satelite' && (s.tech=='Energy') ){
				hullBonusPercent+=(o.points*5);
				secWdamageBonusPercent+=(o.points*2);
			}
		}

		var o=returnGameObjectById(829); // + 5% Absorb PP for all PDS, + 10% SecFP for all PDS, + Shield Eff as is.
		if (o.user_id>0 && o.points>0){
			if( s.vesseltype=='Satelite' && ( s.tech=='Displacement' ) ){
				// retObj.terWrangeBonus+=o.points;
				secWdamageBonusPercent+=(o.points*2);
			}
		}

		retObj.priWdamageBonus+=special_primary_damage+Math.floor( (s.primary_weaponstrength)*priWdamageBonusPercent/100);
		retObj.secWdamageBonus+=Math.floor(s.secondary_weaponstrength*secWdamageBonusPercent/100);
		retObj.terWdamageBonus+=Math.floor(s.tertiary_weaponstrength*terWdamageBonusPercent/100);

		retObj.hullBonus=Math.floor(s.hullstrength*hullBonusPercent/100);
		retObj.shieldBonus=Math.floor(s.shieldstrength*shieldBonusPercent/100);

		if (special_primary_damage>0){
			//console.log(s.primary_weaponstrength, special_primary_damage, priWdamageBonusPercent, retObj.priWdamageBonus );
		}


		retObj.cargoBonus+=Math.floor(s.cargo_capacity*cargoBonusPercent/100);
	}

	return retObj;

}

function openShipSlide(id){
	// Fill in the data from the right ship :)
	//console.log("opening shipslide");

	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		thisItem=ad2460.productionitems[i];
		if (thisItem.id==id){
			var bonusObj=returnUnitBonuses(id);
			//console.log("found ship");
			document.getElementById('shipslide_ship_image').setAttribute('src','images/shipslide/'+id+'.jpg');
			if (thisItem.vesseltype=='Satelite'){
				$("#shipslide_stat_unitname").html(thisItem.name+' - '+'Orbital Defense System');
			}
			else {
				$("#shipslide_stat_unitname").html(thisItem.name+' - '+thisItem.vesseltype+' '+thisItem.vesselclass);
			}

			$("#shipslide_stat_hull").html(prettyPrint(thisItem.hullstrength+bonusObj.hullBonus));
			$("#shipslide_stat_absorbs").html(thisItem.hullshield+bonusObj.absorbBonus);
			$("#shipslide_stat_shield").html(prettyPrint(thisItem.shieldstrength+bonusObj.shieldBonus)+' ('+fullTechType(thisItem.shieldtype)+')');
			$("#shipslide_stat_shield_recharge").html(prettyPrint(thisItem.shieldrecharge+bonusObj.shieldRegenBonus));
			$("#shipslide_stat_pri_weapon").html(thisItem.primary_guns+'X ('+fullTechType(thisItem.primary_weapontype)+')');
			$("#shipslide_stat_pri_range").html(thisItem.primary_range+bonusObj.priWrangeBonus);
			$("#shipslide_stat_pri_damage").html(prettyPrint(thisItem.primary_weaponstrength+bonusObj.priWdamageBonus));
			$("#shipslide_stat_pri_targeting").html(thisItem.primary_weaponspeed+bonusObj.priWtargetingBonus);
			$("#shipslide_stat_pri_rof").html(thisItem.primary_rateoffire);
			$("#shipslide_stat_sec_weapon").html(thisItem.secondary_guns+'X ('+fullTechType(thisItem.secondary_weapontype)+')');
			$("#shipslide_stat_sec_range").html(thisItem.secondary_range+bonusObj.secWrangeBonus);
			$("#shipslide_stat_sec_damage").html(thisItem.secondary_weaponstrength+bonusObj.secWdamageBonus);
			$("#shipslide_stat_sec_targeting").html(thisItem.secondary_weaponspeed+bonusObj.secWtargetingBonus);
			$("#shipslide_stat_sec_rof").html(thisItem.secondary_rateoffire);
			$("#shipslide_stat_ter_weapon").html(thisItem.tertiary_guns+'X ('+fullTechType(thisItem.tertiary_weapontype)+')');
			$("#shipslide_stat_ter_range").html(thisItem.tertiary_range+bonusObj.terWrangeBonus);
			$("#shipslide_stat_ter_damage").html(thisItem.tertiary_weaponstrength+bonusObj.terWdamageBonus);
			$("#shipslide_stat_ter_targeting").html(thisItem.tertiary_weaponspeed+bonusObj.terWtargetingBonus);
			$("#shipslide_stat_ter_rof").html(thisItem.tertiary_rateoffire);
			$("#shipslide_stat_cargo").html(prettyPrint(thisItem.cargo_capacity+bonusObj.cargoBonus));
			$("#shipslide_stat_hangar").html(thisItem.hangar_capacity+bonusObj.hangarBonus);
			$("#shipslide_stat_jumprange").html(thisItem.jump_range);
			$("#shipslide_stat_volatility").html(thisItem.volatility+bonusObj.volatilityBonus);
			$("#shipslide_stat_maneuverability").html(thisItem.maneuverability+bonusObj.manBonus);
			$("#shipslide_stat_pri_special").html(returnSpecialAbilityName(thisItem.primary_special_effect_id));
			$("#shipslide_stat_sec_special").html(returnSpecialAbilityName(thisItem.secondary_special_effect_id));
			$("#shipslide_stat_longdescription").html(thisItem.description);
			$("#shipslide_stat_pri_crit").html(thisItem.primary_crit_chance+bonusObj.priWcritBonus);
			$("#shipslide_stat_sec_crit").html(thisItem.secondary_crit_chance+bonusObj.secWcritBonus);
			$("#shipslide_stat_ter_crit").html(thisItem.tertiary_crit_chance+bonusObj.terWcritBonus);

		}
	}
	$("#shipslide").show();
	//$("#shipslide").stop().animate({ left : "199px" }, 500);
	openSlide('shipslide');
	//shipslidePanelOpen=1;
}


function updateHomeworldShipcount(){
	$("#homeworld_planet_fleet_size").html(ad2460.fleetvars.total_capital_ship_count);
	updateFleetManagementStats();
}

function updateHourlyHomeworldResourceGeneration(){
	var res=returnHomeworldResourceExtraction();

	$("#hw_res_prod_h").html(prettyPrint(res.hassium));
	$("#hw_res_prod_n").html(prettyPrint(res.neodymium));
	$("#hw_res_prod_s").html(prettyPrint(res.strontium));
	$("#hw_res_prod_i").html(prettyPrint(res.indium));
}

function updateHomeworldName(){
	var enteredName=$("#homeworld_planet_name").text();
	enteredName=enteredName.replace('<br>','');
	enteredName=enteredName.replace('<','');
	enteredName=enteredName.replace('>','');
	enteredName=enteredName.replace('&','');
	enteredName=enteredName.replace(';','');
	enteredName=enteredName.replace('"','');
	enteredName=enteredName.replace("'","");
	enteredName = enteredName.replace(/(\r\n|\n|\r)/gm,"");
	if (enteredName==''){
		setHomeworldName(ad2460.homeworld.name);
	}
	else {
		$.post('actionhandler.pl', {action:'rename_homeworld',new_name:enteredName}, function(data){ parseInfo(data);});
	}

}

function setHomeworldName(name){
	document.getElementById('homeworld_planet_name').innerHTML=name;
	ad2460.homeworld.name=name;
}


function calc_max_storage(){
	ad2460.resources.max_storage.hassium=1000000;
	ad2460.resources.max_storage.neodymium=1000000;
	ad2460.resources.max_storage.strontium=1000000;
	ad2460.resources.max_storage.indium=1000000;

	for (i=0;i<ad2460.facilities.length ;i++ ){
		if (ad2460.facilities[i].user_id>0 && ad2460.facilities[i].upgrading==0){
			// The building is present..
			// Check for corresponding ids and alter the max storage accordingly

			if(ad2460.facilities[i].facility_id==385) {
				ad2460.resources.max_storage.hassium+=2000000;
			}
			else if(ad2460.facilities[i].facility_id==386) {
				ad2460.resources.max_storage.hassium+=10000000;
			}
			else if(ad2460.facilities[i].facility_id==387) {
				ad2460.resources.max_storage.hassium+=27000000;
			}
			else if(ad2460.facilities[i].facility_id==388) {
				ad2460.resources.max_storage.indium+=2000000;
			}
			else if(ad2460.facilities[i].facility_id==389) {
				ad2460.resources.max_storage.indium+=10000000;
			}
			else if(ad2460.facilities[i].facility_id==390) {
				ad2460.resources.max_storage.indium+=27000000;
			}
			else if(ad2460.facilities[i].facility_id==391) {
				ad2460.resources.max_storage.strontium+=2000000;
			}
			else if(ad2460.facilities[i].facility_id==392) {
				ad2460.resources.max_storage.strontium+=10000000;
			}
			else if(ad2460.facilities[i].facility_id==393) {
				ad2460.resources.max_storage.strontium+=27000000;
			}
			else if(ad2460.facilities[i].facility_id==394) {
				ad2460.resources.max_storage.neodymium+=2000000;
			}
			else if(ad2460.facilities[i].facility_id==395) {
				ad2460.resources.max_storage.neodymium+=10000000;
			}
			else if(ad2460.facilities[i].facility_id==396) {
				ad2460.resources.max_storage.neodymium+=27000000;
			}
		}
	}

	var storage_bonus_percent_hassium=0;
	var storage_bonus_percent_neodymium=0;
	var storage_bonus_percent_strontium=0;
	var storage_bonus_percent_indium=0;

	var r=returnGameObjectById(106);
	if (r!=false){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			storage_bonus_percent_hassium+=25;
		}
	}
	var r=returnGameObjectById(127);
	if (r!=false){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			storage_bonus_percent_indium+=25;
		}
	}
	var r=returnGameObjectById(147);
	if (r!=false){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			storage_bonus_percent_strontium+=25;
		}
	}
	var r=returnGameObjectById(167);
	if (r!=false){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			storage_bonus_percent_neodymium+=25;
		}
	}

	ad2460.resources.max_storage.hassium+=Math.floor(ad2460.resources.max_storage.hassium*storage_bonus_percent_hassium/100);
	ad2460.resources.max_storage.neodymium+=Math.floor(ad2460.resources.max_storage.neodymium*storage_bonus_percent_neodymium/100);
	ad2460.resources.max_storage.strontium+=Math.floor(ad2460.resources.max_storage.strontium*storage_bonus_percent_strontium/100);
	ad2460.resources.max_storage.indium+=Math.floor(ad2460.resources.max_storage.indium*storage_bonus_percent_indium/100);

	$("#max_hassium_homeworld_storage").html(prettyPrint(ad2460.resources.max_storage.hassium));
	$("#max_neodymium_homeworld_storage").html(prettyPrint(ad2460.resources.max_storage.neodymium));
	$("#max_strontium_homeworld_storage").html(prettyPrint(ad2460.resources.max_storage.strontium));
	$("#max_indium_homeworld_storage").html(prettyPrint(ad2460.resources.max_storage.indium));

	var hassium_storage_percent=Math.floor(ad2460.resources.hassium*100/ad2460.resources.max_storage.hassium);
	var neodymium_storage_percent=Math.floor(ad2460.resources.neodymium*100/ad2460.resources.max_storage.neodymium);
	var strontium_storage_percent=Math.floor(ad2460.resources.strontium*100/ad2460.resources.max_storage.strontium);
	var indium_storage_percent=Math.floor(ad2460.resources.indium*100/ad2460.resources.max_storage.indium);

	$("#max_hassium_homeworld_storage_percent").html(hassium_storage_percent +' %');
	$("#max_neodymium_homeworld_storage_percent").html(neodymium_storage_percent +' %');
	$("#max_strontium_homeworld_storage_percent").html(strontium_storage_percent +' %');
	$("#max_indium_homeworld_storage_percent").html(indium_storage_percent +' %');

}

function returnHomeworldResourceExtraction(){
	var i=0;
	var hassium=0;
	var neodymium=0;
	var strontium=0;
	var indium=0;

	// Keep up-to-date with resource-ticker

	for (i=0;i<ad2460.facilities.length ;i++ ){
		var f=ad2460.facilities[i];
		if (f.upgrading!=1){

			if (f.facility_id==367) {
				// Refinery 1 buillt
				hassium+=1000; 		neodymium+=1000;	strontium+=1000;	indium+=1000;
			}
			else if (f.facility_id==368) {
				// Refinery 1 buillt
				hassium+=2000; 		neodymium+=2000;	strontium+=2000;	indium+=2000;
			}
			else if (f.facility_id==369) {
				// Refinery 1 buillt
				hassium+=4000; 		neodymium+=4000;	strontium+=4000;	indium+=4000;
			}
			else if (f.facility_id==370) {
				// Refinery 1 buillt
				hassium+=1000;
			}
			else if (f.facility_id==371) {
				// Refinery 1 buillt
				hassium+=2000;
			}
			else if (f.facility_id==372) {
				// Refinery 1 buillt
				hassium+=4000;
			}
			else if (f.facility_id==373) {
				// Refinery 1 buillt
				indium+=1000;
			}
			else if (f.facility_id==374) {
				// Refinery 1 buillt
				indium+=2000;
			}
			else if (f.facility_id==375) {
				// Refinery 1 buillt
				indium+=4000;
			}
			else if (f.facility_id==376) {
				// Refinery 1 buillt
				strontium+=1000;
			}
			else if (f.facility_id==377) {
				// Refinery 1 buillt
				strontium+=2000;
			}
			else if (f.facility_id==378) {
				// Refinery 1 buillt
				strontium+=4000;
			}
			else if (f.facility_id==379) {
				// Refinery 1 buillt
				neodymium+=1000;
			}
			else if (f.facility_id==380) {
				// Refinery 1 buillt
				neodymium+=2000;
			}
			else if (f.facility_id==381) {
				// Refinery 1 buillt
				neodymium+=4000;
			}
			else if (f.facility_id==383) {
				// Ore Facility L2
				hassium+=6000; 		neodymium+=6000;	strontium+=6000;	indium+=6000;
			}
			else if (f.facility_id==384) {
				// Ore Facility L3
				hassium+=8000; 		neodymium+=8000;	strontium+=8000;	indium+=8000;
			}

		}

	}
	var returnObj={};

	// Modification to cater for 4 resource-ticks per hour
	hassium=hassium*4;
	neodymium=neodymium*4;
	strontium=strontium*4;
	indium=indium*4;

	// And consider tech-bonuses!
	var o1=returnGameObjectById(831);
	var o2=returnGameObjectById(834);
	var o3=returnGameObjectById(837);

	var techbonus_percent=0;
	if (o1!=false){		techbonus_percent+=(o1.points*20);	}
	if (o2!=false){		techbonus_percent+=(o2.points*20);	}
	if (o3!=false){		techbonus_percent+=(o3.points*20);	}

	// Add support for the new hw-mining-bonus from controlling sectors
	if (ad2460.allianceData.id>0){
		techbonus_percent+=ad2460.allianceData.sectorBonuses.homeworld_mining;
	}

	var r1=returnGameObjectById(101);
	if (r1.upgrading!=1 && r1.user_id==ad2460.user_id){
		techbonus_percent+=10;
	}
	var r1=returnGameObjectById(116);
	if (r1.upgrading!=1 && r1.user_id==ad2460.user_id){
		techbonus_percent+=10;
	}

	hassium=hassium+Math.floor(hassium*techbonus_percent/100);
	neodymium=neodymium+Math.floor(neodymium*techbonus_percent/100);
	strontium=strontium+Math.floor(strontium*techbonus_percent/100);
	indium=indium+Math.floor(indium*techbonus_percent/100);

	returnObj.hassium=hassium;
	returnObj.neodymium=neodymium;
	returnObj.strontium=strontium;
	returnObj.indium=indium;

	// return hourly values!

	return returnObj;
}

function showBuildTreeInfo(item_id,event, allowClosing){
	if (ad2460.openQuickMenues.build_info==true && allowClosing==true){
		buildMenuDown();
	}
	else {
		//ad2460.openQuickMenues.build_info=true;
		fillInBuildPanel(item_id);
	}
}

function fillInBuildPanel(item_id){
	var item=returnGameObjectById(item_id);

	document.getElementById("build_research_clickable").removeAttribute("onclick");
	document.getElementById("build_development_clickable").removeAttribute("onclick");
	document.getElementById("build_facility_clickable").removeAttribute("onclick");
	document.getElementById("build_special_clickable").removeAttribute("onclick");
	document.getElementById("build_techpoints_clickable").removeAttribute("onclick");


	if (item==false){
		//console.log("FillInBuildPanel failed with item_id "+item_id);
		return;
	}


	$("#build_panel_item_name").html(item.name);

	var itemImageSrc="images/blank.gif";
	if (item.item_type=='Productionitem'){
		itemImageSrc="images/icons/wide_production/"+item_id+".jpg";
	}
	if (item.item_type=='Research'){
		itemImageSrc="images/icons/wide_research/"+item_id+".jpg";
	}
	if (item.item_type=='Development'){
		itemImageSrc="images/icons/wide_development/"+item_id+".jpg";
	}
	if (item.item_type=='Facility'){
		var imgsrc=returnFacilityImage(item_id);
		itemImageSrc="images/icons/wide_facility/"+imgsrc;
		$("#build_panel_item_name").html(item.shortname+" Lvl "+item.level);
	}
	if (item.item_type=='Techitem'){
		itemImageSrc="images/icons/techtree/"+item_id+".jpg";
	}

	$("#build_panel_item_image").attr("src",itemImageSrc);

	if (item.required_facility_id==0){
		$("#build_panel_facility_image").hide();
		$("#build_panel_facility_name").hide();
		$("#build_panel_facility_noneed").show();
		$("#build_panel_facility_heading").removeClass('red').addClass('green');
		document.getElementById("build_facility_clickable").removeAttribute("onclick");
		$("#build_facility_clickable").removeClass("pointer");
	}
	else {
		document.getElementById("build_facility_clickable").removeAttribute("onclick");
		$("#build_facility_clickable").removeClass("pointer");

		var fac=returnGameObjectById(item.required_facility_id);
		if (checkFacilityRequirement(item.required_facility_id)==true){
			$("#build_panel_facility_heading").removeClass('red').addClass('green');
		}
		else {
			$("#build_panel_facility_heading").removeClass('green').addClass('red');
		}
		var requiredFacilityImage="images/icons/facility/"+item.required_facility_id+"x100.jpg";
		if (fac.parent_id>0){
			requiredFacilityImage="images/icons/facility/"+fac.parent_id+"x100.jpg";
		}
		$("#build_panel_facility_image").attr("src",requiredFacilityImage);
		$("#build_panel_facility_name").html(fac.shortname+" Lvl "+fac.level);
		$("#build_panel_facility_noneed").hide();
		$("#build_panel_facility_image").show();
		$("#build_panel_facility_name").show();
		document.getElementById("build_facility_clickable").setAttribute("onclick","showBuildTreeInfo("+item.required_facility_id+",event)");
		$("#build_facility_clickable").addClass("pointer");
	}

	if (item.required_research_id==0){
		$("#build_panel_research_image").hide();
		$("#build_panel_research_name").hide();
		$("#build_panel_research_noneed").show();
		$("#build_panel_research_heading").removeClass('red').addClass('green');
		document.getElementById("build_research_clickable").removeAttribute("onclick");
		$("#build_research_clickable").removeClass("pointer");

	}
	else {
		document.getElementById("build_research_clickable").removeAttribute("onclick");
		$("#build_research_clickable").removeClass("pointer");

		var res=returnGameObjectById(item.required_research_id);
		if (checkResearchRequirement(item.required_research_id)==true){
			$("#build_panel_research_heading").removeClass('red').addClass('green');
		}
		else {
			$("#build_panel_research_heading").removeClass('green').addClass('red');
		}
		var requiredResearchImage="images/icons/research/"+item.required_research_id+".jpg";
		$("#build_panel_research_image").attr("src",requiredResearchImage);
		$("#build_panel_research_name").html(res.name);
		$("#build_panel_research_noneed").hide();
		$("#build_panel_research_image").show();
		$("#build_panel_research_name").show();
		document.getElementById("build_research_clickable").setAttribute("onclick","showBuildTreeInfo("+item.required_research_id+",event)");
		$("#build_research_clickable").addClass("pointer");

	}

	if (item.required_development_id==0){
		$("#build_panel_development_image").hide();
		$("#build_panel_development_name").hide();
		$("#build_panel_development_noneed").show();
		$("#build_panel_development_heading").removeClass('red').addClass('green');
		document.getElementById("build_development_clickable").removeAttribute("onclick");
		$("#build_development_clickable").removeClass("pointer");
	}
	else {
		document.getElementById("build_development_clickable").removeAttribute("onclick");
		$("#build_development_clickable").removeClass("pointer");

		var res=returnGameObjectById(item.required_development_id);
		if (checkDevelopmentRequirement(item.required_development_id)==true){
			$("#build_panel_development_heading").removeClass('red').addClass('green');
		}
		else {
			$("#build_panel_development_heading").removeClass('green').addClass('red');
		}
		var requiredDevelopmentImage="images/icons/development/"+item.required_development_id+".jpg";
		$("#build_panel_development_image").attr("src",requiredDevelopmentImage);
		$("#build_panel_development_name").html(res.name);
		$("#build_panel_development_noneed").hide();
		$("#build_panel_development_image").show();
		$("#build_panel_development_name").show();
		document.getElementById("build_development_clickable").setAttribute("onclick","showBuildTreeInfo("+item.required_development_id+",event)");
		$("#build_development_clickable").addClass("pointer");

	}
	// Specials are most likely research or tech-items



	if (item.special_requirement==0){
		$("#build_panel_special_image").hide();
		$("#build_panel_special_name").hide();
		$("#build_panel_special_noneed").show();
		$("#build_panel_special_heading").removeClass('red').addClass('green');
		document.getElementById("build_special_clickable").removeAttribute("onclick");
		$("#build_special_clickable").removeClass("pointer");
	}
	else if(item.special_requirement<100){
		$("#build_panel_special_name").html('Advancement Level '+item.special_requirement+' Required').show();
		$("#build_panel_special_image").hide();
		if (ad2460.scores.level<item.special_requirement){
			$("#build_panel_special_heading").removeClass('green').addClass('red');
		}
		else {
			$("#build_panel_special_heading").removeClass('red').addClass('green');
		}
	}
	else {
		document.getElementById("build_special_clickable").removeAttribute("onclick");
		$("#build_special_clickable").removeClass("pointer");

		var special=returnGameObjectById(item.special_requirement);
		if (checkSpecialRequirement(item.special_requirement)==true){
			$("#build_panel_special_heading").removeClass('red').addClass('green');
		}
		else {
			$("#build_panel_special_heading").removeClass('green').addClass('red');
		}
		var requiredSpecialImage="";
		if (special.item_type=='Research'){
			requiredSpecialImage="images/icons/research/"+item.special_requirement+".jpg"
		}
		if (special.item_type=='Techitem'){
			requiredSpecialImage="images/icons/techtree/"+item.special_requirement+".jpg"
		}

		if (item.special_requirement>=999){
			// Super special case! Playerflags involved!!!
			$("#build_panel_special_image").attr("src","images/icons/missingimage.png");
			$("#build_panel_special_name").html("Unknown");
		}
		else {
			$("#build_panel_special_image").attr("src",requiredSpecialImage);
			if (special.item_type=='Techitem'){
				$("#build_panel_special_name").html("Unlock "+special.name);
				document.getElementById("build_special_clickable").setAttribute("onclick","specialBuildMenuToTechTreeSlide()");
				$("#build_special_clickable").addClass("pointer");

			}
			else if (special.item_type=='Research'){
				document.getElementById("build_special_clickable").setAttribute("onclick","showBuildTreeInfo("+item.special_requirement+")");
				$("#build_special_clickable").addClass("pointer");
				$("#build_panel_special_name").html(special.name);

			}
			else {
				$("#build_panel_special_name").html(special.name);
			}
		}

		$("#build_panel_special_noneed").hide();
		$("#build_panel_special_image").show();
		$("#build_panel_special_name").show();

	}

	if (item.required_tech_tree_points==0){
		$("#build_panel_techpoints_string").hide();
		$("#build_panel_techpoints_noneed").show();
		$("#build_panel_techpoints_heading").removeClass('red').addClass('green');
		document.getElementById("build_techpoints_clickable").removeAttribute("onclick");
		$("#build_techpoints_clickable").removeClass("pointer");
	}
	else {
		document.getElementById("build_techpoints_clickable").removeAttribute("onclick");
		$("#build_techpoints_clickable").removeClass("pointer");

		$("#build_panel_techpoints_noneed").hide();
		var points_tree_string="";
		if (item.required_points_tree=='Matter'){
			points_tree_string='InTech';
		}
		if (item.required_points_tree=='Energy'){
			points_tree_string='StronTech';
		}
		if (item.required_points_tree=='Displacement'){
			points_tree_string='NeoTech';
		}
		var text=fillIn(translations.required_points_string,[item.required_tech_tree_points,points_tree_string]);
		if (item.required_points_tree=='General'){
			text=fillIn(translations.required_points_string_general,[item.required_tech_tree_points]);
		}
		$("#build_panel_techpoints_string").html(text);
		$("#build_panel_techpoints_string").show();
		if (checkTechtreeRequirement(item.required_points_tree,item.required_tech_tree_points)){
			$("#build_panel_techpoints_heading").removeClass('red').addClass('green');
		}
		else {
			$("#build_panel_techpoints_heading").removeClass('green').addClass('red');
		}

		document.getElementById("build_techpoints_clickable").setAttribute("onclick","specialBuildMenuToTechTreeSlide()");
		$("#build_techpoints_clickable").addClass("pointer");

	}


	// Right!!!
	// All the data have been filled in, I hope!
	// Now for the possible opening of the quickmenu!
	if (ad2460.openQuickMenues.build_info==false){
		buildMenuUp();
	}
}

function specialBuildMenuToTechTreeSlide(){
	buildMenuDown();
	openSlide('techtreeslide');
}


function buildMenuUp(){
	$("#build_panel").show();
	$("#build_panel").animate({height: "200px"}, { duration: 400  ,  easing : easing });
	ad2460.openQuickMenues.build_info=true;

}
function buildMenuDown(){
	$("#build_panel").animate({height: "0px"}, { duration: 200  ,  easing : easing, complete: function() {$("#build_panel").hide();}  });
	ad2460.openQuickMenues.build_info=false;
}

function highLightTechTreeButton(){
	if (ad2460.techpoints>0){
		$("#unused_tech_points_indicator").html(''+ad2460.techpoints).show();
	}
	else {
		$("#unused_tech_points_indicator").hide();
	}
}

function renderHomeworldTechBalance(){
	var t=ad2460.techVariables;
	var balance_string=translations.general_balanced;
	if (t.spentTechPointsMatter > t.spentTechPointsEnergy && t.spentTechPointsMatter > t.spentTechPointsDisplacement){
		balance_string=translations.general_matter;
	}
	if (t.spentTechPointsEnergy > t.spentTechPointsMatter && t.spentTechPointsEnergy > t.spentTechPointsDisplacement){
		balance_string=translations.general_energy;
	}
	if (t.spentTechPointsDisplacement > t.spentTechPointsEnergy && t.spentTechPointsDisplacement > t.spentTechPointsMatter){
		balance_string=translations.general_displacement;
	}

	$("#homeworld_planet_tech_name").html(balance_string);
	$("#homeworld_planet_tech_matter").html(t.spentTechPointsMatter);
	$("#homeworld_planet_tech_energy").html(t.spentTechPointsEnergy);
	$("#homeworld_planet_tech_displacement").html(t.spentTechPointsDisplacement);
}

function forceSmallHelperSize(){
		$( "#helper_checklist" ).animate({
		top: "590",
		height: "175"
		}, 300, function() {
		// Animation complete.
		});
		$('#helper_maxmin').transition( {rotateX: 0},200 );
}

function specialProcessOpenPanel(id, subid, event){
	// This function must check to see if we are already at the homeworld..or outposts..or alliance..?
	// if not, we must go there.
	// subid (optional) is the game-object-id of the item we want selected, if any

	if (event){
		if (event.hasOwnProperty('type')){
			event.stopPropagation();
		}
	}

	if (subid<1){
		subid=0;
	}

	forceSmallHelperSize();

	// Might as well close slides first
	closeSlides();

	var wantedSection="homeworld_content";
	var wantedButtonId="homeworldbutton";
	if (id=='alliancedev'){
		wantedSection="alliance_content";
		wantedButtonId="alliancebutton";
	}

	if (id=='intelligence'){
		wantedSection="military_content";
		wantedButtonId="militarybutton";
	}
	if (id=='wargame'){
		wantedSection="military_content";
		wantedButtonId="militarybutton";
	}
	if (id=='commanders'){
		wantedSection="military_content";
		wantedButtonId="militarybutton";
	}
	if (id=='fleet_management'){
		wantedSection="military_content";
		wantedButtonId="militarybutton";
	}


	if (ad2460.currentPageSectionId != wantedSection){
		$("#"+wantedButtonId).click();
		var functionString="specialProcessOpenPanelContinue('"+id+"',"+subid+")";
		//console.log(functionString);
		setTimeout(functionString,900);
	}
	else {
		specialProcessOpenPanelContinue(id, subid);
	}
}

function specialProcessOpenPanelContinue(id,subid){
	var panelId=id+'_main_panel';
	//console.log(panelId);
	// If the right panel is already showing, leave it be.
	// If the wrong panel is showing, close it and open the right one.
	// If no panel is showing, open it.
	var found=false;
	var i=0;
	for (i=0;i<ad2460.openPanels.length ;i++ ){
		if (ad2460.openPanels[i]==id){
			found=true;
		}
	}
	if (found==false){
		// Its not open already.
		if (ad2460.openPanels.length>0){
			closePanels();
			var functionString="document.getElementById('"+panelId+"').click()";
			setTimeout(functionString,900);
		}
		else {
			document.getElementById(panelId).click()
		}
	}

	if (subid>0){
		if (subid<100){
			return;
		}
		else if (subid<=200){
			researchItemClick(subid, false);
		}
		else if (subid<=300){
			developmentItemClick(subid, false);
		}
		else if (subid<=400){

			var o=returnGameObjectById(subid);

			if (o!=false){
				var p=returnGameObjectById(o.parent_id);
				if (p!=false){

					facilityContainerClick(p.id,p.building_id,false);
				}
			}

			facilityInfoClick(subid,1, false);
		}
		else if (subid<=600){
			productionItemClick(subid, false)
		}


	}
}

function handleShiftClickObjectWithId(id){
	var obj=returnGameObjectById(id);
	if (obj!=false){
		//console.log(obj.item_type);
		var tmpString=document.getElementById('chat_input_field').value;
		var addString=' (GameObject:'+id+') ';
		document.getElementById('chat_input_field').focus();
		document.getElementById('chat_input_field').value=tmpString+addString;
	}
}

function extraCheckUnclaimedTechPoints(){
	var i=0;
	for (i=0;i<ad2460.playerUpdates.length ;i++ ){
		checkUnclaimedTechPoints('player_update',ad2460.playerUpdates[i].image_id);
	}
}

function changeHomeWorld(id){
	if (ad2460.vip_status>ad2460.serverTime){
		changeHomeWorldConfirmed(id);
		hideSimpleBox();
	}
	else {
		var body="This will cost you 10 credits. Are you sure you wish to do this?";
		showConfirmationPopup(body, "Yes", "No", "changeHomeWorldConfirmed("+id+");hideConfirmationPopup();hideSimpleBox();", "hideConfirmationPopup()", false, false);
	}
}

function changeHomeWorldConfirmed(id){
	if (id>0 && id<9){
		// valid id
		$.post('actionhandler.pl', {action:'change_homeworld_type',new_world_type:id}, function(data){ parseInfo(data);});
	}
}

function updateHomeworldImage(new_world_type){
	var moon_source='images/homeworlds/hw0'+new_world_type+'moon01.png';
	var world_source='images/homeworlds/hw0'+new_world_type+'.png';
	var bg_source='images/homeworlds/hw0'+new_world_type+'bg.png';

	document.getElementById('homeworld_bg').src=bg_source;
	document.getElementById('moon_img').src=moon_source;
	document.getElementById('homeworld_img').src=world_source;

	$("#homeworld_name_class_string").html("Class "+new_world_type+" Homeworld");

}
ad2460.forum.fontSize=12;

function forumClick(forumId,threadId){
	ad2460.forum.selected_forum_id=forumId;
	ad2460.forum.selected_thread_id=0;
	clearThreads();
	myScrollToTop('threadscontainer',200);
	setForumHeader(forumId);
	loadThreads(forumId,threadId);
	var link_string=' (THREAD:'+forumId+','+threadId+') ';
	$("#thread_link_info").html(link_string);
	document.getElementById('thread_report_button').setAttribute("onclick","reportThreadClick("+threadId+")");


	if (forumId==8 && ad2460.allianceData.id==0){
		systemFeedback('Error','You have not yet joined an alliance.', 1, 4);
		return;
	}

	// make sure the forumcategories are open
	var i=0;
	var slideIsOpen=false;
	for (i=0;i<ad2460.openSlides.length ;i++ ){
		if (ad2460.openSlides[i]=='forumcategories'){
			//console.log("Its open");
			slideIsOpen=true;
		}
	}
	if (slideIsOpen==false){
		$("#forumopenbutton").click();

	}

	openThreadPanel();

	//play_multi_sound('sfx_quickerslide');
}

function setForumHeader(forum_id){
	for (i=0;i<ad2460.forum.forums.length ;i++ ){
		if (ad2460.forum.forums[i].forum_id == forum_id){
			$("#forumheader").html(ad2460.forum.forums[i].name);
		}
	}
}

function setThreadHeader(thread_id){
	for (i=0;i<ad2460.forum.threads.length ;i++ ){
		if (ad2460.forum.threads[i].thread_id == thread_id){
			$("#threadheader").html(ad2460.forum.threads[i].subject);
		}
	}
}

function latest_thread(forum_id,thread_id,subject, last_update, last_post_by){
	this.forum_id=forum_id;
	this.thread_id=thread_id;
	this.subject=subject;
	this.last_update=last_update;
	this.last_post_by=last_post_by;
}

function threadClick(threadId,scrollTo){
	//closePostPanel();
	if (ad2460.forum.threadlock==true){
		console.log("Dodged forum-bug");
		ad2460.forum.threadlock=false;
		return;
	}
	ad2460.forum.editPostId=0;
	ad2460.forum.threadlock=true;
	clearPosts();
	ad2460.forum.selected_thread_id=threadId;
	setThreadHeader(threadId);
	loadPosts(threadId,scrollTo);
	var link_string='(THREAD:'+ad2460.forum.selected_forum_id+','+threadId+')';
	$("#thread_link_info").html(link_string);
	$("#postscontainer").css("top","0px");
}

function clearThreads(){
	ad2460.forum.threads=[];
	// We might have to go through different elements here to unbind events first, depending on how good jQuery is at cleaning up internally....
	$(".threadslink").remove();
}

function redrawThreads(){
	$(".threadslink").remove();
	renderThreads();
}

function clearPosts(){
	ad2460.forum.posts=[];
	// We might have to go through different elements here to unbind events first, depending on how good jQuery is at cleaning up internally....
	$(".postcontainer").remove();
	$("#postreplyslide").remove();

}

function clearLatestThreads(){
	ad2460.forum.latest_threads=[];
	// We might have to go through different elements here to unbind events first, depending on how good jQuery is at cleaning up internally....
	$("#latest_forum_threads .headerhover").remove();
}
function clearLatestAllianceThreads(){
	ad2460.forum.latest_alliance_threads=[];
	// We might have to go through different elements here to unbind events first, depending on how good jQuery is at cleaning up internally....
	$("#latest_alliance_threads .headerhover").remove();
}


function loadThreads(forumId,threadId){
	$.post('actionhandler.pl', {action:'load_threads',forum_id:forumId,thread_id:threadId}, function(data){ parseInfo(data);});
}

function addThread(thread_id, forum_id, subject, post_count, created_by_user_id, created_by_nickname, last_post_by_user_id, last_post_by_nickname, last_post_time, last_post_time_string, last_post_id, icon, marked_for_delete, visible, mod_lvl_to_read, sticky){
	ad2460.forum.threads.push(new thread(thread_id, forum_id, subject, post_count, created_by_user_id, created_by_nickname, last_post_by_user_id, last_post_by_nickname, last_post_time, last_post_time_string, last_post_id, icon, marked_for_delete, visible, mod_lvl_to_read, sticky));
}

function addPost(post_id, thread_id, posted_by_user_id, posted_by_nickname, posted_time, posted_time_string, body, hidden, avatar, vip_icon){
	ad2460.forum.posts.push(new post(post_id, thread_id, posted_by_user_id, posted_by_nickname, posted_time, posted_time_string, body, hidden, avatar, vip_icon));
}

function addLatestThread(forum_id, thread_id, subject, last_update, last_post_by){
	ad2460.forum.latest_threads.push(new latest_thread(forum_id, thread_id, subject, last_update, last_post_by));
}

function addLatestAllianceThread(forum_id, thread_id, subject, last_update, last_post_by){
	ad2460.forum.latest_alliance_threads.push(new latest_thread(forum_id, thread_id, subject, last_update, last_post_by));
}

function renderLatestThreadsPrevious(){
	return;
	var container=document.getElementById('latest_forum_threads');
	removeChildNodes('latest_forum_threads');
	var i=0;

	for (i=0;i<ad2460.forum.latest_threads.length;i++ ){
		if (i>=10){
			continue;
		}
		var itemContainer=document.createElement('div');
		itemContainer.setAttribute('class','headerhover');
		itemContainer.setAttribute('onclick','forumClick('+ad2460.forum.latest_threads[i].forum_id+','+ad2460.forum.latest_threads[i].thread_id+')');

		var itemSubject=document.createElement('div');
		itemSubject.setAttribute('class','player_comm_entry_subject');
		itemSubject.innerHTML=remove_nastyness(ad2460.forum.latest_threads[i].subject);

		var itemTime=document.createElement('div');
		itemTime.setAttribute('class','player_comm_entry_timestamp');
		itemTime.innerHTML=formatShortMessageTimestamp(ad2460.forum.latest_threads[i].last_update);

		var itemFrom=document.createElement('div');
		itemFrom.setAttribute('class','player_comm_entry_author');
		itemFrom.innerHTML=ad2460.forum.latest_threads[i].last_post_by;

		itemContainer.appendChild(itemSubject);
		itemContainer.appendChild(itemTime);
		itemContainer.appendChild(itemFrom);

		container.appendChild(itemContainer);
	}
}

function renderLatestThreads(){

	if (ad2460.forum.last_threads_render_time>ad2460.serverTime-15){
		return;
	}

	toggleMotdDisplay();

	var container=document.getElementById('front_threads_container');
	removeChildNodes('front_threads_container');
	var i=0;

	var threads=ad2460.forum.latest_threads;

	$("#active_topics_header").html("Active Topics");
	$("#active_topics_header").css("color", "white" );

	if (ad2460.forum.last_threads_render_type=='general' && ad2460.forum.last_threads_render_time<ad2460.serverTime-30 && ad2460.allianceData.id>0 && ad2460.forum.latest_alliance_threads.length>0){
		threads=ad2460.forum.latest_alliance_threads;
		$("#active_topics_header").html("Active A-Topics");
		$("#active_topics_header").css("color", "cyan" );
		ad2460.forum.last_threads_render_type='alliance';

	}
	else {
		ad2460.forum.last_threads_render_type='general';

	}
	ad2460.forum.last_threads_render_time=ad2460.serverTime;


	for (i=0;i<threads.length;i++ ){
		if (i>=7 && ad2460.extendedGUI!=true){
			continue;
		}
		var itemContainer=document.createElement('div');
		itemContainer.setAttribute('class','forumthread_link');
		itemContainer.setAttribute('onclick','forumClick('+threads[i].forum_id+','+threads[i].thread_id+')');

		var itemSubject=document.createElement('div');
		itemSubject.setAttribute('class','forumthread_link_name');
		itemSubject.innerHTML=remove_nastyness(threads[i].subject);

		var itemTime=document.createElement('div');
		itemTime.setAttribute('class','forumlink_timestamp');
		itemTime.innerHTML=formatShortMessageTimestamp(threads[i].last_update);

		itemContainer.appendChild(itemSubject);
		itemContainer.appendChild(itemTime);
		container.appendChild(itemContainer);
	}
}

function forceRecentThreadsToggle(){
	var container=document.getElementById('front_threads_container');
	removeChildNodes('front_threads_container');
	var threads=ad2460.forum.latest_threads;

	toggleMotdDisplay();

	if (ad2460.forum.last_threads_render_type=='general'){
		threads=ad2460.forum.latest_alliance_threads;
		ad2460.forum.last_threads_render_type='alliance';
		$("#active_topics_header").html("Active A-Topics");
		$("#active_topics_header").css("color", "cyan" );

	}
	else {
		ad2460.forum.last_threads_render_type='general';
		$("#active_topics_header").html("Active Topics");
		$("#active_topics_header").css("color", "white" );

	}
	ad2460.forum.last_threads_render_time=ad2460.serverTime;

	for (i=0;i<threads.length;i++ ){
		if (i>=7 && ad2460.extendedGUI!=true){
			continue;
		}

		var itemContainer=document.createElement('div');
		itemContainer.setAttribute('class','forumthread_link');
		itemContainer.setAttribute('onclick','forumClick('+threads[i].forum_id+','+threads[i].thread_id+')');

		var itemSubject=document.createElement('div');
		itemSubject.setAttribute('class','forumthread_link_name');
		itemSubject.innerHTML=remove_nastyness(threads[i].subject);

		var itemTime=document.createElement('div');
		itemTime.setAttribute('class','forumlink_timestamp');
		itemTime.innerHTML=formatShortMessageTimestamp(threads[i].last_update);

		itemContainer.appendChild(itemSubject);
		itemContainer.appendChild(itemTime);
		container.appendChild(itemContainer);
	}


}

function alternateMotdThreads(){
	return;
}

function renderLatestAllianceThreads(){
	return;
}

function renderThreads(){
	var container=document.getElementById('threadscontainer');
	var i=0;

	for (i=0;i<ad2460.forum.threads.length;i++ ){
		if (ad2460.admin_status>=ad2460.forum.threads[i].mod_lvl_to_read){

			var row = document.createElement('div');

			var rowclass='threadslink';
			if ( ad2460.forum.threads[i].visible==0 || ad2460.forum.threads[i].marked_for_delete==1 ){
				rowclass='threadslink threaddisabled';
			}
			row.setAttribute('id', 'thread_'+ad2460.forum.threads[i].thread_id);
			row.setAttribute('class',rowclass);

			var col1 = document.createElement('div');
			col1.setAttribute('class','threadcol tcol1');
			col1.innerHTML=ad2460.forum.threads[i].subject;
			col1.setAttribute('onclick','threadClick('+ad2460.forum.threads[i].thread_id+',"bottom");');
			row.appendChild(col1);


			var col2 = document.createElement('div');
			col2.setAttribute('class','threadcol tcol2');
			col2.innerHTML='';

			// Now for the icon!
			var icon=document.createElement('img');
			if (ad2460.forum.threads[i].icon!='none'){
				icon.setAttribute('src','images/icons/forums/'+ad2460.forum.threads[i].icon+'.png');
				icon.setAttribute('title',ad2460.forum.threads[i].icon);

				icon.style.width='24px';
				icon.style.height='24px';

				col2.appendChild(icon);
			}

			row.appendChild(col2);

			var col3 = document.createElement('div');
			col3.setAttribute('class','threadcol tcol3');
			col3.innerHTML=ad2460.forum.threads[i].post_count;
			row.appendChild(col3);

			var col4 = document.createElement('div');
			col4.setAttribute('class','threadcol tcol4');
			col4.innerHTML=ad2460.forum.threads[i].created_by_nickname;
			row.appendChild(col4);

			var col5 = document.createElement('div');
			col5.setAttribute('class','threadcol tcol5');
			col5.innerHTML=ad2460.forum.threads[i].last_post_by_nickname;
			row.appendChild(col5);

			var col6 = document.createElement('div');
			col6.setAttribute('class','threadcol tcol6');
			col6.innerHTML=ad2460.forum.threads[i].last_post_time_string;
			row.appendChild(col6);

			var col7 = document.createElement('div');
			col7.setAttribute('class','threadcol tcol7');
			col7.innerHTML='';
			if (ad2460.admin_status>=2){
				// No, lets do this properly!
				var delImage=document.createElement('img');
				var hideImage=document.createElement('img');
				var fixedImage=document.createElement('img');
				var nobugImage=document.createElement('img');
				var pinImage=document.createElement('img');

				delImage.setAttribute('src','images/icons/forums/deletethread.png');
				hideImage.setAttribute('src','images/icons/forums/hidethread.png');
				fixedImage.setAttribute('src','images/icons/forums/fixed.png');
				nobugImage.setAttribute('src','images/icons/forums/nobug.png');
				pinImage.setAttribute('src','images/icons/forums/pin.png');

				delImage.setAttribute('class','threadicon');
				hideImage.setAttribute('class','threadicon');
				fixedImage.setAttribute('class','threadicon');
				nobugImage.setAttribute('class','threadicon');
				pinImage.setAttribute('class','threadicon');

				delImage.setAttribute('onclick','deleteThreadClick('+ad2460.forum.threads[i].forum_id+','+ad2460.forum.threads[i].thread_id+')');
				hideImage.setAttribute('onclick','hideThreadClick('+ad2460.forum.threads[i].forum_id+','+ad2460.forum.threads[i].thread_id+')');
				fixedImage.setAttribute('onclick','setThreadIconClick('+ad2460.forum.threads[i].forum_id+','+ad2460.forum.threads[i].thread_id+',"fixed")');
				nobugImage.setAttribute('onclick','setThreadIconClick('+ad2460.forum.threads[i].forum_id+','+ad2460.forum.threads[i].thread_id+',"nobug")');
				pinImage.setAttribute('onclick','pinThreadClick('+ad2460.forum.threads[i].forum_id+','+ad2460.forum.threads[i].thread_id+')');

				delImage.style.width='24px';	delImage.style.height='24px';
				hideImage.style.width='24px';	hideImage.style.height='24px';
				fixedImage.style.width='24px';	fixedImage.style.height='24px';
				nobugImage.style.width='24px';	nobugImage.style.height='24px';
				pinImage.style.width='24px';	pinImage.style.height='24px';

				if (ad2460.forum.threads[i].sticky==1){
					pinImage.style.opacity='1.0';
				}
				else {
					pinImage.style.opacity='0.20';
				}

				col7.appendChild(delImage);
				col7.appendChild(hideImage);
				col7.appendChild(fixedImage);
				col7.appendChild(nobugImage);
				col7.appendChild(pinImage);
			}
			else if (ad2460.forum.selected_forum_id==8 && ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_moderation==1){
				var delImage=document.createElement('img');
				var pinImage=document.createElement('img');

				delImage.setAttribute('src','images/icons/forums/deletethread.png');
				pinImage.setAttribute('src','images/icons/forums/pin.png');

				delImage.setAttribute('class','threadicon');
				pinImage.setAttribute('class','threadicon');

				delImage.setAttribute('onclick','deleteThreadClick('+ad2460.forum.threads[i].forum_id+','+ad2460.forum.threads[i].thread_id+')');
				pinImage.setAttribute('onclick','pinThreadClick('+ad2460.forum.threads[i].forum_id+','+ad2460.forum.threads[i].thread_id+')');

				delImage.style.width='24px';	delImage.style.height='24px';
				pinImage.style.width='24px';	pinImage.style.height='24px';

				if (ad2460.forum.threads[i].sticky==1){
					pinImage.style.opacity='1.0';
				}
				else {
					pinImage.style.opacity='0.20';
				}

				col7.appendChild(delImage);
				col7.appendChild(pinImage);
			}


			row.appendChild(col7);

			var col8 = document.createElement('div');
			col8.setAttribute('class','threadcol tcol8');
			col8.innerHTML='';
			row.appendChild(col8);

			container.appendChild(row);
		}
	}
	checkScrollButtonStatus('threadscontainer');

}

function setThreadIconClick(forum_id, thread_id, icon){
	$.post('actionhandler.pl', {action:'set_thread_icon', forum_id:forum_id, thread_id:thread_id, icon:icon}, function(data){ parseInfo(data);});
}

function clearNewThreadInputs(){
	$("#new_thread_subject").val("");
	$("#new_thread_body").val("");
}

function clearPostReplyInputs(){
	$("#post_reply_body").val("");
}

function loadPosts(threadId,scrollTo){
	$.post('actionhandler.pl', {action:'load_posts', thread_id:threadId, scroll_to:scrollTo}, function(data){ parseInfo(data);});
}

function renderPosts(scrollTo){
	if (ad2460.forum.rendering==true){
		console.log("Saved from forum-bug!");
		return;
	}
	ad2460.forum.rendering=true;



	var container=document.getElementById('postscontainer');
	var i=0;
	for (i=0;i<ad2460.forum.posts.length;i++ ){
		var row = document.createElement('div');
		row.setAttribute('id', 'post_'+ad2460.forum.posts[i].post_id);
		row.setAttribute('class','postcontainer');

		var div1= document.createElement('div');
		div1.setAttribute('class','forum_post_body_container');

		div1.style.fontSize=ad2460.forum.fontSize+'px';

		var div2= document.createElement('div');
		div2.setAttribute('class','avatar_panel');
		div2.setAttribute('onclick','avatarClick('+ad2460.forum.posts[i].post_id+','+ad2460.forum.posts[i].posted_by_user_id+')');

		var div3= document.createElement('div');
		div3.setAttribute('class','forum_avatar_container');

		var avatar = document.createElement('img');
		avatar.setAttribute('id', 'avatar_'+ad2460.forum.posts[i].posted_by_user_id);
		if (ad2460.forum.posts[i].avatar != ''){
			avatar.setAttribute('src', 'images/uploads/avatars/'+ad2460.forum.posts[i].avatar);
		}
		else {
			avatar.setAttribute('src', 'images/fixed/commanderimg150b.png');
		}

		avatar.style.width='100px';

		var div4= document.createElement('div');
		div4.setAttribute('class','forum_poster_name');
		div4.innerHTML=ad2460.forum.posts[i].posted_by_nickname;

		var div5= document.createElement('div');
		div5.setAttribute('class','post_timestamp');

		var span1= document.createElement('span');
		span1.innerHTML=ad2460.forum.posts[i].posted_time_string;

		var div6= document.createElement('div');
		div6.setAttribute('class','post_reply_button');
		div6.setAttribute('onclick','replyClick('+ad2460.forum.posts[i].post_id+')');
		div6.innerHTML='Reply';

		var body=ad2460.forum.posts[i].body;
		body=body.replace(/&myquote;/g, '"');

		var span2= document.createElement('span');
		span2.innerHTML=iconify(linkify(body));
		span2.className='selectable_text';

		/*
		var div7= document.createElement('div');
		div7.setAttribute('class','poster_details');
		div7.setAttribute('id', 'posterdetails_'+ad2460.forum.posts[i].post_id);
		div7.innerHTML='Universal player info and handy details will be placed here for easy reference, and to save space inside the thread. Click poster image again to hide. NOTE: clicking the player name MAY result in a more in-game function, like seeing the home planet of the poster (if discovered) or something.';
		div7.setAttribute('onclick','avatarUnclick()');
		*/

		var showDeleteButton=false;
		if (ad2460.admin_status >= 3){
			showDeleteButton=true;
		}
		if (ad2460.forum.selected_forum_id==8){
			var t=0;
			for (t=0;t<ad2460.allianceData.rankDetails.length ;t++ ){
				if (ad2460.allianceData.rank_id==ad2460.allianceData.rankDetails[t].rank_id){
					if (ad2460.allianceData.rankDetails[t].access_moderation==1){
						showDeleteButton=true;
					}
				}
			}
		}

		if (showDeleteButton==true){
			var delImg= document.createElement('div');
			delImg.setAttribute('class','post_delete_image');
			delImg.setAttribute('onclick','postDeleteClick('+ad2460.forum.posts[i].post_id+')');
			div1.appendChild(delImg);
		}


		var delImg= document.createElement('div');
		delImg.setAttribute('class','post_report_image');
		delImg.setAttribute('onclick','postReportClick('+ad2460.forum.posts[i].post_id+')');
		div1.appendChild(delImg);

		var showEditButton=false;
		if (ad2460.forum.posts[i].posted_by_user_id==ad2460.user_id){
			showEditButton=true;
		}

		if (showEditButton){
			var editImg= document.createElement('div');
			editImg.setAttribute('class','post_edit_image');
			editImg.setAttribute('onclick','postEditClick('+ad2460.forum.posts[i].post_id+')');
			div1.appendChild(editImg);
		}


		div5.appendChild(div4);
		div5.appendChild(span1);
		div3.appendChild(avatar);
		div2.appendChild(div3);
		if (ad2460.forum.posts[i].vip_icon != '' && ad2460.forum.posts[i].vip_icon != 'none'){
			var vip_img = document.createElement('img');
			vip_img.setAttribute('class', 'vip_forum');
			vip_img.setAttribute('src', 'images/icons/vip/forum/'+ad2460.forum.posts[i].vip_icon);
			vip_img.setAttribute('title', 'VIP');
			if (ad2460.forum.posts[i].vip_icon=='dev.png'){
				vip_img.setAttribute('title', 'DEV');
			}
			div2.appendChild(vip_img);
		}

		div1.appendChild(div2);
		div1.appendChild(div5);
		div1.appendChild(span2);
		div1.appendChild(div6);
		//div1.appendChild(div7);

		row.appendChild(div1);

		container.appendChild(row);

	}

	var replyslide=document.createElement('div');
	replyslide.setAttribute('class','postreplyslide');
	replyslide.setAttribute('id','postreplyslide');


	var header=document.createElement('div');
	header.setAttribute('class','postreplyheader');
	header.innerHTML='Post Reply';

	var postreplybodyheader=document.createElement('div');
	postreplybodyheader.setAttribute('class','postreply_body_header');

	var postreplytextareacontainer=document.createElement('div');
	postreplytextareacontainer.setAttribute('class','postreply_textarea_container');

	var postreplytextarea=document.createElement('textarea');
	postreplytextarea.setAttribute('class','postreply_textarea');
	postreplytextarea.setAttribute('id','post_reply_body');

	var replysubmit=document.createElement('div');
	replysubmit.setAttribute('class','postreply_submit_button');
	replysubmit.setAttribute('id','post_reply_submit_button');
	replysubmit.setAttribute('onclick','postReplyClick()');
	replysubmit.innerHTML='Post Reply';

	replyslide.appendChild(header);
	header.appendChild(postreplybodyheader);
	header.appendChild(postreplytextareacontainer);
	postreplytextareacontainer.appendChild(postreplytextarea);
	header.appendChild(replysubmit);

	$(container).append(replyslide);

	if (scrollTo=='bottom'){
		scrollToBottomPost();
	}

	checkScrollButtonStatus('postscontainer');

	ad2460.forum.rendering=false;
	ad2460.forum.threadlock=false;

	// $('#post_reply_body').bind('keyup', 'CTRL+RETURN', function(){postReplyClick();});

}

function reportThreadClick(thread_id){
	var mainText="Are you sure you wish to report this thread as unsuitable? If you do, it will be reviewed as soon as a moderator has the time!";
	var okText="Yes";
	var cancelText="No";
	var okClick="threadReport("+thread_id+");hideConfirmationPopup();";

	showConfirmationPopup(mainText, okText, cancelText, okClick);
}

function postEditClick(post_id){
	$.post('actionhandler.pl', {action:'edit_post', post_id:post_id}, function(data){ parseInfo(data);});
}

function completePostUpdate(){
	ad2460.forum.editPostId=0;
	/*
	$("#postreply_submit_button").html("Update");
	if (document.getElementById("postreply_submit_button")){
		document.getElementById("postreply_submit_button").onclick='updatePost()';
	}
	*/
}

function updatePostEditInput(postBody, post_id){
	$("#post_reply_body").val(postBody);
	$("#post_reply_submit_button").html("Update");
	document.getElementById("post_reply_submit_button").setAttribute('onclick','updatePost()');
	ad2460.forum.editPostId=post_id;
	scrollToBottomPost();
}

function updatePost(){
	var newBody=$("#post_reply_body").val();
	var forumId=ad2460.forum.selected_forum_id;
	var threadId=ad2460.forum.selected_thread_id;
	if (newBody.length>=2){
		$.post('actionhandler.pl', {action:'update_post', forum_id:forumId, thread_id:threadId, body:newBody, post_id:ad2460.forum.editPostId}, function(data){ parseInfo(data);});
		closeNewPostPanel();
	}
	else {
		systemFeedback('Error','Your post should be at least 2 characters.', 1, 4);
	}
}

function postReportClick(post_id){
	var mainText="Are you sure you wish to report this post to the moderators? If you do, it will be reviewed as soon as a moderator has the time!";
	var okText="Yes";
	var cancelText="No";
	var okClick="postReport("+post_id+");hideConfirmationPopup();";

	showConfirmationPopup(mainText, okText, cancelText, okClick);
}

function threadReport(thread_id){
	$.post('actionhandler.pl', {action:'report_thread', thread_id:thread_id}, function(data){ parseInfo(data);});
}
function postReport(post_id){
	$.post('actionhandler.pl', {action:'report_post', post_id:post_id}, function(data){ parseInfo(data);});
	$("#post_"+post_id).remove();
}

function postDeleteClick(post_id){
	$.post('actionhandler.pl', {action:'delete_post', post_id:post_id}, function(data){ parseInfo(data);});
	$("#post_"+post_id).remove();
}

function avatarClick(post_id, player_id){
	loadPlayerInfo(player_id);
	/*
	if (ad2460.forum.posterDetailsVisible==post_id){
		avatarUnclick();
	}
	else {
		$.post('actionhandler.pl', {action:'fetch_forum_player_info',post_id: post_id, player_id:player_id}, function(data){ parseInfo(data);});
	}
	*/
}
function avatarUnclick(){
	$("#poster_details").remove();
	ad2460.forum.posterDetailsVisible=-1;
}

function renderPosterDetails(nickname, planet_name, x, y, world_type, strength, alliance_id, alliance_name, post_id){
	avatarUnclick();
	var parent=document.getElementById("post_"+post_id);
	if (parent){
		var container= document.createElement('div');
		container.setAttribute('class','poster_details');
		container.setAttribute('id', 'poster_details');
		container.setAttribute('onclick','avatarUnclick()');

		var coords=convertShortCoordsToLongCoords(x,y);

		var div1=createSingleElement('div', 'poster_detail_title', '', 'Homeworld', '');
		var div2=createSingleElement('div', 'poster_detail_entry coords', '', planet_name+' ['+coords.coordString+']', '');
		div2.setAttribute("onclick","zoomInToXY("+x+","+y+")");

		var div3=createSingleElement('div', 'poster_detail_title', '', 'Alliance', '');
		var div4=createSingleElement('div', 'poster_detail_entry alliance', '', alliance_name, '');
		div4.setAttribute("onclick","loadAllianceInfo("+alliance_id+")");

		var div5=createSingleElement('div', 'poster_detail_title', '', 'Strength', '');
		var div6=createSingleElement('div', 'poster_detail_entry', '', prettyPrint(strength), '');

		container.appendChild(div1);
		container.appendChild(div2);
		container.appendChild(div3);
		container.appendChild(div4);
		container.appendChild(div5);
		container.appendChild(div6);

		parent.appendChild(container);

		$("#poster_details").show();
		ad2460.forum.posterDetailsVisible=post_id;
	}
}

function submitNewThreadClick(){
	// IDs to pick up data from
	var newSubject=$("#new_thread_subject").val();
	var newBody=$("#new_thread_body").val();
	var forumId=Number(ad2460.forum.selected_forum_id);

	if (newSubject.length>2 && newBody.length>3){
		if (ad2460.forum.selected_forum_id==4){
			var browser=fetch_browser_id();
			newBody=newBody+"\n \n[i]System: "+browser.browser+' '+browser.version+' '+browser.os+'[/i]';
		}
		$.post('actionhandler.pl', {action:'post_new_thread', forum_id:forumId, subject:newSubject, body:newBody}, function(data){ parseInfo(data);});
		closeNewThreadPanel();
	}
	else {
		systemFeedback('Error','Your header or post (or both) should be at least 3 characters.', 1, 4);
	}
}

function nickClick(playerId){
	systemFeedback('Notification','You clicked on user '+playerId, 3, 2);
}

function updatePostReplyInput(quoteBody,nickname){
	var previous_body=$("#post_reply_body").val();
	quoteBody=quoteBody.replace(/&myquote;/g, '"');
	$("#post_reply_body").val(previous_body+'[quote]'+nickname+':\n'+quoteBody+'[/quote]\n');
	scrollToBottomPost();
}

function replyClick(post_id){
	$.post('actionhandler.pl', {action:'post_reply_click', post_id:post_id}, function(data){ parseInfo(data);});
	//if (newPostPanelOpen==0) {openNewPostPanel();}
	//else {closeNewPostPanel();}
}

function newThreadClick(){
	if (newThreadPanelOpen==0) {openNewThreadPanel();}
	else {closeNewThreadPanel();}
}

function postReplyClick(){
	var newBody=$("#post_reply_body").val();
	var forumId=ad2460.forum.selected_forum_id;
	var threadId=ad2460.forum.selected_thread_id;
	if (newBody.length>=2){
		if (ad2460.forum.selected_forum_id==4){
			var browser=fetch_browser_id();
			newBody=newBody+"\n \n[i]System: "+browser.browser+' '+browser.version+' '+browser.os+'[/i]';
		}
		$.post('actionhandler.pl', {action:'post_reply', forum_id:forumId, thread_id:threadId, body:newBody}, function(data){ parseInfo(data);});
		closeNewPostPanel();
	}
	else {
		systemFeedback('Error','Your post should be at least 2 characters.', 1, 4);
	}
}


function deleteThreadClick(forumId,threadId){
	$.post('actionhandler.pl', {action:'delete_thread', forum_id:forumId, thread_id:threadId}, function(data){ parseInfo(data);});
}
function hideThreadClick(forumId,threadId){
	$.post('actionhandler.pl', {action:'hide_thread', forum_id:forumId, thread_id:threadId}, function(data){ parseInfo(data);});
}
function pinThreadClick(forumId,threadId){
	$.post('actionhandler.pl', {action:'pin_thread', forum_id:forumId, thread_id:threadId}, function(data){ parseInfo(data);});
}

function hideThread(threadId){
	$("#thread_"+threadId).css('opacity','0.3');
}
function updateThreadIcon(thread_id,icon){
	var i=0;
	for (i=0;i<ad2460.forum.threads.length ;i++ ){
		var thisThread=ad2460.forum.threads[i];
		if (thisThread.thread_id==thread_id){
			thisThread.icon=icon;
		}
	}
		redrawThreads();
}

function unhideThread(threadId){
	$("#thread_"+threadId).css('opacity','1.0');
}

function unpinThread(thread_id){
	forumClick(ad2460.forum.selected_forum_id);
}
function pinThread(thread_id){
	forumClick(ad2460.forum.selected_forum_id);
}



function sortThreads(){
	ad2460.forum.threads.sort(function(a, b){ return b.last_post_time-a.last_post_time });
}

function updateThreadInfo(threadId, last_post_by_nickname, last_post_by_user_id, post_count, last_post_time, last_post_time_string){
	var modified=0;
	for (i=0;i<ad2460.forum.threads.length;i++ ){
		if (ad2460.forum.threads[i].thread_id==threadId){
			ad2460.forum.threads[i].last_post_by_nickname=last_post_by_nickname;
			ad2460.forum.threads[i].last_post_by_user_id=last_post_by_user_id;
			ad2460.forum.threads[i].post_count=post_count;
			ad2460.forum.threads[i].last_post_time=last_post_time;
			ad2460.forum.threads[i].last_post_time_string=last_post_time_string;
			modified=1;
		}
	}
	if (modified==1){
		sortThreads();
		redrawThreads();
	}
}

function focusBodyIfTab(evt){
	if (evt.which==9){
		document.getElementById('new_thread_body').focus();
	}
}

function threadLinkClick(){
	var str=$("#thread_link_info").text();
	if (str != ''){
		$("#chat_input_field").focus();
		$("#chat_input_field").val($("#chat_input_field").val()+ str);
	}
}


function toggleForumTextSize(){
	var fontSize = parseInt($('.forum_post_body_container').css('font-size'));
	if(fontSize == 12){
		ad2460.forum.fontSize=14;
		$('.forum_post_body_container').css({fontSize: ''+ad2460.forum.fontSize+'px'});

	}
	else{
		ad2460.forum.fontSize=12;
		$('.forum_post_body_container').css({fontSize: ''+ad2460.forum.fontSize+'px'});
	}
}

// New things related to My Recent Threads

function clearMyRecentThreads(){
	ad2460.forum.myRecentThreads=new Array;
	unrenderMyRecentThreads();
}
function unrenderMyRecentThreads(){
	removeChildNodes('my_recent_threads_container');
}
function addMyRecentThreadsEntry(entry){
	ad2460.forum.myRecentThreads.push(entry);
}
function renderMyRecentThreads(){
	var parent=document.getElementById("my_recent_threads_container");
	var i=0;

	var container=createSingleElement('div', 'my_recent_threads_header_container', '', '', '');
	var subject=createSingleElement('div', 'my_recent_threads_subject', '', 'Thread', '');
	var updated_by=createSingleElement('div', 'my_recent_threads_updated_by', '', 'Update by', '');
	var updated=createSingleElement('div', 'my_recent_threads_updated', '', 'Time', '');

	container.appendChild(subject);
	container.appendChild(updated_by);
	container.appendChild(updated);
	parent.appendChild(container);


	for (i=0;i<ad2460.forum.myRecentThreads.length ;i++ ){
		var container=createSingleElement('div', 'my_recent_threads_entry_container', '', '', '');
		var subject=createSingleElement('div', 'my_recent_threads_subject', '', ad2460.forum.myRecentThreads[i].subject, '');
		var updated_by=createSingleElement('div', 'my_recent_threads_updated_by', '', ad2460.forum.myRecentThreads[i].last_post_by_nickname, '');
		var updated=createSingleElement('div', 'my_recent_threads_updated', '', formatShortMessageTimestamp(ad2460.forum.myRecentThreads[i].last_post_time), '');

		container.appendChild(subject);
		container.appendChild(updated_by);
		container.appendChild(updated);

		container.setAttribute("onclick","forumClick("+ad2460.forum.myRecentThreads[i].forum_id+","+ad2460.forum.myRecentThreads[i].thread_id+")");
		parent.appendChild(container);
	}
}
// Test setting
var combatTesting=false;

var newIntechShots=true;

ad2460.combatListener={};
ad2460.combatListener.view_id=0;
ad2460.combatListener.enabled=false;
ad2460.combatListener.turn=-1;
ad2460.combatListener.turnData=new Array;
ad2460.combatListener.timerSpeed=6;
ad2460.combatListener.eventDelay=10;
ad2460.combatListener.timer=null;
ad2460.combatListener.maxTurn=-1;
ad2460.combatListener.eventParserTurn=0;
ad2460.combatListener.lastParsedEvent=-1;
ad2460.combat.tempflagCombatOver=false;
ad2460.combat.tempflagCombatOver2=false;
ad2460.combat.tempflagTurnOver=false;
ad2460.combat.tempflagTurnOverHandeled=false;
ad2460.combatListener.parserInfo={};
ad2460.combat.attacking_tactics={};
ad2460.combat.defending_tactics={};

ad2460.combat.last_frame_render=new Date;

ad2460.combat.retreat_lines_drawn=false;

ad2460.combatListener.previousEventType=0;

ad2460.combat.waitingForSummary=0;

ad2460.combat.shipImages=new Array;

ad2460.combat.showFullCombatText=false;

ad2460.combat.restoreSfxVolume=-1;
ad2460.combat.restoreMusicVolume=-1;

ad2460.combat.updatePercentages=false;
ad2460.combat.updatePercentagesCounter=0;
ad2460.combat.updateIconsCounter=0;
missileDrawArray=new Array;
maxMissileTime=0;

// debug variables
var combatTimers = new Array;
var shipsRendered=0;

var allShipsMoveAtTheSameTime=true;

var highest_d=0;
var highest_dships=0;
var rendereffectsran=0;

var combatT1;
var combatT2;

// For ships etc
var canvas;
var context;
var mcanvas;
var mcontext;
var rightcanvas;
var rightcontext;
var rightmcanvas;
var rightmcontext;
var bgCircleImage;

// Testing canvas-buffer
var bcanvas;
var bcontext;
var extraFX=true;

var combatFrameRenderRequired=false;

var capitalFrameRenderRequired=false;
var minorFrameRenderRequired=false;

var attCapitalFrameRenderRequired=false;
var defCapitalFrameRenderRequired=false;

var attMinorFrameRenderRequired=false;
var defMinorFrameRenderRequired=false;

var combatCommentaryContainer;

var browser=fetch_browser_id();

var lookup = {};
var attShipImgLookup={};
var defShipImgLookup={};

var att_class='combat_attacker_text';
var def_class='combat_defender_text';


var roundSummaries = new Array;

var bgCircleImage2= new Image;
bgCircleImage2.setAttribute('src','images/icons/bluebgcircle.png'); // 29x29

var circleImageFrigate= new Image;
circleImageFrigate.setAttribute('src','images/icons/miniships/bgcircle_frigate.png'); // 29x29

var circleImageCruiser= new Image;
circleImageCruiser.setAttribute('src','images/icons/miniships/bgcircle_cruiser.png'); // 29x29

var circleImageBattleship= new Image;
circleImageBattleship.setAttribute('src','images/icons/miniships/bgcircle_battleship.png'); // 29x29

var circleImageGwell= new Image;
circleImageGwell.setAttribute('src','images/icons/miniships/bgcircle_gwell.png'); // 29x29

var circleImageCarrier= new Image;
circleImageCarrier.setAttribute('src','images/icons/miniships/bgcircle_carrier.png'); // 29x29

var circleImageUtility= new Image;
circleImageUtility.setAttribute('src','images/icons/miniships/bgcircle_utility.png'); // 29x29

var circleImagePDS= new Image;
circleImagePDS.setAttribute('src','images/icons/miniships/bgcircle_pds.png'); // 29x29

var pushFrame= new Image;
pushFrame.setAttribute('src','images/anims/stationpush_full.png'); // 300x300


// For effects
var ecanvas;
var econtext;

var waitingLines=new Array;

var explosionImage1=new Image;
explosionImage1.setAttribute('src','images/anims/explosion_anim.png'); // 134x134
var explosionImage2=new Image;
explosionImage2.setAttribute('src','images/anims/explosion_anim_small.png'); // 67x67
var explosionImage4=new Image;
explosionImage4.setAttribute('src','images/anims/newExpAnim64_01.png'); // 64x64
var explosionImage5=new Image;
explosionImage5.setAttribute('src','images/anims/explo_ship.png'); // 80x80

var empImage=new Image;
empImage.setAttribute('src','images/anims/sparks_anim.png'); // 100x100 7 frames
var empImage2=new Image;
empImage2.setAttribute('src','images/anims/disable_anim.png'); // 80x80 30 frames
var empImage3=new Image;
empImage3.setAttribute('src','images/anims/disabled_anim.png'); // 80x80 20 frames

var defenderMagnet=new Image;
defenderMagnet.setAttribute('src','images/anims/defender_magnet_anim.png'); // 80x80 16 frames

var combatrock1=new Image;
combatrock1.setAttribute('src','images/icons/combatsplinter01.png'); // 32x32 1 frame

var combatrock2=new Image;
combatrock2.setAttribute('src','images/icons/combatsplinter02.png'); // 32x32 1 frame

var combatrock3=new Image;
combatrock3.setAttribute('src','images/icons/combatsplinter03.png'); // 32x32 1 frame



//var testEffectImage=new Image;
//testEffectImage.setAttribute('src','images/anims/shield_anim.png'); // 100x100

//var testEffectImage2=new Image;
//testEffectImage2.setAttribute('src','images/anims/brimstone_anim.png'); // 100x100

//var gravityAmmoHitImage=new Image;
//gravityAmmoHitImage.setAttribute('src','images/anims/gravity_hit_anim.png'); // 80x80 , 50 frames, for ships hit by gravity ammo

var fieldConductionImage=new Image;
fieldConductionImage.setAttribute('src','images/anims/fieldconduction.png'); // 75x75 , 15 frames, for ships hit by gravity ammo

var gravityAmmoHitImage=new Image;
gravityAmmoHitImage.setAttribute('src','images/anims/gravity_hit2_anim.png'); // 80x80 , 31 frames, for ships hit by gravity ammo

var gravityAmmoRangeTargetImage=new Image;
gravityAmmoRangeTargetImage.setAttribute('src','images/anims/disable_anim.png'); // 80x80 , 30 frames, for ships affected by gravity area effect

var volatilityExplosionImage=new Image;
volatilityExplosionImage.setAttribute('src','images/anims/volatility_explode_anim.png'); // 80x80 36 frames

var volatilityHitImage=new Image;
volatilityHitImage.setAttribute('src','images/anims/volatility_hit_anim.png'); // 80x80 15 frames

var blinkAnim=new Image;
blinkAnim.setAttribute('src','images/anims/blinkblink.png'); // 16x16

//var protectorEmpAnim=new Image;
//protectorEmpAnim.setAttribute('src','images/anims/emp_protector.png'); // 150x150

var protectorEmpAnimSingle=new Image;
protectorEmpAnimSingle.setAttribute('src','images/anims/EMPframe.png'); // 140x140 1 frame only, scale and rotate!

var gravitywellEffectAnimSingle=new Image;
gravitywellEffectAnimSingle.setAttribute('src','images/anims/GRAVframe.png'); // 140x140 1 frame only, scale and rotate!

var intechShieldImg=new Image;
intechShieldImg.setAttribute('src','images/icons/miniships/100x100/in_shield.png'); // 100x100

var strontechShieldImg=new Image;
strontechShieldImg.setAttribute('src','images/icons/miniships/100x100/stron_shield.png'); // 100x100

var neotechShieldImg=new Image;
neotechShieldImg.setAttribute('src','images/icons/miniships/100x100/neo_shield.png'); // 100x100

var empShieldImage=new Image;
empShieldImage.setAttribute('src','images/anims/singleEmpFrameShield.png'); // 80x80

function setUpImageCache(){
	// must be ran after loading the production-items!!
	var d=new Date;

	var i=0;

	ad2460.combat.attShipImages=new Array;
	ad2460.combat.defShipImages=new Array;

	attShipImgLookup={};
	defShipImgLookup={};

	for (i=0;i<ad2460.productionitems.length ;i++ ){
		var filename=ad2460.productionitems[i].id+'.png';
		var thisImg=new Image;
		if (d.getDate()==1 && d.getMonth()==3 && d.getHours()>=20 && ad2460.scores.level>6){
			thisImg.setAttribute('src','images/emoticons/banana.png');
		}
		else if (d.getDate()==31 && d.getMonth()==9 && ad2460.scores.level>6) {
			if (ad2460.productionitems[i].vesseltype=="Normal") {
				if (ad2460.productionitems[i].vesselclass=="Frigate") {
					thisImg.setAttribute('src','images/emoticons/halloween1.png');
				}
				else if (ad2460.productionitems[i].vesselclass=="Cruiser") {
					thisImg.setAttribute('src','images/emoticons/halloween2.png');
				}
				else if (ad2460.productionitems[i].vesselclass=="Carrier") {
					thisImg.setAttribute('src','images/emoticons/halloween3.png');
				}
				else if (ad2460.productionitems[i].vesselclass=="Battleship") {
					thisImg.setAttribute('src','images/emoticons/halloween4.png');
				}
				else {
					thisImg.setAttribute('src','images/emoticons/manic.png');
				}
			}
			else {
				thisImg.setAttribute('src','images/icons/miniships/100x100/'+filename);
			}
		}
		else {
			thisImg.setAttribute('src','images/icons/miniships/100x100/'+filename);
		}
		ad2460.combat.attShipImages.push(thisImg);
		attShipImgLookup[ad2460.productionitems[i].id] = thisImg;

		var filename=ad2460.productionitems[i].id+'_rev.png';
		var thisImg=new Image;
		if (d.getDate()==1 && d.getMonth()==3 && ad2460.scores.level>6){
			thisImg.setAttribute('src','images/emoticons/banana.png');
		}
		else if (d.getDate()==31 && d.getMonth()==9 && d.getHours()>=20 && ad2460.scores.level>6) {
			if (ad2460.productionitems[i].vesseltype=="Normal") {
				if (ad2460.productionitems[i].vesselclass=="Frigate") {
					thisImg.setAttribute('src','images/emoticons/halloween1.png');
				}
				else if (ad2460.productionitems[i].vesselclass=="Cruiser") {
					thisImg.setAttribute('src','images/emoticons/halloween2.png');
				}
				else if (ad2460.productionitems[i].vesselclass=="Carrier") {
					thisImg.setAttribute('src','images/emoticons/halloween3.png');
				}
				else if (ad2460.productionitems[i].vesselclass=="Battleship") {
					thisImg.setAttribute('src','images/emoticons/halloween4.png');
				}
				else {
					thisImg.setAttribute('src','images/emoticons/manic.png');
				}
			}
			else {
				thisImg.setAttribute('src','images/icons/miniships/100x100/'+filename);
			}
		}
		else {
			thisImg.setAttribute('src','images/icons/miniships/100x100/'+filename);
		}
		ad2460.combat.defShipImages.push(thisImg);
		defShipImgLookup[ad2460.productionitems[i].id] = thisImg;
	}
}

function initiateCombatView(launch_id){
	// initiate loading of initial data
	// No, this is stupid...This is what round 0 is for!!
	// We need to load the combat-report for round 0, or wait until it's ready!

	denyLadyHelp=true;
	//console.log("Denying lady in combat..");
	hideHelpCommander();

	removeChildNodes('combat_commentary_container');
	$("#att_capitals_container").removeClass("many_ships").removeClass("few_ships").addClass("normal_ships");
	$("#att_minors_container").removeClass("many_ships").removeClass("few_ships").addClass("normal_ships");
	$("#def_capitals_container").removeClass("many_ships").removeClass("few_ships").addClass("normal_ships");
	$("#def_minors_container").removeClass("many_ships").removeClass("few_ships").addClass("normal_ships");
	$("#def_defense_container").removeClass("many_ships").removeClass("few_ships").addClass("normal_ships");
	ad2460.combat.waitingForSummary=0;
	loadFirstDataForCombat(launch_id);
	$("#view_combat_text").click();
	selectChatChannel('combat');
	scrollChatToBottom();
	$("#combat_text_on_off").addClass("pot_on");
	ad2460.combat.updatePercentages=false;
	ad2460.combat.updatePercentagesCounter=0;
	ad2460.combat.updateIconsCounter=0;


}

function resetCombatCommentaryContainer(){
	 $("#combat_comment_max_button").css( {background : "url(../images/fixed/upqueue.png) no-repeat" } );
	 $('#battlepane .combat_commentary').stop().css({height: '88px'});
	 $('#combat_commentary_scollbutton_container').css({right: '-20px'});
	 scrollChatToBottom();
}

function loadFirstDataForCombat(view_id){
	//console.log(view_id);
	lookup = {};
	var v2=parseInt(view_id);
	resetCombatCommentaryContainer();
	ad2460.combat.attacking_tactics={};
	ad2460.combat.defending_tactics={};
	ad2460.combat.att_strength=0;
	ad2460.combat.def_strength=0;
	ad2460.combat.selected_ship=0;
	ad2460.combat.waitingForSummary=0;
	ad2460.combat.retreat_lines_drawn=false;
	waitingLines=new Array;
	$.post('actionhandler.pl', {action:'load_first_combat_data',view_id:view_id}, function(data){ parseInfo(data);combatT1=new Date;highest_d=0; highest_dships=0; rendereffectsran=0; runInitialBlindIntro();});
	selectChatChannel('combat');
	updateCombatSoundIcons();

	// returns a call to updateInitialCombatData or a timeout-event to try again later...
}


function updateInitialCombatData(launch_id, combat_id, attacker_nickname, attacker_alliance_name, attacker_alliance_image, attacking_commander_name, attacking_commander_rank, attacking_commander_image_id, attacking_commander_sex, defender_nickname, defender_alliance_name, defender_alliance_image, defending_commander_name, defending_commander_rank, defending_commander_image_id, defending_commander_sex, location_name, location_x, location_y, location_planet_type, attacking_fighters, attacking_corvettes, attacking_utility, attacking_transports, attacking_fleets, attacking_capital_ships, attacking_strength, defending_fighters, defending_corvettes, defending_utility, defending_transports, defending_fleets, defending_capital_ships, defending_strength, defending_flak, defending_artillery, defending_shield_gens, defending_battle_stations,attacking_fleets_details,defending_fleets_details, att_pre_cost, def_pre_cost, att_avatar, def_avatar, mission_id, att_org_firepower, def_org_firepower, att_org_total_hull, def_org_total_hull, attacking_commander_uniform, defending_commander_uniform, view_id){
	//console.log(attacking_commander_uniform, defending_commander_uniform);

	ad2460.combat.loadedLaunchData.launch_id=launch_id;
	ad2460.combat.loadedLaunchData.view_id=view_id;
	ad2460.combat.loadedLaunchData.combat_id=combat_id;
	ad2460.combat.loadedLaunchData.attacker_nickname=attacker_nickname;
	ad2460.combat.loadedLaunchData.attacker_alliance_name=attacker_alliance_name;
	ad2460.combat.loadedLaunchData.attacker_alliance_image=attacker_alliance_image;
	ad2460.combat.loadedLaunchData.attacking_commander_name=attacking_commander_name;
	ad2460.combat.loadedLaunchData.attacking_commander_rank=attacking_commander_rank;
	ad2460.combat.loadedLaunchData.attacking_commander_image_id=attacking_commander_image_id;
	ad2460.combat.loadedLaunchData.attacking_commander_sex=attacking_commander_sex;
	ad2460.combat.loadedLaunchData.defender_nickname=defender_nickname;
	ad2460.combat.loadedLaunchData.defender_alliance_name=defender_alliance_name;
	ad2460.combat.loadedLaunchData.defender_alliance_image=defender_alliance_image;
	ad2460.combat.loadedLaunchData.defending_commander_name=defending_commander_name;
	ad2460.combat.loadedLaunchData.defending_commander_rank=defending_commander_rank;
	ad2460.combat.loadedLaunchData.defending_commander_image_id=defending_commander_image_id;
	ad2460.combat.loadedLaunchData.defending_commander_sex=defending_commander_sex;
	ad2460.combat.loadedLaunchData.location_name=location_name;
	ad2460.combat.loadedLaunchData.location_x=location_x;
	ad2460.combat.loadedLaunchData.location_y=location_y;
	ad2460.combat.loadedLaunchData.location_coords=convertShortCoordsToLongCoords(location_x,location_y);
	ad2460.combat.loadedLaunchData.location_planet_type=location_planet_type;
	ad2460.combat.loadedLaunchData.attacking_fighters=attacking_fighters;
	ad2460.combat.loadedLaunchData.attacking_corvettes=attacking_corvettes;
	ad2460.combat.loadedLaunchData.attacking_utility=attacking_utility;
	ad2460.combat.loadedLaunchData.attacking_transports=attacking_transports;
	ad2460.combat.loadedLaunchData.attacking_fleets=attacking_fleets;
	ad2460.combat.loadedLaunchData.attacking_capital_ships=attacking_capital_ships;
	ad2460.combat.loadedLaunchData.attacking_strength=attacking_strength;
	ad2460.combat.loadedLaunchData.defending_fighters=defending_fighters;
	ad2460.combat.loadedLaunchData.defending_corvettes=defending_corvettes;
	ad2460.combat.loadedLaunchData.defending_utility=defending_utility;
	ad2460.combat.loadedLaunchData.defending_transports=defending_transports;
	ad2460.combat.loadedLaunchData.defending_fleets=defending_fleets;
	ad2460.combat.loadedLaunchData.defending_capital_ships=defending_capital_ships;
	ad2460.combat.loadedLaunchData.defending_strength=defending_strength;
	ad2460.combat.loadedLaunchData.defending_flak=defending_flak;
	ad2460.combat.loadedLaunchData.defending_artillery=defending_artillery;
	ad2460.combat.loadedLaunchData.defending_shield_gens=defending_shield_gens;
	ad2460.combat.loadedLaunchData.defending_battle_stations=defending_battle_stations;
	ad2460.combat.loadedLaunchData.mission_id=mission_id;

	ad2460.combat.loadedLaunchData.att_org_firepower=att_org_firepower;
	ad2460.combat.loadedLaunchData.def_org_firepower=def_org_firepower;

	ad2460.combat.loadedLaunchData.att_org_total_hull=att_org_total_hull;
	ad2460.combat.loadedLaunchData.def_org_total_hull=def_org_total_hull;


	ad2460.combat.loadedLaunchData.attacking_commander_uniform=attacking_commander_uniform;
	ad2460.combat.loadedLaunchData.defending_commander_uniform=defending_commander_uniform;

	ad2460.combat.att_kills=0;
	ad2460.combat.att_losses=0;
	ad2460.combat.def_kills=0;
	ad2460.combat.def_losses=0;

	ad2460.combat.att_xp_total=0;
	ad2460.combat.def_xp_total=0;

	ad2460.combat.waitingForSummary=0;

	ad2460.combat.loadedLaunchData.att_pre_cost=att_pre_cost;
	ad2460.combat.loadedLaunchData.def_pre_cost=def_pre_cost;

	var att_avatar_src="images/uploads/avatars/"+att_avatar;
	var def_avatar_src="images/uploads/avatars/"+def_avatar;
	if (att_avatar=='none.jpg'){
		att_avatar_src="images/fixed/defaultplayer.jpg";
	}
	if (def_avatar=='none.jpg'){
		def_avatar_src="images/fixed/defaultplayer.jpg";
	}

	// Handle the more complex attacking_fleets_details
	// Handle the more complex defending_fleets_details

	$("#debug_launch_id").html(""+view_id);
	$("#debug_combat_id").html(""+view_id);

	ad2460.combat.attFleets=new Array;
	ad2460.combat.defFleets=new Array;

	var afd1=attacking_fleets_details.split("::");

	var f=0;
	for (f=0 ; f<afd1.length; f++ ){
		afd2=afd1[f].split("|");
		if (afd2.length>1){
			ad2460.combat.attFleets.push({fleetId:afd2[0] ,name:afd2[1], shipCount:afd2[2] });
		}
	}

	var dfd1=defending_fleets_details.split("::");
	var f=0;
	for (f=0 ; f<dfd1.length; f++ ){
		dfd2=dfd1[f].split("|");
		if (dfd2.length>1){
			ad2460.combat.defFleets.push({fleetId:dfd2[0] ,name:dfd2[1], shipCount:dfd2[2] });
		}
	}

	document.getElementById('att_commander_name').style.fontSize='14px';
	document.getElementById('def_commander_name').style.fontSize='14px';


	$("#att_playername").html(ad2460.combat.loadedLaunchData.attacker_nickname);
	$("#def_playername").html(ad2460.combat.loadedLaunchData.defender_nickname);
	$("#att_commander_name").html(ad2460.combat.loadedLaunchData.attacking_commander_name);
		if (ad2460.combat.loadedLaunchData.attacking_commander_name.length>15){
			document.getElementById('att_commander_name').style.fontSize='12px';
		}

	var rankObj1=returnCommanderRankNameObject(ad2460.combat.loadedLaunchData.attacking_commander_rank);
	$("#att_commander_rank").html(rankObj1.longRank);
	if (ad2460.combat.loadedLaunchData.defending_commander_rank>0){
		$("#def_commander_name").html(ad2460.combat.loadedLaunchData.defending_commander_name);
		if (ad2460.combat.loadedLaunchData.defending_commander_name.length>15){
			document.getElementById('def_commander_name').style.fontSize='12px';
		}

		var rankObj2=returnCommanderRankNameObject(ad2460.combat.loadedLaunchData.defending_commander_rank);
		$("#def_commander_rank").html(rankObj2.longRank);
	}
	else {
		$("#def_commander_name").html("None");
		var rankObj2=returnCommanderRankNameObject(ad2460.combat.loadedLaunchData.defending_commander_rank);
		$("#def_commander_rank").html("");
	}

	$("#att_fighters").html(''+ad2460.combat.loadedLaunchData.attacking_fighters);
	$("#att_corvettes").html(''+ad2460.combat.loadedLaunchData.attacking_corvettes);
	$("#att_utility").html(''+ad2460.combat.loadedLaunchData.attacking_utility);
	$("#att_transports").html(''+ad2460.combat.loadedLaunchData.attacking_transports);

	$("#def_fighters").html(''+ad2460.combat.loadedLaunchData.defending_fighters);
	$("#def_corvettes").html(''+ad2460.combat.loadedLaunchData.defending_corvettes);
	$("#def_utility").html(''+ad2460.combat.loadedLaunchData.defending_utility);
	$("#def_transports").html(''+ad2460.combat.loadedLaunchData.defending_transports);

	$("#att_fleets").html(''+ad2460.combat.loadedLaunchData.attacking_fleets);
	ad2460.combat.attacking_capital_ships=ad2460.combat.loadedLaunchData.attacking_capital_ships
	$("#att_capital_ships").html(''+ad2460.combat.attacking_capital_ships);
	ad2460.combat.att_strength=ad2460.combat.loadedLaunchData.attacking_strength;
	$("#att_strength").html(''+ad2460.combat.att_strength);

	$("#att_kills").html('0');
	$("#att_losses").html('0');

	$("#def_fleets").html(''+ad2460.combat.loadedLaunchData.defending_fleets);

	ad2460.combat.defending_capital_ships=ad2460.combat.loadedLaunchData.defending_capital_ships
	$("#def_capital_ships").html(''+ad2460.combat.defending_capital_ships);

	$("#def_capital_ships").html(''+ad2460.combat.loadedLaunchData.defending_capital_ships);
	ad2460.combat.def_strength=ad2460.combat.loadedLaunchData.defending_strength;
	$("#def_strength").html(''+ad2460.combat.def_strength);

	$("#def_kills").html('0');
	$("#def_losses").html('0');

	$("#def_flak").html(''+ad2460.combat.loadedLaunchData.defending_flak);
	$("#def_artillery").html(''+ad2460.combat.loadedLaunchData.defending_artillery);
	$("#def_shieldgenerators").html(''+ad2460.combat.loadedLaunchData.defending_shield_gens);
	$("#def_battlestations").html(''+ad2460.combat.loadedLaunchData.defending_battle_stations);

	$("#att_commander_insignia_image").attr('src','images/icons/insignias/rank'+zeroPad(ad2460.combat.loadedLaunchData.attacking_commander_rank)+'.png').show();
	$("#def_commander_insignia_image").attr('src','images/icons/insignias/rank'+zeroPad(ad2460.combat.loadedLaunchData.defending_commander_rank)+'.png').show();


	if (ad2460.combat.loadedLaunchData.attacker_alliance_image=='none.jpg'){
		$("#attackerAllianceImg").attr('src','images/fixed/defaultcrest.jpg').show();
	}
	else {
		$("#attackerAllianceImg").attr('src','images/uploads/alliancelogos/'+ad2460.combat.loadedLaunchData.attacker_alliance_image).show();
	}

	if (ad2460.combat.loadedLaunchData.defender_alliance_image == 'none.jpg' ){
		$("#defenderAllianceImg").attr('src','images/fixed/defaultcrest.jpg').show();
	}
	else {
		$("#defenderAllianceImg").attr('src','images/uploads/alliancelogos/'+ad2460.combat.loadedLaunchData.defender_alliance_image).show();
	}

	$("#attackerPlayerImg").attr('src',att_avatar_src).show();
	$("#defenderPlayerImg").attr('src',def_avatar_src).show();


	// We need to make some fake commander-objects here, to get the right graphics!

	var attCommander=new commander(1, 0, 1, "Unknown", "Unknown", 0, 0, 0, 0, ad2460.combat.loadedLaunchData.attacking_commander_rank, 0, 0, 0, ad2460.combat.loadedLaunchData.attacking_commander_image_id, ad2460.combat.loadedLaunchData.attacking_commander_sex, 0, 0, 0, ad2460.combat.loadedLaunchData.attacking_commander_uniform, 0);
	var defCommander=new commander(1, 0, 1, "Unknown", "Unknown", 0, 0, 0, 0, ad2460.combat.loadedLaunchData.defending_commander_rank, 0, 0, 0, ad2460.combat.loadedLaunchData.defending_commander_image_id, ad2460.combat.loadedLaunchData.defending_commander_sex, 0, 0, 0, ad2460.combat.loadedLaunchData.defending_commander_uniform, 0);
	//console.log(attCommander);

	var cmdImagesAtt=returnCommanderGraphics(attCommander);
	//console.log(cmdImagesAtt);
	//console.log(defCommander);
	var cmdImagesDef=returnCommanderGraphics(defCommander);
	if (mission_id>0){
		cmdImagesDef=returnMissionCommanderGraphics(defCommander);
	}

	$("#combat_att_commander_bg").attr('src',cmdImagesAtt.bgImage);
	$("#combat_att_commander_uniform").attr('src',cmdImagesAtt.uniformImage);
	$("#combat_att_commander_head").attr('src',cmdImagesAtt.headImage);

	if (ad2460.combat.loadedLaunchData.defending_commander_rank>0){
		$("#combat_def_commander_bg").attr('src',cmdImagesDef.bgImage).show();
		$("#combat_def_commander_uniform").attr('src',cmdImagesDef.uniformImage).show();
		$("#combat_def_commander_head").attr('src',cmdImagesDef.headImage).show();
	}
	else {
		$("#combat_def_commander_bg").hide();
		$("#combat_def_commander_uniform").hide();
		$("#combat_def_commander_head").hide();
		$("#def_commander_insignia_image").hide();
	}

	var pack_image_src='';
	var mission_pack_name='';
	var mission_name='';

	if (mission_id>0){
		var mission=returnMissionByMissionId(mission_id);
		var pack=false;
		if (mission){
			mission_name=mission.mission_name;
			pack=returnMissionPackById(mission.pack_id);
			if (pack){
				mission_pack_name=pack.pack_name;
				pack_image_src="images/fixed/missions/"+pack.pack_image;
			}
		}
	}

	// REMEMBER TO ADD mission_id to the call!!!
	openBattleView(attacker_nickname,attacker_alliance_name,attacker_alliance_image,defender_nickname,defender_alliance_name,defender_alliance_image,location_name,ad2460.combat.loadedLaunchData.location_coords.coordString,zeroPad(location_planet_type), att_avatar_src, def_avatar_src, pack_image_src, mission_pack_name, mission_name, mission_id);
	// REMEMBER TO ADD mission_id to the call!!!



	if (ad2460.combat.loadedLaunchData.location_planet_type==60){
		$("#combat_def_commander_bg").attr('src','images/commanders/station.jpg').show();
		$("#combat_def_commander_uniform").hide();
		$("#combat_def_commander_head").hide();
		$("#def_commander_insignia_image").hide();
	}
	if (ad2460.combat.loadedLaunchData.location_planet_type==70){
		$("#combat_def_commander_bg").attr('src','images/commanders/bankbattle.jpg').show();
		$("#combat_def_commander_uniform").hide();
		$("#combat_def_commander_head").hide();
		$("#def_commander_insignia_image").hide();
	}

	enableCombatListener(view_id);

	$("#att_costs").html(prettyPrint(ad2460.combat.loadedLaunchData.att_pre_cost));
	$("#def_costs").html(prettyPrint(ad2460.combat.loadedLaunchData.def_pre_cost));

	roundSummaries = new Array;

	ad2460.combat.percentages={};

	ad2460.combat.percentages.att_hull_percent=0;
	ad2460.combat.percentages.att_firepower_percent=0;
	ad2460.combat.percentages.att_strength_percent=0;
	ad2460.combat.percentages.att_capitals_percent=0;

	ad2460.combat.percentages.def_hull_percent=0;
	ad2460.combat.percentages.def_firepower_percent=0;
	ad2460.combat.percentages.def_strength_percent=0;
	ad2460.combat.percentages.def_capitals_percent=0;

	updateCombatPercentages();

	$('#in_battle_planet').attr('src','images/planets/outpost_planets/planettype'+zeroPad(ad2460.combat.loadedLaunchData.location_planet_type)+'.jpg');
	$('#in_battle_planet_name').html(ad2460.combat.loadedLaunchData.location_name);

	if (ad2460.combat.loadedLaunchData.location_planet_type<=10){
		$("#battle_planet_type").html("Homeworld");
	}
	else if (ad2460.combat.loadedLaunchData.location_planet_type<60){
		$("#battle_planet_type").html("Outpost");
	}
	else if (ad2460.combat.loadedLaunchData.location_planet_type==70){
		$("#battle_planet_type").html("Bank");
	}
	else {
		$("#battle_planet_type").html("Station");
	}
	if (ad2460.combat.loadedLaunchData.location_planet_type==99){
		$("#battle_planet_type").html("WarGame");
	}

	if (ad2460.combat.loadedLaunchData.mission_id>0){
		$("#battle_planet_type").html("Mission");
	}


	if (ad2460.audioVars.combatmusicVolume>0){
		document.getElementById('combatmusic').volume=ad2460.audioVars.combatmusicVolume;
		document.getElementById('combatmusic').play();
	}
	//play_multi_sound('combatmusic');
	updateSpeedIndicator();
	ad2460.combat.updateIcons=true;
	showRoundSummary(0);
}

function updateCombatPercentages(){
	// We have data here and there
	if (ad2460.combat.updatePercentages!=true){
		return;
	}
	// console.log("Updating combat percentages...");

	var att_org_hull=ad2460.combat.loadedLaunchData.att_org_total_hull;
	var att_org_firepower=ad2460.combat.loadedLaunchData.att_org_firepower;
	var att_org_strength=ad2460.combat.loadedLaunchData.attacking_strength;
	var att_org_capitals=ad2460.combat.loadedLaunchData.attacking_capital_ships;

	var def_org_hull=ad2460.combat.loadedLaunchData.def_org_total_hull;
	var def_org_firepower=ad2460.combat.loadedLaunchData.def_org_firepower;
	var def_org_strength=ad2460.combat.loadedLaunchData.defending_strength;
	var def_org_capitals=ad2460.combat.loadedLaunchData.defending_capital_ships;

	var att_cur_hull=0;
	var att_cur_firepower=0;
	var att_cur_strength=ad2460.combat.att_strength;
	var att_cur_capitals=ad2460.combat.attacking_capital_ships;

	var i=0;
	for(i=0;i<ad2460.combat.attShips.length;i++){
		if (ad2460.combat.attShips[i].hullstrength>0){
			att_cur_hull+=ad2460.combat.attShips[i].hullstrength;
			att_cur_firepower+=ad2460.combat.attShips[i].firepower;
		}
	}

	var def_cur_hull=0;
	var def_cur_firepower=0;
	var def_cur_strength=ad2460.combat.def_strength;
	var def_cur_capitals=ad2460.combat.defending_capital_ships;

	var i=0;
	for(i=0;i<ad2460.combat.defShips.length;i++){
		if (ad2460.combat.defShips[i].hullstrength>0){
			def_cur_hull+=ad2460.combat.defShips[i].hullstrength;
			def_cur_firepower+=ad2460.combat.defShips[i].firepower;
		}
	}

	// SHould be easy enough to calc the percentages now :)

	ad2460.combat.percentages.att_hull_percent=0;
	ad2460.combat.percentages.att_firepower_percent=0;
	ad2460.combat.percentages.att_strength_percent=0;
	ad2460.combat.percentages.att_capitals_percent=0;

	ad2460.combat.percentages.def_hull_percent=0;
	ad2460.combat.percentages.def_firepower_percent=0;
	ad2460.combat.percentages.def_strength_percent=0;
	ad2460.combat.percentages.def_capitals_percent=0;

	if (att_org_hull>0){
		ad2460.combat.percentages.att_hull_percent=Math.round(att_cur_hull*100/att_org_hull);
	}
	if (att_org_firepower>0){
		ad2460.combat.percentages.att_firepower_percent=Math.round(att_cur_firepower*100/att_org_firepower);
	}
	if (att_org_strength>0){
		ad2460.combat.percentages.att_strength_percent=Math.round(att_cur_strength*100/att_org_strength);
	}
	if (att_org_capitals>0){
		ad2460.combat.percentages.att_capitals_percent=Math.round(att_cur_capitals*100/att_org_capitals);
	}

	if (def_org_hull>0){
		ad2460.combat.percentages.def_hull_percent=Math.round(def_cur_hull*100/def_org_hull);
	}
	if (att_org_firepower>0){
		ad2460.combat.percentages.def_firepower_percent=Math.round(def_cur_firepower*100/def_org_firepower);
	}
	if (att_org_strength>0){
		ad2460.combat.percentages.def_strength_percent=Math.round(def_cur_strength*100/def_org_strength);
	}
	if (att_org_capitals>0){
		ad2460.combat.percentages.def_capitals_percent=Math.round(def_cur_capitals*100/def_org_capitals);
	}

	$("#att_capitals").css("height",ad2460.combat.percentages.att_capitals_percent+"%");
	$("#def_capitals").css("height",ad2460.combat.percentages.def_capitals_percent+"%");

	$("#att_firepower").css("height",ad2460.combat.percentages.att_firepower_percent+"%");
	$("#def_firepower").css("height",ad2460.combat.percentages.def_firepower_percent+"%");

	$("#att_hull").css("width",ad2460.combat.percentages.att_hull_percent+"%");
	$("#def_hull").css("width",ad2460.combat.percentages.def_hull_percent+"%");

	$("#str_gauge_att").css("width",ad2460.combat.percentages.att_strength_percent+"%");
	$("#str_gauge_def").css("width",ad2460.combat.percentages.def_strength_percent+"%");


	var att_lost_str_percent=100-ad2460.combat.percentages.att_strength_percent;
	var def_lost_str_percent=100-ad2460.combat.percentages.def_strength_percent;

	var relative_loss_thing=att_lost_str_percent-def_lost_str_percent;
	var relative_loss_width=Math.abs(Math.round(relative_loss_thing));

	if (relative_loss_thing==0){
		$("#negative_losses").css("width",relative_loss_width+"%");
		$("#positive_losses").css("width",relative_loss_width+"%");
	}
	else if (relative_loss_thing<0){
		$("#negative_losses").css("width","0%");
		$("#positive_losses").css("width",relative_loss_width+"%");

	}
	else if (relative_loss_thing>0){
		$("#positive_losses").css("width","0%");
		$("#negative_losses").css("width",relative_loss_width+"%");

	}
	ad2460.combat.updatePercentagesCounter++;
	ad2460.combat.updatePercentages=false;

}

function roundSummary(){
	this.attackerPrimaryShots=0;
	this.attackerPrimaryHits=0;
	this.attackerPrimaryDamageDealt=0;
	this.attackerSecondaryShots=0;
	this.attackerSecondaryHits=0;
	this.attackerSecondaryDamageDealt=0;
	this.attackerTertiaryShots=0;
	this.attackerTertiaryHits=0;
	this.attackerTertiaryDamageDealt=0;
	this.attackerMinorPrimaryShots=0;
	this.attackerMinorPrimaryHits=0;
	this.attackerMinorPrimaryDamageDealt=0;

	this.attackerCapitalKills=0;
	this.attackerMinorKills=0;
	this.attackerPDSKills=0;

	this.defenderPrimaryShots=0;
	this.defenderPrimaryHits=0;
	this.defenderPrimaryDamageDealt=0;
	this.defenderSecondaryShots=0;
	this.defenderSecondaryHits=0;
	this.defenderSecondaryDamageDealt=0;
	this.defenderCapitalKills=0;
	this.defenderMinorKills=0;
	this.defenderPDSKills=0;
	this.defenderTertiaryShots=0;
	this.defenderTertiaryHits=0;
	this.defenderTertiaryDamageDealt=0;
	this.defenderMinorPrimaryShots=0;
	this.defenderMinorPrimaryHits=0;
	this.defenderMinorPrimaryDamageDealt=0;



	return this;
}

function returnHitPercent(shots, hits){
	if (shots<1){
		return 0;
	}
	var percent=Math.floor(hits*100/shots);
	return percent;
}

function loadCombatSummary(view_id,render_it){
	if (typeof(combat_id)=='undefined'){
		view_id=ad2460.combatListener.view_id;
	}
	if (typeof(render_it)=='undefined'){
		render_it='false';
	}

	if (view_id<1){
		return;
	}

	$.post('actionhandler.pl', {action:'load_combat_summary',view_id:view_id,render_it:render_it}, function(data){ parseInfo(data);});
}

function storeCombatSummary(combat_id, duration, result, outpost_takeover, att_fighters_lost, att_corvettes_lost, att_frigates_lost, att_cruisers_lost, att_battleships_lost, att_carriers_lost, att_utility_lost, att_transports_lost, att_value_lost, att_damage_inflicted, att_commanders_levelup, def_fighters_lost, def_corvettes_lost, def_frigates_lost, def_cruisers_lost, def_battleships_lost, def_carriers_lost, def_utility_lost, def_transports_lost, def_flak_lost, def_artillery_lost, def_shield_gens_lost, def_battle_stations_lost, def_value_lost, def_damage_inflicted, def_commanders_levelup, launch_id, att_nickname, att_alliance_name, att_alliance_image, att_commander_name, att_commander_rank, att_commander_image_id, att_commander_sex, def_nickname, def_alliance_name, def_alliance_image, def_commander_name, def_commander_rank, def_commander_image_id, def_commander_sex, location_name, location_x, location_y, location_planet_type, att_fighters, att_corvettes, att_utility, att_transports, att_fleets, att_capital_ships, att_strength, def_fighters, def_corvettes, def_utility, def_transports, def_fleets, def_capital_ships, def_strength, def_flak, def_artillery, def_shield_gens, def_battle_stations, att_frigates, att_cruisers, att_battleships, att_carriers, def_frigates, def_cruisers, def_battleships, def_carriers, taken_h, taken_n, taken_s, taken_i, att_post_cost, def_post_cost, att_xp, def_xp, view_id, bonus_resources){
	var i=0;
	for (i=0;i<ad2460.combat.summaries.length ;i++ ){
		if (ad2460.combat.summaries[i].combat_id==combat_id){
			return;
		}
	}

	ad2460.combat.summaries.push(new combatSummary(combat_id, duration, result, outpost_takeover, att_fighters_lost, att_corvettes_lost, att_frigates_lost, att_cruisers_lost, att_battleships_lost, att_carriers_lost, att_utility_lost, att_transports_lost, att_value_lost, att_damage_inflicted, att_commanders_levelup, def_fighters_lost, def_corvettes_lost, def_frigates_lost, def_cruisers_lost, def_battleships_lost, def_carriers_lost, def_utility_lost, def_transports_lost, def_flak_lost, def_artillery_lost, def_shield_gens_lost, def_battle_stations_lost, def_value_lost, def_damage_inflicted, def_commanders_levelup, launch_id, att_nickname, att_alliance_name, att_alliance_image, att_commander_name, att_commander_rank, att_commander_image_id, att_commander_sex, def_nickname, def_alliance_name, def_alliance_image, def_commander_name, def_commander_rank, def_commander_image_id, def_commander_sex, location_name, location_x, location_y, location_planet_type, att_fighters, att_corvettes, att_utility, att_transports, att_fleets, att_capital_ships, att_strength, def_fighters, def_corvettes, def_utility, def_transports, def_fleets, def_capital_ships, def_strength, def_flak, def_artillery, def_shield_gens, def_battle_stations, att_frigates, att_cruisers, att_battleships, att_carriers, def_frigates, def_cruisers, def_battleships, def_carriers, taken_h, taken_n, taken_s, taken_i, att_post_cost, def_post_cost, att_xp, def_xp, view_id, bonus_resources));
}

function renderCombatSummary(view_id){
	if (typeof(view_id)=='undefined'){
		view_id=ad2460.combatListener.view_id;
	}

	var summary=false;
	var i=0;
	for (i=0;i<ad2460.combat.summaries.length ;i++ ){
		if (ad2460.combat.summaries[i].view_id==view_id){
			summary=ad2460.combat.summaries[i];
		}
	}

	if (summary===false){
		return;
	}

	$('#location_planet_img_sum').attr('src','images/planets/planettype'+zeroPad(summary.location_planet_type)+'.png');

	var resultString='';
	var missionResultString='';

	if (summary.result==1){		resultString='Attacker wins'; missionResultString="Mission Successful";	}
	if (summary.result==4){		resultString='Attacker wins'; missionResultString="Mission Successful";	}
	if (summary.result==2){		resultString='Defender wins'; missionResultString="Mission Failed";	}
	if (summary.result==5){		resultString='Defender wins'; missionResultString="Mission Failed";	}
	if (summary.result==3){		resultString='Mutual annihilation';	}

	$('#combat_summary_short_result_text').html(resultString);

	var resultString2='';

	if (summary.outpost_takeover==1){
		resultString2='Outpost claimed!';
		if (summary.location_planet_type>=60){
			resultString2='Station captured!';
		}
	}
	else {
		if (summary.location_planet_type<10){
			// Homeworld was targeted!
			if (summary.result==4 || summary.result==1 ){		resultString='Homeworld looted';	}
		}
	}

	$('#combat_summary_secondary_short_result_text').html(resultString2);

	$('#combat_summary_planet_name').html(summary.location_name);
	$('#combat_summary_att_nickname').html(summary.att_nickname);
	$('#combat_summary_def_nickname').html(summary.def_nickname);
	$('#combat_summary_att_alliancename').html(summary.att_alliance_name);
	$('#combat_summary_def_alliancename').html(summary.def_alliance_name);

	$('#com_sum_att_frigates_total').html(summary.att_frigates);
	$('#com_sum_att_frigates_lost').html(summary.att_frigates_lost);
	$('#com_sum_att_cruisers_total').html(summary.att_cruisers);
	$('#com_sum_att_cruisers_lost').html(summary.att_cruisers_lost);
	$('#com_sum_att_battleships_total').html(summary.att_battleships);
	$('#com_sum_att_battleships_lost').html(summary.att_battleships_lost);
	$('#com_sum_att_carriers_total').html(summary.att_carriers);
	$('#com_sum_att_carriers_lost').html(summary.att_carriers_lost);
	$('#com_sum_att_transports_total').html(summary.att_transports);
	$('#com_sum_att_transports_lost').html(summary.att_transports_lost);
	$('#com_sum_att_utility_total').html(summary.att_utility);
	$('#com_sum_att_utility_lost').html(summary.att_utility_lost);
	$('#com_sum_att_defenses_total').html('0');
	$('#com_sum_att_defenses_lost').html('0');

	$('#com_sum_def_frigates_total').html(summary.def_frigates);
	$('#com_sum_def_frigates_lost').html(summary.def_frigates_lost);
	$('#com_sum_def_cruisers_total').html(summary.def_cruisers);
	$('#com_sum_def_cruisers_lost').html(summary.def_cruisers_lost);
	$('#com_sum_def_battleships_total').html(summary.def_battleships);
	$('#com_sum_def_battleships_lost').html(summary.def_battleships_lost);
	$('#com_sum_def_carriers_total').html(summary.def_carriers);
	$('#com_sum_def_carriers_lost').html(summary.def_carriers_lost);
	$('#com_sum_def_transports_total').html(summary.def_transports);
	$('#com_sum_def_transports_lost').html(summary.def_transports_lost);
	$('#com_sum_def_utility_total').html(summary.def_utility);
	$('#com_sum_def_utility_lost').html(summary.def_utility_lost);
	$('#com_sum_def_defenses_total').html(summary.def_flak + summary.def_artillery + summary.def_shield_gens + summary.def_battle_stations);
	$('#com_sum_def_defenses_lost').html(summary.def_flak_lost+summary.def_artillery_lost + summary.def_shield_gens_lost + summary.def_battle_stations_lost);

	$('#combat_summary_att_xp').html(''+summary.att_xp);
	$('#combat_summary_def_xp').html(''+summary.def_xp);

	$("#com_sum_stolen_h").html(prettyPrint(summary.taken_h));
	$("#com_sum_stolen_i").html(prettyPrint(summary.taken_i));
	$("#com_sum_stolen_s").html(prettyPrint(summary.taken_s));
	$("#com_sum_stolen_n").html(prettyPrint(summary.taken_n));

	var bonus_per_res=Math.floor(summary.bonus_resources/4);
	if (bonus_per_res<1){
		$("#com_sum_bonus_header").hide();
		$("#com_sum_bonus").hide();
	}
	else {
		$("#com_sum_bonus_header").show();
		$("#com_sum_bonus").show();

		$("#com_sum_bonus_h").html(prettyPrint(bonus_per_res));
		$("#com_sum_bonus_i").html(prettyPrint(bonus_per_res));
		$("#com_sum_bonus_s").html(prettyPrint(bonus_per_res));
		$("#com_sum_bonus_n").html(prettyPrint(bonus_per_res));

	}

	var att_total=summary.att_frigates+summary.att_cruisers+summary.att_battleships+summary.att_carriers+summary.att_transports+summary.att_utility;
	$('#com_sum_att_total').html(att_total);

	var att_total_lost=summary.att_frigates_lost+summary.att_cruisers_lost+summary.att_battleships_lost+summary.att_carriers_lost+summary.att_transports_lost+summary.att_utility_lost;
	$('#com_sum_att_lost').html(att_total_lost);

	var def_total=summary.def_frigates+summary.def_cruisers+summary.def_battleships+summary.def_carriers+summary.def_transports+summary.def_utility+summary.def_flak + summary.def_artillery + summary.def_shield_gens + summary.def_battle_stations;
	$('#com_sum_def_total').html(def_total);

	var def_total_lost=summary.def_frigates_lost+summary.def_cruisers_lost+summary.def_battleships_lost+summary.def_carriers_lost+summary.def_transports_lost+summary.def_utility_lost+summary.def_flak_lost+summary.def_artillery_lost + summary.def_shield_gens_lost + summary.def_battle_stations_lost;
	$('#com_sum_def_lost').html(def_total_lost);


	//$('#com_sum_att_total').html(summary.att_total);
	//$('#com_sum_att_lost').html(summary.att_lost);

	//$('#com_sum_def_total').html(summary.def_total);
	//$('#com_sum_def_lost').html(summary.def_lost);

	$('#com_sum_att_fighters_total').html(summary.att_fighters);
	$('#com_sum_att_fighters_lost').html(summary.att_fighters_lost);
	$('#com_sum_att_corvettes_total').html(summary.att_corvettes);
	$('#com_sum_att_corvettes_lost').html(summary.att_corvettes_lost);
	$('#com_sum_def_fighters_total').html(summary.def_fighters);
	$('#com_sum_def_fighters_lost').html(summary.def_fighters_lost);
	$('#com_sum_def_corvettes_total').html(summary.def_corvettes);
	$('#com_sum_def_corvettes_lost').html(summary.def_corvettes_lost);
	$('#com_sum_commander_details_text_container').html(summary.def_commanders_levelup);

	$("#att_costs").html(prettyPrint(ad2460.combat.loadedLaunchData.att_pre_cost) +' / '+ prettyPrint(summary.att_post_cost));
	$("#def_costs").html(prettyPrint(ad2460.combat.loadedLaunchData.def_pre_cost) +' / '+ prettyPrint(summary.def_post_cost));


	var mission=returnMissionByMissionId(ad2460.combat.loadedLaunchData.mission_id);
	var pack_image_src='';
	var mission_pack_name='';
	var mission_name='';
	var pack=false;


	if (mission){
		mission_name=mission.mission_name;
		pack=returnMissionPackById(mission.pack_id);
		mission_pack_name=pack.pack_name;
		pack_image_src="images/fixed/missions/"+pack.pack_image;
		$("#combatMissionSumImg").attr("src",pack_image_src);
		$("#comSumEndText").html(missionResultString);

	}

	if( specialPublicPlayer != true  ){

		$('#share_combat_container').html("<img src='images/icons/fb-share-button.png' style='cursor:pointer' onclick='shareCombat("+summary.view_id+")'>");

	}
	else {
		$("#chatpane").css("height","52px");
	}


	showCombatSummary(ad2460.combat.loadedLaunchData.mission_id);

}

function shareCombat(view_id){
	FB.ui({
	  method: 'share',
	  href: 'http://'+window.location.hostname+'/combat.pl?id='+view_id+'&ref='+ad2460.user_id,
	}, function(response){});
}

function linkCombat(view_id){
	var url='http://'+window.location.hostname+'/combat.pl?id='+view_id+'&ref='+ad2460.user_id;
	showSimpleBox('Share this combat!','This link can be used to watch the combat even for those not playing! And if they join AD2460 from this link, they will have YOU as their referrer, which means free credits for you!<br>So go ahead, just copy it and paste it where you want it!<br><br>'+url);

}



function enableCombatListener(view_id){
	// Tune in to reports for the selected combat-id and poll for it every 10 seconds
	// Parse any result
	// Keep track of which turn you have recieved, as we only receive one turn at the time
	resetCombatData();

	ad2460.combatListener.view_id=view_id;
	ad2460.combatListener.enabled=true;
	ad2460.combatListener.turn=-1;
	ad2460.combatListener.turnData=new Array;

	ad2460.combat.paused=false;

	ad2460.combat.attShips=new Array;
	ad2460.combat.defShips=new Array;
	ad2460.combat.missiles=new Array;

	combatTimers=new Array;

	combatCommentaryContainer=document.getElementById('combat_commentary_container');

	fetchCombatUpdate();

	ad2460.combatListener.timer=setInterval(function(){fetchCombatUpdate()},ad2460.combatListener.timerSpeed*1000);
	ad2460.combatListener.parseTimer=setInterval(function(){parseNextSingleEvent()},ad2460.combatListener.eventDelay);
	var effectDelay=1000/30;

	/*
	if (combatTesting==true){
		effectDelay=1000/60;
	}
	*/

	ad2460.combatListener.effectTimer=setInterval(function(){renderEffects()},effectDelay);

	if (browser.mobile==true){
		ad2460.combatListener.percentTimer=setInterval(function(){updateCombatPercentages()},4000);
		ad2460.combatListener.iconsTimer=setInterval(function(){renderCombatShipIcons()},3000);
	}
	else {
		ad2460.combatListener.percentTimer=setInterval(function(){updateCombatPercentages()},2000);
		ad2460.combatListener.iconsTimer=setInterval(function(){renderCombatShipIcons()},1500);
	}


	$("#turn_digit").html("0");
	updateSpeedIndicator();



}

function closeBattleViewClick(){
	if (acceptClick!=true){
		return;
	}
	finish_it();
	closeBattleView();
	denyLadyHelp=false;
	hideHelpCommander();
	loadMissionsData();

}

function parseCombatSlower(){
	if (ad2460.combatListener.eventDelay>=110){
		return;
	}

	ad2460.combatListener.eventDelay+=30;
	if (ad2460.combatListener.eventDelay>110){
		ad2460.combatListener.eventDelay=110;
	}
	clearInterval(ad2460.combatListener.parseTimer);
	ad2460.combatListener.parseTimer=setInterval(function(){parseNextSingleEvent()},ad2460.combatListener.eventDelay);
	var speedstring="Normal";
	if(ad2460.combatListener.eventDelay==110){	speedstring="slowest";	}
	else if(ad2460.combatListener.eventDelay==70){	speedstring="slow";	}
	else if(ad2460.combatListener.eventDelay==40){	speedstring="normal";	}
	else if(ad2460.combatListener.eventDelay<=10){	speedstring="fastest";	}
	addCombatLogMessage("Combat-speed set to "+speedstring, true);
	updateSpeedIndicator();

}

function updateSpeedIndicator(){
	if (ad2460.combat.paused){
		$("#combat_speed_indicator").removeClass("slow").removeClass("normal").removeClass("fast").removeClass("fastest").addClass("slowest");
	}
	else {
		$("#combat_speed_indicator").removeClass("slow").removeClass("normal").removeClass("fast").removeClass("fastest").removeClass("slowest");
		var addclass="normal";
		if(ad2460.combatListener.eventDelay==110){	addclass="slow";	}
		else if(ad2460.combatListener.eventDelay==70){	addclass="normal";	}
		else if(ad2460.combatListener.eventDelay==40){	addclass="fast";	}
		else if(ad2460.combatListener.eventDelay<=10){	addclass="fastest";	}
		$("#combat_speed_indicator").addClass(addclass);
	}
}


function parseCombatFaster(){
	if (ad2460.combatListener.eventDelay<=10){
		return;
	}
	ad2460.combatListener.eventDelay-=30;
	if (ad2460.combatListener.eventDelay<10){
		ad2460.combatListener.eventDelay=10;
	}
	clearInterval(ad2460.combatListener.parseTimer);
	ad2460.combatListener.parseTimer=setInterval(function(){parseNextSingleEvent()},ad2460.combatListener.eventDelay);
	var speedstring="Normal";
	if(ad2460.combatListener.eventDelay==110){	speedstring="slowest";	}
	else if(ad2460.combatListener.eventDelay==70){	speedstring="slow";	}
	else if(ad2460.combatListener.eventDelay==40){	speedstring="normal";	}
	else if(ad2460.combatListener.eventDelay<=10){	speedstring="fastest";	}
	addCombatLogMessage("Combat-speed set to "+speedstring, true);

	updateSpeedIndicator();


	/*
	if(ad2460.combatListener.eventDelay==10){
		clearInterval(ad2460.combatListener.effectTimer);
		ad2460.combatListener.effectTimer=setInterval(function(){renderEffects()},1000/60);
	}
	else {
		clearInterval(ad2460.combatListener.effectTimer);
		ad2460.combatListener.effectTimer=setInterval(function(){renderEffects()},1000/30);
	}
	*/

}

function fetchCombatUpdate(){
	if (ad2460.combatListener.view_id>0 && ad2460.combatListener.enabled==true){
		$.post('actionhandler.pl', {action:'load_combat_data',view_id:ad2460.combatListener.view_id,last_turn:ad2460.combatListener.turn}, function(data){ parseInfo(data);});
	}
}

function updateCombatData(view_id, turn, events, att_tactics, def_tactics){
	//console.log("UpdateCombatData called with turn "+turn);

	roundSummaries.push(new roundSummary());

	if (view_id==ad2460.combatListener.view_id && turn==ad2460.combatListener.turn+1){
		//console.log("Processing...");
		// This is the right data we are after. Process it.
		ad2460.combatListener.turnData.push(new combatTurnData(view_id, turn, events));
		ad2460.combatListener.turn++; // Is this the right place to increment it?? No, not in the new way to handle this...
		ad2460.combatListener.maxTurn++;
		// parseNewCombatData(); Not anymore!
		if (att_tactics){
			var a_tac=att_tactics.split('::');
			ad2460.combat.attacking_tactics={};
			ad2460.combat.attacking_tactics=new tacticSetup(0, a_tac[0], a_tac[1], a_tac[2], a_tac[3], a_tac[4], a_tac[5], a_tac[6], a_tac[7], a_tac[8]);
			if (ad2460.combat.loadedLaunchData.location_planet_type==99){
			// Wargames.retreat-percentage should be 0
				ad2460.combat.attacking_tactics.retreat_percentage=0;
			}

		}
		if (def_tactics){
			var d_tac=def_tactics.split('::');
			ad2460.combat.defending_tactics={};
			ad2460.combat.defending_tactics=new tacticSetup(0, d_tac[0], d_tac[1], d_tac[2], d_tac[3], d_tac[4], d_tac[5], d_tac[6], d_tac[7], d_tac[8]);
			if (ad2460.combat.loadedLaunchData.location_planet_type==99){
			// Wargames.retreat-percentage should be 0
				ad2460.combat.defending_tactics.retreat_percentage=0;
			}
		}


		if (ad2460.combat.retreat_lines_drawn==false){
			if (att_tactics){
				if (def_tactics){
					if (ad2460.combat.attacking_tactics.retreat_type!='unknown'){
						var gauge='capitals';
						if (ad2460.combat.attacking_tactics.retreat_type=='Total firepower'){
							gauge='firepower';
						}
						else if (ad2460.combat.attacking_tactics.retreat_type=='Total hull'){
							gauge='hull';
						}
						else if (ad2460.combat.attacking_tactics.retreat_type=='Capital ships'){
							gauge='capitals';
						}
						setAttackerRetreat(gauge,parseInt(ad2460.combat.attacking_tactics.retreat_percentage));

						var gauge='capitals';
						if (ad2460.combat.defending_tactics.retreat_type=='Total firepower'){
							gauge='firepower';
						}
						else if (ad2460.combat.defending_tactics.retreat_type=='Total hull'){
							gauge='hull';
						}
						else if (ad2460.combat.defending_tactics.retreat_type=='Capital ships'){
							gauge='capitals';
						}
						setDefenderRetreat(gauge,parseInt(ad2460.combat.defending_tactics.retreat_percentage));

						ad2460.combat.retreat_lines_drawn=true;
					}
				}
			}
		}


		renderTacticalData();
	}
	else {
		//console.log("Wrong turn!");
	}

	//console.log("UpdateCombatData completed. Turn is now "+ad2460.combatListener.turn);
}

function parseNewCombatData(){
	// This function will be retired tbh!
	//console.log("Parsing new combat-data....");
	var i=0;
	for (i=0;i<ad2460.combatListener.turnData.length ;i++ ){
		if (ad2460.combatListener.turnData[i].is_processed==false){
			// We have it!
			var e=0;
			for (e=0;e<ad2460.combatListener.turnData[i].events.length ;e++ ){

				parseSingleEvent(ad2460.combatListener.turnData[i].events[e]);
			}

			ad2460.combatListener.turnData[i].is_processed=true;
			return true;
		}
	}
}

function loadLaunchDataForCombat(view_id){
	alert("loadLaunchDataForcombat called.???wtf?");

	$.post('actionhandler.pl', {action:'load_launch_data',view_id:view_id}, function(data){ parseInfo(data);});
	clearCanvas();
	clearRightCanvas();
	clearMCanvas();
	clearRightMCanvas();
}

function parseNextSingleEvent(){

	// ad2460.combatListener.turn = current turn we are parsing
	// ad2460.combatListener.turnData = an array of turns
	// ad2460.combatListener.maxTurn = counter to kep track of loaded turns
	// ad2460.combatListener.eventParserTurn = counter to keep track of where the parser is
	// ad2460.combatListener.lastParsedEvent = counter to keep track of where the parser is in the events-list

	var notDone=true;

	if (ad2460.combat.paused==true){
		return;
	}

	if (ad2460.combatListener.eventParserTurn<=ad2460.combatListener.maxTurn){
		// Ok, it should be a valid turn
		if (ad2460.combatListener.lastParsedEvent<ad2460.combatListener.turnData[ad2460.combatListener.eventParserTurn].events.length)	{
			// We have not parsed the last element of that turn just yet...
			ad2460.combatListener.lastParsedEvent++;
			//console.log("trying to parse ad2460.combatListener.turnData["+ad2460.combatListener.eventParserTurn+"].events["+ad2460.combatListener.lastParsedEvent+"]");
			notDone=parseSingleEvent(ad2460.combatListener.turnData[ad2460.combatListener.eventParserTurn].events[ad2460.combatListener.lastParsedEvent]);
		}

		if (notDone==false){
			// Exit from event type 100, we're all done thankyouverymuch!
			return;
		}

		// Now check for a possible turn flip-over...
		try {

			if (ad2460.combatListener.turnData.length>ad2460.combatListener.eventParserTurn){
				if (ad2460.combatListener.lastParsedEvent>=ad2460.combatListener.turnData[ad2460.combatListener.eventParserTurn].events.length)	{
					// We have now parsed the last one!
					// if maxTurn allows us, we must increase the selected turn!
					if (ad2460.combatListener.eventParserTurn<ad2460.combatListener.maxTurn && (ad2460.combat.tempflagTurnOverHandeled==true || ad2460.combatListener.eventParserTurn==0 ) ) {
						//showRoundSummary(ad2460.combatListener.eventParserTurn);
						ad2460.combatListener.eventParserTurn++;
						combatTimers.push(new Date().getTime());
						if(combatTimers.length>1){
							var prevround=ad2460.combatListener.eventParserTurn-1;
							var timespent=combatTimers[combatTimers.length-1]-combatTimers[combatTimers.length-2];
							//waitingLines.push("MS used: "+timespent);
							//waitingLines.push("Ships drawn: "+shipsRendered);
							shipsRendered=0;
						}

						//$("#combat_turn_indicator").html("Turn "+ad2460.combatListener.eventParserTurn);
						changeTurn(ad2460.combatListener.eventParserTurn);
						ad2460.combatListener.lastParsedEvent=-1;
						return;
					}
				}
			}
		}
		catch(err){

			console.log("ERROR:"+err.message);
			console.log("DEBUG: "+ad2460.combatListener.lastParsedEvent + " "+ad2460.combatListener.eventParserTurn);
			console.log(ad2460.combatListener.turnData);
			console.log(ad2460.combatListener);
		}
		if (notDone=='instant'){
			parseNextSingleEvent();
		}
	}
}

function parseSingleEvent(cev){
	// Just to make this abundantly clear ;)
	if (typeof(cev)=='undefined'){
		return;
	}



	var iRendered=false;

	var type=cev.event_type;
	var init=cev.initiative;
	var data=cev.data;
	if (typeof type!="undefined" && typeof init!="undefined" && typeof data!="undefined")	{
		var data_array=data.split("|");

		if (type!=301){
			$("#combat_waiting_outer").hide();
		}


		if(extraFX==true){
			allShipsMoveAtTheSameTime=false;
		}
		else {
			allShipsMoveAtTheSameTime=true;
		}


		// Now you know what you have :)
		if (type==1){
			// Someone shoots :)
			var shooter=returnCombatShipByUniqueId(data_array[0]);
			var target_side='att';
			if (shooter!=false){
				if (shooter.side=='Attacker'){
					target_side='def';
				}
			}
			var target=returnCombatShipByUniqueId(data_array[5], target_side);

			var weapon=data_array[6]; // primary, secondary, tertiary
			var emp_effect_added=data_array[7];
			var shield_splash_damage_amount=data_array[8];
			var shield_splash_damage_radius=data_array[9];
			var intercepted=data_array[10];
			var intercept_x=data_array[11];
			var intercept_y=data_array[12];
			var interceptor_id=data_array[13];
			var found_protector=data_array[14];
			var transfered_shield_damage=data_array[15];

			if (data_array[3]<0){
				data_array[3]=0;
			}

			if (shooter!=false && target!=false){
				var hit=data_array[2]; // 0 for miss, 1 for hit
				var shield_damage=data_array[3];
				var hull_damage=data_array[4];

				if (shooter.side=='Attacker'){
					if (weapon=='primary'){
						if (shooter.vesselclass=='Fighter' || shooter.vesselclass=='Corvette'){
							roundSummaries[ad2460.combatListener.eventParserTurn].attackerMinorPrimaryShots+=1;
							if (hit==1){
								roundSummaries[ad2460.combatListener.eventParserTurn].attackerMinorPrimaryHits+=1;
								roundSummaries[ad2460.combatListener.eventParserTurn].attackerMinorPrimaryDamageDealt+=parseInt(hull_damage);
							}
						}
						else {
							roundSummaries[ad2460.combatListener.eventParserTurn].attackerPrimaryShots+=1;
							if (hit==1){
								roundSummaries[ad2460.combatListener.eventParserTurn].attackerPrimaryHits+=1;
								roundSummaries[ad2460.combatListener.eventParserTurn].attackerPrimaryDamageDealt+=parseInt(hull_damage);
							}

						}
					}
					else if (weapon=='secondary'){
						roundSummaries[ad2460.combatListener.eventParserTurn].attackerSecondaryShots+=1;
						if (hit==1){
							roundSummaries[ad2460.combatListener.eventParserTurn].attackerSecondaryHits+=1;
							roundSummaries[ad2460.combatListener.eventParserTurn].attackerSecondaryDamageDealt+=parseInt(hull_damage);
						}
					}
					else if (weapon=='tertiary'){
						roundSummaries[ad2460.combatListener.eventParserTurn].attackerTertiaryShots+=1;
						if (hit==1){
							roundSummaries[ad2460.combatListener.eventParserTurn].attackerTertiaryHits+=1;
							roundSummaries[ad2460.combatListener.eventParserTurn].attackerTertiaryDamageDealt+=parseInt(hull_damage);
						}
					}
				}
				if (shooter.side=='Defender'){
					if (weapon=='primary'){
						if (shooter.vesselclass=='Fighter' || shooter.vesselclass=='Corvette'){
							roundSummaries[ad2460.combatListener.eventParserTurn].defenderMinorPrimaryShots+=1;
							if (hit==1){
								roundSummaries[ad2460.combatListener.eventParserTurn].defenderMinorPrimaryHits+=1;
								roundSummaries[ad2460.combatListener.eventParserTurn].defenderMinorPrimaryDamageDealt+=parseInt(hull_damage);
							}
						}
						else {
							roundSummaries[ad2460.combatListener.eventParserTurn].defenderPrimaryShots+=1;
							if (hit==1){
								roundSummaries[ad2460.combatListener.eventParserTurn].defenderPrimaryHits+=1;
								roundSummaries[ad2460.combatListener.eventParserTurn].defenderPrimaryDamageDealt+=parseInt(hull_damage);
							}
						}
					}
					else if (weapon=='secondary'){
						roundSummaries[ad2460.combatListener.eventParserTurn].defenderSecondaryShots+=1;
						if (hit==1){
							roundSummaries[ad2460.combatListener.eventParserTurn].defenderSecondaryHits+=1;
							roundSummaries[ad2460.combatListener.eventParserTurn].defenderSecondaryDamageDealt+=parseInt(hull_damage);
						}
					}
					else if (weapon=='tertiary'){
						roundSummaries[ad2460.combatListener.eventParserTurn].defenderTertiaryShots+=1;
						if (hit==1){
							roundSummaries[ad2460.combatListener.eventParserTurn].defenderTertiaryHits+=1;
							roundSummaries[ad2460.combatListener.eventParserTurn].defenderTertiaryDamageDealt+=parseInt(hull_damage);
						}
					}
				}

				shooter.visible=1;
				if (weapon=='primary'){
					if (shooter.vesselclass=='Fighter' || shooter.vesselclass=='Corvette'){
						ad2460.combat.effects.push(new effect('minorshot',2,parseInt(shooter.pos_x),parseInt(shooter.pos_y),parseInt(target.pos_x),parseInt(target.pos_y),shooter.side,weapon, target.unique_id,shooter.vesselclass, shooter.ship_type_id ));
					}
					else {

						if (shooter.ship_type_id==426){
							ad2460.combat.effects.push(new effect('volker_shot',100,parseInt(shooter.pos_x),parseInt(shooter.pos_y),parseInt(target.pos_x),parseInt(target.pos_y),data_array[1],weapon, target.unique_id,shooter.vesselclass, shooter.ship_type_id));
						}
						else {
							if (shooter.tech=='Matter' && newIntechShots==true){
								ad2460.combat.effects.push(new effect('intechshot',60,parseInt(shooter.pos_x),parseInt(shooter.pos_y),parseInt(target.pos_x),parseInt(target.pos_y),data_array[1],weapon, target.unique_id,shooter.vesselclass, shooter.ship_type_id));
							}
							else {
								ad2460.combat.effects.push(new effect('shot',60,parseInt(shooter.pos_x),parseInt(shooter.pos_y),parseInt(target.pos_x),parseInt(target.pos_y),data_array[1],weapon, target.unique_id,shooter.vesselclass, shooter.ship_type_id));
							}

						}


						if (emp_effect_added==1){
							ad2460.combat.effects.push(new effect('emp',70,parseInt(target.pos_x),parseInt(target.pos_y),parseInt(target.pos_x),parseInt(target.pos_y),empImage3,weapon, target.unique_id,shooter.vesselclass, shooter.ship_type_id));
						}
					}
					// removed shield-drain special, as it is only secondary effect
				}
				if (weapon=='tertiary'){
					ad2460.combat.effects.push(new effect('tertiaryshot',2,parseInt(shooter.pos_x),parseInt(shooter.pos_y),parseInt(target.pos_x),parseInt(target.pos_y),shooter.side,weapon, target.unique_id,target.vesselclass, shooter.ship_type_id ));
					if (emp_effect_added==1){
						ad2460.combat.effects.push(new effect('emp',70,parseInt(target.pos_x),parseInt(target.pos_y),parseInt(target.pos_x),parseInt(target.pos_y),empImage3,weapon, target.unique_id,target.vesselclass, target.ship_type_id));
					}
				}
				else if (weapon=='secondary'){
					var shooter_ship_id=data_array[0];
					var material=data_array[1];
					var hit=data_array[2]; // 0 for miss, 1 for hit
					var shield_damage=data_array[3];
					var hull_damage=data_array[4];
					var target_ship_id=data_array[5];
					var weapon=data_array[6]; // primary, secondary, tertiary
					var emp_effect_added=data_array[7];
					var shield_splash_damage_amount=data_array[8];
					var shield_splash_damage_radius=data_array[9];
					var intercepted=data_array[10];
					var intercept_x=data_array[11];
					var intercept_y=data_array[12];
					var interceptor_id=data_array[13];
					var found_protector=data_array[14];
					var transfered_shield_damage=data_array[15];
					var redirected=data_array[16];
					var redirected_to_ship_id=data_array[17];

					// fixing a helper-side to make missile-handeling go faster!
					var target_side='def';
					if (shooter.side=='def' || shooter.side=='Defender'){
						target_side='att';
					}

					//function						missile(x,y,														target_x, target_y,					hull_damage, shield_damage, material, target_ship_id, shooter_ship_id, hit){
					ad2460.combat.missiles.push(new missile(parseInt(shooter.pos_x),parseInt(shooter.pos_y),parseInt(target.pos_x),parseInt(target.pos_y), hull_damage, shield_damage, material, target_ship_id, shooter_ship_id, hit, emp_effect_added, shield_splash_damage_amount, shield_splash_damage_radius, intercepted, intercept_x, intercept_y, interceptor_id, redirected, redirected_to_ship_id, target_side));

					//return "instant";
				}


			}

			// change to only run for primary weapons!
			// if (data_array[2]==1){
			if (data_array[2]==1 && weapon=='primary' ){
				var doRedraw=true;
				// It's a hit :)
				if (shooter!=false && target!=false){
					if (target.vesselclass=='Fighter' || target.vesselclass=='Corvette'){
						doRedraw=false;
					}
					if (shooter.vesselclass!='Fighter' && shooter.vesselclass!='Corvette'){
						var material=data_array[1];
						ad2460.combat.effects.push(new effect('explosion2',20,target.pos_x,target.pos_y,0,0,explosionImage1,'', target.unique_id,target.vesselclass));

						if (extraFX==true && target.current_shield>0 && ( target.tech=='Matter' || target.tech=='Energy' || target.tech=='Displacement' )  ) {
							var shieldMat=intechShieldImg;
							if (target.tech=='Energy'){shieldMat=strontechShieldImg;  }
							if (target.tech=='Displacement'){shieldMat=neotechShieldImg;  }

							ad2460.combat.effects.push(new effect('shieldhit',20,target.pos_x,target.pos_y,0,0,shieldMat,'', target.unique_id,target.vesselclass));
							//ad2460.combat.effects.push(new effect('shieldhit2',20,target.pos_x,target.pos_y,0,0,empImage,'', target.unique_id,target.vesselclass));

						}

					}
					if (target.hullstrength>0 ){
						target.hullstrength-=parseInt(data_array[4]);
						target.current_shield-=parseInt(data_array[3]);
						if ( parseInt( data_array[4] ) > 100 ){
							//updateCombatPercentages();
						}
						var shooterClass=att_class;
						var targetClass='combat_defender_text';
						if (shooter.side=='Defender'){
							shooterClass='combat_defender_text';
						}
						if (target.side=='Attacker'){
							targetClass=att_class;
						}

						var transfered_s_string="";
						if (transfered_shield_damage>0){
							transfered_s_string=" ("+transfered_shield_damage+")";
						}

						addCombatLogMessage("<span class='"+shooterClass+"'>"+shooter.name+"</span> hits <span class='"+targetClass+"'>"+target.name+"</span> for "+data_array[4]+" points (pri). (Shields hit for "+data_array[3]+")"+transfered_s_string);

						if (target.hullstrength<=0)	{
							target.die();
							doRedraw=false;
						}
					}
					if (found_protector>0){
						// Show that the protector took the shield-damage in stead!
						var protector=returnCombatShipByUniqueId(found_protector,target_side);

						protector.current_shield-=parseInt(transfered_shield_damage);
						//ad2460.combat.effects.push(new effect('emp',70,parseInt(protector.pos_x),parseInt(protector.pos_y),parseInt(protector.pos_x),parseInt(protector.pos_y),empImage3,weapon, target.unique_id,target.vesselclass));
						if (protector.being_shield_drained==false){
							if (extraFX==true){
								ad2460.combat.effects.push(new effect('shieldDrain',45,parseInt(protector.pos_x),parseInt(protector.pos_y),parseInt(protector.pos_x),parseInt(protector.pos_y),gravityAmmoRangeTargetImage,'primary',protector.unique_id,'Cruiser'));
								protector.being_shield_drained=true;
							}
						}


					}
				}
				if (doRedraw==true){
					renderCombatFrame('capital',false, target_side);
				}

			}
			else if (data_array[2]==1 && weapon=='tertiary'){
				if (shooter!=false && target!=false){
					if (shooter.vesselclass!='Fighter' && shooter.vesselclass!='Corvette'){
						var material=data_array[1];
						//ad2460.combat.effects.push(new effect('explosion2',20,target.pos_x,target.pos_y,0,0,explosionImage1,'', target.unique_id,target.vesselclass));
						ad2460.combat.effects.push(new effect('smallexplosion1',10,target.pos_x,target.pos_y,0,0,explosionImage1,'', target.unique_id,target.vesselclass));

					}

					if (target.hullstrength>0 ){
						target.hullstrength-=parseInt(data_array[4]);
						target.current_shield-=parseInt(data_array[3]);

						if (shooter.side=='Defender'){
							addCombatLogMessage("<span class='combat_defender_text'>"+shooter.name+"</span> hits <span class='"+att_class+"'>"+target.name+"</span> for "+data_array[4]+" points. (ter) (Shields hit for "+data_array[3]+")");
						}
						else {
							addCombatLogMessage("<span class='"+att_class+"'>"+shooter.name+"</span> hits <span class='combat_defender_text'>"+target.name+"</span> for "+data_array[4]+" points. (ter) (Shields hit for "+data_array[3]+")");
						}
						if (target.hullstrength<=0)	{
							target.die();
						}
					}
				}
				//renderCombatFrame();

			}
			else {
				// It's a miss!
				if (shooter!=false && target!=false){
					if (weapon=='primary'){
						if (shooter.side=='Defender'){
							addCombatLogMessage("<span class='combat_defender_text'>"+shooter.name+"</span> misses when trying to shoot at the <span class='"+att_class+"'>"+target.name+"</span>");
						}
						else {
							addCombatLogMessage("<span class='"+att_class+"'>"+shooter.name+"</span> misses when trying to shoot at the <span class='combat_defender_text'>"+target.name+"</span>");
						}

					}
				}
			}
			//return "instant";
			// haha, bloody havoc!



		}
		else if (type==3){
			// Die!!
			return "instant";
			//return;
			// DID NOTHING!!!
			var ship=returnCombatShipByUniqueId(data_array[0]);
			var outputClass=att_class;
			if (ship.side=='Defender'){
				outputClass='combat_defender_text';
			}
			if (ship){
				addCombatLogMessage("<span class='"+outputClass+"'>"+ship.name+"</span> dies!",true);
				ship.active=0;
				// play explosion here :)
				ad2460.combat.effects.push(new effect('explosion1',20,ship.pos_x,ship.pos_y,0,0,explosionImage1,''));
				if (ship.side=='Attacker'){
					ad2460.combat.att_losses++;
					ad2460.combat.def_kills++;
				}
				else {
					ad2460.combat.att_kills++;
					ad2460.combat.def_losses++;
				}

				ad2460.combat.updateIcons=true;
				renderCombatFrame(); // Update the canvas!
			}
		}
		else if (type==5){
			// shield recharge
			var amount=data_array[1];
			var side=data_array[2];
			var ship=returnCombatShipByUniqueId(data_array[0],side);
			if (ship!=false){
				ship.current_shield+=parseInt(amount);
				//console.log(ship.current_shield, ship.max_shield);
			}
			//renderCombatFrame();
			return "instant";

		}
		else if (type==6){
			// Move-event
			ad2460.combatListener.previousEventType=6;
			var thisSide=data_array[6];
			var ship=returnCombatShipByUniqueId(data_array[0], thisSide);
			var doRedraw=false;
			if (ship!=false){
				ship.prev_x=ship.pos_x;
				ship.prev_y=ship.pos_y;
				ship.pos_x=parseInt(data_array[3]);
				ship.pos_y=parseInt(data_array[4]);
				ship.current_angle=data_array[5];

				if (Math.random()*100<10){
					doRedraw=true;
				}

			}
			if (allShipsMoveAtTheSameTime==false){
				if (doRedraw){
					iRendered=true;
					if (ship.vesselclass=='Fighter' || ship.vesselclass=='Corvette'){
						renderCombatFrame('minor', false, thisSide); // Update the canvas!
					}
					else {
						renderCombatFrame('capital', false, thisSide); // Update the canvas!
					}

				}




			}
			if (allShipsMoveAtTheSameTime==true){
				return "instant";
			}

		}
		else if (type==8){
			// Protector EMP-event
			//8,$initiative,"shooter_id|x|y|list_of_ship_ids_affected
			var unique_id=data_array[0];
			var x=data_array[1];
			var y=data_array[2];
			var listString=data_array[3];

			var ship=returnCombatShipByUniqueId(unique_id);
			if (ship!=false){
				var list=listString.split(",");

				// Now we need to create a new effect-type, which ends with moving the ship!
				// Awesome :)
				// type,duration,x,y,target_x,target_y,material,weapon,parent_ship_id, parent_ship_vesselclass
				var x=0;
				for (x=0;x<list.length ;x++ ){
					var t=returnCombatShipByUniqueId(list[x]);
					if (t!=false){
						if (t.frozen==0){
							t.frozen=1;
							t.visible=1;
							ad2460.combat.effects.push(new effect('minorEmpTarget',35,t.pos_x,t.pos_y,null,null,empImage3,null,null,null));
						}
						// We could consider adding emp-anims for all affected targets here, but damn, will slow things down!! Poor ipads!
						// change colour on frozen ships possibly, on the next redraw!!
					}
				}

				//ad2460.combat.effects.push(new effect('protectorEmpAnim',30,ship.pos_x,ship.pos_y,null,null,protectorEmpAnim,null,null,null));
				if (extraFX==true){
					ad2460.combat.effects.push(new effect('protectorEmpAnimSingle',30,ship.pos_x,ship.pos_y,null,null,protectorEmpAnimSingle,null,null,null));
				}
				//addCombatLogMessage("P-EMP!");
				var empcount=list.length-1;
				if (ship.side=='Defender'){
					addCombatLogMessage("<span class='combat_defender_text'>"+ship.name+"</span> EMPs "+empcount+" minors");
				}
				else {
					addCombatLogMessage("<span class='"+att_class+"'>"+ship.name+"</span> EMPs "+empcount+" minors");
				}


			}

		}
		else if (type==9){
			//console.log("Type 9 detected!");
			// special shield recharge
			var ship=returnCombatShipByUniqueId(data_array[0]);
			var amount=data_array[1];
			if (ship!=false){
				ship.current_shield+=parseInt(amount);
				//console.log("Adding recharge-.effect");
				if (ship.being_shield_drained==false){
					if (extraFX==true){
						ship.being_shield_drained=true;
						ad2460.combat.effects.push(new effect('shieldDrainInstant',45,ship.pos_x,ship.pos_y,ship.pos_x,ship.pos_y,fieldConductionImage,'primary',ship.unique_id,ship.vesselclass));
					}
				}
			}
			renderCombatFrame('capital', false, ship.side);
		}
		else if (type==18){
			// special for showing targeting!!
			// ship is data_array[0]
			// target is data_array[1]
			// primary / secondary / tertiary is data_array[2]
			var shooter=returnCombatShipByUniqueId(data_array[0]);
			var target=returnCombatShipByUniqueId(data_array[1]);
			var weapon=data_array[2];

			ad2460.combat.effects.push(new effect('target_shot',180,parseInt(shooter.pos_x),parseInt(shooter.pos_y),parseInt(target.pos_x),parseInt(target.pos_y),data_array[1], weapon, target.unique_id,shooter.vesselclass, shooter.ship_type_id));

			// return "instant";
			return;

		}


		else if (type==20){
			// Special station push-effect
			// Push attacking ships out of the combat!
			// duration 150
			// push by 4 pixels per frame
			var x=data_array[1];
			var y=data_array[2];

			ad2460.combat.effects.push(new effect('stationpush',200,x,y,0,0,pushFrame,null,null,null));
		}

		else if (type==30){
			// Blink-event

			var unique_id=data_array[0];
			var ship=returnCombatShipByUniqueId(unique_id);

			var doRedraw=true;
			if (ship!=false){
				var toX=data_array[1];
				var toY=data_array[2];

				ship.prev_x=ship.pos_x;
				ship.prev_y=ship.pos_y;
				// Now we need to create a new effect-type, which ends with moving the ship!
				// Awesome :)
				// type,duration,x,y,target_x,target_y,material,weapon,parent_ship_id, parent_ship_vesselclass
				ad2460.combat.effects.push(new effect('blink',10,ship.pos_x,ship.pos_y,toX,toY,blinkAnim,null,unique_id,null));
				ship.visible=0;
			}

			// dont draw anymore
		}
		else if (type==32){
			// Cloak-event
			var unique_id=data_array[0];
			var ship=returnCombatShipByUniqueId(unique_id);

			if (ship!=false){
				ship.prev_x=ship.pos_x;
				ship.prev_y=ship.pos_y;
				// Now we need to create a new effect-type, which ends with moving the ship!
				// Awesome :)
				// type,duration,x,y,target_x,target_y,material,weapon,parent_ship_id, parent_ship_vesselclass
				ad2460.combat.effects.push(new effect('cloak',10,ship.pos_x,ship.pos_y,null,null,blinkAnim,null,unique_id,null));
				ship.visible=0;
			}
		}
		else if (type==33){
			// Decloak-event
			var unique_id=data_array[0];
			var ship=returnCombatShipByUniqueId(unique_id);

			if (ship!=false){
				if(ship.visible!=1){
					ship.visible=1;
					renderShip(ship);
				}
			}
		}
		else if (type==34){
			// Gravity well charges
			var unique_id=data_array[0];
			var x=data_array[1];
			var y=data_array[2];
			var charge_turn=data_array[3];

		}
		else if (type==35){
			// Gravity well jumps into position
			var unique_id=data_array[0];
			var from_x=data_array[1];
			var from_y=data_array[2];
			var to_x=data_array[3];
			var to_y=data_array[4];
			//console.log("type 35",unique_id,from_x,from_y,to_x,to_y );
			var ship=returnCombatShipByUniqueId(unique_id);

			if (ship!=false){
				ship.prev_x=ship.pos_x;
				ship.prev_y=ship.pos_y;
				ship.pos_x=parseInt(to_x);
				ship.pos_y=parseInt(to_y);
				//console.log("Adding gravWellVanish effect",from_x, from_y, unique_id);
				ad2460.combat.effects.push(new effect('gravWellVanish',15,from_x,from_y,null,null,blinkAnim,null,unique_id,null));
				ad2460.combat.effects.push(new effect('gravWellAppear',30,to_x,to_y,null,null,blinkAnim,null,unique_id,null));
			}


		}
		else if (type==36){
			// Gravity well starts making the singularity
			var unique_id=data_array[0];
			var x=data_array[1];
			var y=data_array[2];

		}
		else if (type==37){
			// Singularity in effect! Booom!
			var unique_id=data_array[0];
			var x=data_array[1];
			var y=data_array[2];

			ad2460.combat.effects.push(new effect('gravitywellEffectAnimSingle',60,x,y,null,null,gravitywellEffectAnimSingle,null,null,null));
		}
		else if (type==38){
			// Event for ships affected by the singularity!
			//console.log("38 triggered!");
			var unique_id=data_array[0];
			var newPosX=data_array[1];
			var newPosY=data_array[2];
			var damage=data_array[3];
			var ship=returnCombatShipByUniqueId(unique_id);

			if (damage<0){
				damage=0;
			}

			if (ship!=false){
				ship.prev_x=ship.pos_x;
				ship.prev_y=ship.pos_y;
				ship.pos_x=parseInt(newPosX);
				ship.pos_y=parseInt(newPosY);
				ship.hullstrength-=damage;
				if (ship.hullstrength<=0)	{
					ship.die();
				}

			}

		}





		else if (type==40){
			// Force redraw of ships! (like after the last blink-effect)
			renderCombatFrame('all',true, 'both'); // Update the canvas!

		}

		else if (type==41){
			// Sabotage by boarding-ship
			var boarding_ship_id=data_array[0];
			var target_ship_id=data_array[1];
			var hullDamage=data_array[2];
			var shieldDamage=data_array[3];

			var target=returnCombatShipByUniqueId(target_ship_id);
			var ship=returnCombatShipByUniqueId(boarding_ship_id);

			if (target!=false){

				if (ship.side=='Defender'){
					addCombatLogMessage("<span class='combat_defender_text'>"+ship.name+"</span> performs sabotage on <span class='"+att_class+"'>"+target.name+"</span> for "+hullDamage+" points.");
				}
				else {
					addCombatLogMessage("<span class='"+att_class+"'>"+ship.name+"</span> performs sabotage on <span class='combat_defender_text'>"+target.name+"</span> for "+hullDamage+" points.");
				}

				target.hullstrength-=hullDamage;
				target.current_shield-=shieldDamage;

				ad2460.combat.effects.push(new effect('explosion1',20,target.pos_x,target.pos_y,0,0,explosionImage1,''));

				if (target.hullstrength<=0)	{
					target.die();
				}

				renderCombatFrame('capital', false, target.side); // Update the canvas!
			}
		}

		else if (type==42){
			// Shield-Sabotage by boarding-ship
			var boarding_ship_id=data_array[0];
			var target_ship_id=data_array[1];

			var ship=returnCombatShipByUniqueId(boarding_ship_id);
			var target=returnCombatShipByUniqueId(target_ship_id);
			if (target!=false){
				target.current_shield=0;
				if (ship.side=='Defender'){
					addCombatLogMessage("<span class='combat_defender_text'>"+ship.name+"</span> has sabotaged the shields on <span class='"+att_class+"'>"+target.name+"</span>");
				}
				else {
					addCombatLogMessage("<span class='"+att_class+"'>"+ship.name+"</span> has sabotaged the shields on <span class='combat_defender_text'>"+target.name+"</span>");
				}
				ad2460.combat.effects.push(new effect('shieldDrainOrigin',62,target.pos_x,target.pos_y,target.pos_x,target.pos_y,gravityAmmoHitImage,'primary',target.unique_id,target.vesselclass));
			}
		}
		else if (type==43){
			// Targeting-Sabotage by boarding-ship
			var boarding_ship_id=data_array[0];
			var target_ship_id=data_array[1];

			var ship=returnCombatShipByUniqueId(boarding_ship_id);
			var target=returnCombatShipByUniqueId(target_ship_id);
			if (target!=false){
				target.current_shield=0;
				if (ship.side=='Defender'){
					addCombatLogMessage("<span class='combat_defender_text'>"+ship.name+"</span> has sabotaged the targeting-array on <span class='"+att_class+"'>"+target.name+"</span>");
				}
				else {
					addCombatLogMessage("<span class='"+att_class+"'>"+ship.name+"</span> has sabotaged the targeting-array on <span class='combat_defender_text'>"+target.name+"</span>");
				}
				if (extraFX==true){
					ad2460.combat.effects.push(new effect('shieldDrainOrigin',62,target.pos_x,target.pos_y,target.pos_x,target.pos_y,gravityAmmoHitImage,'primary',target.unique_id,target.vesselclass));
				}
			}
		}
		else if (type==49){
			// Commander-effect comes into play!

			var side=data_array[0];
			var effect_id=data_array[1];
			var cmd_name=data_array[2];

			var CMDeffect=returnGameObjectById(effect_id);
			if (CMDeffect!=false){
				if (side=='def'){
					addCombatLogMessage("<span class='combat_defender_text'>"+cmd_name+"</span> has decided to make use of "+CMDeffect.name+"!</span>",true);
				}
				else {
					addCombatLogMessage("<span class='"+att_class+"'>"+cmd_name+"</span> has decided to make use of "+CMDeffect.name+"!</span>",true);
				}
			}
		}

		else if (type==10){
			// Volatility-message
			// add_event(10,$initiative,"$target->{unique_id}|$volatility_radius|$volatility_amount|$weapon");
			var ship=returnCombatShipByUniqueId(data_array[0]);
			var volatility_radius=data_array[1];
			var volatility_amount=data_array[2];
			var weapon=data_array[3];
			var affected_ships=data_array[4]; // comma-separated!

			// console.log("Type 10 volatility-message passed on with data "+weapon+" "+volatility_radius+" "+volatility_amount);
			//console.log("Info: "+ship.name+" "+ship.active+" "+ship.hullstrength+" "+ship.unique_id+" "+affected_ships);

			if (weapon=='primary'){
				// fire it off right away!
				// Note the special last data-entry sent into the effect-object, it is NOT the vesselclass as you'd expect, but a list of affected ships!
				ad2460.combat.effects.push(new effect('volatility',51,ship.pos_x,ship.pos_y,volatility_radius,volatility_amount,volatilityExplosionImage,weapon,ship.unique_id, affected_ships));
				// Let the effect cause it's damage in the first frame ?
			}
			else if (weapon=='secondary'){
				// modify something on the target so it knows it should cause it when dieing!
				//console.log("Adding volatility-effect to dying ship...");
								// Note the special last data-entry sent into the effect-object, it is NOT the vesselclass as you'd expect, but a list of affected ships!
				ship.volatilityEffect=new effect('volatility',51,ship.pos_x,ship.pos_y,volatility_radius,volatility_amount,volatilityExplosionImage,weapon, ship.unique_id, affected_ships);
				//console.log(ship.volatilityEffect);
				// Let the effect cause it's damage in the first frame ?
			}
		}

		else if (type==11){
			// NEW Volatility-message
			// add_event(10,$initiative,"$target->{unique_id}|$volatility_radius|$volatility_amount|$weapon");
			var ship=returnCombatShipByUniqueId(data_array[0]);
			var volatility_radius=data_array[1];
			var volatility_amount=data_array[2];
			var weapon=data_array[3];
			var affected_ships=data_array[4]; // comma-separated!

			// console.log("NEW Type 11 volatility-message passed on with data "+weapon+" "+volatility_radius+" "+volatility_amount);
			//console.log("Info: "+ship.name+" "+ship.active+" "+ship.hullstrength+" "+ship.unique_id+" "+affected_ships);

			if (weapon=='primary'){
				// fire it off right away!
				// Note the special last data-entry sent into the effect-object, it is NOT the vesselclass as you'd expect, but a list of affected ships!
				ad2460.combat.effects.push(new effect('volatility2',51,ship.pos_x,ship.pos_y,volatility_radius,volatility_amount,volatilityExplosionImage,weapon,ship.unique_id, affected_ships));
				// Let the effect cause it's damage in the first frame ?
			}
			else if (weapon=='Special'){
				// fire it off right away!
				// Note the special last data-entry sent into the effect-object, it is NOT the vesselclass as you'd expect, but a list of affected ships!
				ad2460.combat.effects.push(new effect('volatility2',51,ship.pos_x,ship.pos_y,volatility_radius,volatility_amount,volatilityExplosionImage,weapon,ship.unique_id, affected_ships));
				// Let the effect cause it's damage in the first frame ?
			}
			else if (weapon=='secondary'){
				// modify something on the target so it knows it should cause it when dieing!
				// console.log("NEW Adding volatility-effect to dying ship...");
				// Note the special last data-entry sent into the effect-object, it is NOT the vesselclass as you'd expect, but a list of affected ships!
				ship.volatilityEffect=new effect('volatility2',51,ship.pos_x,ship.pos_y,volatility_radius,volatility_amount,volatilityExplosionImage,weapon, ship.unique_id, affected_ships);
				// Let the effect cause it's damage in the first frame ?
			}
		}


		else if (type==100){
			// Combat over!!!!
			showRoundSummary(ad2460.combatListener.eventParserTurn);
			waitingLines.push("The combat has been resolved");
			ad2460.combat.tempflagTurnOver=true;
			ad2460.combat.tempflagCombatOver2=true;
			//addCombatLogMessage("The combat has been resolved");
			combatT2=new Date;
			var combatTdiff=combatT2.getTime()-combatT1.getTime();
			renderCombatShipIcons();

			//waitingLines.push('Time : '+combatTdiff);



		}
		else if (type==103){
			// Commander died!
			var commanderName=data_array[0];
			var msg="%1% was killed";
			msg=msg.replace("%1%",commanderName);
			//addCombatLogMessage(msg);
			waitingLines.push(msg);
		}

		else if (type==104){
			// Commander gained xp
			var commanderId=data_array[0];
			var commanderName=data_array[1];
			var xp=data_array[2];
			var side=data_array[3];
			var multiplier=data_array[4];

			var msg="%1% gained %2% XP";
			msg=msg.replace("%1%",commanderName);
			msg=msg.replace("%2%",xp);

			if(side=='att'){
				ad2460.combat.att_xp_total+=xp;
			}
			if(side=='def'){
				ad2460.combat.def_xp_total+=xp;
			}

			waitingLines.push(msg);
			//addCombatLogMessage(msg);
		}


		else if (type==105){
			// Retreat-order issued
			var retreatingSide=data_array[0];

			// We don't need this anymore
			/*
			if (retreatingSide=='Def'){
				addCombatLogMessage("Defending fleets retreat.",true);
			}
			else if (retreatingSide=='Att'){
				addCombatLogMessage("Attacking fleets retreat.",true);
			}
			*/
		}
		else if (type==106){
			// Commander leveled up!
			var commanderId=data_array[0];
			var commanderName=data_array[1];
			var prevLevel=data_array[2];
			var newLevel=data_array[3];

			var rankObj=returnCommanderRankNameObject(newLevel);

			var msg="%1% was promoted to %2%!";
			msg=msg.replace("%1%",commanderName);
			msg=msg.replace("%2%",rankObj.longRank);
			waitingLines.push(msg);
			//addCombatLogMessage(msg);

			if (ad2460.combat.loadedLaunchData.target_org_owner_id==ad2460.user_id || ad2460.combat.loadedLaunchData.launcher_id==ad2460.user_id){
				fetchOwnCommanders();
			}
		}
		else if (type==107){
			// Commander escaped!
			var commanderName=data_array[0];
			var msg="%1% managed to escape";
			msg=msg.replace("%1%",commanderName);
			//addCombatLogMessage(msg);
			waitingLines.push(msg);
		}

		else if (type==200){
			// Stolen resources data, per fleet!
			var thisFleetId=data_array[0];
			var stolenH=data_array[1];
			var stolenN=data_array[2];
			var stolenS=data_array[3];
			var	stolenI=data_array[4];

			if (stolenH>0 || stolenI>0 || stolenS>0 || stolenN>0 ){
				var thisFleetName=returnCombatFleetName(thisFleetId);

				var msg="Fleet %1% plundered %2% H, %3% I, %4% S and %5% N";
				msg=msg.replace("%1%",thisFleetName);
				msg=msg.replace("%2%",prettyPrint(stolenH));
				msg=msg.replace("%3%",prettyPrint(stolenI));
				msg=msg.replace("%4%",prettyPrint(stolenS));
				msg=msg.replace("%5%",prettyPrint(stolenN));
				waitingLines.push(msg);
				//addCombatLogMessage(msg);

			}
		}
		else if (type==300){
			// General text to be printed, no fuss
			var msg=data_array[0];
			addCombatLogMessage(msg,true);
		}
		else if (type==302){
			// General text to be printed, no fuss, but a forced output regardless of full text
			var msg=data_array[0];
			addCombatLogMessage(msg, true);
		}

		else if (type==301){
			// End of round
			$("#combat_waiting_outer").show();
			ad2460.combat.tempflagTurnOver=true;
			ad2460.combat.tempflagTurnOverHandeled=false;
			if (ad2460.combat.tempflagCombatOver2!=true){
				showRoundSummary(ad2460.combatListener.eventParserTurn);
				if (ad2460.combat.showFullCombatText==true){
					waitingLines.push("End of turn "+ad2460.combatListener.eventParserTurn);
				}
				//waitingLines.push("End of turn "+ad2460.combatListener.eventParserTurn);
				//waitingLines.push("rendereffectsran "+rendereffectsran);

			}
			removeEmpEffects();
		}
		else if (type==501){
			// trigger for reload-missions!
			loadMissionsData();
		}

		else if (type==999){
			// Stop parsing
			//console.log('999 received, its over.');
			ad2460.combat.tempflagCombatOver=true;
			//return false;
		}

	}

	checkEffects(); /// Possibly? Or called a bit too often? Naah, shouldn't matter....

	if (ad2460.combat.tempflagTurnOver==true && ad2460.combat.tempflagTurnOverHandeled==false){
		if (ad2460.combat.missiles.length==0 && ad2460.combat.effects.length==0){
			printWaitingLines();
		}
	}

	if (ad2460.combat.tempflagCombatOver==true){
		if (ad2460.combat.missiles.length==0){
			//finish_it();
		}
	}

	if (type==32){
		return "instant";
	}

	if (type==6){
		// Hack to introduce no lag between moving ships
		if (iRendered==false){
			return "instant";
		}
	}

}

function removeEmpEffects(){
	var i=0;
	for (i=0;i<ad2460.combat.attShips.length ;i++ ){
		ad2460.combat.attShips[i].frozen=0;
	}
	for (i=0;i<ad2460.combat.defShips.length ;i++ ){
		ad2460.combat.defShips[i].frozen=0;
	}
}

function printWaitingLines(){
	var l=0;
	for (l=0;l<waitingLines.length ;l++ ){
		addCombatLogMessage(waitingLines[l],true);
	}
	waitingLines=new Array;
	ad2460.combat.tempflagTurnOverHandeled=true;
	renderCombatShipIcons();
}

function finish_it(){
	clearInterval(ad2460.combatListener.timer);
	clearInterval(ad2460.combatListener.parseTimer);
	clearInterval(ad2460.combatListener.effectTimer);
	clearInterval(ad2460.combatListener.percentTimer);
	clearInterval(ad2460.combatListener.iconsTimer);


	ad2460.combat.effects=new Array;
	ad2460.combat.missiles=new Array;
	clearECanvas();
	$("#tactical_viewer").css('top','-345px');
	loadCombatSummary(ad2460.combatListener.view_id,'true');

	ad2460.combatListener.view_id=0;
	ad2460.combatListener.enabled=false;
	ad2460.combatListener.turn=-1;
	ad2460.combatListener.turnData=new Array;
	ad2460.combatListener.timerSpeed=6;
	ad2460.combatListener.timer=null;
	ad2460.combatListener.maxTurn=-1;
	ad2460.combatListener.eventParserTurn=0;
	ad2460.combatListener.lastParsedEvent=-1;

	ad2460.combat.tempflagCombatOver=false;
	ad2460.combat.tempflagCombatOver2=false;
	ad2460.combat.attacking_tactics={};
	ad2460.combat.defending_tactics={};
	ad2460.combat.waitingForSummary=0;

	lookup = {};

	/*
	if (ad2460.combat.restoreMusicVolume>-1){
		ad2460.audioVars.musicVolume=ad2460.combat.restoreMusicVolume;
	}
	if (ad2460.combat.restoreSfxVolume>-1){
		ad2460.audioVars.sfxVolume=ad2460.combat.restoreSfxVolume;
	}

	ad2460.combat.restoreMusicVolume=-1;
	ad2460.combat.restoreSfxVolume=-1;
	*/

	if (document.getElementById('combatmusic').paused==false){
		$("#combatmusic").animate({	volume: 0.0	} , 4000, function() {
			document.getElementById('combatmusic').currentTime = 0;
			document.getElementById('combatmusic').pause();
			document.getElementById('combatmusic').volume=ad2460.audioVars.combatmusicVolume;
		});
	}
}

function returnCombatFleetName(id){
	var a=0;
	for (a=0;a<ad2460.combat.attFleets.length ;a++ ){
		if (ad2460.combat.attFleets[a].fleetId==id)	{
			return ad2460.combat.attFleets[a].name;
		}
	}
	var a=0;
	for (a=0;a<ad2460.combat.defFleets.length ;a++ ){
		if (ad2460.combat.defFleets[a].fleetId==id)	{
			return ad2460.combat.defFleets[a].name;
		}
	}
	return "A fleet"; // Just in case

}

function addCombatLogMessage(string, override){
	if (specialPublicPlayer==true){
		//return;
	}


	if (override==true || ad2460.combat.showFullCombatText==true){
		var div=document.createElement('div');
		div.innerHTML=string;
		div.style.width='650px';
		div.style.position='relative';

		combatCommentaryContainer.appendChild(div);

		//document.getElementById('combat_commentary_container').appendChild(div);
		scrollChatToBottom();

	}
}

function resetCombatData(){
	clearInterval(ad2460.combatListener.timer);
	clearInterval(ad2460.combatListener.parseTimer);
	clearInterval(ad2460.combatListener.effectTimer);
	clearInterval(ad2460.combatListener.percentTimer);
	clearInterval(ad2460.combatListener.iconsTimer);
	ad2460.combatListener.view_id=0;
	ad2460.combatListener.enabled=false;
	ad2460.combatListener.turn=-1;
	ad2460.combatListener.turnData=new Array;
	ad2460.combatListener.timerSpeed=6;
	ad2460.combatListener.timer=null;
	ad2460.combatListener.maxTurn=-1;
	ad2460.combatListener.eventParserTurn=0;
	ad2460.combatListener.lastParsedEvent=-1;
	ad2460.combatListener.eventDelay=10;
	ad2460.combat.tempflagCombatOver=false;
	ad2460.combat.tempflagCombatOver2=false;
	ad2460.combat.tempflagTurnOver=false;
	ad2460.combat.tempflagTurnOverHandeled=false;
	ad2460.combatListener.parserInfo={};
	ad2460.combat.attacking_tactics={};
	ad2460.combat.defending_tactics={};

	removeChildNodes('combat_commentary_container');
	scrollChatToBottom();
	$("#tactical_viewer").css('top','-345px');
	clearCanvas();
	clearMCanvas();
	clearRightCanvas();
	clearRightMCanvas();
	clearECanvas();

	if(typeof specialPublicPlayer == 'undefined'){
		fetchMyFleets();
	}
}

function updateCombatShip(unique_id, fleet_id, combat_id, turn, ship_type_id, hullstrength, current_shield, relative_strength, combat_grid, pos_x, pos_y, can_move, current_target_1, current_target_2, current_target_3, current_angle,  active,  frozen, must_move_next_turn, special_effects, side){
	var shipArray=ad2460.combat.attShips;
	if (side=="Defender"){
		shipArray=ad2460.combat.defShips;
	}

	var i=0;
	var found=false;
	for (i=0;i<shipArray.length ;i++ ){
		if (shipArray[i].unique_id==unique_id){
			found=true;
			shipArray[i].turn=turn;
			shipArray[i].hullstrength=hullstrength;
			shipArray[i].current_shield=current_shield;
			shipArray[i].relative_strength=relative_strength;
			if (ad2460.combatListener.turn<1){
				// This is a problem....As we get positions for THE END of the turn...Which screws with the movement-events...
				// Maybe movement-events should not be generated, but an interpolation performed in stead based on "next-x next y" params...
				shipArray[i].combat_grid=combat_grid;
				shipArray[i].pos_x=pos_x;
				shipArray[i].pos_y=pos_y;
			}
			shipArray[i].frozen=frozen;
			return;
		}
	}
	if (found==false){
		shipArray.push(new combatShip(unique_id, fleet_id, combat_id, turn, ship_type_id, hullstrength, current_shield, relative_strength, combat_grid, pos_x, pos_y, can_move, current_target_1, current_target_2, current_target_3, current_angle,  active,  frozen, must_move_next_turn, special_effects, side));
	}
}

function shipTypeSort(a,b){
	if (a.ship_type_id < b.ship_type_id){
		return -1;
	}
	if (a.ship_type_id > b.ship_type_id){
		return 1;
	}
	return 0;
}

function strengthSort(a,b){
	if (a.relative_strength < b.relative_strength){
		return 1;
	}
	if (a.relative_strength > b.relative_strength){
		return -1;
	}
	return 0;
}

function updateLookup(){
	lookup={};

	var s=0;
	for (s=0;s<ad2460.combat.attShips.length ;s++ ){
		lookup[ad2460.combat.attShips[s].unique_id] = ad2460.combat.attShips[s];
	}
	for (s=0;s<ad2460.combat.defShips.length ;s++ ){
		lookup[ad2460.combat.defShips[s].unique_id] = ad2460.combat.defShips[s];
	}
}

function renderCombatShipIcons(){
	if (ad2460.combat.updateIcons!=true){
		return;
	}


	var container=document.getElementById('att_capitals_container');
	var i=0;

	ad2460.combat.updateIconsCounter++;
	//console.log("Rendering icons");

	var shipArray=ad2460.combat.attShips;
	shipArray.sort(shipTypeSort);

	var drawArray=new Array;

	for (i=0;i<shipArray.length ;i++ ){
		if (drawArray.length==0){
			drawArray.push({ship_type_id:shipArray[i].ship_type_id,count:0,relative_strength:shipArray[i].relative_strength});
			if (shipArray[i].hullstrength>0){
				drawArray[0].count++;
			}
		}
		else if (shipArray[i].ship_type_id==drawArray[drawArray.length-1].ship_type_id){
			if (shipArray[i].hullstrength>0){
				drawArray[drawArray.length-1].count++;
			}
		}
		else {
			drawArray.push({ship_type_id:shipArray[i].ship_type_id,count:0,relative_strength:shipArray[i].relative_strength});
			if (shipArray[i].hullstrength>0){
				drawArray[drawArray.length-1].count++;
			}

		}
	}

	drawArray.sort(strengthSort);
	drawCombatShipIcons('attackers',drawArray);

	shipArray=ad2460.combat.defShips;
	shipArray.sort(shipTypeSort);

	drawArray=new Array;

	for (i=0;i<shipArray.length ;i++ ){

		if (drawArray.length==0){
			drawArray.push({ship_type_id:shipArray[i].ship_type_id,count:0,relative_strength:shipArray[i].relative_strength});
			if (shipArray[i].hullstrength>0){
				drawArray[0].count++;
			}
		}
		else if (shipArray[i].ship_type_id==drawArray[drawArray.length-1].ship_type_id){
			if (shipArray[i].hullstrength>0){
				drawArray[drawArray.length-1].count++;
			}
		}
		else {
			drawArray.push({ship_type_id:shipArray[i].ship_type_id,count:0,relative_strength:shipArray[i].relative_strength});
			if (shipArray[i].hullstrength>0){
				drawArray[drawArray.length-1].count++;
			}

		}
	}

	drawArray.sort(strengthSort);

	drawCombatShipIcons('defenders',drawArray);

	$("#att_losses").html(''+ad2460.combat.att_losses);
	$("#att_kills").html(''+ad2460.combat.att_kills);
	$("#def_losses").html(''+ad2460.combat.def_losses);
	$("#def_kills").html(''+ad2460.combat.def_kills);

	ad2460.combat.updateIcons=false;

}

function drawCombatShipIcons(side,items){
	// few_ships normal_ships many_ships

	// start by counting each type to get some right classes
	var capitals_extra_class='normal_ships';
	var minors_extra_class='normal_ships';
	var pds_extra_class='normal_ships';

	var i=0;

	var c_counter=0;
	var m_counter=0;
	var p_counter=0;

	for (i=0;i<items.length ;i++ ){
		if (items[i].ship_type_id<=410){
			m_counter++;
		}
		else if (items[i].ship_type_id>=500){
			p_counter++;
		}
		else {
			c_counter++;
		}
	}

	if (c_counter<12){
		capitals_extra_class='few_ships';
	}
	if (c_counter>20){
		capitals_extra_class='many_ships';
	}

	if (m_counter<5){
		minors_extra_class='few_ships';
	}
	if (m_counter>10){
		minors_extra_class='many_ships';
	}

	if (p_counter<5){
		pds_extra_class='few_ships';
	}
	if (p_counter>10){
		pds_extra_class='many_ships';
	}

	var org_units;

	if (side=='attackers'){
		removeChildNodes('att_capitals_container');
		removeChildNodes('att_minors_container');
		org_units=ad2460.combat.attShips;
		$("#att_capitals_container").addClass(capitals_extra_class);
		$("#att_minors_container").addClass(minors_extra_class);

	}
	if (side=='defenders'){
		removeChildNodes('def_capitals_container');
		removeChildNodes('def_minors_container');
		removeChildNodes('def_defense_container');
		$("#def_capitals_container").addClass(capitals_extra_class);
		$("#def_minors_container").addClass(minors_extra_class);
		$("#def_defense_container").addClass(pds_extra_class);

		org_units=ad2460.combat.defShips;
	}

	var i=0;
	for (i=0;i<items.length ;i++ ){
		//console.log(items[i]);
		var outer=document.createElement('div');
		var outerClass='battle_capital_ship_entry';
		var thisExtraClass=capitals_extra_class;

		if (items[i].ship_type_id<=410){
			thisExtraClass=minors_extra_class;
			outerClass+=' fighter_entries '+thisExtraClass;
		}
		else if (items[i].ship_type_id>=500){
			thisExtraClass=pds_extra_class;
			outerClass+=' defense_entries '+thisExtraClass;
		}
		else {
			outerClass+=" "+thisExtraClass;
		}

		outer.setAttribute("class",outerClass);
		outer.setAttribute("id",side+"_ship_type_"+items[i].ship_type_id);

		if (ad2460.combat.selected_ship_side==side && ad2460.combat.selected_ship_type_id==items[i].ship_type_id){
			outer.setAttribute("class",outerClass+ ' ship_selected');
		}



		if(items[i].ship_type_id==432 || items[i].ship_type_id==433 || items[i].ship_type_id==435 || items[i].ship_type_id==436 ){
			outer.style.background='none';
			outer.style.backgroundColor='rgba(128,128,128,0.8)';

		}


		if (side=='attackers'){
			outer.setAttribute("onclick","showCombatShipInfoLeft("+items[i].ship_type_id+")");
		}
		if (side=='defenders'){
			outer.setAttribute("onclick","showCombatShipInfoRight("+items[i].ship_type_id+")");
		}


		var icon=document.createElement('div');

		icon.setAttribute("class","ship_battle_icon ship_"+items[i].ship_type_id+' '+thisExtraClass);

		if (side=='defenders'){
			icon.setAttribute("class","ship_battle_icon ship_"+items[i].ship_type_id+'_rev'+' '+thisExtraClass);
		}


		var count=document.createElement('div');
		count.setAttribute("class","capital_ship_count "+thisExtraClass);
		count.innerHTML=''+items[i].count;

		var lostThisType=0;
		var orgThisType=0;
		var tmp=0;
		for (tmp=0;tmp<org_units.length ;tmp++ ){
			if (org_units[tmp].ship_type_id==items[i].ship_type_id)	{
				orgThisType++;
			}
		}
		lostThisType=orgThisType-items[i].count;

		var lostcount=document.createElement('div');
		lostcount.setAttribute("class","capital_ship_count_lost "+thisExtraClass);
		lostcount.innerHTML=''+lostThisType;
		if (lostThisType<1){
			lostcount.style.display='none';
		}


		outer.appendChild(icon);
		outer.appendChild(lostcount);
		outer.appendChild(count);

		var parent;
		if (side=='attackers'){
			if (items[i].ship_type_id<=410){
				parent=document.getElementById('att_minors_container');
			}
			else{
				parent=document.getElementById('att_capitals_container');
			}

		}
		if (side=='defenders'){
			if (items[i].ship_type_id<=410){
				parent=document.getElementById('def_minors_container');
			}
			else if (items[i].ship_type_id>=500){
				parent=document.getElementById('def_defense_container');
			}
			else{
				parent=document.getElementById('def_capitals_container');
			}
		}


		parent.appendChild(outer);
	}
}

function returnCombatShipByUniqueId(id,side){
	if (lookup[id]!=null){
		return lookup[id];
	}
	else {
		return false;
	}


	if (side=='att'){
		var shipArray=ad2460.combat.attShips;
		for (var i=0;i<shipArray.length ;i++ ){
			if (id==shipArray[i].unique_id){
				return shipArray[i];
			}
		}
		var shipArray=ad2460.combat.defShips;
		for (var i=0;i<shipArray.length ;i++ ){
			if (id==shipArray[i].unique_id){
				return shipArray[i];
			}
		}

	}
	else if (side=='def'){
		var shipArray=ad2460.combat.defShips;
		for (var i=0;i<shipArray.length ;i++ ){
			if (id==shipArray[i].unique_id){
				return shipArray[i];
			}
		}
		var shipArray=ad2460.combat.attShips;
		for (var i=0;i<shipArray.length ;i++ ){
			if (id==shipArray[i].unique_id){
				return shipArray[i];
			}
		}
	}
	else {
		var shipArray=ad2460.combat.attShips;
		for (var i=0;i<shipArray.length ;i++ ){
			if (id==shipArray[i].unique_id){
				return shipArray[i];
			}
		}
		var shipArray=ad2460.combat.defShips;
		for (var i=0;i<shipArray.length ;i++ ){
			if (id==shipArray[i].unique_id){
				return shipArray[i];
			}
		}
	}

	return false;
}

function clearCanvas(){
	context.clearRect (0,0,700,700);
	//clearBufferCanvas();
}
function clearMCanvas(){
	mcontext.clearRect (0,0,700,700);
	//clearMinorCanvas();
}

function clearRightCanvas(){
	rightcontext.clearRect (0,0,700,700);
}
function clearRightMCanvas(){
	rightmcontext.clearRect (0,0,700,700);
}

function clearBufferCanvas(){
	bcontext.clearRect (0,0,700,700);
}
function clearECanvas(){
	econtext.clearRect (0,0,700,700);
}


function renderCombatFrame(rendertype, forced, side){

	// This will be replaced by different functions for minors and capitals methinks, or support parameter to determine what to do!

	var t1=new Date;

	var timeSinceLastDraw=t1-ad2460.combat.last_frame_render;

	if (forced!=true){
		if (timeSinceLastDraw<500 || (browser.mobile==true && timeSinceLastDraw<1000 )){
			return;
		}
	}


	if (side=='Attacker'){
		side='att';
	}
	if (side=='Defender'){
		side='def';
	}

	//console.log("renderCombatFrame", rendertype, forced, side);

	if(rendertype=='capital'){
		if (side=='att'){
			clearCanvas();
			renderShips(rendertype,side);
			attCapitalFrameRenderRequired=false;
		}
		else if (side=='def'){
			clearRightCanvas();
			renderShips(rendertype,side);
			defCapitalFrameRenderRequired=false;
		}
		else {
			clearCanvas();
			clearRightCanvas();
			capitalFrameRenderRequired=false;
			attCapitalFrameRenderRequired=false;
			defCapitalFrameRenderRequired=false;
			renderShips(rendertype,'both');
		}
	}
	else if(rendertype=='minor'){
		if (side=='att'){
			clearMCanvas();
			renderShips(rendertype, side);
			attMinorFrameRenderRequired=false;
		}
		else if (side=='def'){
			clearRightMCanvas();
			renderShips(rendertype, side);
			defMinorFrameRenderRequired=false;
		}
		else {
			clearMCanvas();
			clearRightMCanvas();
			renderShips(rendertype, 'both');
			attMinorFrameRenderRequired=false;
			defMinorFrameRenderRequired=false;
		}
	}
	else{

		// do both
		clearCanvas();
		clearRightCanvas();
		renderShips('capital','att');
		renderShips('capital','def');

		setTimeout(function(){clearMCanvas();clearRightMCanvas();renderShips('minor');},150);

		capitalFrameRenderRequired=false;
		minorFrameRenderRequired=false;

		attCapitalFrameRenderRequired=false;
		defCapitalFrameRenderRequired=false;
		attMinorFrameRenderRequired=false;
		defMinorFrameRenderRequired=false;
	}
	var t2=new Date;
	ad2460.combat.last_frame_render=t2;
	ad2460.combat.updatePercentages=true;

	setTimeout(function(){updateCombatPercentages();},150);

	//if (ad2460.user_id==1){
	//	var t3=t2-t1;
	//	waitingLines.push("Frame took "+t3+" ms");
	//}

}

function copyShipsToVisibleCanvas(){
	bcontext.drawImage(ecanvas, 0, 0);
}

function renderShips(shiptypes, side){
	// this time, we will try something different.
	// If we stumble upon gravity-wells, we will store them in a temp array, and render them afterwards.
	// Only applicable for capitals and all

	var gwells=new Array;

	var i=0;
	var renderCounter=0;
	if (side != 'att' && side != 'def' && side != 'both'){
		side='both';
	}
	//console.log("renderships called with "+shiptypes);



	if (shiptypes=='capital'){
		// Capital ships first!
		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.attShips.length ;i++ ){
				var thisShip=ad2460.combat.attShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass!='Fighter' && thisShip.vesselclass!='Corvette'){
						if (thisShip.ship_type_id==429){
							gwells.push(thisShip);
						}
						else {
							renderShip(thisShip);
							renderCounter++;
						}

					}
				}
			}

		}
		if (side=='def' || side=='both'){
			for (i=0;i<ad2460.combat.defShips.length ;i++ ){
				var thisShip=ad2460.combat.defShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass!='Fighter' && thisShip.vesselclass!='Corvette'){
						if (thisShip.ship_type_id==429){
							gwells.push(thisShip);
						}
						else {
							renderShip(thisShip);
							renderCounter++;
						}
					}
				}
				if (thisShip.active==0 && thisShip.ship_type_id==499){
					renderSpecialInactiveStation(thisShip);
				}

			}
		}
	}

	else if (shiptypes=='minor'){
		// And the minors!
		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.attShips.length ;i++ ){
				var thisShip=ad2460.combat.attShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass=='Fighter' || thisShip.vesselclass=='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}
		}
		if (side=='def' || side=='both'){
			for (i=0;i<ad2460.combat.defShips.length ;i++ ){
				var thisShip=ad2460.combat.defShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass=='Fighter' || thisShip.vesselclass=='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}
		}
	}

	else{
		// doing them all!
		// Capital ships first!
		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.attShips.length ;i++ ){
				var thisShip=ad2460.combat.attShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass!='Fighter' && thisShip.vesselclass!='Corvette'){
						if (thisShip.ship_type_id==429){
							gwells.push(thisShip);
						}
						else {
							renderShip(thisShip);
							renderCounter++;
						}
					}
				}
			}
		}

		if (side=='def' || side=='both'){
			for (i=0;i<ad2460.combat.defShips.length ;i++ ){
				var thisShip=ad2460.combat.defShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass!='Fighter' && thisShip.vesselclass!='Corvette'){
						if (thisShip.ship_type_id==429){
							gwells.push(thisShip);
						}
						else {
							renderShip(thisShip);
							renderCounter++;
						}
					}
				}
				if (thisShip.active==0 && thisShip.ship_type_id==499){
					renderSpecialInactiveStation(thisShip);
				}
			}
		}


		// And the minors!
		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.attShips.length ;i++ ){
				var thisShip=ad2460.combat.attShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass=='Fighter' || thisShip.vesselclass=='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}
		}

		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.defShips.length ;i++ ){
				var thisShip=ad2460.combat.defShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass=='Fighter' || thisShip.vesselclass=='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}
		}
	}

	for (i=0;i<gwells.length ;i++ ){
		var thisShip=gwells[i];
		if (thisShip.active==1 && thisShip.visible==1){
			renderShip(thisShip);
			renderCounter++;
		}
	}

	//console.log("Rendered "+renderCounter+ " ships");
	//copyShipsToVisibleCanvas();
}

function renderShipsPrevious(shiptypes, side){
	var i=0;
	var renderCounter=0;
	if (side != 'att' && side != 'def' && side != 'both'){
		side='both';
	}
	//console.log("renderships called with "+shiptypes);

	if (shiptypes=='capital'){
		// Capital ships first!
		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.attShips.length ;i++ ){
				var thisShip=ad2460.combat.attShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass!='Fighter' && thisShip.vesselclass!='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}

		}
		if (side=='def' || side=='both'){
			for (i=0;i<ad2460.combat.defShips.length ;i++ ){
				var thisShip=ad2460.combat.defShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass!='Fighter' && thisShip.vesselclass!='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
				if (thisShip.active==0 && thisShip.ship_type_id==499){
					renderSpecialInactiveStation(thisShip);
				}

			}
		}
	}

	else if (shiptypes=='minor'){
		// And the minors!
		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.attShips.length ;i++ ){
				var thisShip=ad2460.combat.attShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass=='Fighter' || thisShip.vesselclass=='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}
		}
		if (side=='def' || side=='both'){
			for (i=0;i<ad2460.combat.defShips.length ;i++ ){
				var thisShip=ad2460.combat.defShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass=='Fighter' || thisShip.vesselclass=='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}
		}
	}

	else{
		// doing them all!
		// Capital ships first!
		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.attShips.length ;i++ ){
				var thisShip=ad2460.combat.attShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass!='Fighter' && thisShip.vesselclass!='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}
		}

		if (side=='def' || side=='both'){
			for (i=0;i<ad2460.combat.defShips.length ;i++ ){
				var thisShip=ad2460.combat.defShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass!='Fighter' && thisShip.vesselclass!='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
				if (thisShip.active==0 && thisShip.ship_type_id==499){
					renderSpecialInactiveStation(thisShip);
				}
			}
		}


		// And the minors!
		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.attShips.length ;i++ ){
				var thisShip=ad2460.combat.attShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass=='Fighter' || thisShip.vesselclass=='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}
		}

		if (side=='att' || side=='both'){
			for (i=0;i<ad2460.combat.defShips.length ;i++ ){
				var thisShip=ad2460.combat.defShips[i];
				if (thisShip.active==1 && thisShip.visible==1){
					if (thisShip.vesselclass=='Fighter' || thisShip.vesselclass=='Corvette'){
						renderShip(thisShip);
						renderCounter++;
					}
				}
			}
		}
	}

	//console.log("Rendered "+renderCounter+ " ships");
	//copyShipsToVisibleCanvas();
}

function renderSpecialInactiveStation(ship){
	shipsRendered++;
	context.save();

	var radius=35;
	var shieldradius=70;
	var outputWidth=150;
	var outputHeight=150;

	context.globalAlpha = 0.4;

	context.drawImage(defShipImgLookup[ship.ship_type_id],ship.pos_x-(outputWidth/2),ship.pos_y-(outputHeight/2),outputWidth,outputHeight);

	context.restore();
}

function renderShip(ship){
	shipsRendered++;

	context.save();
	mcontext.save();
	rightcontext.save();
	rightmcontext.save();

	if (ship.vesselclass=='Fighter'){
		var thisCTX;
		if (ship.side=='Attacker'){
			thisCTX=mcontext;
		}
		else {
			thisCTX=rightmcontext;
		}
		thisCTX.translate(ship.pos_x, ship.pos_y);
		if (typeof ship.current_angle === "undefined") {
			ship.current_angle=0;
			if (ship.side=='Defender' ||ship.side=='def' ){
				ship.current_angle=3.14;
			}
		}
		if (browser.mobile==false){
			thisCTX.rotate(ship.current_angle);
		}

		thisCTX.beginPath();
		thisCTX.lineWidth = 1;
		if (ship.side=='Attacker'){
			thisCTX.moveTo(3, 0); // give the (x,y) coordinates
			thisCTX.lineTo(-3, 3);
			thisCTX.lineTo(-3, -3);
			thisCTX.lineTo(3, 0);

			thisCTX.strokeStyle = 'rgba(255,0,0,1.0)';
			if (colorblind==true){
				thisCTX.strokeStyle = 'rgba(0,255,255,1.0)';
			}
			if (ship.frozen==1){
				thisCTX.strokeStyle = 'rgba(128,128,128,0.9)';
			}
		}

		if (ship.side=='Defender'){
			if (browser.mobile==false){
				thisCTX.moveTo(3, 0); // give the (x,y) coordinates
				thisCTX.lineTo(-3, 3);
				thisCTX.lineTo(-3, -3);
				thisCTX.lineTo(3, 0);
			}
			else {
				thisCTX.moveTo(-3, 0); // give the (x,y) coordinates
				thisCTX.lineTo(3, 3);
				thisCTX.lineTo(3, -3);
				thisCTX.lineTo(-3, 0);
			}

			thisCTX.strokeStyle = 'rgba(0,255,0,1.0)';
			if (ship.frozen==1){
				thisCTX.strokeStyle = 'rgba(128,128,128,0.9)';
			}
		}
		thisCTX.stroke();
		thisCTX.closePath();
		thisCTX.restore();

		if (ad2460.combat.selected_ship==ship.unique_id){
			drawRange(thisCTX,ship);
		}


	}
	else if (ship.vesselclass=='Corvette'){
		var thisCTX;
		if (ship.side=='Attacker'){
			thisCTX=mcontext;
		}
		else {
			thisCTX=rightmcontext;
		}
		thisCTX.translate(ship.pos_x, ship.pos_y);
		if (typeof ship.current_angle === "undefined") {
			ship.current_angle=0;
			if (ship.side=='Defender' ||ship.side=='def' ){
				ship.current_angle=3.14;
			}
		}
		if (browser.mobile==false){
			thisCTX.rotate(ship.current_angle);
		}

		thisCTX.lineWidth = 1;

		if (ship.side=='Attacker'){
			thisCTX.strokeStyle = 'rgba(255,0,0,1.0)';
			if (colorblind==true){
				thisCTX.strokeStyle = 'rgba(0,255,255,1.0)';
			}
			if (ship.visible==0){
				thisCTX.strokeStyle = 'rgba(0,255,255,0.5)';
			}
		}
		if (ship.side=='Defender'){
			thisCTX.strokeStyle = 'rgba(0,255,0,1.0)';
		}
		if (ship.frozen==1){
			thisCTX.strokeStyle = 'rgba(128,128,128,0.9)';
		}
		if (ship.visible==0){
			thisCTX.strokeStyle = 'rgba(0,255,0,0.5)';
		}


		thisCTX.strokeRect(-3, -3, 7, 7);
		thisCTX.restore();
		if (ad2460.combat.selected_ship==ship.unique_id){
			drawRange(thisCTX,ship);
		}
	}
	else {
		// All other classes!!
		var thisCTX;
		if (ship.side=='Attacker'){
			thisCTX=context;
		}
		else {
			thisCTX=rightcontext;
		}

		var bgsize=29;
		//context.drawImage(bgCircleImage,ship.pos_x-15,ship.pos_y-15,30,30);
		if (extraFX==true && ship.frozen==0 && ship.vesseltype!='Utility' && (ad2460.combat.attShips.length+ad2460.combat.defShips.length<3000 ) ) {

			//context.save();
			//context.globalAlpha = 0.5;

			var selectedCircleImage=circleImageFrigate;
			if (ship.vesselclass=='Cruiser'){
				selectedCircleImage=circleImageCruiser;
				bgsize=31;
			}
			else if (ship.vesselclass=='Battleship'){
				selectedCircleImage=circleImageBattleship;
				bgsize=35;
			}
			else if (ship.vesselclass=='Carrier'){
				selectedCircleImage=circleImageCarrier;
				bgsize=35;
			}
			if (ship.vesseltype=='Utility'){
				selectedCircleImage=circleImageUtility;
			}
			if (ship.vesseltype=='Satelite'){
				selectedCircleImage=circleImagePDS;
			}

			if (ship.ship_type_id==429){
				selectedCircleImage=circleImageGwell;
			}

			if (ship.ship_type_id==499){
				bgsize=75;
			}


			if (ship.ship_type_id!=499){
				thisCTX.drawImage(selectedCircleImage,ship.pos_x-(bgsize/2),ship.pos_y-(bgsize/2),bgsize,bgsize);
			}
			//context.restore();
		}

		var radius=15;
		var shieldradius=25;
		var outputWidth=30;
		var outputHeight=30;


	//	if (ship.vesselclass=='Fighter'){		radius=3;		context.lineWidth=1;	shieldradius=0;}
	//	if (ship.vesselclass=='Corvette'){		radius=5;		context.lineWidth=1;	shieldradius=0;}
		if (ship.vesselclass=='Frigate'){		radius=10;		context.lineWidth=2;	shieldradius=22; outputWidth=25; outputHeight=25;}
		if (ship.vesselclass=='Cruiser'){		radius=14;		context.lineWidth=3;	shieldradius=25; outputWidth=30; outputHeight=30;}
		if (ship.vesselclass=='Battleship'){	radius=18;		context.lineWidth=4;	shieldradius=28; outputWidth=38; outputHeight=38;}
		if (ship.vesselclass=='Carrier'){		radius=18;		context.lineWidth=2;	shieldradius=28; outputWidth=36; outputHeight=36;}

		if (ship.ship_type_id==499){
			radius=35;	context.lineWidth=4;	shieldradius=70; outputWidth=150; outputHeight=150;
		}

		// Draw shield first!
		var shield_percentage=0;
		if (ship.max_shield>0){
			shield_percentage=ship.current_shield*100/ship.max_shield;

			var startAlpha=shield_percentage/200;
			var endAlpha=shield_percentage/1000;

			if (shield_percentage>0 || ship.frozen==1){
				var shieldAlpha=shield_percentage/100;
				drawShield(ship.pos_x, ship.pos_y,shieldradius, ship.shieldtype, shieldAlpha, ship.unique_id, ship.frozen, thisCTX);
			}
		}

		// The healthbar!
		if (ship.ship_type_id!=499)	{
			var healthradius=14;
			thisCTX.lineWidth = 3;
			var hull_percentage=ship.hullstrength*100/ship.max_hull;
			if (hull_percentage>100){
				hull_percentage=100;
			}

			if (hull_percentage<100){
				thisCTX.beginPath();
				var healthStartX=ship.pos_x-15;
				var healthEndX=Math.ceil(healthStartX+(hull_percentage/100*30));
				thisCTX.moveTo(healthStartX, ship.pos_y-15); // give the (x,y) coordinates
				thisCTX.lineTo(healthEndX, ship.pos_y-15);
				thisCTX.strokeStyle = 'rgba(255,204,0,1.00)';
				if (hull_percentage<33){
					thisCTX.strokeStyle = 'rgba(255,0,0,1.00)';
				}
				else if (hull_percentage<66){
					thisCTX.strokeStyle = 'rgba(255,204,0,0.80)';
				}
				else {
					thisCTX.strokeStyle = 'rgba(0,255,0,0.60)';
				}
				thisCTX.stroke();
				thisCTX.closePath();
			}
		}
		else {
			var healthradius=14;
			thisCTX.lineWidth = 7;
			var hull_percentage=ship.hullstrength*100/ship.max_hull;
			if (hull_percentage>100){
				hull_percentage=100;
			}

			if (hull_percentage<100){
				thisCTX.beginPath();
				var healthStartX=ship.pos_x-50;
				var healthEndX=Math.ceil(healthStartX+(hull_percentage/100*100));
				thisCTX.moveTo(healthStartX, ship.pos_y-75); // give the (x,y) coordinates
				thisCTX.lineTo(healthEndX, ship.pos_y-75);
				thisCTX.strokeStyle = 'rgba(255,204,0,1.00)';
				if (hull_percentage<33){
					thisCTX.strokeStyle = 'rgba(255,0,0,1.00)';
				}
				else if (hull_percentage<66){
					thisCTX.strokeStyle = 'rgba(255,204,0,0.80)';
				}
				else {
					thisCTX.strokeStyle = 'rgba(0,255,0,0.60)';
				}
				thisCTX.stroke();
				thisCTX.closePath();
			}
		}

		// And the ship itself!
		// now from the image-cache!
		if (ship.side=='Attacker'){
			thisCTX.drawImage(attShipImgLookup[ship.ship_type_id],ship.pos_x-(outputWidth/2),ship.pos_y-(outputHeight/2),outputWidth,outputHeight);
		}
		else {
			thisCTX.drawImage(defShipImgLookup[ship.ship_type_id],ship.pos_x-(outputWidth/2),ship.pos_y-(outputHeight/2),outputWidth,outputHeight);
		}

		// thisCTX.drawImage(ship.combatImage,ship.pos_x-(outputWidth/2),ship.pos_y-(outputHeight/2),outputWidth,outputHeight);

		if (ad2460.combat.selected_ship==ship.unique_id){
			drawRange(thisCTX,ship);
		}

	}
	context.restore();
	mcontext.restore();
	rightcontext.restore();
	rightmcontext.restore();
}

function rangeSort(a,b){
	return b.range - a.range;
}

function drawRange(context,ship){
	// try to draw the ranges
	var s=returnGameObjectById(ship.ship_type_id);
	if (s!=false){
		var p_range_bonus=0;
		var s_range_bonus=0;
		var t_range_bonus=0;

		if (ad2460.user_id>0){
			var o=returnGameObjectById(110);
			if (o.upgrading==0 && o.user_id>0){
				p_range_bonus+=2;
				s_range_bonus+=2;
				t_range_bonus+=2;
			}

			var o=returnGameObjectById(153);
			if (o.upgrading==0 && o.user_id>0 && ship.shieldtype=='Energy' && (ship.vesselclass=='Frigate' || ship.vesselclass=='Cruiser' || ship.vesselclass=='Battleship' || ship.vesselclass=='Carrier' ) ){
				p_range_bonus+=5;
				s_range_bonus+=5;
				t_range_bonus+=5;
			}

			var o=returnGameObjectById(173);
			if (o.upgrading==0 && o.user_id>0 && ship.shieldtype=='Displacement' && (ship.vesselclass=='Frigate' || ship.vesselclass=='Cruiser' || ship.vesselclass=='Battleship' || ship.vesselclass=='Carrier' ) ){
				p_range_bonus+=3;
				s_range_bonus+=3;
				t_range_bonus+=3;
			}

			var o=returnGameObjectById(839);
			if (o.points>0 && o.user_id>0 && ship.shieldtype=='Matter' && (ship.vesselclass=='Battleship' ) ){
				p_range_bonus+=o.points;
			}

			var o=returnGameObjectById(842);
			if (o.points>0 && o.user_id>0 && ship.shieldtype=='Energy' && (ship.vesselclass=='Frigate' ) ){
				p_range_bonus+=o.points;
			}

			var o=returnGameObjectById(845);
			if (o.points>0 && o.user_id>0 && ship.shieldtype=='Displacement' && (ship.vesselclass=='Cruiser' ) ){
				p_range_bonus+=o.points;
			}
		}

		var primary_range=s.primary_range+p_range_bonus;
		var secondary_range=s.secondary_range+s_range_bonus;
		var tertiary_range=s.tertiary_range+t_range_bonus;

		var startarc=0.8*Math.PI;
		var endarc=1.2*Math.PI;

		if(ship.side=='Attacker' ){
			startarc=1.8*Math.PI;
			endarc=0.2*Math.PI;
			cwise=false;
		}

		startarc=1.8*Math.PI;
		endarc=0.2*Math.PI;

		context.save();

		// completely different

		if (s.primary_guns==0){
			primary_range=0;
		}
		if (s.secondary_guns==0){
			secondary_range=0;
		}
		if (s.tertiary_guns==0){
			tertairy_range=0;
		}

		var fPrimary= 'rgba(255,0,0,0.04)';
		var fSecondary= 'rgba(0,0,255,0.04)';
		var fTertiary= 'rgba(0,255,0,0.04)';

		var sPrimary= 'rgba(255,64,64,0.40)';
		var sSecondary= 'rgba(64,64,255,0.40)';
		var sTertiary= 'rgba(64,255,64,0.40)';


		var rangeArray=new Array;
		rangeArray.push({range:primary_range*7,fill:fPrimary, stroke:sPrimary, guns:s.primary_guns});
		rangeArray.push({range:secondary_range*7,fill:fSecondary, stroke:sSecondary, guns:s.secondary_guns});
		rangeArray.push({range:tertiary_range*7,fill:fTertiary, stroke:sTertiary, guns:s.tertiary_guns});

		rangeArray.sort(rangeSort);

		context.lineWidth = 2;
		context.shadowBlur=10;
		context.shadowColor='rgba(255,255,255,1)';

		context.translate(ship.pos_x, ship.pos_y);
		context.rotate(ship.current_angle);

		if(rangeArray[0].guns>0){
			context.fillStyle = rangeArray[0].fill;
			context.strokeStyle = rangeArray[0].stroke;
			context.beginPath();
			context.moveTo(0,0);
			context.arc( 0, 0, rangeArray[0].range , startarc, endarc, false); // outer (filled)
			if(rangeArray[1].guns>0){
				context.arc( 0, 0, rangeArray[1].range , endarc, startarc, true); // inner (unfills it)
			}

			context.closePath();
			context.fill();
			context.stroke();
		}

		if(rangeArray[1].guns>0){
			context.fillStyle = rangeArray[1].fill;
			context.strokeStyle = rangeArray[1].stroke;
			context.beginPath();
			context.moveTo(0,0);
			context.arc( 0, 0, rangeArray[1].range , startarc, endarc, false); // outer (filled)
			if(rangeArray[2].guns>0){
				context.arc( 0, 0, rangeArray[2].range , endarc, startarc, true); // inner (unfills it)
			}
			context.closePath();
			context.fill();
			context.stroke();
		}
		if(rangeArray[2].guns>0){
			context.fillStyle = rangeArray[2].fill;
			context.strokeStyle = rangeArray[2].stroke;
			context.beginPath();
			context.moveTo(0,0);
			context.arc( 0, 0, rangeArray[2].range  , startarc, endarc, false); // outer (filled)
			context.closePath();
			context.fill();
			context.stroke();
		}

		context.restore();

	}
}

function drawShield(x,y,rad,type, alpha, id, frozen, thisCTX){
	var outputWidth=rad*2;
	var outputHeight=rad*2;

	// test
	// var context=bcontext;
	// And that should be it!

	thisCTX.save();

	var rnd=id % 360;

	var shieldImage;

	if (type=='Matter')	{
		shieldImage=intechShieldImg;
		if(frozen==1){
			shieldImage=empShieldImage;
			alpha=1.0;
		}
		thisCTX.globalAlpha = alpha;
		thisCTX.translate(x,y);
		if (ad2460.combat.attacking_capital_ships+ad2460.combat.defending_capital_ships<300){
			if (browser.mobile==false){
				thisCTX.rotate(rnd * (Math.PI/180));
			}
		}
		thisCTX.drawImage(shieldImage,0-rad,0-rad,outputWidth,outputWidth);
	}
	else if (type=='Energy'){
		shieldImage=strontechShieldImg;
		if(frozen==1){
			shieldImage=empShieldImage;
			alpha=1.0;
		}

		thisCTX.globalAlpha = alpha;
		thisCTX.translate(x,y);
		if (ad2460.combat.attacking_capital_ships+ad2460.combat.defending_capital_ships<300){
			if (browser.mobile==false){
				thisCTX.rotate(rnd * (Math.PI/180));
			}
		}
		thisCTX.drawImage(shieldImage,0-rad,0-rad,outputWidth,outputWidth);
	}
	else if (type=='Displacement'){
		shieldImage=neotechShieldImg;
		if(frozen==1){
			shieldImage=empShieldImage;
			alpha=1.0;
		}

		thisCTX.globalAlpha = alpha;
		thisCTX.translate(x,y);
		if (ad2460.combat.attacking_capital_ships+ad2460.combat.defending_capital_ships<300){
			if (browser.mobile==false){
				thisCTX.rotate(rnd * (Math.PI/180));
			}
		}
		thisCTX.drawImage(shieldImage,0-rad,0-rad,outputWidth,outputWidth);
	}
	thisCTX.restore();


}

/* thinking out loud here
The effect-canvas....
We could have an array of effect-objects.
Each object has a type explaining what it is
And an age, that determines when it's time to remove it
And clear the drawing-interval if there are no effects.
Check for effects on events
Events must be responsible for creating effects
*/

function checkEffects(){
	if (ad2460.combat.effects.length==0 && ad2460.combat.missiles.length==0){
		ad2460.combat.renderEffects=false;
	}
	else {
		ad2460.combat.renderEffects=true;
	}
}

var lastFXtime=0;

function renderEffects(){
	if (ad2460.combat.paused==true){
		return;
	}
	var d1=new Date;

	if (extraFX==true){
		bcontext.drawImage(ecanvas, 0, 0);
	}

	// Then the normal clearing
	clearECanvas();


	if (extraFX==true){
		econtext.save();
		econtext.globalAlpha = 0.5;
		econtext.drawImage(bcanvas,0,0);
		econtext.restore();
		clearBufferCanvas();
	}

	handleMissiles();
	cleanupMissiles();

	if (ad2460.combat.renderEffects==true){

		var i=ad2460.combat.effects.length;
		for (i=0;i<ad2460.combat.effects.length ;i++ ){
			// Going backwards to make it easier to delete one that is old enough ;)
			var thisEffect=ad2460.combat.effects[i];
			if (thisEffect.age>=thisEffect.duration){
				// wipe it!
				ad2460.combat.effects.splice(i,1);
				i--;
			}
			else{
				// Ok, render the shit!

				if (thisEffect.type=='defenderMagnet'){
					//var rnd=thisEffect.parent_ship_id % 360;
					//var alpha=(120-thisEffect.age)/100;
					var frameWidth=80;
					var frameHeight=80;
					var outputWidth=80;
					var outputHeight=80;

					var frameToDraw=Math.floor(thisEffect.age / 2);
					var startX=frameWidth*(frameToDraw);
					var startY=0;

					econtext.save();
					//econtext.globalAlpha = alpha;
					econtext.translate(thisEffect.x,thisEffect.y);
					//econtext.rotate(rnd * (Math.PI/180));
					econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, 0-(outputWidth/2), 0-(outputHeight/2),outputWidth,outputHeight);
					econtext.restore();

					thisEffect.age++;
					if (thisEffect.age>=31)	{
						var s=returnCombatShipByUniqueId(thisEffect.parent_ship_id);
						if (s!=false){
							s.magnetAnimPlaying=false;
						}
					}
				}

				if (thisEffect.type=='shieldhit'){
					var rad=0;
					//find the right frame-coords and paste it in!
					if (thisEffect.age>10){
						var rnd=thisEffect.parent_ship_id % 360;
						var alpha=(120-thisEffect.age)/100;


						if (thisEffect.parent_ship_vesselclass=='Frigate'){		rad=22;	}
						if (thisEffect.parent_ship_vesselclass=='Cruiser'){		rad=25;	}
						if (thisEffect.parent_ship_vesselclass=='Battleship'){	rad=28;	}
						if (thisEffect.parent_ship_vesselclass=='Carrier'){		rad=28;	}
						var outputWidth=rad*2;
						econtext.save();
						econtext.globalAlpha = alpha;
						econtext.translate(thisEffect.x,thisEffect.y);
						if (browser.mobile==false){
							econtext.rotate(rnd * (Math.PI/180));
						}
						econtext.drawImage(thisEffect.material,0-rad,0-rad,outputWidth,outputWidth);
						econtext.restore();
					}
					thisEffect.age++;
				}
				else if (thisEffect.type=='shieldhit2'){
					if (thisEffect.age>11){
						var rnd=(thisEffect.age*10+thisEffect.parent_ship_id) % 360;
						var alpha=(75-thisEffect.age)/100;

						var outputWidth=40;

						var frameWidth=100;
						var frameHeight=100;
						var outputWidth=60;
						var outputHeight=60;

						var frameToDraw=thisEffect.age % 7;
						var startX=frameWidth*(frameToDraw);
						var startY=0;

						econtext.save();
						econtext.globalAlpha = alpha;
						econtext.translate(thisEffect.x,thisEffect.y);
						if (browser.mobile==false){
							econtext.rotate(rnd * (Math.PI/180));
						}
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, 0-(outputWidth/2), 0-(outputHeight/2),outputWidth,outputHeight);
						econtext.restore();

					}
					thisEffect.age++;

				}


				else if (thisEffect.type=='particle1'){
					// must have x, y, dx, dy
					// type,duration,x,y,target_x,target_y,material,weapon,parent_ship_id, parent_ship_vesselclass
					if (thisEffect.age>10){
						var rnd=(thisEffect.parent_ship_id % 360)+thisEffect.age*5;
						var alpha=(90-thisEffect.age*1.5)/100;
						var outputWidth=32;

						var frameWidth=32;
						var frameHeight=32;
						var outputWidth=33-thisEffect.age;
						var outputHeight=33-thisEffect.age;


						var frameToDraw=thisEffect.age % 12;
						frameToDraw=0;

						var startX=frameWidth*(frameToDraw);
						var startY=0;

						thisEffect.x+=thisEffect.target_x;
						thisEffect.y+=thisEffect.target_y;
						econtext.save();
						econtext.globalAlpha = alpha;
						econtext.translate(thisEffect.x,thisEffect.y);
						econtext.rotate(rnd * (Math.PI/180));
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, 0-(outputWidth/2), 0-(outputHeight/2),outputWidth,outputHeight);
						econtext.restore();
					}
					thisEffect.age++;

				}

				else if (thisEffect.type=='explosion1'){
					//find the right frame-coords and paste it in!
					if (thisEffect.age>10){
						var frameWidth=134;
						var startX=frameWidth*(thisEffect.age-10);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, 134,134, thisEffect.x-(134/2), thisEffect.y-(134/2),134,134);
					}
					thisEffect.age++;
				}
				else if (thisEffect.type=='explosion5'){
					// 80 x 80 animation, 32 frames.
					//find the right frame-coords and paste it in!
					if (thisEffect.age>10){ // delayed 10 frames
						var frameWidth=80;
						var frameHeight=80;
						var outputWidth=100;
						var outputHeight=100;

						var startX=frameWidth*(thisEffect.age-10);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
				}
				else if (thisEffect.type=='instantexplosion5'){
					// 80 x 80 animation, 32 frames.
					//find the right frame-coords and paste it in!
					if (thisEffect.age>-1){ // not delayed
						var frameWidth=80;
						var frameHeight=80;
						var outputWidth=100;
						var outputHeight=100;

						var startX=frameWidth*(thisEffect.age-10);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
				}
				else if (thisEffect.type=='stationpush'){
					var s=0;
					var didSomething=false;
					for (s=0;s<ad2460.combat.attShips.length ;s++ ){
						//ad2460.combat.attShips[s].pos_x-=4;
						// they do have a current_angle we can invert and send them along that course
						var distanceToStation=calcDistance(thisEffect.x, thisEffect.y, ad2460.combat.attShips[s].pos_x, ad2460.combat.attShips[s].pos_y)
						//console.log(distanceToStation, thisEffect.age*4);
						if (distanceToStation<thisEffect.age*7){
							ad2460.combat.attShips[s].pushed_frames++;
							var speed=ad2460.combat.attShips[s].pushed_frames/6;
							if (speed>5){
								speed=5;
							}
							var pushangle=ad2460.combat.attShips[s].current_angle-Math.PI;
							ad2460.combat.attShips[s].pos_x += Math.cos(pushangle) * speed;
							ad2460.combat.attShips[s].pos_y += Math.sin(pushangle) * speed;
							didSomething=true;
						}
					}


					if (thisEffect.age==0){
						play_multi_sound('stationeffect');
					}
					if (thisEffect.age>=0){
						var frameWidth=300;
						var frameHeight=300;
						var outputWidth=thisEffect.age*12;
						var outputHeight=thisEffect.age*12;
						var outputWidth2=outputWidth-15;
						var outputHeight2=outputHeight-15;

						var frameToDraw=0;
						var startX=frameWidth*(frameToDraw);
						var startY=0;
						var alpha=1;
						econtext.save();

						//if (thisEffect.age>24){
						//	alpha=alpha-(0.15*(thisEffect.age-24));
						//	econtext.globalAlpha = alpha;
						//}

						econtext.translate(thisEffect.x,thisEffect.y);
						econtext.rotate(thisEffect.age*3* (Math.PI/180));
						//econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth, frameHeight, 0-(outputWidth/2), 0-(outputHeight/2),outputWidth,outputHeight);
						if (thisEffect.age>15){
							econtext.rotate(thisEffect.age*4* (Math.PI/180));
							econtext.drawImage(thisEffect.material,startX, startY, frameWidth, frameHeight, 0-(outputWidth2/2), 0-(outputHeight2/2),outputWidth2,outputHeight2);
						}
						econtext.restore();
					}


					if (didSomething==true)	{
						renderCombatFrame('all',true);
					}

					//capitalFrameRenderRequired=true;
					//minorFrameRenderRequired=true;

					thisEffect.age++;
				}
				else if (thisEffect.type=='blink'){
					// 16 x 16 animation, 5 frames.
					//find the right frame-coords and paste it in!
					if (thisEffect.age>-1){ // not delayed
						var frameWidth=16;
						var frameHeight=16;
						var outputWidth=16;
						var outputHeight=16;

						var frameToDraw=Math.floor((thisEffect.age) /2);
						var startX=frameWidth*(frameToDraw);
						var startY=0;
						//console.log("Blinking "+thisEffect.parent_ship_id, thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight );
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;

					if (thisEffect.age==9){
						// Blink the ship!
						var ship=returnCombatShipByUniqueId(thisEffect.parent_ship_id);
						if (ship!=false){
							ship.pos_x=thisEffect.target_x;
							ship.pos_y=thisEffect.target_y;
							ship.visible=1;
						}
					}
				}
				else if (thisEffect.type=='gravWellVanish'){
					if (thisEffect.age>-1){ // not delayed
						var frameWidth=16;
						var frameHeight=16;
						var outputWidth=64;
						var outputHeight=64;

						var frameToDraw=Math.floor((thisEffect.age) /3);
						var startX=frameWidth*(frameToDraw);
						var startY=0;
						//console.log("Blinking "+thisEffect.parent_ship_id, thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight );
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
				}
				else if (thisEffect.type=='gravWellAppear'){
					if (thisEffect.age>15){ // delayed
						var frameWidth=16;
						var frameHeight=16;
						var outputWidth=64;
						var outputHeight=64;

						var frameToDraw=Math.floor(5-(thisEffect.age-15)/3);
						var startX=frameWidth*(frameToDraw);
						var startY=0;
						//console.log("Appearing frame "+frameToDraw);
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
				}
				else if (thisEffect.type=='cloak'){
					// 16 x 16 animation, 5 frames.
					//find the right frame-coords and paste it in!
					if (thisEffect.age>-1){ // not delayed
						var frameWidth=16;
						var frameHeight=16;
						var outputWidth=16;
						var outputHeight=16;

						var frameToDraw=Math.floor((thisEffect.age) /2);
						var startX=frameWidth*(frameToDraw);
						var startY=0;
						//console.log("Blinking "+thisEffect.parent_ship_id, thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight );
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
				}

				else if (thisEffect.type=='gravitywellEffectAnimSingle'){

					// 150 x 150 animation, 10 frames.
					//find the right frame-coords and paste it in!
					if (thisEffect.age==0){
						play_multi_sound('gravityeffect');
					}

					if (thisEffect.age>=0){
						var frameWidth=140;
						var frameHeight=140;
						var outputWidth=60+thisEffect.age*3;
						var outputHeight=60+thisEffect.age*3;

						var frameToDraw=0;

						if (thisEffect.age>30){
							outputWidth=150-((thisEffect.age-30)*3);
							outputHeight=150-((thisEffect.age-30)*3);

						}

						//console.log("Rendering volHit Frame "+frameToDraw);
						var startX=frameWidth*(frameToDraw);
						var startY=0;
						var alpha=1;
						econtext.save();
						if (thisEffect.age>50){
							alpha=alpha-(0.10*(thisEffect.age-50));
							econtext.globalAlpha = alpha;

						}

						econtext.translate(thisEffect.x,thisEffect.y);
						econtext.rotate(thisEffect.age*3* (Math.PI/180));
						//econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth, frameHeight, 0-(outputWidth/2), 0-(outputHeight/2),outputWidth,outputHeight);
						econtext.restore();
					}
					thisEffect.age++;
				}


				else if (thisEffect.type=='protectorEmpAnimSingle'){

					// 150 x 150 animation, 10 frames.
					//find the right frame-coords and paste it in!
					if (thisEffect.age==0){
						play_multi_sound('empeffect');
					}

					if (thisEffect.age>=0){
						var frameWidth=140;
						var frameHeight=140;
						var outputWidth=60+thisEffect.age*13;
						var outputHeight=60+thisEffect.age*13;

						var outputWidth2=60+(thisEffect.age-15)*29;
						var outputHeight2=60+(thisEffect.age-15)*29;
						//var frameToDraw=Math.floor((thisEffect.age) % 10);
						var frameToDraw=0;

						//console.log("Rendering volHit Frame "+frameToDraw);
						var startX=frameWidth*(frameToDraw);
						var startY=0;
						var alpha=1;
						econtext.save();
						if (thisEffect.age>24){
							alpha=alpha-(0.15*(thisEffect.age-24));
							econtext.globalAlpha = alpha;

						}

						econtext.translate(thisEffect.x,thisEffect.y);
						econtext.rotate(thisEffect.age*3* (Math.PI/180));
						//econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth, frameHeight, 0-(outputWidth/2), 0-(outputHeight/2),outputWidth,outputHeight);
						if (thisEffect.age>15){
							econtext.drawImage(thisEffect.material,startX, startY, frameWidth, frameHeight, 0-(outputWidth2/2), 0-(outputHeight2/2),outputWidth2,outputHeight2);
						}
						econtext.restore();
					}
					thisEffect.age++;
				}

				else if (thisEffect.type=='volatilityhit'){
					// 80 x 80 animation, 15 frames.
					//find the right frame-coords and paste it in!
					if (thisEffect.age>=15){
						var frameWidth=80;
						var frameHeight=80;
						var outputWidth=80;
						var outputHeight=80;

						var frameToDraw=Math.floor((thisEffect.age-15) /2);
						//console.log("Rendering volHit Frame "+frameToDraw);
						var startX=frameWidth*(frameToDraw);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
				}



				// ad2460.combat.effects.push(new effect('ellipse',20,target.pos_x,target.pos_y,0,0,material,''));
				else if (thisEffect.type=='ellipse'){
					//console.log(thisEffect);
					if (thisEffect.age>5){
						if (thisEffect.material=='white'){
							thisEffect.color="rgba(255,255,255,"+thisEffect.alpha+")";
							thisEffect.width+=thisEffect.expandSpeed;
							thisEffect.height+=0.5;
							thisEffect.alpha=thisEffect.alpha*0.80;
							thisEffect.color="rgba(255,255,255,"+thisEffect.alpha+")";

						}
						else{
							thisEffect.color="rgba(128,128,255,"+thisEffect.alpha+")";
							thisEffect.width+=thisEffect.expandSpeed;
							thisEffect.height+=0.5;
							thisEffect.alpha=thisEffect.alpha*0.80;
							thisEffect.color="rgba(128,128,255,"+thisEffect.alpha+")";
						}

						econtext.save();
						//econtext.globalCompositeOperation = 'normal';
						//econtext.globalAlpha = Math.random() * this.alpha;
						econtext.translate(thisEffect.x,thisEffect.y);
						econtext.rotate(thisEffect.angle * (Math.PI/180));
						econtext.lineWidth=2;
						econtext.strokeStyle = thisEffect.color;
						econtext.beginPath();

						econtext.moveTo(0, 0 - thisEffect.height/2); // A1
						econtext.bezierCurveTo(
							0 + thisEffect.width/2, 0 - thisEffect.height/2, // C1
							0 + thisEffect.width/2, 0 + thisEffect.height/2, // C2
							0, 0 + thisEffect.height/2
						); // A2

						econtext.bezierCurveTo(
							0 - thisEffect.width/2, 0 + thisEffect.height/2, // C3
							0 - thisEffect.width/2, 0 - thisEffect.height/2, // C4
							0, 0 - thisEffect.height/2
						); // A1
						econtext.stroke();
						econtext.closePath();
						econtext.restore();
					}

					thisEffect.age++;
				}

				else if (thisEffect.type=='instantexplosion1'){
					//find the right frame-coords and paste it in!
					var frameWidth=134;
					var startX=frameWidth*(thisEffect.age+1);
					var startY=0;
					econtext.drawImage(thisEffect.material,startX, startY, 134,134, thisEffect.x-(134/2), thisEffect.y-(134/2),134,134);
					thisEffect.age++;
				}
				else if (thisEffect.type=='explosion2'){
					//find the right frame-coords and paste it in!
					if (thisEffect.age>10){
						var frameWidth=134;
						var startX=frameWidth*(thisEffect.age-10);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, 134,134, thisEffect.x-(50/2), thisEffect.y-(50/2),50,50);
					}
					thisEffect.age++;
				}
				else if (thisEffect.type=='explosion3'){
					//find the right frame-coords and paste it in!
					if (thisEffect.age>0){
						var frameWidth=256;
						var startX=frameWidth*(thisEffect.age);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, 256,128, thisEffect.x-(256/2), thisEffect.y-(128/2),256,128);
					}
					thisEffect.age++;
				}
				else if (thisEffect.type=='explosion4'){
					//find the right frame-coords and paste it in!
					if (thisEffect.age>0){
						var frameWidth=64;
						var startX=frameWidth*(thisEffect.age);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, 64,64, thisEffect.x-(64/2), thisEffect.y-(64/2),64,64);
					}
					thisEffect.age++;
				}

				else if (thisEffect.type=='shieldDrainOrigin'){
					//find the right frame-coords and paste it in!
					// uses material empImage
					var belongingShip=returnCombatShipByUniqueId(thisEffect.parent_ship_id);
					if (belongingShip!=false){
						if (belongingShip.hullstrength>0){
							if (thisEffect.age>-1 && thisEffect.age<=thisEffect.duration){
								var frameWidth=80;
								var frameHeight=80;
								var frameToDraw=Math.floor(thisEffect.age /2);
								var startX=frameWidth*(frameToDraw);
								var startY=0;
								var outputWidth=20;
								var outputHeight=20;
								if (thisEffect.parent_ship_vesselclass!=false){
									if (thisEffect.parent_ship_vesselclass=='Frigate'){
										outputWidth=50;
										outputHeight=50;
									}
									if (thisEffect.parent_ship_vesselclass=='Cruiser'){
										outputWidth=62;
										outputHeight=62;
									}
									if (thisEffect.parent_ship_vesselclass=='Carrier'){
										outputWidth=62;
										outputHeight=62;
									}
									if (thisEffect.parent_ship_vesselclass=='Battleship'){
										outputWidth=70;
										outputHeight=70;
									}
								}
								//econtext.save();
								//econtext.globalAlpha = 0.80;
								econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
								//econtext.drawImage(thisEffect.material,startX, startY, 100,100, thisEffect.x-(65/2), thisEffect.y-(65/2),65,65);
								//econtext.restore();
							}
						}
					}
					thisEffect.age++;
					if (thisEffect.age==thisEffect.duration-1){
						var t=returnCombatShipByUniqueId(thisEffect.parent_ship_id);
						if (t.active==1 && t.hullstrength>0){
							t.causing_shield_drain=false;
						}
					}
				}

				else if (thisEffect.type=='shieldDrain'){

					//find the right frame-coords and paste it in!
					if (thisEffect.age==15){
						play_multi_sound('shield_drain_effect');
					}

					if (thisEffect.age>15){
						var frameWidth=80;
						var frameHeight=80;
						var outputWidth=20;
						var outputHeight=20;
						if (thisEffect.parent_ship_vesselclass!=false){
							if (thisEffect.parent_ship_vesselclass=='Frigate'){
								outputWidth=50;
								outputHeight=50;
							}
							if (thisEffect.parent_ship_vesselclass=='Cruiser'){
								outputWidth=65;
								outputHeight=65;
							}
							if (thisEffect.parent_ship_vesselclass=='Carrier'){
								outputWidth=65;
								outputHeight=65;
							}
							if (thisEffect.parent_ship_vesselclass=='Battleship'){
								outputWidth=80;
								outputHeight=80;
							}
						}
						var startX=frameWidth*(thisEffect.age-15);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
					if (thisEffect.age>=44){
						var ship=returnCombatShipByUniqueId(thisEffect.parent_ship_id);
						if (ship!=false){
							ship.being_shield_drained=false;
						}

					}
				}

				else if (thisEffect.type=='shieldDrainInstant'){
					//find the right frame-coords and paste it in!
					if (thisEffect.age==0){
						//console.log("starting effect 9 on ship "+thisEffect.parent_ship_id);
					}
					var frameWidth=75;
					var frameHeight=75;
					var outputWidth=50;
					var outputHeight=50;
					if (thisEffect.parent_ship_vesselclass!=false){
						if (thisEffect.parent_ship_vesselclass=='Frigate'){
							outputWidth=44;
							outputHeight=44;
						}
						if (thisEffect.parent_ship_vesselclass=='Cruiser'){
							outputWidth=50;
							outputHeight=50;
						}
						if (thisEffect.parent_ship_vesselclass=='Carrier'){
							outputWidth=56;
							outputHeight=56;
						}
						if (thisEffect.parent_ship_vesselclass=='Battleship'){
							outputWidth=56;
							outputHeight=56;
						}
					}
					var startX=frameWidth*Math.floor(thisEffect.age/3);
					var startY=0;
					econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);

					thisEffect.age++;
					if (thisEffect.age>=44){
						var ship=returnCombatShipByUniqueId(thisEffect.parent_ship_id);
						if (ship!=false){
							ship.being_shield_drained=false;
						}

					}
				}

				else if (thisEffect.type=='minorEmpTarget'){
					//find the right frame-coords and paste it in!
					// gravityAmmoRangeTargetImage
					if (thisEffect.age>15){
						var frameWidth=80;
						var frameHeight=80;
						var outputWidth=16;
						var outputHeight=16;
						var startX=frameWidth*(thisEffect.age-15);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
				}

				else if (thisEffect.type=='volatility2'){
					//ad2460.combat.effects.push(new effect('volatility',30,ship.pos_x,ship.pos_y,volatility_radius,volatility_amount,'noMaterial',weapon,affected));
					var volRadius=parseInt(thisEffect.target_x);
					var volDamage=parseInt(thisEffect.target_y);

					if (thisEffect.age==0){
						//console.log("Handeling first frame of volatility-effect");
						play_multi_sound('volatility_explosion');
						// We now have the list of affected ships in the affected-stuff, whcih is found in thisEffect.parent_ship_vesselclass
						var affected=thisEffect.parent_ship_vesselclass.split(",");

						for (var i=0;i<affected.length ;i++ ){
							var ship=returnCombatShipByUniqueId(affected[i]);
							if (ship!=false &&  ship!=null){
								ad2460.combat.effects.push(new effect('volatilityhit',60,parseInt(dx),parseInt(dy),parseInt(dx),parseInt(dy),volatilityHitImage,thisEffect.weapon, false, false));
								ship.current_shield-=Math.floor(volDamage/2);
								if (ship.current_shield<0){
									ship.current_shield=0;
								}
								ship.hullstrength-=Math.floor(volDamage/2);
								if (ship.hullstrength<=0){
									ship.hullstrength=0;
									ship.die();
								}
							}
						}
					}

					if (thisEffect.age>=15){
						var frameWidth=80;
						var frameHeight=80;
						var outputWidth=volRadius*2;
						var outputHeight=volRadius*2;
						var startX=frameWidth*(thisEffect.age-15);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
				}

				else if (thisEffect.type=='volatility'){
					//ad2460.combat.effects.push(new effect('volatility',30,ship.pos_x,ship.pos_y,volatility_radius,volatility_amount,'noMaterial',weapon));
					var volRadius=parseInt(thisEffect.target_x);
					var volDamage=parseInt(thisEffect.target_y);

					if (thisEffect.age==0){
						//console.log("Handeling first frame of volatility-effect");
						// do shit like applying damage etc.
						// Half the amount to shield half to hull
						if (volRadius>0 && volDamage>0){
							// We have some splash-damage from volatility to give! Find all units close enough!
							var sx=parseInt(thisEffect.x);
							var sy=parseInt(thisEffect.y);

							var shipArray=ad2460.combat.attShips;
							for (var i=0;i<shipArray.length ;i++ ){
								if (shipArray[i].active>0){
									var dx=parseInt(shipArray[i].pos_x);
									var dy=parseInt(shipArray[i].pos_y);
									if ( calcDistance(sx, sy, dx, dy) <= volRadius ) {
										// add volatility hit effect here
										//console.log("Found att target affected by volatility: "+shipArray[i].unique_id);
										ad2460.combat.effects.push(new effect('volatilityhit',60,parseInt(dx),parseInt(dy),parseInt(dx),parseInt(dy),volatilityHitImage,thisEffect.weapon, false, false));

										shipArray[i].current_shield-=Math.floor(volDamage/2);
										if (shipArray[i].current_shield<0){
											shipArray[i].current_shield=0;
										}
										shipArray[i].hullstrength-=Math.floor(volDamage/2);
										if (shipArray[i].hullstrength<=0){
											shipArray[i].hullstrength=0;
											//console.log("It will die from this!");
											shipArray[i].die();
										}

									}
								}

							}
							var shipArray=ad2460.combat.defShips;
							for (var i=0;i<shipArray.length ;i++ ){
								if (shipArray[i].active>0){
									var dx=parseInt(shipArray[i].pos_x);
									var dy=parseInt(shipArray[i].pos_y);
									if ( calcDistance(sx, sy, dx, dy) <= volRadius ) {
										// add volatility hit effect here
										//console.log("Found def target affected by volatility: "+shipArray[i].unique_id);
										ad2460.combat.effects.push(new effect('volatilityhit',60,parseInt(dx),parseInt(dy),parseInt(dx),parseInt(dy),volatilityHitImage,thisEffect.weapon, false, false));

										shipArray[i].current_shield-=Math.floor(volDamage/2);
										if (shipArray[i].current_shield<0){
											shipArray[i].current_shield=0;
										}
										shipArray[i].hullstrength-=Math.floor(volDamage/2);
										if (shipArray[i].hullstrength<=0){
											shipArray[i].hullstrength=0;
											//console.log("It will die from this!");
											shipArray[i].die();

										}
									}
								}
							}
						}
					}

					if (thisEffect.age>=15){
						var frameWidth=80;
						var frameHeight=80;
						var outputWidth=volRadius*2;
						var outputHeight=volRadius*2;
						var startX=frameWidth*(thisEffect.age-15);
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, frameWidth,frameHeight, thisEffect.x-(outputWidth/2), thisEffect.y-(outputHeight/2),outputWidth,outputHeight);
					}
					thisEffect.age++;
				}

				else if (thisEffect.type=='emp'){
					//find the right frame-coords and paste it in!
					// uses material empImage
					var belongingShip=returnCombatShipByUniqueId(thisEffect.parent_ship_id);

					if (belongingShip!=false && belongingShip!=null){
						if(thisEffect.age==0){
							belongingShip.frozen=1;
							play_multi_sound('disable');
						}
						if (belongingShip.hullstrength>0){
							if (thisEffect.age>=30){
								var frameWidth=80;
								var frameToDraw=Math.floor((thisEffect.age-30) /2);

								var startX=frameWidth*(frameToDraw);
								var startY=0;
								var randomOpacity=Math.random()*0.40;
								//econtext.save();

								//econtext.globalAlpha = 0.30+randomOpacity;

								econtext.drawImage(thisEffect.material,startX, startY, 80,80, thisEffect.x-(80/2), thisEffect.y-(80/2),80,80);
								//econtext.drawImage(thisEffect.material,startX, startY, 100,100, thisEffect.x-(65/2), thisEffect.y-(65/2),65,65);
								//econtext.restore();
							}

						}
						if(thisEffect.age==0){
							renderCombatFrame('capital',true, belongingShip.side);
						}
					}
					thisEffect.age++;
				}



				//ad2460.combat.effects.push(new effect('shot',20,shooter.pos_x,shooter.pos_y,target.pox_x,target.pos_y,data_array[0]));
				else if (thisEffect.type=='shot' && thisEffect.weapon=='secondary'){
					// I want this to look more like a missile dammit!
					// Then the effect needs other values to consider, like direction and speed...And it needs to trigger a bang when at the target.
				}

				else if (thisEffect.type=='interceptionShot'){
					var startX=thisEffect.x;
					var startY=thisEffect.y;

					var endX=thisEffect.target_x;
					var endY=thisEffect.target_y;

					if (thisEffect.age==0){
						if (Math.random()*100<50){
							play_multi_sound('missile_down_01');
						}
						else {
							play_multi_sound('missile_down_02');
						}
					}

					var red=200; var green=200; var blue=255; var opacity=1;
					econtext.strokeStyle = 'rgba('+red+','+green+','+blue+','+opacity+')';
					econtext.lineWidth=1;
					econtext.beginPath();
					econtext.moveTo(startX,startY);
					econtext.lineTo(endX,endY);
					econtext.stroke();

					thisEffect.age++;
				}

				else if (thisEffect.type=='minorshot' && thisEffect.weapon=='primary' ){
					var startX=thisEffect.x;
					var startY=thisEffect.y;

					var endX=thisEffect.target_x;
					var endY=thisEffect.target_y;

					var red=255; var green=255; var blue=255; var opacity=1;
					if (thisEffect.material=='Attacker'){
						red=200; green=50; blue=50;
					}
					if (thisEffect.material=='Defender'){
						red=50; green=200; blue=50;
					}
					econtext.strokeStyle = 'rgba('+red+','+green+','+blue+','+opacity+')';
					econtext.lineWidth=1;
					econtext.beginPath();
					econtext.moveTo(startX,startY);
					econtext.lineTo(endX,endY);
					econtext.stroke();

					thisEffect.age++;

				}
				else if (thisEffect.type=='tertiaryshot' ){
					var startX=thisEffect.x;
					var startY=thisEffect.y;

					var endX=thisEffect.target_x;
					var endY=thisEffect.target_y;

					var red=255; var green=255; var blue=255; var opacity=1;

					if (thisEffect.material=='Attacker'){
						red=200; green=50; blue=50;
					}
					if (thisEffect.material=='Defender'){
						red=50; green=200; blue=50;
					}

					econtext.strokeStyle = 'rgba('+red+','+green+','+blue+','+opacity+')';
					econtext.lineWidth=1;
					econtext.beginPath();
					econtext.moveTo(startX,startY);
					econtext.lineTo(endX,endY);
					econtext.stroke();

					thisEffect.age++;

				}

				else if (thisEffect.type=='volker_shot'){
					var startX=thisEffect.x;
					var startY=thisEffect.y;

					var endX=thisEffect.target_x;
					var endY=thisEffect.target_y;

					var points=new Array;
					points.push({x:startX, y:startY});
					// split up the shot into 20 shorter lines

					var segments=20;

					var fullDistance=calcDistance(startX,startY,endX,endY);
					var segmentLength=fullDistance/(segments+1);

					for (var f=1;f<segments ;f++ ){
						var polarCoords=convertToPolar(endX,endY,startX,startY);
						polarCoords.r=segmentLength*f;
						var drawCoords=convertToCartesian(polarCoords.r,polarCoords.t);
						points.push({x:startX+drawCoords.x, y:startY+drawCoords.y});
					}

					// finally add the end-point!
					points.push({x:endX, y:endY});

					var red=130; var green=180; var blue=210;
					var opacity=1-((thisEffect.age-10)*0.10);
					econtext.strokeStyle = 'rgba('+red+','+green+','+blue+','+opacity+')';
					econtext.lineWidth=2;
					econtext.beginPath();
					econtext.moveTo(startX,startY);
					for (f=1;f<points.length ;f++ ){
						if (f<19){
							points[f].x+=(-3+Math.random()*6);
							points[f].y+=(-4+Math.random()*8);
						}
						econtext.lineTo(points[f].x,points[f].y);
					}
					econtext.stroke();

					var red=255; var green=255; var blue=255;
					var opacity=0.7-((thisEffect.age-10)*0.10);
					econtext.strokeStyle = 'rgba('+red+','+green+','+blue+','+opacity+')';
					econtext.lineWidth=1;
					econtext.beginPath();
					econtext.moveTo(startX,startY);
					for (f=1;f<points.length ;f++ ){
						if (f<19){
							points[f].x+=(-3+Math.random()*6);
							points[f].y+=(-4+Math.random()*8);
						}
						econtext.lineTo(points[f].x,points[f].y);
					}
					econtext.stroke();

					var red=255; var green=255; var blue=255;
					var opacity=0.7-((thisEffect.age-10)*0.10);
					econtext.strokeStyle = 'rgba('+red+','+green+','+blue+','+opacity+')';
					econtext.lineWidth=1;
					econtext.beginPath();
					econtext.moveTo(startX,startY);
					for (f=1;f<points.length ;f++ ){
						if (f<19){
							points[f].x+=(-3+Math.random()*6);
							points[f].y+=(-4+Math.random()*8);
						}
						econtext.lineTo(points[f].x,points[f].y);
					}
					econtext.stroke();

					if (thisEffect.age==0){
						play_multi_sound('volker_shot_01');
					}

					thisEffect.age++;
				}

				else if (thisEffect.type=='intechshot' && thisEffect.weapon=='primary'){
					// altering this one to be a shorter laser-pulse, looking more like a physical object than a beam
					// Lets try a fat line that simply moves towards it's target
					//
					var red=120;
					var green=160;
					var blue=13;
					var opacity=1;
					// the start, remember to move this!
					var startX=thisEffect.x;
					var startY=thisEffect.y;

					// temp end, for each frame
					var nowEndX;
					var nowEndY;

					// final end, does not change!
					var endX=thisEffect.target_x;
					var endY=thisEffect.target_y;

					var drawDistance=40;

					var distanceToTarget=calcDistance(startX,startY,endX,endY);
					if (distanceToTarget<drawDistance){
						drawDistance=distanceToTarget;
					}

					var polarCoords=convertToPolar(endX,endY,startX,startY);
					polarCoords.r=drawDistance;
					var drawCoords=convertToCartesian(polarCoords.r,polarCoords.t);

					nowEndX=startX+drawCoords.x;
					nowEndY=startY+drawCoords.y;

					econtext.strokeStyle = 'rgba('+red+','+green+','+blue+','+opacity+')';
					econtext.lineWidth=5;
					if (thisEffect.parent_ship_vesselclass=='Cruiser' || thisEffect.parent_ship_vesselclass=='Battleship' ){
						econtext.lineWidth=6;
					}
					if (thisEffect.parent_ship_vesselclass=='Carrier'){
						econtext.lineWidth=3;
					}

					// audio time
					var tmp=Math.random()*100;

					if (thisEffect.age==0){
						if (thisEffect.parent_ship_type_id==499){
							play_multi_sound('station_shot_01');
						}
						else if (thisEffect.parent_ship_vesselclass=='Cruiser' || thisEffect.parent_ship_vesselclass=='Battleship' ){
							if (tmp<25){
								play_multi_sound('beam_weapon_01');
							}
							else if (tmp<50){
								play_multi_sound('beam_weapon_02');
							}
							else if (tmp<75){
								play_multi_sound('beam_weapon_03');
							}
							else {
								play_multi_sound('beam_weapon_04');
							}
						}
						else {
							if (tmp<25){
								play_multi_sound('beam_weapon_01');
							}
							else if (tmp<50){
								play_multi_sound('beam_weapon_02');
							}
							else if (tmp<75){
								play_multi_sound('beam_weapon_03');
							}
							else {
								play_multi_sound('beam_weapon_04');
							}
						}
					}

					econtext.beginPath();
					econtext.moveTo(startX,startY);
					econtext.lineTo(nowEndX,nowEndY);
					econtext.stroke();

					// The white thing!
					//opacity-=0.20;
					econtext.strokeStyle = 'rgba(255,255,255,'+opacity+')';
					econtext.lineWidth=1;
					if (thisEffect.parent_ship_vesselclass=='Cruiser' || thisEffect.parent_ship_vesselclass=='Battleship' ){
						econtext.lineWidth=2;
					}
					econtext.beginPath();
					econtext.moveTo(startX,startY);
					econtext.lineTo(nowEndX,nowEndY);
					//econtext.quadraticCurveTo(qx, qy, endX,endY);
					econtext.stroke();
					thisEffect.age++;

					thisEffect.x=nowEndX;
					thisEffect.y=nowEndY;


				}

				else if (thisEffect.type=='shot' && thisEffect.weapon=='primary'){
					var startX=thisEffect.x;
					var startY=thisEffect.y;

					var endX=thisEffect.target_x;
					var endY=thisEffect.target_y;

					var halfwayCoords;
					var halfwayX=0;
					var halfwayY=0;

					if (thisEffect.age<10){
						// special handeling of the first 5 frames...
						// Maybe we can draw only a partial line, one 5th of the length per age-value...
						var fullDistance=calcDistance(startX,startY,endX,endY);
						var drawDistance=fullDistance/10*(thisEffect.age+1);

						var polarCoords=convertToPolar(endX,endY,startX,startY);
						polarCoords.r=drawDistance;
						var drawCoords=convertToCartesian(polarCoords.r,polarCoords.t);

						// Modyifying values based on the drawCoords
						endX=startX+drawCoords.x;
						endY=startY+drawCoords.y;
					}

					var red=255; var green=255; var blue=255; var opacity=1;
					if (thisEffect.material=='Matter'){
						red=120; green=160; blue=13;
					}
					if (thisEffect.material=='Energy'){
						red=130; green=180; blue=210;
					}
					if (thisEffect.material=='Displacement'){
						red=200; green=120; blue=200;
					}
					if (thisEffect.age>15){
						opacity=1-((thisEffect.age-10)*0.10);
					}

					// the coloured one
					econtext.strokeStyle = 'rgba('+red+','+green+','+blue+','+opacity+')';
					econtext.lineWidth=3;
					if (thisEffect.parent_ship_vesselclass=='Cruiser' || thisEffect.parent_ship_vesselclass=='Battleship' ){
						econtext.lineWidth=6;
					}
					if (thisEffect.parent_ship_vesselclass=='Carrier'){
						econtext.lineWidth=2;
					}
					if (thisEffect.weapon != 'primary')	{
						econtext.lineWidth=1;
					}
					var tmp=Math.random()*100;

					if (thisEffect.age==0){
						if (thisEffect.parent_ship_type_id==499){
							play_multi_sound('station_shot_01');
						}
						else if (thisEffect.parent_ship_vesselclass=='Cruiser' || thisEffect.parent_ship_vesselclass=='Battleship' ){
							if (tmp<25){
								play_multi_sound('beam_weapon_01');
							}
							else if (tmp<50){
								play_multi_sound('beam_weapon_02');
							}
							else if (tmp<75){
								play_multi_sound('beam_weapon_03');
							}
							else {
								play_multi_sound('beam_weapon_04');
							}
						}
						else {
							if (tmp<25){
								play_multi_sound('beam_weapon_01');
							}
							else if (tmp<50){
								play_multi_sound('beam_weapon_02');
							}
							else if (tmp<75){
								play_multi_sound('beam_weapon_03');
							}
							else {
								play_multi_sound('beam_weapon_04');
							}
						}
					}

					econtext.beginPath();
					econtext.moveTo(startX,startY);

					//econtext.quadraticCurveTo(qx, qy, endX, endY);
					econtext.lineTo(endX,endY);
					econtext.stroke();

					// The white thing!
					//opacity-=0.20;
					econtext.strokeStyle = 'rgba(255,255,255,'+opacity+')';
					econtext.lineWidth=1;
					if (thisEffect.parent_ship_vesselclass=='Cruiser' || thisEffect.parent_ship_vesselclass=='Battleship' ){
						econtext.lineWidth=2;
					}
					econtext.beginPath();
					econtext.moveTo(startX,startY);
					econtext.lineTo(endX,endY);
					//econtext.quadraticCurveTo(qx, qy, endX,endY);
					econtext.stroke();
					thisEffect.age++;
				}

				else if (thisEffect.type=='target_shot'){
					var startX=thisEffect.x;
					var startY=thisEffect.y;

					var endX=thisEffect.target_x;
					var endY=thisEffect.target_y;

					var halfwayCoords;
					var halfwayX=0;
					var halfwayY=0;

					// thisEffect.weapon=='primary'

					if (thisEffect.age<10){
						// special handeling of the first 5 frames...
						// Maybe we can draw only a partial line, one 5th of the length per age-value...
						var fullDistance=calcDistance(startX,startY,endX,endY);
						var drawDistance=fullDistance/10*(thisEffect.age+1);

						var polarCoords=convertToPolar(endX,endY,startX,startY);
						polarCoords.r=drawDistance;
						var drawCoords=convertToCartesian(polarCoords.r,polarCoords.t);

						// Modyifying values based on the drawCoords
						endX=startX+drawCoords.x;
						endY=startY+drawCoords.y;
					}

					var red=255; var green=255; var blue=255; var opacity=1;
					if (thisEffect.weapon=='primary'){
						red=255; green=50; blue=50;
					}
					if (thisEffect.weapon=='secondary'){
						red=50; green=255; blue=50;
					}
					if (thisEffect.weapon=='tertiary'){
						red=50; green=50; blue=255;
					}
					if (thisEffect.age>100){
						opacity=1-((thisEffect.age-10)*0.10);
					}

					// the coloured one
					econtext.strokeStyle = 'rgba('+red+','+green+','+blue+','+opacity+')';
					econtext.lineWidth=1;

					econtext.beginPath();
					econtext.arc(thisEffect.target_x, thisEffect.target_y, 15, 0, 2*Math.PI, false);
					econtext.stroke();


					var tmp=Math.random()*100;

					econtext.beginPath();
					econtext.moveTo(startX,startY);

					//econtext.quadraticCurveTo(qx, qy, endX, endY);
					econtext.lineTo(endX,endY);
					econtext.stroke();

					// The white thing!
					//opacity-=0.20;
					econtext.strokeStyle = 'rgba(255,255,255,'+opacity+')';
					econtext.lineWidth=1;
					econtext.beginPath();
					econtext.moveTo(startX,startY);
					econtext.lineTo(endX,endY);
					//econtext.quadraticCurveTo(qx, qy, endX,endY);
					econtext.stroke();



					thisEffect.age++;
				}

				//ad2460.combat.effects.push(new effect('smallexplosion1',20,target.pox_x,target.pos_y,0,0,explosionImage1));
				else if (thisEffect.type=='smallexplosion1'){
					//find the right frame-coords and paste it in!
					if (thisEffect.age==0){
						var tmp=Math.random()*100;
						if		(tmp<10){	play_multi_sound('missile_impact_01');	}
						else if (tmp<20){	play_multi_sound('missile_impact_02');	}
						else if (tmp<30){	play_multi_sound('missile_impact_03');	}
						else if (tmp<40){	play_multi_sound('missile_impact_04');	}
						else if (tmp<50){	play_multi_sound('missile_impact_05');	}
						else if (tmp<60){	play_multi_sound('missile_impact_06');	}
						else if (tmp<70){	play_multi_sound('missile_impact_07');	}
						else if (tmp<80){	play_multi_sound('missile_impact_08');	}
						else if (tmp<90){	play_multi_sound('missile_impact_09');	}
						else			{	play_multi_sound('missile_impact_10');	}
					}
					if (thisEffect.age>0){
						var frameWidth=134;
						var startX=frameWidth*thisEffect.age;
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, 134,134, thisEffect.x-(20/2), thisEffect.y-(20/2),20,20);
					}
					thisEffect.age++;
				}

				else if (thisEffect.type=='smallexplosion2'){
					//find the right frame-coords and paste it in!
					//if (thisEffect.age==0){
					//	play_multi_sound('sfx_explode1');
					//}

					if (thisEffect.age>0){
						var frameWidth=67;
						var startX=frameWidth*thisEffect.age;
						var startY=0;
						econtext.drawImage(thisEffect.material,startX, startY, 67,67, thisEffect.x-(10/2), thisEffect.y-(10/2),10,10);
					}
					thisEffect.age++;
				}

			}

		}
		//var d2=new Date;
		//var d=d2.getTime()-d1.getTime();
		//console.log(d);
	}
	var d2=new Date;
	var d=d2.getTime()-d1.getTime();
	if (d>highest_d){
		highest_d=d;
		//$("#att_playername").html(""+highest_d);
	}
	rendereffectsran++;
	if (attCapitalFrameRenderRequired==true && defCapitalFrameRenderRequired==true){
		renderCombatFrame('capital',false,'both');
	}
	else if (attCapitalFrameRenderRequired==true){
		renderCombatFrame('capital',false,'att');
	}
	else if (defCapitalFrameRenderRequired==true){
		renderCombatFrame('capital',false,'def');
	}


	if (attMinorFrameRenderRequired==true && defMinorFrameRenderRequired==true){
		renderCombatFrame('minor', false, 'both');
	}
	else if (attMinorFrameRenderRequired==true){
		renderCombatFrame('minor', false, 'att');
	}
	else if (defMinorFrameRenderRequired==true){
		renderCombatFrame('minor', false, 'def');
	}
}

function returnShipCountArray(ships){
	var shipArray=ships;
	shipArray.sort(shipTypeSort);

	var drawArray=new Array;

	for (i=0;i<shipArray.length ;i++ ){
		if (drawArray.length==0){
			drawArray.push({ship_type_id:shipArray[i].ship_type_id,count:0,relative_strength:shipArray[i].relative_strength});
			if (shipArray[i].hullstrength>0){
				drawArray[0].count++;
			}
		}
		else if (shipArray[i].ship_type_id==drawArray[drawArray.length-1].ship_type_id){
			if (shipArray[i].hullstrength>0){
				drawArray[drawArray.length-1].count++;
			}
		}
		else {
			drawArray.push({ship_type_id:shipArray[i].ship_type_id,count:0,relative_strength:shipArray[i].relative_strength});
			if (shipArray[i].hullstrength>0){
				drawArray[drawArray.length-1].count++;
			}

		}
	}

	drawArray.sort(strengthSort);

	return drawArray;
}

function runInitialBlindIntro(){
	if (ad2460.blind==true){

		var world_type_string="Homeworld";
		if (ad2460.combat.loadedLaunchData.location_planet_type==0){
			world_type_string="Mission";
		}
		else if (ad2460.combat.loadedLaunchData.location_planet_type<11){
			world_type_string="Homeworld";
		}
		else if (ad2460.combat.loadedLaunchData.location_planet_type==60){
			world_type_string="Station";
		}
		else if (ad2460.combat.loadedLaunchData.location_planet_type==70){
			world_type_string="Bank";
		}
		var introtext="";
		if (ad2460.combat.loadedLaunchData.mission_id<1){
			// player vs player combat
			introtext=ad2460.combat.loadedLaunchData.attacker_nickname + ' is attacking '+ad2460.combat.loadedLaunchData.defender_nickname+' at '+ad2460.combat.loadedLaunchData.location_name +'('+world_type_string+')';
		}
		else {
			var mission_name=returnMissionByMissionId(ad2460.combat.loadedLaunchData.mission_id).mission_name;
			introtext=ad2460.combat.loadedLaunchData.attacker_nickname + ' is attempting the combat mission '+mission_name+'.';
		}

		addCombatLogMessage(introtext, true);

		addCombatLogMessage("At the start of combat, the attacker has "+ad2460.combat.att_strength+" strength while the defender has "+ad2460.combat.def_strength+"." , true);

		var attShipsSummary=returnShipCountArray(ad2460.combat.attShips);
		var defShipsSummary=returnShipCountArray(ad2460.combat.defShips);

		var attShipsSummaryString="The attacker has the following units: ";

		for (var i=0;i<attShipsSummary.length ;i++ ){
			var unitName=returnGameObjectById(attShipsSummary[i].ship_type_id).name;
			var addition=""+attShipsSummary[i].count+" "+unitName;
			if (i<attShipsSummary.length-1){
				addition+=", ";
			}
			else {
				addition+=".";
			}
			attShipsSummaryString+=addition;
		}
		addCombatLogMessage(attShipsSummaryString, true);

		var defShipsSummaryString="The defender has the following units: ";

		for (var i=0;i<defShipsSummary.length ;i++ ){
			var unitName=returnGameObjectById(defShipsSummary[i].ship_type_id).name;
			var addition=""+defShipsSummary[i].count+" "+unitName;
			if (i<defShipsSummary.length-1){
				addition+=", ";
			}
			else {
				addition+=".";
			}
			defShipsSummaryString+=addition;
		}
		addCombatLogMessage(defShipsSummaryString, true);


		//console.log(ad2460.combat.attShips);
		//$("#att_commander_name").html(ad2460.combat.loadedLaunchData.attacking_commander_name);
		//var rankObj1=returnCommanderRankNameObject(ad2460.combat.loadedLaunchData.attacking_commander_rank);
		//$("#att_commander_rank").html(rankObj1.longRank);



	}
}


function showRoundSummary(turn){
	if (ad2460.combat.missiles.length>0){
		ad2460.combat.waitingForSummary=turn;
		return;
	}

	if (turn==0){
		// this is where we generate stuff for the blind?

	}

	if (turn>0){
		var data=roundSummaries[turn];
		if (ad2460.combat.showFullCombatText==false){

			var att_p_hit_percent=returnHitPercent(data.attackerPrimaryShots, data.attackerPrimaryHits);
			var att_s_hit_percent=returnHitPercent(data.attackerSecondaryShots, data.attackerSecondaryHits);
			var att_t_hit_percent=returnHitPercent(data.attackerTertiaryShots, data.attackerTertiaryHits);
			var att_m_hit_percent=returnHitPercent(data.attackerMinorPrimaryShots, data.attackerMinorPrimaryHits);

			var def_p_hit_percent=returnHitPercent(data.defenderPrimaryShots, data.defenderPrimaryHits);
			var def_s_hit_percent=returnHitPercent(data.defenderSecondaryShots, data.defenderSecondaryHits);
			var def_t_hit_percent=returnHitPercent(data.defenderTertiaryShots, data.defenderTertiaryHits);
			var def_m_hit_percent=returnHitPercent(data.defenderMinorPrimaryShots, data.defenderMinorPrimaryHits);

			var total_att_damage=data.attackerPrimaryDamageDealt+data.attackerSecondaryDamageDealt+data.attackerTertiaryDamageDealt;
			var total_def_damage=data.defenderPrimaryDamageDealt+data.defenderSecondaryDamageDealt+data.defenderTertiaryDamageDealt;



			if (data.attackerPrimaryShots > 0 || data.attackerSecondaryShots > 0 || data.attackerTertiaryShots > 0 || data.attackerMinorPrimaryShots>0 || data.attackerCapitalKills > 0 || data.defenderPrimaryShots > 0 || data.defenderSecondaryShots > 0 || data.defenderTertiaryShots > 0 || data.defenderMinorPrimaryShots > 0 || data.defenderCapitalKills > 0  ){

				if (ad2460.blind==true){
					addCombatLogMessage("In turn "+turn+", the attacker dealt a total of "+total_att_damage+" damage while the defender dealt "+total_def_damage+"." , true);
					if (data.attackerCapitalKills>0 || data.attackerMinorKills>0 || data.attackerPDSKills > 0){
						addCombatLogMessage("The attacker killed "+data.attackerCapitalKills+" capital ships, "+data.attackerMinorKills+" minor ships and "+data.attackerPDSKills+" defensive units." , true);
					}
					if (data.defenderCapitalKills>0 || data.defenderMinorKills>0){
						addCombatLogMessage("The defender killed "+data.defenderCapitalKills+" capital ships and "+data.defenderMinorKills+" minor ships." , true);
					}

					addCombatLogMessage("The attacker has "+ad2460.combat.att_strength+" strength while the defender has "+ad2460.combat.def_strength+"." , true);
					addCombatLogMessage("Capital ships: "+ad2460.combat.percentages.att_capitals_percent+"% versus "+ad2460.combat.percentages.def_capitals_percent+"%." , true);
					addCombatLogMessage("Firepower: "+ad2460.combat.percentages.att_firepower_percent+"% versus "+ad2460.combat.percentages.def_firepower_percent+"%." , true);
					addCombatLogMessage("Hull: "+ad2460.combat.percentages.att_hull_percent+"% versus "+ad2460.combat.percentages.def_hull_percent+"%." , true);
				}
				else {
					addCombatLogMessage("Turn "+turn+" <span class='"+att_class+"'>Attacker</span> fired "+data.attackerPrimaryShots+" primary shots of which "+data.attackerPrimaryHits+" hit their targets for a total of "+data.attackerPrimaryDamageDealt+" damage. ("+att_p_hit_percent+" %)",true);
					addCombatLogMessage("Turn "+turn+" <span class='"+att_class+"'>Attacker</span> fired "+data.attackerSecondaryShots+" secondary shots of which "+data.attackerSecondaryHits+" hit their targets for a total of "+data.attackerSecondaryDamageDealt+" damage. ("+att_s_hit_percent+" %)",true);
					addCombatLogMessage("Turn "+turn+" <span class='"+att_class+"'>Attacker</span> fired "+data.attackerTertiaryShots+" tertiary shots of which "+data.attackerTertiaryHits+" hit their targets for a total of "+data.attackerTertiaryDamageDealt+" damage. ("+att_t_hit_percent+" %)",true);
					addCombatLogMessage("Turn "+turn+" <span class='"+att_class+"'>Attacker</span> fired "+data.attackerMinorPrimaryShots+" minor primary shots of which "+data.attackerMinorPrimaryHits+" hit their targets for a total of "+data.attackerMinorPrimaryDamageDealt+" damage. ("+att_m_hit_percent+" %)",true);
					addCombatLogMessage("Turn "+turn+" <span class='"+att_class+"'>Attacker</span> killed "+data.attackerCapitalKills+" capital ships, "+data.attackerMinorKills+" minor ships and "+data.attackerPDSKills+" defensive units.",true);

					addCombatLogMessage("Turn "+turn+" <span class='combat_defender_text'>Defender</span> fired "+data.defenderPrimaryShots+" primary shots of which "+data.defenderPrimaryHits+" hit their targets for a total of "+data.defenderPrimaryDamageDealt+" damage. ("+def_p_hit_percent+" %)",true);
					addCombatLogMessage("Turn "+turn+" <span class='combat_defender_text'>Defender</span> fired "+data.defenderSecondaryShots+" secondary shots of which "+data.defenderSecondaryHits+" hit their targets for a total of "+data.defenderSecondaryDamageDealt+" damage. ("+def_s_hit_percent+" %)",true);
					addCombatLogMessage("Turn "+turn+" <span class='combat_defender_text'>Defender</span> fired "+data.defenderTertiaryShots+" tertiary shots of which "+data.defenderTertiaryHits+" hit their targets for a total of "+data.defenderTertiaryDamageDealt+" damage. ("+def_t_hit_percent+" %)",true);
					addCombatLogMessage("Turn "+turn+" <span class='combat_defender_text'>Defender</span> fired "+data.defenderMinorPrimaryShots+" minor primary shots of which "+data.defenderMinorPrimaryHits+" hit their targets for a total of "+data.defenderMinorPrimaryDamageDealt+" damage. ("+def_m_hit_percent+" %)",true);
					addCombatLogMessage("Turn "+turn+" <span class='combat_defender_text'>Defender</span> killed "+data.defenderCapitalKills+" capital ships and "+data.defenderMinorKills+" minor ships.",true);
				}
			}

			ad2460.combat.updatePercentagesCounter=0;
			ad2460.combat.updateIconsCounter=0;
		}
	}
}


function cleanupMissiles(){
	var i=0;
	for (i=0;i<ad2460.combat.missiles.length ;i++ ){
		if (ad2460.combat.missiles[i].age>530 || ad2460.combat.missiles[i].exploded==true){
			ad2460.combat.missiles.splice(i,1);
			i--;
		}
		else if (ad2460.combat.missiles[i].hit=="0" && ((ad2460.combat.missiles[i].x < -100 || ad2460.combat.missiles[i].x > 800 ) || ( ad2460.combat.missiles[i].y < -100 || ad2460.combat.missiles[i].y > 800 ) ) ) {
			ad2460.combat.missiles.splice(i,1);
			i--;
		}
	}

	if (ad2460.combat.tempflagTurnOver==true && ad2460.combat.tempflagTurnOverHandeled==false){
		if (ad2460.combat.missiles.length==0){
			if (ad2460.combat.waitingForSummary>0){
				showRoundSummary(ad2460.combat.waitingForSummary);
				ad2460.combat.waitingForSummary=0;
			}


			printWaitingLines();
			renderCombatFrame('all', true,'both');
		}
		else {
			//console.log('missiles exists');
		}
	}

	if (ad2460.combat.tempflagCombatOver==true && ad2460.combat.missiles.length==0 && ad2460.combatListener.enabled==true && ad2460.combat.effects.length==0){
		printWaitingLines();
		renderCombatFrame('all', true,'both');
		finish_it();
	}
}

function missile(x,y,target_x, target_y, hull_damage, shield_damage, material, target_ship_id, shooter_ship_id, hit, emp_effect_added, shield_splash_damage_amount, shield_splash_damage_radius, intercepted, intercept_x, intercept_y, interceptor_id, redirected, redirected_to_ship_id, target_side){
	this.hull_damage=hull_damage;
	this.shield_damage=shield_damage;
	this.target_x=target_x; // a target object
	this.target_y=target_y; // a target object
	this.x=x;
	this.y=y;
	this.material=material;
	this.hit=hit;

	this.target_side=target_side;

	this.prev_x=-1;
	this.prev_y=-1;

	this.prev_prev_x=-1;
	this.prev_prev_y=-1;


	this.emp_effect_added=emp_effect_added;
	this.shield_splash_damage_amount=shield_splash_damage_amount;
	this.shield_splash_damage_radius=shield_splash_damage_radius;

	this.target_ship_id=target_ship_id;
	this.shooter_ship_id=shooter_ship_id;

	this.intercepted=intercepted;
	this.intercept_x=Math.round(intercept_x);
	this.intercept_y=Math.round(intercept_y);
	this.interceptor_id=interceptor_id;

	this.redirected=redirected;
	this.redirected_to_ship_id=redirected_to_ship_id;

	this.distance=calcDistance(this.x,this.y,this.target_x, this.target_y);
	this.prev_distance=calcDistance(this.x,this.y,this.target_x, this.target_y);

	if (this.intercepted==1){
		//console.log("Creating intercepted-missile "+intercept_x+" "+intercept_y+" "+hit);
	}
	else {
		//console.log("Creating non-intercepted-missile"+target_x+" "+target_y+" "+hit);
	}

	this.target=returnCombatShipByUniqueId(target_ship_id, target_side);
	if (this.intercepted==1){
		this.interceptor=returnCombatShipByUniqueId(interceptor_id, target_side);
	}
	else {
		this.interceptor=false;
	}

	this.speed=1.50; // start-speed
	this.maxspeed=12;
	this.acceleration=0.30;
	this.turnspeed=0.20;

	this.age=0;
	this.exploded=false;

	// Initial direction of the missile, starting out 90 degrees in either direction relative to the fireing ship
	this.direction=0-(Math.PI/2);
	if (Math.random()*100<50){
		this.direction=0+(Math.PI/2);
	}

	// Set the initial wanted direction, the direction from the current position to the target!
	var deltaX = this.target_x - this.x;
	var deltaY = this.target_y - this.y;
	this.wanted_direction = Math.atan2(deltaY, deltaX);

	this.explode=function(){
		//createExplosion(this.centerX,this.centerY,'normal',0, 1);

		// And apply shield- and hull damage..
		if (this.hit==1){
			// It's a hit :)

			var this_side='att';
			if (this.target_side=='att'){
				this_side='def';
			}

			var shooter=returnCombatShipByUniqueId(this.shooter_ship_id, this_side);
			var target=returnCombatShipByUniqueId(this.target_ship_id, this.target_side);
			/*
			if (this.redirected_to_ship_id>0){
				console.log(this.redirected_to_ship_id);
				console.log(target);
			}
			*/

			ad2460.combat.effects.push(new effect('smallexplosion1',10,this.x,this.y,0,0,explosionImage1,'', target.unique_id, target.vesselclass));
			if (shooter!=false && target!=false && shooter!=null && target!=null){
				if (target.hullstrength>0 && target.active==1){
					target.hullstrength-=this.hull_damage;
					target.current_shield-=this.shield_damage;

					var target_class_string='combat_attacker_text';
					if (target.side=='Defender')	{
						target_class_string='combat_defender_text';
					}


					if (shooter.side=='Defender'){
						addCombatLogMessage("<span class='combat_defender_text'>"+shooter.name+"</span> hits <span class='"+target_class_string+"'>"+target.name+"</span> for "+this.hull_damage+" points (sec). (Shields hit for "+this.shield_damage+")");
					}
					else {
						addCombatLogMessage("<span class='"+att_class+"'>"+shooter.name+"</span> hits <span class='"+target_class_string+"'>"+target.name+"</span> for "+this.hull_damage+" points (sec). (Shields hit for "+this.shield_damage+")");
					}




					if (this.emp_effect_added==1){
						if (extraFX==true){
							ad2460.combat.effects.push(new effect('emp',70,this.x,this.y,this.x,this.y,empImage3,'secondary', target.unique_id, target.vesselclass));
						}
						//console.log('emp effect added...');
					}


					if (this.shield_splash_damage_amount>0 && this.shield_splash_damage_radius>0){
						// We have some splash-damage to give to shields! Find all units close enough!
						var sx=parseInt(this.target_x);
						var sy=parseInt(this.target_y);

						var shipArray=ad2460.combat.attShips;
						for (var i=0;i<shipArray.length ;i++ ){
							if (shipArray[i].active>0 && shipArray[i].current_shield>0 && shipArray[i].unique_id!=target.unique_id && shipArray[i].being_shield_drained==false ){
								var dx=parseInt(shipArray[i].pos_x);
								var dy=parseInt(shipArray[i].pos_y);
								if ( calcDistance(sx, sy, dx, dy) <= shield_splash_damage_radius ) {
									shipArray[i].current_shield-=shield_splash_damage_amount;
									// console.log("Draining "+shield_splash_damage_amount+" shields from Attacking ship "+shipArray[i].name);

									if (shipArray[i].current_shield<0){
										shipArray[i].current_shield=0;
									}
									if (shipArray[i].ship_type_id!=501 && shipArray[i].ship_type_id!=502 && shipArray[i].ship_type_id!=503){
										if (extraFX==true){
											ad2460.combat.effects.push(new effect('shieldDrain',45,dx,dy,dx,dy,gravityAmmoRangeTargetImage,'secondary',shipArray[i].unique_id,shipArray[i].vesselclass));
											shipArray[i].being_shield_drained=true;
										}
									}
								}
							}
							if (shipArray[i].active>0 && shipArray[i].current_shield>0 && shipArray[i].unique_id==target.unique_id && shipArray[i].causing_shield_drain==false){
								var dx=parseInt(shipArray[i].pos_x);
								var dy=parseInt(shipArray[i].pos_y);
								if (extraFX==true){
									ad2460.combat.effects.push(new effect('shieldDrainOrigin',62,dx,dy,dx,dy,gravityAmmoHitImage,'secondary',shipArray[i].unique_id,shipArray[i].vesselclass));
									shipArray[i].causing_shield_drain=true;
								}

							}
						}

						var shipArray=ad2460.combat.defShips;
						for (var i=0;i<shipArray.length ;i++ ){
							if (shipArray[i].active>0 && shipArray[i].current_shield>0  && shipArray[i].unique_id!=target.unique_id  && shipArray[i].being_shield_drained==false){
								var dx=parseInt(shipArray[i].pos_x);
								var dy=parseInt(shipArray[i].pos_y);
								if ( calcDistance(sx, sy, dx, dy) <= shield_splash_damage_radius ) {
									shipArray[i].current_shield-=shield_splash_damage_amount;
									//console.log("Draining "+shield_splash_damage_amount+" shields from Defending ship "+shipArray[i].name);
									if (shipArray[i].current_shield<0){
										shipArray[i].current_shield=0;
									}
									if (shipArray[i].ship_type_id!=501 && shipArray[i].ship_type_id!=502 && shipArray[i].ship_type_id!=503){
										if (extraFX==true){
											ad2460.combat.effects.push(new effect('shieldDrain',45,dx,dy,dx,dy,gravityAmmoRangeTargetImage,'secondary',shipArray[i].unique_id,shipArray[i].vesselclass));
											shipArray[i].being_shield_drained=true;
										}
									}
								}
							}
							if (shipArray[i].active>0 && shipArray[i].current_shield>0 && shipArray[i].unique_id==target.unique_id && shipArray[i].causing_shield_drain==false ){
								var dx=parseInt(shipArray[i].pos_x);
								var dy=parseInt(shipArray[i].pos_y);
								if (extraFX==true){
									ad2460.combat.effects.push(new effect('shieldDrainOrigin',62,dx,dy,dx,dy,gravityAmmoHitImage,'secondary',shipArray[i].unique_id,shipArray[i].vesselclass));
									shipArray[i].causing_shield_drain=true;
								}
							}
						}
					}




					if (target.hullstrength<=0){
						// NOW we kill the bastard!
						target.die();
					}

				}

			}
			//renderCombatFrame();
			if (target.vesselclass=='Fighter' || target.vesselclass=='Corvette'){
				if (this.target_side=='att'){
					attMinorFrameRenderRequired=true;
				}
				else {
					defMinorFrameRenderRequired=true;
				}
			}
			else {
				if (this.target_side=='att'){
					attCapitalFrameRenderRequired=true;
				}
				else {
					defCapitalFrameRenderRequired=true;
				}
			}
		}
		else {
			// missed or fizzled etc.
			ad2460.combat.effects.push(new effect('smallexplosion2',10,this.x,this.y,0,0,explosionImage2,'', this.target,false));
		}

		//this.target=null;
		this.exploded=true; // Will ensure a cleanup
	}

	this.move=function(){
		if (this.speed<this.maxspeed){
			this.speed+=this.acceleration;
			if (this.speed>this.maxspeed){
				this.speed=this.maxspeed;
			}
		}

		// speed set correctly!

		// Now set the direction
		var deltaX = this.target_x - this.x;
		var deltaY = this.target_y - this.y;
		this.wanted_direction = Math.atan2(deltaY, deltaX);

		this.prev_prev_x=this.prev_x;
		this.prev_prev_y=this.prev_y;

		this.prev_x=x;
		this.prev_y=y;

		this.prev_distance=calcDistance(this.x,this.y,this.target_x, this.target_y);

		// Actually...Cast 3 short rays
		// One turning left, one right, and one at the current heading.
		// calc the distance from each end-point to the wanted target position
		// and pick the one with the shortest distance!

		var startX=this.x;
		var startY=this.y;

		//var check_distance=25;
		var check_distance=25;

		if (this.hit==1 && this.prev_distance<75){
			this.direction=this.wanted_direction;
		}
		else {

			var direction=this.direction;
			var endX=startX + Math.cos(direction) * check_distance;
			var endY=startY + Math.sin(direction) * check_distance;
			var curDist=calcDistance(endX,endY, this.target_x, this.target_y);

			var direction=this.direction+this.turnspeed;
			var endX=startX + Math.cos(direction) * check_distance;
			var endY=startY + Math.sin(direction) * check_distance;
			var incDist=calcDistance(endX,endY, this.target_x, this.target_y);

			var direction=this.direction-this.turnspeed;
			var endX=startX + Math.cos(direction) * check_distance;
			var endY=startY + Math.sin(direction) * check_distance;
			var decDist=calcDistance(endX,endY, this.target_x, this.target_y);



			if ((this.hit==1) || this.age<20 ){
				if ( (curDist<incDist && curDist<decDist) || ( this.prev_distance<75) )	{
					// Use current direction

				}
				else if (incDist<curDist && incDist<decDist){
					this.direction+=this.turnspeed;

				}
				else {
					this.direction-=this.turnspeed;
				}
			}
		}

		if (this.age>80){
			this.turnspeed=this.turnspeed+0.03;
		}

		var startX=this.x;
		var startY=this.y;

		this.x += Math.cos(this.direction) * this.speed;
		this.y += Math.sin(this.direction) * this.speed;

		this.distance=calcDistance(this.x,this.y,this.target_x, this.target_y);

		if (this.prev_distance>150 && this.distance<=150 && this.redirected_to_ship_id>0 && this.redirected_to_ship_id!=this.target_ship_id){
			// time to switch targets!
			var newTarget=returnCombatShipByUniqueId(this.redirected_to_ship_id, this.target_side);
			if (newTarget!=false && newTarget!=null){
				this.target_ship_id=this.redirected_to_ship_id;
				this.target_x=newTarget.pos_x;
				this.target_y=newTarget.pos_y;
				this.distance=calcDistance(this.x,this.y,this.target_x, this.target_y);

				// add magnet effect here
				// defenderMagnet
				if (newTarget.magnetAnimPlaying==false)	{
					ad2460.combat.effects.push(new effect('defenderMagnet',32,this.target_x,this.target_y,0,0,defenderMagnet,'', newTarget.unique_id, newTarget.vesselclass));
					newTarget.magnetAnimPlaying=true;
				}

			}
		} // Hm, what if the distance was never above 150!

		else if (this.distance<=150 && this.redirected_to_ship_id>0 && this.redirected_to_ship_id!=this.target_ship_id){
			// time to switch targets!
			var newTarget=returnCombatShipByUniqueId(this.redirected_to_ship_id, this.target_side);
			if (newTarget!=false){
				this.target_ship_id=this.redirected_to_ship_id;
				this.target_x=newTarget.pos_x;
				this.target_y=newTarget.pos_y;
				this.distance=calcDistance(this.x,this.y,this.target_x, this.target_y);

				if (newTarget.magnetAnimPlaying==false)	{
					ad2460.combat.effects.push(new effect('defenderMagnet',32,this.target_x,this.target_y,0,0,defenderMagnet,'', newTarget.unique_id, newTarget.vesselclass));
					newTarget.magnetAnimPlaying=true;
				}
			}
		}


		var endX=this.x;
		var endY=this.y;

		// rather then drawing them one by one, lets put them into an array to draw later!
		missileDrawArray.push({startX:startX, startY:startY, endX:endX, endY:endY, material:this.material});


		// Now check for interception!
		if (this.intercepted==1 && this.age>10){
			var distToInterception=Math.sqrt( (this.x-this.intercept_x) * (this.x-this.intercept_x) + (this.y-this.intercept_y) * (this.y-this.intercept_y) );
			var prevdistToInterception=Math.sqrt( (this.prev_x-this.intercept_x) * (this.prev_x-this.intercept_x) + (this.prev_y-this.intercept_y) * (this.prev_y-this.intercept_y) );
			if (distToInterception<=55 || (this.age>5 && distToInterception>prevdistToInterception)){
				ad2460.combat.effects.push(new effect('interceptionShot',1,this.x,this.y,this.interceptor.pos_x,this.interceptor.pos_y, null ,'', false ,false));
				//console.log("Missile intercepted.");
				this.explode();
			}

		}

		// Now check for impact!
		if (this.intercepted!=1 && this.hit==1){
			var distToTarget=Math.sqrt( (this.x-this.target_x) * (this.x-this.target_x) + (this.y-this.target_y) * (this.y-this.target_y) );
			if (distToTarget<19 && this.age>7){
				this.explode();
			}
		}

		if (this.hit==0 && (this.x>705 || this.x<-5)){
			this.exploded=true; // it missed and has gone off-screen, force cleanup
		}
	}
}

function handleMissiles(){
	missileDrawArray=new Array;
	var d1=new Date().getTime();
	var i=0;
	for (i=0;i<ad2460.combat.missiles.length ;i++ ){
		thisMissile=ad2460.combat.missiles[i];
		thisMissile.age++;
		thisMissile.move();
	}
	var d2=new Date().getTime();
	var t1=d2-d1;
	if (t1>maxMissileTime){
		maxMissileTime=t1;
		//console.log(maxMissileTime);
	}

	econtext.lineWidth=2;

	for (i=0;i<missileDrawArray.length ;i++ ){
		econtext.strokeStyle = 'rgba(100,255,100,1.00)';
		econtext.beginPath();
		if (missileDrawArray[i].material=='Matter'){
			econtext.moveTo(missileDrawArray[i].startX, missileDrawArray[i].startY);
			econtext.lineTo(missileDrawArray[i].endX, missileDrawArray[i].endY);
		}
		econtext.stroke();
	}
	for (i=0;i<missileDrawArray.length ;i++ ){
		econtext.strokeStyle = 'rgba(100,100,255,1.00)';
		econtext.beginPath();
		if (missileDrawArray[i].material=='Energy'){
			econtext.moveTo(missileDrawArray[i].startX, missileDrawArray[i].startY);
			econtext.lineTo(missileDrawArray[i].endX, missileDrawArray[i].endY);
		}
		econtext.stroke();
	}
	for (i=0;i<missileDrawArray.length ;i++ ){
		econtext.strokeStyle = 'rgba(200,100,200,1.00)';
		econtext.beginPath();
		if (missileDrawArray[i].material=='Displacement'){
			econtext.moveTo(missileDrawArray[i].startX, missileDrawArray[i].startY);
			econtext.lineTo(missileDrawArray[i].endX, missileDrawArray[i].endY);
		}
		econtext.stroke();
	}
	for (i=0;i<missileDrawArray.length ;i++ ){
		econtext.strokeStyle = 'rgba(255,100,100,1.00)';
		econtext.beginPath();
		if (missileDrawArray[i].material!='Matter' && missileDrawArray[i].material!='Energy' && missileDrawArray[i].material!='Displacement'){
			econtext.moveTo(missileDrawArray[i].startX, missileDrawArray[i].startY);
			econtext.lineTo(missileDrawArray[i].endX, missileDrawArray[i].endY);
		}
		econtext.stroke();
	}
}

function showCombatShipInfoLeft(ship_type_id){
	if (ad2460.combat.ship_info_plate_left_open==ship_type_id){
		$('#ship_info_plate_left').stop().animate({left: '-114px'}, {duration: 500, complete: function(){$('#ship_info_plate_left').hide();}});
		//hideShipInfoLeft();
		ad2460.combat.ship_info_plate_left_open=0;
	}
	else {
		//$("#ship_info_plate_left").css({width:"0px"});
		var obj=returnGameObjectById(ship_type_id);
		if (obj!=false){
			$("#ship_info_plate_class_left").html(obj.vesselclass);
			var pri_firepower=obj.primary_guns*obj.primary_rateoffire*obj.primary_weaponstrength;
			var sec_firepower=obj.secondary_guns*obj.secondary_rateoffire*obj.secondary_weaponstrength;
			var ter_firepower=obj.tertiary_guns*obj.tertiary_rateoffire*obj.tertiary_weaponstrength;
			//var total_firepower=pri_firepower+sec_firepower+ter_firepower;
			var total_firepower=pri_firepower+sec_firepower;

			$("#ship_info_plate_firepower_left").html(prettyPrint(total_firepower));
			$("#ship_info_plate_shield_left").html(obj.shieldstrength);
			$("#ship_info_plate_hull_left").html(obj.hullstrength);
			$("#ship_info_plate_manoeuvre_left").html(obj.maneuverability);
			$("#ship_info_plate_name_left").html(obj.name);
			document.getElementById('ship_info_plate_image_left').src='images/icons/miniships/100x100/'+ship_type_id+'.png';
		}
		if (ad2460.combat.ship_info_plate_left_open==0)	{
			$('#ship_info_plate_left').css({left: '-114px', width: '312px'}).show().stop().animate({left: '250px'}, 500);
		}

		//showShipInfoLeft();
		ad2460.combat.ship_info_plate_left_open=ship_type_id;
	}
}

function showCombatShipInfoRight(ship_type_id){
	if (ad2460.combat.ship_info_plate_right_open==ship_type_id){
		$('#ship_info_plate_right').stop().animate({right: '100px'}, {duration: 500, complete: function(){$('#ship_info_plate_right').hide();}});
		//hideShipInfoRight();
		ad2460.combat.ship_info_plate_right_open=0;
	}
	else {
		//$("#ship_info_plate_right").css({width:"0px"});
		var obj=returnGameObjectById(ship_type_id);
		if (obj!=false){
			$("#ship_info_plate_class_right").html(obj.vesselclass);
			var pri_firepower=obj.primary_guns*obj.primary_rateoffire*obj.primary_weaponstrength;
			var sec_firepower=obj.secondary_guns*obj.secondary_rateoffire*obj.secondary_weaponstrength;
			var ter_firepower=obj.tertiary_guns*obj.tertiary_rateoffire*obj.tertiary_weaponstrength;
			//var total_firepower=pri_firepower+sec_firepower+ter_firepower;
			var total_firepower=pri_firepower+sec_firepower;

			$("#ship_info_plate_firepower_right").html(prettyPrint(total_firepower));
			$("#ship_info_plate_shield_right").html(obj.shieldstrength);
			$("#ship_info_plate_hull_right").html(obj.hullstrength);
			$("#ship_info_plate_manoeuvre_right").html(obj.maneuverability);
			$("#ship_info_plate_name_right").html(obj.name);
			document.getElementById('ship_info_plate_image_right').src='images/icons/miniships/100x100/'+ship_type_id+'_rev.png';
		}

		//showShipInfoRight();
		if (ad2460.combat.ship_info_plate_right_open==0){
			$('#ship_info_plate_right').css({left: 'auto', right: '100px', width: '312px'}).show().stop().animate({right: '413px'}, 500);
		}

		ad2460.combat.ship_info_plate_right_open=ship_type_id;
	}
}

function hideCombatShipPanel(elm){
	if (elm){
		if (elm.id=='ship_info_plate_left'){
			$('#ship_info_plate_left').stop().animate({left: '-114px'}, {duration: 500, complete: function(){$('#ship_info_plate_left').hide();}});
			ad2460.combat.ship_info_plate_left_open=0;
		}
		if (elm.id=='ship_info_plate_right'){
			$('#ship_info_plate_right').stop().animate({right: '-114px'}, {duration: 500, complete: function(){$('#ship_info_plate_right').hide();}});
			ad2460.combat.ship_info_plate_right_open=0;
		}

	}
}

function renderTacticalData(){
	if (ad2460.combat.attacking_tactics){
		var attacking_tactics=ad2460.combat.attacking_tactics;
		var defending_tactics=ad2460.combat.defending_tactics;

		// We have the data
		// Clean out all selected-classes
		// then look at the data and mark the right ones selected again.


		document.getElementById('combat_att_tactics_target_priority').innerHTML=attacking_tactics.target_priority.capitalize();
		document.getElementById('combat_att_tactics_target_switching').innerHTML=attacking_tactics.target_switching.capitalize();
		document.getElementById('combat_att_tactics_fighter_priority').innerHTML=attacking_tactics.fighter_priority.capitalize();
		document.getElementById('combat_att_tactics_corvette_priority').innerHTML=attacking_tactics.corvette_priority.capitalize();
		document.getElementById('combat_att_tactics_retreat_percent').innerHTML="At "+attacking_tactics.retreat_percentage+' %';
		document.getElementById('combat_att_tactics_retreat_type').innerHTML=attacking_tactics.retreat_type.capitalize();
		document.getElementById('combat_att_tactics_retreat_if_unwinnable').innerHTML=attacking_tactics.retreat_if_unwinnable.capitalize();
		if (attacking_tactics.retreat_if_even=='no'){
			document.getElementById('combat_att_tactics_retreat_if_even_losses').innerHTML='Stay and Fight';
		}
		if (attacking_tactics.retreat_if_even=='yes'){
			document.getElementById('combat_att_tactics_retreat_if_even_losses').innerHTML='Retreat anyway';
		}
		if (attacking_tactics.retreat_if_even=='unknown'){
			document.getElementById('combat_att_tactics_retreat_if_even_losses').innerHTML='Unknown';
		}

		document.getElementById('combat_def_tactics_target_priority').innerHTML=defending_tactics.target_priority.capitalize();
		document.getElementById('combat_def_tactics_target_switching').innerHTML=defending_tactics.target_switching.capitalize();
		document.getElementById('combat_def_tactics_fighter_priority').innerHTML=defending_tactics.fighter_priority.capitalize();
		document.getElementById('combat_def_tactics_corvette_priority').innerHTML=defending_tactics.corvette_priority.capitalize();
		document.getElementById('combat_def_tactics_retreat_percent').innerHTML="At "+defending_tactics.retreat_percentage+' %';
		document.getElementById('combat_def_tactics_retreat_type').innerHTML=defending_tactics.retreat_type.capitalize();
		document.getElementById('combat_def_tactics_retreat_if_unwinnable').innerHTML=defending_tactics.retreat_if_unwinnable.capitalize();
		if (defending_tactics.retreat_if_even=='no'){
			document.getElementById('combat_def_tactics_retreat_if_even_losses').innerHTML='Stay and fight';
		}
		if (defending_tactics.retreat_if_even=='yes'){
			document.getElementById('combat_def_tactics_retreat_if_even_losses').innerHTML='Retreat anyway';
		}
		if (defending_tactics.retreat_if_even=='unknown'){
			document.getElementById('combat_def_tactics_retreat_if_even_losses').innerHTML='Unknown';
		}


	}
}

function toggleCombatTacticsViewer(){
	var curTop=parseInt($("#tactical_viewer").css('top'));

	if (curTop<-200){
		$("#tactical_viewer").css('top','0px');
	}
	else {
		$("#tactical_viewer").css('top','-345px');
	}


}

function combatLoadTest(){
	var a=new Date;
	var x=0;
	for (x=0;x<60 ;x++ ){
		renderCombatFrame();
	}
	var b=new Date;
	var c=b.getTime()-a.getTime();
	console.log("60 renderings took "+c+" milliseconds");
}

function handleCombatCanvasClick(e){

	var x;
	var y;
	if (e.offsetX){
		x=e.offsetX;
		y=e.offsetY;
	}
	else if (e.layerX){
		x=e.layerX;
		y=e.layerY;
	}

	// supporting zoom
	x=Math.round(x/testx);
	x=Math.round(x/testy);
	y=Math.round(y/testx);
	y=Math.round(y/testy);



	$("#battle_container .battle_capital_ship_entry").removeClass("ship_selected");

	var i=0;
	for (i=0;i<ad2460.combat.attShips.length ;i++ ){
		if (ad2460.combat.attShips[i].active==1){
			if (ad2460.combat.attShips[i].pos_x>=x-3 && ad2460.combat.attShips[i].pos_x<=x+3 && ad2460.combat.attShips[i].pos_y>=y-3 && ad2460.combat.attShips[i].pos_y<=y+3){
				$("#attackers_ship_type_"+ad2460.combat.attShips[i].ship_type_id).addClass("ship_selected");
				ad2460.combat.selected_ship=ad2460.combat.attShips[i].unique_id;
				ad2460.combat.selected_ship_type_id=ad2460.combat.attShips[i].ship_type_id;
				ad2460.combat.selected_ship_side='attackers';
				$("#attackers_ship_type_"+ad2460.combat.attShips[i].ship_type_id).fadeOut(300).fadeIn(300);
				renderCombatFrame('all',true,'att');
				return;
			}
		}
	}
	for (i=0;i<ad2460.combat.defShips.length ;i++ ){
		if (ad2460.combat.defShips[i].active==1){
			if (ad2460.combat.defShips[i].pos_x>=x-3 && ad2460.combat.defShips[i].pos_x<=x+3 && ad2460.combat.defShips[i].pos_y>=y-3 && ad2460.combat.defShips[i].pos_y<=y+3){
				$("#defenders_ship_type_"+ad2460.combat.defShips[i].ship_type_id).addClass("ship_selected");
				ad2460.combat.selected_ship=ad2460.combat.defShips[i].unique_id;
				ad2460.combat.selected_ship_type_id=ad2460.combat.defShips[i].ship_type_id;
				ad2460.combat.selected_ship_side='defenders';
				$("#defenders_ship_type_"+ad2460.combat.defShips[i].ship_type_id).fadeOut(300).fadeIn(300);
				renderCombatFrame('all',true,'def');
				return;
			}
		}
	}

	for (i=0;i<ad2460.combat.attShips.length ;i++ ){
		if (ad2460.combat.attShips[i].active==1){
			if (ad2460.combat.attShips[i].pos_x>=x-5 && ad2460.combat.attShips[i].pos_x<=x+5 && ad2460.combat.attShips[i].pos_y>=y-5 && ad2460.combat.attShips[i].pos_y<=y+5){
				$("#attackers_ship_type_"+ad2460.combat.attShips[i].ship_type_id).addClass("ship_selected");
				ad2460.combat.selected_ship=ad2460.combat.attShips[i].unique_id;
				ad2460.combat.selected_ship_type_id=ad2460.combat.attShips[i].ship_type_id;
				ad2460.combat.selected_ship_side='attackers';
				$("#attackers_ship_type_"+ad2460.combat.attShips[i].ship_type_id).fadeOut(300).fadeIn(300);
				renderCombatFrame('all',true,'att');
				return;
			}
		}
	}
	for (i=0;i<ad2460.combat.defShips.length ;i++ ){
		if (ad2460.combat.defShips[i].active==1){
			if (ad2460.combat.defShips[i].pos_x>=x-5 && ad2460.combat.defShips[i].pos_x<=x+5 && ad2460.combat.defShips[i].pos_y>=y-5 && ad2460.combat.defShips[i].pos_y<=y+5){
				$("#defenders_ship_type_"+ad2460.combat.defShips[i].ship_type_id).addClass("ship_selected");
				ad2460.combat.selected_ship=ad2460.combat.defShips[i].unique_id;
				ad2460.combat.selected_ship_type_id=ad2460.combat.defShips[i].ship_type_id;
				ad2460.combat.selected_ship_side='defenders';
				$("#defenders_ship_type_"+ad2460.combat.defShips[i].ship_type_id).fadeOut(300).fadeIn(300);
				renderCombatFrame('all',true,'def');
				return;
			}
		}
	}

	ad2460.combat.selected_ship=0;
	ad2460.combat.selected_ship_type_id=0;

	$("#battle_container .battle_capital_ship_entry").removeClass("ship_selected");
	renderCombatFrame('all',true,'both');
}

$(function() {
	// .ready() called

	canvas=document.getElementById('combatcanvas');
	context = canvas.getContext("2d");
	canvas.setAttribute('width', 700);
	canvas.setAttribute('height', 700);

	mcanvas=document.getElementById('minorcanvas');
	mcontext = mcanvas.getContext("2d");
	mcanvas.setAttribute('width', 700);
	mcanvas.setAttribute('height', 700);

	rightcanvas=document.getElementById('rightcombatcanvas');
	rightcontext = rightcanvas.getContext("2d");
	rightcanvas.setAttribute('width', 700);
	rightcanvas.setAttribute('height', 700);

	rightmcanvas=document.getElementById('rightminorcanvas');
	rightmcontext = rightmcanvas.getContext("2d");
	rightmcanvas.setAttribute('width', 700);
	rightmcanvas.setAttribute('height', 700);

	ecanvas=document.getElementById('effectcanvas');
	econtext = ecanvas.getContext("2d");
	ecanvas.setAttribute('width', 700);
	ecanvas.setAttribute('height', 700);
	ecanvas.onclick = function(e) {
		handleCombatCanvasClick(e);
	}

	// testing buffering
	bcanvas= document.createElement('canvas');
	bcontext = bcanvas.getContext("2d");
	bcanvas.setAttribute('width', 700);
	bcanvas.setAttribute('height', 700);
	// just so you know

	var bgradius=14;
	bgCircleImage = document.createElement('canvas');
	bgCircleImage.width = 28;
	bgCircleImage.height = 28;
	var imgCtx = bgCircleImage.getContext('2d');
	imgCtx.clearRect(0, 0, 28, 28);
	imgCtx.beginPath();
	imgCtx.arc(14, 14, bgradius, 0, 2 * Math.PI, false);
	imgCtx.fillStyle = 'rgba(189,229,255,1.00)';
	imgCtx.fill();

});

function pauseCombat(){
	if (ad2460.combat.paused==true){
		ad2460.combat.paused=false;
		updateSpeedIndicator();
	}
	else {
		ad2460.combat.paused=true;
		updateSpeedIndicator();
	}
}

function toggleExtraFX(){
	extraFX=!extraFX;
	var cookieString="true";
	if (extraFX==false){
		cookieString="false";
	}
	SetCookie("extrafx", cookieString, window.location.host,90);
	renderCombatFrame('all',true,'both');

	if (extraFX==false){
		//$("#combat_extrafx_on_off").removeClass("pot_on");
		//$("#extra_fx_text").html("ExtraFX : OFF");
	}
	else {
		//$("#combat_extrafx_on_off").addClass("pot_on");
		//$("#extra_fx_text").html("ExtraFX : ON");
	}

}

function toggleCombatCommentary(){
	$("#chatcontent").toggle();
	$("#chatfunctions").toggle();

}

function updateCombatSoundIcons(){
	if (ad2460.audioVars.combatsfxVolume>0){	$("#combat_sfx_toggle").removeClass("off");	}
	else {	$("#combat_sfx_toggle").addClass("off");	}
	if (ad2460.audioVars.combatmusicVolume>0){	$("#combat_music_toggle").removeClass("off");	}
	else {	$("#combat_music_toggle").addClass("off");	}
}

function toggleCombatMusic(){


	if (ad2460.combat.restoreMusicVolume==-1){
		// Apparently not clicked yet
		// Kill music
		if (ad2460.audioVars.combatmusicVolume==0){
			ad2460.combat.restoreMusicVolume=0;
			ad2460.audioVars.combatmusicVolume=0.5;
			var music=document.getElementById('combatmusic');
			music.volume=0.5;
			if (music.paused==true){
				music.play();
			}
		}
		else {
			ad2460.combat.restoreMusicVolume=ad2460.audioVars.combatmusicVolume;
			ad2460.audioVars.combatmusicVolume=0;
			var music=document.getElementById('combatmusic');
			music.volume=0;
			if (music.paused==false){
				music.pause();
			}
		}

	}
	else {
		// ok, second click, lets revert
		ad2460.audioVars.combatmusicVolume=ad2460.combat.restoreMusicVolume;
		ad2460.combat.restoreMusicVolume=-1;
		var music=document.getElementById('combatmusic');
		music.volume=ad2460.audioVars.combatmusicVolume;
		if (music.paused==true){
			music.play();
		}
	}


	try {
		document.getElementById('combatmusicvolume').value=ad2460.audioVars.combatmusicVolume*100;
		updateVolume();
	}
	catch(err){
	}
	updateCombatSoundIcons();
}

function toggleCombatSound(){
	if (ad2460.combat.restoreSfxVolume==-1){
		// Apparently not clicked yet
		// Kill music
		if (ad2460.audioVars.combatsfxVolume==0){
			ad2460.combat.restoreSfxVolume=0;
			ad2460.audioVars.combatsfxVolume=0.5;
		}
		else {
			ad2460.combat.restoreSfxVolume=ad2460.audioVars.combatsfxVolume;
			ad2460.audioVars.combatsfxVolume=0;
		}
	}
	else {
		// ok, second click, lets revert
		ad2460.audioVars.combatsfxVolume=ad2460.combat.restoreSfxVolume;
		ad2460.combat.restoreSfxVolume=-1;
	}
	try {
		document.getElementById('combatsfxvolume').value=ad2460.audioVars.combatsfxVolume*100;
		updateVolume();
	}
	catch(err){
	}
	updateCombatSoundIcons();
}

$(document).ready(function() {
	var tmpfx=ReadCookie('extrafx');
	if (tmpfx=='true'){
		extraFX=true;
		$("#combat_extrafx_on_off").addClass("pot_on");
		//$("#extra_fx_text").html("ExtraFX : ON");
	}
	if (tmpfx=='false'){
		extraFX=false;
		$("#combat_extrafx_on_off").removeClass("pot_on");
		//$("#extra_fx_text").html("ExtraFX : OFF");
	}

	var tmpfx=ReadCookie('fullcombattext');
	if (tmpfx=='true'){
		ad2460.combat.showFullCombatText=true;
		$("#combat_fulltext_summary").addClass("pot_on");
		//$("#extra_fx_text").html("ExtraFX : ON");
	}
	if (tmpfx=='false'){
		ad2460.combat.showFullCombatText=false;
		$("#combat_fulltext_summary").removeClass("pot_on");
		//$("#extra_fx_text").html("ExtraFX : OFF");
	}

	var blindCookie=ReadCookie('blind');
	if (blindCookie=='true'){
		ad2460.blind=true;
	}
	else {
		ad2460.blind=false;
	}

});

$( window ).load(function() {
	setUpImageCache();
  // Run code
});

function return_ships_based_on_side_and_ship_type_id(side, ship_type_id){
	var returnArray=new Array;
	var arr=ad2460.combat.attShips;
	if (side=='def'){
		arr=ad2460.combat.defShips;
	}

	for (var i=0;i<arr.length ;i++ ){
		if (arr[i].ship_type_id==ship_type_id){
			returnArray.push(arr[i]);
			//console.log(arr[i].unique_id+" "+arr[i].active+" "+arr[i].hullstrength);
		}
	}

	//console.log(returnArray);
}
// Some nonsense
var banana=false;
var colorblind=false;

var ignore=new Array;

$( window ).resize(function() {
	handle_window_resize();
});

$(window).load(function() {
	// Exectutes late

	var oldPos=ReadCookie('chat_location');
	/*
	if (oldPos=='right'){
		chatUp('now');
		moveChatToRight('silent');
	}
	else if (oldPos=='bottom'){
		chatUp('now');
		moveChatToBottom('silent');
	}
	else {
		ad2460.chatPanePosition='default';
	}
	*/

	ad2460.chatPanePosition='default';
	ad2460.chatPaneVisible=1;

	//document.getElementById('global_chat_container_table_body').setAttribute('aria-live','off');
	//document.getElementById('alliance_chat_container_table_body').setAttribute('aria-live','off');

	var cookieCB=ReadCookie('colorblind');
	if (cookieCB=='true'){
		colorblind=true;
		$("#str_gauge_att").css({'background-color':'cyan', 'background-image':'none'});
		$("#att_hull").css({'background-color':'cyan','border':'1px solid rgba(146, 219, 245, 0.6)'});
		$("#att_capitals").css({'background': 'linear-gradient(180deg, #81f9ff 5px, rgba(0, 255, 255, 0.5) 6px, rgba(0, 231, 255, 0.5) 10px, rgba(224,224,255,0.4) 11px, rgba(224,224,255,0.1) 200px)' });
		$(".battle_numbers").css({'background':'linear-gradient(90deg, rgb(132, 215, 247) 10px, rgba(255,255,255,0.2) 11px, transparent 120px,rgba(255,255,255,0.2) 229px, green 230px, green 240px)'});
		$("#att_firepower").css({'background':'linear-gradient(0deg, rgb(74, 86, 157) 20px, rgb(36, 220, 208) 180px)'});
		$("#negative_losses").css({'background-color':'cyan', 'background-image':'none'});
		$("#att_costs").css({'background':'linear-gradient(90deg, rgb(16, 163, 170) 10px, rgba(255,255,255,0.2) 11px, transparent 120px,rgba(255,255,255,0.2) 229px, rgb(16, 163, 170) 230px, rgb(16, 162, 170) 240px)'});
		$(".combat_attacker_text").addClass("combat_attacker_text_cb");

		att_class='combat_attacker_text_cb';
		def_class='combat_defender_text';
	}

	$("#battle_live_stats, #battle_stats_field").click(function(){
		if (colorblind==false){
			// modify some css
			$("#str_gauge_att").css({'background-color':'cyan', 'background-image':'none'});
			$("#att_hull").css({'background-color':'cyan','border':'1px solid rgba(146, 219, 245, 0.6)'});
			$("#att_capitals").css({'background': 'linear-gradient(180deg, #81f9ff 5px, rgba(0, 255, 255, 0.5) 6px, rgba(0, 231, 255, 0.5) 10px, rgba(224,224,255,0.4) 11px, rgba(224,224,255,0.1) 200px)' });
			$(".battle_numbers").css({'background':'linear-gradient(90deg, rgb(132, 215, 247) 10px, rgba(255,255,255,0.2) 11px, transparent 120px,rgba(255,255,255,0.2) 229px, green 230px, green 240px)'});
			$("#att_firepower").css({'background':'linear-gradient(0deg, rgb(74, 86, 157) 20px, rgb(36, 220, 208) 180px)'});
			$("#negative_losses").css({'background-color':'cyan', 'background-image':'none'});
			$("#att_costs").css({'background':'linear-gradient(90deg, rgb(16, 163, 170) 10px, rgba(255,255,255,0.2) 11px, transparent 120px,rgba(255,255,255,0.2) 229px, rgb(16, 163, 170) 230px, rgb(16, 162, 170) 240px)'});
			$(".combat_attacker_text").addClass("combat_attacker_text_cb");

			att_class='combat_attacker_text_cb';
			def_class='combat_defender_text';
			SetCookie("colorblind", "true", window.location.host,365);


		}
		else {
			$("#str_gauge_att").css({'background-color':'red', 'background-image':'none'});
			$("#att_hull").css({'background-color':'red','border':'1px solid rgba(245, 219, 216, 0.6)'});
			$("#att_capitals").css({'background': 'linear-gradient(180deg, red 5px, rgba(255,0,0,0.5) 6px, rgba(255,0,0,0.5) 10px, rgba(224,224,255,0.4) 11px, rgba(224,224,255,0.1) 200px)' });
			$(".battle_numbers").css({'background':'linear-gradient(90deg, rgb(170,16,16) 10px, rgba(255,255,255,0.2) 11px, transparent 120px,rgba(255,255,255,0.2) 229px, green 230px, green 240px)'});
			$("#att_firepower").css({'background':'linear-gradient(0deg, #4A569D 20px, #DC2424 180px)'});
			$("#negative_losses").css({'background-color':'red', 'background-image':'none'});
			$("#att_costs").css({'background':'linear-gradient(90deg, rgb(170,16,16) 10px, rgba(255,255,255,0.2) 11px, transparent 120px,rgba(255,255,255,0.2) 229px, rgb(170,16,16) 230px, rgb(170,16,16) 240px)'});
			$(".combat_attacker_text").removeClass("combat_attacker_text_cb");

			att_class='combat_attacker_text';
			def_class='combat_defender_text';
			SetCookie("colorblind", "false", window.location.host,365);

		}
		colorblind=!colorblind;
	});

});

function recallChannel(){
	var lastChannel=ReadCookie('last_channel');

	if(lastChannel=="help"){
		//selectChatChannel('quadrant');
		$("#local").click();
	}
	else if(lastChannel=="alliance"){
		//selectChatChannel('alliance');
		$("#group").click();
	}
	else {
		//selectChatChannel('global');
		$("#global").click();
	}
}

/*
function chatUp(param){
	$("#chatpane").show();
	$("#points_msg_unread_chat_indicator").hide();
	if (param=='now'){
		$("#chatpane").css({height: "300px"});
		//$("#chatmaxbutton").css( {background : "url(../images/fixed/upqueue.png) no-repeat" } );
		$("#chatmaxbutton").attr("src","images/fixed/upqueue.png");

	}
	else {
		$("#chatpane").animate({height: "300px"}, { duration: 400  ,  easing : easing });
		//$("#chatmaxbutton").css( {background : "url(../images/fixed/upqueue.png) no-repeat" } );
		$("#chatmaxbutton").attr("src","images/fixed/upqueue.png");

	}
	ad2460.chatPaneVisible=1;
	scrollChatToBottom();
}

function chatMax(){
	$('#chatcontent').transition({top: '-578px'},500);
	$('#slot1').transition( {rotateX: 180},500 );
	ad2460.chatPaneVisible=2;
	setTimeout('scrollChatToBottom()',500);
}

function chatMin(){
	$('#chatcontent').transition({top: '0px'},500);
	$('#slot1').transition( {rotateX:0},500 );
	ad2460.chatPaneVisible=1;
	setTimeout('scrollChatToBottom()',500);


}
function chatDown(){
	if (ad2460.chatPanePosition=='right' || ad2460.chatPanePosition=='bottom' )	{
		$("#chatpane").hide();
		moveChatToDefault();
	}
	$("#chatpane").animate({height: "0px"}, { duration: 200  ,  easing : easing, complete:function(){$("#chatpane").hide();} });
	ad2460.chatPaneVisible=0;
}
*/
function moveChatToDefault(){
	ad2460.chatPanePosition='default';
	ad2460.chatPaneVisible=1;
	/*
	var main_bg=document.getElementById("main_bg");
	main_bg.style.width="1200px";
	var chatpane=document.getElementById("chatpane");
	document.getElementById("game_container").appendChild(chatpane);
	chatpane.style.height="300px";
	chatpane.style.bottom="100px";
	chatpane.style.width="500px";
	chatpane.style.top="";
	chatpane.style.maxHeight="";

	document.getElementById('alliance_chat_container_table_body').style.width='480px';
	document.getElementById('quadrant_chat_container_table_body').style.width='480px';
	document.getElementById('global_chat_container_table_body').style.width='480px';

	chatpane.style.left="auto";
	chatpane.style.right="0px";
	chatpane.style.borderTopLeftRadius="10px";
	$("#chatmaxbutton").show();
	SetCookie("chat_location", ad2460.chatPanePosition, window.location.host,30);
	*/
	scrollChatToBottom();
}

function moveChatToBottom(addedInput){

	ad2460.chatPanePosition='bottom';
	ad2460.chatPaneVisible=1;
	/*
	var chatpane=document.getElementById("chatpane");
	document.getElementById("body").appendChild(chatpane);
	var main_bg=document.getElementById("main_bg");
	main_bg.style.width="1200px";

	chatpane.style.top="705px";
	if (window.innerWidth>=1200){
		chatpane.style.width="1200px";
	}
	else {
		chatpane.style.width=""+window.innerWidth-10+"px";
	}

	chatpane.style.minHeight="200px";
	chatpane.style.maxHeight="300px";

	document.getElementById('alliance_chat_container_table_body').style.width='1190px';
	document.getElementById('global_chat_container_table_body').style.width='1190px';
	document.getElementById('quadrant_chat_container_table_body').style.width='1190px';


	var newLeft=Math.floor((window.innerWidth-1200)/2);
	if (newLeft<0){
		newLeft=0;
	}
	chatpane.style.left=newLeft+"px";
	chatpane.style.right="auto";
	var newHeight=Math.floor(window.innerHeight-710);
	chatpane.style.height=newHeight+"px";
	chatpane.style.borderTopLeftRadius="0px";
	$("#chatmaxbutton").hide();
	SetCookie("chat_location", ad2460.chatPanePosition, window.location.host,30);
	*/
	scrollChatToBottom();
}



function moveChatToRight(addedInput){
	if (window.innerWidth<1600){
		//if (addedInput!='silent'){
		//	systemFeedback("System","The window doesn't have enough width to move the chat to the right",0,5);
		//}
		//moveChatToDefault();
		//return;
	}

	ad2460.chatPanePosition='right';
	ad2460.chatPaneVisible=1;

	/*
	var chatpane=document.getElementById("chatpane");
	var main_bg=document.getElementById("main_bg");
	main_bg.appendChild(chatpane);
	main_bg.style.width="1600px";
	chatpane.style.height="698px";
	chatpane.style.width="398px";
	document.getElementById('alliance_chat_container_table_body').style.width='380px';
	document.getElementById('global_chat_container_table_body').style.width='380px';
	document.getElementById('quadrant_chat_container_table_body').style.width='380px';

	chatpane.style.top="";
	chatpane.style.bottom="0px";
	chatpane.style.left="auto";
	chatpane.style.right="0px";
	chatpane.style.maxHeight="";
	chatpane.style.borderTopLeftRadius="0px";
	$("#chatmaxbutton").hide();
	SetCookie("chat_location", ad2460.chatPanePosition, window.location.host,30);
	*/
	scrollChatToBottom();
}

function chatButtonClick(){
	if (ad2460.chatPaneVisible==0){
		chatUp();
	}
	else {
		chatDown();
	}
}

function chatMaxclick(){
	if (ad2460.chatPaneVisible<2){
		chatMax();
	}
	else {
		chatMin();
	}
}

function addChatMessage(user_id, admin_status, nick, timestamp, message, channel, vip_status, vip_icon, chat_color_class){
	// find the right channel
	// Add all messages to the messages there, and render the new one

	// quick hack to support basic client-ignore
	var i=0;
	for (i=0;i<ignore.length ;i++ ){
		if (ignore[i].toLowerCase()==nick.toLowerCase()){
			return;
		}
	}


	for (i=0;i<ad2460.subscribedChannels.length ;i++ ){
		if (channel == ad2460.subscribedChannels[i].channel){
			// Make an extra check here to see if we already got this message...
			var a=0;
			var unique=1;
			for (a=0;a<ad2460.subscribedChannels[i].messages.length ;a++ ){
				var thisMsg=ad2460.subscribedChannels[i].messages[a];
				if (thisMsg.user_id==user_id && thisMsg.nick==nick && thisMsg.timestamp==timestamp && thisMsg.message==message){
					// We already got it!
					unique=0;
				}
			}
			if (unique==1){
				ad2460.subscribedChannels[i].messages.push(new Chatmessage(user_id, admin_status, nick, timestamp, message, vip_status, vip_icon, chat_color_class));
				highlightChatButton();
			}
		}
	}
}

function highlightChatButton(){
	if (ad2460.chatPaneVisible==0){
		//$("#chatbutton .buttonhover").css( { opacity: 1 });
		$("#points_msg_unread_chat_indicator").show();

	}
}

function updateChat(){
	// Assemble the 2 subscribed channels, only support for a global and an alliance-channel atm...
	// Lets skip it now and then if the window is not visible
	if (ad2460.chatPaneVisible==0){
		var randomnumber=Math.floor(Math.random()*100);
		if (randomnumber<85){
			return;
		}
	}


	if ( ad2460.chatFetching==true ){
		setTimeout('ad2460.chatFetching=false',1500);
		return;
	}
	var i=0;
	var channel_string="";
	for (i=0;i<ad2460.subscribedChannels.length ;i++ ){
		// continue here..
		channel_string+=ad2460.subscribedChannels[i].channel;
		if (i<ad2460.subscribedChannels.length-1){
			channel_string+=",";
		}
	}
	$.post(ad2460.chatserver+'chattest.pl', {action:'fetch_chat_messages',channels:channel_string,last_fetch:ad2460.updateTimes.lastChatFetch}, function(data){ parseInfo(data);ad2460.chatFetching=false;});
}

function updateSelectedPlayerInfo(nickname, planet_name, x,  y,  world_type,  strength, alliance_id, alliance_name, avatar){
	$("#playerIDname").html(''+nickname);
	$("#playerIDalliance").html(''+alliance_name);
	if (alliance_id>0){
		document.getElementById("playerIDalliance").setAttribute("onclick","showAllianceInfo("+alliance_id+")");
	}
	$("#playerIDhwname").html('Homeworld: '+planet_name);
	$("#playerIDstrength").html('Strength: '+strength);
	document.getElementById("playerIDhwname").setAttribute("onclick","zoomInToXY("+x+","+y+")");
	if (avatar=='none.jpg'){
		$("#playerIDplanetimg").attr('src','images/planets/outpost_planets/planettype'+zeroPad(world_type)+'.jpg');
	}
	else {
		$("#playerIDplanetimg").attr('src','images/uploads/avatars/'+avatar);
	}

	document.getElementById('playerIDmsg').setAttribute("onclick","initiateConversationWithName('"+nickname+"')");

	if (nickname==ad2460.nickname){
		document.getElementById('playerIDmsg').setAttribute("onclick",null);
		$("#playerIDmsg").hide();
	}
	else {
		$("#playerIDmsg").show();
	}


	showChatPlayerInfo();

}

function renderNewChatMessages(){
	// The dom-id to render them too is located in the ad2460.subscribedChannels array
	var reg = new RegExp(ad2460.nickname,"gi");
	var i=0;
	var playDing=false;
	for (i=0;i<ad2460.subscribedChannels.length ;i++ ){
		var parent=document.getElementById(ad2460.subscribedChannels[i].domId);
		var a=0;
		for (a=0;a<ad2460.subscribedChannels[i].messages.length ;a++ ){
			thisMsg=ad2460.subscribedChannels[i].messages[a];
			if (thisMsg.rendered==0){
				// make an item and then append it to the parent
				/*	<div class='chat_player_entry'>
						<span class='chat_player_name'>Evansen: </span>
						<span>Damn you all to hell!</span>
					</div>
				*/
				thisMsg.rendered=1;
				var row=document.createElement('div');
				var cell1=document.createElement('span');
				var cell2=document.createElement('span');
				var cell3=document.createElement('span');

				var tmpUserId=thisMsg.user_id+'';
				var classnum=tmpUserId.substr(-1,1);

				var extraClass='col_0'+classnum;
				if (classnum==0){
					extraClass='col_10';
				}

				classnum=thisMsg.user_id%14;
				if (classnum<10){
					classnum='0'+classnum;
				}
				extraClass='col_'+classnum;

				if (thisMsg.chat_color_class != '' && thisMsg.vip_status>ad2460.serverTime){
					extraClass=thisMsg.chat_color_class;
				}

				row.setAttribute('class','chat_player_entry');
				cell1.setAttribute('class','chat_player_name '+extraClass);
				cell2.setAttribute('class','chat_message_body');
				cell3.setAttribute('class','chat_player_timestamp');
				cell3.setAttribute('aria-hidden','true');

				//cell1.setAttribute('onclick','fetchChatPlayerInfo('+thisMsg.user_id+');return false;');
				cell1.setAttribute('onclick','loadPlayerInfo('+thisMsg.user_id+');return false;');

				var tmpstr=thisMsg.message.replace(reg, "<b>"+ad2460.nickname+"</b>");

				if (tmpstr!=thisMsg.message){
					playDing=true;
				}

				cell1.innerHTML='<img aria-hidden="true" class="vip_chat"  src="images/icons/vip/chat/none.gif">'+thisMsg.nick+' ';

				if (thisMsg.vip_icon != '' && thisMsg.vip_status>ad2460.serverTime){
					cell1.innerHTML='<img aria-hidden="true" class="vip_chat" title=" VIP " src="images/icons/vip/chat/'+thisMsg.vip_icon+'">'+thisMsg.nick+' ';
					if (thisMsg.admin_status==10){
						cell1.innerHTML='<img aria-hidden="true" class="vip_chat" title=" DEV " src="images/icons/vip/chat/'+thisMsg.vip_icon+'">'+thisMsg.nick+' ';
					}
				}


				if (tmpstr.substr(0,3) == '/me'){
					tmpstr=tmpstr.replace("\/me",thisMsg.nick);
					cell1.style.display='none';
					cell2.setAttribute('class','chat_message_body chat_emote '+extraClass);
				}

				if (thisMsg.message.substr(0,4) == '/msg'){
					if (thisMsg.message.indexOf(ad2460.nickname)==5){
						tmpstr=thisMsg.message.replace("\/msg "+ad2460.nickname,thisMsg.nick+" whispers: ");
						cell1.style.display='none';
						cell2.setAttribute('class','chat_message_body chat_whisper '+extraClass);
					}
					else if (thisMsg.nick==ad2460.nickname){
						tmpstr=thisMsg.message.replace("\/msg ","I whispered: ");
						cell1.style.display='none';
						cell2.setAttribute('class','chat_message_body chat_whisper '+extraClass);
					}
					else {
						continue;
					}
				}

				tmpstr=remove_nastyness(tmpstr);
				cell2.innerHTML=iconify(linkify(tmpstr));

				var tmp=new Date;
				var timestring=formatShortTime(thisMsg.timestamp+(tmp.getTimezoneOffset()*60));
				cell3.innerHTML='['+timestring+'] ';

				var weAreLookingAtThisChannel=false;
				if (ad2460.subscribedChannels[i].channel==ad2460.selectedChannel){
					weAreLookingAtThisChannel=true;
				}

				var currentPos=document.getElementById('chatcontent').scrollTop;
				var scrollWindow=document.getElementById('chatcontent');

				var scrollChatAfterAppend=false;

				if (weAreLookingAtThisChannel==true){
					var bottomPos=scrollWindow.scrollHeight-Math.ceil($("#chatcontent").height());
					if (currentPos<bottomPos+5 && currentPos>bottomPos-5){
						scrollChatAfterAppend=true;
					}
					//if (currentPos==bottomPos){
					//}
				}
				if (thisMsg.user_id==ad2460.user_id){
					scrollChatAfterAppend=true;
				}

				row.appendChild(cell3);
				row.appendChild(cell1);
				row.appendChild(cell2);
				parent.appendChild(row);

				if (scrollChatAfterAppend==true){
					scrollChatToBottom();
				}



				if (thisMsg.timestamp>ad2460.serverTime-10 && thisMsg.user_id!=ad2460.user_id && ad2460.serverTime!=0 && ad2460.selectedChannel!=ad2460.subscribedChannels[i].channel)	{
					blinkChannelSelector(ad2460.subscribedChannels[i].channel);
					if (weAreLookingAtThisChannel==false){
						markChannelUnread(ad2460.subscribedChannels[i].channel);
						if (playDing==true){
							nameMentionedToggle(ad2460.subscribedChannels[i].channel);
						}
					}
					//console.log(ad2460.subscribedChannels[i].channel);
				}



				var maxMsgs=300;

				if (document.getElementById('global_chat_container_table_body').children.length>maxMsgs){
					var numToDelete=document.getElementById('global_chat_container_table_body').children.length-maxMsgs;
					var x=0;
					for (x=0;x<numToDelete ;x++ ){
						document.getElementById('global_chat_container_table_body').removeChild(document.getElementById('global_chat_container_table_body').children[0]);
					}
				}
				if (document.getElementById('quadrant_chat_container_table_body').children.length>maxMsgs){
					var numToDelete=document.getElementById('quadrant_chat_container_table_body').children.length-maxMsgs;
					var x=0;
					for (x=0;x<numToDelete ;x++ ){
						document.getElementById('quadrant_chat_container_table_body').removeChild(document.getElementById('quadrant_chat_container_table_body').children[0]);
					}
				}

				if (document.getElementById('alliance_chat_container_table_body').children.length>maxMsgs){
					var numToDelete=document.getElementById('alliance_chat_container_table_body').children.length-maxMsgs;
					var x=0;
					for (x=0;x<numToDelete ;x++ ){
						document.getElementById('alliance_chat_container_table_body').removeChild(document.getElementById('alliance_chat_container_table_body').children[0]);
					}
				}
			}
		}
	}
	if (playDing==true){
		play_multi_sound('sfx_error');
	}
}

function fetchChatPlayerInfo(player_id){
	$.post('actionhandler.pl', {action:'fetch_chat_player_info',player_id:player_id}, function(data){ parseInfo(data);});
}

function scrollChatToBottom(){
	//console.log("Scrolling chat to bottom");
	var scrollWindow=document.getElementById('chatcontent');
	//console.log(scrollWindow.scrollHeight,returnInteger($("#chatcontent").height()), $("#chatcontent").height());
	scrollWindow.scrollTop=129+scrollWindow.scrollHeight-Math.floor($("#chatcontent").height());

}

function markChannelUnread(channel){
	if (channel=='global'){
		setChatChannelUnread('global');
	}
	if (channel=='help'){
		setChatChannelUnread('local');
	}
	if (channel=='alliance'){
		setChatChannelUnread('group');
	}
}

function nameMentionedToggle(channel){
	if (channel=='global'){
		setNameMentioned('global');
	}
	if (channel=='help'){
		setNameMentioned('local');
	}
	if (channel=='alliance'){
		setNameMentioned('group');
	}

}

function markChannelRead(channel){
	if (channel=='global'){
		setChatChannelRead('global');
		unsetNameMentioned('global');
	}
	if (channel=='help'){
		setChatChannelRead('local');
		unsetNameMentioned('local');
	}
	if (channel=='alliance'){
		setChatChannelRead('group');
		unsetNameMentioned('group');
	}
}


function blinkChannelSelector(channel){
	if (channel=='global'){
		flashChatIndicator('global');
		//$("#unread_chat_indicator_global").fadeOut(100);
		//setTimeout("$('#unread_chat_indicator_global').fadeIn(100)",100);
	}
	if (channel=='help'){
		flashChatIndicator('local');
		//$("#unread_chat_indicator_local").fadeOut(100);
		//setTimeout("$('#unread_chat_indicator_local').fadeIn(100)",100);
	}
	if (channel=='alliance'){
		flashChatIndicator('group');
		//$("#unread_chat_indicator_alliance").fadeOut(100);
		//setTimeout("$('#unread_chat_indicator_alliance').fadeIn(100)",100);
	}
}


function sendChatMessage(){
	// channel is in ad2460.selectedChannel
	var msg=document.getElementById("chat_input_field").value;
	msg = msg.replace(/(\r\n|\n|\r)/gm,"");
	// Some dummy checking..
	if (msg.length<1){
		return false;
	}

	if (msg.toLowerCase() == '/blind'){
		SetCookie("blind", "true", window.location.host,365);
		ad2460.blind=true;
		document.getElementById("chat_input_field").value='';
		ad2460.mySentChatHistory.push(msg);
		ad2460.currentChatHistory=0;

		return;
	}
	if (msg.toLowerCase() == '/claim outpost'){
		document.getElementById("chat_input_field").value='';
		specialClaimOutpostCommand();
		ad2460.mySentChatHistory.push(msg);
		ad2460.currentChatHistory=0;
		return;
	}

	if (msg.toLowerCase() == '/notblind'){
		SetCookie("blind", "false", window.location.host,0);
		ad2460.blind=false;
		document.getElementById("chat_input_field").value='';
		ad2460.mySentChatHistory.push(msg);
		ad2460.currentChatHistory=0;

		return;
	}

	if (msg.toLowerCase() == '/extendgui'){
		if (ad2460.extendedGUI==false){
			extendGui();
		}else {
			unextendGui();
		}
		document.getElementById("chat_input_field").value='';
		ad2460.mySentChatHistory.push(msg);
		ad2460.currentChatHistory=ad2460.mySentChatHistory.length;

		return;
	}

	if (msg == '/reload'){
		document.location=document.location;
		return;
	}
	if (msg.toLowerCase() == '/lowerattackwarning'){
		lowerAttackWarning=true;
		document.getElementById("chat_input_field").value='';
		return;

	}


	if (msg.toLowerCase() == '/comets'){
		var f=0;
		for (f=0;f<100 ;f++ ){
			createComet();
		}
		document.getElementById("chat_input_field").value='';
		ad2460.mySentChatHistory.push(msg);
		ad2460.currentChatHistory=ad2460.mySentChatHistory.length;

		return;
	}

	if (msg.toLowerCase() == '/shower of bananas'){
		var f=0;
		for (f=0;f<200 ;f++ ){
			createBanana();
		}
		document.getElementById("chat_input_field").value='';
		ad2460.mySentChatHistory.push(msg);
		ad2460.currentChatHistory=ad2460.mySentChatHistory.length;

		return;
	}

	if (msg.substr(0,8) == '/ignore '){
		var ignoreNick=msg.substr(8,50);
		if (ignoreNick.length>1){
			toggleIgnore(ignoreNick);
		}

		document.getElementById("chat_input_field").value='';
		ad2460.mySentChatHistory.push(msg);
		ad2460.currentChatHistory=ad2460.mySentChatHistory.length;

		return;
	}

	if (msg == '/banana'){
		if (banana==false){
			banana=true;
			$('#main_bg').css({
			  '-webkit-transform' : 'scaleX(-1)',
			  '-moz-transform'    : 'scaleX(-1)',
			  '-ms-transform'     : 'scaleX(-1)',
			  '-o-transform'      : 'scaleX(-1)',
			  'transform'         : 'scaleX(-1)'
			});
		}else {
			banana=false;
			$('#main_bg').css({
			  '-webkit-transform' : 'scaleX(1)',
			  '-moz-transform'    : 'scaleX(1)',
			  '-ms-transform'     : 'scaleX(1)',
			  '-o-transform'      : 'scaleX(1)',
			  'transform'         : 'scaleX(1)'
			});

		}
		document.getElementById("chat_input_field").value='';
		ad2460.mySentChatHistory.push(msg);
		ad2460.currentChatHistory=ad2460.mySentChatHistory.length;

		return;
	}


	if (msg.substr(0,1) == '/'){
		var validCommand=false;
		if (msg.substr(0,5) == '/msg '){
			validCommand=true;
		}
		if (msg.substr(0,4) == '/me '){
			validCommand=true;
		}
		if (msg == '/me'){
			validCommand=true;
		}
		if (msg.substr(0,5) == '/ban '){
			validCommand=true;
		}
		if (msg.substr(0,7) == '/unban '){
			validCommand=true;
		}

		if (validCommand==false){
			systemFeedback('Error','Invalid command', 1, 3);
			return false;
		}
	}

	var validation='something';
	$.post(ad2460.chatserver+'chattest.pl', {action:'send_chat_message',channel_id:ad2460.selectedChannel,message:msg, last_fetch:ad2460.updateTimes.lastChatFetch, validation:validation}, function(data){ parseInfo(data);});
	ad2460.mySentChatHistory.push(msg);
	ad2460.currentChatHistory=ad2460.mySentChatHistory.length;
	document.getElementById("chat_input_field").value='';
}

function goBackInChatHistory(){
	ad2460.currentChatHistory--;
	if (ad2460.currentChatHistory<1){
		ad2460.currentChatHistory=ad2460.mySentChatHistory.length;
	}
	if (ad2460.currentChatHistory>0){
		document.getElementById("chat_input_field").value=ad2460.mySentChatHistory[ad2460.currentChatHistory-1];
	}
}

function toggleIgnore(nick){
	// if we find it, get rid of it.
	// if we don't, add it
	var found=-1;
	for (var i=0;i<ignore.length ;i++ )	{
		if (ignore[i]==nick){
			found=i;
		}
	}
	if (found==-1){
		ignore.push(nick);
		systemFeedback('OK',nick+ ' is now being ignored.', 2, 2);
	}
	else {
		ignore.splice(found, 1);
		systemFeedback('OK',nick+ ' is no longer being ignored.', 2, 2);
	}
}

function selectChatChannel(id){

	markChannelRead(id);


	if (id=='combat'){
		$("#global_chat_container_table_body").hide();
		$("#alliance_chat_container_table_body").hide();
		$("#quadrant_chat_container_table_body").hide();
		$("#chat_header_0").removeClass('selected');
		$("#chat_header_1").removeClass('selected');
		$("#chat_header_2").removeClass('selected');
		$("#combat_commentary_container").show();

		ad2460.selectedChannel="combat";

		document.getElementById('alliance_chat_container_table_body').setAttribute('aria-live','off');
		document.getElementById('global_chat_container_table_body').setAttribute('aria-live','off');


	}


	if (id=='global'){
		ad2460.selectedChannel="global";
		$("#global_chat_container_table_body").show();
		$("#alliance_chat_container_table_body").hide();
		$("#quadrant_chat_container_table_body").hide();
		$("#combat_commentary_container").hide();
		$("#chat_header_0").addClass('selected');
		$("#chat_header_1").removeClass('selected');
		$("#chat_header_2").removeClass('selected');
		$('.chatpane').css({boxShadow: 'none'});
		SetCookie("last_channel", "global", window.location.host,30);
		$("#unread_chat_indicator_global").hide();
		//document.getElementById('alliance_chat_container_table_body').setAttribute('aria-live','off');
		//document.getElementById('global_chat_container_table_body').setAttribute('aria-live','polite');
	}

	if (id=='help'){
		ad2460.selectedChannel="help";
		$("#quadrant_chat_container_table_body").show();
		$("#alliance_chat_container_table_body").hide();
		$("#global_chat_container_table_body").hide();
		$("#combat_commentary_container").hide();
		$("#chat_header_1").addClass('selected');
		$("#chat_header_2").removeClass('selected');
		$("#chat_header_0").removeClass('selected');
		$('.chatpane').css({boxShadow: 'none'});
		SetCookie("last_channel", "help", window.location.host,30);
		$("#unread_chat_indicator_local").hide();
	}

	if (id=='alliance'){
		if (ad2460.allianceData.id>0){
			ad2460.selectedChannel="alliance";
			$("#global_chat_container_table_body").hide();
			$("#alliance_chat_container_table_body").show();
			$("#quadrant_chat_container_table_body").hide();
			$("#combat_commentary_container").hide();
			$("#chat_header_2").addClass('selected');
			$("#chat_header_1").removeClass('selected');
			$("#chat_header_0").removeClass('selected');
			//$('.chatpane').css({boxShadow: 'inset -35px -53px 25px -12px #408080'});
			SetCookie("last_channel", "alliance", window.location.host,30);
			$("#unread_chat_indicator_alliance").hide();
			//document.getElementById('global_chat_container_table_body').setAttribute('aria-live','off');
			//document.getElementById('alliance_chat_container_table_body').setAttribute('aria-live','polite');
		}
		else {
			systemFeedback('Error','No alliance found', 1, 3);
			selectChatChannel('global');
			$("#global").click();
		}
	}

	/*
	if (id=='alliance' && ad2460.allianceData.id>0){
		$("#chatpane").addClass('a_chat_special');
	}
	else {
		$("#chatpane").removeClass('a_chat_special');
	}
	*/
	scrollChatToBottom();
	$("#chat_input_field").focus();
}


function handle_window_resize(){
	return;
	if (ad2460.chatPanePosition=='right'){
		moveChatToRight();

	}
	if (ad2460.chatPanePosition=='bottom'){
		moveChatToBottom();
	}

}

function checkForChatClosing(){
	return;
	// No longer relevant
	if (ad2460.chatPanePosition=='default' && ad2460.chatPaneVisible==1){
		chatDown();
	}
}
function closeGameInfoBox(){
	$("#game_object_info_box_container").hide();
}

function showGameInfoBox(id){
	var item=returnGameObjectById(id);
	if (item==false){
		return;
	}

	$("#gameInfoBoxRequirementsButton").hide();

	var nameString="";
	var image_src="";
	var description="";
	var stats="";


	if (item.item_type=='Research'){
		nameString=item.name+" ("+item.item_type+")";
		image_src="images/icons/wide_research/"+item.id+".jpg";
		description=item.description+"<br><br>"+item.bonus_description;
		stats="<div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_cost)+"</div></div>";
		stats+="<div class='g_o_stat_name'>Time</div><div class='g_o_stat_value'>"+secondsToFullTime(item.time_cost)+"</div>";
	}

	if (item.item_type=='Development'){
		nameString=item.name+" ("+item.item_type+")";
		image_src="images/icons/wide_development/"+item.id+".jpg";
		description=item.description+"<br><br>"+item.bonus_description;
		stats="<div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_cost)+"</div></div>";
		stats+="<div class='g_o_stat_name'>Time</div><div class='g_o_stat_value'>"+secondsToFullTime(item.time_cost)+"</div>";
	}

	if (item.item_type=='Facility'){
		nameString=item.name+" ("+item.item_type+")";
		var fac_image=returnFacilityImage(item.id);
		image_src="images/icons/facility/"+fac_image;
		description=item.description+"<br><br>"+item.bonus_description;
		stats="<div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_cost)+"</div></div>";
		stats+="<div class='g_o_stat_name'>Time</div><div class='g_o_stat_value'>"+secondsToFullTime(item.time_cost)+"</div>";
	}
	if (item.item_type=='Mission'){
		nameString=item.mission_name+" ("+item.item_type+")";
		var pack=returnMissionPackById(item.pack_id);
		var pack_image=pack.pack_image;

		image_src="images/fixed/missions/"+pack_image;
		description=item.mission_description;
		stats="<div class='g_o_stat_name'>Pack</div><div class='g_o_stat_value'>"+pack.pack_name+"</div>";
		stats+="<div class='g_o_stat_name'>Difficulty</div><div class='g_o_stat_value'>"+item.difficult_rating+"</div>";
	}



	if (item.item_type=='Productionitem'){
		nameString=item.name+" ("+"Unit"+")";
		var fac_image=returnFacilityImage(item.id);
		image_src="images/icons/wide_production/"+item.id+".jpg";
		description=item.description;
		if (item.id>400 && item.id<411){
			// minor ship
			stats="<div style='text-align:center;font-size:10px;'>Cost</div><div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_cost)+"</div></div>";
			stats+="<div style='text-align:center;font-size:10px;''>Upkeep / hour</div><div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_upkeep_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_upkeep_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_upkeep_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_upkeep_cost)+"</div></div>";
			stats+="<div class='g_o_stat_name'>Strength</div><div class='g_o_stat_value'>"+prettyPrint(shipToStrength(id))+"</div>";
			stats+="<div class='g_o_stat_name'>Pri. Firepower</div><div class='g_o_stat_value'>"+item.primary_guns+" * "+item.primary_rateoffire+" * "+prettyPrint(item.primary_weaponstrength)+"</div>";
			stats+="<div class='g_o_stat_name'>Sec. Firepower</div><div class='g_o_stat_value'>"+item.secondary_guns+" * "+item.secondary_rateoffire+" * "+item.secondary_weaponstrength+"</div>";
			stats+="<div class='g_o_stat_name'>Ter. Firepower</div><div class='g_o_stat_value'>"+item.tertiary_guns+" * "+item.tertiary_rateoffire+" * "+item.tertiary_weaponstrength+"</div>";
			stats+="<div class='g_o_stat_name'>Hull</div><div class='g_o_stat_value'>"+prettyPrint(item.hullstrength)+"</div>";
			stats+="<div class='g_o_stat_name'>Shield</div><div class='g_o_stat_value'>"+prettyPrint(item.shieldstrength)+"</div>";
			stats+="<div class='g_o_stat_name'>Maneuverability</div><div class='g_o_stat_value'>"+prettyPrint(item.maneuverability)+"</div>";

			description+="<div style='margin-top:5px;font-size:10px;'>This is a minor ship and must be placed inside a capital ship to travel.</div>";

		}
		else if (item.id==430){
			// scout
			stats="<div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_cost)+"</div></div>";
			stats+="<div  style='margin-top:5px;'>This is a special intel-unit which is launched from the starmap towards a selected planet.</div>";
		}
		else if (item.id==431){
			// prospecting ship
			stats="<div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_cost)+"</div></div>";
			stats+="<div  style='margin-top:5px;'>* This is a special unit which is launched from the starmap towards a selected cluster.</div>";
		}
		else if (item.id==432 || item.id==433 || item.id==434 ){
			// salvage, repair or boarding special ship
			stats="<div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_cost)+"</div></div>";
			stats+="<div class='g_o_stat_name'>Hull</div><div class='g_o_stat_value'>"+prettyPrint(item.hullstrength)+"</div>";
			stats+="<div class='g_o_stat_name'>Shield</div><div class='g_o_stat_value'>"+prettyPrint(item.shieldstrength)+"</div>";
			//stats+="<div class='g_o_description_addon'>This ship has special abilities and does not target enemies and shoot like normal units.</div>";

		}
		else if (item.id==435 || item.id==436 ){
			// transports
			stats="<div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_cost)+"</div></div>";
			if (item.primary_weaponstrength>0){
				stats+="<div class='g_o_stat_name'>Pri. Firepower</div><div class='g_o_stat_value'>"+item.primary_guns+" * "+item.primary_rateoffire+" * "+prettyPrint(item.primary_weaponstrength)+"</div>";
				stats+="<div class='g_o_stat_name'>Sec. Firepower</div><div class='g_o_stat_value'>"+item.secondary_guns+" * "+item.secondary_rateoffire+" * "+item.secondary_weaponstrength+"</div>";
				stats+="<div class='g_o_stat_name'>Ter. Firepower</div><div class='g_o_stat_value'>"+item.tertiary_guns+" * "+item.tertiary_rateoffire+" * "+item.tertiary_weaponstrength+"</div>";
			}
			stats+="<div class='g_o_stat_name'>Hull</div><div class='g_o_stat_value'>"+prettyPrint(item.hullstrength)+"</div>";
			stats+="<div class='g_o_stat_name'>Shield</div><div class='g_o_stat_value'>"+prettyPrint(item.shieldstrength)+"</div>";
			stats+="<div class='g_o_stat_name'>Cargo</div><div class='g_o_stat_value'>"+prettyPrint(item.cargo_capacity)+"</div>";
		}

		else {
			stats="<div style='text-align:center;font-size:10px;'>Cost</div><div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_cost)+"</div></div>";
			stats+="<div style='text-align:center;font-size:10px;''>Upkeep / hour</div><div class='g_o_cost_field'><div class='g_o_cost_value'>"+prettyPrint(item.h_upkeep_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.i_upkeep_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.s_upkeep_cost)+"</div><div class='g_o_cost_value'>"+prettyPrint(item.n_upkeep_cost)+"</div></div>";
			stats+="<div class='g_o_stat_name'>Strength</div><div class='g_o_stat_value'>"+prettyPrint(shipToStrength(id))+"</div>";
			stats+="<div class='g_o_stat_name'>Pri. Firepower</div><div class='g_o_stat_value'>"+item.primary_guns+" * "+item.primary_rateoffire+" * "+prettyPrint(item.primary_weaponstrength)+"</div>";
			stats+="<div class='g_o_stat_name'>Sec. Firepower</div><div class='g_o_stat_value'>"+item.secondary_guns+" * "+item.secondary_rateoffire+" * "+item.secondary_weaponstrength+"</div>";
			stats+="<div class='g_o_stat_name'>Ter. Firepower</div><div class='g_o_stat_value'>"+item.tertiary_guns+" * "+item.tertiary_rateoffire+" * "+item.tertiary_weaponstrength+"</div>";
			stats+="<div class='g_o_stat_name'>Hull</div><div class='g_o_stat_value'>"+prettyPrint(item.hullstrength)+"</div>";
			stats+="<div class='g_o_stat_name'>Shield</div><div class='g_o_stat_value'>"+prettyPrint(item.shieldstrength)+"</div>";
			stats+="<div class='g_o_stat_name'>Maneuverability</div><div class='g_o_stat_value'>"+prettyPrint(item.maneuverability)+"</div>";



			//if (item.id>500){
			//	description+="<div style='margin-top:5px;font-size:10px;'>This is a Planetary Defensive Unit and it can not be moved into fleets or sent to outposts.</div>";
			//}

		}
	} // end production item

	if (item.id>800 && item.id<900 ){
		// Techpoint thingie
		image_src="images/icons/techtree/"+item.id+".jpg";
		description=item.description;
		nameString=item.name+" (TechPoint)";
		var thisTech=returnNewTechName(item.branch);
		stats="<div class='g_o_stat_name'>Tech</div><div class='g_o_stat_value'>"+thisTech+"</div>";
		stats+="<div class='g_o_stat_name'>Tier</div><div class='g_o_stat_value'>"+item.tier+"</div>";

	}


	var reqObj=checkAllRequirementsForItemId(id);
	if (reqObj.development && reqObj.research && reqObj.facility && reqObj.techtree && reqObj.special){
		$("#gameInfoBoxRequirementsButton").removeClass("red").addClass("green");
	}
	else {
		$("#gameInfoBoxRequirementsButton").removeClass("green").addClass("red");
	}

	$("#gameInfoBoxRequirementsButton").show().off("click");
	document.getElementById("gameInfoBoxRequirementsButton").setAttribute('onclick','showBuildTreeInfo('+id+')');


	//document.getElementById('g_o_name_container').removeAttribute("onclick");
	//document.getElementById('g_o_name_container').setAttribute("onclick","directNavToUnit()");

	document.getElementById('g_o_image').src=image_src;
	document.getElementById('g_o_name_container').innerHTML=nameString;
	document.getElementById('g_o_description_container').innerHTML=description;
	document.getElementById('g_o_stats_container').innerHTML=stats;

if (item.id>800 && item.id<900 ){
	// special considerations
	$("#gameInfoBoxRequirementsButton").hide();
	$("#g_o_image_container").css({'width':'100px'});
	$("#g_o_image_container").css({'left':'140px'});
}
else {
	$("#g_o_image_container").css({'width':'250px'});
	$("#g_o_image_container").css({'left':'70px'});
}

if (id>2000){
	$("#gameInfoBoxRequirementsButton").hide();
}

	$("#game_object_info_box_container").show();

}

function completeNick(){
	// This is a bit tricky, as we need to find the current word..
	var str=document.getElementById('chat_input_field').value;
	if (str.length>1){
		var arr=str.split(" ");
		var lastWord=arr[arr.length-1];
		if (lastWord.length>1){
			// Ok, we should be looking for a nickname in the current channel in the stored messages...
			var msgs=returnMessagesByChannelName(ad2460.selectedChannel);
			var i=0;
			for (i=msgs.length-1;i>=0 ;i-- ){
				var cmpNick=msgs[i].nick;
				if (cmpNick.toLowerCase().substr(0,lastWord.length)==lastWord.toLowerCase()){
					arr[arr.length-1]=cmpNick;
					document.getElementById('chat_input_field').value=arr.join(" ");
					return;
				}
			}
		}
	}
}

function returnMessagesByChannelName(name){
	var i=0;
	for (i=0;i<ad2460.subscribedChannels.length ;i++ ){
		if (ad2460.subscribedChannels[i].channel==name){
			return ad2460.subscribedChannels[i].messages;
		}
	}
}
function addChatCombatLink(e){

	var org=$("#chat_input_field").val();
	if (e.shiftKey==true){
		org+='(SUMMARY:'+ad2460.combat.loadedLaunchData.view_id+')';
	}
	else if (e.ctrlKey==true){
		//org+='(SUMMARY:'+ad2460.combat.loadedLaunchData.view_id+')';
		window.open("combat.pl?id="+ad2460.combat.loadedLaunchData.view_id, "_blank", "toolbar=no,scrollbars=no");
		closeBattleViewClick();
	}
	else {
		org+='(LAUNCH:'+ad2460.combat.loadedLaunchData.view_id+')';
	}

	$("#chat_input_field").focus();
	$("#chat_input_field").val(org);
}

function chatban(player_id){
	$.post('actionhandler.pl', {action:'chatban', player_id:player_id}, function(data){ parseInfo(data);});
}
function unban(player_id){
	$.post('actionhandler.pl', {action:'unban', player_id:player_id}, function(data){ parseInfo(data);});
}
// fix for marketplace darkpanel click duuh
var latestAllyNewsId=0;

var bank_log_days=5;

// SetCookie("bank_log_days", '5', window.location.host,90);
// ReadCookie('bank_log_days');

$(document).ready(function() {
	$("#marketplace_darkpanel").click(function(event){
	  event.stopPropagation();
	});
	ad2460.allianceData.bank_log_days=Number(ReadCookie('bank_log_days'));
	if (ad2460.allianceData.bank_log_days<5){
		ad2460.allianceData.bank_log_days=5;
	}
});

function returnAllianceById(id){
	var i=0;
	for (i=0;i<ad2460.allianceCache.length ;i++ ){
		if (ad2460.allianceCache[i].alliance_id==id){
			return ad2460.allianceCache[i];
		}
	}
	return false;
}

function createAllianceClick(){
	var thisName=document.getElementById('new_alliance_name_input').value;
	// An alliance name may only contain A-Z, 0-9, underscores, +, - and =
	// strict_wash_allow_space will deal with the washing server-side
	$.post('actionhandler.pl', {action:'create_new_alliance',alliance_name:thisName}, function(data){ parseInfo(data);});
}

function reloadAllianceData(callback_string){
	$.post('actionhandler.pl', {action:'reload_alliance_data'}, function(data){
		parseInfo(data);
		eval(callback_string);
		updateChat();
		if (chatInterval==false){
			chatInterval=setInterval ( function(){updateChat()}, 4000 );
		}
	});
}

function removeAllianceTempBoxes(){
	$("#no_allianse_alliancepane").hide();
	$("#allianceinvites").hide();
	$("#alliancemembers_nopanel").hide();
}

function showNormalAlliancePanels(){
	$("#no_allianse_alliancepane").hide();
	$("#allianceinvites").hide();
	$("#alliancemembers_nopanel").hide();
	$("#marketplace_nopanel").hide();
	$("#alliancedev_nopanel").hide();

	$("#alliancepane").show();
	$("#alliance_management").show();
	$("#alliance_members").show();
	$("#marketplace").show();
	$("#alliancedev").show();
}


function showNoAlliancePanels(){
	$("#no_allianse_alliancepane").show();
	$("#allianceinvites").show();
	$("#alliancemembers_nopanel").show();
	$("#marketplace_nopanel").show();
	$("#alliancedev_nopanel").show();

	$("#alliancepane").hide();
	$("#alliancemanagement_panel").hide();
	$("#alliancemembers_panel").hide();
	$("#marketplace_panel").hide();
	$("#alliancedev_panel").hide();
}

function updateOwnAllianceData(id, rank, name, logo, motd, alliance_information, score_ranking, strength_ranking, xp_ranking, alliance_fleet_max_rank, alliance_tactics_max_rank, bankholders){
	ad2460.allianceData.id=id;
	ad2460.allianceData.rank_id=rank;
	ad2460.allianceData.name=name;
	ad2460.allianceData.logo=logo;
	ad2460.allianceData.motd=motd;
	ad2460.allianceData.alliance_information=alliance_information;
	ad2460.allianceData.score_ranking=score_ranking;
	ad2460.allianceData.strength_ranking=strength_ranking;
	ad2460.allianceData.xp_ranking=xp_ranking;
	ad2460.allianceData.alliance_fleet_max_rank=alliance_fleet_max_rank;
	ad2460.allianceData.alliance_tactics_max_rank=alliance_tactics_max_rank;
	ad2460.allianceData.bankholders=bankholders;
	renderOwnAllianceData();

	//renderAllianceFrontMOTD();


}

function nth_ocurrence(str, needle, nth) {
  for (i=0;i<str.length;i++) {
    if (str.charAt(i) == needle) {
        if (!--nth) {
           return i;
        }
    }
  }
  return false;
}

ad2460.last_motd_render=0;
ad2460.last_alliance_motd_render=0;


function renderMOTD(forced){
	var d=new Date;
	//console.log("Alliance MOTD rendered.."+d);

	var motd=ad2460.motd
	motd = motd.replace(/(?:\r\n|\r|\n)/g, '<br />');
	$("#front_ally_motd").html(iconify(linkify(motd)));
	$("#front_ally_motd_header").html("Game Information").css({"color":"white"});

	ad2460.last_motd_render=ad2460.serverTime;

}

function renderAllianceFrontMOTD(forced){
	//if (forced!=true && ad2460.last_motd_render>ad2460.last_alliance_motd_render && ad2460.serverTime<ad2460.last_motd_render+60){
	//	return;
	//}

	//if (forced!=true && ad2460.last_alliance_motd_render>ad2460.serverTime-60){
	//	return;
	//}


	var d=new Date;
	// console.log("Alliance MOTD rendered.."+d);
	if (ad2460.allianceData.id>0){
		var motd=ad2460.allianceData.motd;
		if (ad2460.extendedGUI==true){
			var cutoff=500;

			if (nth_ocurrence(motd,'\n',8)>0){
				cutoff=nth_ocurrence(motd,'\n',8);
			}

			// var tmpStr= motd.substr(0, cutoff)+"...";
			var tmpStr= motd;
			tmpStr = tmpStr.replace(/(?:\r\n|\r|\n)/g, '<br />');
			$("#front_ally_motd").html(linkify(tmpStr));
			$("#front_ally_motd_header").html("Alliance MOTD").css({"color":"cyan"});

		}
		else {
			var cutoff=ad2460.allianceData.motd.indexOf('\n\n');
			if (cutoff>210)	{
				cutoff=210;
			}

			if (cutoff==-1){
				// There was no linebreak...
				// show the 100 first chars...
				cutoff=200;
			}

			//var tmpStr= motd.substr(0, cutoff)+"...";
			var tmpStr= motd;
			tmpStr = tmpStr.replace(/(?:\r\n|\r|\n)/g, '<br />');
			$("#front_ally_motd").html(iconify(linkify(tmpStr)));
			$("#front_ally_motd_header").html("Alliance MOTD").css({"color":"cyan"});

		}
	}
	else {
		$("#front_ally_motd").html("You should really consider joining an alliance. They can help you out a great deal in the early game! <br><br>Keep in mind, until someone reaches level 5, no alliances can be created!");
	}
	ad2460.last_alliance_motd_render=ad2460.serverTime;
}

function toggleMotdDisplay(){
	if (ad2460.last_motd_render>ad2460.last_alliance_motd_render){
		renderAllianceFrontMOTD(true);
	}
	else {
		renderMOTD(true);
	}
}

function renderOwnAllianceData(){
	$("#alliance_pane_alliance_name").html(ad2460.allianceData.name);
	document.getElementById('crest').setAttribute('src', pathToAllianceLogos+ad2460.allianceData.logo);
	$("#alliance_motd").html(convertLineBreaks(iconify(linkify(ad2460.allianceData.motd))));
	$("#alliance_pane_score_ranking_number").html(ad2460.allianceData.score_ranking);
	$("#alliance_pane_strength_ranking_number").html(ad2460.allianceData.strength_ranking);
	$("#alliance_pane_xp_ranking_number").html(ad2460.allianceData.xp_ranking);
	//$("#alliance_information").html(convertLineBreaks(iconify(ad2460.allianceData.alliance_information)));
	// No rendering of the alliance information?? Humm...
}

function addAllianceMemberEntry(user_id,name,rank,tag_id, score, strength, level, xp, membership_time, homeworld_name, homeworld_id, outposts, alliance_fleet_ships, public_note, last_online, x, y, avatar, amnesty_until, asleep_until){
	var member=new AllianceMember(user_id, name, rank, tag_id, score, strength, level, xp, membership_time, homeworld_name, homeworld_id, outposts, alliance_fleet_ships, public_note, last_online, x, y, avatar, amnesty_until, asleep_until);
	ad2460.allianceData.memberlist.push(member);
	if (rank==1){
		$("#alliance_pane_leader_name").html(name);
	}
}
function clearAllianceMemberList(){
	ad2460.allianceData.memberlist=[];
	removeChildNodes('member_dir');

}

function returnAllianceTag(tag_id){
	return ad2460.allianceMemberTags[tag_id];
}

function resignLeadershipClick(){
	var text="If there are Admirals available in the alliance, you can chose to give ownership of the alliance to him and step down as alliance-leader. You will be demoted to the third highest rank, the one normally called Commodore. If there are no Admirals, you can not step down as leader.";
	showConfirmationPopup(text,"Yes","No","resignLeadershipConfirmed();hideConfirmationPopup();","");
}

function resignLeadershipConfirmed(){
	var new_leader_id=$("#new_leader_dropdown").val();
	$.post('actionhandler.pl', {action:'resign_leadership',new_leader_id:new_leader_id}, function(data){ parseInfo(data);});
}

function fillNewLeaderDropdown(){
	var dropdown=document.getElementById("new_leader_dropdown");
    var i;
    for(i=dropdown.options.length-1;i>=0;i--){
        dropdown.remove(i);
    }
	// cleaned

	dropdown.options[dropdown.options.length] = new Option("Select new leader" ,"0");
	for (i=0;i<ad2460.allianceData.memberlist.length ;i++ ){
		var m=ad2460.allianceData.memberlist[i];
		if (m.rank==2){
			dropdown.options[dropdown.options.length] = new Option(m.name ,""+m.user_id);
		}
	}
}

function renderAllianceMemberList(){
	var i=0;
	var parent=document.getElementById('member_dir');
	var officerCount=0;
	for (i=0;i<ad2460.allianceData.memberlist.length ;i++ ){

		// Create the 3 divs
		var myclass='table_selection';
		if (i % 2 == 0){
			myclass+=' oddline';
		}
		else {
			myclass+=' evenline';
		}

		var memberListEntry=document.createElement('div');
		memberListEntry.setAttribute("class",myclass);
		memberListEntry.setAttribute("onclick","allianceMemberlistClick("+ad2460.allianceData.memberlist[i].user_id+")");

		var memberNameDiv=document.createElement('div');
		memberNameDiv.setAttribute("class",'table_alliance_member_name');
		memberNameDiv.innerHTML=ad2460.allianceData.memberlist[i].name;

		var memberStrengthDiv=document.createElement('div');
		memberStrengthDiv.setAttribute("class",'table_alliance_member_strength');
		memberStrengthDiv.innerHTML=prettyPrint(ad2460.allianceData.memberlist[i].strength);

		var memberRankDiv=document.createElement('div');
		memberRankDiv.setAttribute("class",'table_alliance_member_rank');
		memberRankDiv.innerHTML=ad2460.allianceData.rankDetails[ad2460.allianceData.memberlist[i].rank-1].rank_name;

		var memberOnlineDiv=document.createElement('div');
		var online_ago=ad2460.serverTime-ad2460.allianceData.memberlist[i].last_online;
		var onlineString="&nbsp;";
		if (online_ago<180){
			onlineString="*";
			memberOnlineDiv.setAttribute("title",'Online now');
		}
		memberOnlineDiv.setAttribute("class",'table_alliance_member_online');
		memberOnlineDiv.innerHTML=onlineString;

		memberListEntry.appendChild(memberNameDiv);
		memberListEntry.appendChild(memberStrengthDiv);
		memberListEntry.appendChild(memberRankDiv);
		memberListEntry.appendChild(memberOnlineDiv);

		parent.appendChild(memberListEntry);

		if (ad2460.allianceData.memberlist[i].rank<=8){
			officerCount++;
		}

	}

	$("#alliance_pane_members_number").html(ad2460.allianceData.memberlist.length);
	$("#alliance_pane_officers_number").html(officerCount);

}

function allianceMemberlistClick(user_id){
	var thisMember=returnAllianceMember(user_id);

	if (thisMember!=false){
		if (thisMember.avatar != ''){
			$("#selected_member_avatar_image").attr("src","images/uploads/avatars/"+thisMember.avatar);
			$("#selected_member_avatar_image").show();
		}
		else {
			$("#selected_member_avatar_image").attr("src","images/icons/missingimage.png");
			$("#selected_member_avatar_image").show();
		}

		$("#alliance_memberlist_selected_member_name").html(thisMember.name);
		$("#alliance_memberlist_selected_member_rank").html(ad2460.allianceData.rankDetails[thisMember.rank-1].rank_name);

		$("#selected_member_homeworld").html(thisMember.homeworld_name);
		document.getElementById('selected_member_homeworld').setAttribute("onclick","zoomInToXY("+thisMember.x+","+thisMember.y+")");
		document.getElementById('selected_member_homeworld').style.cursor="pointer";
		document.getElementById('selected_member_homeworld').style.fontWeight="bold";
		$("#selected_member_outposts").html(thisMember.outposts);
		$("#selected_member_strength").html(thisMember.strength);
		$("#selected_member_alliance_ships").html(thisMember.alliance_fleet_ships);

		$("#selected_member_join_date").html(formatMessageTimestamp(thisMember.membership_time));
		$("#selected_member_last_online").html(formatMessageTimestamp(thisMember.last_online));
		$("#selected_member_score").html(thisMember.score);
		$("#selected_member_level").html(thisMember.level);

		var vacationString='No';
		var graceString='No';

		if (thisMember.asleep_until>0){	vacationString='Yes';	}
		if (thisMember.amnesty_until>ad2460.serverTime){	graceString='Yes';	}

		$("#selected_member_alliance_vacation").html(vacationString);
		$("#selected_member_alliance_grace").html(graceString);

		//$("#selected_member_public_note").html(thisMember.public_note);

		ad2460.allianceData.selected_member_id=user_id;
		var access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_promotion;

		if (access>0 && thisMember.rank>=ad2460.allianceData.rank_id){
			$("#member_promote").show();
			$("#member_demote").show();
			$("#member_remove").show();
			$("#self_demote").hide();
			$("#new_leader_dropdown").hide();

		}
		else {
			$("#member_promote").hide();
			$("#member_demote").hide();
			$("#member_remove").hide();
			$("#self_demote").hide();
			$("#new_leader_dropdown").hide();
		}

		if (ad2460.allianceData.rank_id==1 && ad2460.allianceData.selected_member_id==ad2460.user_id){
			// The leader is looking at himself
			$("#member_promote").hide();
			$("#member_demote").hide();
			$("#member_remove").hide();
			$("#self_demote").show();
			fillNewLeaderDropdown();
			$("#new_leader_dropdown").show();
		}

		if (access>0){
			$("#selected_member_pubinfo_textarea").show();
			document.getElementById("selected_member_pubinfo_textarea").value=thisMember.public_note;
			$("#selected_member_pubinfo_div").hide();
			$("#member_info_submit").show();
		}
		else {
			$("#selected_member_pubinfo_textarea").hide();
			$("#member_info_submit").hide();
			document.getElementById("selected_member_pubinfo_div").innerHTML=convertLineBreaks(iconify(linkify(thisMember.public_note)));
			$("#selected_member_pubinfo_div").show();
		}

		document.getElementById('member_converse').setAttribute("onclick","initiateConversationWithName(\""+thisMember.name+"\")");

		if (user_id==ad2460.user_id){
			$("#member_converse").hide();
		}
		else {
			$("#member_converse").show();
		}

		var tagDropdown=document.getElementById('alliance_member_responsibility_dropdown');
		tagDropdown.selectedIndex=thisMember.tag_id;
		tagDropdown.setAttribute("onchange","updateAllianceMemberResponsibility("+user_id+")");
		if (ad2460.allianceData.rank_id!=1){
			tagDropdown.setAttribute("disabled",true);
		}
	}
}


function submitMemberInfoClick(){
	var new_text=document.getElementById('selected_member_pubinfo_textarea').value;
	$.post('actionhandler.pl', {action:'submit_member_pubinfo',new_text:new_text,member_id:ad2460.allianceData.selected_member_id}, function(data){ parseInfo(data);});
}

function updateAllianceMemberResponsibility(user_id){
	var tagDropdown=document.getElementById('alliance_member_responsibility_dropdown');
	var new_tag_id=tagDropdown.selectedIndex;
	$.post('actionhandler.pl', {action:'update_alliance_member_responsibility',member_id:user_id, new_tag_id:new_tag_id}, function(data){ parseInfo(data);});

}

function unselectAllianceMember(){
	ad2460.allianceData.selected_member_id=0;
	$("#member_promote").hide();
	$("#member_demote").hide();
	$("#member_remove").hide();
	$("#alliance_memberlist_selected_member_name").html("No member selected");
	$("#alliance_memberlist_selected_member_rank").html("N/A");
}

function returnAllianceMember(user_id){
	var found=0;
	var i=0;
	for (i=0;i<ad2460.allianceData.memberlist.length ;i++ ){
		var thisMember=ad2460.allianceData.memberlist[i];
		if (thisMember.user_id==user_id){
			return thisMember;
		}
	}
	return false;
}

function alliancePromoteClick(){
	$.post('actionhandler.pl', {action:'alliance_promote',member_id:ad2460.allianceData.selected_member_id}, function(data){ parseInfo(data);});
}
function allianceDemoteClick(){
	$.post('actionhandler.pl', {action:'alliance_demote',member_id:ad2460.allianceData.selected_member_id}, function(data){ parseInfo(data);});
}
function allianceKickClick(){
	$.post('actionhandler.pl', {action:'alliance_kick',member_id:ad2460.allianceData.selected_member_id}, function(data){ parseInfo(data);});
}

function updateMemberRank(member_id,new_rank_id){
	var thisMember=returnAllianceMember(member_id);
	if (thisMember!=false){
		thisMember.rank=new_rank_id;
		removeChildNodes('member_dir');
		ad2460.allianceData.memberlist.sort(function(a, b){ return a.rank-b.rank});
		renderAllianceMemberList();
		allianceMemberlistClick(member_id);
	}
}

function clearAllianceInvitedList(){
	ad2460.allianceData.invitedlist=[];
	removeChildNodes('inviteddir');
}


function addAllianceInvitedEntry(user_id, name, invite_timestamp){
	var invited=new AllianceInvitedMember(user_id, name, invite_timestamp);
	ad2460.allianceData.invitedlist.push(invited);
}



function clearMyAllianceInvitations(){
	ad2460.allianceData.invitations=[];
	removeChildNodes('allYourInvites');
}

function addAllianceInvitationEntry(alliance_id, alliance_name, invite_timestamp){
	var invitation=new AllianceInvitations(alliance_id, alliance_name, invite_timestamp);
	ad2460.allianceData.invitations.push(invitation);
}

function removeAllianceInvitation(alliance_id){
	var i=0;
	for (i=0;i<ad2460.allianceData.invitations.length ;i++ ){
		if (ad2460.allianceData.invitations[i].alliance_id==alliance_id){
			ad2460.allianceData.invitations.splice(i,1);
			i--;
		}
	}
	clearMyAllianceInvitations();
	renderMyAllianceInvitations();

}

function renderMyAllianceInvitations(){
	var i=0;
	if (ad2460.allianceData.invitations.length>0){
		blinkElementById('alliancebutton');blinkElementById('alliancebutton');
		var parent=document.getElementById('allYourInvites');
		for (i=0;i<ad2460.allianceData.invitations.length ;i++ ){

			var myclass='table_selection';
			if (i % 2 == 0){
				myclass+=' oddline';
			}
			else {
				myclass+=' evenline';
			}

			var invitationListEntry=document.createElement('div');
			invitationListEntry.setAttribute("class",myclass);
			//memberListEntry.setAttribute("onclick","allianceMemberlistClick("+ad2460.allianceData.invitedlist[i].user_id+")");

			var invitationNameDiv=document.createElement('div');
			invitationNameDiv.setAttribute("class",'table_alliance_member_name');
			invitationNameDiv.innerHTML=ad2460.allianceData.invitations[i].name;

			var invitationAcceptDiv=document.createElement('div');
			invitationAcceptDiv.setAttribute("class",'table_invite_accept');
			invitationAcceptDiv.innerHTML="Accept";
			invitationAcceptDiv.setAttribute("onclick","acceptAllianceInvitationClick("+ad2460.allianceData.invitations[i].alliance_id+")");

			var invitationRejectDiv=document.createElement('div');
			invitationRejectDiv.setAttribute("class",'table_invite_reject');
			invitationRejectDiv.innerHTML="Reject";
			invitationRejectDiv.setAttribute("onclick","rejectAllianceInvitationClick("+ad2460.allianceData.invitations[i].alliance_id+")");

			invitationListEntry.appendChild(invitationNameDiv);
			invitationListEntry.appendChild(invitationAcceptDiv);
			invitationListEntry.appendChild(invitationRejectDiv);

			parent.appendChild(invitationListEntry);
		}
	}
}

function acceptAllianceInvitationClick(alliance_id){
	$.post('actionhandler.pl', {action:'accept_alliance_invitation',alliance_id:alliance_id}, function(data){ parseInfo(data);});
}

function rejectAllianceInvitationClick(alliance_id){
	$.post('actionhandler.pl', {action:'reject_alliance_invitation',alliance_id:alliance_id}, function(data){ parseInfo(data);});
}

function allianceManagementStationsSettingsClick(){
	ad2460.allianceData.lastAllianceMenuSelected='stations';
	var sidepanel=document.getElementById('alliance_management_sidepanel_content');
	removeChildNodes('alliance_management_sidepanel_content');
	var infopanel=document.getElementById('alliance_management_infopanel_content');
	removeChildNodes('alliance_management_infopanel_content');
	var header=createSingleElement('div', 'alliance_section_side_header', 'alliance_section_side_header', 'Stations', '');
	sidepanel.appendChild(header);

	var contentcontainer=document.createElement('div');
	contentcontainer.setAttribute("class",'station_bonus_container');

	var h1=document.createElement('div');
	h1.setAttribute("class",'alliance_bonus_header one');
	h1.innerHTML='Primary Damage';

	var h2=document.createElement('div');
	h2.setAttribute("class",'alliance_bonus_header two');
	h2.innerHTML='Secondary Damage';

	var h3=document.createElement('div');
	h3.setAttribute("class",'alliance_bonus_header three');
	h3.innerHTML='Tertiary Damage';

	var h4=document.createElement('div');
	h4.setAttribute("class",'alliance_bonus_header four');
	h4.innerHTML='Shield Regeneration';

	var h5=document.createElement('div');
	h5.setAttribute("class",'alliance_bonus_header five');
	h5.innerHTML='Absorbption';

	var h6=document.createElement('div');
	h6.setAttribute("class",'alliance_bonus_header six');
	h6.innerHTML='Production-cost';

	var h7=document.createElement('div');
	h7.setAttribute("class",'alliance_bonus_header seven');
	h7.innerHTML='OP Mining';

	var h8=document.createElement('div');
	h8.setAttribute("class",'alliance_bonus_header eight');
	h8.innerHTML='HW Mining';

	var e1=document.createElement('div');
	e1.setAttribute("class",'alliance_bonus_entry one');
	e1.innerHTML=ad2460.allianceData.sectorBonuses.primary_damage+' %';
	var e2=document.createElement('div');
	e2.setAttribute("class",'alliance_bonus_entry two');
	e2.innerHTML=ad2460.allianceData.sectorBonuses.secondary_damage+' %';
	var e3=document.createElement('div');
	e3.setAttribute("class",'alliance_bonus_entry three');
	e3.innerHTML=ad2460.allianceData.sectorBonuses.tertiary_damage+' %';
	var e4=document.createElement('div');
	e4.setAttribute("class",'alliance_bonus_entry four');
	e4.innerHTML=ad2460.allianceData.sectorBonuses.shield_regen+' %';
	var e5=document.createElement('div');
	e5.setAttribute("class",'alliance_bonus_entry five');
	e5.innerHTML=ad2460.allianceData.sectorBonuses.absorbption+' %';
	var e6=document.createElement('div');
	e6.setAttribute("class",'alliance_bonus_entry six');
	e6.innerHTML=ad2460.allianceData.sectorBonuses.production_cost+' %';
	var e7=document.createElement('div');
	e7.setAttribute("class",'alliance_bonus_entry seven');
	e7.innerHTML=ad2460.allianceData.sectorBonuses.outpost_mining+' %';
	var e8=document.createElement('div');
	e8.setAttribute("class",'alliance_bonus_entry eight');
	e8.innerHTML=ad2460.allianceData.sectorBonuses.homeworld_mining+' %';

	var s_img=document.createElement('div');
	s_img.setAttribute("class",'a_bonus_station_image');
	var s_desc=document.createElement('div');
	s_desc.setAttribute("class",'a_bonus_station_desc');
	s_desc.innerHTML='Station-bonuses are activated by controlling stations.<br>Each bonus shown is your share, as all these bonuses are divided between all members.';

	contentcontainer.appendChild(h1);
	contentcontainer.appendChild(h2);
	contentcontainer.appendChild(e1);
	contentcontainer.appendChild(e2);

	contentcontainer.appendChild(h3);
	contentcontainer.appendChild(h4);
	contentcontainer.appendChild(e3);
	contentcontainer.appendChild(e4);

	contentcontainer.appendChild(h5);
	contentcontainer.appendChild(h6);
	contentcontainer.appendChild(e5);
	contentcontainer.appendChild(e6);

	contentcontainer.appendChild(h7);
	contentcontainer.appendChild(h8);
	contentcontainer.appendChild(e7);
	contentcontainer.appendChild(e8);

	contentcontainer.appendChild(s_img);
	contentcontainer.appendChild(s_desc);

	var shade1=document.createElement('div');
	shade1.setAttribute("class",'tax_shader station');

	var shade2=document.createElement('div');
	shade2.setAttribute("class",'tax_shader2 station');

	contentcontainer.appendChild(shade1);
	contentcontainer.appendChild(shade2);

	sidepanel.appendChild(contentcontainer);

	var listHeaderContainer=document.createElement('div');
	listHeaderContainer.setAttribute("class",'station_list_header_container');

	var h1=document.createElement('div');
	h1.setAttribute("class",'station_list_header name');
	h1.innerHTML='Station';

	var h2=document.createElement('div');
	h2.setAttribute("class",'station_list_header coords');
	h2.innerHTML='Coords';

	var h3=document.createElement('div');
	h3.setAttribute("class",'station_list_header owner');
	h3.innerHTML='Health';

	var h4=document.createElement('div');
	h4.setAttribute("class",'station_list_header strength');
	h4.innerHTML='Strength';

	var h42=document.createElement('div');
	h42.setAttribute("class",'station_list_header intel');
	h42.innerHTML='Int';


	var h5=document.createElement('div');
	h5.setAttribute("class",'station_list_header actions');
	h5.innerHTML='Actions';

	listHeaderContainer.appendChild(h1);
	listHeaderContainer.appendChild(h2);
	listHeaderContainer.appendChild(h3);
	listHeaderContainer.appendChild(h4);
	listHeaderContainer.appendChild(h42);
	listHeaderContainer.appendChild(h5);

	infopanel.appendChild(listHeaderContainer);

	var listContainer=document.createElement('div');
	listContainer.setAttribute("class",'station_list_container');

	for (var i=0;i<ad2460.allianceData.stations.length;i++){
		var s=ad2460.allianceData.stations[i];

		var row_container=document.createElement('div');
		row_container.setAttribute("class",'station_list_entry_container');

		var h1=document.createElement('div');
		h1.setAttribute("class",'station_list_entry name');
		h1.innerHTML=s.name;

		var h2=document.createElement('div');
		h2.setAttribute("class",'station_list_entry coords planetlink');
		var coords=convertShortCoordsToLongCoords(s.x, s.y);
		h2.innerHTML=coords.q+':'+coords.s+':'+coords.g;
		h2.setAttribute("onclick",'zoomInToXY('+s.x+','+s.y+')');

		var h3=document.createElement('div');
		h3.setAttribute("class",'station_list_entry owner');
		if (s.health=='N/A'){
			h3.innerHTML=s.health;
		}
		else {
			var health=Math.floor(s.health);
			h3.innerHTML=health+' %';
			if (health<50){
				h3.setAttribute("class",'station_list_entry owner notenough');
			}
		}

		var h4=document.createElement('div');
		h4.setAttribute("class",'station_list_entry strength');
		if (s.strength=='N/A'){
			h4.innerHTML=s.strength;
		}
		else {
			h4.innerHTML=prettyPrint(s.strength);
		}


		var h42=document.createElement('div');
		h42.setAttribute("class",'station_list_entry intel');
		h42.innerHTML='<img style="height:25px;width:25px;" src="images/icons/intel_scout_alliance.png" onclick="showStationScoutings('+s.planet_id+')">';


		var h5=document.createElement('div');
		h5.setAttribute("class",'station_list_entry actions');
		h5.innerHTML='<div class="station_action_button" onclick="showStationTactics('+s.planet_id+')">Tactics</div><div class="station_action_button" onclick="showStationShips('+s.planet_id+')">Ships</div><div class="station_action_button" onclick="fetchFleetDonationLog('+s.fleets[0].fleet_id+')">Log</div>';

		row_container.appendChild(h1);
		row_container.appendChild(h2);
		row_container.appendChild(h3);
		row_container.appendChild(h4);
		row_container.appendChild(h42);
		row_container.appendChild(h5);
		if (s.planet_grace>ad2460.serverTime){
			var h6=document.createElement('div');
			h6.setAttribute("class",'station_list_entry grace');
			h6.style.width='400px';
//			<img class="planet_status_icon" id="planet_status_icon" src="images/icons/grace_icon.png">


			h6.innerHTML='<img class="planet_status_icon" id="planet_status_icon" src="images/icons/grace_icon.png" style="height:22px;vertical-align;middle;"> for '+secondsToFullTime(s.planet_grace-ad2460.serverTime);
			// h6.innerHTML='<img class="planet_status_icon" id="planet_status_icon" src="images/icons/grace_icon.png" style="height:22px;vertical-align;middle;"> until '+formatShortTime(convertToUTC(s.planet_grace));



			row_container.appendChild(h6);
		}

		/*
		var evacuate=document.createElement('div');
		evacuate.setAttribute("class",'fixed_button fixed_button_140_condensed');
		evacuate.setAttribute("onclick",'evacuateStationClick('+s.planet_id+')');
		evacuate.style.position='absolute';
		evacuate.style.top='25px';
		evacuate.style.left='391px';
		evacuate.innerHTML="<div class='fixed_button_regular_condensed'></div><div class='fixed_button_hover red22' style='opacity: 0;'></div><div class='fixed_button_click red22'></div><div class='dyna_button_text type3'>Evacuate</div>";
		row_container.appendChild(evacuate);
		*/


		listContainer.appendChild(row_container);
	}


	infopanel.appendChild(listContainer);
	addDynamicHelpButtons('alliance_stations');
}

function evacuateStationClick(planet_id){
	var mainText="Are you sure you wish to send all defending fleets back to their owners homeworlds, right now? Like, really?";
	var okText='Yes';
	var cancelText='No';
	var okClick='evacuateStation('+planet_id+');';
	var cancelClick='';
	var specialAttackedFlag=false;

	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick, specialAttackedFlag);
}

function evacuateStation(planet_id){
	// Send all defending fleets home
	$.post('actionhandler.pl', {action:'evacuate_station',planet_id:planet_id}, function(data){ parseInfo(data);});
	hideConfirmationPopup();
}

function showStationTactics(planet_id){
	// will only render for those who have the right to use ally-fleets
	// make an ajax-call to the server for the data and check access there.
	ad2460.fleetvars.selected_fleet_id=0;
	ad2460.fleetvars.selected_station_id=planet_id;

	var access=0;
	if (ad2460.allianceData.rank_id<=ad2460.allianceData.alliance_tactics_max_rank) {
		access=1;
	}

	shipListDown();
	// reset of that one is required
	var t=false;
	var i=0;
	for (i=0;i<ad2460.allianceData.stations.length ;i++ ){
		if (ad2460.allianceData.stations[i].planet_id==planet_id){
			if (typeof ad2460.allianceData.stations[i].tactics!=='undefined' && access==1){
				t=ad2460.allianceData.stations[i].tactics;
				renderSelectedFleetTactics('station', t);
				if (ad2460.openQuickMenues.selected_fleet_tactics==false){
					fleetTacticsPanelUp();
				}
				return;
			}
			else {
				systemFeedback('Error','Your rank does not allow you to see station-tactics.', 1, 3);
			}
		}
	}
}

function showBankFleetTactics(){
	ad2460.fleetvars.selected_fleet_id=ad2460.allianceData.bank.fleet.fleet_id;
	ad2460.fleetvars.selected_station_id=0;
	var access=0;
	if (ad2460.allianceData.rank_id<=ad2460.allianceData.alliance_tactics_max_rank) {
		access=1;
	}

	shipListDown();
	// reset of that one is required
	var t=false;
	var i=0;
	if (typeof ad2460.allianceData.bank.fleet.tactics!=='undefined' && access==1){
		t=ad2460.allianceData.bank.fleet.tactics;
		renderSelectedFleetTactics('station', t);
		if (ad2460.openQuickMenues.selected_fleet_tactics==false){
			fleetTacticsPanelUp();
		}
		return;
	}
	else {
		systemFeedback('Error','Your rank does not allow you to see bank-tactics.', 1, 3);
	}
}

function showStationShips(planet_id){
	var access=0;
	if (ad2460.allianceData.rank_id<=ad2460.allianceData.alliance_tactics_max_rank) {
		access=1;
	}

	if (access==0) {
		systemFeedback('Error','Access denied', 1, 3);
		return;
	}

	shipListUpStationcontingent(planet_id);
}

function clearStationFleets(){
	ad2460.allianceData.stationFleets=new Array;
}

function addStationFleet(fleet_id, owner_id, fleet_name, commander_id, shipcount, strength, battles, wins,losses,efficiency,shortage,current_x,current_y,org_mission_target_type,org_mission_target,org_mission_target_x,org_mission_target_y,org_mission_type,current_mission_target_type,current_mission_target,current_mission_target_x,current_mission_target_y,current_mission_type,next_mission_target_type,next_mission_target,next_mission_target_x,next_mission_target_y,next_mission_type,next_hyperspace_jump_time,last_hyperspace_jump_time,jump_range,mission_status,status,homeworld_fleet,storage_fleet,location_string,alliance_fleet,on_mission, upkeep_hassium, upkeep_neodymium, upkeep_strontium, upkeep_indium,eta,total_firepower,total_hull, auto_def){
	for (var i=0;i<ad2460.allianceData.stations.length ;i++ ){
		if (ad2460.allianceData.stations[i].x==current_x && ad2460.allianceData.stations[i].y==current_y){
			ad2460.allianceData.stations[i].fleets.push(new fleet(fleet_id, owner_id, fleet_name, commander_id, shipcount, strength, battles, wins,losses,efficiency,shortage,current_x,current_y,org_mission_target_type,org_mission_target,org_mission_target_x,org_mission_target_y,org_mission_type,current_mission_target_type,current_mission_target,current_mission_target_x,current_mission_target_y,current_mission_type,next_mission_target_type,next_mission_target,next_mission_target_x,next_mission_target_y,next_mission_type,next_hyperspace_jump_time,last_hyperspace_jump_time,jump_range,mission_status,status,homeworld_fleet,storage_fleet, location_string, alliance_fleet,on_mission, upkeep_hassium, upkeep_neodymium, upkeep_strontium, upkeep_indium,eta,total_firepower,total_hull, auto_def));
		}
	}


}

function addShipToStationFleet(unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410,  relative_strength){
	for (var s=0;s<ad2460.allianceData.stations.length ;s++ ){
		for (var f=0;f<ad2460.allianceData.stations[s].fleets.length ;f++ ){
			if (ad2460.allianceData.stations[s].fleets[f].fleet_id==fleet_id){
				ad2460.allianceData.stations[s].fleets[f].ships.push(new shipEntry(unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410,  relative_strength));
			}
		}
	}

	/*
	for (var i=0;i<ad2460.allianceData.stationFleets.length ;i++ ){
		if (ad2460.allianceData.stationFleets[i].fleet_id==fleet_id){
			ad2460.allianceData.stationFleets[i].ships.push(new shipEntry(unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410,  relative_strength));
		}
	}
	*/
}

function addStationTactics(planet_id, target_priority, target_switching, minimize_movement, fighter_priority, corvette_priority, retreat_percentage, retreat_type, retreat_if_even, retreat_if_unwinnable){
	var s=0;
	for (s=0;s<ad2460.allianceData.stations.length ;s++ ){
		if (ad2460.allianceData.stations[s].planet_id==planet_id){
			ad2460.allianceData.stations[s].tactics=new tacticSetup(planet_id, target_priority, target_switching, minimize_movement, fighter_priority, corvette_priority, retreat_percentage, retreat_type, retreat_if_even, retreat_if_unwinnable);
			ad2460.allianceData.stations[s].tactics.fleet_id=0;
			ad2460.allianceData.stations[s].tactics.planet_id=planet_id;
		}
	}
}

function showBankFleetShips(){
	var access=0;
	if (ad2460.allianceData.rank_id<=ad2460.allianceData.alliance_tactics_max_rank) {
		access=1;
	}

	if (access==0) {
		systemFeedback('Error','Access denied', 1, 3);
		return;
	}

	shipListUpLaunchfleet(ad2460.allianceData.bank.fleet);
}

function addShipToBankFleet(unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410,  relative_strength){
	ad2460.allianceData.bank.fleet.ships.push(new shipEntry(unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410,  relative_strength));
}

function setBankTactics(fleet_id, target_priority, target_switching, minimize_movement, fighter_priority, corvette_priority, retreat_percentage, retreat_type, retreat_if_even, retreat_if_unwinnable){
	ad2460.allianceData.bank.fleet.tactics=new tacticSetup(fleet_id, target_priority, target_switching, minimize_movement, fighter_priority, corvette_priority, retreat_percentage, retreat_type, retreat_if_even, retreat_if_unwinnable);
}

function updateAllianceSectorBonus(type, percent){
	if (type=='outpost_mining'){ ad2460.allianceData.sectorBonuses.outpost_mining=percent;	}
	else if (type=='homeworld_mining'){ ad2460.allianceData.sectorBonuses.homeworld_mining=percent;	}
	else if (type=='primary_damage'){ ad2460.allianceData.sectorBonuses.primary_damage=percent;	}
	else if (type=='secondary_damage'){ ad2460.allianceData.sectorBonuses.secondary_damage=percent;	}
	else if (type=='tertiary_damage'){ ad2460.allianceData.sectorBonuses.tertiary_damage=percent;	}
	else if (type=='shield_regen'){ ad2460.allianceData.sectorBonuses.shield_regen=percent;	}
	else if (type=='absorbption'){ ad2460.allianceData.sectorBonuses.absorbption=percent;	}
	else if (type=='production_cost'){ ad2460.allianceData.sectorBonuses.production_cost=percent;	}
}

function allianceManagementMilitarySettingsClick(){
	// Tempfunction, not yet ready for implementation
	ad2460.allianceData.lastAllianceMenuSelected='militarysettings';
	var sidepanel=document.getElementById('alliance_management_sidepanel_content');
	removeChildNodes('alliance_management_sidepanel_content');
	var infopanel=document.getElementById('alliance_management_infopanel_content');
	removeChildNodes('alliance_management_infopanel_content');

	var header=createSingleElement('div', 'alliance_section_side_header', 'alliance_section_side_header', 'Other Settings', '');
	sidepanel.appendChild(header);

	var selectcontainer=document.createElement('div');
	selectcontainer.setAttribute("class",'rank_manage_select');

	var explaincontainer=document.createElement('div');
	explaincontainer.innerHTML='Select the lowest rank who can use alliance-fleets:';

	var shade=document.createElement('div');
	shade.setAttribute("class",'invite_shade_bottom');

	var selectbox=document.createElement('select');
	selectbox.setAttribute("class",'rankselect');
	selectbox.setAttribute("id",'alliance_fleet_max_rank_dropdown');

	selectbox.options[selectbox.options.length] = new Option("Rank 1 ("+ad2460.allianceData.rankDetails[0].rank_name+")" ,"1");
	selectbox.options[selectbox.options.length] = new Option("Rank 2 ("+ad2460.allianceData.rankDetails[1].rank_name+")" ,"2");
	selectbox.options[selectbox.options.length] = new Option("Rank 3 ("+ad2460.allianceData.rankDetails[2].rank_name+")" ,"3");
	selectbox.options[selectbox.options.length] = new Option("Rank 4 ("+ad2460.allianceData.rankDetails[3].rank_name+")" ,"4");
	selectbox.options[selectbox.options.length] = new Option("Rank 5 ("+ad2460.allianceData.rankDetails[4].rank_name+")" ,"5");
	selectbox.options[selectbox.options.length] = new Option("Rank 6 ("+ad2460.allianceData.rankDetails[5].rank_name+")" ,"6");
	selectbox.options[selectbox.options.length] = new Option("Rank 7 ("+ad2460.allianceData.rankDetails[6].rank_name+")" ,"7");
	selectbox.options[selectbox.options.length] = new Option("Rank 8 ("+ad2460.allianceData.rankDetails[7].rank_name+")" ,"8");
	selectbox.options[selectbox.options.length] = new Option("Rank 9 ("+ad2460.allianceData.rankDetails[8].rank_name+")" ,"9");
	selectbox.options[selectbox.options.length] = new Option("Rank 10 ("+ad2460.allianceData.rankDetails[9].rank_name+")" ,"10");

	selectbox.selectedIndex=ad2460.allianceData.alliance_fleet_max_rank-1;
	selectbox.onchange=function(){
		postAllianceFleetRankRequirementChange();
	}

	var explaincontainer2=document.createElement('div');
	explaincontainer2.innerHTML='Select the lowest rank who can see alliance-tactics:';

	var shade2=document.createElement('div');
	shade2.setAttribute("class",'invite_shade_bottom');

	var selectbox2=document.createElement('select');
	selectbox2.setAttribute("class",'rankselect');
	selectbox2.setAttribute("id",'alliance_tactics_max_rank_dropdown');

	selectbox2.options[selectbox2.options.length] = new Option("Rank 1 ("+ad2460.allianceData.rankDetails[0].rank_name+")" ,"1");
	selectbox2.options[selectbox2.options.length] = new Option("Rank 2 ("+ad2460.allianceData.rankDetails[1].rank_name+")" ,"2");
	selectbox2.options[selectbox2.options.length] = new Option("Rank 3 ("+ad2460.allianceData.rankDetails[2].rank_name+")" ,"3");
	selectbox2.options[selectbox2.options.length] = new Option("Rank 4 ("+ad2460.allianceData.rankDetails[3].rank_name+")" ,"4");
	selectbox2.options[selectbox2.options.length] = new Option("Rank 5 ("+ad2460.allianceData.rankDetails[4].rank_name+")" ,"5");
	selectbox2.options[selectbox2.options.length] = new Option("Rank 6 ("+ad2460.allianceData.rankDetails[5].rank_name+")" ,"6");
	selectbox2.options[selectbox2.options.length] = new Option("Rank 7 ("+ad2460.allianceData.rankDetails[6].rank_name+")" ,"7");
	selectbox2.options[selectbox2.options.length] = new Option("Rank 8 ("+ad2460.allianceData.rankDetails[7].rank_name+")" ,"8");
	selectbox2.options[selectbox2.options.length] = new Option("Rank 9 ("+ad2460.allianceData.rankDetails[8].rank_name+")" ,"9");
	selectbox2.options[selectbox2.options.length] = new Option("Rank 10 ("+ad2460.allianceData.rankDetails[9].rank_name+")" ,"10");

	selectbox2.selectedIndex=ad2460.allianceData.alliance_tactics_max_rank-1;
	selectbox2.onchange=function(){
		postAllianceTacticsRankRequirementChange();
	}


	// Now then, disable it if you don't have military rights!
	var access=0;
	if (ad2460.allianceData.rank_id<=2) {
		access=1;
	}
	if (access<1){
		selectbox.disabled=true;
		selectbox2.disabled=true;
	}

	selectcontainer.appendChild(explaincontainer);
	selectcontainer.appendChild(shade);
	selectcontainer.appendChild(selectbox);

	selectcontainer.appendChild(explaincontainer2);
	//selectcontainer.appendChild(shade2);
	selectcontainer.appendChild(selectbox2);


	sidepanel.appendChild(selectcontainer);

	// Rename alliance
	if (ad2460.allianceData.rank_id<=2){
		var renameContainer=document.createElement('div');
		renameContainer.setAttribute("class",'rank_manage_select');

		var renameHeader=document.createElement('div');
		renameHeader.setAttribute("class",'lowpanel_header');
		renameHeader.innerHTML='Rename the alliance';

		var renameDescription=document.createElement('div');
		renameDescription.innerHTML='Please note, renaming the alliance will drain 5.000.000 of each resource from the alliance-bank.';

		var renameShade=document.createElement('div');
		renameShade.setAttribute("class",'invite_shade_bottom');

		var inputField=document.createElement('input');
		inputField.setAttribute("class",'rank_rename input_styling');
		inputField.setAttribute("id",'alliance_new_name');
		inputField.style.width="200px";
		inputField.style.marginRight="15px";

		var renameButton=document.createElement('div');
		renameButton.setAttribute("class",'lightbutton160');
		renameButton.setAttribute("onclick",'renameAlliance()');

		var renameButtonText=document.createElement('div');
		renameButtonText.setAttribute("class",'buttontext24');
		renameButtonText.innerHTML="Rename";

		renameButton.appendChild(renameButtonText);
		renameContainer.appendChild(renameHeader);
		renameContainer.appendChild(renameDescription);
		renameContainer.appendChild(renameShade);
		renameContainer.appendChild(inputField);
		renameContainer.appendChild(renameButton);
		sidepanel.appendChild(renameContainer);
	}

	// Rename bank
	if (ad2460.allianceData.rank_id<3){
		var renameContainer=document.createElement('div');
		renameContainer.setAttribute("class",'rank_manage_select');

		var renameHeader=document.createElement('div');
		renameHeader.setAttribute("class",'lowpanel_header');
		renameHeader.innerHTML='Rename the alliance-bank';

		var renameDescription=document.createElement('div');
		renameDescription.innerHTML='Please note, renaming the bank costs 5 credits.';

		var renameShade=document.createElement('div');
		renameShade.setAttribute("class",'invite_shade_bottom');

		var inputField=document.createElement('input');
		inputField.setAttribute("class",'rank_rename input_styling');
		inputField.setAttribute("id",'bank_new_name');
		inputField.maxLength=16;
		inputField.style.width="200px";
		inputField.style.marginRight="15px";

		var renameButton=document.createElement('div');
		renameButton.setAttribute("class",'lightbutton160');
		renameButton.setAttribute("onclick",'renameBank()');

		var renameButtonText=document.createElement('div');
		renameButtonText.setAttribute("class",'buttontext24');
		renameButtonText.innerHTML="Rename";

		renameButton.appendChild(renameButtonText);
		renameContainer.appendChild(renameHeader);
		renameContainer.appendChild(renameDescription);
		renameContainer.appendChild(renameShade);
		renameContainer.appendChild(inputField);
		renameContainer.appendChild(renameButton);
		sidepanel.appendChild(renameContainer);
	}



	var infoheader=createSingleElement('div', 'infopanel_header', '', 'No details available', '');
	infopanel.appendChild(infoheader);
	// Tempfunction, not yet ready for implementation

	addDynamicHelpButtons('alliance_military');
}

function renameAlliance(){
	var name=$("#alliance_new_name").val();
	if (name!=''){
		$.post('actionhandler.pl', {action:'rename_alliance',new_name:name}, function(data){ parseInfo(data);});
	}
}

function renameBank(){
	var name=$("#bank_new_name").val();
	if (name!=''){
		$.post('actionhandler.pl', {action:'rename_bank',new_name:name}, function(data){ parseInfo(data);});
	}
}



function postAllianceFleetRankRequirementChange(){
	var value=$("#alliance_fleet_max_rank_dropdown").val();
	if (value!=''){
		$.post('actionhandler.pl', {action:'submit_alliance_fleet_use_rank_required_change',new_rank:value}, function(data){ parseInfo(data);});
	}
}

function postAllianceTacticsRankRequirementChange(){
	var value=$("#alliance_tactics_max_rank_dropdown").val();
	if (value!=''){
		$.post('actionhandler.pl', {action:'submit_alliance_tactics_rank_required_change',new_rank:value}, function(data){ parseInfo(data);});
	}
}

function postAllianceBankholdersChange(){
	var value=$("#alliance_fleet_bankers_dropdown").val();
	if (value!=''){
		$.post('actionhandler.pl', {action:'submit_alliance_bankholders_change',new_bankholders:value}, function(data){ parseInfo(data);});
	}

}

function allianceManagementMissionsClick(){
	ad2460.allianceData.lastAllianceMenuSelected='alliancemissions';
	// Tempfunction, not yet ready for implementation
	var sidepanel=document.getElementById('alliance_management_sidepanel_content');
	removeChildNodes('alliance_management_sidepanel_content');
	var infopanel=document.getElementById('alliance_management_infopanel_content');
	removeChildNodes('alliance_management_infopanel_content');

	var header=createSingleElement('div', 'alliance_section_side_header', 'alliance_section_side_header', 'Missions', '');
	sidepanel.appendChild(header);

	var infoheader=createSingleElement('div', 'infopanel_header', '', 'Not yet implemented', '');
	infopanel.appendChild(infoheader);
	// Tempfunction, not yet ready for implementation
	addDynamicHelpButtons('alliance_missions');
}

function allianceManagementTaxSystemClick(){
	ad2460.allianceData.lastAllianceMenuSelected='tax';
	// Tempfunction, not yet ready for implementation
	var sidepanel=document.getElementById('alliance_management_sidepanel_content');
	removeChildNodes('alliance_management_sidepanel_content');
	var infopanel=document.getElementById('alliance_management_infopanel_content');
	removeChildNodes('alliance_management_infopanel_content');

	// createSingleElement(tag, classname, id, text, onclick)

	var container=createSingleElement('div','tax_setting_container','tax_setting_container','','');
	var header=createSingleElement('div', 'alliance_section_side_header', 'alliance_section_side_header', 'Alliance Taxation Setup', '');
	sidepanel.appendChild(header);

	var access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_taxation;

	if (ad2460.allianceData.type==0){
		var notaxtext=createSingleElement('div', 'free_alliance_info', 'free_alliance_info', 'The Free Alliance has no taxation settings.', '');
		container.appendChild(notaxtext);

		var setting5=createSingleElement('div', 'tax_setting_entry left', '', '', '');
		var settingtitle5=createSingleElement('div', 'tax_setting_title', '', 'Withdrawal Limits', '');
		if (access==1){
			//var settinginput5=createSingleElement('input', 'tax_input_fields input_styling', 'tax_withdrawal_limit', ''+ad2460.allianceData.tax.withdrawal_limit, '');
			var settinginput5a=createSingleElement('input', 'tax_input_fields input_styling hs', 'tax_withdrawal_limit_hs', ''+ad2460.allianceData.tax.withdrawal_limit_hs, '');
			var settinginput5b=createSingleElement('input', 'tax_input_fields input_styling in', 'tax_withdrawal_limit_in', ''+ad2460.allianceData.tax.withdrawal_limit_in, '');
			var settinginput5c=createSingleElement('input', 'tax_input_fields input_styling sr', 'tax_withdrawal_limit_sr', ''+ad2460.allianceData.tax.withdrawal_limit_sr, '');
			var settinginput5d=createSingleElement('input', 'tax_input_fields input_styling nd', 'tax_withdrawal_limit_nd', ''+ad2460.allianceData.tax.withdrawal_limit_nd, '');
		}
		else {
			//var settinginput5=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit', ''+ad2460.allianceData.tax.withdrawal_limit, '');
			var settinginput5a=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit_hs', ''+ad2460.allianceData.tax.withdrawal_limit_hs, '');
			var settinginput5b=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit_in', ''+ad2460.allianceData.tax.withdrawal_limit_in, '');
			var settinginput5c=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit_sr', ''+ad2460.allianceData.tax.withdrawal_limit_sr, '');
			var settinginput5d=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit_nd', ''+ad2460.allianceData.tax.withdrawal_limit_nd, '');
		}
		setting5.appendChild(settingtitle5);
		//setting5.appendChild(settinginput5);
		setting5.appendChild(settinginput5a);
		setting5.appendChild(settinginput5b);
		setting5.appendChild(settinginput5c);
		setting5.appendChild(settinginput5d);

		container.appendChild(setting5);

		var setting6=createSingleElement('div', 'tax_setting_entry', '', '', '');
		var settingtitle6=createSingleElement('div', 'tax_setting_title', '', 'Limit is per 24 hours', '');

		setting6.appendChild(settingtitle6);
		container.appendChild(setting6);

		if (access==1){
			var button_container=createSingleElement('div', 'tax_button_container', '', '', '');
			container.appendChild(button_container);
			button_container.appendChild(createButtonElement('Change','lightbutton160 tax_submit','buttontext24','submitTaxChanges()','submit_tax'));
		}

	}
	else if (ad2460.allianceData.type==1){

		var setting1=createSingleElement('div', 'tax_setting_entry left', 'tax_setting_1', '', '');
		var settingtitle1=createSingleElement('div', 'tax_setting_title', 'tax_setting_title_1', 'Taxation % (max. 25%)', '');
		var settinginput1;
		if (access==1){
			settinginput1=createSingleElement('input', 'tax_input_fields input_styling', 'tax_percentage', ''+ad2460.allianceData.tax.percentage, '');
		}
		else {
			settinginput1=createSingleElement('div', 'tax_input_fields noedit', 'tax_percentage', ''+ad2460.allianceData.tax.percentage, '');
		}

		setting1.appendChild(settingtitle1);
		setting1.appendChild(settinginput1);
		container.appendChild(setting1);

		var setting2=createSingleElement('div', 'tax_setting_entry', 'tax_setting_2', '', '');
		var settingtitle2=createSingleElement('div', 'tax_setting_title', 'tax_setting_title_2', 'Percentage of all income', '');
		setting2.appendChild(settingtitle2);
		container.appendChild(setting2);

		var setting3=createSingleElement('div', 'tax_setting_entry left', 'tax_setting_2', '', '');
		var settingtitle3=createSingleElement('div', 'tax_setting_title', 'tax_setting_title_3', 'Bank Deposit %', '');
		var settinginput3;
		if (access==1){
			settinginput3=createSingleElement('input', 'tax_input_fields input_styling', 'tax_bank_deposit_percentage', ''+ad2460.allianceData.tax.bank_deposit_percentage, '');
		}
		else {
			settinginput3=createSingleElement('div', 'tax_input_fields noedit', 'tax_bank_deposit_percentage', ''+ad2460.allianceData.tax.bank_deposit_percentage, '');
		}
		setting3.appendChild(settingtitle3);
		setting3.appendChild(settinginput3);
		container.appendChild(setting3);

		var setting4=createSingleElement('div', 'tax_setting_entry', '', '', '');
		var settingtitle4=createSingleElement('div', 'tax_setting_title', '', '% of tax going into the bank', '');
		setting4.appendChild(settingtitle4);

		container.appendChild(setting4);

		var setting5=createSingleElement('div', 'tax_setting_entry left', '', '', '');
		var settingtitle5=createSingleElement('div', 'tax_setting_title', '', 'Withdrawal Limits', '');
		if (access==1){
			//var settinginput5=createSingleElement('input', 'tax_input_fields input_styling', 'tax_withdrawal_limit', ''+ad2460.allianceData.tax.withdrawal_limit, '');
			var settinginput5a=createSingleElement('input', 'tax_input_fields input_styling hs', 'tax_withdrawal_limit_hs', ''+ad2460.allianceData.tax.withdrawal_limit_hs, '');
			var settinginput5b=createSingleElement('input', 'tax_input_fields input_styling in', 'tax_withdrawal_limit_in', ''+ad2460.allianceData.tax.withdrawal_limit_in, '');
			var settinginput5c=createSingleElement('input', 'tax_input_fields input_styling sr', 'tax_withdrawal_limit_sr', ''+ad2460.allianceData.tax.withdrawal_limit_sr, '');
			var settinginput5d=createSingleElement('input', 'tax_input_fields input_styling nd', 'tax_withdrawal_limit_nd', ''+ad2460.allianceData.tax.withdrawal_limit_nd, '');
		}
		else {
			//var settinginput5=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit', ''+ad2460.allianceData.tax.withdrawal_limit, '');
			var settinginput5a=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit_hs', ''+ad2460.allianceData.tax.withdrawal_limit_hs, '');
			var settinginput5b=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit_in', ''+ad2460.allianceData.tax.withdrawal_limit_in, '');
			var settinginput5c=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit_sr', ''+ad2460.allianceData.tax.withdrawal_limit_sr, '');
			var settinginput5d=createSingleElement('div', 'tax_input_fields noedit', 'tax_withdrawal_limit_nd', ''+ad2460.allianceData.tax.withdrawal_limit_nd, '');
		}
		setting5.appendChild(settingtitle5);
		//setting5.appendChild(settinginput5);
		setting5.appendChild(settinginput5a);
		setting5.appendChild(settinginput5b);
		setting5.appendChild(settinginput5c);
		setting5.appendChild(settinginput5d);

		container.appendChild(setting5);

		settinginput1.onkeydown=function(event){
			if (event.which==9 || event.keyCode==9) {		settinginput3.focus();			return false;			}
		}
		settinginput3.onkeydown=function(event){
			if (event.which==9 || event.keyCode==9) {		settinginput5a.focus();			return false;			}
		}

		var setting6=createSingleElement('div', 'tax_setting_entry', '', '', '');
		var settingtitle6=createSingleElement('div', 'tax_setting_title', '', 'Limit is per 24 hours', '');

		setting6.appendChild(settingtitle6);
		container.appendChild(setting6);

		if (access==1){
			var button_container=createSingleElement('div', 'tax_button_container', '', '', '');
			container.appendChild(button_container);
			button_container.appendChild(createButtonElement('Change','lightbutton160 tax_submit','buttontext24','submitTaxChanges()','submit_tax'));
		}

	}



	settinginput5a.onkeydown=function(event){
		if (event.which==9 || event.keyCode==9) {		settinginput5b.focus();			return false;			}
	}
	settinginput5b.onkeydown=function(event){
		if (event.which==9 || event.keyCode==9) {		settinginput5c.focus();			return false;			}
	}
	settinginput5c.onkeydown=function(event){
		if (event.which==9 || event.keyCode==9) {		settinginput5d.focus();			return false;			}
	}
	settinginput5d.onkeydown=function(event){
		if (event.which==13 || event.keyCode==13) {		submitTaxChanges();		return false;			}
	}


	var shade=createSingleElement('div', 'tax_shader2', '', '', '');
	container.appendChild(shade);

	var select_container=createSingleElement('div', 'alliance_type_select', '', '', '');
	container.appendChild(select_container);

	var select_header=createSingleElement('div', 'alliance_type_title', '', 'Alliance-type', '');
	container.appendChild(select_header);
	select_container.appendChild(select_header);

	var select_inner_container=createSingleElement('div', 'rank_select tax', '', '', '');
	select_container.appendChild(select_inner_container);
	if (access==1){
		var dropdown=createSingleElement('select', 'rankselect', 'alliance_tax_model_dropdown', '', 'changeAllianceTypePopup()');
		// insert the options...
		dropdown.options[dropdown.options.length] = new Option("Free alliance" ,"0");
		dropdown.options[dropdown.options.length] = new Option("Taxed alliance" ,"1");
		dropdown.selectedIndex=ad2460.allianceData.type;

		select_inner_container.appendChild(dropdown);
	}
	else {
		select_inner_container.appendChild(createSingleElement('span', 'alliance_type_title', '', ad2460.allianceData.typeStrings[ad2460.allianceData.type], ''));
	}

	var shade2=createSingleElement('div', 'tax_shader', '', '', '');
	container.appendChild(shade2);

	var info=createSingleElement('div', 'tax_info', '', 'What remains after the Bank Deposit % is distributed evenly between all members of the alliance, a big help for smaller or newer members.', '');
	if (ad2460.allianceData.type==0){
		info=createSingleElement('div', 'tax_info', '', '', '');
	}
	container.appendChild(info);

	sidepanel.appendChild(container);

	renderAllianceTaxInfopanel();

	// Tempfunction, not yet ready for implementation
	addDynamicHelpButtons('alliance_tax');
}

function changeAllianceTypePopup(){
	showConfirmationPopup("Are you sure to wish to change the tax-model? The change will charge the alliance-bank 100.000 of each resource.","Yes","No","changeAllianceType();hideConfirmationPopup();","allianceManagementTaxSystemClick()")
}


function renderAllianceTaxInfopanel(){
	// DOM cleanup
	var infopanel=document.getElementById('alliance_management_infopanel_content');
	removeChildNodes('alliance_management_infopanel_content');



	// Lets set up the variables we need here:
	var current_alliance_upkeep_percent=0;
	var next_cod_usage_timestamp=0;

	// Taxes paid: ad2460.allianceData.avg_alliance_tax_paid.hassium etc
	// Taxes received: ad2460.allianceData.avg_alliance_tax_received.hassium etc
	// Upkeep paid: ad2460.allianceData.avg_alliance_upkeep_paid.hassium etc

	var container=createSingleElement('div','','','','');

	// createSingleElement(tag, classname, id, text, onclick)
	var infoheader=createSingleElement('div', 'infopanel_header', '', 'Tax System Summary', '');
	container.appendChild(infoheader);

	var inner_container=createSingleElement('div','tax_summary_container','','','');
	container.appendChild(inner_container);

	var current_upkeep_title=createSingleElement('div', 'tax_upkeep_header', '', 'Current Alliance Upkeep', '');
	var current_upkeep_percent=createSingleElement('div', 'tax_upkeep_entry', '', ''+ad2460.allianceData.current_alliance_upkeep_percent+'%', '');

	/*
	var next_cod_timestamp_string='N/A';
	if (ad2460.allianceData.type==1){
		if (ad2460.allianceData.next_cod_usage_timestamp-ad2460.serverTime>0){
			next_cod_timestamp_string=secondsToFullTime(ad2460.allianceData.next_cod_usage_timestamp-ad2460.serverTime);
		}
		else {
			next_cod_timestamp_string='Available';
		}
	}
	*/

	var total_alliance_upkeep_bonus_percent=0;
	var o=returnGameObjectById(355);
	if (o.user_id==ad2460.user_id && o.upgrading==0){
		total_alliance_upkeep_bonus_percent+=5;
	}
	var o=returnGameObjectById(356);
	if (o.user_id==ad2460.user_id && o.upgrading==0){
		total_alliance_upkeep_bonus_percent+=5;
	}
	var o=returnGameObjectById(357);
	if (o.user_id==ad2460.user_id && o.upgrading==0){
		total_alliance_upkeep_bonus_percent+=10;
	}

	var o=returnGameObjectById(190);
	if (o.user_id==ad2460.user_id && o.upgrading==0){
		total_alliance_upkeep_bonus_percent+=2;
	}
	var o=returnGameObjectById(198);
	if (o.user_id==ad2460.user_id && o.upgrading==0){
		total_alliance_upkeep_bonus_percent+=4;
	}

	var o=returnGameObjectById(602);
	if (o.alliance_id==ad2460.allianceData.id && o.upgrading==0){
		total_alliance_upkeep_bonus_percent+=5;
	}
	var o=returnGameObjectById(603);
	if (o.alliance_id==ad2460.allianceData.id && o.upgrading==0){
		total_alliance_upkeep_bonus_percent+=5;
	}
	var o=returnGameObjectById(604);
	if (o.alliance_id==ad2460.allianceData.id && o.upgrading==0){
		total_alliance_upkeep_bonus_percent+=5;
	}

	var next_cod_title=createSingleElement('div', 'tax_upkeep_header', '', 'My upkeep bonus', '');
	var next_cod_timestamp=createSingleElement('div', 'tax_upkeep_entry', '', total_alliance_upkeep_bonus_percent+'%', '');

	inner_container.appendChild(current_upkeep_title);
	inner_container.appendChild(next_cod_title);
	inner_container.appendChild(current_upkeep_percent);
	inner_container.appendChild(next_cod_timestamp);

	if (ad2460.allianceData.type==1){

		var tax_paid_header=createSingleElement('div', 'tax_summary_header', '', 'Avg. Tax Paid pr. Day', '');
		inner_container.appendChild(tax_paid_header);

		var tax_paid_container=createSingleElement('div', 'tax_summary_resources', '', '', '');
		var tax_paid_hassium=createSingleElement('div', 'summary_entry hs', '', ''+prettyPrint(ad2460.allianceData.avg_tax_paid.hassium), '');
		var tax_paid_neodymium=createSingleElement('div', 'summary_entry nd', '', ''+prettyPrint(ad2460.allianceData.avg_tax_paid.neodymium), '');
		var tax_paid_strontium=createSingleElement('div', 'summary_entry sr', '', ''+prettyPrint(ad2460.allianceData.avg_tax_paid.strontium), '');
		var tax_paid_indium=createSingleElement('div', 'summary_entry in', '', ''+prettyPrint(ad2460.allianceData.avg_tax_paid.indium), '');

		tax_paid_container.appendChild(tax_paid_hassium);
		tax_paid_container.appendChild(tax_paid_indium);
		tax_paid_container.appendChild(tax_paid_strontium);
		tax_paid_container.appendChild(tax_paid_neodymium);

		inner_container.appendChild(tax_paid_container);

		var tax_received_header=createSingleElement('div', 'tax_summary_header', '', 'Avg. Tax Returned pr. Day', '');
		inner_container.appendChild(tax_received_header);

		var tax_received_container=createSingleElement('div', 'tax_summary_resources', '', '', '');
		var tax_received_hassium=createSingleElement('div', 'summary_entry hs', '', ''+prettyPrint(ad2460.allianceData.avg_tax_received.hassium), '');
		var tax_received_neodymium=createSingleElement('div', 'summary_entry nd', '', ''+prettyPrint(ad2460.allianceData.avg_tax_received.neodymium), '');
		var tax_received_strontium=createSingleElement('div', 'summary_entry sr', '', ''+prettyPrint(ad2460.allianceData.avg_tax_received.strontium), '');
		var tax_received_indium=createSingleElement('div', 'summary_entry in', '', ''+prettyPrint(ad2460.allianceData.avg_tax_received.indium), '');

		tax_received_container.appendChild(tax_received_hassium);
		tax_received_container.appendChild(tax_received_indium);
		tax_received_container.appendChild(tax_received_strontium);
		tax_received_container.appendChild(tax_received_neodymium);

		inner_container.appendChild(tax_received_container);
	}
	var upkeep_paid_header=createSingleElement('div', 'tax_summary_header', '', 'Avg. Alliance Upkeep Paid pr. Day', '');
	inner_container.appendChild(upkeep_paid_header);

	var upkeep_paid_container=createSingleElement('div', 'tax_summary_resources', '', '', '');
	var upkeep_paid_hassium=createSingleElement('div', 'summary_entry hs', '', ''+prettyPrint(ad2460.allianceData.avg_alliance_upkeep_paid.hassium), '');
	var upkeep_paid_neodymium=createSingleElement('div', 'summary_entry nd', '', ''+prettyPrint(ad2460.allianceData.avg_alliance_upkeep_paid.neodymium), '');
	var upkeep_paid_strontium=createSingleElement('div', 'summary_entry sr', '', ''+prettyPrint(ad2460.allianceData.avg_alliance_upkeep_paid.strontium), '');
	var upkeep_paid_indium=createSingleElement('div', 'summary_entry in', '', ''+prettyPrint(ad2460.allianceData.avg_alliance_upkeep_paid.indium), '');

	upkeep_paid_container.appendChild(upkeep_paid_hassium);
	upkeep_paid_container.appendChild(upkeep_paid_indium);
	upkeep_paid_container.appendChild(upkeep_paid_strontium);
	upkeep_paid_container.appendChild(upkeep_paid_neodymium);

	inner_container.appendChild(upkeep_paid_container);

	var infodiv=createSingleElement('div', 'bank_balance_info', '', 'Upkeep is the fixed % of your income you need to pay to help keep the diplomacy of the alliance working. The average tax payments and returns shows your contibution to the alliance, and how much you are receiving from the wealth distribution system.', '');
	container.appendChild(infodiv);

	infopanel.appendChild(container);

}

function updatePaidAllianceUpkeep(hassium, neodymium, strontium, indium){
	ad2460.allianceData.avg_alliance_upkeep_paid.hassium=hassium;
	ad2460.allianceData.avg_alliance_upkeep_paid.neodymium=neodymium;
	ad2460.allianceData.avg_alliance_upkeep_paid.strontium=strontium;
	ad2460.allianceData.avg_alliance_upkeep_paid.indium=indium;
}

function updatePaidAllianceTax(hassium, neodymium, strontium, indium){
	ad2460.allianceData.avg_tax_paid.hassium=hassium;
	ad2460.allianceData.avg_tax_paid.neodymium=neodymium;
	ad2460.allianceData.avg_tax_paid.strontium=strontium;
	ad2460.allianceData.avg_tax_paid.indium=indium;
}
function updateReceivedAllianceTax(hassium, neodymium, strontium, indium){
	ad2460.allianceData.avg_tax_received.hassium=hassium;
	ad2460.allianceData.avg_tax_received.neodymium=neodymium;
	ad2460.allianceData.avg_tax_received.strontium=strontium;
	ad2460.allianceData.avg_tax_received.indium=indium;
}

function submitTaxChanges(){
	if (ad2460.allianceData.type==0){
		var withdrawal_limit_hs=document.getElementById('tax_withdrawal_limit_hs').value;
		var withdrawal_limit_in=document.getElementById('tax_withdrawal_limit_in').value;
		var withdrawal_limit_sr=document.getElementById('tax_withdrawal_limit_sr').value;
		var withdrawal_limit_nd=document.getElementById('tax_withdrawal_limit_nd').value;
		$.post('actionhandler.pl', {action:'submit_alliance_tax_changes', type:0, withdrawal_limit_hs:withdrawal_limit_hs, withdrawal_limit_in:withdrawal_limit_in, withdrawal_limit_sr:withdrawal_limit_sr, withdrawal_limit_nd:withdrawal_limit_nd}, function(data){ parseInfo(data);});

	}
	else {
		var percentage=document.getElementById('tax_percentage').value;
		var bank_deposit_percentage=document.getElementById('tax_bank_deposit_percentage').value;
		var withdrawal_limit_hs=document.getElementById('tax_withdrawal_limit_hs').value;
		var withdrawal_limit_in=document.getElementById('tax_withdrawal_limit_in').value;
		var withdrawal_limit_sr=document.getElementById('tax_withdrawal_limit_sr').value;
		var withdrawal_limit_nd=document.getElementById('tax_withdrawal_limit_nd').value;
		//var cod_percentage=document.getElementById('tax_cod_percentage').value;
		//var cod_bank_percentage=document.getElementById('tax_cod_bank_percentage').value;
		//var cod_interval=document.getElementById('tax_cod_interval').value;

		$.post('actionhandler.pl', {action:'submit_alliance_tax_changes', type:1, percentage:percentage, bank_deposit_percentage:bank_deposit_percentage, withdrawal_limit_hs:withdrawal_limit_hs, withdrawal_limit_in:withdrawal_limit_in, withdrawal_limit_sr:withdrawal_limit_sr, withdrawal_limit_nd:withdrawal_limit_nd}, function(data){ parseInfo(data);});

	}
}

function changeAllianceType(){
	var new_type=document.getElementById('alliance_tax_model_dropdown').value;
	$.post('actionhandler.pl', {action:'submit_alliance_type_change',new_type:new_type}, function(data){ parseInfo(data);});
}

function updateAllianceTaxData(type, percentage, bank_deposit_percentage, withdrawal_limit, cod_percentage, cod_bank_percentage, cod_interval, change_timestamp, change_type, change_percentage, percentage_change_timestamp, withdrawal_limit_hs, withdrawal_limit_in, withdrawal_limit_sr, withdrawal_limit_nd, callback ){

	ad2460.allianceData.type=type;
	ad2460.allianceData.tax.percentage=percentage;
	ad2460.allianceData.tax.bank_deposit_percentage=bank_deposit_percentage;
	ad2460.allianceData.tax.withdrawal_limit=withdrawal_limit;
	ad2460.allianceData.tax.cod_percentage=cod_percentage;
	ad2460.allianceData.tax.cod_bank_percentage=cod_bank_percentage;
	ad2460.allianceData.tax.cod_interval=cod_interval;
	ad2460.allianceData.tax.change_timestamp=change_timestamp;
	ad2460.allianceData.tax.change_type=change_type;
	ad2460.allianceData.tax.change_percentage=change_percentage;
	ad2460.allianceData.tax.percentage_change_timestamp=percentage_change_timestamp;
	ad2460.allianceData.tax.withdrawal_limit_hs=withdrawal_limit_hs;
	ad2460.allianceData.tax.withdrawal_limit_in=withdrawal_limit_in;
	ad2460.allianceData.tax.withdrawal_limit_sr=withdrawal_limit_sr;
	ad2460.allianceData.tax.withdrawal_limit_nd=withdrawal_limit_nd;

	if (callback){
		eval(callback);
	}
}
function allianceManagementAllianceNewsClick(){
	ad2460.allianceData.lastAllianceMenuSelected='alliancenews';
	renderAllianceNews();
	addDynamicHelpButtons('alliance_news');
	//$("#alliance_alert").hide();
	$("#alliance_alert").show().css("opacity","0.3");
}

function allianceManagementAllianceInformationClick(){
	ad2460.allianceData.lastAllianceMenuSelected='allianceinformation';
	var sidepanel=document.getElementById('alliance_management_sidepanel_content');
	removeChildNodes('alliance_management_sidepanel_content');

	// Just a few items to render here.
	// The alliance-information itself can be stored in the alliances table, under alliance_information. Should be part of the allianceData object ofc.
	// the logo-url is also there already.
	var access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_info;

	var container=document.createElement('div'); // dummy container to trigger just 1 reflow of the dom, in stead of 5...
	var header=createSingleElement('div', 'alliance_section_side_header', 'alliance_section_side_header', 'Alliance Information', '');
	var alliance_crest_edit=createSingleElement('div', 'alliance_crest_edit', 'alliance_crest_edit', '', '');
	var alliance_avatar=createSingleElement('img', 'alliance_avatar', 'alliance_avatar_picture', pathToAllianceLogos+ad2460.allianceData.logo, '');
	var alliance_avatar_shader=createSingleElement('div', 'alliance_avatar_shader', 'alliance_avatar_shader', '', '');

	container.appendChild(header);

	alliance_crest_edit.appendChild(alliance_avatar);
	alliance_crest_edit.appendChild(alliance_avatar_shader);

	container.appendChild(alliance_crest_edit);

	var textarea;

	if (access==1){
		textarea=createSingleElement('textarea', 'input_styling alliance_info_edit', 'alliance_information_textarea', '', '');
		textarea.value=ad2460.allianceData.alliance_information;
		container.appendChild(textarea);
		var button=createButtonElement('Update','lightbutton160 alliance_info_button','buttontext24','updateAllianceInformation()','updateAllianceInformationButton')
		container.appendChild(button);
	}
	else {
		textarea=createSingleElement('div', 'alliance_info_edit', '', '', '');
		textarea.innerHTML=convertLineBreaks(iconify(linkify(ad2460.allianceData.alliance_information)));
		container.appendChild(textarea);
	}

	var crest_edit_info=createSingleElement('div', 'crest_edit_info', '', 'Click Alliance Crest, or Alliance Info to edit.', '');

	container.appendChild(crest_edit_info);

	sidepanel.appendChild(container);

	renderAllianceManagementResponsibleOfficers();

	if (access==1){
		enableAllianceAvatarUploader();
	}
	addDynamicHelpButtons('alliance_information');
}

function renderAllianceManagementResponsibleOfficers(){
	ad2460.allianceData.lastAllianceMenuSelected='officersandrankmanagement';
	var infopanel=document.getElementById('alliance_management_infopanel_content');
	removeChildNodes('alliance_management_infopanel_content');

	// No magic here either, render the leader-box + the 7 responsible-boxes with a name in each.
	var container=document.createElement('div'); // dummy container to trigger just 1 reflow of the dom, in stead of 5...
	var header=createSingleElement('div', 'infopanel_header', '', 'Responsible Officers', '');

	container.appendChild(header);

	// The leader-box is special, as it's not really a responsibility
	var name=returnLeaderName();
	var leader_box=createSingleElement('div', 'rank_privilege_entry responsibility_listing', '', '', '');
	var title_span=createSingleElement('span', 'privilege_title', '', 'Leader', '');
	var name_box=createSingleElement('div', 'responsibility_person', '', name , '');

	leader_box.appendChild(title_span);
	leader_box.appendChild(name_box);
	container.appendChild(leader_box);

	var i=1;
	for (i=1;i<ad2460.allianceMemberTags.length ;i++ ){
		var name=returnResponsibleName(i);
		var title=ad2460.allianceMemberTags[i];
		var resp_box=createSingleElement('div', 'rank_privilege_entry responsibility_listing', '', '', '');
		var title_span=createSingleElement('span', 'privilege_title', '', title, '');
		var name_box=createSingleElement('div', 'responsibility_person', '', name , '');
		resp_box.appendChild(title_span);
		resp_box.appendChild(name_box);
		container.appendChild(resp_box);
	}
	infopanel.appendChild(container);
	// Remember that we must only allow one person to get one responsibility !!!
}

function returnLeaderName(){
	var i=0;
	for (i=0;i<ad2460.allianceData.memberlist.length ;i++ ){
		if (ad2460.allianceData.memberlist[i].rank==1){
			return (ad2460.allianceData.memberlist[i].name);
		}
	}
}

function returnResponsibleName(tag_id){
	for (i=0;i<ad2460.allianceData.memberlist.length ;i++ ){
		if (ad2460.allianceData.memberlist[i].tag_id==tag_id){
			return (ad2460.allianceData.memberlist[i].name);
		}
	}
	return '-';
}

function updateAllianceInformation(){
	var new_text=document.getElementById('alliance_information_textarea').value;
	$.post('actionhandler.pl', {action:'submit_alliance_information',new_text:new_text}, function(data){ parseInfo(data);});
}

function allianceManagementRankManagementClick(){
	ad2460.allianceData.lastAllianceMenuSelected='officersandrankmanagement';
	var rank=ad2460.allianceData.rank_id;
	var sidepanel=document.getElementById('alliance_management_sidepanel_content');
	removeChildNodes('alliance_management_sidepanel_content');

	var header=document.createElement('div');
	header.setAttribute("class",'alliance_section_side_header');
	header.setAttribute("id",'alliance_section_side_header');
	header.innerHTML='Officer Rank Management';

	var selectcontainer=document.createElement('div');
	selectcontainer.setAttribute("class",'rank_manage_select');

	var explaincontainer=document.createElement('div');
	explaincontainer.innerHTML='Select rank to manage:';

	var shade=document.createElement('div');
	shade.setAttribute("class",'invite_shade_bottom');

	var selectbox=document.createElement('select');
	selectbox.setAttribute("class",'rankselect');
	selectbox.setAttribute("id",'rank_select_dropdown');

	selectbox.options[selectbox.options.length] = new Option("Rank 1 ("+ad2460.allianceData.rankDetails[0].rank_name+")" ,"1");
	selectbox.options[selectbox.options.length] = new Option("Rank 2 ("+ad2460.allianceData.rankDetails[1].rank_name+")" ,"2");
	selectbox.options[selectbox.options.length] = new Option("Rank 3 ("+ad2460.allianceData.rankDetails[2].rank_name+")" ,"3");
	selectbox.options[selectbox.options.length] = new Option("Rank 4 ("+ad2460.allianceData.rankDetails[3].rank_name+")" ,"4");
	selectbox.options[selectbox.options.length] = new Option("Rank 5 ("+ad2460.allianceData.rankDetails[4].rank_name+")" ,"5");
	selectbox.options[selectbox.options.length] = new Option("Rank 6 ("+ad2460.allianceData.rankDetails[5].rank_name+")" ,"6");
	selectbox.options[selectbox.options.length] = new Option("Rank 7 ("+ad2460.allianceData.rankDetails[6].rank_name+")" ,"7");
	selectbox.options[selectbox.options.length] = new Option("Rank 8 ("+ad2460.allianceData.rankDetails[7].rank_name+")" ,"8");
	selectbox.options[selectbox.options.length] = new Option("Rank 9 ("+ad2460.allianceData.rankDetails[8].rank_name+")" ,"9");
	selectbox.options[selectbox.options.length] = new Option("Rank 10 ("+ad2460.allianceData.rankDetails[9].rank_name+")" ,"10");

	selectbox.setAttribute("onclick","allianceManagementRankSelectChange()");

	var ranknotecontainer=document.createElement('div');
	ranknotecontainer.setAttribute("class",'rank_name_note');

	var rankheader=document.createElement('div');
	rankheader.setAttribute("class",'rank_header');
	rankheader.innerHTML='Rank '+selectbox.options[selectbox.selectedIndex].value;

	var noteheader=document.createElement('div');
	noteheader.setAttribute("class",'rank_header');
	noteheader.innerHTML='Rank-note';

	var rankrenameinput;
	var ranknotetextarea;

	if (rank==1){
		rankrenameinput=document.createElement('input');
		rankrenameinput.setAttribute("class",'rank_rename input_styling');
		rankrenameinput.setAttribute("id",'rank_rename_input');
		rankrenameinput.value=ad2460.allianceData.rankDetails[selectbox.selectedIndex].rank_name;

		ranknotetextarea=document.createElement('textarea');
		ranknotetextarea.setAttribute("class",'rank_note input_styling');
		ranknotetextarea.setAttribute("id",'rank_note_input');
		ranknotetextarea.value=ad2460.allianceData.rankDetails[selectbox.selectedIndex].rank_note;
	}
	else {
		rankrenameinput=document.createElement('div');
		rankrenameinput.setAttribute("class",'rank_rename noedit');
		rankrenameinput.setAttribute("id",'rank_rename_input');
		rankrenameinput.innerHTML=ad2460.allianceData.rankDetails[selectbox.selectedIndex].rank_name;

		ranknotetextarea=document.createElement('textarea');
		ranknotetextarea.setAttribute("class",'rank_note noedit');
		ranknotetextarea.setAttribute("id",'rank_note_input');
		ranknotetextarea.innerHTML=ad2460.allianceData.rankDetails[selectbox.selectedIndex].rank_note;
	}

//	var rankrenameinput=document.createElement('input');
//	rankrenameinput.setAttribute("class",'rank_rename');
//	rankrenameinput.setAttribute("id",'rank_rename_input');
//	rankrenameinput.value= ad2460.allianceData.rankDetails[selectbox.selectedIndex].rank_name;

//	var ranknotetextarea=document.createElement('textarea');
//	ranknotetextarea.setAttribute("class",'rank_note');
//	ranknotetextarea.setAttribute("id",'rank_note_input');
//	ranknotetextarea.value=ad2460.allianceData.rankDetails[selectbox.selectedIndex].rank_note;

	var submitbutton=document.createElement('div');
	submitbutton.setAttribute("class",'lightbutton160 motd_submit');
	submitbutton.setAttribute("onclick","updateRankDetails()");
	var submitbuttontext=document.createElement('div');
	submitbuttontext.setAttribute("class",'buttontext24');
	submitbuttontext.innerHTML='Save';

	submitbutton.appendChild(submitbuttontext);

	selectcontainer.appendChild(explaincontainer);
	selectcontainer.appendChild(shade);
	selectcontainer.appendChild(selectbox);

	ranknotecontainer.appendChild(rankheader);
	ranknotecontainer.appendChild(rankrenameinput);
	ranknotecontainer.appendChild(noteheader);
	ranknotecontainer.appendChild(ranknotetextarea);

	sidepanel.appendChild(header);
	sidepanel.appendChild(selectcontainer);
	sidepanel.appendChild(ranknotecontainer);
	sidepanel.appendChild(submitbutton);

	allianceManagementRankSelectChange();
	addDynamicHelpButtons('alliance_officers');
}

function allianceManagementRankSelectChange(){
	var selectbox=document.getElementById('rank_select_dropdown');
	var rankrenameinput=document.getElementById('rank_rename_input');
	rankrenameinput.value= ad2460.allianceData.rankDetails[selectbox.selectedIndex].rank_name;

	var ranknotetextarea=document.getElementById('rank_note_input');
	ranknotetextarea.value= ad2460.allianceData.rankDetails[selectbox.selectedIndex].rank_note;
	renderPrivileges(selectbox.value);
}

function updateRankDetails(){
	var rank_id=document.getElementById('rank_select_dropdown').value;
	var rank_name=document.getElementById('rank_rename_input').value;
	var rank_note=document.getElementById('rank_note_input').value;

	$.post('actionhandler.pl', {action:'update_alliance_rank_details',rank_id:rank_id, rank_name:rank_name, rank_note:rank_note}, function(data){ parseInfo(data);});
}

function renderPrivileges(rank){
	// Run through the ranks and find out which rights go with this rank
	// Then render the boxes and attach onclicks if my rank is 1.

	var myRank=ad2460.allianceData.rank_id;
	var myAllianceId=ad2460.allianceData.alliance_id;

	var parent=document.getElementById('alliance_management_infopanel_content');

	// We have the text-strings for headers and comments here:
	// ad2460.alliancePrivilegesHeaders
	// ad2460.alliancePrivilegesComments

	// First we nuke the children of alliance_management_infopanel
	removeChildNodes('alliance_management_infopanel_content');
	// Then we make the left and right container for the two columns
	var subparent=document.createElement('div');
	subparent.setAttribute("class",'alliance_section_info_content');

	var leftcolumn=document.createElement('div');
	leftcolumn.setAttribute("class",'rank_privilege_column');
	leftcolumn.setAttribute("id",'all_management_privs_left');

	var rightcolumn=document.createElement('div');
	rightcolumn.setAttribute("class",'rank_privilege_column');
	rightcolumn.setAttribute("id",'all_management_privs_right');

	// And the header...
	var columnsheader=document.createElement('div');
	columnsheader.setAttribute("class",'infopanel_header');
	columnsheader.innerHTML=ad2460.allianceData.rankDetails[rank-1].rank_name +" (Rank "+rank+")<br/>Privileges Selection";

	// And now make the 10 boxes
	var i=0;
	for (i=0;i<10 ;i++ ){
		var box=document.createElement('div');
		box.setAttribute("class",'rank_privilege_entry');
		if (myRank==1){
			box.setAttribute("onclick","toggleRankPriv("+rank+","+i+")");
		}
		var boximage=document.createElement('img');
		boximage.setAttribute("class",'rank_privilege_check');

		// Set the source!!!!! Check the attribute first :)
		var value=0;
		if (i==0){ value=ad2460.allianceData.rankDetails[rank-1].access_invitation;	}
		if (i==1){ value=ad2460.allianceData.rankDetails[rank-1].access_kicking;		}
		if (i==2){ value=ad2460.allianceData.rankDetails[rank-1].access_banking;		}
		if (i==3){ value=ad2460.allianceData.rankDetails[rank-1].access_info;		}
		if (i==4){ value=ad2460.allianceData.rankDetails[rank-1].access_project;		}
		if (i==5){ value=ad2460.allianceData.rankDetails[rank-1].access_mission;		}
		if (i==6){ value=ad2460.allianceData.rankDetails[rank-1].access_taxation;	}
		if (i==7){ value=ad2460.allianceData.rankDetails[rank-1].access_military;	}
		if (i==8){ value=ad2460.allianceData.rankDetails[rank-1].access_promotion;	}
		if (i==9){ value=ad2460.allianceData.rankDetails[rank-1].access_moderation;	}

		if (value==0){
			boximage.setAttribute("src",'images/icons/adunselected.png');
		}
		else {
			boximage.setAttribute("src",'images/icons/adsselected.png');
		}

		var boxdesccontainer=document.createElement('div');
		boxdesccontainer.setAttribute("class",'rank_privilege_desc');
		var boxtitle=document.createElement('span');
		boxtitle.setAttribute("class",'privilege_title');
		boxtitle.innerHTML=ad2460.alliancePrivilegesHeaders[i];
		var boxdesc=document.createElement('span');
		boxdesc.innerHTML=ad2460.alliancePrivilegesComments[i];


		box.appendChild(boximage);
		boxdesccontainer.appendChild(boxtitle);
		boxdesccontainer.appendChild(boxdesc);
		box.appendChild(boxdesccontainer);

		if (i<5){
			leftcolumn.appendChild(box);
		}
		else {
			rightcolumn.appendChild(box);
		}
	}

	// And finally, we attach the header and the columns
	subparent.appendChild(columnsheader);
	subparent.appendChild(leftcolumn);
	subparent.appendChild(rightcolumn);
	parent.appendChild(subparent);
	parent.style.display='block';
	subparent.style.display='block';
	subparent.style.opacity=1;

}

function toggleRankPriv(rank, privId){
	var i=0;
	if (rank==1){
		return;
	}
	if (privId==0){ad2460.allianceData.rankDetails[rank-1].access_invitation=1-ad2460.allianceData.rankDetails[rank-1].access_invitation; }
	if (privId==1){ad2460.allianceData.rankDetails[rank-1].access_kicking=1-ad2460.allianceData.rankDetails[rank-1].access_kicking; }
	if (privId==2){ad2460.allianceData.rankDetails[rank-1].access_banking=1-ad2460.allianceData.rankDetails[rank-1].access_banking; }
	if (privId==3){ad2460.allianceData.rankDetails[rank-1].access_info=1-ad2460.allianceData.rankDetails[rank-1].access_info; }
	if (privId==4){ad2460.allianceData.rankDetails[rank-1].access_project=1-ad2460.allianceData.rankDetails[rank-1].access_project; }
	if (privId==5){ad2460.allianceData.rankDetails[rank-1].access_mission=1-ad2460.allianceData.rankDetails[rank-1].access_mission; }
	if (privId==6){ad2460.allianceData.rankDetails[rank-1].access_taxation=1-ad2460.allianceData.rankDetails[rank-1].access_taxation; }
	if (privId==7){ad2460.allianceData.rankDetails[rank-1].access_military=1-ad2460.allianceData.rankDetails[rank-1].access_military; }
	if (privId==8){ad2460.allianceData.rankDetails[rank-1].access_promotion=1-ad2460.allianceData.rankDetails[rank-1].access_promotion; }
	if (privId==9){ad2460.allianceData.rankDetails[rank-1].access_moderation=1-ad2460.allianceData.rankDetails[rank-1].access_moderation; }

	$.post('actionhandler.pl', {action:'update_alliance_rank_access',rank:rank, priv_id:privId}, function(data){ parseInfo(data);});

	renderPrivileges(rank);

}

function allianceManagementIssuedInvitesClick(){
	ad2460.allianceData.lastAllianceMenuSelected='invites';
	// cleanup previous content
	removeChildNodes('alliance_management_sidepanel_content');
	var sidepanel=document.getElementById('alliance_management_sidepanel_content');

	var div1=document.createElement('div');
	div1.setAttribute("class",'alliance_section_side_header');
	div1.setAttribute("id",'alliance_section_side_header');
	div1.innerHTML='Alliance-invitations';

	var div2=document.createElement('div');
	div2.setAttribute("class",'member_invite_input_container');

	var div3=document.createElement('div');
	div3.setAttribute("class",'invite_shade_bottom');

	var div4=document.createElement('div');
	div4.setAttribute("class",'lightbutton160');
	div4.setAttribute("onclick",'allianceInviteButtonClick()');

	var div5=document.createElement('div');
	div5.setAttribute("class",'buttontext24');
	div5.innerHTML='Invite';

	var div6=document.createElement('div');
	div6.setAttribute("class",'member_invite_info');
	div6.innerHTML="You can invite any player into your alliance here, by typing in his name and clicking the button. New members are given the lowest rank. You can withdraw an active invite using the status list below.";

	var input1=document.createElement('input');
	input1.setAttribute("class",'newmember_input input_styling');
	input1.setAttribute("id",'alliance_invite_name_input');
	input1.setAttribute("placeholder",'Invite player...');

	// At this stage, we need some access-checking...Does the current user have access enough to issue invites?
	var access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_invitation;

	if (access==1){
		div4.appendChild(div5);
		div2.appendChild(div3);
		div2.appendChild(input1);
		div2.appendChild(div4);

		sidepanel.appendChild(div1);
		sidepanel.appendChild(div2);
		sidepanel.appendChild(div6);

	}
	else {
		div2.innerHTML='You do not have sufficient privileges to issue invitations yourself.';
		div2.appendChild(div3);
		sidepanel.appendChild(div1);
		sidepanel.appendChild(div2);
		sidepanel.appendChild(div6);
	}

	// Finish up by rendering pending invitations...
	renderSentAllianceInvitations();
	addDynamicHelpButtons('alliance_invites');
}

function renderSentAllianceInvitations(){
	removeChildNodes('alliance_management_infopanel_content');
	var infopanel=document.getElementById('alliance_management_infopanel_content');

	var headerDiv=document.createElement('div');
	headerDiv.setAttribute("class",'infopanel_header');
	headerDiv.innerHTML='Issued invitations';
	infopanel.appendChild(headerDiv);

	var outerContainer=document.createElement('div');
	outerContainer.setAttribute("class",'selection_container rescomp_container');
	outerContainer.setAttribute("id",'outer_invites_container');
	outerContainer.style.height='273px';
	infopanel.appendChild(outerContainer);

	var invContainer=document.createElement('div');
	invContainer.setAttribute("class",'rescomp_list infopanel_scroll_content');
	invContainer.setAttribute("id",'infopanel_issued_invites_container');
	outerContainer.appendChild(invContainer);

	var scrollButtonsContainer=document.createElement('div');
	scrollButtonsContainer.setAttribute("class",'scrollbuttons');
	scrollButtonsContainer.style.top='76px';
	outerContainer.appendChild(scrollButtonsContainer);


	var upButton=document.createElement('div');
	upButton.setAttribute("class",'scrollbutton_up');
	upButton.setAttribute("id",'infopanel_issued_invites_container_up');
	upButton.setAttribute("onclick","myScroll('infopanel_issued_invites_container',200,500)");
	scrollButtonsContainer.appendChild(upButton);

	var downButton=document.createElement('div');
	downButton.setAttribute("class",'scrollbutton_down');
	downButton.setAttribute("id",'infopanel_issued_invites_container_down');
	downButton.setAttribute("onclick","myScroll('infopanel_issued_invites_container',-200,500)");
	scrollButtonsContainer.appendChild(downButton);

	/*
	<div class="selection_container rescomp_container" >
		<div class="rescomp_list infopanel_scroll_content" id="infopanel_issued_invites_container">
			<div class="member_invite_listing">
				<div class="member_invite_name">Tester1</div>
				<div class="member_invite_time">1 minute ago</div>
				<div class="member_invite_withdraw" onclick="withdrawInvitation(148)">Withdraw</div>
			</div>
		</div>
		<div class="scrollbuttons" style="top: 10px;">
			<div class="scrollbutton_up" id="infopanel_issued_invites_container_up" onclick="myScroll('infopanel_issued_invites_container',200,500)"></div>
			<div class="scrollbutton_down hover" id="infopanel_issued_invites_container_down" onclick="myScroll('infopanel_issued_invites_container',-200,500)"></div>
		</div>
	</div>
	*/

	// And now, per pending invitation:
	var i=0;
	for (i=0;i<ad2460.allianceData.invitedlist.length ;i++ ){
		var container=document.createElement('div');
		container.setAttribute("class",'member_invite_listing');
		container.style.width="93%";
		var namediv=document.createElement('div');
		namediv.setAttribute("class",'member_invite_name');
		namediv.innerHTML=ad2460.allianceData.invitedlist[i].name;
		namediv.style.width="155px";
		var timediv=document.createElement('div');
		timediv.setAttribute("class",'member_invite_time');
		timediv.innerHTML=formatMessageTimestamp(ad2460.allianceData.invitedlist[i].invite_timestamp);
		timediv.style.width="155px";
		var withdrawdiv=document.createElement('div');
		withdrawdiv.setAttribute("class",'member_invite_withdraw');
		withdrawdiv.setAttribute("onclick",'withdrawInvitation('+ad2460.allianceData.invitedlist[i].user_id+')');
		withdrawdiv.innerHTML='Withdraw';

		container.appendChild(namediv);
		container.appendChild(timediv);
		container.appendChild(withdrawdiv);

		invContainer.appendChild(container);

	}
	checkScrollButtonStatus('infopanel_issued_invites_container');
}

function withdrawInvitation(user_id){
	var access=ad2460.allianceData.rankDetails[ad2460.allianceData.rank_id-1].access_invitation;
	if (access<1){
		return;
	}
	// Ok, he's got access...
	var i=0;
	for (i=0;i<ad2460.allianceData.invitedlist.length ;i++ ){
		if (ad2460.allianceData.invitedlist[i].user_id==user_id){
			ad2460.allianceData.invitedlist.splice(i,1);
			i--;
		}
	}

	$.post('actionhandler.pl', {action:'delete_alliance_invitation',invitation_user_id:user_id}, function(data){ parseInfo(data);});
	renderSentAllianceInvitations();
}

function allianceInviteButtonClick(nick_override){

	var thisName;

	if (document.getElementById('alliance_invite_name_input') ) {
		thisName=document.getElementById('alliance_invite_name_input').value;
	}
	if (nick_override){
		if (nick_override.length>2){
			thisName=nick_override;
		}
	}

	if (thisName.length<1){
		return;
	}

	$.post('actionhandler.pl', {action:'invite_into_alliance',nickname:thisName}, function(data){ parseInfo(data);});
}

function allianceManagementMessageOfTheDayClick(){
	ad2460.allianceData.lastAllianceMenuSelected='motd';
	// Clear the side- and infopanels
	removeChildNodes('alliance_management_sidepanel_content');
	var sidepanel=document.getElementById('alliance_management_sidepanel_content');

	removeChildNodes('alliance_management_infopanel_content');
	var infopanel=document.getElementById('alliance_management_infopanel_content');

	// The sidepanel

	var sidepanel_header_div=document.createElement('div');
	sidepanel_header_div.setAttribute("class",'alliance_section_side_header');
	sidepanel_header_div.setAttribute("id",'alliance_section_side_header');

	sidepanel_header_div.innerHTML="Message of the Day";

	var motd_info=document.createElement('div');
	motd_info.setAttribute("class",'motd_info');
	motd_info.innerHTML="Edit current MOTD";

	var motd_textarea=document.createElement('textarea');
	motd_textarea.setAttribute("class",'motd_text_edit_input');
	motd_textarea.setAttribute("id",'alliance_motd_textarea');
	motd_textarea.innerHTML=ad2460.allianceData.motd;

	var button_div=document.createElement('div');
	button_div.setAttribute("class",'lightbutton160 motd_submit green');
	button_div.setAttribute("onclick",'submitAllianceMotd()');

	var button_text=document.createElement('div');
	button_text.setAttribute("class",'buttontext24');
	button_text.innerHTML='Update';

	sidepanel.appendChild(sidepanel_header_div);
	sidepanel.appendChild(motd_info);
	sidepanel.appendChild(motd_textarea);
	button_div.appendChild(button_text);
	sidepanel.appendChild(button_div);

	// The infopanel

	var infopanel_header_string="Updating the MOTD";
	var infopanel_body_string="Paste coordinates to auto-create links. Use of smilies are allowed. Keep it clean though. The MOTD is visible to all members of the alliance, regardless of rank.<br><br>The short text displayed in the main gui is anything before the first DOUBLE linebreak of the MOTD, but capped at approximately 200 characters.";

	var infopanel_header_div=document.createElement('div');
	infopanel_header_div.setAttribute("class",'infopanel_header');
	infopanel_header_div.innerHTML=infopanel_header_string;
	var infopanel_body_span=document.createElement('span');
	infopanel_body_span.innerHTML=infopanel_body_string;

	infopanel.appendChild(infopanel_header_div);
	infopanel.appendChild(infopanel_body_span);

	addDynamicHelpButtons('alliance_motd');
}

function submitAllianceMotd(){
	var new_motd=document.getElementById('alliance_motd_textarea').value;
	$.post('actionhandler.pl', {action:'submit_alliance_motd',new_motd:new_motd}, function(data){ parseInfo(data);});

}

function updateDonationValues(hassium, neodymium, strontium, indium){
	//console.log(hassium, neodymium, strontium, indium);
	$("#bank_hassium_input").val(hassium);
	$("#bank_neodymium_input").val(neodymium);
	$("#bank_strontium_input").val(strontium);
	$("#bank_indium_input").val(indium);
}

function allianceManagementAllianceBankClick(){
	// cleanup previous content
	ad2460.allianceData.lastAllianceMenuSelected='bank';
	var myRank=ad2460.allianceData.rank_id;

	removeChildNodes('alliance_management_sidepanel_content');
	var sidepanel=document.getElementById('alliance_management_sidepanel_content');

	var alliance_section_side_header=createSingleElement('div', 'alliance_section_side_header', 'alliance_section_side_header', 'The Alliance Bank', '');
	var lowpanel_header=createSingleElement('div', 'lowpanel_header', '', 'Alliance Holdings', '');
	var bank_resources=createSingleElement('div', 'bank_resources', '', '', '');

	bank_resources.setAttribute("title","The white numbers show how much is stored in the bank, and the red numbers display the hourly upkeep for the bank-fleet.");

	var bank_holding_hs=createSingleElement('div', 'bank_holding hs', 'bank_hassium', '', '');
	var bank_holding_nd=createSingleElement('div', 'bank_holding nd', 'bank_neodymium', '', '');
	var bank_holding_sr=createSingleElement('div', 'bank_holding sr', 'bank_strontium', '', '');
	var bank_holding_in=createSingleElement('div', 'bank_holding in', 'bank_indium', '', '');

	var bank_upkeep_hs=createSingleElement('div', 'bank_upkeep hs', 'bank_upkeep_hassium', '', '');
	var bank_upkeep_nd=createSingleElement('div', 'bank_upkeep nd', 'bank_upkeep_neodymium', '', '');
	var bank_upkeep_sr=createSingleElement('div', 'bank_upkeep sr', 'bank_upkeep_strontium', '', '');
	var bank_upkeep_in=createSingleElement('div', 'bank_upkeep in', 'bank_upkeep_indium', '', '');

	var total_upkeep_from_bank={};
	total_upkeep_from_bank.hassium=0;
	total_upkeep_from_bank.indium=0;
	total_upkeep_from_bank.strontium=0;
	total_upkeep_from_bank.neodymium=0;

	for (var s=0;s<ad2460.allianceData.stations.length ;s++ ){
		for (var f=0;f<ad2460.allianceData.stations[s].fleets.length ;f++ ){
			total_upkeep_from_bank.hassium+=ad2460.allianceData.stations[s].fleets[f].upkeep.hassium;
			total_upkeep_from_bank.indium+=ad2460.allianceData.stations[s].fleets[f].upkeep.indium;
			total_upkeep_from_bank.strontium+=ad2460.allianceData.stations[s].fleets[f].upkeep.strontium;
			total_upkeep_from_bank.neodymium+=ad2460.allianceData.stations[s].fleets[f].upkeep.neodymium;
		}
	}

	if (ad2460.allianceData.bank.fleet){
		total_upkeep_from_bank.hassium+=ad2460.allianceData.bank.fleet.upkeep.hassium;
		total_upkeep_from_bank.indium+=ad2460.allianceData.bank.fleet.upkeep.indium;
		total_upkeep_from_bank.strontium+=ad2460.allianceData.bank.fleet.upkeep.strontium;
		total_upkeep_from_bank.neodymium+=ad2460.allianceData.bank.fleet.upkeep.neodymium;
	}

	bank_upkeep_hs.innerHTML=prettyPrint(total_upkeep_from_bank.hassium)+' /h';
	bank_upkeep_in.innerHTML=prettyPrint(total_upkeep_from_bank.indium)+' /h';
	bank_upkeep_sr.innerHTML=prettyPrint(total_upkeep_from_bank.strontium)+' /h';
	bank_upkeep_nd.innerHTML=prettyPrint(total_upkeep_from_bank.neodymium)+' /h';

	var bank_holding_input_hs=createSingleElement('input', 'bank_input input_styling', 'bank_hassium_input', '', '');
	var bank_holding_input_nd=createSingleElement('input', 'bank_input input_styling', 'bank_neodymium_input', '', '');
	var bank_holding_input_sr=createSingleElement('input', 'bank_input input_styling', 'bank_strontium_input', '', '');
	var bank_holding_input_in=createSingleElement('input', 'bank_input input_styling', 'bank_indium_input', '', '');

	var bank_buttons=createSingleElement('div', 'bank_buttons', '', '', '');

	bank_holding_input_hs.onkeydown=function(event){
		if (event.which==9 || event.keyCode==9) {
			document.getElementById('bank_indium_input').focus();
			return false;
		}
	}
	bank_holding_input_in.onkeydown=function(event){
		if (event.which==9 || event.keyCode==9) {
			document.getElementById('bank_strontium_input').focus();
			return false;
		}
	}
	bank_holding_input_sr.onkeydown=function(event){
		if (event.which==9 || event.keyCode==9) {
			document.getElementById('bank_neodymium_input').focus();
			return false;
		}
	}

	var depositsLeft=5;
	//for (var d=0;d<ad2460.allianceData.bankLog.length ;d++ ){
	//	if (ad2460.allianceData.bankLog[d].transaction_type==1 && ad2460.allianceData.bankLog[d].user_id==ad2460.user_id && ad2460.allianceData.bankLog[d].timestamp>=ad2460.serverTime-(24*3600) ) {
	//		depositsLeft--;
	//	}
	//}

	var depositButton=createButtonElement('Deposit ('+depositsLeft+')','lightbutton160 deposit_button','buttontext24','allianceBankDepositClick(event)','alliance_fund_deposit_button');
	//var withdrawButton=createButtonElement('Withdraw','lightbutton160 central_button','buttontext24','allianceBankWithdrawClick()','alliance_fund_withdraw_button');
	var donateButton=createButtonElement('Donate to','lightbutton160','buttontext24','allianceBankDonateClick()','alliance_fund_donate_button');

	var donation_info=createSingleElement('div', 'bank_local_info', '', 'There is a 10% fee on all direct donations.', '');

	//	var bank_balance_info=createSingleElement('div', 'bank_balance_info', '', 'You can add to the alliance holdings as you see fit, or withdraw if you have the rights. You need the right officer rank to be able to donate any resouces to players or the alliance projects pool.', '');

	// Change of plans..dropdown ohoi...
//	var donation_container=createSingleElement('div', 'alliance_type_select donate', '', '', '');
	var donation_container_2=createSingleElement('div', 'rank_select bank', '', '', '');
	var donation_dropdown=document.createElement('select');
	donation_dropdown.setAttribute("class",'rankselect bank');
	donation_dropdown.setAttribute("id",'donate_select_dropdown');
	donation_dropdown.options[donation_dropdown.options.length] = new Option( 'Select recipient' ,0);

	// Lets duplicate the array, then sort it
	var memberlistcopy = ad2460.allianceData.memberlist.slice().sort(function(a, b) {
	  var nameA = a.name.toUpperCase();
	  var nameB = b.name.toUpperCase();
	  if (nameA < nameB) {
	    return -1;
	  }
	  if (nameA > nameB) {
	    return 1;
	  }
	  // names must be equal
	  return 0;
	}
);

	var i=0;
	for (i=0;i<memberlistcopy.length ;i++ ){
		donation_dropdown.options[donation_dropdown.options.length] = new Option( memberlistcopy[i].name ,memberlistcopy[i].user_id);
		if (memberlistcopy[i].user_id==ad2460.user_id){
			donation_dropdown.selectedIndex=i+1;
		}
	}

	var bank_local_container=createSingleElement('div', 'bank_local_container', '', '', '');

	var bank_local_shader_up=createSingleElement('div', 'shade_up bank_local_shader_up', '', '', '');
	var lowpanel_local_header=createSingleElement('div', 'lowpanel_header', '', 'Local Holdings', '');

	var local_bank_resources=createSingleElement('div', 'bank_resources', '', '', '');
	var local_bank_holding_hs=createSingleElement('div', 'bank_holding hs', 'my_bank_hassium', '', '');
	var local_bank_holding_nd=createSingleElement('div', 'bank_holding nd', 'my_bank_neodymium', '', '');
	var local_bank_holding_sr=createSingleElement('div', 'bank_holding sr', 'my_bank_strontium', '', '');
	var local_bank_holding_in=createSingleElement('div', 'bank_holding in', 'my_bank_indium', '', '');

	var bank_local_info=createSingleElement('div', 'bank_local_info', '', 'Local Alliance Holdings are the amount of resources belonging to the alliance that is stored on your home planet. It may be lost in the event of a successful attack against you.', '');
	var bank_local_shader_down=createSingleElement('div', 'shade_down bank_local_shader_down', '', '', '');

	bank_local_info.style.height='44px';

	// Woohaa, now tie them up in the structure...
	bank_resources.appendChild(bank_holding_hs);
	bank_resources.appendChild(bank_holding_nd);
	bank_resources.appendChild(bank_holding_sr);
	bank_resources.appendChild(bank_holding_in);

	bank_resources.appendChild(bank_upkeep_hs);
	bank_resources.appendChild(bank_upkeep_nd);
	bank_resources.appendChild(bank_upkeep_sr);
	bank_resources.appendChild(bank_upkeep_in);

	local_bank_resources.appendChild(local_bank_holding_hs);
	local_bank_resources.appendChild(local_bank_holding_nd);
	local_bank_resources.appendChild(local_bank_holding_sr);
	local_bank_resources.appendChild(local_bank_holding_in);

	bank_buttons.appendChild(depositButton);
	if (ad2460.allianceData.rankDetails[myRank-1].access_banking==1){
		// bank_buttons.appendChild(withdrawButton);
		//bank_buttons.appendChild(donation_container);
		//donation_container.appendChild(donation_container_2);
		bank_buttons.appendChild(donation_container_2);
		donation_container_2.appendChild(donateButton);
		donation_container_2.appendChild(donation_dropdown);

	}

	// Setting up the new data for the HQ stuff
	var alliance_hq_container=createSingleElement('div', 'capital_container', '', '', '');
	var alliance_hq_second=createSingleElement('div', 'alliance_capital_info', '', '', '');
	var alliance_hq_info1=createSingleElement('div', 'capital_info1', '', '', '');

	var alliance_hq_1=createSingleElement('div', 'capital_info_header', '', 'Planet Name', '');
	var alliance_hq_2=createSingleElement('div', 'capital_info_entry', 'alliance_capital_planet_name', ''+ad2460.allianceData.bank.name, '');
	var coordString=convertShortCoordsToLongCoords(ad2460.allianceData.bank.x,ad2460.allianceData.bank.y).coordString;
	var alliance_hq_3=createSingleElement('div', 'outpost_coords', 'alliance_capital_coords', coordString, 'zoomInToXY('+ad2460.allianceData.bank.x+','+ad2460.allianceData.bank.y+')');
	var alliance_hq_4=createSingleElement('div', 'capital_info_header', '', 'Present strength', '');
	var alliance_hq_5=createSingleElement('div', 'capital_info_entry', 'alliance_capital_strength', ''+prettyPrint(ad2460.allianceData.bank.fleet.strength), '');
	var alliance_hq_6=createSingleElement('div', 'capital_info_header', '', 'Actions', '');
	var alliance_hq_7=createSingleElement('div', 'capital_info_actions', '', '', '');
	var alliance_hq_71=createSingleElement('div', 'station_action_button', '', 'Tactics', 'showBankFleetTactics()');
	var alliance_hq_72=createSingleElement('div', 'station_action_button', '', 'Ships', 'showBankFleetShips()');
	var alliance_hq_73=createSingleElement('div', 'station_action_button', '', 'Log', 'fetchFleetDonationLog(ad2460.allianceData.bank.fleet.fleet_id)');

	var alliance_hq_director=createSingleElement('div', 'bank_director', '', '', '');

	alliance_hq_container.appendChild(alliance_hq_second);
	alliance_hq_second.appendChild(alliance_hq_info1);
	alliance_hq_info1.appendChild(alliance_hq_1);
	alliance_hq_info1.appendChild(alliance_hq_2);
	alliance_hq_info1.appendChild(alliance_hq_3);
	alliance_hq_info1.appendChild(alliance_hq_4);
	alliance_hq_info1.appendChild(alliance_hq_5);
	alliance_hq_info1.appendChild(alliance_hq_6);
	alliance_hq_info1.appendChild(alliance_hq_7);
	alliance_hq_7.appendChild(alliance_hq_71);
	alliance_hq_7.appendChild(alliance_hq_72);
	alliance_hq_7.appendChild(alliance_hq_73);

	alliance_hq_second.appendChild(alliance_hq_director);

	// new stuff prepped

	bank_local_container.appendChild(bank_local_shader_up);
	bank_local_container.appendChild(lowpanel_local_header);
	bank_local_container.appendChild(local_bank_resources);
	bank_local_container.appendChild(bank_local_info);
	bank_local_container.appendChild(bank_local_shader_down);

	sidepanel.appendChild(alliance_section_side_header);

	// grace-indicator
	if (ad2460.allianceData.bank.planet_grace>ad2460.serverTime){

		var bankGraceContainer=createSingleElement('div', 'planet_status', '', '', '');
		var bankGraceImage=createSingleElement('img', 'planet_status_icon', '', 'images/icons/grace_icon.png', '');
		var graceTimeString=secondsToFullTime(ad2460.allianceData.bank.planet_grace-ad2460.serverTime);
		var graceTimeStringDiv=createSingleElement('div', 'bank_grace_string', '', graceTimeString, '');

		bankGraceContainer.appendChild(bankGraceImage);
		bankGraceContainer.appendChild(graceTimeStringDiv);

		alliance_hq_second.appendChild(bankGraceContainer);
	}

	sidepanel.appendChild(alliance_hq_container);
	sidepanel.appendChild(lowpanel_header);
	sidepanel.appendChild(bank_resources);
	sidepanel.appendChild(bank_holding_input_hs);
	sidepanel.appendChild(bank_holding_input_in);
	sidepanel.appendChild(bank_holding_input_sr);
	sidepanel.appendChild(bank_holding_input_nd);
	bank_buttons.appendChild(donation_info);
	sidepanel.appendChild(bank_buttons);

	//sidepanel.appendChild(bank_local_container);

	renderAllianceHoldings();
	//renderAllianceBankLog();
	//renderAllianceBankLogNew();
	fetchBankLog();
	addDynamicHelpButtons('alliance_bank');
}

function updateAllianceBank(hassium, neodymium, strontium, indium, my_hassium, my_neodymium, my_strontium, my_indium){
	if (ad2460.allianceData.bank.hasOwnProperty('hassium')){
		ad2460.allianceData.bank.hassium=hassium;
		ad2460.allianceData.bank.neodymium=neodymium;
		ad2460.allianceData.bank.strontium=strontium;
		ad2460.allianceData.bank.indium=indium;

		ad2460.allianceData.myBank.hassium=my_hassium;
		ad2460.allianceData.myBank.neodymium=my_neodymium;
		ad2460.allianceData.myBank.strontium=my_strontium;
		ad2460.allianceData.myBank.indium=my_indium;
	}
	else {
		ad2460.allianceData.bank={};
		ad2460.allianceData.bank.hassium=hassium;
		ad2460.allianceData.bank.neodymium=neodymium;
		ad2460.allianceData.bank.strontium=strontium;
		ad2460.allianceData.bank.indium=indium;

		ad2460.allianceData.myBank.hassium=my_hassium;
		ad2460.allianceData.myBank.neodymium=my_neodymium;
		ad2460.allianceData.myBank.strontium=my_strontium;
		ad2460.allianceData.myBank.indium=my_indium;

	}
	renderAllianceHoldings();
}

function renderAllianceHoldings(){

	$("#bank_hassium").html(prettyPrint(ad2460.allianceData.bank.hassium));
	$("#bank_neodymium").html(prettyPrint(ad2460.allianceData.bank.neodymium));
	$("#bank_strontium").html(prettyPrint(ad2460.allianceData.bank.strontium));
	$("#bank_indium").html(prettyPrint(ad2460.allianceData.bank.indium));

	$("#my_bank_hassium").html(prettyPrint(ad2460.allianceData.myBank.hassium));
	$("#my_bank_neodymium").html(prettyPrint(ad2460.allianceData.myBank.neodymium));
	$("#my_bank_strontium").html(prettyPrint(ad2460.allianceData.myBank.strontium));
	$("#my_bank_indium").html(prettyPrint(ad2460.allianceData.myBank.indium));

}

function toggleBankLogDays(){
	var mainText="You currently have bank-log-data for "+ad2460.allianceData.bank_log_days+" days. <br>A setting of 5 days ensures optimal performance. A setting of 100 days may cause performance-issues on some devices for large alliances, specially towards the end of a cycle. <br>By clicking OK below, you will toggle between 5 and 100.";
	var okText='OK';
	var cancelText='Do not change';

	var okClick='confirmedToggleBankLogDays();hideConfirmationPopup();';
	var cancelClick="hideConfirmationPopup();";
	showConfirmationPopup(mainText, okText, cancelText, okClick, cancelClick, false, false, false, false);
}

function confirmedToggleBankLogDays(){
	if (ad2460.allianceData.bank_log_days==100){
		ad2460.allianceData.bank_log_days=5;
	}
	else {
		ad2460.allianceData.bank_log_days=100;
	}
	SetCookie("bank_log_days", ''+ad2460.allianceData.bank_log_days, window.location.host,90);

	reloadAllianceData("allianceManagementAllianceBankClick(); systemFeedback('Ok','Data reloaded',2,3);");

}

function fetchBankLog(){
	$.post('actionhandler.pl', {action:'fetch_bank_log_newest'}, function(data){ parseInfo(data);renderAllianceBankLogNewest();});
}

function renderAllianceBankLogNew(){

	console.log("renderAllianceBankLogNew called, it should not be....doing nothing..");
	return;

	removeChildNodes('alliance_management_infopanel_content');
	var sidepanel=document.getElementById('alliance_management_infopanel_content');
	var outerparent=createSingleElement('div', 'selection_container rescomp_container', '', '', '');
	var innerparent=createSingleElement('div', 'rescomp_list', 'bank_log_list', '', '');

	innerparent.style.overflow='auto';
	innerparent.style.height='170px';
	innerparent.style.width='500px';
	innerparent.style.paddingRight='20px';


	outerparent.appendChild(innerparent);

	var header=createSingleElement('div', 'infopanel_header', '', 'Alliance Bank Resource Summary <span style="text-decoration:underline;cursor:pointer;">Last '+ad2460.allianceData.bank_log_days+' Days</span>', 'toggleBankLogDays()');
	sidepanel.appendChild(header);

	// ok, now we rather want a summary per member who exists in the log
	//ad2460.allianceData.bankLog
	var summaryArray=new Array;
	var alog=ad2460.allianceData.bankLog;
	for (var i = 0; i < alog.length; i++) {
		if(alog[i].target_user_id==0){
			// These are all in fact donations to the bank, so will count positive on the balance of the user_id
			var userFound=false;
			for(x=0;x<summaryArray.length;x++){
				if(summaryArray[x].user_id==alog[i].user_id && alog[i].target_user_id==0){
					// User found
					userFound=true;
					if(alog[i].transaction_type==1){
						// A deposit
						summaryArray[x].hassium+=alog[i].hassium;
						summaryArray[x].indium+=alog[i].indium;
						summaryArray[x].strontium+=alog[i].strontium;
						summaryArray[x].neodymium+=alog[i].neodymium;
					}
					if(alog[i].transaction_type==5){
						// A deposit that doesn't count towards the limit
						summaryArray[x].hassium+=alog[i].hassium;
						summaryArray[x].indium+=alog[i].indium;
						summaryArray[x].strontium+=alog[i].strontium;
						summaryArray[x].neodymium+=alog[i].neodymium;
					}

				}
			}
			if (userFound==false){
				summaryArray.push({user_id:alog[i].user_id, nickname:alog[i].nickname,hassium:alog[i].hassium, indium:alog[i].indium, strontium:alog[i].strontium,neodymium:alog[i].neodymium});
			}
		}
	}

	for (var i = 0; i < alog.length; i++) {
		if(alog[i].target_user_id>0){
			// These are all in fact resources going out of the bank, impacting a negative balance of the target_user_id
			var userFound=false;
			for(x=0;x<summaryArray.length;x++){
				if(summaryArray[x].user_id==alog[i].target_user_id){
					// User found
					userFound=true;
					if(alog[i].transaction_type==3){
						// A withdrawl / donation to someone
						summaryArray[x].hassium-=alog[i].hassium;
						summaryArray[x].indium-=alog[i].indium;
						summaryArray[x].strontium-=alog[i].strontium;
						summaryArray[x].neodymium-=alog[i].neodymium;
					}
				}
			}
			if (userFound==false){
				summaryArray.push({user_id:alog[i].target_user_id, nickname:alog[i].target_nickname,hassium:0-alog[i].hassium, indium:0-alog[i].indium, strontium:0-alog[i].strontium,neodymium:0-alog[i].neodymium});
			}
		}
	}


	summaryArray.sort(newBankLogSort);

	// Time to actually render it!
	for (i=0;i<summaryArray.length;i++){

		var nameclass="money_log_in";
		if(summaryArray[i].hassium+summaryArray[i].indium+summaryArray[i].strontium+summaryArray[i].neodymium<0){
			nameclass="money_log_out";
		}

		var log_string=summaryArray[i].nickname;

		var guicontainer=createSingleElement('div', 'tax_summary_resources', '', '', '');
		var hsdiv=createSingleElement('div', 'summary_entry hs', '', ''+prettyPrint(summaryArray[i].hassium), '');
		var indiv=createSingleElement('div', 'summary_entry in', '', ''+prettyPrint(summaryArray[i].indium), '');
		var srdiv=createSingleElement('div', 'summary_entry sr', '', ''+prettyPrint(summaryArray[i].strontium), '');
		var nddiv=createSingleElement('div', 'summary_entry nd', '', ''+prettyPrint(summaryArray[i].neodymium), '');

		guicontainer.appendChild(hsdiv);
		guicontainer.appendChild(indiv);
		guicontainer.appendChild(srdiv);
		guicontainer.appendChild(nddiv);

		var row=createSingleElement('div', 'money_log_row', '', '', '');
		var col2=createSingleElement('span', 'money_log_entry '+nameclass, '', log_string, '');

		//row.appendChild(col1);
		row.appendChild(col2);
		row.appendChild(guicontainer);

		innerparent.appendChild(row);
	}

	outerparent.appendChild(innerparent);
	sidepanel.appendChild(outerparent);

	updateDepositButton();

}

function renderAllianceBankLogNewest(){

	removeChildNodes('alliance_management_infopanel_content');
	var sidepanel=document.getElementById('alliance_management_infopanel_content');
	var outerparent=createSingleElement('div', 'selection_container rescomp_container', '', '', '');
	var innerparent=createSingleElement('div', 'rescomp_list', 'bank_log_list', '', '');

	innerparent.style.overflow='auto';
	innerparent.style.height='170px';
	innerparent.style.width='500px';
	innerparent.style.paddingRight='20px';


	outerparent.appendChild(innerparent);

	var header=createSingleElement('div', 'infopanel_header', '', 'Alliance Bank Resource Summary <span style="text-decoration:underline;cursor:pointer;">Last '+ad2460.allianceData.bank_log_days+' Days</span>', 'toggleBankLogDays()');
	sidepanel.appendChild(header);

	// ok, now we rather want a summary per member who exists in the log
	//ad2460.allianceData.bankLog

	// Now the banklog only has 1 entry per member, so it's pretty easy to render.
	// We might not want to render those with 0 ?
	var summaryArray=ad2460.allianceData.bankLog;
	summaryArray.sort(newBankLogSort);

	// Time to actually render it!
	for (i=0;i<summaryArray.length;i++){

		var nameclass="money_log_in";
		if(summaryArray[i].hassium+summaryArray[i].indium+summaryArray[i].strontium+summaryArray[i].neodymium<0){
			nameclass="money_log_out";
		}

		var log_string=summaryArray[i].nickname;

		var guicontainer=createSingleElement('div', 'tax_summary_resources', '', '', '');
		var hsdiv=createSingleElement('div', 'summary_entry hs', '', ''+prettyPrint(summaryArray[i].hassium), '');
		var indiv=createSingleElement('div', 'summary_entry in', '', ''+prettyPrint(summaryArray[i].indium), '');
		var srdiv=createSingleElement('div', 'summary_entry sr', '', ''+prettyPrint(summaryArray[i].strontium), '');
		var nddiv=createSingleElement('div', 'summary_entry nd', '', ''+prettyPrint(summaryArray[i].neodymium), '');

		guicontainer.appendChild(hsdiv);
		guicontainer.appendChild(indiv);
		guicontainer.appendChild(srdiv);
		guicontainer.appendChild(nddiv);

		var row=createSingleElement('div', 'money_log_row', '', '', '');
		var col2=createSingleElement('span', 'money_log_entry '+nameclass, '', log_string, '');

		//row.appendChild(col1);
		row.appendChild(col2);
		row.appendChild(guicontainer);

		innerparent.appendChild(row);
	}

	outerparent.appendChild(innerparent);
	sidepanel.appendChild(outerparent);

	updateDepositButton();

}

function updateDepositButton(){
	var depositsLeft=5;
	for (var d=0;d<ad2460.allianceData.bankLog.length ;d++ ){
		if (ad2460.allianceData.bankLog[d].user_id==ad2460.user_id){
			depositsLeft-=ad2460.allianceData.bankLog[d].deposits_last_24_hours;
		}

		/*
		if (ad2460.allianceData.bankLog[d].transaction_type==1 && ad2460.allianceData.bankLog[d].user_id==ad2460.user_id && ad2460.allianceData.bankLog[d].timestamp>=ad2460.serverTime-(24*3600) ) {
			depositsLeft--;
		}
		*/
	}

	$("#alliance_fund_deposit_button_button_text").html("Deposit ("+depositsLeft+")");
}


function newBankLogSort(a,b){
	return ( (a.hassium+a.indium+a.strontium+a.neodymium) -  (b.hassium+b.indium+b.strontium+b.neodymium) );
}

function renderAllianceBankLog(){
	// IKKE FERDIG HER! DU MÅ ENDRE DB'en til å holde på et "target"
	// For å støtte donation-strings!

	var myRank=ad2460.allianceData.rank_id;
	removeChildNodes('alliance_management_infopanel_content');
	var sidepanel=document.getElementById('alliance_management_infopanel_content');
	var outerparent=createSingleElement('div', 'selection_container rescomp_container', '', '', '');
	var innerparent=createSingleElement('div', 'rescomp_list', 'bank_log_list', '', '');

	innerparent.style.overflow='auto';
	innerparent.style.height='170px';
	innerparent.style.width='500px';
	innerparent.style.paddingRight='20px';


	outerparent.appendChild(innerparent);

	var header=createSingleElement('div', 'infopanel_header', '', 'Alliance Bank Money Log', '');
	sidepanel.appendChild(header);

	// The rest goes into the innerparent
	var i=0;
	for (i=0;i<ad2460.allianceData.bankLog.length ;i++ ){
		var log_string="";
		var textclass="money_log_in";
		if (ad2460.allianceData.bankLog[i].transaction_type==1 || ad2460.allianceData.bankLog[i].transaction_type==5){
			// Deposit
			//log_string=ad2460.allianceData.bankLog[i].nickname + ' deposited ' + prettyPrint(ad2460.allianceData.bankLog[i].hassium) +' HS ' + prettyPrint(ad2460.allianceData.bankLog[i].indium)+ ' IN '+ prettyPrint(ad2460.allianceData.bankLog[i].strontium) + ' ST ' + prettyPrint(ad2460.allianceData.bankLog[i].neodymium) + ' ND';
			log_string=ad2460.allianceData.bankLog[i].nickname + ' deposited:';
			textclass="money_log_in";
		}
		else if (ad2460.allianceData.bankLog[i].transaction_type==2){
			// Withdrawal
			//log_string=ad2460.allianceData.bankLog[i].nickname + ' withdrew ' + prettyPrint(ad2460.allianceData.bankLog[i].hassium) +' HS ' + prettyPrint(ad2460.allianceData.bankLog[i].indium)+ ' IN '+ prettyPrint(ad2460.allianceData.bankLog[i].strontium) + ' ST ' + prettyPrint(ad2460.allianceData.bankLog[i].neodymium) + ' ND' ;
			log_string=ad2460.allianceData.bankLog[i].nickname + ' withdrew:';
			textclass="money_log_out";
		}
		else if (ad2460.allianceData.bankLog[i].transaction_type==3){
			// Donation
			//log_string=ad2460.allianceData.bankLog[i].nickname + ' donated ' + prettyPrint(ad2460.allianceData.bankLog[i].hassium) +' HS ' + prettyPrint(ad2460.allianceData.bankLog[i].indium)+ ' IN '+ prettyPrint(ad2460.allianceData.bankLog[i].strontium) + ' ST ' + prettyPrint(ad2460.allianceData.bankLog[i].neodymium) + ' ND to ' +ad2460.allianceData.bankLog[i].target_nickname;
			log_string=ad2460.allianceData.bankLog[i].nickname + ' donated to ' +ad2460.allianceData.bankLog[i].target_nickname+' :';
			textclass="money_log_out";
		}


		var guicontainer=createSingleElement('div', 'tax_summary_resources', '', '', '');
		var hsdiv=createSingleElement('div', 'summary_entry hs', '', ''+prettyPrint(ad2460.allianceData.bankLog[i].hassium), '');
		var indiv=createSingleElement('div', 'summary_entry in', '', ''+prettyPrint(ad2460.allianceData.bankLog[i].indium), '');
		var srdiv=createSingleElement('div', 'summary_entry sr', '', ''+prettyPrint(ad2460.allianceData.bankLog[i].strontium), '');
		var nddiv=createSingleElement('div', 'summary_entry nd', '', ''+prettyPrint(ad2460.allianceData.bankLog[i].neodymium), '');

		guicontainer.appendChild(hsdiv);
		guicontainer.appendChild(indiv);
		guicontainer.appendChild(srdiv);
		guicontainer.appendChild(nddiv);

		var row=createSingleElement('div', 'money_log_row', '', '', '');
		//var col1=createSingleElement('span', 'money_log_name', '', '', ad2460.allianceData.bankLog[i].nickname);
		var col2=createSingleElement('span', 'money_log_entry '+textclass, '', log_string, '');
		var col3=createSingleElement('div', 'money_log_time', '', formatMessageTimestamp(ad2460.allianceData.bankLog[i].timestamp), '');

		//row.appendChild(col1);
		row.appendChild(col2);
		row.appendChild(col3);

		row.appendChild(guicontainer);

		innerparent.appendChild(row);
	}

	outerparent.appendChild(innerparent);

	sidepanel.appendChild(outerparent);

}

function allianceBankDepositClick(e){
	if (typeof(e)=='undefined'){
		return;
	}
	var deposit_hassium=document.getElementById('bank_hassium_input').value;
	var deposit_neodymium=document.getElementById('bank_neodymium_input').value;
	var deposit_strontium=document.getElementById('bank_strontium_input').value;
	var deposit_indium=document.getElementById('bank_indium_input').value;
	$.post('actionhandler.pl', {action:'deposit_to_bank',hassium:deposit_hassium, neodymium:deposit_neodymium, strontium:deposit_strontium, indium:deposit_indium }, function(data){ parseInfo(data);allianceManagementAllianceBankClick();});
}

function allianceBankDonateClick(){
	var deposit_hassium=document.getElementById('bank_hassium_input').value;
	var deposit_neodymium=document.getElementById('bank_neodymium_input').value;
	var deposit_strontium=document.getElementById('bank_strontium_input').value;
	var deposit_indium=document.getElementById('bank_indium_input').value;
	var target=document.getElementById('donate_select_dropdown').value;
	$.post('actionhandler.pl', {action:'donate_from_bank',hassium:deposit_hassium, neodymium:deposit_neodymium, strontium:deposit_strontium, indium:deposit_indium, target_user_id:target }, function(data){ parseInfo(data);});
}

function clearAllianceBankLog(){
	ad2460.allianceData.bankLog=new Array;
}

function addNewAllianceBankLogEntry(entry){
	ad2460.allianceData.bankLog.push(entry);
}

function addAllianceBankLogEntry(user_id,nickname,transaction_type,hassium,neodymium,strontium,indium,timestamp, target_user_id, target_nickname){
//	if(ad2460.mobilebrowser==false || (ad2460.mobilebrowser==true && ad2460.allianceData.bankLog.length<25) ){
		ad2460.allianceData.bankLog.push(new bankLogEntry(user_id, nickname, transaction_type, hassium, neodymium, strontium, indium, timestamp, target_user_id, target_nickname));
//	}

}

function clearAllianceProjectEntries(){
	ad2460.allianceData.projects=new Array;
}

function addAllianceProjectEntry(name, id, group_id, level, h_cost, i_cost, s_cost, n_cost, time_cost, credit_cost, required_facility_id, required_research_id, required_development_id, required_tech_tree_points, required_points_tree, special_requirement, member_requirement, bonus_description, description, bonus_flag_id, alliance_id, project_id, start_time, end_time, upgrading){
	ad2460.allianceData.projects.push(new allianceProject(name, id, group_id, level, h_cost, i_cost, s_cost, n_cost, time_cost, credit_cost, required_facility_id, required_research_id, required_development_id, required_tech_tree_points, required_points_tree, special_requirement, member_requirement, bonus_description, description, bonus_flag_id, alliance_id, project_id, start_time, end_time, upgrading ));
}

function updateAllianceProjectBoxes(){
	//console.log("updateAllianceProjectBoxes called...");
	// render-time...the elements already exists in the dom, just fill inn the blanks :)
	// For each group, find the item we have completed with the highest level, and render it's details.
	// If alliance_id > 0 and end_time < server-time, it has been completed I think..
	var renderData=new Array;
	renderData[0]={}; 	renderData[1]={}; 	renderData[2]={}; 	renderData[3]={}; 	renderData[4]={};	renderData[5]={}; // Prepared slots for each group
	var i=0; // iterator
	//console.log(ad2460.allianceData.projects);
	for (i=0;i<ad2460.allianceData.projects.length ;i++ ){
		var thisProject=ad2460.allianceData.projects[i];
		if (thisProject.alliance_id>0 && thisProject.end_time<ad2460.serverTime && thisProject.upgrading==0){
			renderData[thisProject.group_id-1].name=thisProject.name;
			renderData[thisProject.group_id-1].id=thisProject.id;
			renderData[thisProject.group_id-1].level=thisProject.level;
		}
	}
	//console.log(renderData);
	// renderData complete
	var i=0;
	for (i=0;i<renderData.length ;i++ ){
		var group_id=i+1;
		var image=document.getElementById('all_dev_img_'+group_id);
		var level=document.getElementById('all_dev_level_'+group_id);
		var name=document.getElementById('all_dev_label_'+group_id);

		// Skip the image, it's pobably statis for the group and already rendered correctly
		level.innerHTML=renderData[i].level;
		name.innerHTML=renderData[i].name;
	}
	// And that should be it!
}

function reSelectAllianceDevItem(){
	if (ad2460.allianceData.selected_project_group==0){
		ad2460.allianceData.selected_project_group=1;
	}
	selectAllianceDevItem(ad2460.allianceData.selected_project_group);
}

function returnAllianceProjectImage(group_id){
	var imgsrc="images/icons/alliancepro/601.jpg";
	if (group_id==1){
		imgsrc="images/icons/alliancepro/601.jpg";
	}
	else if (group_id==2){
		imgsrc="images/icons/alliancepro/605.jpg";
	}
	else if (group_id==3){
		imgsrc="images/icons/alliancepro/609.jpg";
	}
	else if (group_id==4){
		imgsrc="images/icons/alliancepro/613.jpg";
	}
	else if (group_id==5){
		imgsrc="images/icons/alliancepro/617.jpg";
	}
	else if (group_id==6){
		imgsrc="images/icons/alliancepro/621.jpg";
	}
	return imgsrc;

}

function selectAllianceDevItem(group_id){

	// A group has been selected, and the sidepanel needs some TLC!
	// find all details for the group clicked (group-id)
	// If there are items with a higher level than what we HAVE
	// We print the data for the next item.
	// If not, we go into special-case of printing "no more upgrades available" etc

	var i=0;
	var somethingIsUpgrading=0;
	var current={project_id:0, name:'', alliance_id:0, level:-1};
	var next={project_id:0, name:'', alliance_id:0, level:-1, upgrading:0};
	for (i=0;i<ad2460.allianceData.projects.length ;i++ ){
		var thisProject=ad2460.allianceData.projects[i];
		if (thisProject.group_id==group_id){
			// We're in the right group
			ad2460.allianceData.selected_project_group=group_id; // store the last valid group-id for easy re-selection later

			if (thisProject.alliance_id>0 && thisProject.end_time<ad2460.serverTime && thisProject.level>current.level && thisProject.upgrading==0){
				current=thisProject;
			}
		}
		if (thisProject.upgrading==1){
			somethingIsUpgrading=1;
		}
	}

	// Now the current is set correctly. Lets see if we can find the next....
	for (i=0;i<ad2460.allianceData.projects.length ;i++ ){
		var thisProject=ad2460.allianceData.projects[i];
		if (thisProject.group_id==group_id){
			// We're in the right group
			if ((thisProject.alliance_id==0 && thisProject.end_time==0 && thisProject.level==(current.level+1) ) || (thisProject.upgrading==1) ){
				next=thisProject;
			}
		}
	}

	var already_at_top_level=0;
	if (next.level==-1){
		already_at_top_level=1;
	}

	var imgsrc=returnAllianceProjectImage(group_id);
	$("#ally_dev_img").attr("src",imgsrc);

	// That should do it, current is correct and so is next if there is one.
	if (already_at_top_level==0 && next.upgrading==0){
		$("#alliance_dev_selected_project_name").html(next.name+' Lvl '+next.level);
		var time_cost=next.time_cost-(next.time_cost*ad2460.allianceData.alliance_project_time_bonus_percent/100);

		$("#alliance_dev_selected_project_complete_time").html(secondsToFullTimeNosecs(time_cost));
		$("#alliance_dev_selected_project_cost_h").html(prettyPrint(next.h_cost));
		$("#alliance_dev_selected_project_cost_n").html(prettyPrint(next.n_cost));
		$("#alliance_dev_selected_project_cost_s").html(prettyPrint(next.s_cost));
		$("#alliance_dev_selected_project_cost_i").html(prettyPrint(next.i_cost));
		$("#alliance_dev_selected_project_description").html(next.description+"<br/><br/>Member-requirement: "+next.member_requirement);

		var hasEnoughRes=1;

		if (ad2460.allianceData.bank.hassium<next.h_cost){		$("#alliance_dev_selected_project_cost_h").addClass("notenough"); hasEnoughRes=0;	}
		else {$("#alliance_dev_selected_project_cost_h").removeClass("notenough");}
		if (ad2460.allianceData.bank.neodymium<next.n_cost){	$("#alliance_dev_selected_project_cost_n").addClass("notenough"); hasEnoughRes=0;	}
		else {$("#alliance_dev_selected_project_cost_n").removeClass("notenough");}
		if (ad2460.allianceData.bank.strontium<next.s_cost){	$("#alliance_dev_selected_project_cost_s").addClass("notenough"); hasEnoughRes=0;	}
		else {$("#alliance_dev_selected_project_cost_s").removeClass("notenough");}
		if (ad2460.allianceData.bank.indium<next.i_cost){		$("#alliance_dev_selected_project_cost_i").addClass("notenough"); hasEnoughRes=0;	}
		else {$("#alliance_dev_selected_project_cost_i").removeClass("notenough");}

		if ( hasEnoughRes==1 && next.member_requirement<=ad2460.allianceData.memberlist.length){
			activateProjectInitiateButton();
			$("#alliance_dev_selected_project_prodcost .buttontext").html('Initiate');
			document.getElementById('alliance_dev_selected_project_prodcost_button').setAttribute("onclick",'initiateAllianceUpgrade('+next.id+')');
		}
		else {
			deactivateProjectInitiateButton();
			$("#alliance_dev_selected_project_prodcost .buttontext").html('N/A');
			document.getElementById('alliance_dev_selected_project_prodcost_button').setAttribute("onclick",'');
		}
		if (somethingIsUpgrading==1){
			deactivateProjectInitiateButton();
			$("#alliance_dev_selected_project_prodcost .buttontext").html('Busy');
			document.getElementById('alliance_dev_selected_project_prodcost_button').setAttribute("onclick",'');
		}
	}
	else { // We ARE at the top level already, nothing more to do here!
		$("#alliance_dev_selected_project_name").html(current.name+' Lvl '+current.level);
		$("#alliance_dev_selected_project_complete_time").html('N/A');
		$("#alliance_dev_selected_project_cost_h").html('N/A');
		$("#alliance_dev_selected_project_cost_n").html('N/A');
		$("#alliance_dev_selected_project_cost_s").html('N/A');
		$("#alliance_dev_selected_project_cost_i").html('N/A');
		if (next.upgrading==1){
			$("#alliance_dev_selected_project_name").html(next.name+' Lvl '+next.level);
			$("#alliance_dev_selected_project_description").html(next.description);
			$("#alliance_dev_selected_project_prodcost .buttontext").html('Upgrading...');
			deactivateProjectInitiateButton();
			$("#alliance_dev_selected_project_complete_time").html(secondsToFullTime(next.end_time-ad2460.serverTime));
		}
		else {
			$("#alliance_dev_selected_project_description").html('No further upgrades are available');
			$("#alliance_dev_selected_project_prodcost .buttontext").html('N/A');
			deactivateProjectInitiateButton();
		}
		document.getElementById('alliance_dev_selected_project_prodcost_button').setAttribute("onclick",'');
	}
}

function activateProjectInitiateButton(){
	$("#alliance_dev_selected_project_prodcost div.costbutton").show();
	$("#alliance_dev_selected_project_prodcost div.disablebutton").hide();
}

function deactivateProjectInitiateButton(){
	$("#alliance_dev_selected_project_prodcost div.costbutton").hide();
	$("#alliance_dev_selected_project_prodcost div.disablebutton").show();
}

function initiateAllianceUpgrade(project_id){
	// not yet implemented
	$.post('actionhandler.pl', {action:'initiate_alliance_upgrade',project_id:project_id}, function(data){ parseInfo(data);});
}

function checkAllianceProjectfrontTimer(){
	var i=0;
	var foundOne=false;
	for (i=0;i<ad2460.allianceData.projects.length ;i++ ){
		var thisProject=ad2460.allianceData.projects[i];
		if (thisProject.upgrading==1){
			foundOne=true;
			// Here we need to register a timer, somehow, and then tie it to this DOM-node.
			var timerId='currentAllianceprojectProgressTimer';
			registerNewTimer(timerId, ['process_4_eta'], ['process_4_progress'], thisProject.start_time, thisProject.end_time, function(){reloadAllianceData();});
			$('#process_4_name').html(thisProject.name +' Lvl '+thisProject.level);
			$('#process_4_colour').show();
		}
	}
	if (foundOne==false){
		$('#process_4_colour').hide();
	}
}

function renderAllianceDevelopmentInfopanel(){
	// list current upgrade, if any

	var somethingIsUpgrading=0;

	var i=0;
	for (i=0;i<ad2460.allianceData.projects.length ;i++ ){
		var thisProject=ad2460.allianceData.projects[i];
		if (thisProject.upgrading==1){
			somethingIsUpgrading=1;
			// yay, we get to render something!
			var finish_time=thisProject.end_time;
			var start_time=thisProject.start_time;
			var spent_time=ad2460.serverTime-start_time;
			var percentage_complete=Math.floor(spent_time*100/thisProject.time_cost);
			var remaining_time=thisProject.end_time-ad2460.serverTime;


			document.getElementById('current_alliance_development_name').innerHTML=thisProject.name+' Lvl '+thisProject.level;
			document.getElementById('current_alliance_development_progress_bar').style.width=percentage_complete+'%';
			document.getElementById('current_alliance_development_time_string').innerHTML=secondsToFullTimeNosecs(remaining_time);
			document.getElementById('current_alliance_development_time_string_2').innerHTML=secondsToFullTimeNosecs(remaining_time);
			document.getElementById('current_alliance_development_info').innerHTML=thisProject.bonus_description;
			// skipping the image until content is ready.....
			// document.getElementById('current_alliance_development_image')........
			document.getElementById('current_alliance_development_image').setAttribute('src','images/icons/alliancepro/'+thisProject.id+'.jpg');
			$("#current_ally_dev_upgrade").show();
		}
	}

	if (somethingIsUpgrading==0){
		// Nothing is going on here...
			document.getElementById('current_alliance_development_name').innerHTML='No upgrade in progress';
			document.getElementById('current_alliance_development_progress_bar').style.width='0%';
			document.getElementById('current_alliance_development_time_string').innerHTML='N/A';
			document.getElementById('current_alliance_development_time_string_2').innerHTML='N/A';
			document.getElementById('current_alliance_development_info').innerHTML='';

			// skipping the image until content is ready.....
			document.getElementById('current_alliance_development_image').setAttribute('src','spacer.gif');
			// document.getElementById('current_alliance_development_image')........
			$("#current_ally_dev_upgrade").show();
	}





	// then list the completed ones, above level 0, if any
	var container=document.getElementById('alliancedev_scroller_inner');
	removeChildNodes('alliancedev_scroller_inner');

	var itemscontainer=createSingleElement('div', '', '', '', '');

	for (i=0;i<ad2460.allianceData.projects.length ;i++ ){
		var thisProject=ad2460.allianceData.projects[i];
		if (thisProject.upgrading==0 && thisProject.level>0 && thisProject.alliance_id>0){
			var item=createSingleElement('div', 'row_container ally_dev', '', '', '');

			var content_container=createSingleElement('div', 'queue_entry_content_container', '', '', '');

			var row_id='all_bonus_'+i;

			var inner_container=createSingleElement('div', 'row_entry dev_bonus_entry', row_id, '', '');

			var name=createSingleElement('div', 'queue_entry_name header', '', thisProject.name, '');
			var info=createSingleElement('div', 'queue_entry_info', '', thisProject.bonus_description, '');
			var imagecontainer=createSingleElement('div', 'queue_entry_img', '', '', '');
			var image=createSingleElement('img', '', '', 'images/fixed/outpostportrait200x200.jpg', '');

			imagecontainer.appendChild(image);
			item.appendChild(inner_container);
			inner_container.appendChild(content_container);

			content_container.appendChild(name);
			content_container.appendChild(info);
			content_container.appendChild(imagecontainer);

			//itemscontainer.appendChild(item);
			container.appendChild(item);

			inner_container.onclick=function(){
			if (ad2460.allianceProjectsExpanderOpen=='') {
				ad2460.allianceProjectsExpanderOpen=this.id;
				expandSelectedRow(this.id);
			}
			else if(ad2460.allianceProjectsExpanderOpen==this.id){
				minimizeSelectedRow(this.id);
				ad2460.allianceProjectsExpanderOpen='';
			}
			else {
				minimizeSelectedRow(ad2460.allianceProjectsExpanderOpen);
				ad2460.allianceProjectsExpanderOpen=this.id;
				setTimeout("expandSelectedRow(ad2460.allianceProjectsExpanderOpen)",250);
			}
		};





		}

	}
	//container.appendChild(itemscontainer);
}

function tradeFilterAllClick(){
	ad2460.allianceData.trade.filters.from.hs=1;
	ad2460.allianceData.trade.filters.from.nd=1;
	ad2460.allianceData.trade.filters.from.sr=1;
	ad2460.allianceData.trade.filters.from.in=1;

	ad2460.allianceData.trade.filters.to.hs=1;
	ad2460.allianceData.trade.filters.to.nd=1;
	ad2460.allianceData.trade.filters.to.sr=1;
	ad2460.allianceData.trade.filters.to.in=1;

	renderTradeFilterButtons();
	renderAllianceTrades();
}

function registerTradeFilterFromClick(resId){
	if (resId==1){	ad2460.allianceData.trade.filters.from.hs=1-ad2460.allianceData.trade.filters.from.hs;	}
	if (resId==2){	ad2460.allianceData.trade.filters.from.nd=1-ad2460.allianceData.trade.filters.from.nd;	}
	if (resId==3){	ad2460.allianceData.trade.filters.from.sr=1-ad2460.allianceData.trade.filters.from.sr;	}
	if (resId==4){	ad2460.allianceData.trade.filters.from.in=1-ad2460.allianceData.trade.filters.from.in;	}

	renderTradeFilterButtons();
	renderAllianceTrades();
}

function registerTradeFilterToClick(resId){
	if (resId==1){	ad2460.allianceData.trade.filters.to.hs=1-ad2460.allianceData.trade.filters.to.hs;	}
	if (resId==2){	ad2460.allianceData.trade.filters.to.nd=1-ad2460.allianceData.trade.filters.to.nd;	}
	if (resId==3){	ad2460.allianceData.trade.filters.to.sr=1-ad2460.allianceData.trade.filters.to.sr;	}
	if (resId==4){	ad2460.allianceData.trade.filters.to.in=1-ad2460.allianceData.trade.filters.to.in;	}

	renderTradeFilterButtons();
	renderAllianceTrades();
}

function renderTradeFilterButtons(){
	var from_hs_image=document.getElementById('filter_hs_from');
	var from_nd_image=document.getElementById('filter_nd_from');
	var from_sr_image=document.getElementById('filter_sr_from');
	var from_in_image=document.getElementById('filter_in_from');

	var to_hs_image=document.getElementById('filter_hs_to');
	var to_nd_image=document.getElementById('filter_nd_to');
	var to_sr_image=document.getElementById('filter_sr_to');
	var to_in_image=document.getElementById('filter_in_to');

	if (ad2460.allianceData.trade.filters.from.hs==1){	from_hs_image.setAttribute('src','images/icons/elements/hs42hl.png');	}
	else {			from_hs_image.setAttribute('src','images/icons/elements/hs42.png');		}
	if (ad2460.allianceData.trade.filters.from.nd==1){	from_nd_image.setAttribute('src','images/icons/elements/nd42hl.png');	}
	else {			from_nd_image.setAttribute('src','images/icons/elements/nd42.png');		}
	if (ad2460.allianceData.trade.filters.from.sr==1){	from_sr_image.setAttribute('src','images/icons/elements/sr42hl.png');	}
	else {			from_sr_image.setAttribute('src','images/icons/elements/sr42.png');		}
	if (ad2460.allianceData.trade.filters.from.in==1){	from_in_image.setAttribute('src','images/icons/elements/in42hl.png');	}
	else {			from_in_image.setAttribute('src','images/icons/elements/in42.png');		}

	if (ad2460.allianceData.trade.filters.to.hs==1){		to_hs_image.setAttribute('src','images/icons/elements/hs42hl.png');		}
	else {			to_hs_image.setAttribute('src','images/icons/elements/hs42.png');		}
	if (ad2460.allianceData.trade.filters.to.nd==1){		to_nd_image.setAttribute('src','images/icons/elements/nd42hl.png');		}
	else {			to_nd_image.setAttribute('src','images/icons/elements/nd42.png');		}
	if (ad2460.allianceData.trade.filters.to.sr==1){		to_sr_image.setAttribute('src','images/icons/elements/sr42hl.png');		}
	else {			to_sr_image.setAttribute('src','images/icons/elements/sr42.png');		}
	if (ad2460.allianceData.trade.filters.to.in==1){		to_in_image.setAttribute('src','images/icons/elements/in42hl.png');		}
	else {			to_in_image.setAttribute('src','images/icons/elements/in42.png');		}
}

function registerClickExchangeRateFrom(resId){
	if (resId>0 && resId<5){
		ad2460.allianceData.trade.fromExchangeRes=resId;
	}
	renderExchangeRateIcons();
}
function registerClickExchangeRateTo(resId){
	if (resId>0 && resId<5){
		ad2460.allianceData.trade.toExchangeRes=resId;
	}
	renderExchangeRateIcons();
}
function renderExchangeRateIcons(){
	var from=ad2460.allianceData.trade.fromExchangeRes;
	var to=ad2460.allianceData.trade.toExchangeRes;

	var from_hs_image=document.getElementById('exchange_rate_hs_from');
	var from_nd_image=document.getElementById('exchange_rate_nd_from');
	var from_sr_image=document.getElementById('exchange_rate_sr_from');
	var from_in_image=document.getElementById('exchange_rate_in_from');

	var to_hs_image=document.getElementById('exchange_rate_hs_to');
	var to_nd_image=document.getElementById('exchange_rate_nd_to');
	var to_sr_image=document.getElementById('exchange_rate_sr_to');
	var to_in_image=document.getElementById('exchange_rate_in_to');

	if (from==1){	from_hs_image.setAttribute('src','images/icons/elements/hs42hl.png');	}
	else {			from_hs_image.setAttribute('src','images/icons/elements/hs42.png');		}
	if (from==2){	from_nd_image.setAttribute('src','images/icons/elements/nd42hl.png');	}
	else {			from_nd_image.setAttribute('src','images/icons/elements/nd42.png');		}
	if (from==3){	from_sr_image.setAttribute('src','images/icons/elements/sr42hl.png');	}
	else {			from_sr_image.setAttribute('src','images/icons/elements/sr42.png');		}
	if (from==4){	from_in_image.setAttribute('src','images/icons/elements/in42hl.png');	}
	else {			from_in_image.setAttribute('src','images/icons/elements/in42.png');		}

	if (to==1){		to_hs_image.setAttribute('src','images/icons/elements/hs42hl.png');		}
	else {			to_hs_image.setAttribute('src','images/icons/elements/hs42.png');		}
	if (to==2){		to_nd_image.setAttribute('src','images/icons/elements/nd42hl.png');		}
	else {			to_nd_image.setAttribute('src','images/icons/elements/nd42.png');		}
	if (to==3){		to_sr_image.setAttribute('src','images/icons/elements/sr42hl.png');		}
	else {			to_sr_image.setAttribute('src','images/icons/elements/sr42.png');		}
	if (to==4){		to_in_image.setAttribute('src','images/icons/elements/in42hl.png');		}
	else {			to_in_image.setAttribute('src','images/icons/elements/in42.png');		}

	renderCurrentExchangeRate();
}

function renderCurrentExchangeRate(){
	var rate=calculateExchangeRate(ad2460.allianceData.trade.fromExchangeRes,ad2460.allianceData.trade.toExchangeRes);
	var rateString='1 = '+rate;
	document.getElementById('current_exchange_rate').innerHTML=rateString;
}

function registerClickNewTradeFrom(resId){
	if (resId>0 && resId<5){
		ad2460.allianceData.newTrade.fromResId=resId;
	}
	renderNewTradeIcons();
}
function registerClickNewTradeTo(resId){
	if (resId>0 && resId<5){
		ad2460.allianceData.newTrade.toResId=resId;
	}
	renderNewTradeIcons();
}

function renderNewTradeIcons(){
	var from=ad2460.allianceData.newTrade.fromResId;
	var to=ad2460.allianceData.newTrade.toResId;

	var from_hs_image=document.getElementById('new_trade_hs_from');
	var from_nd_image=document.getElementById('new_trade_nd_from');
	var from_sr_image=document.getElementById('new_trade_sr_from');
	var from_in_image=document.getElementById('new_trade_in_from');

	var to_hs_image=document.getElementById('new_trade_hs_to');
	var to_nd_image=document.getElementById('new_trade_nd_to');
	var to_sr_image=document.getElementById('new_trade_sr_to');
	var to_in_image=document.getElementById('new_trade_in_to');

	if (from==1){	from_hs_image.setAttribute('src','images/icons/elements/hs42hl.png');	$("#new_trade_hs_from").css({opacity:1.0});		}
	else {			from_hs_image.setAttribute('src','images/icons/elements/hs42.png');		$("#new_trade_hs_from").css({opacity:0.5});		}
	if (from==2){	from_nd_image.setAttribute('src','images/icons/elements/nd42hl.png');	$("#new_trade_nd_from").css({opacity:1.0});		}
	else {			from_nd_image.setAttribute('src','images/icons/elements/nd42.png');		$("#new_trade_nd_from").css({opacity:0.5});		}
	if (from==3){	from_sr_image.setAttribute('src','images/icons/elements/sr42hl.png');	$("#new_trade_sr_from").css({opacity:1.0});		}
	else {			from_sr_image.setAttribute('src','images/icons/elements/sr42.png');		$("#new_trade_sr_from").css({opacity:0.5});		}
	if (from==4){	from_in_image.setAttribute('src','images/icons/elements/in42hl.png');	$("#new_trade_in_from").css({opacity:1.0});		}
	else {			from_in_image.setAttribute('src','images/icons/elements/in42.png');		$("#new_trade_in_from").css({opacity:0.5});		}

	if (to==1){		to_hs_image.setAttribute('src','images/icons/elements/hs42hl.png');		$("#new_trade_hs_to").css({opacity:1.0});		}
	else {			to_hs_image.setAttribute('src','images/icons/elements/hs42.png');		$("#new_trade_hs_to").css({opacity:0.5});		}
	if (to==2){		to_nd_image.setAttribute('src','images/icons/elements/nd42hl.png');		$("#new_trade_nd_to").css({opacity:1.0});		}
	else {			to_nd_image.setAttribute('src','images/icons/elements/nd42.png');		$("#new_trade_nd_to").css({opacity:0.5});		}
	if (to==3){		to_sr_image.setAttribute('src','images/icons/elements/sr42hl.png');		$("#new_trade_sr_to").css({opacity:1.0});		}
	else {			to_sr_image.setAttribute('src','images/icons/elements/sr42.png');		$("#new_trade_sr_to").css({opacity:0.5});		}
	if (to==4){		to_in_image.setAttribute('src','images/icons/elements/in42hl.png');		$("#new_trade_in_to").css({opacity:1.0});		}
	else {			to_in_image.setAttribute('src','images/icons/elements/in42.png');		$("#new_trade_in_to").css({opacity:0.5});		}

	renderSelectedTradeResult();

}

function refreshAllianceTrades(){
	$.post('actionhandler.pl', {action:'reload_alliance_trades'}, function(data){ parseInfo(data);});
}

function renderSelectedTradeResult(){
	var amount=returnInteger(document.getElementById('new_trade_amount_textfield').value);
	var from=ad2460.allianceData.newTrade.fromResId;
	var to=ad2460.allianceData.newTrade.toResId;

	if (from==1){	amount=amount*ad2460.allianceData.trade.hs_exchange_value; }
	if (from==2){	amount=amount*ad2460.allianceData.trade.nd_exchange_value; }
	if (from==3){	amount=amount*ad2460.allianceData.trade.sr_exchange_value; }
	if (from==4){	amount=amount*ad2460.allianceData.trade.in_exchange_value; }

	if (to==1){		amount=amount/ad2460.allianceData.trade.hs_exchange_value; }
	if (to==2){		amount=amount/ad2460.allianceData.trade.nd_exchange_value; }
	if (to==3){		amount=amount/ad2460.allianceData.trade.sr_exchange_value; }
	if (to==4){		amount=amount/ad2460.allianceData.trade.in_exchange_value; }

	var overhead_percent=5;

	var overhead_amount=Math.floor(amount*overhead_percent/100);

	var overhead_bonus_from_alliance_projects=0;
	var p=0;
	for (p=0;p<ad2460.allianceData.projects.length ;p++ ){
		if (ad2460.allianceData.projects[p].alliance_id>0 && ad2460.allianceData.projects[p].upgrading==0 && ad2460.allianceData.projects[p].id==602 ){
			overhead_bonus_from_alliance_projects+=5;
		}
		else if (ad2460.allianceData.projects[p].alliance_id>0 && ad2460.allianceData.projects[p].upgrading==0 && ad2460.allianceData.projects[p].id==603 ){
			overhead_bonus_from_alliance_projects+=5;
		}
		else if (ad2460.allianceData.projects[p].alliance_id>0 && ad2460.allianceData.projects[p].upgrading==0 && ad2460.allianceData.projects[p].id==604 ){
			overhead_bonus_from_alliance_projects+=5;
		}
	}
	if (overhead_bonus_from_alliance_projects>0){
		var temp=0;
		temp=overhead_amount-Math.floor(overhead_amount/100*overhead_bonus_from_alliance_projects);
		overhead_amount=overhead_amount-Math.floor(overhead_amount/100*overhead_bonus_from_alliance_projects);
	}


	amount=Math.floor(amount-overhead_amount);

	document.getElementById('trade_result_text_field').innerHTML=prettyPrint(amount);
}

function calculateTradeResult(from, to, amount){
	if (from==1){	amount=amount*ad2460.allianceData.trade.hs_exchange_value; }
	if (from==2){	amount=amount*ad2460.allianceData.trade.nd_exchange_value; }
	if (from==3){	amount=amount*ad2460.allianceData.trade.sr_exchange_value; }
	if (from==4){	amount=amount*ad2460.allianceData.trade.in_exchange_value; }

	if (to==1){		amount=amount/ad2460.allianceData.trade.hs_exchange_value; }
	if (to==2){		amount=amount/ad2460.allianceData.trade.nd_exchange_value; }
	if (to==3){		amount=amount/ad2460.allianceData.trade.sr_exchange_value; }
	if (to==4){		amount=amount/ad2460.allianceData.trade.in_exchange_value; }
	amount=Math.floor(amount*0.95); // 5 % trade tax
	return amount;
}

function calculateExchangeRate(from,to){
	var rate=1;
	if (from==1){	rate=1*ad2460.allianceData.trade.hs_exchange_value; }
	if (from==2){	rate=1*ad2460.allianceData.trade.nd_exchange_value; }
	if (from==3){	rate=1*ad2460.allianceData.trade.sr_exchange_value; }
	if (from==4){	rate=1*ad2460.allianceData.trade.in_exchange_value; }

	if (to==1){		rate=rate/ad2460.allianceData.trade.hs_exchange_value; }
	if (to==2){		rate=rate/ad2460.allianceData.trade.nd_exchange_value; }
	if (to==3){		rate=rate/ad2460.allianceData.trade.sr_exchange_value; }
	if (to==4){		rate=rate/ad2460.allianceData.trade.in_exchange_value; }
	var rate=Math.round(rate*1000)/1000;
	return rate;
}

function registerNewTradeClick(){
	if (ad2460.allianceData.newTrade.fromResId==ad2460.allianceData.newTrade.toResId){
		systemFeedback('Error','TO and FROM must be different resource-types.', 1, 3);
		return false;
	}
	var amount=returnInteger(document.getElementById('new_trade_amount_textfield').value);

	if (amount<100){
		systemFeedback('Error','You can not exchange less than 100 resources.', 1, 3);
		return false;
	}

	// Now count the number of trades suggested by this player....
	// If more than X, no can do...Err, we need to load them and define them first :)

	var from=ad2460.allianceData.newTrade.fromResId;
	var to=ad2460.allianceData.newTrade.toResId;

	$.post('actionhandler.pl', {action:'register_new_trade' ,from:from, to:to, amount:amount}, function(data){ parseInfo(data);});
}



function addAllianceTrade(trade_id, user_id, from_res_id, to_res_id, amount, timestamp, nickname){
	ad2460.allianceData.trades.push(new Trade(trade_id, user_id, from_res_id, to_res_id, amount, timestamp, nickname));

}

function clearAllianceTrades(){
	ad2460.allianceData.trades=[];
	removeChildNodes('market_scroller');
}

function renderAllianceTrades(){
	var i=0;
	var container=document.getElementById('market_scroller');
	removeChildNodes('market_scroller');

	var restypes=['','Hassium','Neodymium','Strontium','Indium'];
	for (i=0;i<ad2460.allianceData.trades.length ;i++ ){

		// Now we must add filter-support
		// Check data against
		// ad2460.allianceData.trade.filters.from.hs
		// ad2460.allianceData.trade.filters.to.hs

		var proceed1=false;
		var proceed2=false;

		if (ad2460.allianceData.trades[i].from_res_id==1 && ad2460.allianceData.trade.filters.from.hs==1 ){
			proceed1=true;
		}
		if (ad2460.allianceData.trades[i].from_res_id==2 && ad2460.allianceData.trade.filters.from.nd==1 ){
			proceed1=true;
		}
		if (ad2460.allianceData.trades[i].from_res_id==3 && ad2460.allianceData.trade.filters.from.sr==1 ){
			proceed1=true;
		}
		if (ad2460.allianceData.trades[i].from_res_id==4 && ad2460.allianceData.trade.filters.from.in==1 ){
			proceed1=true;
		}

		if (ad2460.allianceData.trades[i].to_res_id==1 && ad2460.allianceData.trade.filters.to.hs==1 ){
			proceed2=true;
		}
		if (ad2460.allianceData.trades[i].to_res_id==2 && ad2460.allianceData.trade.filters.to.nd==1 ){
			proceed2=true;
		}
		if (ad2460.allianceData.trades[i].to_res_id==3 && ad2460.allianceData.trade.filters.to.sr==1 ){
			proceed2=true;
		}
		if (ad2460.allianceData.trades[i].to_res_id==4 && ad2460.allianceData.trade.filters.to.in==1 ){
			proceed2=true;
		}

		if ((ad2460.allianceData.trades[i].timestamp+(ad2460.allianceData.trade.max_trade_length)-ad2460.serverTime)<1){
			// Hide it, as it has expired but not yet been deleted by the system, not that it can be picked up anyway.
			proceed1=false;
			proceed2=false;
		}

		if (proceed1==true && proceed2==true){
			var itemcontainer=createSingleElement('div','tableselection evenline', '', '', 'selectTrade('+ad2460.allianceData.trades[i].trade_id+')');
			var from=createSingleElement('div','tradeelementheader', '', restypes[ad2460.allianceData.trades[i].from_res_id], '');
			var to=createSingleElement('div','tradeelementheader', '', restypes[ad2460.allianceData.trades[i].to_res_id], '');
			var user=createSingleElement('div','tradeelementheader', '', ad2460.allianceData.trades[i].nickname, '');
			var amount=createSingleElement('div','tradevolume', '', prettyPrint(ad2460.allianceData.trades[i].amount), '');

			itemcontainer.appendChild(from);
			itemcontainer.appendChild(to);
			itemcontainer.appendChild(user);
			itemcontainer.appendChild(amount);

			container.appendChild(itemcontainer);
		}
	}
	myScrollToTop('market_scroller');
	checkScrollButtonStatus('market_scroller');


}

function showOwnTrades(){
	var container=document.getElementById('marketplace_infopanel_content');
	removeChildNodes('marketplace_infopanel_content');

	var restypes_short=['','Hs','Nd','Sr','In'];

	header=createSingleElement('div','infopanel_header', '', 'My trades', '');
	container.appendChild(header);

	var i=0;

	for (i=0;i<ad2460.allianceData.trades.length ;i++ ){
		if (ad2460.allianceData.trades[i].user_id==ad2460.user_id){
			// Wow, 12 divs to enter! That was kind of a lot!
			var from_amount=ad2460.allianceData.trades[i].amount;
			var to_amount=calculateTradeResult(ad2460.allianceData.trades[i].from_res_id, ad2460.allianceData.trades[i].to_res_id, ad2460.allianceData.trades[i].amount);
			var row_container=createSingleElement('div','row_container', 'own_trade_row_'+ad2460.allianceData.trades[i].trade_id, '', '');
			var your_trade=createSingleElement('div','row_entry', 'your_trade_'+i, '', '');
			var queue_entry_content_container=createSingleElement('div','queue_entry_content_container trade', '', '', '');
			var queue_entry_name=createSingleElement('div','queue_entry_name trade', '', ad2460.allianceData.trades[i].amount+' '+restypes_short[ad2460.allianceData.trades[i].from_res_id]+' to '+restypes_short[ad2460.allianceData.trades[i].to_res_id], '');
			var queue_entry_info=createSingleElement('div','queue_entry_info your_trade_info', '', '', '');
			var selected_trade_header_from=createSingleElement('div','selected_trade_header', '', 'Trade From', '');
			var elm_from=createSingleElement('div','trade_element '+restypes_short[ad2460.allianceData.trades[i].from_res_id].toLowerCase(), '', prettyPrint(ad2460.allianceData.trades[i].amount), '');
			var selected_trade_header_to=createSingleElement('div','selected_trade_header', '', 'Trade To', '');
			var elm_to=createSingleElement('div','trade_element '+restypes_short[ad2460.allianceData.trades[i].to_res_id].toLowerCase(), '', prettyPrint(to_amount), '');
			var selected_trade_infoline=createSingleElement('div','selected_trade_infoline', '', 'Expires in '+secondsToFullTimeNosecs(ad2460.allianceData.trades[i].timestamp+(ad2460.allianceData.trade.max_trade_length)-ad2460.serverTime), '');
			var buttoncontainer=createSingleElement('div','lightbutton160', '', '', 'cancelTrade('+ad2460.allianceData.trades[i].trade_id+')');
			var buttontext=createSingleElement('div','buttontext24', '', 'Cancel', '');

			row_container.appendChild(your_trade);
			your_trade.appendChild(queue_entry_content_container);
			queue_entry_content_container.appendChild(queue_entry_name);
			queue_entry_content_container.appendChild(queue_entry_info);
			queue_entry_info.appendChild(selected_trade_header_from);
			queue_entry_info.appendChild(elm_from);
			queue_entry_info.appendChild(selected_trade_header_to);
			queue_entry_info.appendChild(elm_to);
			queue_entry_info.appendChild(selected_trade_infoline);
			queue_entry_info.appendChild(buttoncontainer);
			buttoncontainer.appendChild(buttontext);

			your_trade.onclick=function(){
				if (ad2460.allienceOwnTradeExpanderOpen=='') {
					ad2460.allienceOwnTradeExpanderOpen=this.id;
					expandSelectedRow(this.id);
				}
				else if(ad2460.allienceOwnTradeExpanderOpen==this.id){
					minimizeSelectedRow(this.id);
					ad2460.allienceOwnTradeExpanderOpen='';
				}
				else {
					minimizeSelectedRow(ad2460.allienceOwnTradeExpanderOpen);
					ad2460.allienceOwnTradeExpanderOpen=this.id;
					setTimeout("expandSelectedRow(ad2460.allienceOwnTradeExpanderOpen)",250);
				}
			}

			container.appendChild(row_container);
		}
	}
}

function cancelTrade(tradeId){
	$.post('actionhandler.pl', {action:'cancel_trade' ,trade_id:tradeId}, function(data){ parseInfo(data);});
}

function deselectTrade(){
	var container=document.getElementById('marketplace_infopanel_content');
	removeChildNodes('marketplace_infopanel_content');

	var header=createSingleElement('div','infopanel_header', '', 'Alliance Marketplace', '');
	var body=createSingleElement('div','', '', 'No trade selected.', '');
	container.appendChild(header);
	container.appendChild(body);
}

function selectTrade(trade_id){
	// We will now fetch the relevant data and present it to the user in the infopanel.
	// The infopanel must be 100% cleared, including header, and then rendered from scratch.
	var container=document.getElementById('marketplace_infopanel_content');
	removeChildNodes('marketplace_infopanel_content');

	var restypes_short=['','Hs','Nd','Sr','In'];

	var header=createSingleElement('div','infopanel_header', '', 'Selected trade', '');
	container.appendChild(header);

	var i=0;
	for (i=0;i<ad2460.allianceData.trades.length ;i++ ){
		if (ad2460.allianceData.trades[i].trade_id==trade_id){
			var thisTrade=ad2460.allianceData.trades[i];
			var from_amount=thisTrade.amount;
			var to_amount=calculateTradeResult(thisTrade.from_res_id, thisTrade.to_res_id, thisTrade.amount);

			var trade_container=createSingleElement('div','selected_trade_container', '', '', '');
			var trade_content=createSingleElement('div','selected_trade_content', '', '', '');
			var trade_header_from=createSingleElement('div','selected_trade_header', '', 'You receive', '');
			var trade_from=createSingleElement('div','trade_element '+restypes_short[thisTrade.from_res_id].toLowerCase(), '', prettyPrint(from_amount), '');
			var trade_header_to=createSingleElement('div','selected_trade_header', '', 'You pay', '');
			var trade_to=createSingleElement('div','trade_element '+restypes_short[thisTrade.to_res_id].toLowerCase(), '', prettyPrint(to_amount), '');
			var trade_nickline=createSingleElement('div','selected_trade_infoline', '', 'Resources Delivered from: '+thisTrade.nickname, '');
			var trade_timeline=createSingleElement('div','selected_trade_infoline', '', 'Time until Trade Expires: '+secondsToFullTimeNosecs(thisTrade.timestamp+(ad2460.allianceData.trade.max_trade_length)-ad2460.serverTime), '');
			var button_container=createSingleElement('div','lightbutton160', '', '', 'acceptTrade('+thisTrade.trade_id+')');
			var button_text=createSingleElement('div','buttontext24', '', 'Accept', '');
			var help_text=createSingleElement('div','lowpanel_helpinfo', '', 'Click ACCEPT to initiate the trade.', '');

			var cancelbutton_container=createSingleElement('div','lightbutton160', '', '', 'cancelTrade('+thisTrade.trade_id+')');
			var cancelbutton_text=createSingleElement('div','buttontext24', '', 'Cancel', '');
			//<div class="lightbutton160" onclick="cancelTrade(2326)"><div class="buttontext24">Cancel</div></div>

			trade_container.appendChild(trade_content);
			trade_content.appendChild(trade_header_from);
			trade_content.appendChild(trade_from);
			trade_content.appendChild(trade_header_to);
			trade_content.appendChild(trade_to);
			trade_content.appendChild(trade_nickline);
			trade_content.appendChild(trade_timeline);

			if (thisTrade.user_id!=ad2460.user_id){
				button_container.appendChild(button_text);
				trade_content.appendChild(button_container);
			}
			else {
				trade_header_from.innerHTML='You offer';
				trade_header_to.innerHTML='For';

				cancelbutton_container.appendChild(cancelbutton_text);
				trade_content.appendChild(cancelbutton_container);

			}

			container.appendChild(trade_container);
			if (thisTrade.user_id!=ad2460.user_id){
				container.appendChild(help_text);
			}
			//else {
			//	var help_text=createSingleElement('div','lowpanel_helpinfo', '', 'You may not trade with yourself.', '');
			//	container.appendChild(help_text);
			//}
		}
	}
}

function acceptTrade(tradeId){
	$.post('actionhandler.pl', {action:'accept_trade' ,trade_id:tradeId}, function(data){ parseInfo(data);});
}

function leaveAllianceClick(){
	showConfirmationPopup("Are you sure you wish to leave your alliance?","Yes","No","confirmLeaveAlliance();hideConfirmationPopup();")
}

function confirmLeaveAlliance(){
	$.post('actionhandler.pl', {action:'leave_alliance'}, function(data){ parseInfo(data);});
}

function clearAllianceNews(){
	ad2460.allianceData.news=new Array;
}

function addAllianceNews(news_id, alliance_id, timestamp, type, data){
	var i=0;
	var found=0;
	for (i=0;i<ad2460.allianceData.news.length ;i++ ){
		if (ad2460.allianceData.news[i].news_id==news_id){
			return;
		}
	}
	ad2460.allianceData.news.push(new allianceNews(news_id, alliance_id, timestamp, type, data));
	flagNewAllianceNews();
}

function flagNewAllianceNews(){
	$("#alliance_alert").show().css("opacity","1.0");
}

function allianceAlertClick(){
	$("#alliancebutton").click();
	var functionString="$('#alliance_management_main_panel').click()";
	setTimeout(functionString,1000);
	var functionString2="$('#view_alliance_news').click()";
	setTimeout(functionString2,1500);
}

function toggleAllianceNewsFilter(id){
	ad2460.allianceData.newsFilters[id]= !ad2460.allianceData.newsFilters[id];
	renderAllianceNews();
}

function returnAllianceNewsBodyText(type,datastring){
	var string="";
	var data=datastring.split('|');

	if (type==1){
		var owner_id=data[0];
		var owner_name=data[1];
		var outpost_name=data[2];
		var x=data[3];
		var y=data[4];
		var attacker_id=data[5];
		var attacker_name=data[6];
		var attacker_x=data[7];
		var attacker_y=data[8];
		var attacker_alliance_id=data[9];
		var attacker_alliance_name=data[10];
		var result=data[11];
		var launch_id=data[12];

		/*
			translations.alliance_news_outpost_lost=\"".ad::lang::translate($language,"The outpost was lost.")."\";
			translations.alliance_news_outpost_captured=\"".ad::lang::translate($language,"The outpost was captured.")."\";
		*/

		if (attacker_alliance_id>0){
			string=fillIn(translations.alliance_news_allied_op_inc_attack_with_alliance,[outpost_name,owner_name,attacker_name,attacker_alliance_name]);
		}
		else {
			string=fillIn(translations.alliance_news_allied_op_inc_attack_without_alliance,[outpost_name,owner_name,attacker_name]);
		}
		if (result>0){
			var addon=" "+translations.alliance_news_outpost_lost;
			string+=addon;
		}
	}
	else if (type==2){
		// owner_id, owner_name, homeworld_name, x,y, attacker_id, attacker_name, attacker_x, attacker_y, attacker_alliance_id, attacker_alliance_name, result, combat_id
		var owner_id=data[0];
		var owner_name=data[1];
		var homeworld_name=data[2];
		var x=data[3];
		var y=data[4];
		var attacker_id=data[5];
		var attacker_name=data[6];
		var attacker_x=data[7];
		var attacker_y=data[8];
		var attacker_alliance_id=data[9];
		var attacker_alliance_name=data[10];
		var result=data[11];
		var launch_id=data[12];
		if (attacker_alliance_id>0){
			string=fillIn(translations.alliance_news_allied_hw_inc_attack_with_alliance,[homeworld_name,owner_name,attacker_name,attacker_alliance_name]);
		}
		else {
			string=fillIn(translations.alliance_news_allied_hw_inc_attack_without_alliance,[homeworld_name,owner_name,attacker_name]);
		}
	}
	else if (type==3){
		// initiator_id, initiator_name, project_id
		var initiator_id=data[0];
		var initiator_name=data[1];
		var project_id=data[2];

		var proj=returnGameObjectById(project_id);

		string=fillIn(translations.alliance_news_allied_project_init,[initiator_name,proj.name]);
	}
	else if (type==4){
		// project_id
		var project_id=data[0];
		var proj=returnGameObjectById(project_id);

		string=fillIn(translations.alliance_news_allied_project_done,[proj.name]);
	}
	else if (type==5){
		// launcher_id, launcher_name, x,y, planet_id, owner_id, owner_name, owner_x, owner_y, owner_alliance_id, owner_alliance_name, result, combat_id, planet_name
		var launcher_id=data[0];
		var launcher_name=data[1];
		var x=data[2];
		var y=data[3];
		var planet_id=data[4];
		var owner_id=data[5];
		var owner_name=data[6];
		var owner_x=data[7];
		var owner_y=data[8];
		var owner_alliance_id=data[9];
		var owner_alliance_name=data[10];
		var result=data[11];
		var launch_id=data[12];
		var planet_name=data[13];

		/*
			translations.alliance_news_outpost_lost=\"".ad::lang::translate($language,"The outpost was lost.")."\";
			translations.alliance_news_outpost_captured=\"".ad::lang::translate($language,"The outpost was captured.")."\";
		*/


		if (owner_alliance_id>0){
			string=fillIn(translations.alliance_news_allied_launch_op_with_alliance,[launcher_name,planet_name,owner_name,owner_alliance_name]);
		}
		else {
			string=fillIn(translations.alliance_news_allied_launch_op_without_alliance,[launcher_name,planet_name,owner_name]);
		}

		if (result>0){
			var addon=" "+translations.alliance_news_outpost_captured;
			string+=addon;
		}

	}
	else if (type==6){
		// launcher_id, launcher_name, x,y, planet_id, owner_id, owner_name, owner_alliance_id, owner_alliance_name, result, combat_id, planet_name
		var launcher_id=data[0];
		var launcher_name=data[1];
		var x=data[2];
		var y=data[3];
		var planet_id=data[4];
		var owner_id=data[5];
		var owner_name=data[6];
		var owner_alliance_id=data[7];
		var owner_alliance_name=data[8];
		var result=data[9];
		var launch_id=data[10];
		var planet_name=data[11];

		if (owner_alliance_id>0){
			string=fillIn(translations.alliance_news_allied_launch_hw_with_alliance,[launcher_name,planet_name,owner_name,owner_alliance_name]);
		}
		else {
			string=fillIn(translations.alliance_news_allied_launch_hw_without_alliance,[launcher_name,planet_name,owner_name]);
		}
	}
	else if (type==7){
		// joiner_id, joiner_nickname
		var joiner_id=data[0];
		var joiner_name=data[1];

		string=fillIn(translations.alliance_news_joined,[joiner_name]);
	}
	else if (type==8){
		// joiner_id, joiner_nickname
		var joiner_id=data[0];
		var joiner_name=data[1];

		string=fillIn(translations.alliance_news_left,[joiner_name]);
	}

	else if (type==9){
		// initiator_id, initiator_name, mission_id
		var initiator_id=data[0];
		var initiator_name=data[1];
		var mission_id=data[2];

		var mission=returnGameObjectById(mission_id);

		string=fillIn(translations.alliance_news_mission_init,[initiator_name,mission.name]);
	}

	else if (type==10){
		// mission_id, result
		var mission_id=data[0];
		var result=data[1];

		var mission=returnGameObjectById(mission_id);

		if (result==1){
			string=fillIn(translations.alliance_news_mission_succeeded,[mission.name]);
		}
		else {
			string=fillIn(translations.alliance_news_mission_failed,[mission.name]);
		}
	}
	else if (type==11){
		// alliance-type
		var taxtype=data[0];

		if (taxtype==1){
			string=translations.alliance_news_tax_change_taxed;
		}
		else {
			string=translations.alliance_news_tax_change_free;
		}
	}
	else if (type==12){
		// leadership change, data is old | new
		var previous_leader_name=data[0];
		var new_leader_name=data[1];
		string=fillIn(translations.alliance_news_leadership_change,[previous_leader_name,new_leader_name]);
	}
	else if (type==13){
		// renamed alliance, data is just new_name
		var new_name=data[0];
		string=fillIn(translations.alliance_news_renamed,[new_name]);
	}
	else if (type==14){
		// launcher_id, launcher_name, x,y, planet_id, owner_id, owner_name, owner_x, owner_y, owner_alliance_id, owner_alliance_name, result, combat_id, planet_name
		var launcher_id=data[0];
		var launcher_name=data[1];
		var x=data[2];
		var y=data[3];
		var planet_id=data[4];
		var owner_id=data[5];
		var owner_name=data[6];
		var owner_x=data[7];
		var owner_y=data[8];
		var owner_alliance_id=data[9];
		var owner_alliance_name=data[10];
		var result=data[11];
		var launch_id=data[12];
		var planet_name=data[13];

		if (owner_alliance_id>0){
			//string=fillIn(translations.alliance_news_allied_launch_op_with_alliance,[launcher_name,planet_name,owner_name,owner_alliance_name]);
			string=fillIn(translations.alliance_news_allied_launch_station_with_alliance,[launcher_name,planet_name,owner_name,owner_alliance_name]);
		}
		else {
			//string=fillIn(translations.alliance_news_allied_launch_op_without_alliance,[launcher_name,planet_name,owner_name]);
			string=fillIn(translations.alliance_news_allied_launch_station_without_alliance,[launcher_name,planet_name,owner_name]);
		}

		if (result>0){
			var addon=" "+translations.alliance_news_station_captured;
			string+=addon;
		}

	}
	else if (type==15){
			var owner_id=data[0];
			var owner_name=data[1];
			var outpost_name=data[2];
			var x=data[3];
			var y=data[4];
			var attacker_id=data[5];
			var attacker_name=data[6];
			var attacker_x=data[7];
			var attacker_y=data[8];
			var attacker_alliance_id=data[9];
			var attacker_alliance_name=data[10];
			var result=data[11];
			var launch_id=data[12];

			/*
				translations.alliance_news_outpost_lost=\"".ad::lang::translate($language,"The outpost was lost.")."\";
				translations.alliance_news_outpost_captured=\"".ad::lang::translate($language,"The outpost was captured.")."\";
			*/

			if (attacker_alliance_id>0){
				string=fillIn(translations.alliance_news_allied_station_inc_attack_with_alliance,[outpost_name,owner_name,attacker_name,attacker_alliance_name]);
			}
			else {
				string=fillIn(translations.alliance_news_allied_station_inc_attack_without_alliance,[outpost_name,owner_name,attacker_name]);
			}
			if (result>0){
				var addon=" "+translations.alliance_news_station_lost;
				string+=addon;
			}
		}
		else if (type==16){
			// Lost sector, data[0] is the name
			var name=data[0];
			string=fillIn(translations.alliance_news_lost_sector,[name]);
		}
		else if (type==17){
			// Won sector, data[0] is the name
			var name=data[0];
			string=fillIn(translations.alliance_news_won_sector,[name]);
		}
		else if (type==20){
			// Bank attack seen from the bank's alliance
			var owner_id=data[0];
			var owner_name=data[1];
			var outpost_name=data[2];
			var x=data[3];
			var y=data[4];
			var attacker_id=data[5];
			var attacker_name=data[6];
			var attacker_x=data[7];
			var attacker_y=data[8];
			var attacker_alliance_id=data[9];
			var attacker_alliance_name=data[10];
			var result=data[11];
			var launch_id=data[12];

			if (attacker_alliance_id>0){
				string=fillIn(translations.alliance_news_allied_bank_inc_attack_with_alliance,[attacker_name,attacker_alliance_name]);
			}
			else {
				string=fillIn(translations.alliance_news_allied_bank_inc_attack_without_alliance,[attacker_name]);
			}
		}
		else if (type==21){
			// Bank attack seen from launchers alliance
			var owner_id=data[0];
			var owner_name=data[1];
			var outpost_name=data[2];
			var x=data[3];
			var y=data[4];
			var attacker_id=data[5];
			var attacker_name=data[6];
			var attacker_x=data[7];
			var attacker_y=data[8];
			var attacker_alliance_id=data[9];
			var attacker_alliance_name=data[10];
			var result=data[11];
			var launch_id=data[12];

			if (attacker_alliance_id>0){
				string=fillIn(translations.alliance_news_allied_bank_launch_attack_with_alliance,[attacker_alliance_name,owner_name]);
			}
			else {
				string=fillIn(translations.alliance_news_allied_bank_launch_attack_without_alliance,[owner_name]);
			}
		}
		else if (type==25){
			// Missing station upkeep, injured ships
			var station_name=data[0];
			var damaged_ships=data[1];
			var destroyed_ships=data[2];
			string=fillIn(translations.alliance_news_failed_station_upkeep,[station_name,damaged_ships,destroyed_ships]);
		}
		else if (type==26){
			// Missing bank-fleet upkeep, injured ships
			var bank_name=data[0];
			var damaged_ships=data[1];
			var destroyed_ships=data[2];
			string=fillIn(translations.alliance_news_failed_bankfleet_upkeep,[bank_name,damaged_ships,destroyed_ships]);
		}



	return string;
}

function returnNewsClickable(type,datastring){
	var data=datastring.split('|');
	var clickable=false;
	if (type==1){
		var launch_id=data[12];
		var string=translations.view_combat;
		var onclick='viewCombatSummaryClick('+launch_id+',event)';
		clickable=createSingleElement('span', 'fleetlog_timestamp report', '', string, onclick);
	}
	else if (type==2){
		var launch_id=data[12];
		var string=translations.view_combat;
		var onclick='viewCombatSummaryClick('+launch_id+',event)';
		clickable=createSingleElement('span', 'fleetlog_timestamp report', '', string, onclick);
	}
	else if (type==5){
		var launch_id=data[12];
		var string=translations.view_combat;
		var onclick='viewCombatSummaryClick('+launch_id+',event)';
		clickable=createSingleElement('span', 'fleetlog_timestamp report', '', string, onclick);
	}
	else if (type==6){
		var launch_id=data[10];
		var string=translations.view_combat;
		var onclick='viewCombatSummaryClick('+launch_id+',event)';
		clickable=createSingleElement('span', 'fleetlog_timestamp report', '', string, onclick);
	}
	else if (type==14){
		var launch_id=data[12];
		var string=translations.view_combat;
		var onclick='viewCombatSummaryClick('+launch_id+',event)';
		clickable=createSingleElement('span', 'fleetlog_timestamp report', '', string, onclick);
	}
	else if (type==15){
		var launch_id=data[12];
		var string=translations.view_combat;
		var onclick='viewCombatSummaryClick('+launch_id+',event)';
		clickable=createSingleElement('span', 'fleetlog_timestamp report', '', string, onclick);
	}
	else if (type==16){
		var q=data[1];
		var s=data[2];
		var string='View Sector';
		var onclick='zoomInTo('+q+','+s+')';
		clickable=createSingleElement('span', 'fleetlog_timestamp report planetlink ', '', string, onclick);
	}
	else if (type==17){
		var q=data[1];
		var s=data[2];
		var string='View Sector';
		var onclick='zoomInTo('+q+','+s+')';
		clickable=createSingleElement('span', 'fleetlog_timestamp report planetlink ', '', string, onclick);
	}
	else if (type==20){
		var launch_id=data[12];
		var string=translations.view_combat;
		var onclick='viewCombatSummaryClick('+launch_id+',event)';
		clickable=createSingleElement('span', 'fleetlog_timestamp report', '', string, onclick);
	}
	else if (type==21){
		var launch_id=data[12];
		var string=translations.view_combat;
		var onclick='viewCombatSummaryClick('+launch_id+',event)';
		clickable=createSingleElement('span', 'fleetlog_timestamp report', '', string, onclick);
	}
	return clickable;
}

function returnAllianceNewsImageSrc(type){
	var src='images/fixed/spacer.gif';
	if (type==0 || type==1 || type==2){
		src='images/fixed/attack_icon.png';
	}
	else if (type==3){
		src='images/fixed/alliance_project_initiate_icon.png';
	}
	else if (type==4){
		src='images/fixed/alliance_project_complete_icon.png';
	}
	else if (type==5 || type==6){
		src='images/fixed/attack_icon.png';
	}
	else if (type==7){
		src='images/fixed/memberjoin_icon.png';
	}
	else if (type==8){
		src='images/fixed/memberleave_icon.png';
	}
	else if (type==11){
		src='images/fixed/alliance_setting_icon.png';
	}
	else if (type==12){
		// alliance leadership change, to be fixed.
		src='images/fixed/alliance_setting_icon.png';
	}
	else if (type==13){
		// alliance leadership change, to be fixed.
		src='images/fixed/alliance_setting_icon.png';
	}
	else if (type==14 || type==15){
		// station-attack
		src='images/fixed/station_news_icon.png';
	}
	else if (type==16){
		// lost sector control
		src='images/fixed/sector_icon_lost.png';
	}
	else if (type==17){
		// gained sector control
		src='images/fixed/sector_icon.png';
	}
	else if (type==20){
		// Bank attack displayed to target alliance
		src='images/fixed/bank_attack_icon.png';
	}
	else if (type==21){
		// Bank attack displayed to lanching alliance
		src='images/fixed/bank_news_icon.png';
	}
	else if (type==25){
		// station-upkeep failed
		src='images/fixed/station_news_icon.png';
	}
	else if (type==26){
		// bankfleet-upkeep failed
		src='images/fixed/bank_news_icon.png';
	}



	return src;

}

function renderAllianceNews(){
	if (ad2460.allianceData.lastAllianceMenuSelected!='alliancenews' || combatPanelOpen==1){
		return;
	}


	var el=document.querySelector(".alliance_news_container");
	if (el){
		if (el.scrollTop>0){
			return;
		}
	}

	var startTime=new Date;

	var sidepanel=document.getElementById('alliance_management_sidepanel_content');
	removeChildNodes('alliance_management_sidepanel_content');

	var sideheader=createSingleElement('div', 'alliance_section_side_header', 'alliance_section_side_header', 'Alliance News Feed', '');
	sidepanel.appendChild(sideheader);

	var subcontainer=createSingleElement('div', 'motd_info', '', '', '');
	var infospan=createSingleElement('div', '', '', 'Here you can find a list of the most important events for your alliance for the past 3 days.', '');

	subcontainer.appendChild(infospan);

	var buttonsContainer=createSingleElement('div', '', 'alliance_new_buttons_container', '', '');
	buttonsContainer.style.marginTop='10px';
	// Now, we need 4 buttons, more or less identical
	var buttonText=new Array;
	buttonText.push("N/A");
	buttonText.push("Show Incoming");
	buttonText.push("Show Launches");
	buttonText.push("Show Joins/Leaves");
	buttonText.push("Include Outposts");
	buttonText.push("Show Other News");

	var i=1;
	for (i=1;i<=5 ;i++ ){
		var buttonContainer=createSingleElement('div', 'selected_fleet_actions', 'news_toggle_'+i, '', '');
		var buttonInner=createSingleElement('div', 'fixed_button fixed_button_21_square', 'news_filter_'+i, '', '');
		var buttonInner2;
		if (ad2460.allianceData.newsFilters[i]==true){
			buttonInner2=createSingleElement('div', 'fixed_button_click square_blue_small', 'news_toggle_clicker_'+i, '', 'toggleAllianceNewsFilter('+i+')');
		}
		else {
			buttonInner2=createSingleElement('div', 'fixed_button_click square_red_small', 'news_toggle_clicker_'+i, '', 'toggleAllianceNewsFilter('+i+')');
		}
		var buttonLabel=createSingleElement('div', 'fleet_assign_button_text alliance_news', '', buttonText[i], '');

		buttonContainer.appendChild(buttonInner);
		buttonInner.appendChild(buttonInner2);
		buttonContainer.appendChild(buttonLabel);
		buttonsContainer.appendChild(buttonContainer);

	}
	subcontainer.appendChild(buttonsContainer);
	sidepanel.appendChild(subcontainer);

	var infopanel=document.getElementById('alliance_management_infopanel_content');
	removeChildNodes('alliance_management_infopanel_content');

	var header=createSingleElement('div', 'infopanel_header', '', 'Alliance News', '');
	infopanel.appendChild(header);

	var newsContainer=createSingleElement('div', 'selection_container alliance_news_container', '', '', '');

	var innerNewsContainer=createSingleElement('div', 'fleetlog_list', 'allyNews', '', '');

	ad2460.allianceData.news.sort(function(a, b){ return b.news_id-a.news_id});

	var i=0;
	for (i=0;i<ad2460.allianceData.news.length ;i++ ){
		var entry=ad2460.allianceData.news[i];

		var showThis=checkTypeAgainstFilters(entry.type);
		if (showThis==false){
			continue;
		}

		var entryContainer=createSingleElement('div', 'fleetlog_entry alliance_news_entry', '', '', '');
		var entryImageContainer=createSingleElement('div', 'fleetlog_icon alliance_news', '', '', '');
		var imgSrc=returnAllianceNewsImageSrc(entry.type);

		if (entry.news_id>latestAllyNewsId){
			entryContainer.style.backgroundColor='rgba(50,100,50,0.5)';
		}

		var entryImage=createSingleElement('img', '', '', imgSrc, '');

		// We still need to format the message, which is no problem in english, but a nightmare for multi-language-support
		var bodytext=returnAllianceNewsBodyText(entry.type,entry.data);
		var clickable=returnNewsClickable(entry.type,entry.data);

		var bodyContainer=createSingleElement('div', 'fleetlog_content alliance_news', '', '', '');
		var mainBody=createSingleElement('span', '', '', bodytext, '');
		var timestamp=createSingleElement('span', 'fleetlog_timestamp', '', entry.timestamp, '');

		entryContainer.appendChild(entryImageContainer);
		entryImageContainer.appendChild(entryImage);

		entryContainer.appendChild(bodyContainer);
		bodyContainer.appendChild(mainBody);
		if (clickable!=false){
			bodyContainer.appendChild(clickable);
		}

		bodyContainer.appendChild(timestamp);
		//innerNewsContainer.appendChild(entryContainer);
		newsContainer.appendChild(entryContainer);
	}

	//newsContainer.appendChild(innerNewsContainer);

	infopanel.appendChild(newsContainer);

	var endTime=new Date;

	var diff=endTime-startTime;
	if (ad2460.allianceData.news.length>0){
		latestAllyNewsId=ad2460.allianceData.news[0].news_id;
	}
}


function checkTypeAgainstFilters(type){
	if (type==1 || type==2){
		// 1 is OP!
		if (type==2){
			return	ad2460.allianceData.newsFilters[1];
		}
		else {
			if (ad2460.allianceData.newsFilters[1]==true){
				return	ad2460.allianceData.newsFilters[4];
			}
			else {
				return false;
			}
		}
	}
	else if (type==5 || type==6){
		// 5 is OP!
		if (type==6){
			return	ad2460.allianceData.newsFilters[2];
		}
		else {
			if (ad2460.allianceData.newsFilters[2]==true){
				return	ad2460.allianceData.newsFilters[4];
			}
			else {
				return false;
			}
		}
	}
	else if (type==7 || type==8){
		return	ad2460.allianceData.newsFilters[3];
	}
	else if (type==16 || type==17){
		// ALWAYS display sector control items
		return	true;
	}

	else {
		return	ad2460.allianceData.newsFilters[5];
	}
}

function viewCombatSummaryClick(view_id,e){
	if (e){
		e.preventDefault();
		if (e.stopPropagation){
	            e.stopPropagation();
		}
		e.cancelBubble = true;
	}

	for (i=0;i<ad2460.combat.summaries.length ;i++ ){
		if (ad2460.combat.summaries[i].view_id==view_id){
			renderShortCombatSummary(view_id);
			return;
		}
	}
	// Ok, we didn't have it in our cache, so fetch it!
	$.post('actionhandler.pl', {action:'load_combat_summary',view_id:view_id}, function(data){ parseInfo(data);renderShortCombatSummary(view_id);});


	return false;
}

function renderShortCombatSummary(view_id){
	var summary=false;
	var i=0;
	for (i=0;i<ad2460.combat.summaries.length ;i++ ){
		if (ad2460.combat.summaries[i].view_id==view_id){
			summary=ad2460.combat.summaries[i];
		}
	}

	if (summary==false){
		return;
	}

	$("#large_plate_bg_img").hide();

	showSimpleBoxLarge("Combat summary","");
	var container=document.getElementById("large_main_text");
	var htmlCode="<table width='600' id='short_combat_summary_table' cellspacing='0' cellpadding='0' style='cursor:default;'>"+
				"<tr><th colspan='2'>Location</td><th>&nbsp;</th><th colspan='2'>Result</th></tr>"+
				"<tr><td colspan='2' id='short_sum_location'>Some planet</td><th>&nbsp;</th><td colspan='2' id='short_sum_results'>Attacker won</td></tr>"+
				"<tr><th colspan='2'>Attacker</th><td style='color:yellow;cursor:pointer;'><div class='lightbutton160 green' onclick='viewCombat("+summary.view_id+")'><div class='buttontext24'>Watch combat</div></div></td><th colspan='2' >Defender</th></tr>"+
				"<tr><td colspan='2' id='short_sum_att_name' align='center'>Some dude</td><th>Player<br>Alliance</th><td colspan='2' align='center' id='short_sum_def_name'>Some other dude</td></tr>"+
				"<tr><th width='20%'>Total</th><th width='20%'>Lost</th><th width='20%'>Ships</th><th width='20%'>Total</th><th width='20%'>Lost</th></tr>"+
				"<tr><td id='short_sum_att_frigates'>0</td><td id='short_sum_att_frigates_lost'>0</td><th>Frigates</th><td id='short_sum_def_frigates'>0</td><td id='short_sum_def_frigates_lost'>0</td></tr>"+
				"<tr><td id='short_sum_att_cruisers'>0</td><td id='short_sum_att_cruisers_lost'>0</td><th>Cruisers</th><td id='short_sum_def_cruisers'>0</td><td id='short_sum_def_cruisers_lost'>0</td></tr>"+
				"<tr><td id='short_sum_att_battleships'>0</td><td id='short_sum_att_battleships_lost'>0</td><th>Battleships</th><td id='short_sum_def_battleships'>0</td><td id='short_sum_def_battleships_lost'>0</td></tr>"+
				"<tr><td id='short_sum_att_carriers'>0</td><td id='short_sum_att_carriers_lost'>0</td><th>Carriers</th><td id='short_sum_def_carriers'>0</td><td id='short_sum_def_carriers_lost'>0</td></tr>"+
				"<tr><td id='short_sum_att_transports'>0</td><td id='short_sum_att_transports_lost'>0</td><th>Transports</th><td id='short_sum_def_transports'>0</td><td id='short_sum_def_transports_lost'>0</td></tr>"+
				"<tr><td id='short_sum_att_utility'>0</td><td id='short_sum_att_utility_lost'>0</td><th>Utility</th><td id='short_sum_def_utility'>0</td><td id='short_sum_def_utility_lost'>0</td></tr>"+
				"<tr><td id='short_sum_att_defenses'>0</td><td id='short_sum_att_defenses_lost'>0</td><th>Defenses</th><td id='short_sum_def_defenses'>0</td><td id='short_sum_def_defenses_lost'>0</td></tr>"+
				"<tr><td id='short_sum_att_total'>0</td><td id='short_sum_att_total_lost'>0</td><th>Total</th><td id='short_sum_def_total'>0</td><td id='short_sum_def_total_lost'>0</td></tr>"+
				"<tr><td id='short_sum_att_fighters'>0</td><td id='short_sum_att_fighters_lost'>0</td><th>Fighters</th><td id='short_sum_def_fighters'>0</td><td id='short_sum_def_fighters_lost'>0</td></tr>"+
				"<tr><td id='short_sum_att_corvettes'>0</td><td id='short_sum_att_corvettes_lost'>0</td><th>Corvettes</th><td id='short_sum_def_corvettes'>0</td><td id='short_sum_def_corvettes_lost'>0</td></tr>"+
				"<tr><td colspan='2' id='short_sum_att_value_lost'>0</td><th>Value Lost</th><td colspan='2' id='short_sum_def_value_lost'>0</td></tr>"+
				"<tr><td colspan='2' id='short_sum_att_xp'>0</td><th>XP</th><td colspan='2' id='short_sum_def_xp'>0</td></tr>"+
				"</table>"+
				"<div class='com_sum_ship_numbers com_sum_bottom'>Stolen resources</div>"+
				"<div class='g_o_cost_field' style='font-size:13px;margin-left:95px;margin-top:5px;'>"+
				"<div class='g_o_cost_value' id='short_bs_stolen_h'>0</div>"+
				"<div class='g_o_cost_value' id='short_bs_stolen_i'>0</div>"+
				"<div class='g_o_cost_value' id='short_bs_stolen_s'>0</div>"+
				"<div class='g_o_cost_value' id='short_bs_stolen_n'>0</div>"+
				"</div>"+
				"<div class='com_sum_ship_numbers com_sum_bottom'>Bonus resources</div>"+
				"<div class='g_o_cost_field' style='font-size:13px;margin-left:95px;margin-top:5px;'>"+
				"<div class='g_o_cost_value' id='short_bs_bonus_h'>0</div>"+
				"<div class='g_o_cost_value' id='short_bs_bonus_i'>0</div>"+
				"<div class='g_o_cost_value' id='short_bs_bonus_s'>0</div>"+
				"<div class='g_o_cost_value' id='short_bs_bonus_n'>0</div>"+
				"</div>";


	container.innerHTML=htmlCode;



	var resultString="Total Wipeout";
	if (summary.result==1 || summary.result==4){
		resultString="Attacker won";
	}
	else if (summary.result==2 || summary.result==5){
		resultString="Defender won";
	}

	if (summary.outpost_takeover==1){
		if (summary.location_planet_type<60){
			resultString+="<br>OP Captured";
		}

		if (summary.location_planet_type>=60){
			resultString+="<br>Station Captured";
		}
	}

	if (summary.location_planet_type>0){
		$("#large_plate_bg_img").attr("src","images/planets/planettype"+zeroPad(summary.location_planet_type)+".png").show();
	}

	var combatLocation=convertShortCoordsToLongCoords(summary.location_x,summary.location_y);

	if (summary.location_x==0){
		combatLocation.coordString='N/A';
		summary.location_name='Mission';
		$("#short_sum_location").html(summary.location_name);
	}
	else {
		$("#short_sum_location").html(summary.location_name+"<br>"+"<span style='color: #45D6EB; text-align: left;  cursor: url(images/icons/smbutton.png), auto;' onclick='zoomInToXY("+summary.location_x+","+summary.location_y+")'>"+combatLocation.coordString+"</span>");
	}

	if (summary.result==1 || summary.result==4){
		$("#short_sum_results").css({"color":"red"});
	}
	if (summary.result==2 || summary.result==5){
		$("#short_sum_results").css({"color":"green"});
	}

	$("#short_sum_att_xp").html(prettyPrint(summary.att_xp));
	$("#short_sum_def_xp").html(prettyPrint(summary.def_xp));

	$("#short_sum_results").html(resultString);


	$("#short_sum_att_name").html("<span style='color:#ffe868;font-size:19px;'>"+summary.att_nickname+"</span><br>"+"<span style='color:cyan;font-size:17px;'>"+summary.att_alliance_name+"</span");
	$("#short_sum_def_name").html("<span style='color:#ffe868;font-size:19px;'>"+summary.def_nickname+"</span><br>"+"<span style='color:cyan;font-size:17px;'>"+summary.def_alliance_name+"</span");

	$("#short_sum_att_frigates").html(summary.att_frigates);
	$("#short_sum_att_frigates_lost").html(summary.att_frigates_lost);
	$("#short_sum_def_frigates").html(summary.def_frigates);
	$("#short_sum_def_frigates_lost").html(summary.def_frigates_lost);

	$("#short_sum_att_cruisers").html(summary.att_cruisers);
	$("#short_sum_att_cruisers_lost").html(summary.att_cruisers_lost);
	$("#short_sum_def_cruisers").html(summary.def_cruisers);
	$("#short_sum_def_cruisers_lost").html(summary.def_cruisers_lost);

	$("#short_sum_att_battleships").html(summary.att_battleships);
	$("#short_sum_att_battleships_lost").html(summary.att_battleships_lost);
	$("#short_sum_def_battleships").html(summary.def_battleships);
	$("#short_sum_def_battleships_lost").html(summary.def_battleships_lost);

	$("#short_sum_att_carriers").html(summary.att_carriers);
	$("#short_sum_att_carriers_lost").html(summary.att_carriers_lost);
	$("#short_sum_def_carriers").html(summary.def_carriers);
	$("#short_sum_def_carriers_lost").html(summary.def_carriers_lost);

	$("#short_sum_att_utility").html(summary.att_utility);
	$("#short_sum_att_utility_lost").html(summary.att_utility_lost);
	$("#short_sum_def_utility").html(summary.def_utility);
	$("#short_sum_def_utility_lost").html(summary.def_utility_lost);

	$("#short_sum_att_transports").html(summary.att_transports);
	$("#short_sum_att_transports_lost").html(summary.att_transports_lost);
	$("#short_sum_def_transports").html(summary.def_transports);
	$("#short_sum_def_transports_lost").html(summary.def_transports_lost);

	$("#short_sum_att_fighters").html(summary.att_fighters);
	$("#short_sum_att_fighters_lost").html(summary.att_fighters_lost);
	$("#short_sum_def_fighters").html(summary.def_fighters);
	$("#short_sum_def_fighters_lost").html(summary.def_fighters_lost);

	$("#short_sum_att_corvettes").html(summary.att_corvettes);
	$("#short_sum_att_corvettes_lost").html(summary.att_corvettes_lost);
	$("#short_sum_def_corvettes").html(summary.def_corvettes);
	$("#short_sum_def_corvettes_lost").html(summary.def_corvettes_lost);

	var att_defenses_lost=0;
	var att_defenses=0;
	var def_defenses=parseInt(summary.def_flak+summary.def_artillery+summary.def_shield_gens+summary.def_battle_stations);
	var def_defenses_lost=parseInt(summary.def_flak_lost+summary.def_artillery_lost+summary.def_shield_gens_lost+summary.def_battle_stations_lost);

	$("#short_sum_att_defenses").html(att_defenses);
	$("#short_sum_att_defenses_lost").html(att_defenses_lost);
	$("#short_sum_def_defenses").html(def_defenses);
	$("#short_sum_def_defenses_lost").html(def_defenses_lost);

	var att_total=0;
	var att_total_lost=0;
	var def_total=0;
	var def_total_lost=0;

	att_total=summary.att_frigates+summary.att_cruisers+summary.att_battleships+summary.att_carriers+summary.att_transports+summary.att_utility+att_defenses;
	def_total=summary.def_frigates+summary.def_cruisers+summary.def_battleships+summary.def_carriers+summary.def_transports+summary.def_utility+def_defenses;

	att_total_lost=summary.att_frigates_lost+summary.att_cruisers_lost+summary.att_battleships_lost+summary.att_carriers_lost+summary.att_transports_lost+summary.att_utility_lost+att_defenses_lost;
	def_total_lost=summary.def_frigates_lost+summary.def_cruisers_lost+summary.def_battleships_lost+summary.def_carriers_lost+summary.def_transports_lost+summary.def_utility_lost+def_defenses_lost;

	$("#short_sum_att_total").html(att_total);
	$("#short_sum_att_total_lost").html(att_total_lost);
	$("#short_sum_def_total").html(def_total);
	$("#short_sum_def_total_lost").html(def_total_lost);

	$("#short_sum_att_value_lost").html(prettyPrint(summary.att_value_lost));
	$("#short_sum_def_value_lost").html(prettyPrint(summary.def_value_lost));

	$("#short_bs_stolen_h").html(prettyPrint(summary.taken_h));
	$("#short_bs_stolen_i").html(prettyPrint(summary.taken_i));
	$("#short_bs_stolen_s").html(prettyPrint(summary.taken_s));
	$("#short_bs_stolen_n").html(prettyPrint(summary.taken_n));

	//$( "#short_combat_summary_table tr:odd" ).css( "background-color", "rgba(60,60,60,0.6)" );
	//$( "#short_combat_summary_table tr:even" ).css( "background-color", "rgba(80,80,80,0.6)" );

	// $( "#short_combat_summary_table tr" ).css( "border-bottom", "1 px solid rgba(60,60,60,0.6)" );

	$("#short_combat_summary_table tr:nth-child(2) td" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});
	$("#short_combat_summary_table tr:nth-child(2) th" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});

	$("#short_combat_summary_table tr:nth-child(3) td" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});
	$("#short_combat_summary_table tr:nth-child(3) th" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});

	$("#short_combat_summary_table tr:nth-child(5) td" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});
	$("#short_combat_summary_table tr:nth-child(5) th" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});

	$("#short_combat_summary_table tr:nth-child(12) td" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});
	$("#short_combat_summary_table tr:nth-child(12) th" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});

	$("#short_combat_summary_table tr:nth-child(15) td" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});
	$("#short_combat_summary_table tr:nth-child(15) th" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});

	$("#short_combat_summary_table tr:nth-child(17) td" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});
	$("#short_combat_summary_table tr:nth-child(17) th" ).css({"border-bottom":"1px solid rgba(255,255,255,0.5)"});





	var bonus_res_per_type=Math.round(summary.bonus_resources/4);
	$("#short_bs_bonus_h").html(prettyPrint(bonus_res_per_type));
	$("#short_bs_bonus_i").html(prettyPrint(bonus_res_per_type));
	$("#short_bs_bonus_s").html(prettyPrint(bonus_res_per_type));
	$("#short_bs_bonus_n").html(prettyPrint(bonus_res_per_type));

}

function returnTextColClassBasedOnAllianceId(id){
	var classname='';
	var classnum=id%14;
	if (classnum<10){
		classnum='0'+classnum;
	}
	classname='col_'+classnum;

	return classname;
}

function showStationScoutings(planet_id){
	$.post('actionhandler.pl', {action:'fetch_station_scoutings',planet_id:planet_id}, function(data){ parseInfo(data);});
}

function renderStationScoutings(){
	// pop up a help-window and create the potential elements in there
	showSimpleBox('Detected scouts','',false);

	if (ad2460.allianceData.stationScouts.length==0){
		$("#simple_main_text").html("No scouts were detected here for the past 48 hours.");
	}
	else {
		var i=0;
		var parent=document.getElementById('simple_main_text');
		for (i=0;i<ad2460.allianceData.stationScouts.length ;i++ ){
			if (i<20){
				// createSingleElement(tag, classname, id, text, onclick)
				var a=returnAllianceById(ad2460.allianceData.stationScouts[i].alliance_id);
				var aname='N/A';
				if (a!=false){
					aname=a.name;
				}

				var container=createSingleElement('div', 'station_detected_scout_container', '', '', '');
				var d1=createSingleElement('div', 'station_detected_scout_timestamp', '', ad2460.allianceData.stationScouts[i].timestring, '');
				var d2=createSingleElement('div', 'station_detected_scout_nickname', '', ad2460.allianceData.stationScouts[i].nickname, '');
				var d3=createSingleElement('div', 'station_detected_scout_alliance', '', aname, '');
				container.appendChild(d1);
				container.appendChild(d2);
				container.appendChild(d3);
				parent.appendChild(container);

			}

		}
	}

}

function declareWarClick(alliance_id){
	// We must get the data we need from the server to show potential bonuses and check if the alliance CAN be declared war against!
	$.post('actionhandler.pl', {action:'declare_war_click',target_alliance_id:alliance_id}, function(data){ parseInfo(data);});
}

function showAllianceWarFeedback(result_id, feedback_text, modifier_1, modifier_2, target_alliance_name, target_alliance_id){
	// result_id 1 is ok, show modifiers and get verification-click
	// result_id 2 is not ok, no war can be declared, show text.

	if (result_id==1){
		var full_string=fillIn(translations.alliance_confirming_war_declaration,[target_alliance_name,modifier_1,target_alliance_name,modifier_2]);
		showConfirmationPopup(full_string, "Declare War", "Cancel", "confirmWarClick(target_alliance_id)", "", false, false, false, false);
	}
	else {
		showSimpleBox("Not yet",""+feedback_text,false);
	}
}

function confirmWarClick(alliance_id){
	// console.log("ConfirmWarClicked with aliance_id "+alliance_id);
	// We must get the data we need from the server to show potential bonuses and check if the alliance CAN be declared war against!
	$.post('actionhandler.pl', {action:'confirm_war_click',target_alliance_id:alliance_id}, function(data){ parseInfo(data);});
}
// Copyright 2010 Fifth Season AS
// Author: Christian "Spinner" Lassem
// If there is anythging here you wish to use, please contact me and ask permission. <firstname>.<lastname>@ad2460.com will do the trick.

// General functionality for the game AD2460

function playerUpdate(news_id,timestamp,heading,body,image_id,onclick,org_timestamp){
	this.news_id=news_id;
	this.timestamp=timestamp;
	this.heading=heading;
	this.body=body;
	this.image_id=image_id;
	this.onclick=onclick;
	this.org_timestamp=org_timestamp;
}

function fetchPlayerUpdates(){
	$.post('actionhandler.pl', {action:'fetch_player_updates',last_update:ad2460.updateTimes.lastPlayerUpdateFetch}, function(data){ parseInfo(data);});
}

function clearPlayerUpdates(){
	ad2460.playerUpdates=[];
	$(".latest_updates_container").remove();
}

function addPlayerUpdate(news_id,timestamp,heading,body,image_id,onclick,org_timestamp){
	var i=0;
	var found=false;
	for (i=0;i<ad2460.playerUpdates.length ;i++ ){
		if (ad2460.playerUpdates[i].news_id==news_id){
			found=true;
		}
	}
	if (found==false){
		ad2460.playerUpdates.push(new playerUpdate(news_id,timestamp,heading,body,image_id,onclick,org_timestamp));
	}

	checkUnclaimedTechPoints('player_update',image_id);

	// check for NEW (timestamp-based) update here, 

	if (found==false && org_timestamp>ad2460.serverTime-180 && image_id==9){
		if (heading=='Incoming hostiles'){
			// SOUND THE TRUMPET!
			play_multi_sound('sfx_incoming_alarm');
			// SHOW LIVE POPUP!
			showConfirmationPopup("We are under attack!", "Watch now", "Watch later", onclick+";hideConfirmationPopup();", "",true);
			//showOkPopup("We are under attack! Click the news-entry to the left to watch the live combat!", "OK", null)
		}
		if (heading=='Bank-attack'){
			// SOUND THE TRUMPET!
			play_multi_sound('sfx_incoming_alarm');
			// SHOW LIVE POPUP!
			showConfirmationPopup("Our alliance-bank is under attack!", "Watch now", "Watch later", onclick+";hideConfirmationPopup();", "", false, false, true);
		}
		if (heading=='Station-attack'){
			// SOUND THE TRUMPET!
			play_multi_sound('sfx_incoming_alarm');
			// SHOW LIVE POPUP!
			showConfirmationPopup("Our station is under attack!", "Watch now", "Watch later", onclick+";hideConfirmationPopup();", "", false, false, false, true);
		}

	}

	if (image_id==25 && org_timestamp>ad2460.serverTime-60){
		reloadBounties();
	}

}

function toggleFullNews(type){
	if (ad2460.fullnewsVisible==false){
		ad2460.fullnewsVisible=true;
		renderFullNews(type);
		showFullNews();
		if (ad2460.galaxynewsVisible==true){
			toggleTickerPanel();
		}
	}
	else {
		ad2460.fullnewsVisible=false;
		hideFullNews();
		unrenderFullNews();
	}
}

function deleteAllNews(){
	$.post('actionhandler.pl', {action:'delete_all_player_updates'}, function(data){ parseInfo(data);ad2460.playerUpdates=new Array; hideFullNews();selectPlayerUpdate(0);});
	
}

function renderFullNews(type){
	removeChildNodes('fullnewscontainer');
	var container=document.getElementById('fullnewscontainer');
	var n=0;

	var button=createSingleElement('div', 'lightbutton160 red', 'del_all_news_button', '', 'deleteAllNews()');
	var buttonText=createSingleElement('div', 'buttontext24', '', 'Delete All', '');

	button.style.left='40px';
	button.style.top='0px';
	button.style.marginBottom='2px';

	button.appendChild(buttonText);
	container.appendChild(button);

	for (n=ad2460.playerUpdates.length-1;n>=0 ;n-- ){
		var item=ad2460.playerUpdates[n];
		var renderThis=true;
		if (type=='attacksonly' && item.image_id!=9){
			renderThis=false;
		}

		if (renderThis==true){

			
			var outer=createSingleElement('div','fullnews_entry_box', 'fullnews_'+item.news_id, '', '');
			var inner1=createSingleElement('div','fullnews_heading', '', item.heading, '');
			var delimg=createSingleElement('img','del_newsentry', '', 'images/fixed/cancel.png', 'deletePlayerUpdate('+item.news_id+')');
			delimg.image_id = item.image_id;
			delimg.setAttribute("title","Click to delete this entry. Right-click to delete all entries of this type.");
			delimg.addEventListener('contextmenu', function(ev) {
				ev.preventDefault();
				deletePlayerUpdateType(ev.target.image_id);
				return false;
			}, false);
			
			var imgsrc=ad2460.playerUpdatesImages[item.image_id];
			var newsimg=createSingleElement('img','', '', imgsrc, '');
			var body=createSingleElement('span','', '', item.body, '');
			var timestamp=createSingleElement('span','fullnews_timestamp', '', item.timestamp, '');
			if (item.onclick!='' && item.onclick!=null){
				body.setAttribute('onclick',item.onclick);
				body.style.cursor='pointer';
			}

			if (item.image_id==9){
				if (item.heading=='Bank-attack'){
					newsimg.src='images/planets/notification/notify_bank.jpg';	
				}
				else if (item.heading=='Station-attack'){
					newsimg.src='images/planets/notification/notify_station_attack.jpg';	
				}
				else {
					newsimg.src=ad2460.playerUpdatesImages[item.image_id];
				}
			}
			else {
				// newsimg.src=ad2460.playerUpdatesImages[item.image_id];
			}

			outer.appendChild(delimg);
			outer.appendChild(inner1);
			outer.appendChild(newsimg);
			outer.appendChild(body);
			outer.appendChild(timestamp);
			container.appendChild(outer);

		}
	}
}

function unrenderFullNews(){
	removeChildNodes('fullnewscontainer');
}

function selectPlayerUpdate(id){
	if (ad2460.playerUpdates[id]){
		document.getElementById('playerUpdateItemHeader').innerHTML=ad2460.playerUpdates[id].heading;
		document.getElementById('playerUpdateItemBody').innerHTML=replaceMissionConstants(ad2460.playerUpdates[id].body);
		document.getElementById('playerUpdateItemTimestamp').innerHTML=ad2460.playerUpdates[id].timestamp;
		document.getElementById('playerUpdateItemContainer').setAttribute('onclick',ad2460.playerUpdates[id].onclick);
		if (ad2460.playerUpdates[id].image_id==9){
			if (ad2460.playerUpdates[id].heading=='Bank-attack'){
				document.getElementById('playerUpdateItemImage').src='images/planets/notification/notify_bank.jpg';
			}
			else if (ad2460.playerUpdates[id].heading=='Station-attack'){
				document.getElementById('playerUpdateItemImage').src='images/planets/notification/notify_station_attack.jpg';  
			}
			else {
				document.getElementById('playerUpdateItemImage').src=ad2460.playerUpdatesImages[ad2460.playerUpdates[id].image_id];
			}
		}
		else {
			document.getElementById('playerUpdateItemImage').src=ad2460.playerUpdatesImages[ad2460.playerUpdates[id].image_id];
		}
		ad2460.selectedPlayerUpdate=id;
		$("#latest_update_counter").html(Math.round(ad2460.selectedPlayerUpdate+1)+'/'+ad2460.playerUpdates.length);
	} else {
		document.getElementById('playerUpdateItemHeader').innerHTML='';
		document.getElementById('playerUpdateItemBody').innerHTML='';
		document.getElementById('playerUpdateItemTimestamp').innerHTML='';
		document.getElementById('playerUpdateItemContainer').setAttribute('onclick',undefined);
		document.getElementById('playerUpdateItemImage').src='images/fixed/spacer.gif';
		ad2460.selectedPlayerUpdate=undefined;
		$("#latest_update_counter").html('No news');
	}
   
	checkPlayerUpdateNaviButtons();
}

function checkPlayerUpdateNaviButtons(){
	var current=ad2460.selectedPlayerUpdate;
	var first=0;
	var last=ad2460.playerUpdates.length;

	if (current>first){
		document.getElementById('player_update_next_button').src='images/icons/buttons/next_yes.png';
	}
	else {
		document.getElementById('player_update_next_button').src='images/icons/buttons/next_no.png';
	}

	if (current<last-1){
		document.getElementById('player_update_previous_button').src='images/icons/buttons/prev_yes.png';
	}
	else {
		document.getElementById('player_update_previous_button').src='images/icons/buttons/prev_no.png';
	}
}

function selectLatestPlayerUpdate(){
	selectPlayerUpdate(ad2460.playerUpdates.length-1);
}

function nextPlayerUpdateClick(){
	// Check that we are not on the last one before doing anything
	if (ad2460.selectedPlayerUpdate<ad2460.playerUpdates.length-1){
		selectPlayerUpdate(ad2460.selectedPlayerUpdate+1);
	}

}
function previousPlayerUpdateClick(){
	if (ad2460.selectedPlayerUpdate >0 || ad2460.playerUpdates.length == 0){
		selectPlayerUpdate(ad2460.selectedPlayerUpdate-1);	
	}
}

function deletePlayerUpdate(news_id){
	var deleteSlot=-1;
	for (var i=ad2460.playerUpdates.length-1;i>=0 ;i-- ){
		if (ad2460.playerUpdates[i].news_id==news_id){
			ad2460.playerUpdates.splice(i,1);
			deleteSlot=i;
			$.post('actionhandler.pl', {action:'delete_player_update',news_id:news_id}, function(data){ parseInfo(data);});
			$("#fullnews_"+news_id).remove();
		}
	}
	previousPlayerUpdateClick();
}

function deletePlayerUpdateType(image_id){
	// delete all items of a certain type, triggered by a right-click!
	ad2460.playerUpdates=ad2460.playerUpdates.filter(function(entry){ return entry.image_id != image_id });
	unrenderFullNews();
	renderFullNews();
	$.post('actionhandler.pl', {action:'delete_player_update_by_type',image_id:image_id}, function(data){ 
		parseInfo(data);
		selectLatestPlayerUpdate();
	});
}
// Object definitions
function development(name, id , h_cost , i_cost , s_cost , n_cost , time_cost , credit_cost , required_facility_id , required_research_id , required_development_id , required_tech_tree_points , required_points_tree , special_requirement , bonus_description , description , user_id , development_id , start_time , end_time , upgrading){
	this.name=name;
	this.id=id;
	this.h_cost=h_cost;
	this.i_cost=i_cost;
	this.s_cost=s_cost;
	this.n_cost=n_cost;
	this.time_cost=time_cost;
	this.credit_cost=credit_cost;
	this.required_facility_id=required_facility_id;
	this.required_research_id=required_research_id;
	this.required_development_id=required_development_id;
	this.required_tech_tree_points=required_tech_tree_points;
	this.required_points_tree=required_points_tree;
	this.special_requirement=special_requirement;
	this.bonus_description=bonus_description;
	this.description=description;
	this.user_id=user_id;
	this.development_id=development_id;
	this.start_time=start_time;
	this.end_time=end_time;
	this.upgrading=upgrading;
}

function facility(name, shortname, id , h_cost , i_cost , s_cost , n_cost , time_cost , credit_cost , required_facility_id , required_research_id , required_development_id , required_tech_tree_points , required_points_tree , special_requirement , bonus_description , description , user_id , facility_id , start_time , end_time , upgrading, parent_id, level, upgradable, addon_group, building_id){
	this.name=name;
	this.shortname=shortname;
	this.id=id;
	this.h_cost=h_cost;
	this.i_cost=i_cost;
	this.s_cost=s_cost;
	this.n_cost=n_cost;
	this.time_cost=time_cost;
	this.credit_cost=credit_cost;
	this.required_facility_id=required_facility_id;
	this.required_research_id=required_research_id;
	this.required_development_id=required_development_id;
	this.required_tech_tree_points=required_tech_tree_points;
	this.required_points_tree=required_points_tree;
	this.special_requirement=special_requirement;
	this.bonus_description=bonus_description;
	this.description=description;
	this.user_id=user_id;
	this.facility_id=facility_id;
	this.start_time=start_time;
	this.end_time=end_time;
	this.upgrading=upgrading;
	this.parent_id=parent_id;
	this.level=level;
	this.upgradable=upgradable;
	this.addon_group=addon_group;
	this.building_id=building_id;
}

function research(name, id , h_cost , i_cost , s_cost , n_cost , time_cost , credit_cost , required_facility_id , required_research_id , required_development_id , required_tech_tree_points , required_points_tree , special_requirement , bonus_description , description , user_id , research_id , start_time , end_time , upgrading){
	this.name=name;
	this.id=id;
	this.h_cost=h_cost;
	this.i_cost=i_cost;
	this.s_cost=s_cost;
	this.n_cost=n_cost;
	this.time_cost=time_cost;
	this.credit_cost=credit_cost;
	this.required_facility_id=required_facility_id;
	this.required_research_id=required_research_id;
	this.required_development_id=required_development_id;
	this.required_tech_tree_points=required_tech_tree_points;
	this.required_points_tree=required_points_tree;
	this.special_requirement=special_requirement;
	this.bonus_description=bonus_description;
	this.description=description;
	this.user_id=user_id;
	this.research_id=research_id;
	this.start_time=start_time;
	this.end_time=end_time;
	this.upgrading=upgrading;
}

function forum(forum_id,name){
	this.forum_id=forum_id;
	this.name=name;
}

function thread(thread_id, forum_id, subject, post_count, created_by_user_id, created_by_nickname, last_post_by_user_id, last_post_by_nickname, last_post_time, last_post_time_string, last_post_id, icon, marked_for_delete, visible, mod_lvl_to_read, sticky){
	this.thread_id=thread_id;
	this.forum_id=forum_id;
	this.subject=remove_nastyness(subject);
	this.post_count=post_count;
	this.created_by_user_id=created_by_user_id;
	this.created_by_nickname=created_by_nickname;
	this.last_post_by_user_id=last_post_by_user_id;
	this.last_post_by_nickname=last_post_by_nickname;
	this.last_post_time=last_post_time;
	this.last_post_time_string=last_post_time_string;
	this.last_post_id=last_post_id;
	this.icon=icon;
	this.marked_for_delete=marked_for_delete;
	this.visible=visible;
	this.mod_lvl_to_read=mod_lvl_to_read;
	this.sticky=sticky;

}

function post(post_id, thread_id, posted_by_user_id, posted_by_nickname, posted_time, posted_time_string, body, hidden, avatar, vip_icon){
	this.post_id=post_id;
	this.thread_id=thread_id;
	this.posted_by_user_id=posted_by_user_id;
	this.posted_by_nickname=posted_by_nickname;
	this.posted_time=posted_time;
	this.posted_time_string=posted_time_string;
	this.body=remove_nastyness(body);
	this.hidden=hidden;
	this.avatar=avatar;
	this.vip_icon=vip_icon;
}

// Incomplete objects

function ship(id, name, vesselclass , vesseltype, h_cost, i_cost, s_cost, n_cost, time_cost, credit_cost, required_facility_id, required_research_id, required_development_id, required_tech_tree_points, required_points_tree, special_requirement, description, hullstrength, hullshield, shieldtype, shieldstrength, shieldrecharge, primary_weapontype, primary_weaponstrength, primary_weaponspeed, primary_guns, primary_rateoffire, primary_crit_chance, primary_range, secondary_weapontype, secondary_weaponstrength, secondary_weaponspeed, secondary_guns, secondary_rateoffire,	secondary_crit_chance, secondary_range, tertiary_weapontype, tertiary_weaponstrength, tertiary_weaponspeed, tertiary_guns, tertiary_rateoffire,	tertiary_crit_chance, tertiary_range, repair_ability, cargo_capacity, hangar_capacity, jump_range, primary_special_effect_id, secondary_special_effect_id, maneuverability, h_upkeep_cost, i_upkeep_cost, s_upkeep_cost, n_upkeep_cost, volatility, tech){
	this.id=id; 		
	this.name=name;			
	this.vesselclass=vesselclass; 	
	this.vesseltype=vesseltype;
	
	this.h_cost=h_cost; 
	this.i_cost=i_cost; 	
	this.s_cost=s_cost; 			
	this.n_cost=n_cost; 	
	this.time_cost=time_cost; 	
	this.credit_cost=credit_cost;

	this.required_facility_id=required_facility_id;
	this.required_research_id=required_research_id;
	this.required_development_id=required_development_id;
	this.required_tech_tree_points=required_tech_tree_points;
	this.required_points_tree=required_points_tree;
	this.special_requirement=special_requirement;
	this.description=description;
	this.hullstrength=hullstrength;
	this.hullshield=hullshield;
	this.shieldtype=shieldtype;
	this.shieldstrength=shieldstrength;
	this.shieldrecharge=shieldrecharge;

	this.primary_weapontype=primary_weapontype;
	this.primary_weaponstrength=primary_weaponstrength;
	this.primary_weaponspeed=primary_weaponspeed;
	this.primary_guns=primary_guns;
	this.primary_rateoffire=primary_rateoffire;
	this.primary_crit_chance=primary_crit_chance;
	this.primary_range=primary_range;
	
	this.secondary_weapontype=secondary_weapontype;
	this.secondary_weaponstrength=secondary_weaponstrength;
	this.secondary_weaponspeed=secondary_weaponspeed;
	this.secondary_guns=secondary_guns;
	this.secondary_rateoffire=secondary_rateoffire;
	this.secondary_crit_chance=secondary_crit_chance;
	this.secondary_range=secondary_range;
	
	this.tertiary_weapontype=tertiary_weapontype;
	this.tertiary_weaponstrength=tertiary_weaponstrength;
	this.tertiary_weaponspeed=tertiary_weaponspeed;
	this.tertiary_guns=tertiary_guns;
	this.tertiary_rateoffire=tertiary_rateoffire;
	this.tertiary_crit_chance=tertiary_crit_chance;
	this.tertiary_range=tertiary_range;
	
	this.repair_ability=repair_ability;
	this.cargo_capacity=cargo_capacity;
	this.hangar_capacity=hangar_capacity;
	this.jump_range=jump_range;
	this.primary_special_effect_id=primary_special_effect_id;
	this.secondary_special_effect_id=secondary_special_effect_id;
	this.maneuverability=maneuverability;
	this.h_upkeep_cost=h_upkeep_cost; 	
	this.i_upkeep_cost=i_upkeep_cost; 	
	this.s_upkeep_cost=s_upkeep_cost; 	
	this.n_upkeep_cost=n_upkeep_cost;
	this.volatility=volatility;
	this.tech=tech;

	this.user_id=0;


}

function defense(id, name, vesselclass , vesseltype, h_cost, i_cost, s_cost, n_cost, time_cost, credit_cost, required_facility_id, required_research_id, required_development_id, required_tech_tree_points, required_points_tree, special_requirement, description, hullstrength, hullshield, shieldtype, shieldstrength, shieldrecharge, primary_weapontype, primary_weaponstrength, primary_weaponspeed, primary_guns, primary_rateoffire, primary_crit_chance, primary_range, secondary_weapontype, secondary_weaponstrength, secondary_weaponspeed, secondary_guns, secondary_rateoffire,	secondary_crit_chance, secondary_range, tertiary_weapontype, tertiary_weaponstrength, tertiary_weaponspeed, tertiary_guns, tertiary_rateoffire,	tertiary_crit_chance, tertiary_range, repair_ability, cargo_capacity, hangar_capacity, jump_range, primary_special_effect_id, secondary_special_effect_id, maneuverability, h_upkeep_cost, i_upkeep_cost, s_upkeep_cost, n_upkeep_cost, volatility, tech){
	this.id=id; 		
	this.name=name;			
	this.vesselclass=vesselclass; 	
	this.vesseltype=vesseltype;
	
	this.h_cost=h_cost; 
	this.i_cost=i_cost; 	
	this.s_cost=s_cost; 			
	this.n_cost=n_cost; 	
	this.time_cost=time_cost; 	
	this.credit_cost=credit_cost;

	this.required_facility_id=required_facility_id;
	this.required_research_id=required_research_id;
	this.required_development_id=required_development_id;
	this.required_tech_tree_points=required_tech_tree_points;
	this.required_points_tree=required_points_tree;
	this.special_requirement=special_requirement;
	this.description=description;
	this.hullstrength=hullstrength;
	this.hullshield=hullshield;
	this.shieldtype=shieldtype;
	this.shieldstrength=shieldstrength;
	this.shieldrecharge=shieldrecharge;

	this.primary_weapontype=primary_weapontype;
	this.primary_weaponstrength=primary_weaponstrength;
	this.primary_weaponspeed=primary_weaponspeed;
	this.primary_guns=primary_guns;
	this.primary_rateoffire=primary_rateoffire;
	this.primary_crit_chance=primary_crit_chance;
	this.primary_range=primary_range;
	
	this.secondary_weapontype=secondary_weapontype;
	this.secondary_weaponstrength=secondary_weaponstrength;
	this.secondary_weaponspeed=secondary_weaponspeed;
	this.secondary_guns=secondary_guns;
	this.secondary_rateoffire=secondary_rateoffire;
	this.secondary_crit_chance=secondary_crit_chance;
	this.secondary_range=secondary_range;
	
	this.tertiary_weapontype=tertiary_weapontype;
	this.tertiary_weaponstrength=tertiary_weaponstrength;
	this.tertiary_weaponspeed=tertiary_weaponspeed;
	this.tertiary_guns=tertiary_guns;
	this.tertiary_rateoffire=tertiary_rateoffire;
	this.tertiary_crit_chance=tertiary_crit_chance;
	this.tertiary_range=tertiary_range;
	
	this.repair_ability=repair_ability;
	this.cargo_capacity=cargo_capacity;
	this.hangar_capacity=hangar_capacity;
	this.jump_range=jump_range;
	this.primary_special_effect_id=primary_special_effect_id;
	this.secondary_special_effect_id=secondary_special_effect_id;
	this.maneuverability=maneuverability;
	this.h_upkeep_cost=h_upkeep_cost; 	
	this.i_upkeep_cost=i_upkeep_cost; 	
	this.s_upkeep_cost=s_upkeep_cost; 	
	this.n_upkeep_cost=n_upkeep_cost;
	this.volatility=volatility;
	this.tech=tech;
	this.user_id=0;
}


function productionQueueItem(id, time, finish_time, priority, h_cost, n_cost, s_cost, i_cost, queue_id, building, est_build_time){
	this.id=id;
	this.start_time=time;
	this.finish_time=finish_time;
	this.priority=priority;
	this.h_cost=h_cost;
	this.s_cost=s_cost;
	this.n_cost=n_cost;
	this.i_cost=i_cost;
	this.queue_id=queue_id;
	this.building=building;
	this.est_build_time=est_build_time;
}

function shortCoords(x,y){
	this.x=x;
	this.y=y;
}

function longCoords(quadrant,sector,cluster,system,position){
	this.quadrant=qudrant;
	this.sector=sector;
	this.cluster=cluster;
	this.system=system;
	this.position=position;
}

function fleet(fleet_id, owner_id, fleet_name, commander_id, shipcount, strength, battles , wins,  losses, efficiency, shortage, current_x,current_y, org_mission_target_type,org_mission_target, org_mission_target_x, org_mission_target_y, org_mission_type, current_mission_target_type, current_mission_target, current_mission_target_x, current_mission_target_y, current_mission_type, next_mission_target_type, next_mission_target, next_mission_target_x, next_mission_target_y, next_mission_type, next_hyperspace_jump_time, last_hyperspace_jump_time, jump_range,mission_status,status,homeworld_fleet,storage_fleet,location_string,alliance_fleet,on_mission,upkeep_hassium, upkeep_neodymium, upkeep_strontium, upkeep_indium, eta, total_firepower, total_hull, auto_def, bank_fleet, fleet_alliance_id){
	this.fleet_id=fleet_id;
	this.owner_id=owner_id;
	this.fleet_name=fleet_name;
	this.commander_id=commander_id;
	this.shipcount=shipcount;
	this.strength=strength;
	this.battles=battles;
	this.wins=wins;
	this.losses=losses;
	this.efficiency=efficiency;
	this.shortage=shortage;
	this.current_x=current_x;
	this.current_y=current_y;
	
	this.org_mission_target_type=org_mission_target_type;
	this.org_mission_target=org_mission_target;
	this.org_mission_target_x=org_mission_target_x;
	this.org_mission_target_y=org_mission_target_y;
	this.org_mission_type=org_mission_type;
	
	this.current_mission_target_type=current_mission_target_type;
	this.current_mission_target=current_mission_target;
	this.current_mission_target_x=current_mission_target_x;
	this.current_mission_target_y=current_mission_target_y;
	this.current_mission_type=current_mission_type;

	this.next_mission_target_type=next_mission_target_type;
	this.next_mission_target=next_mission_target;
	this.next_mission_target_x=next_mission_target_x;
	this.next_mission_target_y=next_mission_target_y;
	this.next_mission_type=next_mission_type;

	this.next_hyperspace_jump_time=next_hyperspace_jump_time;
	this.last_hyperspace_jump_time=last_hyperspace_jump_time;
	this.jump_range=jump_range;
	this.mission_status=mission_status;
	this.status=status;
	this.homeworld_fleet=homeworld_fleet;
	this.storage_fleet=storage_fleet;
	this.ships=new Array;
	this.commander={};
	this.tactics={};
	this.location_string=location_string;
	this.alliance_fleet=alliance_fleet;
	this.on_mission=on_mission;
	this.upkeep={};
	this.upkeep.hassium=upkeep_hassium;
	this.upkeep.neodymium=upkeep_neodymium;
	this.upkeep.strontium=upkeep_strontium;
	this.upkeep.indium=upkeep_indium;

	this.eta=eta;

	this.total_firepower=total_firepower;
	this.total_hull=total_hull;

	this.auto_def=auto_def;

	this.sortstrength=this.strength;
	if(this.homeworld_fleet>0){
		this.sortstrength=1000000;
	}
	if (this.commander_id==0 && this.homeworld_fleet==0){
		this.sortstrength=0-10000+this.strength;
	}
	if (this.auto_def==1){
		this.sortstrength=0-250000+this.strength;
	}


	this.log=new Array;

	this.bank_fleet=bank_fleet;
	this.fleet_alliance_id=fleet_alliance_id;

	this.type='Normal';
	if (this.owner_id==0 && this.homeworld_fleet==1){
		// this has to be a station-fleet I think
		this.type='Station';
	}
	if (this.owner_id==ad2460.user_id && this.auto_def==1){
		// this has to be a op-fleet I think
		this.type='Outpost';
	}
	if (this.bank_fleet==true){
		this.type='Bank';
	}


}

function shipEntry(unique_id, fleet_id, ship_type_id, hullstrength, h_cargo, i_cargo, s_cargo, n_cargo, docked_401, docked_402, docked_403, docked_404, docked_405, docked_406, docked_407, docked_408, docked_409, docked_410, relative_strength){
	this.unique_id=unique_id;
	this.fleet_id=fleet_id;
	this.ship_type_id=ship_type_id;
	this.hullstrength=hullstrength;
	this.h_cargo=h_cargo;
	this.i_cargo=i_cargo;
	this.s_cargo=s_cargo;
	this.n_cargo=n_cargo;
	this.docked_401=docked_401;
	this.docked_402=docked_402;
	this.docked_403=docked_403;
	this.docked_404=docked_404;
	this.docked_405=docked_405;
	this.docked_406=docked_406;
	this.docked_407=docked_407;
	this.docked_408=docked_408;
	this.docked_409=docked_409;
	this.docked_410=docked_410;
	this.relative_strength=relative_strength;

	var prodItem=returnProductionItem(ship_type_id);

	this.max_hullstrength=prodItem.hullstrength;

	var bonusObj=returnUnitBonuses(ship_type_id);
	this.max_hullstrength+=bonusObj.hullBonus;
	
	this.max_hangar_capacity=prodItem.hangar_capacity;
	this.spent_hangar_capacity=calculateDockedCapacityPoint(this);
}


function fleetRenderObject(ship_type_id,name){
	// renderobjects are the visible boxes
	// On our first pass, we build this structure with the required data
	// Each entry in this array must hold
	// ship_type_id, name, 
	// ships_over_80_percent, ships_over_60_percent,ships_over_40_percent,ships_over_20_percent,ships_over_0_percent, 
	// firepower, shields, hull, hangarspace / current used hangarspace,

	this.ship_type_id=ship_type_id;
	this.name=name;
	this.shipcount=0;
	this.ships_over_80_percent=0;
	this.ships_over_60_percent=0;
	this.ships_over_40_percent=0;
	this.ships_over_20_percent=0;
	this.ships_over_0_percent=0;
	this.firepower=returnFirepower(ship_type_id);
	this.shieldstrength=returnShieldstrength(ship_type_id);
	this.hullstrength=returnHullstrength(ship_type_id);
	this.hangar_capacity=0;
	this.used_hangar_capacity=0;
	this.minor_ships_percentage=0;
}

function Storage(ship_type_id,ships){
	this.ship_type_id=ship_type_id;
	this.counter=ships;
}

function ConversationUser(user_id, nickname, avatar){
	this.user_id=user_id;
	this.nickname=nickname;
	this.avatar=avatar;
}

function Conversation(conversation_id,last_update,user_1,user_2,blocked){
	this.conversation_id=conversation_id;
	this.last_update=last_update;
	this.user_1=user_1;
	this.user_2=user_2;
	this.blocked=blocked;
	this.messages=new Array;
	this.last_marked_as_read=0;
}

function ConversationMessage(msg_id, conversation_id, user_id, timestamp, body, unread){
	this.msg_id=msg_id;
	this.conversation_id=conversation_id;
	this.user_id=user_id;
	this.timestamp=timestamp;
	this.body=remove_nastyness(body);
	this.unread=unread;
}

function AllianceMember(user_id, name, rank_id, tag_id, score, strength, level, xp, membership_time, homeworld_name, homeworld_id, outposts, alliance_fleet_ships, public_note, last_online, x , y, avatar, amnesty_until, asleep_until){
	this.user_id=user_id;
	this.name=name;
	this.rank=rank_id;
	this.tag_id=tag_id;
	this.tag=returnAllianceTag(tag_id);
	this.score=score;
	this.strength=strength;
	this.level=level;
	this.xp=xp;
	this.membership_time=membership_time;
	this.homeworld_name=homeworld_name;
	this.homeworld_id=homeworld_id;
	this.outposts=outposts;
	this.alliance_fleet_ships=alliance_fleet_ships;
	this.public_note=public_note;
	this.last_online=last_online;
	this.x=x;
	this.y=y;
	var coords=convertShortCoordsToLongCoords(x,y);
	this.quadrant=coords.q;
	this.sector=coords.s;
	this.cluster=coords.g;
	this.system=coords.o;
	this.position=coords.p;
	this.avatar=avatar;

	this.amnesty_until=amnesty_until;
	this.asleep_until=asleep_until;

	this.allianceFleets=new Array;
}

function AllianceInvitedMember(user_id, name, invite_timestamp){
	this.user_id=user_id;
	this.name=name;
	this.invite_timestamp=invite_timestamp;

}

function AllianceInvitations(alliance_id, alliance_name, invite_timestamp){
	this.alliance_id=alliance_id;
	this.name=alliance_name;
	this.invite_timestamp=invite_timestamp;
	
}

function Chatmessage(user_id, admin_status, nick, timestamp, message, vip_status, vip_icon, chat_color_class){
	this.user_id=user_id;
	this.admin_status=admin_status;
	this.nick=nick;
	this.timestamp=timestamp;
	this.message=message;
	this.vip_status=vip_status;
	this.vip_icon=vip_icon;
	this.chat_color_class=chat_color_class;
	this.rendered=0;
}

function feedbackQueueEntry(header, body, imageId){
	this.header=header;
	this.body=body;
	this.imageId=imageId;
}

function bankLogEntry(user_id,nickname,transaction_type,hassium,neodymium,strontium,indium,timestamp,target_user_id, target_nickname){
	this.user_id=user_id;
	this.nickname=nickname;
	this.transaction_type=transaction_type;
	this.hassium=hassium;
	this.neodymium=neodymium;
	this.strontium=strontium;
	this.indium=indium;
	this.timestamp=timestamp;
	this.target_user_id=target_user_id;
	this.target_nickname=target_nickname;
}

function allianceProject(name, id, group_id, level, h_cost, i_cost, s_cost, n_cost, time_cost, credit_cost, required_facility_id, required_research_id, required_development_id, required_tech_tree_points, required_points_tree, special_requirement, member_requirement, bonus_description, description, bonus_flag_id, alliance_id, project_id, start_time, end_time, upgrading ){
	this.name=name;
	this.id=id;
	this.group_id=group_id;
	this.level=level;
	this.h_cost=h_cost;
	this.i_cost=i_cost;
	this.s_cost=s_cost;
	this.n_cost=n_cost;
	this.time_cost=time_cost;
	this.credit_cost=credit_cost;
	this.required_facility_id=required_facility_id;
	this.required_research_id=required_research_id;
	this.required_development_id=required_development_id;
	this.required_tech_tree_points=required_tech_tree_points;
	this.required_points_tree=required_points_tree;
	this.special_requirement=special_requirement;
	this.member_requirement=member_requirement;
	this.bonus_description=bonus_description;
	this.description=description;
	this.bonus_flag_id=bonus_flag_id;
	this.alliance_id=alliance_id;
	this.project_id=project_id;
	this.start_time=start_time;
	this.end_time=end_time;
	this.upgrading=upgrading; 	
}

function Trade(trade_id, user_id, from_res_id, to_res_id, amount, timestamp, nickname){
	this.trade_id=trade_id;
	this.user_id=user_id;
	this.from_res_id=from_res_id;
	this.to_res_id=to_res_id;
	this.amount=amount;
	this.timestamp=timestamp;
	this.nickname=nickname;
}

function Quadrant(quadrant_id, quadrant_local_id, quadrant_name, last_fetch){
	this.quadrant_id=quadrant_id;
	this.quadrant_local_id=quadrant_local_id;
	this.quadrant_name=quadrant_name;
	this.sectors=new Array;
	this.topAlliances=new Array;
	this.topPlayers=new Array;
	this.last_fetch=last_fetch;
}

function Sector(sector_id, sector_local_id, quadrant_id, last_fetch, sector_name, bonus_type, s_ctrl_a_id, main_station_cluster_local_id){
	this.sector_id=sector_id;
	this.sector_local_id=sector_local_id;
	this.quadrant_id=quadrant_id;
	this.topAlliances=new Array;
	this.topPlayers=new Array;
	this.clusters=new Array;
	this.last_fetch=last_fetch;
	this.sector_name=sector_name;
	this.bonus_type=bonus_type;
	this.s_ctrl_a_id=s_ctrl_a_id;
	this.main_station_cluster_local_id=main_station_cluster_local_id;
}

function Cluster( cluster_id, cluster_local_id, sector_id, last_fetch, prospected, prospecting, c_ctrl_a_id){
	this.cluster_id=cluster_id;
	this.cluster_local_id=cluster_local_id;
	this.sector_id=sector_id;
	this.topAlliances=new Array;
	this.topPlayers=new Array;
	this.systems=new Array;
	this.last_fetch=last_fetch;
	this.prospected=prospected;
	this.prospecting=prospecting;
	this.c_ctrl_a_id=c_ctrl_a_id;
}

function System(quadrant_id, sector_id, cluster_id, system_id, quadrant_local_id, sector_local_id, cluster_local_id, system_local_id, occupied_habitable_planets, locked, system_type, last_fetch){
	this.quadrant_id=quadrant_id;
	this.sector_id=sector_id;
	this.cluster_id=cluster_id;
	this.system_id=system_id;
	this.quadrant_local_id=quadrant_local_id;
	this.sector_local_id=sector_local_id;
	this.cluster_local_id=cluster_local_id;
	this.system_local_id=system_local_id;
	this.occupied_habitable_planets=occupied_habitable_planets;
	this.locked=locked;
	this.system_type=system_type;
	this.last_fetch=last_fetch;
	this.planets=new Array;

}

function Planet(planet_id, planet_name, owner_id, x, y, habitable, world_type, quadrant, sector, cluster, system, position, nickname, alliance_id, alliance_name, player_rank ,alliance_rank, resource_tilt, output_potential, avatar, score, strength, player_level, asleep_until, amnesty_until, closed, inactive, planet_grace, outpost_level){
	this.planet_id=planet_id;
	this.planet_name=planet_name;
	this.owner_id=owner_id;
	this.x=x;
	this.y=y;
	this.habitable=habitable;
	this.world_type=world_type;
	this.quadrant=quadrant;
	this.sector=sector;
	this.cluster=cluster;
	this.system=system;
	this.position=position;
	this.nickname=nickname;
	this.alliance_id=alliance_id;
	this.alliance_name=alliance_name;
	this.player_rank=player_rank;
	this.alliance_rank=alliance_rank;
	this.resource_tilt=resource_tilt;
	this.output_potential=output_potential;
	this.avatar=avatar;
	this.score=score;
	this.strength=strength;
	this.player_level=player_level;
	this.asleep_until=asleep_until;
	this.amnesty_until=amnesty_until;
	this.closed=closed;
	this.inactive=inactive;
	this.planet_grace=planet_grace;
	this.outpost_level=outpost_level;

}

function playerStarmapRankEntry(rank, nickname, user_id, score, quadrant, sector, cluster, system, position, homeworld_id){
	this.rank=rank;
	this.nickname=nickname;
	this.user_id=user_id;
	this.score=score;
	this.quadrant=quadrant;
	this.sector=sector;
	this.cluster=cluster;
	this.system=system;
	this.position=position;
	this.homeworld_id=homeworld_id;
	var coords=convertLongCoordsToShortCoords(quadrant,sector,cluster,system,position);
	this.x=coords.x;
	this.y=coords.y;
}
function allianceStarmapRankEntry(id, rank, name, score){
	this.id=id;
	this.rank=rank;
	this.name=name;
	this.score=score;
}

function prospectingMission(quadrant, sector, cluster, cluster_id, complete_time, start_time){
	this.quadrant=quadrant;
	this.sector=sector;
	this.cluster=cluster;
	this.cluster_id=cluster_id;
	this.complete_time=complete_time;
	this.start_time=start_time;
}

function prospectedCluster(quadrant, sector, cluster,complete_time){
	this.quadrant=quadrant;
	this.sector=sector;
	this.cluster=cluster;
	this.complete_time=complete_time;
}

function lostOutpost(planet_id, x, y, world_type,name, max_output_hassium, max_output_neodymium, max_output_strontium, max_output_indium, lost_time, new_owner_id, new_owner_name, new_owner_alliance_id, new_owner_alliance_name, taker_id, taker_name, taker_alliance_id, taker_alliance_name){
	this.planet_id=planet_id;
	this.x=x;
	this.y=y;
	
	var thisLocation=convertShortCoordsToLongCoords(x,y);
	this.quadrant=thisLocation.q;
	this.sector=thisLocation.s;
	this.cluster=thisLocation.g;
	this.system=thisLocation.o;
	this.position=thisLocation.p;

	this.world_type=world_type;
	this.name=name;

	this.max_output_hassium=max_output_hassium;
	this.max_output_neodymium=max_output_neodymium;
	this.max_output_strontium=max_output_strontium;
	this.max_output_indium=max_output_indium;

	this.lost_time=lost_time;

	this.new_owner_id=new_owner_id;
	this.new_owner_name=new_owner_name;
	this.new_owner_alliance_id=new_owner_alliance_id;
	this.new_owner_alliance_name=new_owner_alliance_name;

	this.taker_id=taker_id;
	this.taker_name=taker_name;
	this.taker_alliance_id=taker_alliance_id;
	this.taker_alliance_name=taker_alliance_name;

	this.returnTransportTime=function(){
		var transportTime=calcEta(this.x, this.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, true, false );
		return transportTime;
	}

	this.returnPotential=function(){
		var potential=return_output_potential(this.max_output_hassium+this.max_output_neodymium+this.max_output_strontium+this.max_output_indium);
		return potential;
	}


}

function Outpost(planet_id, x, y, level, world_type, name, stored_hassium, stored_neodymium, stored_strontium, stored_indium, current_output_hassium,  current_output_neodymium,  current_output_strontium,  current_output_indium, upgrading, upgrade_complete_timestamp, upgrade_started_timestamp, max_output_hassium,  max_output_neodymium,  max_output_strontium,  max_output_indium, call_for_def, auto_col_percent, auto_col_enabled, inactive, last_owner_change_time, planet_grace){
	this.planet_id=planet_id;
	this.x=x;
	this.y=y;
	
	var thisLocation=convertShortCoordsToLongCoords(x,y);
	this.quadrant=thisLocation.q;
	this.sector=thisLocation.s;
	this.cluster=thisLocation.g;
	this.system=thisLocation.o;
	this.position=thisLocation.p;

	this.planet_grace=planet_grace;

	this.level=level;
	this.world_type=world_type;
	this.name=name;
	this.stored_hassium=stored_hassium;
	this.stored_neodymium=stored_neodymium;
	this.stored_strontium=stored_strontium;
	this.stored_indium=stored_indium;
	this.current_output_hassium=current_output_hassium;
	this.current_output_neodymium=current_output_neodymium;
	this.current_output_strontium=current_output_strontium;
	this.current_output_indium=current_output_indium;
	this.upgrading=upgrading;
	this.upgrade_complete_timestamp=upgrade_complete_timestamp;
	this.upgrade_started_timestamp=upgrade_started_timestamp;

	this.max_output_hassium=max_output_hassium;
	this.max_output_neodymium=max_output_neodymium;
	this.max_output_strontium=max_output_strontium;
	this.max_output_indium=max_output_indium;

	this.call_for_def=call_for_def;
	this.auto_col_percent=auto_col_percent;
	this.auto_col_enabled=auto_col_enabled;
	this.inactive=inactive;

	this.last_owner_change_time=last_owner_change_time;
	
	this.returnFillPercent=function(){
		var total_stored=this.stored_hassium+this.stored_neodymium+this.stored_strontium+this.stored_indium;
		var max_storage=return_outpost_storage(this.level);
		var stored_percentage=Math.floor(total_stored*100/max_storage);
		return stored_percentage;
	}

	this.returnTransportTime=function(){
		var transportTime=calcEta(this.x, this.y, ad2460.homeworld.x, ad2460.homeworld.y, 1, true, false );
		return transportTime;
	}

	this.returnPotential=function(){
		var potential=return_output_potential(this.max_output_hassium+this.max_output_neodymium+this.max_output_strontium+this.max_output_indium);
		return potential;
	}

	this.returnMaxFleetStrength=function(){
		var maxStr=outpostOutputToMaxDefStrength(this.max_output_hassium+this.max_output_neodymium+this.max_output_strontium+this.max_output_indium);
		return maxStr;
	}
	this.returnRecommendedDefenseStrength=function(){
		var maxStr=outpostOutputToMaxDefStrength(this.max_output_hassium+this.max_output_neodymium+this.max_output_strontium+this.max_output_indium);
		var recommended=Math.ceil(maxStr/50*this.level);
		return recommended;
	}
	
	this.returnCommanderRank=function(){
		var potential=return_output_potential(this.max_output_hassium+this.max_output_neodymium+this.max_output_strontium+this.max_output_indium);
		return outpostPotentialToCommanderRank(potential);
	}
	this.returnTotalOutput=function(){
		var totalOutput=this.current_output_hassium+this.current_output_neodymium+this.current_output_strontium+this.current_output_indium;
		return totalOutput;
	}

	this.returnPresentStrength=function(){
		var str=0;
		for (var f=0;f<ad2460.myFleets.length ;f++ ){
			if (ad2460.myFleets[f].current_x==this.x && ad2460.myFleets[f].current_y==this.y){
				str+=ad2460.myFleets[f].strength;
			}
		}
		
		return str;
	}

}

function AllianceCacheEntry(alliance_id, name, logo_url, alliance_information, score, strength, xp, score_rank, strength_rank, xp_rank, fetch_time ){
	this.alliance_id=alliance_id;
	this.name=name; 
	this.logo_url=logo_url;
	this.alliance_information=alliance_information;
	this.score=score;
	this.strength=strength;
	this.xp=xp;
	this.score_rank=score_rank;
	this.strength_rank=strength_rank;
	this.xp_rank=xp_rank;
	this.fetch_time=fetch_time;
	this.members=new Array;
}

function PublicAllianceMember(user_id, alliance_id, name, level, tag_string, score, strength, xp, score_rank, strength_rank, xp_rank, homeworld_name, homeworld_id, x, y, avatar){
	this.user_id=user_id;
	this.name=name;
	this.level=level;
	this.tag_string=tag_string;
	this.score=score;
	this.strength=strength;
	this.xp=xp;
	this.score_rank=score_rank;
	this.strength_rank=strength_rank;
	this.xp_rank=xp_rank;
	this.homeworld_name=homeworld_name;
	this.homeworld_id=homeworld_id;
	this.x=x;
	this.y=y;

	var thisLocation=convertShortCoordsToLongCoords(x,y);
	this.quadrant=thisLocation.q;
	this.sector=thisLocation.s;
	this.cluster=thisLocation.g;
	this.system=thisLocation.o;
	this.position=thisLocation.p;

	this.avatar=avatar;

}

// Hmmmm, consider this carefully.....Hmmm...
function cargoShip(ship){
	var ship_specs=returnUnit(ship.ship_type_id)
	this.unique_id=ship.unique_id;
	this.ship_type_id=ship.ship_type_id;
	this.h_cargo=ship.h_cargo;
	this.n_cargo=ship.n_cargo;
	this.s_cargo=ship.s_cargo;
	this.i_cargo=ship.i_cargo;
	this.cargo_capacity=returnCargoCapacity(ship.ship_type_id);
	// actually...here we can apply the cargo-capacity bonus right off the bat!
	var cargoBonusPercent=returnCargoCapacityBonusPercent();
	this.cargo_capacity+=Math.floor(this.cargo_capacity*cargoBonusPercent/100);
	this.count=1;
	this.jump_range=ship_specs.jump_range;
	this.name=ship_specs.name;
	this.hullstrength=ship.hullstrength;
}

function reassignmentOrder(ship_type_id, fromFleetId, fromFleetName, toFleetId, toFleetName, takeOnlySurplusFighters, toFleetType){
	this.shipIds=new Array;
	var i=0;
	for (i=0;i<ad2460.fleetvars.selectedFleetReassignArray.length ;i++ ){
		this.shipIds.push(ad2460.fleetvars.selectedFleetReassignArray[i]);
	}
	this.ship_type_id=ship_type_id;
	var prodItem=returnProductionItem(ship_type_id);
	this.ship_name=prodItem.name;
	this.ship_count=this.shipIds.length;
	this.fromFleetId=fromFleetId;
	this.fromFleetName=fromFleetName;
	this.toFleetId=toFleetId;
	this.toFleetName=toFleetName;
	this.takeOnlySurplusFighters=takeOnlySurplusFighters;
	this.id=Math.floor(Math.random()*9999987);
	this.toFleetType=toFleetType;

}

function commander(commander_id, owner_id, hired, name, personality, tactics, commanding, perception, morale, rank, experience, wins, losses, image_id, sex, fleet_id, missions, dead, uniform, points){
	this.commander_id=commander_id;
	this.owner_id=owner_id;
	this.hired=hired;
	this.name=name;
	this.personality=personality;
	this.tactics=tactics;
	this.commanding=commanding;
	this.perception=perception;
	this.morale=morale;
	this.rank=rank;
	this.experience=experience;
	this.wins=wins;
	this.losses=losses;
	this.image_id=image_id;
	this.sex=sex;
	this.fleet_id=fleet_id;
	this.missions=missions;
	this.dead=dead;
	this.uniform=uniform;
	this.points=points;

}

function intelMission(mission_id, user_id, type, initiate_timestamp, next_report_timestamp, planet_id, planet_name, planet_owner_id, planet_owner_alliance_id, detection_chance, owner_name, x, y, world_type){
	this.mission_id=mission_id;
	this.user_id=user_id;
	this.type=type;
	this.initiate_timestamp=initiate_timestamp;
	this.next_report_timestamp=next_report_timestamp;
	this.planet_id=planet_id;
	this.planet_name=planet_name;
	this.planet_owner_id=planet_owner_id;
	this.planet_owner_alliance_id=planet_owner_alliance_id;
	this.detection_chance=detection_chance;
	this.owner_name=owner_name;
	this.x=x;
	this.y=y;
	this.world_type=world_type;

}

function intelReport(report_id, mission_id, type, timestamp, user_id, user_alliance_id, planet_id, planet_name, planet_x, planet_y, planet_owner_id, planet_owner_alliance_id, planet_owner_alliance_name, planet_owner_name, planet_owner_homeworld_name, planet_owner_homeworld_x, planet_owner_homeworld_y, strength_present, fleets_present, stored_hassium, stored_strontium, stored_neodymium, stored_indium, world_type, outpost_level,			present_frigates, present_cruisers, present_battleships, present_carriers, present_minors, present_cannons, present_artillery, present_stations, owned_frigates, owned_cruisers, owned_battleships, owned_carriers, owned_minors, owned_cannons, owned_artillery, owned_stations, owned_artifacts, owned_strength, owned_fleets, player_level, outposts, tech_tilt, alliance_bankers, alliance_bank_hassium, alliance_bank_indium, alliance_bank_strontium, alliance_bank_neodymium, last_5_combats, score_rank, total_output, present_shieldgens, owned_shieldgens){
	this.report_id=report_id;
	this.mission_id=mission_id;
	this.type=type;
	this.timestamp=timestamp;
	this.user_id=user_id;
	this.user_alliance_id=user_alliance_id;
	this.planet_id=planet_id;
	this.planet_name=planet_name;
	this.planet_x=planet_x;
	this.planet_y=planet_y;
	this.planet_owner_id=planet_owner_id;
	this.planet_owner_alliance_id=planet_owner_alliance_id;
	this.planet_owner_alliance_name=planet_owner_alliance_name;
	this.planet_owner_name=planet_owner_name;
	this.planet_owner_homeworld_name=planet_owner_homeworld_name;
	this.planet_owner_homeworld_x=planet_owner_homeworld_x;
	this.planet_owner_homeworld_y=planet_owner_homeworld_y;
	this.strength_present=strength_present;
	this.fleets_present=fleets_present;
	this.stored_hassium=stored_hassium;
	this.stored_strontium=stored_strontium;
	this.stored_neodymium=stored_neodymium;
	this.stored_indium=stored_indium;
	this.world_type=world_type;
	this.outpost_level=outpost_level;
	this.present_frigates=present_frigates;
	this.present_cruisers=present_cruisers;
	this.present_battleships=present_battleships;
	this.present_carriers=present_carriers;
	this.present_minors=present_minors;
	this.present_cannons=present_cannons;
	this.present_artillery=present_artillery;
	this.present_stations=present_stations;
	this.owned_frigates=owned_frigates;
	this.owned_cruisers=owned_cruisers;
	this.owned_battleships=owned_battleships;
	this.owned_carriers=owned_carriers;
	this.owned_minors=owned_minors;
	this.owned_cannons=owned_cannons;
	this.owned_artillery=owned_artillery;
	this.owned_stations=owned_stations;
	this.owned_artifacts=owned_artifacts;
	this.owned_strength=owned_strength;
	this.owned_fleets=owned_fleets;
	this.player_level=player_level;
	this.outposts=outposts;
	this.tech_tilt=tech_tilt;
	this.alliance_bankers=alliance_bankers;
	this.alliance_bank_hassium=alliance_bank_hassium;
	this.alliance_bank_indium=alliance_bank_indium;
	this.alliance_bank_strontium=alliance_bank_strontium;
	this.alliance_bank_neodymium=alliance_bank_neodymium;
	this.last_5_combats=last_5_combats;
	this.score_rank=score_rank;
	this.total_output=total_output;
	this.present_shieldgens=present_shieldgens;
	this.owned_shieldgens=owned_shieldgens;
}

function scoutMission(user_id, user_alliance_id, planet_id, planet_owner_id, planet_owner_alliance_id, timestamp, completed_timestamp, firepower_present, defense_present, capital_ships_present, stored_hassium, stored_strontium, stored_neodymium, stored_indium, outpost_level, current_output, resource_tilt, output_potential, completed, target_planet_name){
	this.user_id=user_id;
	this.user_alliance_id= user_alliance_id;
	this.planet_id= planet_id;
	this.planet_owner_id= planet_owner_id;
	this.planet_owner_alliance_id= planet_owner_alliance_id;
	this.timestamp= timestamp;
	this.completed_timestamp= completed_timestamp;
	this.firepower_present= firepower_present;
	this.defense_present= defense_present;
	this.capital_ships_present= capital_ships_present;
	this.stored_hassium= stored_hassium;
	this.stored_strontium= stored_strontium;
	this.stored_neodymium= stored_neodymium;
	this.stored_indium= stored_indium;
	this.outpost_level= outpost_level;
	this.current_output= current_output;
	this.resource_tilt= resource_tilt;
	this.output_potential= output_potential;
	this.completed= completed;
	this.target_planet_name=target_planet_name;
}

function espionageMission(user_id, user_alliance_id, planet_owner_id, capital_ships_owned , firepower_owned , defense_owned, top_commander_level , timestamp, completed_timestamp, outposts, completed, target_planet_name){
	this.user_id=user_id;
	this.user_alliance_id=user_alliance_id;
	this.planet_owner_id=planet_owner_id;
	this.capital_ships_owned=capital_ships_owned;
	this.firepower_owned=firepower_owned;
	this.defense_owned=defense_owned;
	this.top_commander_level=top_commander_level;
	this.timestamp=timestamp;
	this.completed_timestamp=completed_timestamp;
	this.outposts=outposts;
	this.completed=completed;
	this.target_planet_name=target_planet_name;
}

function techitem(id, name, description, tier, branch, required_spent_points_in_branch, max_points, icon_id, bonus_modifier_1, bonus_modifier_2, bonus_modifier_3, bonus_modifier_4, bonus_modifier_5, user_id, techitem_id, points){
	this.id=id;
	this.name=name;
	this.description=description;
	this.tier=tier;
	this.branch=branch;
	this.required_spent_points_in_branch=required_spent_points_in_branch;
	this.max_points=max_points;
	this.icon_id=icon_id;
	this.bonus_modifier_1=bonus_modifier_1;
	this.bonus_modifier_2=bonus_modifier_2;
	this.bonus_modifier_3=bonus_modifier_3;
	this.bonus_modifier_4=bonus_modifier_4;
	this.bonus_modifier_5=bonus_modifier_5;

	this.user_id=user_id;
	this.techitem_id=techitem_id;
	this.points=points;
	this.temp_points=0;

}

function tacticSetup(fleet_id, target_priority, target_switching, minimize_movement, fighter_priority, corvette_priority, retreat_percentage, retreat_type, retreat_if_even, retreat_if_unwinnable){
	this.fleet_id=fleet_id;
	this.target_priority=target_priority;
	this.target_switching=target_switching;
	this.minimize_movement=minimize_movement;
	this.fighter_priority=fighter_priority;
	this.corvette_priority=corvette_priority;
	this.retreat_percentage=retreat_percentage;
	this.retreat_type=retreat_type;
	this.retreat_if_even=retreat_if_even;
	this.retreat_if_unwinnable=retreat_if_unwinnable;
}

function combatLog(launch_id ,  launcher_id ,  target_type ,  target_id ,  target_org_owner_id ,  target_x ,  target_y , launch_time ,  last_update ,  att_org_ship_count ,  att_org_firepower ,  def_org_ship_count ,  def_org_firepower ,  combat_id ,  attacker_nickname ,  attacker_alliance_name ,  attacker_alliance_image ,  attacking_commander_name ,  attacking_commander_rank ,  attacking_commander_image_id ,  attacking_commander_sex ,  defender_nickname ,  defender_alliance_name ,  defender_alliance_image ,  defending_commander_name ,  defending_commander_rank ,  defending_commander_image_id ,  defending_commander_sex ,  location_name    ,  location_planet_type ,  attacking_fighters ,  attacking_corvettes ,  attacking_utility ,  attacking_transports ,  attacking_fleets ,  attacking_capital_ships ,  attacking_strength ,  defending_fighters ,  defending_corvettes ,  defending_utility ,  defending_transports ,  defending_fleets ,  defending_capital_ships ,  defending_strength ,  defending_flak ,  defending_artillery ,  defending_shield_gens ,  defending_battle_stations ,  attacking_frigates ,  attacking_cruisers ,  attacking_battleships ,  attacking_carriers ,  defending_frigates ,  defending_cruisers ,  defending_battleships ,  defending_carriers ,  duration ,  result ,  outpost_takeover ,  att_fighters_lost ,  att_corvettes_lost ,  att_frigates_lost ,  att_cruisers_lost ,  att_battleships_lost ,  att_carriers_lost ,  att_utlity_lost ,  att_transports_lost ,  def_fighters_lost ,  def_corvettes_lost ,  def_frigates_lost ,  def_cruisers_lost ,  def_battleships_lost ,  def_carriers_lost ,  def_utlity_lost ,  def_transports_lost ,  def_flak_lost ,  def_artillery_lost ,  def_shield_gens_lost ,  def_battle_stations_lost, alliance_launch, taken_h, taken_n, taken_s, taken_i, att_xp, def_xp, attacking_commander_uniform, defending_commander_uniform, view_id, bonus_res){
	//console.log(launch_id ,  launcher_id ,  target_type ,  target_id ,  target_org_owner_id ,  target_x ,  target_y , launch_time ,  last_update , combat_id ,  attacker_nickname ,  attacker_alliance_name , defender_nickname ,  defender_alliance_name ,  location_name ,  location_planet_type , attacking_strength, defending_strength , duration ,  result ,  outpost_takeover , alliance_launch);
	this.launch_id=launch_id;
	this.view_id=view_id;
	this.launcher_id=launcher_id;
	this.target_type=target_type;
	this.target_id=target_id;
	this.target_org_owner_id=target_org_owner_id;
	this.target_x=target_x;
	this.target_y=target_y;

	this.launch_time=launch_time;
	this.last_update=last_update;
	this.att_org_ship_count=att_org_ship_count;
	this.att_org_firepower=att_org_firepower;
	this.def_org_ship_count=def_org_ship_count;
	this.def_org_firepower=def_org_firepower;
	this.combat_id=combat_id;
	this.attacker_nickname=attacker_nickname;
	this.attacker_alliance_name=attacker_alliance_name;
	this.attacker_alliance_image=attacker_alliance_image;
	this.attacking_commander_name=attacking_commander_name;
	this.attacking_commander_rank=attacking_commander_rank;
	this.attacking_commander_image_id=attacking_commander_image_id;
	this.attacking_commander_sex=attacking_commander_sex;
	this.attacking_commander_uniform=attacking_commander_uniform;
	this.defender_nickname=defender_nickname;
	this.defender_alliance_name=defender_alliance_name;
	this.defender_alliance_image=defender_alliance_image;
	this.defending_commander_name=defending_commander_name;
	this.defending_commander_rank=defending_commander_rank;
	this.defending_commander_image_id=defending_commander_image_id;
	this.defending_commander_sex=defending_commander_sex;
	this.defending_commander_uniform=defending_commander_uniform;
	this.location_name=location_name;
	this.location_planet_type=location_planet_type;
	this.attacking_fighters=attacking_fighters;
	this.attacking_corvettes=attacking_corvettes;
	this.attacking_utility=attacking_utility;
	this.attacking_transports=attacking_transports;
	this.attacking_fleets=attacking_fleets;
	this.attacking_capital_ships=attacking_capital_ships;
	this.attacking_strength=attacking_strength;
	this.defending_fighters=defending_fighters;
	this.defending_corvettes=defending_corvettes;
	this.defending_utility=defending_utility;
	this.defending_transports=defending_transports;
	this.defending_fleets=defending_fleets;
	this.defending_capital_ships=defending_capital_ships;
	this.defending_strength=defending_strength;
	this.defending_flak=defending_flak;
	this.defending_artillery=defending_artillery;
	this.defending_shield_gens=defending_shield_gens;
	this.defending_battle_stations=defending_battle_stations;
	this.attacking_frigates=attacking_frigates;
	this.attacking_cruisers=attacking_cruisers;
	this.attacking_battleships=attacking_battleships;
	this.attacking_carriers=attacking_carriers;
	this.defending_frigates=defending_frigates;
	this.defending_cruisers=defending_cruisers;
	this.defending_battleships=defending_battleships;
	this.defending_carriers=defending_carriers;
	this.duration=duration;
	this.result=result;
	this.outpost_takeover=outpost_takeover;
	this.att_fighters_lost=att_fighters_lost;
	this.att_corvettes_lost=att_corvettes_lost;
	this.att_frigates_lost=att_frigates_lost;
	this.att_cruisers_lost=att_cruisers_lost;
	this.att_battleships_lost=att_battleships_lost;
	this.att_carriers_lost=att_carriers_lost;
	this.att_utlity_lost=att_utlity_lost;
	this.att_transports_lost=att_transports_lost;
	this.def_fighters_lost=def_fighters_lost;
	this.def_corvettes_lost=def_corvettes_lost;
	this.def_frigates_lost=def_frigates_lost;
	this.def_cruisers_lost=def_cruisers_lost;
	this.def_battleships_lost=def_battleships_lost;
	this.def_carriers_lost=def_carriers_lost;
	this.def_utlity_lost=def_utlity_lost;
	this.def_transports_lost=def_transports_lost;
	this.def_flak_lost=def_flak_lost;
	this.def_artillery_lost=def_artillery_lost;
	this.def_shield_gens_lost=def_shield_gens_lost;
	this.def_battle_stations_lost=def_battle_stations_lost;
	this.alliance_launch=alliance_launch;

	var coords=convertShortCoordsToLongCoords(target_x,target_y);
	this.quadrant=coords.q;
	this.sector=coords.s;
	this.cluster=coords.g;
	this.system=coords.o;
	this.position=coords.p;

	this.taken_h=taken_h;
	this.taken_i=taken_i;
	this.taken_s=taken_s;
	this.taken_n=taken_n;

	this.att_xp=att_xp;
	this.def_xp=def_xp;

	this.bonus_res=bonus_res;


}

function combatTurnData(combat_id, turn, events){
	this.combat_id=combat_id;
	this.turn=turn;
	this.events_raw=events;
	this.is_processed=false;
	this.events=new Array;
	var events_array=events.split("<br>"); // why not :)
	var i=0;
	for (i=0;i<events_array.length ;i++ ){
		// event_type::initiative::data (which must be interpreted based on it's type, params delimited by the pipe-symbol!)
		// 1::40::1300|3|50|100|1|1430
		var event_array=events_array[i].split("::"); 
		this.events.push({event_type:event_array[0], initiative:event_array[1], data:event_array[2]});
	}
}

function combatShip(unique_id, fleet_id, combat_id, turn, ship_type_id, hullstrength, current_shield, relative_strength, combat_grid, pos_x, pos_y, can_move, current_target_1, current_target_2, current_target_3, current_angle,  active,  frozen, must_move_next_turn, special_effects, side){
	this.unique_id=unique_id;
	this.fleet_id=fleet_id;
	this.combat_id=combat_id;
	this.turn=turn;
	this.ship_type_id=ship_type_id;
	this.hullstrength=hullstrength;
	this.current_shield=current_shield;
	this.relative_strength=relative_strength;
	this.combat_grid=combat_grid;
	this.pos_x=pos_x;
	this.pos_y=pos_y;
	this.prev_x=-1;
	this.prev_y=-1;
	this.can_move=can_move;
	this.current_target_1=current_target_1;
	this.current_target_2=current_target_2;
	this.current_target_3=current_target_3;
	this.current_angle=current_angle;
	this.active=active;
	this.frozen=frozen;
	this.must_move_next_turn=must_move_next_turn;
	this.special_effects=special_effects;
	this.side=side;
	this.causing_shield_drain=false;
	this.being_shield_drained=false;
	this.volatilityEffect=false;
	this.visible=1;
	this.magnetAnimPlaying=false;
	this.pushed_frames=0;


	this.firepower=returnFirepower(ship_type_id);

	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==this.ship_type_id){
			var s=ad2460.productionitems[i];
			this.vesselclass=s.vesselclass;
			this.vesseltype=s.vesseltype;
			//this.vesseltype=s.vesseltype;
			this.name=s.name;
			this.max_hull=s.hullstrength;
			this.max_shield=s.shieldstrength;
			this.tech=s.tech;
			this.description=s.description;
			this.h_cost=s.h_cost;
			this.n_cost=s.n_cost;
			this.s_cost=s.s_cost;
			this.i_cost=s.i_cost;
			this.shieldtype=s.shieldtype;
			//if (this.vesselclass!='Fighter' && this.vesselclass!='Corvette'){
				// this.combatImage=new Image;
				// var filename=s.id;
				// if (this.side=='Defender'){
				//	filename=filename+'_rev';
				// }
				// filename=filename+'.png';
				// this.combatImage.setAttribute('src','images/icons/miniships/100x100/'+filename);
			//}
		}
	}
	this.die=function(){
		
		if (this.active==1){
			
			var outputClass='combat_attacker_text';
			if (this.side=='Defender'){
				outputClass='combat_defender_text';
			}

			addCombatLogMessage("<span class='"+outputClass+"'>"+this.name+"</span> is destroyed!",false);

			if (this.side=='Attacker'){
				ad2460.combat.att_strength-=this.relative_strength;
				$("#att_strength").html(''+ad2460.combat.att_strength);
				if ( this.vesselclass =='Frigate' || this.vesselclass =='Cruiser' || this.vesselclass =='Battleship' || this.vesselclass =='Carrier' ){
					if (this.vesseltype!='Utility'){
						ad2460.combat.attacking_capital_ships--;
						$("#att_capital_ships").html(''+ad2460.combat.attacking_capital_ships);
					}
				}
			}
			else if (this.side=='Defender'){
				ad2460.combat.def_strength-=this.relative_strength;
				$("#def_strength").html(''+ad2460.combat.def_strength);
				if ( this.vesselclass =='Frigate' || this.vesselclass =='Cruiser' || this.vesselclass =='Battleship' || this.vesselclass =='Carrier' ){
					if (this.vesseltype!='Utility'){
						ad2460.combat.defending_capital_ships--;
						$("#def_capital_ships").html(''+ad2460.combat.defending_capital_ships);
					}
				}
			}


			this.active=0;
			// play explosion here :)
			//ad2460.combat.effects.push(new effect('instantexplosion1',10,this.pos_x,this.pos_y,0,0,explosionImage1,''));
			if (this.ship_type_id==499){
				// play special station-shut-down effect ?
			}
			else if (this.vesselclass=='Fighter' || this.vesselclass=='Corvette'){
				var tmp=Math.random()*100;
				if (tmp<50){
					play_multi_sound('minor_explosion_01');
				}
				else {
					play_multi_sound('minor_explosion_02');
				}
			}
			else if (this.vesselclass=='Carrier' || this.vesselclass=='Battleship' || this.vesselclass=='Cruiser' || this.vesselclass=='Frigate' ){
				// Big-ass thingie
				if (this.vesselclass=='Carrier' || this.vesselclass=='Battleship' || this.vesselclass=='Cruiser'){
					ad2460.combat.effects.push(new effect('explosion5',42,this.pos_x,this.pos_y,0,0,explosionImage5,'', this.unique_id, this.vesselclass));
				}
				else if (this.vesselclass=='Frigate')	{
					ad2460.combat.effects.push(new effect('explosion4',19,this.pos_x,this.pos_y,0,0,explosionImage4,'', this.unique_id, this.vesselclass));
				}
				
				if (extraFX==true){
					
					if (this.vesselclass=='Carrier' || this.vesselclass=='Battleship' ){
						play_multi_sound('explosion_01');
					}
					if (this.vesselclass=='Cruiser' || this.vesselclass=='Frigate' ){
						play_multi_sound('explosion_01');
					}

					if (this.vesselclass=='Carrier' || this.vesselclass=='Battleship' || this.vesselclass=='Cruiser' ){
						ad2460.combat.effects.push(new effect('ellipse',30,this.pos_x,this.pos_y,0,0,'blue','', this.unique_id, this.vesselclass));
						ad2460.combat.effects.push(new effect('ellipse',30,this.pos_x+1,this.pos_y-1,0,0,'white','', this.unique_id, this.vesselclass));
						ad2460.combat.effects.push(new effect('ellipse',30,this.pos_x-1,this.pos_y+1,0,0,'blue','', this.unique_id, this.vesselclass));
					}
					
					if ( (this.vesselclass=='Cruiser' || this.vesselclass=='Battleship' || this.vesselclass=='Carrier') && Math.random()<0.2){
						// all capitals have 20% chance of creating 1 debris-effect
						var rand1=Math.floor(-5+Math.random()*10);
						var rand2=Math.floor(-5+Math.random()*10);
						ad2460.combat.effects.push(new effect('particle1',30,this.pos_x,this.pos_y,rand1,rand2,combatrock1,'', this.unique_id, this.vesselclass));
					}
					
					if (this.vesselclass=='Battleship' && Math.random()<0.3){
						// Add more fun here !!
						var rand1=Math.floor(-20+Math.random()*40);
						var rand2=Math.floor(-20+Math.random()*40);
						var rand3=Math.floor(-20+Math.random()*40);
						var rand4=Math.floor(-20+Math.random()*40);

						ad2460.combat.effects.push(new effect('explosion4',19,this.pos_x+rand1,this.pos_y+rand2,0,0,explosionImage4,'', this.unique_id, this.vesselclass));
						ad2460.combat.effects.push(new effect('explosion4',19,this.pos_x+rand3,this.pos_y+rand4,0,0,explosionImage4,'', this.unique_id, this.vesselclass));
					}
					
					if (this.vesselclass=='Battleship' && Math.random()<0.75){
						// Battleships have 75% chance of creating 3 debris-effect
						var rand1=Math.floor(-5+Math.random()*10);
						var rand2=Math.floor(-5+Math.random()*10);
						var rand3=Math.floor(-5+Math.random()*10);
						var rand4=Math.floor(-5+Math.random()*10);
						
						ad2460.combat.effects.push(new effect('particle1',30,this.pos_x,this.pos_y,rand1,rand2,combatrock1,'', this.unique_id, this.vesselclass));
						ad2460.combat.effects.push(new effect('particle1',30,this.pos_x,this.pos_y,rand3,rand4,combatrock2,'', this.unique_id, this.vesselclass));
						ad2460.combat.effects.push(new effect('particle1',30,this.pos_x,this.pos_y,rand4,rand1,combatrock3,'', this.unique_id, this.vesselclass));
						if (Math.random()<0.50){
							// Battleships have 75% chance of creating 2 additional debris-effect
							var rand1=Math.floor(-5+Math.random()*10);
							var rand2=Math.floor(-5+Math.random()*10);
							var rand3=Math.floor(-5+Math.random()*10);
							var rand4=Math.floor(-5+Math.random()*10);
							
							ad2460.combat.effects.push(new effect('particle1',30,this.pos_x,this.pos_y,rand1,rand2,combatrock1,'', this.unique_id, this.vesselclass));
							ad2460.combat.effects.push(new effect('particle1',30,this.pos_x,this.pos_y,rand3,rand4,combatrock3,'', this.unique_id, this.vesselclass));
						}

					}
					
				}
			}
			else {
				// More normal-sized
				ad2460.combat.effects.push(new effect('explosion4',19,this.pos_x,this.pos_y,0,0,explosionImage4,'', this.unique_id, this.vesselclass));
				//play_multi_sound('sfx_explode3');
				if (extraFX==true){
					if (this.vesselclass=='Frigate' || this.vesselclass=='Cruiser'){
						ad2460.combat.effects.push(new effect('ellipse',30,this.pos_x,this.pos_y,0,0,'blue','', this.unique_id, this.vesselclass));
					}
				}
			}
			
			//console.log("Vol-effect on this death: "+this.volatilityEffect);
			if (this.volatilityEffect!=false){
				//console.log("Pushing volatility-effect to effects in this.die");
				ad2460.combat.effects.push(this.volatilityEffect);
			}


			
			if (this.side=='Attacker'){
				ad2460.combat.att_losses++;
				ad2460.combat.def_kills++;
				if (this.vesselclass=='Fighter' || this.vesselclass=='Corvette'){
					roundSummaries[ad2460.combatListener.eventParserTurn].defenderMinorKills+=1;
				}
				else if (this.vesseltype=='Satelite'){
					roundSummaries[ad2460.combatListener.eventParserTurn].defenderPDSKills+=1;
				}
				else if (this.vesselclass=='Frigate' || this.vesselclass=='Cruiser' || this.vesselclass=='Battleship' || this.vesselclass=='Carrier'){
					roundSummaries[ad2460.combatListener.eventParserTurn].defenderCapitalKills+=1;
				}

			}
			else {
				ad2460.combat.att_kills++;
				ad2460.combat.def_losses++;
				if (this.vesselclass=='Fighter' || this.vesselclass=='Corvette'){
					roundSummaries[ad2460.combatListener.eventParserTurn].attackerMinorKills+=1;
				}
				else if (this.vesseltype=='Satelite'){
					roundSummaries[ad2460.combatListener.eventParserTurn].attackerPDSKills+=1;
				}
				else if (this.vesselclass=='Frigate' || this.vesselclass=='Cruiser' || this.vesselclass=='Battleship' || this.vesselclass=='Carrier'){
					roundSummaries[ad2460.combatListener.eventParserTurn].attackerCapitalKills+=1;
				}
			}
			//updateCombatPercentages();
			ad2460.combat.updatePercentages=true;
			//renderCombatShipIcons();
			ad2460.combat.updateIcons=true;
			combatFrameRenderRequired=true;
			//renderCombatFrame(); // Update the canvas!
		}
		else {
			//console.log("But I am inactive, wtf?");
		}
	}
}

function combatSummary(combat_id, duration, result, outpost_takeover, att_fighters_lost, att_corvettes_lost, att_frigates_lost, att_cruisers_lost, att_battleships_lost, att_carriers_lost, att_utility_lost, att_transports_lost, att_value_lost, att_damage_inflicted, att_commanders_levelup, def_fighters_lost, def_corvettes_lost, def_frigates_lost, def_cruisers_lost, def_battleships_lost, def_carriers_lost, def_utility_lost, def_transports_lost, def_flak_lost, def_artillery_lost, def_shield_gens_lost, def_battle_stations_lost, def_value_lost, def_damage_inflicted, def_commanders_levelup, launch_id, att_nickname, att_alliance_name, att_alliance_image, att_commander_name, att_commander_rank, att_commander_image_id, att_commander_sex, def_nickname, def_alliance_name, def_alliance_image, def_commander_name, def_commander_rank, def_commander_image_id, def_commander_sex, location_name, location_x, location_y, location_planet_type, att_fighters, att_corvettes, att_utility, att_transports, att_fleets, att_capital_ships, att_strength, def_fighters, def_corvettes, def_utility, def_transports, def_fleets, def_capital_ships, def_strength, def_flak, def_artillery, def_shield_gens, def_battle_stations, att_frigates, att_cruisers, att_battleships, att_carriers, def_frigates, def_cruisers, def_battleships, def_carriers, taken_h, taken_n, taken_s, taken_i, att_post_cost, def_post_cost, att_xp, def_xp, view_id, bonus_resources){
	this.combat_id=combat_id;
	this.view_id=view_id;
	this.duration=duration;
	this.result=result;
	this.outpost_takeover=outpost_takeover;
	this.att_fighters_lost=att_fighters_lost;
	this.att_corvettes_lost=att_corvettes_lost;
	this.att_frigates_lost=att_frigates_lost;
	this.att_cruisers_lost=att_cruisers_lost;
	this.att_battleships_lost=att_battleships_lost;
	this.att_carriers_lost=att_carriers_lost;
	this.att_utility_lost=att_utility_lost;
	this.att_transports_lost=att_transports_lost;
	this.att_value_lost=att_value_lost;
	this.att_damage_inflicted=att_damage_inflicted;
	this.att_commanders_levelup=att_commanders_levelup;
	this.def_fighters_lost=def_fighters_lost;
	this.def_corvettes_lost=def_corvettes_lost;
	this.def_frigates_lost=def_frigates_lost;
	this.def_cruisers_lost=def_cruisers_lost;
	this.def_battleships_lost=def_battleships_lost;
	this.def_carriers_lost=def_carriers_lost;
	this.def_utility_lost=def_utility_lost;
	this.def_transports_lost=def_transports_lost;

	this.def_flak_lost=def_flak_lost;
	this.def_artillery_lost=def_artillery_lost;
	this.def_shield_gens_lost=def_shield_gens_lost;
	this.def_battle_stations_lost=def_battle_stations_lost;

	this.def_value_lost=def_value_lost;
	this.def_damage_inflicted=def_damage_inflicted;
	this.def_commanders_levelup=def_commanders_levelup;


	this.launch_id=launch_id;
	this.att_nickname=att_nickname;
	this.att_alliance_name=att_alliance_name;
	this.att_alliance_image=att_alliance_image;
	this.att_commander_name=att_commander_name;
	this.att_commander_rank=att_commander_rank;
	this.att_commander_image_id=att_commander_image_id;
	this.att_commander_sex=att_commander_sex;
	this.def_nickname=def_nickname;
	this.def_alliance_name=def_alliance_name;
	this.def_alliance_image=def_alliance_image;
	this.def_commander_name=def_commander_name;
	this.def_commander_rank=def_commander_rank;
	this.def_commander_image_id=def_commander_image_id;
	this.def_commander_sex=def_commander_sex;
	this.location_name=location_name;
	this.location_x=location_x;
	this.location_y=location_y;
	this.location_planet_type=location_planet_type;
	this.att_fighters=att_fighters;
	this.att_corvettes=att_corvettes;
	this.att_utility=att_utility;
	this.att_transports=att_transports;
	this.att_fleets=att_fleets;
	this.att_capital_ships=att_capital_ships;
	this.att_strength=att_strength;
	this.def_fighters=def_fighters;
	this.def_corvettes=def_corvettes;
	this.def_utility=def_utility;
	this.def_transports=def_transports;
	this.def_fleets=def_fleets;
	this.def_capital_ships=def_capital_ships;
	this.def_strength=def_strength;
	this.def_flak=def_flak;
	this.def_artillery=def_artillery;
	this.def_shield_gens=def_shield_gens;
	this.def_battle_stations=def_battle_stations;
	this.att_frigates=att_frigates;
	this.att_cruisers=att_cruisers;
	this.att_battleships=att_battleships;
	this.att_carriers=att_carriers;
	this.def_frigates=def_frigates;
	this.def_cruisers=def_cruisers;
	this.def_battleships=def_battleships;
	this.def_carriers=def_carriers;

	this.taken_h=taken_h;
	this.taken_n=taken_n;
	this.taken_s=taken_s;
	this.taken_i=taken_i;

	this.taken_s=taken_s;
	this.taken_i=taken_i;
	this.att_post_cost=att_post_cost;
	this.def_post_cost=def_post_cost;

	this.att_xp=att_xp;
	this.def_xp=def_xp;

	this.bonus_resources=bonus_resources;

}

function effect(type,duration,x,y,target_x,target_y,material,weapon,parent_ship_id, parent_ship_vesselclass, parent_ship_type_id){
	this.type=type;
	this.duration=parseInt(duration);
	this.age=0;
	this.x=parseInt(x);
	this.y=parseInt(y);
	this.target_x=parseInt(target_x);
	this.target_y=parseInt(target_y);
	this.material=material;
	this.weapon=weapon;
	this.parent_ship_id=parent_ship_id;
	this.parent_ship_vesselclass=parent_ship_vesselclass;
	this.parent_ship_type_id=parent_ship_type_id;
	if (type=='ellipse'){
		//console.log('creating ellipsis');
		this.angle=Math.round(Math.random()*360);
		this.expandSpeed=10+Math.random()*6;
		this.width=2;
		this.height=2;
		this.alpha=0.99;
	}
}

function fleetLogEntry(fleet_id, timestamp, log_type, escort, alliance_usage, arrive_x, arrive_y, arrive_name, depart_x, depart_y, depart_name, midair_result){
	this.fleet_id=fleet_id;
	this.timestamp=timestamp;
	this.log_type=log_type;
	this.escort=escort;
	this.alliance_usage=alliance_usage;
	this.arrive_x=arrive_x;
	this.arrive_y=arrive_y;
	this.arrive_name=arrive_name;
	this.depart_x=depart_x;
	this.depart_y=depart_y;
	this.depart_name=depart_name;
	this.midair_result=midair_result;
}

function playerLink(link_id, quadrant, sector, cluster, system, position, heading, body){
	this.link_id=link_id;
	this.quadrant=quadrant;
	this.sector=sector;
	this.cluster=cluster;
	this.system=system;
	this.position=position;
	this.heading=heading;
	this.body=body;
}

function techPointDef(id,type,num_var,string_var,description,timestamp){
	this.id=id;
	this.type=type;
	this.num_var=num_var;
	this.string_var=string_var;
	this.description=description;
	this.timestamp=timestamp;
}

function universeSearch(phrase,type,timestamp){
	this.phrase=phrase;
	this.type=type; // player, planet or alliance
	this.results=new Array;
	this.timestamp=timestamp;
}

function searchResultObject(owner_id, nickname, planet_name, x, y, planet_id, alliance_name, alliance_id, phrase, type ){
	this.owner_id=owner_id;
	this.nickname=nickname;
	this.planet_name=planet_name;
	this.x=x;
	this.y=y;
	this.planet_id=planet_id;
	this.alliance_name=alliance_name;
	this.alliance_id=alliance_id;
	this.phrase=phrase;
	this.type=type;
}

function rankingList(id, name, last_fetch, type, description){
	this.id=id;
	this.name=name;
	this.description=description;
	this.type=type; // 'p' or 'a'
	this.last_fetch=last_fetch;
	this.entries=new Array;
}

function detected_event(event_id,event_name, event_trigger_type, number_param_1, number_param_2, string_param_1, string_param_2, trigger_function, user_id ){
	this.event_id=event_id;
	this.event_name=event_name;
	this.event_trigger_type=event_trigger_type;
	this.number_param_1=number_param_1;
	this.number_param_2=number_param_2;
	this.string_param_1=string_param_1;
	this.string_param_2=string_param_2;
	this.trigger_function=trigger_function;
	this.user_id=user_id;
}

function allianceNews(news_id, alliance_id, timestamp, type, data){
	this.news_id=news_id;
	this.alliance_id=alliance_id;
	this.timestamp=timestamp;
	this.type=type;
	this.data=data;
}



function missionPack(pack_id, pack_name, pack_description, pack_level, pack_image, mission_counter, pack_cost, pack_type, required_level, required_admin, user_id, purchase_timestamp){
	this.pack_id=pack_id;
	this.pack_name=pack_name;
	this.pack_description=pack_description;
	this.pack_level=pack_level;
	this.pack_image=pack_image;
	this.mission_counter=mission_counter;
	this.pack_cost=pack_cost;
	this.pack_type=pack_type;
	this.required_level=required_level;
	this.required_admin=required_admin;

	this.user_id=user_id;
	this.purchase_timestamp=purchase_timestamp;

	this.last_completed_mission_chapter=0;
	this.last_completed_mission_id=0;

	this.missions=new Array;
}

function mission(mission_id, pack_id, mission_name, mission_description, required_advancement_level, type, minimum_firepower, essential_ships_string, difficult_rating, must_own_unit_id, required_specific_ship_id_1, required_specific_ship_id_1_counter, required_cargo_capacity, required_combat_fighters, required_combat_corvettes, required_combat_frigates, required_combat_cruisers, required_combat_battleships, required_combat_carriers, required_prospectors, required_scouts, required_spies, required_infiltrators, minimum_commander_rank, repeatable, reward_ship_type_id_1, reward_ship_type_id_1_count, reward_ship_type_id_2, reward_ship_type_id_2_count, reward_ship_type_id_3, reward_ship_type_id_3_count, reward_ship_type_id_4, reward_ship_type_id_4_count, reward_hassium, reward_indium, reward_strontium, reward_neodymium, opponent_fleet_template_id, mission_complete_text, choice_option_1, choice_option_2, choice_option_3, choice_option_4, choice_option_5, mission_chapter, required_completed_mission_id, reward_xp, required_game_object_id, expected_success_result, user_id, status, failed, completed_counter, last_completed_time, last_failed_time, intel_allocation_number, choice_option_selected, mission_combat_id, entry_id, duration, repeat_delay, commander_id, commander_data, launch_time, complete_time, tactics_string, summary_string, max_strength, max_level, ranked, enabled){
	this.mission_id=mission_id;
	this.pack_id=pack_id;
	this.mission_name=mission_name;
	this.mission_description=mission_description;
	this.required_advancement_level=required_advancement_level;
	this.type=type;
	this.minimum_firepower=minimum_firepower;
	this.essential_ships_string=essential_ships_string;
	this.difficult_rating=difficult_rating;
	this.must_own_unit_id=must_own_unit_id;
	this.required_specific_ship_id_1=required_specific_ship_id_1;
	this.required_specific_ship_id_1_counter=required_specific_ship_id_1_counter;
	this.required_cargo_capacity=required_cargo_capacity;
	this.required_combat_fighters=required_combat_fighters;
	this.required_combat_corvettes=required_combat_corvettes;
	this.required_combat_frigates=required_combat_frigates;
	this.required_combat_cruisers=required_combat_cruisers;
	this.required_combat_battleships=required_combat_battleships;
	this.required_combat_carriers=required_combat_carriers;
	this.required_prospectors=required_prospectors;
	this.required_scouts=required_scouts;
	this.required_spies=required_spies;
	this.required_infiltrators=required_infiltrators;
	this.minimum_commander_rank=minimum_commander_rank;
	this.repeatable=repeatable;
	this.reward_ship_type_id_1=reward_ship_type_id_1;
	this.reward_ship_type_id_1_count=reward_ship_type_id_1_count;
	this.reward_ship_type_id_2=reward_ship_type_id_2;
	this.reward_ship_type_id_2_count=reward_ship_type_id_2_count;
	this.reward_ship_type_id_3=reward_ship_type_id_3;
	this.reward_ship_type_id_3_count=reward_ship_type_id_3_count;
	this.reward_ship_type_id_4=reward_ship_type_id_4;
	this.reward_ship_type_id_4_count=reward_ship_type_id_4_count;
	this.reward_hassium=reward_hassium;
	this.reward_indium=reward_indium;
	this.reward_strontium=reward_strontium;
	this.reward_neodymium=reward_neodymium;
	this.opponent_fleet_template_id=opponent_fleet_template_id;
	this.mission_complete_text=mission_complete_text;
	this.choice_option_1=choice_option_1;
	this.choice_option_2=choice_option_2;
	this.choice_option_3=choice_option_3;
	this.choice_option_4=choice_option_4;
	this.choice_option_5=choice_option_5;
	this.mission_chapter=mission_chapter;
	this.required_completed_mission_id=required_completed_mission_id;
	this.reward_xp=reward_xp;
	this.required_game_object_id=required_game_object_id;
	this.user_id=user_id;
	this.status=status;
	this.failed=failed;
	this.completed_counter=completed_counter;
	this.last_completed_time=last_completed_time;
	this.last_failed_time=last_failed_time;
	this.intel_allocation_number=intel_allocation_number;
	this.choice_option_selected=choice_option_selected;
	this.mission_combat_id=mission_combat_id;
	this.expected_success_result=expected_success_result;
	this.entry_id=entry_id;
	this.launch_time=launch_time;
	this.complete_time=complete_time;

	this.duration=duration;
	this.repeat_delay=repeat_delay;

	this.ranked=ranked;
	this.enabled=enabled;

	this.tactics_string=tactics_string;
	this.summary_string=summary_string;

	this.max_strength=max_strength;
	this.max_level=max_level;

	this.commander_id=commander_id;
	if (this.commander_id>0){
		// Now split the commander_data into entries...Split on :: and make damn sure you know what you get :)
		//commander_id :: owner_id :: hired :: name :: personality :: tactics :: commanding :: perception :: morale :: rank :: experience :: wins :: losses | image_id | sex  | fleet_id | missions | dead
		
		var commander_array=commander_data.split("::");
		this.commander=false;
		if (commander_array.length>10){
			this.commander=new commander(commander_array[0], commander_array[1], commander_array[2], commander_array[3], commander_array[4], commander_array[5], commander_array[6], commander_array[7], commander_array[8], commander_array[9], commander_array[10], commander_array[11], commander_array[12], commander_array[13], commander_array[14], commander_array[15], commander_array[16], commander_array[17] );
		}
	}

	if (entry_id>0){
		ad2460.missionVars.active_mission_id=mission_id;
	}
}

function missionOptionChoice(option_id, option_type, option_name, option_description, stat, success_chance_mod, duration_mod  ){
	this.option_id=option_id;
	this.option_type=option_type;
	this.option_name=option_name;
	this.option_description=option_description;
	this.stat=stat;
	this.success_chance_mod=success_chance_mod;
	this.duration_mod=duration_mod;
}

function note(note_id, timestamp, heading, body){
	this.note_id=note_id;
	this.timestamp=timestamp;
	this.heading=heading;
	this.body=body;
}


// Copyright 2010 Fifth Season AS
// Author: Christian "Spinner" Lassem
// If there is anythging here you wish to use, please contact me and ask permission. <firstname>.<lastname>@ad2460.com will do the trick.

// General utils



String.prototype.trim = function () {
    return this.replace(/^\s*/, "").replace(/\s*$/, "");
}
String.prototype.capitalize = function() {
    return this.charAt(0).toUpperCase() + this.slice(1);
}

if(!window.console) {
	window.console = {
		log : function(str) {
		}
	};
}

(function (pool, math, width, chunks, significance, overflow, startdenom) {
//
// seedrandom()
//
math['seedrandom'] = function seedrandom(seed, use_entropy) {
  var key = [];
  var arc4;

  // Flatten the seed string or build one from local entropy if needed.
  seed = mixkey(flatten(
    use_entropy ? [seed, pool] :
    arguments.length ? seed :
    [new Date().getTime(), pool, window], 3), key);

  arc4 = new ARC4(key);
  mixkey(arc4.S, pool);

  // Override Math.random

  math['random'] = function random() {
    var n = arc4.g(chunks);
    var d = startdenom;
    var x = 0;
    while (n < significance) {
      n = (n + x) * width;
      d *= width;
      x = arc4.g(1);
    }
    while (n >= overflow) {
      n /= 2;
      d /= 2;
      x >>>= 1;
    }
    return (n + x) / d;
  };

  // Return the seed that was used
  return seed;
};


/** @constructor */
function ARC4(key) {
  var t, u, me = this, keylen = key.length;
  var i = 0, j = me.i = me.j = me.m = 0;
  me.S = [];
  me.c = [];

  if (!keylen) { key = [keylen++]; }

  while (i < width) { me.S[i] = i++; }
  for (i = 0; i < width; i++) {
    t = me.S[i];
    j = lowbits(j + t + key[i % keylen]);
    u = me.S[j];
    me.S[i] = u;
    me.S[j] = t;
  }


  me.g = function getnext(count) {
    var s = me.S;
    var i = lowbits(me.i + 1); var t = s[i];
    var j = lowbits(me.j + t); var u = s[j];
    s[i] = u;
    s[j] = t;
    var r = s[lowbits(t + u)];
    while (--count) {
      i = lowbits(i + 1); t = s[i];
      j = lowbits(j + t); u = s[j];
      s[i] = u;
      s[j] = t;
      r = r * width + s[lowbits(t + u)];
    }
    me.i = i;
    me.j = j;
    return r;
  };

  me.g(width);
}


function flatten(obj, depth, result, prop, typ) {
  result = [];
  typ = typeof(obj);
  if (depth && typ == 'object') {
    for (prop in obj) {
      if (prop.indexOf('S') < 5) {    // Avoid FF3 bug (local/sessionStorage)
        try { result.push(flatten(obj[prop], depth - 1)); } catch (e) {}
      }
    }
  }
  return (result.length ? result : obj + (typ != 'string' ? '\0' : ''));
}

function mixkey(seed, key, smear, j) {
  seed += '';                         // Ensure the seed is a string
  smear = 0;
  for (j = 0; j < seed.length; j++) {
    key[lowbits(j)] =
      lowbits((smear ^= key[lowbits(j)] * 19) + seed.charCodeAt(j));
  }
  seed = '';
  for (j in key) { seed += String.fromCharCode(key[j]); }
  return seed;
}

function lowbits(n) { return n & (width - 1); }

startdenom = math.pow(width, chunks);
significance = math.pow(2, significance);
overflow = significance * 2;

mixkey(math.random(), pool);

// End anonymous scope, and pass initial values.
})(
  [],
  Math,
  256,
  6,
  52
);



replacePattern1 = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
//replacePattern2 = /(^|[^\/])(www\.[\S]+(\b|$))/gim;
replacePattern2 = /(^|[^\/])(www\.[a-z|0-9?,\.\/]+)/gi;
replacePattern3 = /(\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,6})/gim;

var regexPatterns= new Array;
regexPatterns.push({trigger:'ooohhh', converted:'<img align="middle" src="images/emoticons/nottrue.png"/>'});
regexPatterns.push({trigger:':)', converted:'<img align="middle" src="images/emoticons/niceday.png"/>'});
regexPatterns.push({trigger:':-)', converted:'<img align="middle" src="images/emoticons/niceday.png"/>'});
regexPatterns.push({trigger:'(-:', converted:'<img align="middle" src="images/emoticons/niceday.png"/>'});
regexPatterns.push({trigger:'(:', converted:'<img align="middle" src="images/emoticons/niceday.png"/>'});
regexPatterns.push({trigger:';)', converted:'<img align="middle" src="images/emoticons/wink.png"/>'});
regexPatterns.push({trigger:'(;', converted:'<img align="middle" src="images/emoticons/wink.png"/>'});
regexPatterns.push({trigger:':D', converted:'<img align="middle" src="images/emoticons/grin.png"/>'});
regexPatterns.push({trigger:':p', converted:'<img align="middle" src="images/emoticons/tongue.png"/>'});
regexPatterns.push({trigger:':P', converted:'<img align="middle" src="images/emoticons/tongue.png"/>'});
regexPatterns.push({trigger:':-p', converted:'<img align="middle" src="images/emoticons/tongue.png"/>'});
regexPatterns.push({trigger:':-P', converted:'<img align="middle" src="images/emoticons/tongue.png"/>'});
regexPatterns.push({trigger:':o', converted:'<img align="middle" src="images/emoticons/blush.png"/>'});
regexPatterns.push({trigger:':-(', converted:'<img align="middle" src="images/emoticons/buh.png"/>'});
regexPatterns.push({trigger:':(', converted:'<img align="middle" src="images/emoticons/buh.png"/>'});
regexPatterns.push({trigger:')-:', converted:'<img align="middle" src="images/emoticons/buh.png"/>'});
regexPatterns.push({trigger:'):', converted:'<img align="middle" src="images/emoticons/buh.png"/>'});
regexPatterns.push({trigger:':?:', converted:'<img align="middle" src="images/emoticons/wut.png"/>'});
regexPatterns.push({trigger:'(cool)', converted:'<img align="middle" src="images/emoticons/cool.png"/>'});
regexPatterns.push({trigger:'(up)', converted:'<img align="middle" src="images/emoticons/thumbup.png"/>'});
regexPatterns.push({trigger:'(ball)', converted:'<img align="middle" src="images/emoticons/ball.png"/>'});
regexPatterns.push({trigger:'(down)', converted:'<img align="middle" src="images/emoticons/thumbdown.png"/>'});
regexPatterns.push({trigger:'(mad)', converted:'<img align="middle" src="images/emoticons/angry.png"/>'});
regexPatterns.push({trigger:'(confused)', converted:'<img align="middle" src="images/emoticons/blankstare.png"/>'});
regexPatterns.push({trigger:'(cry)', converted:'<img align="middle" src="images/emoticons/qq.png"/>'});
regexPatterns.push({trigger:'(eek)', converted:'<img align="middle" src="images/emoticons/help.png"/>'});
regexPatterns.push({trigger:'8-)', converted:'<img align="middle" src="images/emoticons/ehum.png"/>'});
regexPatterns.push({trigger:'(cake)', converted:'<img align="middle" src="images/emoticons/cake.png"/>'});
regexPatterns.push({trigger:'(phone)', converted:'<img align="middle" src="images/emoticons/phone.png"/>'});
regexPatterns.push({trigger:'(martini)', converted:'<img align="middle" src="images/emoticons/drink.png"/>'});
regexPatterns.push({trigger:'(drink)', converted:'<img align="middle" src="images/emoticons/drink.png"/>'});
regexPatterns.push({trigger:'(beverage)', converted:'<img align="middle" src="images/emoticons/beverage.png"/>'});
regexPatterns.push({trigger:'(tup)', converted:'<img align="middle" src="images/emoticons/thumbup.png"/>'});
regexPatterns.push({trigger:'(tdown)', converted:'<img align="middle" src="images/emoticons/thumbdown.png"/>'});
regexPatterns.push({trigger:'(sleepy)', converted:'<img align="middle" src="images/emoticons/zzz.png"/>'});
regexPatterns.push({trigger:'(rolleyes)', converted:'<img align="middle" src="images/emoticons/ehum.png"/>'});
regexPatterns.push({trigger:'(pizza)', converted:'<img align="middle" src="images/emoticons/pizza.png"/>'});
regexPatterns.push({trigger:'(cig)', converted:'<img align="middle" src="images/emoticons/smoke.png"/>'});
regexPatterns.push({trigger:'(smoke)', converted:'<img align="middle" src="images/emoticons/smoke.png"/>'});
regexPatterns.push({trigger:'(offside)', converted:'<img align="middle" src="images/emoticons/offside.png"/>'});
regexPatterns.push({trigger:'(rtfm)', converted:'<img align="middle" src="images/emoticons/list.png"/>'});
regexPatterns.push({trigger:'(angry)', converted:'<img align="middle" src="images/emoticons/angry.png"/>'});
regexPatterns.push({trigger:'(bandit)', converted:'<img align="middle" src="images/emoticons/bandit.png"/>'});
regexPatterns.push({trigger:'(beaten)', converted:'<img align="middle" src="images/emoticons/beaten.png"/>'});
regexPatterns.push({trigger:'(blankstare)', converted:'<img align="middle" src="images/emoticons/blankstare.png"/>'});
regexPatterns.push({trigger:'(bleh)', converted:'<img align="middle" src="images/emoticons/bleh.png"/>'});
regexPatterns.push({trigger:'(buh)', converted:'<img align="middle" src="images/emoticons/buh.png"/>'});
regexPatterns.push({trigger:'(sad)', converted:'<img align="middle" src="images/emoticons/buh.png"/>'});
regexPatterns.push({trigger:'(burnt)', converted:'<img align="middle" src="images/emoticons/burnt.png"/>'});
regexPatterns.push({trigger:'(darkmood)', converted:'<img align="middle" src="images/emoticons/darkmood.png"/>'});
regexPatterns.push({trigger:'(disappearing)', converted:'<img align="middle" src="images/emoticons/disappearing.png"/>'});
regexPatterns.push({trigger:'(dizzy)', converted:'<img align="middle" src="images/emoticons/dizzy.png"/>'});
regexPatterns.push({trigger:'(ehum)', converted:'<img align="middle" src="images/emoticons/ehum.png"/>'});
regexPatterns.push({trigger:'(furious)', converted:'<img align="middle" src="images/emoticons/furious.png"/>'});
regexPatterns.push({trigger:'(gonnablow)', converted:'<img align="middle" src="images/emoticons/gonnablow.png"/>'});
regexPatterns.push({trigger:'(grin)', converted:'<img align="middle" src="images/emoticons/grin.png"/>'});
regexPatterns.push({trigger:'(happydrunk)', converted:'<img align="middle" src="images/emoticons/happydrunk.png"/>'});
regexPatterns.push({trigger:'(hide)', converted:'<img align="middle" src="images/emoticons/hide.png"/>'});
regexPatterns.push({trigger:'(hopeless)', converted:'<img align="middle" src="images/emoticons/hopeless.png"/>'});
regexPatterns.push({trigger:'(humhum)', converted:'<img align="middle" src="images/emoticons/humhum.png"/>'});
regexPatterns.push({trigger:'(innocent)', converted:'<img align="middle" src="images/emoticons/innocent.png"/>'});
regexPatterns.push({trigger:'(kiss)', converted:'<img align="middle" src="images/emoticons/kiss.png"/>'});
regexPatterns.push({trigger:'(list)', converted:'<img align="middle" src="images/emoticons/list.png"/>'});
regexPatterns.push({trigger:'(lovestruck)', converted:'<img align="middle" src="images/emoticons/lovestruck.png"/>'});
regexPatterns.push({trigger:'(music)', converted:'<img align="middle" src="images/emoticons/music.png"/>'});
regexPatterns.push({trigger:'(niceday)', converted:'<img align="middle" src="images/emoticons/niceday.png"/>'});
regexPatterns.push({trigger:'(ninja)', converted:'<img align="middle" src="images/emoticons/ninja.png"/>'});
regexPatterns.push({trigger:'(omg)', converted:'<img align="middle" height="30" src="images/emoticons/omg.png"/>'});
regexPatterns.push({trigger:'(coffee)', converted:'<img align="middle" height="30" src="images/emoticons/bettercoffee.png"/>'});
regexPatterns.push({trigger:'(lol)', converted:'<img align="middle" height="30" src="images/emoticons/lol2.png"/>'});
regexPatterns.push({trigger:'(lolcry)', converted:'<img align="middle" height="30" src="images/emoticons/lol.png"/>'});
//regexPatterns.push({trigger:'(facepalm)', converted:'<img align="middle" height="30" src="images/emoticons/facepalm.png"/>'});
regexPatterns.push({trigger:'(facepalm)', converted:'<img align="middle" height="30" src="images/emoticons/newfacepalm.png"/>'});
regexPatterns.push({trigger:'(thinking)', converted:'<img align="middle" height="30" src="images/emoticons/thinking.png"/>'});
regexPatterns.push({trigger:'(onfire)', converted:'<img align="middle" height="30" src="images/emoticons/onfire.png"/>'});
regexPatterns.push({trigger:'(oreally)', converted:'<img align="middle" height="30" src="images/emoticons/oreally.png"/>'});
regexPatterns.push({trigger:'(ouch)', converted:'<img align="middle" height="30" src="images/emoticons/ouch.png"/>'});
regexPatterns.push({trigger:'(outrage)', converted:'<img align="middle" height="30" src="images/emoticons/outrage.png"/>'});
regexPatterns.push({trigger:'(panic)', converted:'<img align="middle" height="30" src="images/emoticons/panic.png"/>'});
regexPatterns.push({trigger:'(phew)', converted:'<img align="middle" height="30" src="images/emoticons/phew.png"/>'});
regexPatterns.push({trigger:'(pissed)', converted:'<img align="middle" height="30" src="images/emoticons/outrage.png"/>'});
regexPatterns.push({trigger:'(psst)', converted:'<img align="middle" height="30" src="images/emoticons/psst.png"/>'});
regexPatterns.push({trigger:'(sceptic)', converted:'<img align="middle" height="30" src="images/emoticons/sceptic.png"/>'});
regexPatterns.push({trigger:'(seriousbusiness)', converted:'<img align="middle" height="30" src="images/emoticons/seriousbusiness.png"/>'});
regexPatterns.push({trigger:'(shout)', converted:'<img align="middle" height="30" src="images/emoticons/shout.png"/>'});
regexPatterns.push({trigger:'(shy)', converted:'<img align="middle" height="30" src="images/emoticons/shy.png"/>'});
regexPatterns.push({trigger:'(sick)', converted:'<img align="middle" height="30" src="images/emoticons/sick.png"/>'});
regexPatterns.push({trigger:'(slow)', converted:'<img align="middle" height="30" src="images/emoticons/slow.png"/>'});
regexPatterns.push({trigger:'(starstruck)', converted:'<img align="middle" height="30" src="images/emoticons/starstruck.png"/>'});
regexPatterns.push({trigger:'(whatever)', converted:'<img align="middle" height="30" src="images/emoticons/whatever.png"/>'});
regexPatterns.push({trigger:'(whistle)', converted:'<img align="middle" height="30" src="images/emoticons/whistle.png"/>'});
regexPatterns.push({trigger:'(wink)', converted:'<img align="middle" height="30" src="images/emoticons/wink.png"/>'});
regexPatterns.push({trigger:'(wut)', converted:'<img align="middle" height="30" src="images/emoticons/wut.png"/>'});
regexPatterns.push({trigger:'(x_x)', converted:'<img align="middle" height="30" src="images/emoticons/x_x.png"/>'});
regexPatterns.push({trigger:'(XD)', converted:'<img align="middle" height="30" src="images/emoticons/XD.png"/>'});
regexPatterns.push({trigger:'(yarr)', converted:'<img align="middle" height="30" src="images/emoticons/yarr.png"/>'});
regexPatterns.push({trigger:'(yawn)', converted:'<img align="middle" height="30" src="images/emoticons/yawn.png"/>'});
regexPatterns.push({trigger:'(zzz)', converted:'<img align="middle" height="30" src="images/emoticons/zzz.png"/>'});
regexPatterns.push({trigger:'(stubborn)', converted:'<img align="middle" height="30" src="images/emoticons/stubborn.png"/>'});
regexPatterns.push({trigger:'(thumbup)', converted:'<img align="middle" height="30" src="images/emoticons/thumbup.png"/>'});
regexPatterns.push({trigger:'(thumbdown)', converted:'<img align="middle" height="30" src="images/emoticons/thumbdown.png"/>'});
regexPatterns.push({trigger:'(yellowcard)', converted:'<img align="middle" height="30" src="images/emoticons/yellowcard.png"/>'});
regexPatterns.push({trigger:'(redcard)', converted:'<img align="middle" height="30" src="images/emoticons/redcard.png"/>'});
regexPatterns.push({trigger:'(beer)', converted:'<img align="middle" height="30" src="images/emoticons/beer.png"/>'});
regexPatterns.push({trigger:'(evilish)', converted:'<img align="middle" height="30" src="images/emoticons/evilish.png"/>'});
regexPatterns.push({trigger:'(glee)', converted:'<img align="middle" height="30" src="images/emoticons/glee.png"/>'});
regexPatterns.push({trigger:'(manic)', converted:'<img align="middle" height="30" src="images/emoticons/manic.png"/>'});
regexPatterns.push({trigger:'(mybad)', converted:'<img align="middle" height="30" src="images/emoticons/mybad.png"/>'});
regexPatterns.push({trigger:'(tongue)', converted:'<img align="middle" height="30" src="images/emoticons/tongue.png"/>'});
regexPatterns.push({trigger:'(help)', converted:'<img align="middle" height="30" src="images/emoticons/help.png"/>'});
regexPatterns.push({trigger:'(dancemouse)', converted:'<img align="middle" height="30" src="images/emoticons/ratty.gif"/>'});
regexPatterns.push({trigger:'(ratty)', converted:'<img align="middle" height="30" src="images/emoticons/ratty.png"/>'});
regexPatterns.push({trigger:'(banana)', converted:'<img align="middle" height="30" src="images/emoticons/banana.png"/>'});

regexPatterns.push({trigger:'(pale)', converted:'<img align="middle" height="30" src="images/emoticons/pale.png"/>'});

$(document).ready(function() {
  $('#homeworldbutton').click(
    function() {
      ad2460.currentPageSection='Homeworld';
    }
  );
  $('#outpostsbutton').click(
    function() {
      ad2460.currentPageSection='Outposts';
    }
  );

  $('#alliancebutton').click(
    function() {
      ad2460.currentPageSection='Alliance';
    }
  );

  $('#militarybutton').click(
    function() {
      ad2460.currentPageSection='Military';
    }
  );
	/*
  $('#economybutton').click(
    function() {
      ad2460.currentPageSection='Economy';
      ad2460.currentPageSectionId='economy_slide';
    }
  );

  $('#missionsbutton').click(
    function() {
      ad2460.currentPageSection='Missions';
      ad2460.currentPageSectionId='mission_section';
    }
  );
  $('#starmapbutton').click(
    function() {
      ad2460.currentPageSection='Starmap';
      ad2460.currentPageSectionId='starmapslide';
    }
  );
  */
});



function testUAstring(UA){
	var userAgent=UA;
	var isIpad = userAgent.match(/iPad/i) != null;
	var isIphone = userAgent.match(/iPhone/i) != null;
	var isGalaxypad = userAgent.match(/GT-P1000/i) != null;
	var isPs3 = userAgent.match(/PlayStation 3/i) != null;

	var isWindows = userAgent.match(/Windows/i) != null;
	var isOSX = userAgent.match(/Mac OS X/i) != null;
	var isAndroid = userAgent.match(/Android/i) != null;

	var myOs='unknown';
	if (isWindows){
		if (userAgent.match(/Windows NT 5.0/i) != null){	myOs='Windows 2000';	}
		else if (userAgent.match(/Windows NT 5.1/i) != null){	myOs='Windows XP';	}
		else if (userAgent.match(/Windows XP/i) != null){	myOs='Windows XP';	}
		else if (userAgent.match(/Windows NT 5.2/i) != null){	myOs='Windows Server 2003';	}
		else if (userAgent.match(/Windows NT 6.0/i) != null){	myOs='Windows Vista';	}
		else if (userAgent.match(/Windows NT 6.1/i) != null){	myOs='Windows 7';	}
		else if (userAgent.match(/Windows NT 6.2/i) != null){	myOs='Windows 8';	}
		else if (userAgent.match(/Windows NT 6.3/i) != null){	myOs='Windows 8.1';	}
		else if (userAgent.match(/Windows NT 6.4/i) != null){	myOs='Windows 8.2';	}
		else if (userAgent.match(/Windows NT 10/i) != null){	myOs='Windows 10';	}
		else if (userAgent.match(/Windows NT 11/i) != null){	myOs='Windows 11';	}
		else if (userAgent.match(/Windows NT 12/i) != null){	myOs='Windows 12';	}
		else {
			myOs='Windows';
		}
	}
	if (isOSX){	myOs='OS X';	}
	if (isAndroid){	myOs='Android';	}


	if (isIpad){
		return ({browser:'iPad',version:1,os:myOs});
	}
	if (isIphone){
		return ({browser:'iPhone',version:1,os:myOs});
	}
	if (isGalaxypad){
		return ({browser:'GalaxyPad',version:1,os:myOs});
	}
	if (isPs3){
		return ({browser:'PS3',version:1,os:myOs});
	}

	var agentArray=userAgent.match(/Chrome\/([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split('/');
			return({browser:newArray[0],version:newArray[1],os:myOs});
		}
	}

	var agentArray=userAgent.match(/Firefox\/([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split('/');
			return({browser:newArray[0],version:newArray[1],os:myOs});
		}
	}

	var agentArray=userAgent.match(/Opera\/([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split('/');

			var agentArray2=userAgent.match(/Version\/([0-9]+)/);
			var newArray2=agentArray2[0].split('/');
			return({browser:newArray[0],version:newArray2[1],os:myOs});
		}
	}
	// Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10) AppleWebKit/600.1.25 (KHTML, like Gecko) Version/8.0 Safari/600.1.25
	var agentArray=userAgent.match(/[0-9]+.[0-9]+.[0-9]+ Safari/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split(' ');
			var versionString=newArray[0];
			//console.log(versionString);
			var versionArray=versionString.split('.');
			return({browser:newArray[1],version:versionArray[0],os:myOs});
		}
	}
	var agentArray=userAgent.match(/[0-9]+.[0-9]+ Safari/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split(' ');
			var versionString=newArray[0];
			//console.log(versionString);
			var versionArray=versionString.split('.');
			return({browser:newArray[1],version:versionArray[0],os:myOs});
		}
	}


	var agentArray=userAgent.match(/MSIE ([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split(' ');
			return({browser:newArray[0],version:newArray[1],os:myOs});
		}
	}

	var agentArray=userAgent.match(/Mobile Safari/);
	if (agentArray!==null){
		var name=agentArray[0];
		var versionArray=userAgent.match(/Version\/([0-9]+)/);
		var version=0;
		if (versionArray!==null && versionArray.length>=2){
			version=versionArray[1];
		}
		return({browser:name,version:version,os:myOs});
	}

	var agentArray=userAgent.match(/Trident/);
	if (agentArray!==null){
		// ok , we found trident engine
		if (agentArray.length>0){
			var newArray=userAgent.match(/rv:[0-9]+/);
			var newArray2=newArray[0].split(':');
			return({browser:'MSIE',version:newArray2[1],os:myOs});
		}
	}

	var agentArray=userAgent.match(/Edge\/([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split('/');
			return({browser:newArray[0],version:newArray[1],os:myOs});
		}
	}


	return ({browser:'Unknown: '+userAgent,version:0,os:myOs});
}


function fetch_browser_id(){
	// "Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/534.7 (KHTML, like Gecko) Chrome/7.0.517.41 Safari/534.7"
	// 1 : Internet Explorer
	// 2 : FireFox
	// 3 : Chrome
	// 4 : Opera
	// 5 : Safari
	// 6 : Other Webkit
	// 7 : Other Gecko
	// 8 : Other Unknown

	var userAgent=navigator.userAgent;

	// Look for the OS, particulary Windows or Mac OS X or Android

	//Mozilla/5.0 (Linux; U; Android 4.3; en-gb; GT-I9300 Build/JSS15J) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30


	var isIpad = navigator.userAgent.match(/iPad/i) != null;
	var isIphone = navigator.userAgent.match(/iPhone/i) != null;
	var isGalaxypad = navigator.userAgent.match(/GT-P1000/i) != null;
	var isPs3 = navigator.userAgent.match(/PlayStation 3/i) != null;

	var isWindows = navigator.userAgent.match(/Windows/i) != null;
	var isOSX = navigator.userAgent.match(/Mac OS X/i) != null;
	var isAndroid = navigator.userAgent.match(/Android/i) != null;
	var isLinux = navigator.userAgent.match(/Linux/i) != null;
	var isUbuntu = navigator.userAgent.match(/Ubuntu/i) != null;

	var isMobile = navigator.userAgent.match(/Mobile/i) != null;

	var mobile=false;

	if (isAndroid==true || isIphone==true || isMobile==true){
		mobile=true;
	}

	var myOs='unknown';
	if (isWindows){
		if (navigator.userAgent.match(/Windows NT 5.0/i) != null){	myOs='Windows 2000';	}
		else if (navigator.userAgent.match(/Windows NT 5.1/i) != null){	myOs='Windows XP';	}
		else if (navigator.userAgent.match(/Windows XP/i) != null){	myOs='Windows XP';	}
		else if (navigator.userAgent.match(/Windows NT 5.2/i) != null){	myOs='Windows Server 2003';	}
		else if (navigator.userAgent.match(/Windows NT 6.0/i) != null){	myOs='Windows Vista';	}
		else if (navigator.userAgent.match(/Windows NT 6.1/i) != null){	myOs='Windows 7';	}
		else if (navigator.userAgent.match(/Windows NT 6.2/i) != null){	myOs='Windows 8';	}
		else if (navigator.userAgent.match(/Windows NT 6.3/i) != null){	myOs='Windows 8.1';	}
		else if (navigator.userAgent.match(/Windows NT 6.4/i) != null){	myOs='Windows 8.2';	}
		else if (navigator.userAgent.match(/Windows NT 6.5/i) != null){	myOs='Windows NT 6.5';	}
		else if (navigator.userAgent.match(/Windows NT 6.6/i) != null){	myOs='Windows NT 6.6';	}
		else if (navigator.userAgent.match(/Windows NT 6.7/i) != null){	myOs='Windows NT 6.7';	}
		else if (navigator.userAgent.match(/Windows NT 6.8/i) != null){	myOs='Windows NT 6.8';	}
		else if (navigator.userAgent.match(/Windows NT 6.9/i) != null){	myOs='Windows NT 6.9';	}
		else if (navigator.userAgent.match(/Windows NT 7.0/i) != null){	myOs='Windows 7';	}
		else if (navigator.userAgent.match(/Windows NT 8.0/i) != null){	myOs='Windows 8';	}
		else if (navigator.userAgent.match(/Windows NT 10/i) != null){	myOs='Windows 10';	}
		else if (navigator.userAgent.match(/Windows NT 11/i) != null){	myOs='Windows 11';	}
		else if (navigator.userAgent.match(/Windows NT 11/i) != null){	myOs='Windows 11';	}

		else {
			myOs='Windows';
		}
	}
	if (isOSX)		{	myOs='OS X';	}
	if (isAndroid)	{	myOs='Android';	}
	if (isLinux)	{	myOs='Linux';	}
	if (isUbuntu)	{	myOs='Ubuntu';	}

	if (isIpad){
		return ({browser:'iPad',version:1,os:myOs, mobile:mobile});
	}
	if (isIphone){
		return ({browser:'iPhone',version:1,os:myOs, mobile:mobile});
	}
	if (isGalaxypad){
		return ({browser:'GalaxyPad',version:1,os:myOs, mobile:mobile});
	}
	if (isPs3){
		return ({browser:'PS3',version:1,os:myOs, mobile:mobile});
	}

	var agentArray=userAgent.match(/Vivaldi\/([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split('/');
			return({browser:newArray[0],version:newArray[1],os:myOs, mobile:mobile});
		}
	}

	var agentArray=userAgent.match(/Edge\/([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split('/');
			return({browser:newArray[0],version:newArray[1],os:myOs, mobile:mobile});
		}
	}

	var agentArray=userAgent.match(/Chrome\/([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split('/');
			return({browser:newArray[0],version:newArray[1],os:myOs, mobile:mobile});
		}
	}

	var agentArray=userAgent.match(/Firefox\/([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split('/');
			return({browser:newArray[0],version:newArray[1],os:myOs, mobile:mobile});
		}
	}

	var agentArray=userAgent.match(/Opera\/([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split('/');

			var agentArray2=userAgent.match(/Version\/([0-9]+)/);
			var newArray2=agentArray2[0].split('/');
			return({browser:newArray[0],version:newArray2[1],os:myOs, mobile:mobile});
		}
	}

	var agentArray=userAgent.match(/[0-9]+.[0-9]+.[0-9]+ Safari/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split(' ');
			var versionString=newArray[0];
			//console.log(versionString);
			var versionArray=versionString.split('.');
			return({browser:newArray[1],version:versionArray[0],os:myOs, mobile:mobile});
		}
	}

	var agentArray=userAgent.match(/[0-9]+.[0-9]+ Safari/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split(' ');
			var versionString=newArray[0];
			//console.log(versionString);
			var versionArray=versionString.split('.');
			return({browser:newArray[1],version:versionArray[0],os:myOs, mobile:mobile});
		}
	}


	var agentArray=userAgent.match(/MSIE ([0-9]+)/);
	if (agentArray!==null){
		if (agentArray.length>0){
			var newArray=agentArray[0].split(' ');
			return({browser:newArray[0],version:newArray[1],os:myOs, mobile:mobile});
		}
	}

	var agentArray=userAgent.match(/Mobile Safari/);
	if (agentArray!==null){
		var name=agentArray[0];
		var versionArray=userAgent.match(/Version\/([0-9]+)/);
		var version=0;
		if (versionArray!==null && versionArray.length>=2){
			version=versionArray[1];
		}
		return({browser:name,version:version,os:myOs, mobile:mobile});
	}

	var agentArray=userAgent.match(/Trident/);
	if (agentArray!==null){
		// ok , we found trident engine
		if (agentArray.length>0){
			var newArray=userAgent.match(/rv:[0-9]+/);
			var newArray2=newArray[0].split(':');
			return({browser:'MSIE',version:newArray2[1],os:myOs, mobile:mobile});
		}
	}



	return ({browser:'Unknown: '+navigator.userAgent,version:0,os:myOs, mobile:mobile});
}

function returnInteger(amount){
	amount=amount.toString(10);
	integer=amount.replace(/[^\d]/g,"");
	integer=Number(integer);
	return integer;
}

function urlEncode(string){
	// The Javascript escape and unescape functions do not correspond
	// with what browsers actually do...
	var SAFECHARS = "0123456789" +					// Numeric
					"ABCDEFGHIJKLMNOPQRSTUVWXYZ" +	// Alphabetic
					"abcdefghijklmnopqrstuvwxyz" +
					"-_.!~*'()";					// RFC2396 Mark characters
	var HEX = "0123456789ABCDEF";

	var plaintext = string;
	var encoded = "";
	for (var i = 0; i < plaintext.length; i++ ) {
		var ch = plaintext.charAt(i);
	    if (ch == " ") {
		    encoded += "+";				// x-www-urlencoded, rather than %20
		} else if (SAFECHARS.indexOf(ch) != -1) {
		    encoded += ch;
		} else {
		    var charCode = ch.charCodeAt(0);
			if (charCode > 255) {
			    alert( "Unicode Character '"
                        + ch
                        + "' cannot be encoded using standard URL encoding.\n" +
				          "(URL encoding only supports 8-bit characters.)\n" +
						  "A space (+) will be substituted." );
				encoded += "+";
			} else {
				encoded += "%";
				encoded += HEX.charAt((charCode >> 4) & 0xF);
				encoded += HEX.charAt(charCode & 0xF);
			}
		}
	} // for

	return encoded;
};

function urlDecode(string){
   // Replace + with ' '
   // Replace %xx with equivalent character
   // Put [ERROR] in output if %xx is invalid.
   var HEXCHARS = "0123456789ABCDEFabcdef";
   var encoded = string;
   var plaintext = "";
   var i = 0;
   while (i < encoded.length) {
       var ch = encoded.charAt(i);
	   if (ch == "+") {
	       plaintext += " ";
		   i++;
	   } else if (ch == "%") {
			if (i < (encoded.length-2)
					&& HEXCHARS.indexOf(encoded.charAt(i+1)) != -1
					&& HEXCHARS.indexOf(encoded.charAt(i+2)) != -1 ) {
				plaintext += unescape( encoded.substr(i,3) );
				i += 3;
			} else {
				alert( 'Bad escape combination near ...' + encoded.substr(i) );
				plaintext += "%[ERROR]";
				i++;
			}
		} else {
		   plaintext += ch;
		   i++;
		}
	} // while
   return plaintext;
};


function getURLParam(strParamName){
	// Please note, only the first param will be accounted for to catch the ref!!
  var strReturn = "";
  var strHref = window.location.href;

  if ( strHref.indexOf("?") > -1 ){
    var strQueryString = strHref.substr(strHref.indexOf("?")).toLowerCase();
    var aQueryString = strQueryString.split("?");
    for ( var iParam = 0; iParam < aQueryString.length; iParam++ ){
      if ( aQueryString[iParam].indexOf(strParamName + "=") > -1 ){
        var aParam = aQueryString[iParam].split("=");
        strReturn = aParam[1];
        break;
      }
    }
  }
  return strReturn;
}


function FixCookieDate (date) {
  var base = new Date(0);
  var skew = base.getTime(); // dawn of (Unix) time - should be 0
  if (skew > 0)  // Except on the Mac - ahead of its time
    date.setTime (date.getTime() - skew);
}

function SetCookie(name,value,domain,days) {
	var date = new Date();
	if (days<1){
		days=3;
	}

	date.setTime(date.getTime()+(days*24*60*60*1000));
	var expires = date.toGMTString();
	document.cookie = name + "=" + escape (value) +"; expires=" + expires + "; domain=" + domain;

}

function ReadCookie(cname) {
	var name = cname + "=";
	var decodedCookie = decodeURIComponent(document.cookie);
	var ca = decodedCookie.split(';');
	for(var i = 0; i <ca.length; i++) {
		var c = ca[i];
		while (c.charAt(0) == ' ') {
			c = c.substring(1);
		}
		if (c.indexOf(name) == 0) {
			return c.substring(name.length, c.length);
		}
	}
	return "";
}


function check_all_checkboxes(){
	$(":checkbox").attr('checked', true);
}

function uncheck_all_checkboxes(){
	$(":checkbox").attr('checked', false);
}

function toggle_all_checkboxes(){
	for(i = 0; i < document.forms[0].elements.length; i++) {
		elm = document.forms[0].elements[i];
		if (elm.type == 'checkbox') {
			if (elm.checked==true) {
				elm.checked =false;
			}
			else {
				elm.checked = true;
			}
		}
	}
}

function redirectTo(redirectUrl){
	window.location.href=redirectUrl;
}

function linkify(inputText) {
	//function linkShorter(match){
	//	console.log(inputText);
	//	console.log(match);
	//	return match.substr(0,15);
	//}
	//replacedText = replacedText.replace(replacePattern2, linkShorter);

	var replacedText=inputText;
	//URLs starting with http://, https://, or ftp://
	replacedText = inputText.replace(replacePattern1, '<a href="$1" target="_blank">$1</a>');
	//URLs starting with www. (without // before it, or it'd re-link the ones done above)
	replacedText = replacedText.replace(replacePattern2, '$1<a href="http://$2" target="_blank">$2</a>');
	//Change email addresses to mailto:: links
	replacedText = replacedText.replace(replacePattern3, '<a href="mailto:$1">$1</a>');

	// (THREAD:5,123)
	// <span class='nicklink' onclick='forumClick($1,$2,event)'>Thread-link<\/span>
	replacedText = replacedText.replace(/\[code\](.*?)\[\/code\]/gi,"CODE:<div style='display: block;font-family: monospace;white-space: pre;'>$1<\/div>");

	// new attempt for screen-readers
	//replacedText = replacedText.replace(/\(COMBAT:([0-9]+)\)/gi,"<span tabindex='20' class='nicklink' onclick='loadFirstDataForCombat($1,event)'>Combat-link<\/span>");
	replacedText = replacedText.replace(/\(COMBAT:([0-9]+)\)/gi,"<a href='#' class='nicklink' onclick='loadFirstDataForCombat($1,event)'>Combat-link<\/a>");
	replacedText = replacedText.replace(/\(LAUNCH:([0-9]+)\)/gi,"<a href='#' title='Click to see combat. Right-click to see summary.' class='nicklink' onclick='loadFirstDataForCombat($1,event)' oncontextmenu='viewCombatSummaryClick($1,event)'>Combat-link<\/a>");
	replacedText = replacedText.replace(/\(SUMMARY:([0-9]+)\)/gi,"<a href='#' class='nicklink' onclick='viewCombatSummaryClick($1,event)'>Combat-summary<\/a>");
	replacedText = replacedText.replace(/\(THREAD:([0-9]+),([0-9]+)\)/gi,"<a href='#' class='nicklink' onclick='forumClick($1,$2,event)'>Thread-link<\/a>");

	replacedText = replacedText.replace(/\(COORDS:([0-9]+)\)/gi,"<a href='#' class='planetlink' onclick='zoomInTo($1)'>Link to $1<\/a>");
	replacedText = replacedText.replace(/\(COORDS:([0-9]+):([0-9]+)\)/gi,"<a href='#' class='planetlink' onclick='zoomInTo($1,$2)'>Link to $1:$2<\/a>");
	replacedText = replacedText.replace(/\(COORDS:([0-9]+):([0-9]+):([0-9]+)\)/gi,"<a href='#' class='planetlink' onclick='zoomInTo($1,$2,$3)'>Link to $1:$2:$3<\/a>");
	replacedText = replacedText.replace(/\(COORDS:([0-9]+):([0-9]+):([0-9]+):([0-9]+)\)/gi,"<a href='#' class='planetlink' onclick='zoomInTo($1,$2,$3,$4)'>Link to $1:$2:$3:$4<\/a>");
	replacedText = replacedText.replace(/\(COORDS:([0-9]+):([0-9]+):([0-9]+):([0-9]+):([0-9]+)\)/gi,"<a href='#' class='planetlink' onclick='zoomInTo($1,$2,$3,$4,$5)'>Planet at $1:$2:$3:$4:$5<\/a>");

	replacedText = replacedText.replace(/\(DEVITEM:([0-9]+):([a-z0-9 \!\'\.]+)\)/gi,"<a href='#' class='directlink' onclick='specialProcessOpenPanel(\"development\",$1,event);return false;'>$2<\/a>");
	replacedText = replacedText.replace(/\(RESITEM:([0-9]+):([a-z0-9 \!\'\.]+)\)/gi,"<a href='#' class='directlink' onclick='specialProcessOpenPanel(\"research\",$1,event);return false;'>$2<\/a>");
	replacedText = replacedText.replace(/\(FACITEM:([0-9]+):([a-z0-9 \!\'\.]+)\)/gi,"<a href='#' class='directlink' onclick='specialProcessOpenPanel(\"facility\",$1,event);return false;'>$2<\/a>");
	replacedText = replacedText.replace(/\(PRODITEM:([0-9]+):([a-z0-9 \!\'\.]+)\)/gi,"<a href='#' class='directlink' onclick='specialProcessOpenPanel(\"production\",$1,event);return false;'>$2<\/a>");

	replacedText = replacedText.replace(/\(PATCH\)/gi,"<a href='#' class='directlink' onclick='specialNavigateToLatestPatchNotes()'>Latest Patchnotes<\/a>");
	replacedText = replacedText.replace(/\(FAQ\)/gi,"<a href='#' class='directlink' onclick='showFAQ()'>F.A.Q.<\/a>");
	replacedText = replacedText.replace(/\(OPTIONS\)/gi,"<a href='#' class='directlink' onclick='openOptionsSlide()'>Options<\/a>");
	replacedText = replacedText.replace(/\(CREDITS\)/gi,"<a href='#' class='directlink' onclick='openSlide(\"purchaseslide\")'>Buy Credits<\/a>");
	replacedText = replacedText.replace(/\(ADINFO\)/gi,"<a href='#' class='directlink' onclick='$(\"#gameinfo\").click()'>TUTORIAL<\/a>");
	replacedText = replacedText.replace(/\(TUTORIAL\)/gi,"<a href='#' class='directlink' onclick='$(\"#gameinfo\").click()'>TUTORIAL<\/a>");

	replacedText = replacedText.replace(/\(CRUISERHELP\)/gi,"<a href='#' class='directlink' onclick='showCruiserHelp()'>How To Get Cruisers<\/a>");

	replacedText = replacedText.replace(/\(TUT:([a-z_0-9]+)\)/gi,"<a href='#' class='directlink' onclick='tutorialNavigation(\"$1\")'>Tutorial : $1<\/a>");
	replacedText = replacedText.replace(/Tutorial : first_steps_/gi,"Tutorial : ");
	replacedText = replacedText.replace(/Tutorial : alliances_/gi,"Tutorial : ");
	replacedText = replacedText.replace(/Tutorial : fleets_/gi,"Tutorial : ");
	replacedText = replacedText.replace(/Tutorial : combat_/gi,"Tutorial : ");

	//replacedText = replacedText.replace(/\(GAMEJAMLINK\)/gi,"<div class='gamejamlink' onclick='gameJamBox();'>THE LOST TREASURE<\/div>");

	replacedText=replaceGameObjectByName(replacedText);

	return replacedText;
}


function replaceGameObjectByName(inputText){
	var rePattern=/\(GameObject:([0-9]+)\)/gi;
	var r=inputText.replace(rePattern, function(a, b, c){
		var go=returnGameObjectById(b);
		var name=go.name || go.mission_name;
		var returnString="<a href='#' class='nicklink' onclick='showGameInfoBox("+b+",event)'>"+name+"<\/a>"
		return returnString;
	});
	return r;
}

function iconify(inputText){

	//var newText=inputText.replace(/\(:/gi, '<img align="middle" src="images/emoticons/niceday.png"/>');
	//newText=newText.replace(/:\)/gi, '<img align="middle" src="images/emoticons/niceday.png"/>');
	var newText=inputText.replace(/\(ooohhh\)/gi , '<img align="middle" height="30" alt="not true icon" src="images/emoticons/nottrue.png"/>');
	newText=newText.replace(/\(smile\)/gi , '<img align="middle" height="30" alt="smile-icon" src="images/emoticons/niceday.png"/>');
	newText=newText.replace(/\(wink\)/gi , '<img align="middle" height="30" alt="wink icon" src="images/emoticons/wink.png"/>');
	newText=newText.replace(/\(grin\)/gi , '<img align="middle" height="30" alt="grin icon" src="images/emoticons/grin.png"/>');
	newText=newText.replace(/\(tongue\)/gi , '<img align="middle" height="30" alt="tongue icon" src="images/emoticons/tongue.png"/>');

	newText=newText.replace(/\(blush\)/gi , '<img align="middle" height="30" src="images/emoticons/blush.png"/>');
	newText=newText.replace(/\(buh\)/gi , '<img align="middle" height="30" src="images/emoticons/buh.png"/>');
	newText=newText.replace(/\(sad\)/gi , '<img align="middle" height="30" src="images/emoticons/buh.png"/>');
	newText=newText.replace(/\(wut\)/gi , '<img align="middle" height="30" src="images/emoticons/wut.png"/>');
	newText=newText.replace(/\(cool\)/gi , '<img align="middle" height="30" src="images/emoticons/cool.png"/>');
	newText=newText.replace(/\(up\)/gi , '<img align="middle" height="30" src="images/emoticons/thumbup.png"/>');
	newText=newText.replace(/\(down\)/gi , '<img align="middle" height="30" src="images/emoticons/thumbdown.png"/>');
	newText=newText.replace(/\(mad\)/gi , '<img align="middle" height="30" src="images/emoticons/angry.png"/>');
	newText=newText.replace(/\(confused\)/gi , '<img align="middle" height="30" src="images/emoticons/blankstare.png"/>');
	newText=newText.replace(/\(cry\)/gi , '<img align="middle" height="30" src="images/emoticons/qq.png"/>');
	newText=newText.replace(/\(eek\)/gi , '<img align="middle" height="30" src="images/emoticons/help.png"/>');
	newText=newText.replace(/\(ehum\)/gi , '<img align="middle" height="30" src="images/emoticons/ehum.png"/>');
	newText=newText.replace(/\(phone\)/gi , '<img align="middle" height="30" src="images/emoticons/phone.png"/>');
	newText=newText.replace(/\(drink\)/gi , '<img align="middle" height="30"  alt="drink icon" src="images/emoticons/drink.png"/>');
	newText=newText.replace(/\(beverage\)/gi , '<img align="middle" height="30" alt="beverage icon" src="images/emoticons/beverage.png"/>');
	newText=newText.replace(/\(tup\)/gi , '<img align="middle" height="30"  alt="thumb up icon" src="images/emoticons/thumbup.png"/>');
	newText=newText.replace(/\(tdown\)/gi , '<img align="middle" height="30" alt="thumb down icon" src="images/emoticons/thumbdown.png"/>');
	newText=newText.replace(/\(sleepy\)/gi , '<img align="middle" height="30" alt="sleep icon"src="images/emoticons/zzz.png"/>');
	newText=newText.replace(/\(rolleyes\)/gi , '<img align="middle" height="30" alt="rolling eyes icon" src="images/emoticons/ehum.png"/>');
	newText=newText.replace(/\(pizza\)/gi , '<img align="middle" height="30" alt="pizza icon" src="images/emoticons/pizza.png"/>');
	newText=newText.replace(/\(cig\)/gi , '<img align="middle" height="30" alt="cigarette icon" src="images/emoticons/smoke.png"/>');
	newText=newText.replace(/\(smoke\)/gi , '<img align="middle" height="30" alt="cigarette icon" src="images/emoticons/smoke.png"/>');
	newText=newText.replace(/\(offside\)/gi , '<img align="middle" height="30" src="images/emoticons/offside.png"/>');
	newText=newText.replace(/\(rtfm\)/gi , '<img align="middle" height="30" src="images/emoticons/list.png"/>');
	newText=newText.replace(/\(angry\)/gi , '<img align="middle" height="30" alt="angry icon" src="images/emoticons/angry.png"/>');
	newText=newText.replace(/\(bandit\)/gi , '<img align="middle" height="30" src="images/emoticons/bandit.png"/>');
	newText=newText.replace(/\(beaten\)/gi , '<img align="middle" height="30" alt="beaten icon"src="images/emoticons/beaten.png"/>');
	newText=newText.replace(/\(blankstare\)/gi , '<img align="middle" height="30" alt="blank stare icon" src="images/emoticons/blankstare.png"/>');
	newText=newText.replace(/\(bleh\)/gi , '<img align="middle" height="30" alt="bleh icon" src="images/emoticons/bleh.png"/>');
	newText=newText.replace(/\(buh\)/gi , '<img align="middle" height="30" alt="buh icon" src="images/emoticons/buh.png"/>');
	newText=newText.replace(/\(burnt\)/gi , '<img align="middle" height="30" alt="burnt icon" src="images/emoticons/burnt.png"/>');
	newText=newText.replace(/\(darkmood\)/gi , '<img align="middle" height="30" alt="dark mood icon" src="images/emoticons/darkmood.png"/>');
	newText=newText.replace(/\(disappearing\)/gi , '<img align="middle" height="30" alt="disappearing icon" src="images/emoticons/disappearing.png"/>');
	newText=newText.replace(/\(dizzy\)/gi , '<img align="middle" height="30" alt="dizzy icon" src="images/emoticons/dizzy.png"/>');
	newText=newText.replace(/\(ehum\)/gi , '<img align="middle" height="30" alt="ehum icon" src="images/emoticons/ehum.png"/>');
	newText=newText.replace(/\(furious\)/gi , '<img align="middle" height="30" alt="furious icon" src="images/emoticons/furious.png"/>');
	newText=newText.replace(/\(gonnablow\)/gi , '<img align="middle" height="30" alt="gonna blow icon" src="images/emoticons/gonnablow.png"/>');
	newText=newText.replace(/\(grin\)/gi , '<img align="middle" height="30" alt="grin icon" src="images/emoticons/grin.png"/>');
	newText=newText.replace(/\(happydrunk\)/gi , '<img align="middle" height="30" alt="happy drunk icon" src="images/emoticons/happydrunk.png"/>');
	newText=newText.replace(/\(hide\)/gi , '<img align="middle" height="30" alt="hide icon" src="images/emoticons/hide.png"/>');
	newText=newText.replace(/\(hopeless\)/gi , '<img align="middle" height="30" alt="hopeless icon" src="images/emoticons/hopeless.png"/>');
	newText=newText.replace(/\(humhum\)/gi , '<img align="middle" height="30" alt="hum hum icon" src="images/emoticons/humhum.png"/>');
	newText=newText.replace(/\(innocent\)/gi , '<img align="middle" height="30" alt="innocent icon" src="images/emoticons/innocent.png"/>');
	newText=newText.replace(/\(kiss\)/gi , '<img align="middle" height="30" alt="kiss icon" src="images/emoticons/kiss.png"/>');
	newText=newText.replace(/\(lovestruck\)/gi , '<img align="middle" height="30" alt="lovestruck icon" src="images/emoticons/lovestruck.png"/>');
	newText=newText.replace(/\(ninja\)/gi , '<img align="middle" height="30" alt="ninja icon" src="images/emoticons/ninja.png"/>');
	newText=newText.replace(/\(omg\)/gi , '<img align="middle" height="30" alt="oh my god icon" src="images/emoticons/omg.png"/>');
	newText=newText.replace(/\(facepalm\)/gi , '<img align="middle" height="30" alt="facepalm icon" src="images/emoticons/newfacepalm.png"/>');
	newText=newText.replace(/\(thinking\)/gi , '<img align="middle" height="30" alt="facepalm icon" src="images/emoticons/thinking.png"/>');
	newText=newText.replace(/\(onfire\)/gi , '<img align="middle" height="30" alt="on fire icon" src="images/emoticons/onfire.png"/>');
	newText=newText.replace(/\(oreally\)/gi , '<img align="middle" height="30" alt="oh really icon" src="images/emoticons/oreally.png"/>');
	newText=newText.replace(/\(ouch\)/gi , '<img align="middle" height="30" alt="ouch icon" src="images/emoticons/ouch.png"/>');
	newText=newText.replace(/\(outrage\)/gi , '<img align="middle" height="30" alt="outrage icon" src="images/emoticons/outrage.png"/>');
	newText=newText.replace(/\(panic\)/gi , '<img align="middle" height="30" alt="panic icon" src="images/emoticons/panic.png"/>');
	newText=newText.replace(/\(phew\)/gi , '<img align="middle" height="30" alt="phew icon" src="images/emoticons/phew.png"/>');
	newText=newText.replace(/\(pissed\)/gi , '<img align="middle" height="30" alt="pissed icon" src="images/emoticons/pissed.png"/>');
	newText=newText.replace(/\(psst\)/gi , '<img align="middle" height="30" alt="psst icon" src="images/emoticons/psst.png"/>');
	newText=newText.replace(/\(sceptic\)/gi , '<img align="middle" height="30" alt="sceptic icon" src="images/emoticons/sceptic.png"/>');
	newText=newText.replace(/\(seriousbusiness\)/gi , '<img align="middle" height="30" alt="serious business icon" src="images/emoticons/seriousbusiness.png"/>');
	newText=newText.replace(/\(shout\)/gi , '<img align="middle" height="30" alt="shout icon" src="images/emoticons/shout.png"/>');
	newText=newText.replace(/\(shy\)/gi , '<img align="middle" height="30" alt="shy icon" src="images/emoticons/shy.png"/>');
	newText=newText.replace(/\(sick\)/gi , '<img align="middle" height="30" alt="sick icon" src="images/emoticons/sick.png"/>');
	newText=newText.replace(/\(slow\)/gi , '<img align="middle" height="30" alt="slow icon" src="images/emoticons/slow.png"/>');
	newText=newText.replace(/\(starstruck\)/gi , '<img align="middle" height="30" alt="starstruck icon" src="images/emoticons/starstruck.png"/>');
	newText=newText.replace(/\(whatever\)/gi , '<img align="middle" height="30" alt="whatever icon"src="images/emoticons/whatever.png"/>');
	newText=newText.replace(/\(whistle\)/gi , '<img align="middle" height="30" alt="whistle icon" src="images/emoticons/whistle.png"/>');
	newText=newText.replace(/\(x_x\)/gi , '<img align="middle" height="30" src="images/emoticons/x_x.png"/>');
	newText=newText.replace(/\(XD\)/gi , '<img align="middle" height="30" src="images/emoticons/XD.png"/>');
	newText=newText.replace(/\(yarr\)/gi , '<img align="middle" height="30" src="images/emoticons/yarr.png"/>');
	newText=newText.replace(/\(yawn\)/gi , '<img align="middle" height="30" src="images/emoticons/yawn.png"/>');
	newText=newText.replace(/\(zzz\)/gi , '<img align="middle" height="30" alt="sleep icon" src="images/emoticons/zzz.png"/>');
	newText=newText.replace(/\(stubborn\)/gi , '<img align="middle" height="30" alt="stubborn icon" src="images/emoticons/stubborn.png"/>');
	newText=newText.replace(/\(beer\)/gi , '<img align="middle" height="30" alt="beer icon" src="images/emoticons/beer.png"/>');
	newText=newText.replace(/\(wine\)/gi , '<img align="middle" height="30" alt="wine icon" src="images/emoticons/wine.png"/>');
	newText=newText.replace(/\(evilish\)/gi , '<img align="middle" height="30" alt="evil icon icon" src="images/emoticons/evilish.png"/>');
	newText=newText.replace(/\(glee\)/gi , '<img align="middle" height="30" alt="glee icon" src="images/emoticons/glee.png"/>');
	newText=newText.replace(/\(manic\)/gi , '<img align="middle" height="30" alt="manic icon" src="images/emoticons/manic.png"/>');
	newText=newText.replace(/\(mybad\)/gi , '<img align="middle" height="30" alt="my bad! icon" src="images/emoticons/mybad.png"/>');
	newText=newText.replace(/\(help\)/gi , '<img align="middle" height="30" alt="help icon" src="images/emoticons/help.png"/>');
	newText=newText.replace(/\(ratty\)/gi , '<img align="middle" height="30" alt="rat icon" src="images/emoticons/ratty.png"/>');
	newText=newText.replace(/\(dancemouse\)/gi , '<img align="middle" height="30" alt="dancing rat icon" src="images/emoticons/ratty.gif"/>');
	newText=newText.replace(/\(banana\)/gi , '<img align="middle" height="30" alt="banana icon" src="images/emoticons/banana.png"/>');
	newText=newText.replace(/\(cake\)/gi , '<img align="middle" height="30" alt="cake icon" src="images/emoticons/cake.png"/>');
	newText=newText.replace(/\(muhaha\)/gi , '<img align="middle" height="30" alt="muhaha icon" src="images/emoticons/muhaha.png"/>');
	newText=newText.replace(/\(lol\)/gi , '<img align="middle" height="30" alt="muhaha icon" src="images/emoticons/lol2.png"/>');
	newText=newText.replace(/\(lolcry\)/gi , '<img align="middle" height="30" alt="muhaha icon" src="images/emoticons/lol.png"/>');
	newText=newText.replace(/\(idk\)/gi , '<img align="middle" height="30" alt="I know nothing icon" src="images/emoticons/knownothing.png"/>');

	newText=newText.replace(/\(music\)/gi , '<img align="middle" height="30" alt="music icon" src="images/emoticons/music.png"/>');
	newText=newText.replace(/\(cheese\)/gi , '<img align="middle" height="30" alt="cheese icon" src="images/emoticons/cheese.png"/>');
	newText=newText.replace(/\(cookie\)/gi , '<img align="middle" height="30" alt="cookie icon" src="images/emoticons/cookie.png"/>');
	newText=newText.replace(/\(redcard\)/gi , '<img align="middle" height="30" src="images/emoticons/redcard.png"/>');
	newText=newText.replace(/\(yellowcard\)/gi , '<img align="middle" height="30" src="images/emoticons/yellowcard.png"/>');

	newText=newText.replace(/\(pale\)/gi , '<img align="middle" height="30" src="images/emoticons/pale.png"/>');
	newText=newText.replace(/\(coffee\)/gi , '<img align="middle" height="30" alt="coffee icon" src="images/emoticons/bettercoffee.png"/>');
	newText=newText.replace(/\(mug\)/gi , '<img align="middle" height="30" alt="coffee icon"src="images/emoticons/coffeemug.png"/>');

	newText=newText.replace(/\(pacman\)/gi , '<img align="middle" height="30" alt="pacman icon" src="images/emoticons/pacman.png"/>');
	newText=newText.replace(/\(eatbanana\)/gi , '<img align="middle" height="30" alt="banana icon" src="images/emoticons/eatbanana.png"/>');
	newText=newText.replace(/\(heart\)/gi , '<img align="middle" height="30" alt="heart icon" src="images/emoticons/heart.png"/>');

	newText=newText.replace(/\(cupofcoffee\)/gi , '<img align="middle" height="30" alt="coffee icon" src="images/emoticons/coffee_2.png"/>');
	newText=newText.replace(/\(cupoftea\)/gi , '<img align="middle" height="30" alt="tea icon" src="images/emoticons/tea_2.png"/>');

	newText=newText.replace(/\(birthday\)/gi , '<img align="middle" height="30" alt="tea icon" src="images/emoticons/birthday.png"/>');


	return newText;
}

function trimInput(elm){
	//console.log(elm);
	elm.value=elm.value.trim();
}

function prettyPrint(nStr){ // converts a number into a xxx.xxx.xxx format
    nStr += '';
    x = nStr.split('.');
    x1 = x[0];
    x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ' ' + '$2');
    }
    return x1 + x2;
}

function removeChildNodes(id){
	var element=document.getElementById(id);
	if (element){
		if ( element.hasChildNodes() ){
			while ( element.childNodes.length >= 1 ){
				element.removeChild( element.firstChild );
			}
		}
	}
}

function zeroPad(number){
	var numberString='';
	if (number<10){
		numberString='0'+number;
	}
	else {
		numberString=''+number;
	}
	return numberString;
}

function secondsToFullTime(seconds){
	// returns string like 04:30:29 in stead of XXXXXXX seconds
	// Actually, no...Show only the two largest indicators...
	// Use day_indicator etc as symbols followed by a space
	if (seconds<1)	{
		return "--";
	}

	if (seconds<60)	{
		return zeroPad(seconds)+second_indicator;
	}

	else if (seconds<3600){
		var minutes=Math.floor(seconds/60);
		var remaining_seconds=seconds-(minutes*60);

		//return minutes+':'+zeroPad(remaining_seconds);
		return minutes+minute_indicator+' '+zeroPad(remaining_seconds)+second_indicator;
	}

	else if (seconds<86400){
		var hours=Math.floor(seconds/3600);
		var remaining_seconds=seconds-(hours*3600);
		var minutes=Math.floor(remaining_seconds/60);
		remaining_seconds=remaining_seconds-(minutes*60);

		//return hours+':'+zeroPad(minutes)+':'+zeroPad(remaining_seconds);
		return hours+hour_indicator+' '+zeroPad(minutes)+minute_indicator;
	}
	else {
		var days=Math.floor(seconds/(24*3600));
		var remaining_seconds=seconds-(days*24*3600);
		var hours=Math.floor(remaining_seconds/3600);
		remaining_seconds=remaining_seconds-(hours*3600);
		var minutes=Math.floor(remaining_seconds/60);
		remaining_seconds=remaining_seconds-(minutes*60);

		//return days+':'+zeroPad(hours)+':'+zeroPad(minutes)+':'+zeroPad(remaining_seconds);
		return days+day_indicator+' '+zeroPad(hours)+hour_indicator;
	}
}



function secondsToFullTimeLong(seconds){
	// returns string like 04:30:29 in stead of XXXXXXX seconds
	// Actually, no...Show only the two largest indicators...
	// Use day_indicator etc as symbols followed by a space

	seconds=Math.round(seconds);

	if (seconds<60)	{
		return zeroPad(seconds)+second_indicator;
	}

	else if (seconds<3600){
		var minutes=Math.floor(seconds/60);
		var remaining_seconds=seconds-(minutes*60);

		//return minutes+':'+zeroPad(remaining_seconds);
		return minutes+minute_indicator+' '+zeroPad(remaining_seconds)+second_indicator;
	}

	else if (seconds<86400){
		var hours=Math.floor(seconds/3600);
		var remaining_seconds=seconds-(hours*3600);
		var minutes=Math.floor(remaining_seconds/60);
		remaining_seconds=remaining_seconds-(minutes*60);

		//return hours+':'+zeroPad(minutes)+':'+zeroPad(remaining_seconds);
		return hours+hour_indicator+' '+zeroPad(minutes)+minute_indicator+' '+zeroPad(remaining_seconds)+second_indicator;
	}
	else {
		var days=Math.floor(seconds/(24*3600));
		var remaining_seconds=seconds-(days*24*3600);
		var hours=Math.floor(remaining_seconds/3600);
		remaining_seconds=remaining_seconds-(hours*3600);
		var minutes=Math.floor(remaining_seconds/60);
		remaining_seconds=remaining_seconds-(minutes*60);

		//return days+':'+zeroPad(hours)+':'+zeroPad(minutes)+':'+zeroPad(remaining_seconds);
		return days+day_indicator+' '+zeroPad(hours)+hour_indicator+' '+zeroPad(minutes)+minute_indicator+' '+zeroPad(remaining_seconds)+second_indicator;
	}
}

function secondsToFullTimeNosecs(seconds){
	// returns string like 04:30:29 in stead of XXXXXXX seconds
	// Actually, no...Show only the two largest indicators...
	// Use day_indicator etc as symbols followed by a space

	if (seconds<60)	{
		return '&lt; 1'+minute_indicator;
	}

	else if (seconds<3600){
		var minutes=Math.floor(seconds/60);
		var remaining_seconds=seconds-(minutes*60);

		//return minutes+':'+zeroPad(remaining_seconds);
		return minutes+minute_indicator;
	}

	else if (seconds<86400){
		var hours=Math.floor(seconds/3600);
		var remaining_seconds=seconds-(hours*3600);
		var minutes=Math.floor(remaining_seconds/60);
		remaining_seconds=remaining_seconds-(minutes*60);

		//return hours+':'+zeroPad(minutes)+':'+zeroPad(remaining_seconds);
		return hours+hour_indicator+' '+zeroPad(minutes)+minute_indicator;
	}
	else {
		var days=Math.floor(seconds/(24*3600));
		var remaining_seconds=seconds-(days*24*3600);
		var hours=Math.floor(remaining_seconds/3600);
		remaining_seconds=remaining_seconds-(hours*3600);
		var minutes=Math.floor(remaining_seconds/60);
		remaining_seconds=remaining_seconds-(minutes*60);

		//return days+':'+zeroPad(hours)+':'+zeroPad(minutes)+':'+zeroPad(remaining_seconds);
		return days+day_indicator+' '+zeroPad(hours)+hour_indicator;
	}
}

function formatDateTimeShort(unix_timestamp){
	var date = new Date(unix_timestamp * 1000);

	var year= date.getFullYear();
	var month=date.getMonth()+1;
	var day= date.getDate();

	var hour= date.getHours();
	var minute= date.getMinutes();
	var second= date.getSeconds();

	//	return year+'/'+zeroPad(month)+'/'+zeroPad(day)+' '+zeroPad(hour)+':'+zeroPad(minute)+':'+zeroPad(second);
	return zeroPad(day)+'.'+zeroPad(month)+' '+zeroPad(hour)+':'+zeroPad(minute);

}

function formatDateTime(unix_timestamp){
	var date = new Date(unix_timestamp * 1000);

	var year= date.getFullYear();
	var month=date.getMonth()+1;
	var day= date.getDate();

	var hour= date.getHours();
	var minute= date.getMinutes();
	var second= date.getSeconds();

	//	return year+'/'+zeroPad(month)+'/'+zeroPad(day)+' '+zeroPad(hour)+':'+zeroPad(minute)+':'+zeroPad(second);
	return zeroPad(day)+'.'+zeroPad(month)+'.'+year+' '+zeroPad(hour)+':'+zeroPad(minute)+':'+zeroPad(second);

}

function formatDate(unix_timestamp){
	var date = new Date(unix_timestamp * 1000);

	var year= date.getFullYear();
	var month=date.getMonth()+1;
	var day= date.getDate();

	var hour= date.getHours();
	var minute= date.getMinutes();
	var second= date.getSeconds();

	//return year+'/'+zeroPad(month)+'/'+zeroPad(day);
	return zeroPad(day)+'.'+zeroPad(month)+'.'+year;

}

function convertToUTC(timestamp){
	var tmp=new Date;
	var utcTimestamp=timestamp+(tmp.getTimezoneOffset()*60);
	return utcTimestamp;
}

function formatShortTime(unix_timestamp){
	var date = new Date(unix_timestamp * 1000);
	var hour= date.getHours();
	var minute= date.getMinutes();

	//return year+'/'+zeroPad(month)+'/'+zeroPad(day);
	return zeroPad(hour)+':'+zeroPad(minute);

}

function formatShortDate(unix_timestamp){
	var date = new Date(unix_timestamp * 1000);

	var year= date.getFullYear();
	var month=date.getMonth()+1;
	var day= date.getDate();

	var hour= date.getHours();
	var minute= date.getMinutes();
	var second= date.getSeconds();

	return zeroPad(day)+'.'+zeroPad(month);
}


function formatMessageTimestamp(timestamp){
	var timeSinceTimestamp=ad2460.serverTime-timestamp;
	// It now holds number of seconds since event...
	// console.log(timeSinceTimestamp);
	if (timeSinceTimestamp<-7*24*3600){
		return Math.round(timeSinceTimestamp/(24*3600))+" days to go...";
	}
	else if (timeSinceTimestamp<-24*3600){
		return Math.round(timeSinceTimestamp/3600)+" hours to go...";
	}
	else if (timeSinceTimestamp<-3600){
		return Math.round(timeSinceTimestamp/60)+" minutes to go...";
	}
	else if (timeSinceTimestamp<5){
		return "Just now";
	}

	else if (timeSinceTimestamp<60){
		return "1 minute ago";
	}
	else if (timeSinceTimestamp<3600){
		return Math.round(timeSinceTimestamp/60)+" minutes ago";
	}
	else if (timeSinceTimestamp<(24*3600)){
		return Math.round(timeSinceTimestamp/3600)+" hours ago";
	}
	else if (timeSinceTimestamp<(7*24*3600)){
		return Math.round(timeSinceTimestamp/(24*3600))+" days ago";
	}
	else {
		return formatDate(timestamp);
	}
}

function formatShortMessageTimestamp(timestamp){
	var timeSinceTimestamp=ad2460.serverTime-timestamp;
	// It now holds number of seconds since event...
	//console.log(ad2460.serverTime);
	//console.log(timeSinceTimestamp);
	if (timeSinceTimestamp<60){
		return "1 m";
	}
	else if (timeSinceTimestamp<3600){
		return Math.round(timeSinceTimestamp/60)+" m";
	}
	else if (timeSinceTimestamp<(24*3600)){
		return Math.round(timeSinceTimestamp/3600)+" h";
	}
	else if (timeSinceTimestamp<(7*24*3600)){
		return Math.round(timeSinceTimestamp/(24*3600))+" d";
	}
	else {
		return formatShortDate(timestamp);
	}
}



function handleIdleTime(seconds){
	//console.log("Handeling idletime for "+seconds+ " seconds");
	ad2460.lastBlur=ad2460.lastFocus;
	if (seconds>30){
		fetchPlayerUpdates();
		fetchAllTechData();
		reloadAllMilitaryData();
		//fetchMyFleets('fetchOwnOutposts("reloadAllianceData()")');
		reloadProspectingMissions();
		loadAllIntel();
	}
	if (seconds>(15*60)){
		starmapViewLevel(1,0,0,0,0);
	}
}

function shortTechType(type){
	if (type=='Matter')	{
		return 'In';
	}
	else if (type=='Energy')	{
		return 'Stron';
	}
	else if (type=='Displacement')	{
		return 'Neo';
	}
	else if (type=='Combined')	{
		return '---';
	}
	else {
		return type;
	}
}

function fullTechType(type){
	if (type=='Matter')	{
		return 'InTech';
	}
	else if (type=='Energy')	{
		return 'StronTech';
	}
	else if (type=='Displacement')	{
		return 'NeoTech';
	}
	else if (type=='Combined')	{
		return '---';
	}
	else if (type=='Even')	{
		return 'Even';
	}
	else {
		return type;
	}
}

function convertShortCoordsToLongCoords(x,y){
	// Converts the coords and returns an object with the following parameters : quadrant,sector,cluster,system,position
	// Usage var coords=new longCoords(convertShortCoordsToLongCoords(x,y));

	x--;
	y--;
	var max_x = 1024;
	var max_y = 1024;
	var results=new Array;
	var quadrants=new Array;
	quadrants[0]=[4,4];
	quadrants[1]=[4,4];
	quadrants[2]=[4,4];
	quadrants[3]=[4,4];
	quadrants[4]=[4,4];
	for (quadrant=0;quadrant<quadrants.length ;quadrant++ ){
		// Euclidian Algorithm basics
		max_x = max_x / quadrants[quadrant][0];
		max_y = max_y / quadrants[quadrant][1];
		var q_x = Math.floor(x / max_x);
		var q_y = Math.floor(y / max_y);
		x %= max_x;
		y %= max_y;
		results.push(q_y * quadrants[quadrant][0] + q_x + 1);
	}

	var result=new Object;
	result.q=results[0];
	result.s=results[1];
	result.g=results[2];
	result.o=results[3];
	result.p=results[4];
	result.coordString=result.q+':'+result.s+':'+result.g+':'+result.o+':'+result.p;
	return (result);
}


function convertLongCoordsToShortCoords(quadrant,sector,cluster,system,position){
	// Converts the coords and returns an object with an x-param and an y-param
	// Usage var coords=new shortCoords(convertLongCoordsToShortCoords(quadrant,sector,cluster,system,position));

	var max_x = 1024;
	var max_y = 1024;

	var x=1;
	var y=1;

	var quadrants=new Array;
	quadrants[0]=[4,4];
	quadrants[1]=[4,4];
	quadrants[2]=[4,4];
	quadrants[3]=[4,4];
	quadrants[4]=[4,4];

	max_x=max_x/quadrants[0][0];
	var q_x_adder=max_x* ((quadrant-1) % quadrants[0][0]);

	max_x=max_x/quadrants[1][0];
	var s_x_adder=max_x* ((sector-1) % quadrants[1][0]);

	max_x=max_x/quadrants[2][0];
	var g_x_adder=max_x* ((cluster-1) % quadrants[2][0]);

	max_x=max_x/quadrants[3][0];
	var o_x_adder=max_x* ((system-1) % quadrants[3][0]);

	max_x=max_x/quadrants[4][0];
	var p_x_adder=max_x* ((position-1) % quadrants[4][0]);

	x=x+q_x_adder+s_x_adder+g_x_adder+o_x_adder+p_x_adder;
	//console.log(q_x_adder+" "+s_x_adder+" "+g_x_adder+" "+o_x_adder+" "+p_x_adder);

	max_y=max_y/quadrants[0][1];
	var q_y_adder=max_y * Math.floor((quadrant-1)/quadrants[0][1]);

	max_y=max_y/quadrants[1][1];
	var s_y_adder=max_y* Math.floor((sector-1) / quadrants[1][1]);

	max_y=max_y/quadrants[2][1];
	var g_y_adder=max_y* Math.floor((cluster-1) / quadrants[2][1]);

	max_y=max_y/quadrants[3][1];
	var o_y_adder=max_y* Math.floor((system-1) / quadrants[3][1]);

	max_y=max_y/quadrants[4][1];
	var p_y_adder=max_y* Math.floor((position-1) / quadrants[4][1]);

	y=y+q_y_adder+s_y_adder+g_y_adder+o_y_adder+p_y_adder;
	//console.log(q_y_adder+" "+s_y_adder+" "+g_y_adder+" "+o_y_adder+" "+p_y_adder);



	var result=new Object;
	result.x=x;
	result.y=y;

	//console.log(x+":"+y);

	return (result);
}

function returnProspectingTimeInMinutes(home_quadrant,home_sector,home_cluster,quadrant, sector, cluster){
	var homeCoords=convertLongCoordsToShortCoords(home_quadrant,home_sector,home_cluster,6,6);
	var targetCoords=convertLongCoordsToShortCoords(quadrant,sector,cluster,6,6);
	//console.log(homeCoords);
	//console.log(targetCoords);

	var distance=Math.abs(Math.sqrt( ((targetCoords.x-homeCoords.x)*(targetCoords.x-homeCoords.x)) + ((targetCoords.y-homeCoords.y)*(targetCoords.y-homeCoords.y))  ));
	var jumps=1+Math.floor(distance/16);
	var prospecting_time=15+(jumps*30);

	// OVERRIDE!!
	//Changed to 45 minutes, regardless
	prospecting_time=5;
	return prospecting_time;
}

function returnTravelTimeInMinutesNew(jump_range, p1, p2){
  // Both p1 and p2 need to have .x and .y for this to work
	/*
	if (jump_range<1) {
		jump_range=1;
	}
	var distance=Math.abs(Math.sqrt( ((p2.x-p1.x)*(p2.x-p1.x)) + ((p2.y-p1.y)*(p2.y-p1.y))  ));
	var jumps=Math.floor(distance/16);
	jumps=1+Math.floor(jumps/jump_range);
	var travel_time=(jumps-1)*ad2460.statics.jumpengine_recharge_time/60;
	return travel_time; // minutes
	*/

	var estimated_travel_time=calcEta(p1.x, p1.y, p2.x, p2.y, jump_range, false, false);
	var minutes=Math.floor(estimated_travel_time/60);
	return minutes;
	//var estimated_travel_time_string=secondsToFullTimeNosecs(estimated_travel_time);



}


function returnTravelTimeInMinutes(jump_range, home_quadrant, home_sector, home_cluster, quadrant, sector, cluster){
	//console.log("returnTravelTimeInMinutes called");
	var homeCoords=convertLongCoordsToShortCoords(home_quadrant,home_sector,home_cluster,6,6);
	var targetCoords=convertLongCoordsToShortCoords(quadrant,sector,cluster,6,6);

  if (jump_range<1) {
    jump_range=1;
  }

	var distance=Math.abs(Math.sqrt( ((targetCoords.x-homeCoords.x)*(targetCoords.x-homeCoords.x)) + ((targetCoords.y-homeCoords.y)*(targetCoords.y-homeCoords.y))  ));
	var jumps=Math.floor(distance/16);
	jumps=1+Math.floor(jumps/jump_range);
	var travel_time=(jumps-1)*ad2460.statics.jumpengine_recharge_time/60;

	return travel_time; // minutes
}

function calcDistance(x_a, y_a, x_b, y_b){
	var distance=Math.abs(Math.sqrt( ((x_a-x_b)*(x_a-x_b)) + ((y_a-y_b)*(y_a-y_b))  ));
	return distance;
}

function calcJumps(x_a, y_a, x_b, y_b, jump_range){
  //console.log("calcJumps called");
  if (jump_range<1) {
    jump_range=1;
  }
	var distance=Math.abs(Math.sqrt( ((x_a-x_b)*(x_a-x_b)) + ((y_a-y_b)*(y_a-y_b))  ));
	var jumps=Math.floor(distance/16);
	jumps=1+Math.floor(jumps/jump_range);
	return jumps;
}

function calcNextJumpCoords_old(current_x, current_y, destination_x, destination_y, jump_range){

	// function is incomplete, it does not consider jump-range...Always one I guess...
	// uhm, now it might.
  if (jump_range<1) {
    jump_range=1;
  }
	var distance=Math.abs(Math.sqrt( ((current_x-destination_x)*(current_x-destination_x)) + ((current_y-destination_y)*(current_y-destination_y))  ));
	var returnObject={x:destination_x,y:destination_y};

	var move_distance=16*jump_range;

	if (distance<=move_distance){
		return returnObject;
	}

	// converting to polar coordinates with the origo positioned at the destination
	var a=convertToPolar(current_x,current_y,destination_x,destination_y);
	// then we subtract 16 from the radius, moving the point 16 length-units closer to the "origo"
	var b=convertToCartesian(a.r-move_distance,a.t);

	// Rounding to nearest whole coordinate
	b.x=Math.round(b.x);
	b.y=Math.round(b.y);

	var tempcoords=convertShortCoordsToLongCoords(b.x,b.y);

	// Then forcing the position to be 1, as we jump to position 1 , always, the "sun"
	tempcoords.p=1;

	var jumpcoords=convertLongCoordsToShortCoords(tempcoords.q,tempcoords.s,tempcoords.g,tempcoords.o,tempcoords.p);
	// And there we have the jump-coords as jumpcoords.x and jumpcoords.y

	return jumpcoords;
}

function calcNextJumpCoords(current_x, current_y, destination_x, destination_y, jump_range){
  if (jump_range<1) {
    jump_range=1;
  }
	// supporting the jump_range attribute
	var jumpDistance=4*(16+((jump_range-1)*4));

	// calcing the total distance
	var distance=Math.abs(Math.sqrt( ((current_x-destination_x)*(current_x-destination_x)) + ((current_y-destination_y)*(current_y-destination_y))  ));
	//console.log(distance);
	// special case for handeling the last jump due to special position-coordinate, don't ask :)
	if (distance<=jumpDistance){
		var tempcoords=convertShortCoordsToLongCoords(destination_x,destination_y);
		var jumpcoords={};
		jumpcoords.x=destination_x;
		jumpcoords.y=destination_y;
		jumpcoords.quadrant=tempcoords.q;
		jumpcoords.sector=tempcoords.s;
		jumpcoords.cluster=tempcoords.g;
		jumpcoords.system=tempcoords.o;
		jumpcoords.position=tempcoords.p;
		return jumpcoords;
	}

	var dx=(destination_x-current_x) / distance ; // delta x
	var dy=(destination_y-current_y) / distance ; // delta y

	var x2=Math.floor(current_x+(jumpDistance*dx)); // the next x-point
	var y2=Math.floor(current_y+(jumpDistance*dy)); // the next y-point

	var tempcoords=convertShortCoordsToLongCoords(x2,y2);
	// Then forcing the position to be 1, as we jump to position 1 , always, the "sun"
	tempcoords.p=1;

	var jumpcoords=convertLongCoordsToShortCoords(tempcoords.q,tempcoords.s,tempcoords.g,tempcoords.o,tempcoords.p);
	jumpcoords.quadrant=tempcoords.q;
	jumpcoords.sector=tempcoords.s;
	jumpcoords.cluster=tempcoords.g;
	jumpcoords.system=tempcoords.o;
	jumpcoords.position=tempcoords.p;

	return jumpcoords;
}

function calcEta(x1, y1, x2, y2, jump_range, add_resource_fill_time, empty_batteries){
  x1=parseInt(x1);
  x2=parseInt(x2);
  y1=parseInt(y1);
  y2=parseInt(y2);

  if (jump_range<1) {
    jump_range=1;
  }

	var route=returnJumpRoute(x1, y1, x2, y2, jump_range);

	var travelTimeInSeconds=((route.length-1)*ad2460.statics.jumpengine_recharge_time);
	if (empty_batteries==true){
		travelTimeInSeconds+=ad2460.statics.jumpengine_recharge_time;
	}
	if (add_resource_fill_time==true){
		travelTimeInSeconds+=ad2460.statics.resource_fill_time;
	}

	// This SHOULD be right! ffs!

	return travelTimeInSeconds;

}

function returnJumpRoute(current_x, current_y, destination_x, destination_y, jump_range){
	var route=new Array;

  if (jump_range<1) {
    jump_range=1;
  }

	while (current_x!=destination_x || current_y!=destination_y){
		var point=calcNextJumpCoords(current_x, current_y, destination_x, destination_y, jump_range);
		route.push(point);
		current_x=point.x;
		current_y=point.y;
	}
	// console.log(route.length);
	return route;
}

function convertLineBreaks(string){
	//string=string.replace('\n','<br/>');
	string=string.replace(/\n/gi, "<br/>");
	return (string);
}

function createSingleElement(tag, classname, id, text, onclick){
	var element=document.createElement(tag);
	if (classname != ''){
		element.setAttribute('class',classname);
	}
	if (id != ''){
		element.setAttribute('id',id);
	}

	if (tag == 'img'){
		if (text!=''){
			element.setAttribute('src',text);
		}
	}
	if (tag == 'input'){
		if (text!=''){
			element.setAttribute('value',''+text);
		}
	}

	if (tag == 'div' || tag == 'span' || tag=='th' || tag=='td' ){
		if (text!=''){
			element.innerHTML=text;
		}
	}

	if (onclick!=''){
		if (tag=='select'){
			element.setAttribute('onchange',onclick);
		}
		else {
			element.setAttribute('onclick',onclick);
		}

	}

	return element;
}

function createButtonElement(text,classname,inner_classname,onclick,id){
	// Creates and returns a standard button
	var button=document.createElement('div');
	button.setAttribute('class',classname);
	button.setAttribute('onclick',onclick);
	button.setAttribute('id',id);

	var buttontext=document.createElement('div');
	buttontext.setAttribute('class',inner_classname);
	buttontext.setAttribute('id',id+'_button_text');
	buttontext.innerHTML=text;

	button.appendChild(buttontext);

	return button;
}

function killNode(id){
	if (document.getElementById(id)){
		var element=document.getElementById(id);
		element.parentNode.removeChild(element);
	}
}

function convertToPolar(x,y, zeroX, zeroY){

	var r=Math.sqrt(Math.pow(x-zeroX,2)+Math.pow(y-zeroY,2));
	var t=Math.atan2(y-zeroY,x-zeroX);

	var coordsObj={};
	coordsObj.r=r;
	coordsObj.t=t;
	coordsObj.x=x;
	coordsObj.y=y;
	return coordsObj;
}
function convertToCartesian(r,t){
	var x=r*Math.cos(t);
	var y=r*Math.sin(t);

	var coordsObj={};
	coordsObj.r=r;
	coordsObj.t=t;
	coordsObj.x=x;
	coordsObj.y=y;
	return coordsObj;
}

function forceInsideStarmap(coords){
	// new attempt
	coords.x+=0;
	coords.y+=0;

	//return coords;

	/*
	if (coords.x<1 || coords.y<1){
		// console.log(coords);
	}
	if (coords.x>=0 && coords.x<8){
		coords.x=8;
	}
	if (coords.y>=0 && coords.y<8){
		coords.y=8;
	}
	if (coords.x>=(canvaswidth-8) && coords.x<=canvaswidth){
		coords.x=canvaswidth-8;
	}
	if (coords.y>=(canvasheight-8) && coords.y<=canvasheight){
		coords.y=canvasheight-8;
	}
	*/

	// avoid the lines?
	// doesn't work really
	if (coords.x<3 && coords.x>0)	{	coords.x=3;	}
	if (coords.x<100 && coords.x>97){	coords.x=97;	}
	if (coords.x<200 && coords.x>197){	coords.x=197;	}
	if (coords.x<300 && coords.x>297){	coords.x=297;	}
	if (coords.x<400 && coords.x>397){	coords.x=397;	}

	if (coords.x>=100 && coords.x<103){	coords.x=103;	}
	if (coords.x>=200 && coords.x<203){	coords.x=203;	}
	if (coords.x>=300 && coords.x<303){	coords.x=303;	}

	if (coords.y<3 && coords.y>0)			{	coords.y=3;	}
	if (coords.y<100 && coords.y>97){	coords.y=97;	}
	if (coords.y<200 && coords.y>197){	coords.y=197;	}
	if (coords.y<300 && coords.y>297){	coords.y=297;	}
	if (coords.y<400 && coords.y>397){	coords.y=397;	}

	if (coords.y>=100 && coords.y<103){	coords.y=103;	}
	if (coords.y>=200 && coords.y<203){	coords.y=203;	}
	if (coords.y>=300 && coords.y<303){	coords.y=303;	}


	return coords;


}

function convertGlobalCoordsToDrawCoords(x,y){
	x--;
	y--;

	var level=getCurrentZoomLevel();
	if (level=='galaxy'){
		var coords={};
		//coords.x=Math.floor(x*canvaswidth/1024);
		//coords.y=Math.floor(y*canvasheight/1024);
		coords.x=(x*canvaswidth/1024);
		coords.y=(y*canvasheight/1024);
		coords=forceInsideStarmap(coords);
		//console.log(coords);
		return coords;
	}
	else if (level=='quadrant'){
		var coords={};
		coords.x=x;
		coords.y=y;

		//console.log("adjusting for quadrantCoords "+ad2460.starmap.quadrantCoords[0]+" "+ad2460.starmap.quadrantCoords[1]);

		coords.x=coords.x-((ad2460.starmap.quadrantCoords[0]-1)*256);
		coords.y=coords.y-((ad2460.starmap.quadrantCoords[1]-1)*256);

		//coords.x=Math.floor(coords.x*4*canvaswidth/1024);
		//coords.y=Math.floor(coords.y*4*canvaswidth/1024);
		coords.x=(coords.x*4*canvaswidth/1024);
		coords.y=(coords.y*4*canvaswidth/1024);

		coords=forceInsideStarmap(coords);


		//console.log(coords);
		return coords;
	}
	else if (level=='sector'){
		var coords={};
		coords.x=x;
		coords.y=y;

		//console.log("adjusting for quadrantCoords "+ad2460.starmap.quadrantCoords[0]+" "+ad2460.starmap.quadrantCoords[1]);

		coords.x=coords.x-((ad2460.starmap.quadrantCoords[0]-1)*256);
		coords.y=coords.y-((ad2460.starmap.quadrantCoords[1]-1)*256);

		coords.x=coords.x-((ad2460.starmap.sectorCoords[0]-1)*64);
		coords.y=coords.y-((ad2460.starmap.sectorCoords[1]-1)*64);

		//coords.x=Math.floor(coords.x*4*4*canvaswidth/1024);
		//coords.y=Math.floor(coords.y*4*4*canvaswidth/1024);
		coords.x=(coords.x*4*4*canvaswidth/1024);
		coords.y=(coords.y*4*4*canvaswidth/1024);

		coords=forceInsideStarmap(coords);
		// console.log(coords);
		return coords;
	}
	else if (level=='cluster'){
		var coords={};
		coords.x=x;
		coords.y=y;

		coords.x=coords.x-((ad2460.starmap.quadrantCoords[0]-1)*256);
		coords.y=coords.y-((ad2460.starmap.quadrantCoords[1]-1)*256);

		coords.x=coords.x-((ad2460.starmap.sectorCoords[0]-1)*64);
		coords.y=coords.y-((ad2460.starmap.sectorCoords[1]-1)*64);

		coords.x=coords.x-((ad2460.starmap.clusterCoords[0]-1)*16);
		coords.y=coords.y-((ad2460.starmap.clusterCoords[1]-1)*16);

		coords.x=(coords.x*4*4*4*canvaswidth/1024);
		coords.y=(coords.y*4*4*4*canvaswidth/1024);

		coords.x+=10;
		coords.y+=10;


		coords=forceInsideStarmap(coords);

		return coords;
	}
}


function return_output_potential(total_output){
	if		(total_output<=70000) {		return 1;	}
	else if (total_output<=75000) {		return 2;	}
	else if (total_output<=80000) {		return 3;	}
	else if (total_output<=85000) {		return 4;	}
	else if (total_output<=90000) {		return 5;	}
	else if (total_output<=100000) {	return 6;	}
	else if (total_output<=125000) {	return 7;	}
	else if (total_output<=150000) {	return 8;	}
	else if (total_output<=175000) {	return 9;	}
	else {								return 10;	}
}

function return_output_potential_string(potential){
	if		(potential==0) {	return translations.general_acceptable;	}
	else if	(potential==1) {	return translations.general_ok;	}
	else if	(potential==2) {	return translations.general_decent;	}
	else if	(potential==3) {	return translations.general_adequate;	}
	else if	(potential==4) {	return translations.general_plain;	}
	else if	(potential==5) {	return translations.general_average;	}
	else if	(potential==6) {	return translations.general_fair;	}
	else if	(potential==7) {	return translations.general_good;	}
	else if	(potential==8) {	return translations.general_very_good;	}
	else if	(potential==9) {	return translations.general_superb;	}
	else if	(potential==10) {	return translations.general_excellent;	}

	else {return translations.general_unknown;}
}

function return_outpost_storage(level){
	if (level==0) {	return 5000; }
	return ad2460.outpostStorageLevels[level];
}

function returnNextOutpostProductionOutput(outpost){
	var returnObj={};
	returnObj.hassium='N/A';
	returnObj.neodymium='N/A';
	returnObj.strontium='N/A';
	returnObj.indium='N/A';

	returnObj.hassiumAmount=0;
	returnObj.neodymiumAmount=0;
	returnObj.strontiumAmount=0;
	returnObj.indiumAmount=0;

	if (outpost.level<10){
		var tempLevel=outpost.level+1;

		returnObj.hassium=parseInt(outpost.max_output_hassium/100*ad2460.outpostOutputPercentages[tempLevel])+' u\/h';
		returnObj.neodymium=parseInt(outpost.max_output_neodymium/100*ad2460.outpostOutputPercentages[tempLevel])+' u\/h';
		returnObj.strontium=parseInt(outpost.max_output_strontium/100*ad2460.outpostOutputPercentages[tempLevel])+' u\/h';
		returnObj.indium=parseInt(outpost.max_output_indium/100*ad2460.outpostOutputPercentages[tempLevel])+' u\/h';
		returnObj.hassiumAmount=parseInt(outpost.max_output_hassium/100*ad2460.outpostOutputPercentages[tempLevel]);
		returnObj.neodymiumAmount=parseInt(outpost.max_output_neodymium/100*ad2460.outpostOutputPercentages[tempLevel]);
		returnObj.strontiumAmount=parseInt(outpost.max_output_strontium/100*ad2460.outpostOutputPercentages[tempLevel]);
		returnObj.indiumAmount=parseInt(outpost.max_output_indium/100*ad2460.outpostOutputPercentages[tempLevel]);

	}

	return returnObj;
}

function returnOutpostUpgradeTime(outpost){
	var hours=ad2460.outpostUpgradeTimeInHours[outpost.level];
	var seconds=hours*60*60;

	return seconds;

}

function returnCargoCapacity(id){
	var capacity=0;
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==id){
			if (ad2460.productionitems[i].cargo_capacity>0){
				capacity+=ad2460.productionitems[i].cargo_capacity;
			}
		}
	}
	return capacity;
}

function returnAvailableProspectingShips(){
	var i=0;
	var total=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		var thisFleet=ad2460.myFleets[i];
		if (thisFleet.storage_fleet==1){
			var thisStorage=thisFleet.storage;
			var a=0;
			for (a=0; a < thisStorage.length ; a++ ){
				if (thisStorage[a].ship_type_id==431){
					total+=thisStorage[a].counter;
				}
			}
		}
	}
	return total;
}

function returnFleetById(id){
	var i=0;
	for (i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].fleet_id==id){
			return ad2460.myFleets[i];
		}
	}

	if (ad2460.allianceData.id>0){
		if (ad2460.allianceData.bank.fleet.fleet_id==id){
			return ad2460.allianceData.bank.fleet;
		}
	}

	if (ad2460.allianceData.id>0){
		for (var s=0;s<ad2460.allianceData.stations.length ;s++ ){
			for (var f=0;f<ad2460.allianceData.stations[s].fleets.length ;f++ ){
				if (ad2460.allianceData.stations[s].fleets[f].fleet_id==id){
					return ad2460.allianceData.stations[s].fleets[f];
				}
			}
		}
	}

	// Alliance-fleet support...
	var m=0;
	for (m=0;m<ad2460.allianceData.memberlist.length ;m++ ){
		for (i=0;i<ad2460.allianceData.memberlist[m].allianceFleets.length ;i++ ){
			if (ad2460.allianceData.memberlist[m].allianceFleets[i].fleet_id==id){
				return ad2460.allianceData.memberlist[m].allianceFleets[i];
			}
		}
	}




	return false;
}

function returnProductionItem(id){
	var i=0;
	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==id){
			return ad2460.productionitems[i];
		}
	}
}

function returnLocationName(x,y){
	// dodgy little client-thing to avoid calling the server.
	// Look for xy-matches in homeworld, in outposts, in the alliance, in the alliancecache...
	// If not found, return long coords

	if (ad2460.homeworld.x==x && ad2460.homeworld.y==y){
		return ad2460.homeworld.name;
	}

	var i=0;
	for (i=0;i<ad2460.outposts.length ;i++ ){
		if (ad2460.outposts[i].x==x && ad2460.outposts[i].y==y){
			return ad2460.outposts[i].name;
		}
	}

	for (i=0;i<ad2460.allianceData.memberlist.length ;i++ ){
		if (ad2460.allianceData.memberlist[i].x==x && ad2460.allianceData.memberlist[i].y==y){
			return ad2460.allianceData.memberlist[i].name;
		}
	}

	var m=0;
	for (i=0;i<ad2460.allianceCache.length ;i++ ){
		for (m=0;m<ad2460.allianceCache[i].members.length ;m++ ){
			if (ad2460.allianceCache[i].members[m].x==x && ad2460.allianceCache[i].members[m].y==y){
				return ad2460.allianceCache[i].members[m].name;
			}
		}
	}

	// Still not found one? Unf..
	var coords=convertShortCoordsToLongCoords(x,y);
	return ""+coords.q+":"+coords.s+":"+coords.g+":"+coords.o+":"+coords.p;


}

function returnFacilityById(id){
	var i=0;
	for (i=0;i<ad2460.facilities.length ;i++ ){
		if (ad2460.facilities[i].id==id){
			return ad2460.facilities[i];
		}
	}
	return false;
}

function extractLastName(fullname){
	var names=fullname.split(" ");
	return names[names.length-1];
}

function returnShortName(fullname){
  var names=fullname.split(" ");

  var firstname="";
  var initial="";
  if (names.length>1){
    firstname=names[0];
    initial=firstname.substring(0,1)+". ";
  }

  var lastname=names[names.length-1];
  var shortname=initial+lastname;

  return shortname;
}

function clearPlayerRankings(){
	ad2460.playerRankings=new Array;
}

function addPlayerRanking(user_id, nickname, value, rank, x, y, homeworld){
	ad2460.playerRankings.push(new playerRanking(user_id, nickname, value, rank, x, y, homeworld));
}

function panelCloseCallback(id){
	// Do what you want based on the id of the main-panel after it has been closed.

	if (id=='production'){

			restoreHelperChecklist();

	}
	else if (id=='facility'){

			restoreHelperChecklist();

	}
	else if (id=='research'){

			restoreHelperChecklist();

	}
	else if (id=='development'){

			restoreHelperChecklist();

	}
	else if (id=='combat_log'){
		unrenderCombatLogList();
	}

	if (id.match(/outpost_([0-9])_panel/)){
		//console.log("outpost panel closed!");
		// I want the planet-id of the corresponding outpost!
		var numb = id.match(/\d/g);
		var number = numb.join("");

		var planetId=ad2460.outposts[number].planet_id;
		if (ad2460.outpostVars.fleet_overview_commander_open==true){
			outpostDefensiveCommanderPanelClick(planetId);
		}
		if (ad2460.outpostVars.fleet_overview_tactics_open==true){
			outpostTacticsPanelClick(planetId);
		}

	}

}

function panelOpenCallback(id){
	// Do what you want based on the id of the main-panel after it has been opened.
	if (id=='alliance_management'){
		//allianceManagementAllianceInformationClick();
		setTimeout('$("#view_all_info").click()',50);
		//$("#view_all_info").click();
	}
	else if (id=='intelligence_panel'){
		renderIntelligenceLog(0);
	}
	else if (id=='production'){
		renderProductionQueue();
		if (checklistOpen==1){
			moveHelperChecklistProduction();
		}
	}
	else if (id=='facility'){
		if (checklistOpen==1){
			moveHelperChecklist();
		}
	}
	else if (id=='research'){
		if (checklistOpen==1){
			moveHelperChecklistProduction();
		}
	}
	else if (id=='development'){
		if (checklistOpen==1){
			moveHelperChecklistProduction();
		}
	}
}

function alertSystemToPanelClosed(id){
	// console.log("Closed panel "+id);
	if (id=='alliance_management'){
		if (ad2460.openQuickMenues.selected_fleet_tactics==true){
			fleetTacticsPanelDown();
		}
		if (ad2460.openQuickMenues.all_ships=true){
			shipListDown();
		}
		ad2460.fleetvars.selected_fleet_id=0;
		removeChildNodes('fleet_composition_container');

		ad2460.allianceData.lastAllianceMenuSelected="none";
	}
	if (id=='commanders'){
		checkForUnspentCommanderPoints();
	}
}

function alertSystemToPanelOpened(id){
	// function to catch panel-openings, in case we need to subselect something :)
	// console.log(id);

	// closing some quickmenues regardless of which panels are opened.
	if (ad2460.openQuickMenues.selected_fleet_tactics==true){
		fleetTacticsPanelDown();
	}
	if (ad2460.openQuickMenues.all_ships=true){
		shipListDown();
	}


	if (id.substr(0,7)=='outpost'){
		reRenderOutpostUpgradeAmounts();
	}

	else if (id=='alliancemanagement_panel'){
		$("#view_motd").click();
	}
	else if (id=='alliancedev'){
		updateAllianceProjectBoxes();
	}
	else if (id=='marketplace'){
		refreshAllianceTrades();
	}
	else if (id=='production'){
		reSelectProductionItem();
		$("#infopanel_production_queue_container").css("top","0px");
		checkScrollButtonStatus('infopanel_production_queue_container');
		if (ad2460.scores.level<4){
			blinkElementById('production_filter_slider',5);
		}
	}
	else if (id=='facility'){
		reSelectFacilityItem();
		var f=returnGameObjectById(370);

		if (f.user_id<1){
			facilityContainerClick(367,23,null);
			blinkElementById("facility_item_367");
			blinkElementById("facility_item_367");
			blinkElementById("facilities_info_addon_header_1");
			blinkElementById("facilities_info_addon_header_1");
			facilityInfoClick(370,0,null);
		}
	}
	else if (id=='research'){
		reSelectResearchItem();
		if (ad2460.scores.level<4){
			blinkElementById('production_filter_slider',5);
		}
		var f=returnGameObjectById(101);
		if (f.user_id<1){
			blinkElementById("research_101");
			blinkElementById("research_101");
		}

	}
	else if (id=='development'){
		reSelectDevelopmentItem();
		if (ad2460.scores.level<4){
			blinkElementById('production_filter_slider',5);
		}

		var f=returnGameObjectById(232);
		if (f.user_id<1){
			blinkElementById("development_232");
			blinkElementById("development_232");
		}
	}
	else if (id=='combat_log'){
		renderCombatLogList();
	}
	else if (id=='commanders'){
		if (ad2460.scores.level==1){
			blinkElementById('war_academy_recruits_link');
			blinkElementById('war_academy_recruits_link');
		}

	}


}

function alertSystemToSlideOpened(id){
  if(static_page==true){
    return;
  }

	if (id=='supportslide') {
		fetchMySupport();
	}

	if (id=='techtreeslide'){
		denyLadyHelp=true;
		hideHelpCommander();
		if (ad2460.techVariables.spentTechPointsMatter+ad2460.techVariables.spentTechPointsEnergy+ad2460.techVariables.spentTechPointsDisplacement==0){
			var heading="The Tech Tree";
			var text="This is the Tech Tree where you issue points to specialize in different technologies.<br>As long as you are below level 8, you may reset these points for free. Once you reach level 8, a reset costs 5 credits.<br><br>Techpoints are awarded for various accomplishments in the game, click on List Of Points to see them.<br><br>Spend your points carefully after considering what you want to accomplish and how you wish to play."
			setTimeout("showSimpleBox('"+heading+"','"+text+"')",800);
		}
	}
	if (id=='rankingslide'){
		selectPlayerRankings();
	}
  if (id=='noteslide'){
    if(ad2460.noteVars.notes.length==0){
      loadNotes();
    }
  }

	if (id=='starmapslide'){
		moveHelperChecklistStarmap();
    if ($("#single_infiltration_report").is(":visible")){
      $("#single_infiltration_report").animate({left: "273px"}, 500);
    }
	}
	if (id=='missionslide'){
		moveHelperChecklistMissions();
	}

  if (id=='forumcategories'){
    $("#forumopenbutton").addClass("adv_selected");
  }
  if (id=='mailslide'){
    $("#messagesbutton").addClass("adv_selected");
  }

  if (id=='optionsslide'){
    $("#optionsbutton").addClass("adv_selected");
	checkInitialVipStatus();
  }
  if (id=='purchaseslide'){
    $("#creditsbutton").addClass("adv_selected");
  }
  if (id=='techtreeslide'){
    $("#techtreebutton").addClass("adv_selected");
  }
  if (id=='rankingslide'){
    $("#rankingbutton").addClass("adv_selected");
  }
  if (id=='noteslide'){
    $("#notesbutton").addClass("adv_selected");
  }
  if (id=='economy_slide'){
    $("#economy_button").addClass("adv_selected");
  }
  if (id=='opt02slide'){
    $("#opt_02_button").addClass("adv_selected");
  }
  if (id=='opt03slide'){
    $("#opt_03_button").addClass("adv_selected");
  }


}

function alertSystemToSlideClosed(id){
  if (id=='techtreeslide'){
		if (ad2460.techVariables.spentTechPointsMatter+ad2460.techVariables.spentTechPointsEnergy+ad2460.techVariables.spentTechPointsDisplacement==0){
      hideSimpleBox();
	  denyLadyHelp=false;
    }
  }
	if (id=='starmapslide'){
    restoreHelperChecklist();
    if ($("#single_infiltration_report").is(":visible")){
      $("#single_infiltration_report").animate({left: "653px"}, 500);
    }
  }


  if (id=='forumcategories'){
    $("#forumopenbutton").removeClass("adv_selected");
  }
  if (id=='mailslide'){
    $("#messagesbutton").removeClass("adv_selected");
  }
  if (id=='optionsslide'){
    $("#optionsbutton").removeClass("adv_selected");
  }
  if (id=='purchaseslide'){
    $("#creditsbutton").removeClass("adv_selected");
  }
  if (id=='techtreeslide'){
    $("#techtreebutton").removeClass("adv_selected");
  }
  if (id=='rankingslide'){
    $("#rankingbutton").removeClass("adv_selected");
  }
  if (id=='noteslide'){
    $("#notesbutton").removeClass("adv_selected");
  }
  if (id=='economy_slide'){
    $("#economy_button").removeClass("adv_selected");
  }
  if (id=='opt02slide'){
    $("#opt_02_button").removeClass("adv_selected");
  }
  if (id=='opt03slide'){
    $("#opt_03_button").removeClass("adv_selected");
  }

	/*
		if (id=='missionslide'){
			denyLadyHelp=false;
			console.log("Allowing big lady!");
		}
	*/
}


function returnMapRotation(quadrant, sector, cluster, system, planet){
	var returnString='0deg';

	if (isNaN(quadrant)){	quadrant=0;	}
	if (isNaN(sector)){		sector=0;	}
	if (isNaN(cluster)){	cluster=0;	}
	if (isNaN(system)){		system=0;	}
	if (isNaN(planet)){		planet=0;	}

	var toLevel=1;
	if (quadrant>0){ toLevel=2;	}
	if (sector>0){ toLevel=3;	}
	if (cluster>0){ toLevel=4;	}
	if (system>0){ toLevel=5;	}
	if (planet>0){ toLevel=5;	}

	Math.seedrandom((quadrant+1)*(sector+1)*(cluster+1)*(system+1));
	var tempresult=Math.floor(Math.random()*100);

	var result;

	if (tempresult<25){
		result=0;
	}
	else if (tempresult<50){
		result=90;
	}
	else if (tempresult<75){
		result=180;
	}
	else{
		result=270;
	}

	if (sector==0){
		result=0;
	}

	//console.log(result+'deg');

	return result+'deg';

}

function returnMapBGName(quadrant, sector, cluster, system, planet){
	//console.log(quadrant, sector, cluster, system, planet);
	var returnValue=1;

	var maxNum=30;
	var minNum=1;

	var prefix='';

	if (!isNaN(quadrant)){	prefix='quadrant_';}
	if (!isNaN(sector)){	prefix='sec_cls_';}

	if (isNaN(quadrant)){	quadrant=0;}
	if (isNaN(sector)){		sector=0;}
	if (isNaN(cluster)){	cluster=0;}



	// Gotcha
	if (quadrant<1){
		//console.log('newgalaxyfull.jpg');
		 return 'newgalaxyfull.jpg';
	}

	Math.seedrandom((quadrant+1)*(sector+1)*(cluster+1));
	returnValue=Math.floor(Math.random() * (maxNum - minNum) + minNum);
	if (sector<1){
		returnValue=quadrant;
	}

	return prefix+zeroPad(returnValue)+'.jpg';
}

function degreesToRadians(degrees){
	var r=degrees * (Math.PI/180);
	return r;
}

function fillIn(string,vars){
	// Expects a string to process and an array of variables to sort out
	var i=0;
	for (i=0;i<vars.length ;i++ ){
		var patternNum=parseInt(i+1);
		var pattern='?'+patternNum+'?';
		string=string.replace(pattern,vars[i]);
	}
	return string;
}

function returnGameObjectById(id){
	var item=false;
	// first we find the item
	var i=0;

	if (id>=101 && id <=200){
		for (i=0;i<ad2460.researches.length ;i++ ){
			if (ad2460.researches[i].id==id){
				item=ad2460.researches[i];
				item.item_type='Research';
				return item;
			}
		}
	}

	if (id>=201 && id <=300){
		for (i=0;i<ad2460.developments.length ;i++ ){
			if (ad2460.developments[i].id==id){
				item=ad2460.developments[i];
				item.item_type='Development';
				return item;
			}
		}
	}

	if (id>=301 && id <=400){
		for (i=0;i<ad2460.facilities.length ;i++ ){
			if (ad2460.facilities[i].id==id){
				item=ad2460.facilities[i];
				item.item_type='Facility';
				return item;
			}
		}
	}

	if (id>=800 && id <=899){
		for (i=0;i<ad2460.techitems.length ;i++ ){
			if (ad2460.techitems[i].id==id){
				item=ad2460.techitems[i];
				item.item_type='Techitem';
				return item;
			}
		}
	}

	if (id>=601 && id <=700){
		for (i=0;i<ad2460.allianceData.projects.length ;i++ ){
			if (ad2460.allianceData.projects[i].id==id){
				item=ad2460.allianceData.projects[i];
				item.item_type='Allianceproject';
				return item;
			}
		}
	}

	if (id>2000){
		var mission_id=id-2000;
		var m=returnMissionByMissionId(mission_id);
		if (m) {
			item=m;
			m.item_type='Mission';
			return item;
		}
	}

	for (i=0;i<ad2460.productionitems.length ;i++ ){
		if (ad2460.productionitems[i].id==id){
			item=ad2460.productionitems[i];
			item.item_type='Productionitem';
			return item;
		}
	}

	return item;
}

function checkAllRequirementsForItemId(id){
	// usage: checkAllRequirementsForItemId(id-of-checked-object)
	// returns an object with the following properties:
	var requirementObject={};
	requirementObject.development=false;
	requirementObject.research=false;
	requirementObject.facility=false;
	requirementObject.techtree=false;
	requirementObject.special=false;
	// If they are all true, we have access to the item.

	var item=returnGameObjectById(id);
	// first we find the item

	if (item==false){
		//console.log("checkAllRequirementsForItemId found no item for id "+id);
		return false;
	}

	if ( item.hasOwnProperty('required_development_id') ) {
		requirementObject.development=checkDevelopmentRequirement(item.required_development_id);
	}
	else {
		requirementObject.development=true;
	}

	if ( item.hasOwnProperty('required_research_id') ) {
		requirementObject.research=checkResearchRequirement(item.required_research_id);
	}
	else {
		requirementObject.research=true;
	}

	if ( item.hasOwnProperty('required_facility_id') ) {
		requirementObject.facility=checkFacilityRequirement(item.required_facility_id);
	}
	else {
		requirementObject.facility=true;
	}

	if ( item.hasOwnProperty('required_points_tree') ) {
		if (item.required_points_tree=='None'){
			requirementObject.techtree=true;
		}
		if (item.required_points_tree=='Matter'){
			if (ad2460.techVariables.spentTechPointsMatter>=item.required_tech_tree_points){
				requirementObject.techtree=true;
			}
		}
		if (item.required_points_tree=='Energy'){
			if (ad2460.techVariables.spentTechPointsEnergy>=item.required_tech_tree_points){
				requirementObject.techtree=true;
			}
		}
		if (item.required_points_tree=='Displacement'){
			if (ad2460.techVariables.spentTechPointsDisplacement>=item.required_tech_tree_points){
				requirementObject.techtree=true;
			}
		}
		if (item.required_points_tree=='General'){
			if (ad2460.techVariables.spentTechPointsMatter+ad2460.techVariables.spentTechPointsEnergy+ad2460.techVariables.spentTechPointsDisplacement>=item.required_tech_tree_points){
				requirementObject.techtree=true;
			}
		}
	}
	else {
		requirementObject.techtree=true;
	}

	// special_requirement: 0
	// ok, the special one is left...


	if ( item.hasOwnProperty('special_requirement') ) {
		if (item.special_requirement>0){
			// Check for it!
			if (item.special_requirement<100){
				if (ad2460.scores.level>=item.special_requirement){
					requirementObject.special=true;
				}
			}
			else {

				//console.log("Checking for the special requirement..");
				var specialItem=returnGameObjectById(item.special_requirement);
				//console.log(specialItem);
				if (specialItem!=false){
					if (specialItem.item_type=='Research'){
						requirementObject.special=checkResearchRequirement(specialItem.id);
					}
					if (specialItem.item_type=='Facility'){
						requirementObject.special=checkFacilityRequirement(specialItem.id);
					}
					if (specialItem.item_type=='Development'){
						requirementObject.special=checkDevelopmentRequirement(specialItem.id);
					}
					if (specialItem.item_type=='Techitem'){
						if (specialItem.points==specialItem.max_points){
							requirementObject.special=true;

						}
					}
				}
				else {
					// Special-case handeling of requirements 999 and 1000, which are checks against the userflags!
					var a=0;
					for (a=0;a<ad2460.playerflags ;a++ ){
						if (ad2460.playerflags[a]==item.special_requirement){
							requirementObject.special=true;
							// And there we go!
						}
					}
				}

			}
		}
		else {
			requirementObject.special=true;
		}
	}
	else {
		requirementObject.special=true;
	}

	//console.log(requirementObject);
	return requirementObject;


}

function limitText(field_id, counter_id, limitNum) {
	if (document.getElementById(field_id)){
		if (document.getElementById(counter_id)){
			var limitField=document.getElementById(field_id);
			var limitCount=document.getElementById(counter_id);

			if (limitField.value.length > limitNum) {
				limitField.value = limitField.value.substring(0, limitNum);
			} else {
				limitCount.value = limitNum - limitField.value.length;
			}
		}
	}
}


function returnCargoCapacityBonusPercent(){
	var bonusPercent=0;
	var a=returnGameObjectById(841);
	if (a!=false){
		// bonusPercent=bonusPercent+(a.points*10);
	}

	var a=returnGameObjectById(109);
	if (a!=false){
		if (a.user_id==ad2460.user_id && a.upgrading!=1){
			bonusPercent=bonusPercent+4;
		}
	}

	var a=returnGameObjectById(111);
	if (a!=false){
		if (a.user_id==ad2460.user_id && a.upgrading!=1){
			bonusPercent=bonusPercent+10;
		}
	}

	return bonusPercent;

}

function returnUpkeepBonusPercent(){
	var upkeepBonus=0;
	var i=0;
	for (i=0;i<ad2460.researches.length ;i++ ){
		thisRes=ad2460.researches[i];
		if (thisRes.id==132 && thisRes.user_id>0 && thisRes.upgrading==0){
			upkeepBonus+=3;
		}
		if (thisRes.id==152 && thisRes.user_id>0 && thisRes.upgrading==0){
			upkeepBonus+=3;
		}
		if (thisRes.id==172 && thisRes.user_id>0 && thisRes.upgrading==0){
			upkeepBonus+=3;
		}
		if (thisRes.id==181 && thisRes.user_id>0 && thisRes.upgrading==0){
			upkeepBonus+=2;
		}
	}

	var r=returnGameObjectById(354);
	if (r){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			upkeepBonus+=5;
		}
	}

	return upkeepBonus;
}

function returnSpyTimeBonusPercent(){
	var i=0;
	// Facility ids 346, 347, 348 might provde a bonus to the time-settings....

	var bonus=0;

	var f=returnGameObjectById(349);
	if (f!=false){
		if (f.user_id==ad2460.user_id && f.upgrading==0){
			bonus=bonus+0;
		}
	}

	var f=returnGameObjectById(350);
	if (f!=false){
		if (f.user_id==ad2460.user_id && f.upgrading==0){
			bonus=bonus+10;
		}
	}

	var f=returnGameObjectById(351);
	if (f!=false){
		if (f.user_id==ad2460.user_id && f.upgrading==0){
			bonus=bonus+10;
		}
	}

	var r=returnGameObjectById(184);
	if (r!=false){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			bonus=bonus+5;
		}
	}

	return bonus;
}

function returnSpyDetectionBonusPercent(){
	var i=0;
	// Facility ids 346, 347, 348 might provde a bonus to the time-settings....

	var bonus=0;

	var f=returnGameObjectById(349);
	if (f!=false){
		if (f.user_id==ad2460.user_id && f.upgrading==0){
			bonus=bonus+0;
		}
	}

	var f=returnGameObjectById(350);
	if (f!=false){
		if (f.user_id==ad2460.user_id && f.upgrading==0){
			bonus=bonus+10;
		}
	}

	var f=returnGameObjectById(351);
	if (f!=false){
		if (f.user_id==ad2460.user_id && f.upgrading==0){
			bonus=bonus+10;
		}
	}

	var r=returnGameObjectById(195);
	if (r!=false){
		if (r.user_id==ad2460.user_id && r.upgrading==0){
			bonus=bonus+5;
		}
	}

	return bonus;
}

function returnMaxAgents(){
	var returnObject={};
	returnObject.spies=0;
	returnObject.infiltrators=0;

	var f=returnGameObjectById(349);
	if (f!=false){
		if (f.user_id==ad2460.user_id && f.upgrading==0){
			returnObject.spies+=1;
		}
	}

	var f=returnGameObjectById(350);
	if (f!=false){
		if (f.user_id==ad2460.user_id && f.upgrading==0){
			returnObject.spies+=2;
			returnObject.infiltrators+=1;
		}
	}

	var f=returnGameObjectById(351);
	if (f!=false){
		if (f.user_id==ad2460.user_id && f.upgrading==0){
			returnObject.spies+=2;
			returnObject.infiltrators+=2;
		}
	}

	return returnObject;

}



function return_relative_bank_percentage_based_on_rank(rank){
	if (rank==0) {	return 0;	}
	if (rank==1) {	return 25;	}
	if (rank==2) {	return 25;	}
	if (rank==3) {	return 0;	}
	if (rank==4) {	return 0;	}
	if (rank==5) {	return 0;	}
	if (rank==6) {	return 0;	}
	if (rank==7) {	return 0;	}
	if (rank==8) {	return 0;	}
	if (rank==9) {	return 0;	}
	if (rank>9) {	return 0;	}

	// Remember to keep this one up to date with the one in formula.pm
}

function require(script) {
    $.ajax({
        url: script,
        dataType: "script",
        async: false,           // <-- This is the key
        success: function () {
            // all good...
        },
        error: function () {
            throw new Error("Could not load script " + script);
        }
    });
}

function shipToStrength(id){
	var strength=0;
	var ship=returnGameObjectById(id);
	if (ship){
		// Simplification ftw!
		if (ship.vesseltype == 'Normal') {
			if (ship.vesselclass == 'Frigate') {
				strength=450;
				// Exceptions, Scythe and Light Frigate
				if (id==425 || id==423  ) {
					strength=650;
				}
				if (id==441) {
					strength=200;
				}
				if (id==434) {
					// And the boarding-ship ffs
					strength=450;
				}
			}
			if (ship.vesselclass == 'Cruiser') {
				strength=2000;
				// Exceptions, Adamant and The Volker, Protector, Defender
				if (id==437) { strength=1750;	}
				if (id==426) { strength=2500;	}
				if (id==427) { strength=2500;	}
				if (id==428) { strength=2500;	}
			}
			if (ship.vesselclass == 'Battleship') {
				strength=10000;
				// Exceptions, Omega, Gravity well
				if (id==424) { strength=8000;	}
				if (id==429) { strength=10000;	}
			}
			if (ship.vesselclass == 'Carrier') {
				strength=1000;
			}
			if (ship.vesselclass == 'Fighter') {
				strength=70;
				// Exceptions, Vulture, Bolt, Blink
				if (id==402) { strength=90;	}
				if (id==404) { strength=90;	}
				if (id==406) { strength=90;	}
			}
			if (ship.vesselclass == 'Corvette') {
				strength=225;
				// Exceptions, Ghost
				if (id==407) { strength=265;	}
			}
		}
		else if (ship.vesseltype == 'Satelite') {
			// 100, 100, 600, 2000, 6000
			if (id>=501 && id<=503) { strength=200;	} //cannons
			if (id>=504 && id<=506) { strength=150;	} //shieldboosters
			if (id>=507 && id<=509) { strength=500;	} // artillery
			if (id>=510 && id<=512) { strength=2000;	} // def-stations
			if (id>=513 && id<=515) { strength=10000;	} // battlestations
		}
		else if (ship.vesseltype == 'Probe') {
			strength=0;
		}
		else if (ship.vesseltype == 'Prospecting') {
			strength=0;
		}

		// Transports
		if (id==435) {	strength=5;			}
		if (id==436) {	strength=5;			}

		// Salvage and repair-ships
		if (id==432 || id==433 ) {
			strength=0;
		}
		if (id==499){
			strength=125000;
		}
	}
	return parseInt(strength);
}

function parseInfo(info){
	var fullDebug=false;

	if (fullDebug==true){
		parseInfoDebug(info);
		return;
	}
	var mySplitResult = info.split(':newcmd:');
	var i=0;
	var output_string='';

	for (i=0;i<mySplitResult.length;i++ ){

		if (mySplitResult[i].length>3){
			var line = mySplitResult[i].split(":newdata:");
			var type=line[0];
			var data=line[1];
			if (type==0){
				output_string=output_string+data;
			}
			if (type==1){
				try  {	eval(data);		}
				catch(err){
					console.log(err.message);
					console.log(data);
				}
			}
			line=null;
			type=null;
			data=null;
		}
	}
	if (output_string.length>1){
		if (document.getElementById('feedback')){
			document.getElementById('feedback').innerHTML=output_string;
		}
	}
}


function parseInfoDebug(info){
	var mySplitResult = info.split(':newcmd:');
	var i=0;
	var output_string='';

	for (i=0;i<mySplitResult.length;i++ ){

		if (mySplitResult[i].length>3){
			var line = mySplitResult[i].split(":newdata:");
			var type=line[0];
			var data=line[1];
			if (type==0){
				output_string=output_string+data;
			}
			if (type==1){

				try  {
					// break it up in smaller pieces!
					var test = data.split(';');
					console.log(test);
					for (var t=0;t<test.length ; t++){
						try  {eval(test[t]);}
						catch(err){
							console.log(err.message);
							console.log(test[t]);
						}
					}
					// eval(data);
				}
				catch(err){
					console.log(err.message);
					console.log(data);
				}
			}
			line=null;
			type=null;
			data=null;
		}
	}
	if (output_string.length>1){
		if (document.getElementById('feedback')){
			document.getElementById('feedback').innerHTML=output_string;
		}
	}
}

function returnCargoSpaceForFleet(fleet){
	var cargo=0;
	var s=0;
	for (s=0;s<fleet.ships.length ;s++ ){
		cargo+=returnCargoCapacity(fleet.ships[s].ship_type_id);
	}
	return cargo;
}

function remove_nastyness(input){
	input=input.replace(/Motherfucker/gi,'********');
	input=input.replace(/Fuck/gi,'Frack');
	input=input.replace(/Retarded/gi,'Backwards');
	input=input.replace(/Retard/gi,'Ignoramus');
	input=input.replace(/whore/gi,' lady-for-hire');
	input=input.replace(/Cock/gi,'Clock');
	input=input.replace(/Pussy/gi,'Sussy');
	input=input.replace(/Cunt/gi,'Count');
	input=input.replace(/Dick/gi,'Click');
	input=input.replace(/Shit/gi,'Dren');
	input=input.replace(/Fitte/gi,'Fille');
	input=input.replace(/Pikk/gi,'Stikk');
	//input=input.replace(/Sex/gi,'Love');
	input=input.replace(/Analsex/gi,'Rear love ');
	input=input.replace(/Anal-sex/gi,'Rear love ');
	//input=input.replace(/[ \.]Anal /gi,'Rear hatch ');
	input=input.replace(/ anal /gi,' rear hatch ');
	input=input.replace(/asshole/gi,'schmuck');
	input=input.replace(/bitch/gi,'female dog');
	input=input.replace(/bunghole/gi,'sillyhole');
	input=input.replace(/dildo/gi,'plaything');
	input=input.replace(/masturbate/gi,'play');
	input=input.replace(/nigger/gi,'tanned dude');
	input=input.replace(/nazi/gi,'clown');
	input=input.replace(/vibrator/gi,'plaything');
	return input;
}

/*
var coords=new Array();
coords.push({x:10, y:10});
coords.push({x:10, y:11});
coords.push({x:11, y:11});
coords.push({x:12, y:11});
coords.push({x:5, y:5});
coords.push({x:12, y:12});
coords.push({x:13, y:13});

var start={x:10,y:10};
var goal={x:13,y:13};
*/
function testCoordsConnection(){
	var start={x: ad2460.homeworld.x, y: ad2460.homeworld.y};

	// check a random outpost for connectivity
	var op_num=Math.floor(Math.random()*ad2460.outposts.length);

	var goal={x: ad2460.outposts[op_num].x, y: ad2460.outposts[op_num].y};
	//goal={x: 1000, y: 1000};

	var coords=new Array;

	for (var i=0;i<ad2460.outposts.length ;i++ ){
		coords.push({x: ad2460.outposts[i].x, y: ad2460.outposts[i].y});
	}

	var connected=coordsAreConnected(start, goal, coords);

	console.log("COnnected: "+connected);

}

function coordsAreConnected(start, goal, coords){
	// start is an object with x and y
	// goal is an object with x and y
	// coords is an array of objects that must contain properties x and y
	var startTime=new Date();

	var queue=new Array();
	var checked=new Array();
	queue.push(start);

	while (queue.length>0){
		//  process first entry
		var thisPoint=queue.shift();

		console.log('Checking '+thisPoint.x+':'+thisPoint.y);

		if (thisPoint.x==goal.x && thisPoint.y==goal.y){
			console.log('Found goal!');
			var endTime=new Date();
			var diff=endTime-startTime;
			console.log("Spent "+diff+" milliseconds");
			return true;
		}

		// mark point as checked to avoid rechecking
		checked.push({x: thisPoint.x, y: thisPoint.y});

		// check which borders we actually have

		var borders=new Array;

		borders.push({x: thisPoint.x-1,	y: thisPoint.y-1});
		borders.push({x: thisPoint.x,		y: thisPoint.y-1});
		borders.push({x: thisPoint.x+1,	y: thisPoint.y-1});
		borders.push({x: thisPoint.x-1,	y: thisPoint.y});
		borders.push({x: thisPoint.x+1,	y: thisPoint.y});
		borders.push({x: thisPoint.x-1,	y: thisPoint.y+1});
		borders.push({x: thisPoint.x,		y: thisPoint.y+1});
		borders.push({x: thisPoint.x+1,	y: thisPoint.y+1});

		for (var b=0;b<borders.length ;b++ ){
			var bc=borders[b];
			for (var i=0;i<coords.length ;i++ )	{
				if (bc.x==coords[i].x && bc.y==coords[i].y){
					// it's valid..but only add to queue if it has not already been checked, and only if it is not already in the queue
					var alreadyChecked=false;
					for (var k=0;k<checked.length ;k++ ){
						if (checked[k].x==bc.x && checked[k].y==bc.y){
							alreadyChecked=true;
						}
					}
					for (var k=0;k<queue.length ;k++ ){
						if (queue[k].x==bc.x && queue[k].y==bc.y){
							alreadyChecked=true;
						}
					}

					if (alreadyChecked==false){
						queue.push(bc);
					}
				}
			}
		}
	}
	var endTime=new Date();
	var diff=endTime-startTime;
	console.log("Spent "+diff+" milliseconds");

	return false;

}

var myPlayerIdColor="rgba(50, 255, 50, 1.0)";
var myPlayerIdBgColor="rgba(50, 255, 50, 0.13)";

function playerIdToColor(player_id){
	var colors=[
						"rgba(255, 50, 50, 1.0)",
						"rgba(255, 210, 30, 1.0)",
						"rgba(114, 252, 221, 1.0)",
						"rgba(200, 200, 200, 1.0)",
						"rgba(255, 255, 50, 1.0)",
						"rgba(50, 255, 255, 1.0)",
						"rgba(255, 50, 255, 1.0)",
						"rgba(200, 100, 30, 1.0)",
						"rgba(100, 90, 200, 1.0)",
						"rgba(255, 255, 255, 1.0)",
						"rgba(255, 246, 0, 1.0)",
						"rgba(255, 255, 255, 1.0)",
	];

	if (player_id==ad2460.user_id){
		return myPlayerIdColor;
	}


	return colors[player_id % 12];
}

function playerIdToBgColor(player_id){
	var colors=[
						"rgba(255, 50, 50, 0.2)",
						"rgba(255, 210, 30, 0.2)",
						"rgba(114, 252, 221, 0.2)",
						"rgba(200, 200, 200, 0.2)",
						"rgba(255, 255, 50, 0.2)",
						"rgba(50, 255, 255, 0.2)",
						"rgba(255, 50, 255, 0.2)",
						"rgba(200, 100, 30, 0.2)",
						"rgba(100, 90, 200, 0.2)",
						"rgba(255, 255, 255, 0.2)",
						"rgba(255, 246, 0, 0.2)",
						"rgba(255, 255, 255, 0.2)",
	];

	if (player_id==ad2460.user_id){
		return myPlayerIdBgColor;
	}

	return colors[player_id % 12];
}

function shortenUnitTechName(name){
	// replace "NeoTech" with "N. "
	name=name.replace(/NeoTech/gi,'N. ');
	name=name.replace(/StronTech/gi,'S. ');
	name=name.replace(/InTech/gi,'I. ');

	return name;
}

function returnUnitCount(ship_type_id){
	var count=0;
	for (var i=0;i<ad2460.myFleets.length ; i++){
		for (var f=0;f<ad2460.myFleets[i].ships.length ; f++){
			if (ad2460.myFleets[i].ships[f].ship_type_id==ship_type_id){
				count++;
			}
		}
	}

	return count;
}

function isUnitInQueue(ship_type_id){
	var itIs=false;
	var i=0;

	for (i=0;i<ad2460.productionqueue.length ; i++){
		if (ad2460.productionqueue[i].id==ship_type_id){
			itIs=true;
		}
	}

	return itIs;
}

function shortenBigNumber(num){
	var temp=0.0;
	if (num>=1000000){
		temp=(num/1000000).toFixed(2);
		temp=temp+'M';
		return temp;
	}
	else if (num>=1000){
		temp=(num/1000).toFixed(0);
		temp=temp+'K';
		return temp;
	}
	else {
		return num;
	}
}

var returnTotalFacilityTime = function(objectId) {
	var o=returnGameObjectById(objectId);
	var temp=0;
	if (o.required_facility_id > 0 && o.user_id<1) {
		temp+=returnTotalFacilityTime(o.required_facility_id);
	}
	if (o.required_development_id > 0 && o.user_id<1) {
		temp+=returnTotalFacilityTime(o.required_development_id);
	}
	if (o.required_research_id > 0 && o.user_id<1) {
		temp+=returnTotalFacilityTime(o.required_research_id);
	}

	if (o.item_type=='Facility'){
		temp+=o.time_cost;
	}
	return temp;
}

var returnTotalResearchTime = function(objectId) {
	var o=returnGameObjectById(objectId);
	var temp=0;
	if (o.required_facility_id > 0 && o.user_id<1) {

		temp+=returnTotalResearchTime(o.required_facility_id);
	}
	if (o.required_development_id > 0 && o.user_id<1) {

		temp+=returnTotalResearchTime(o.required_development_id);
	}
	if (o.required_research_id > 0 && o.user_id<1) {

		temp+=returnTotalResearchTime(o.required_research_id);
	}

	if (o.item_type=='Research'){
		temp+=o.time_cost;
	}
	return temp;
}

var returnTotalDevelopmentTime = function(objectId) {
	var o=returnGameObjectById(objectId);
	var temp=0;
	if (o.required_facility_id > 0 && o.user_id<1) {

		temp+=returnTotalDevelopmentTime(o.required_facility_id);
	}
	if (o.required_development_id > 0 && o.user_id<1) {

		temp+=returnTotalDevelopmentTime(o.required_development_id);
	}
	if (o.required_research_id > 0 && o.user_id<1) {

		temp+=returnTotalDevelopmentTime(o.required_research_id);
	}

	if (o.item_type=='Development'){
		temp+=o.time_cost;
	}
	return temp;
}

function returnTotalTimeToObject(id){

	var f=returnTotalFacilityTime(id);
	var r=returnTotalResearchTime(id);
	var d=returnTotalDevelopmentTime(id);

	console.log(f,r,d);

	var arr=new Array;
	arr.push(f);
	arr.push(r);
	arr.push(d);

	arr.sort(function(a, b){  return a - b;});

	console.log(arr[0], arr[1], arr[2]);


}

function outpostOutputToMaxDefStrength(output){
	var maxStr=0;
	var potential=return_output_potential(output);

	switch(potential) {
		case 1:
			maxStr=5*1000;
			break;
		case 2:
			maxStr=10*1000;
			break;
		case 3:
			maxStr=10*1000;
			break;
		case 4:
			maxStr=20*1000;
			break;
		case 5:
			maxStr=30*1000;
			break;
		case 6:
			maxStr=40*1000;
			break;
		case 7:
			maxStr=50*1000;
			break;
		case 8:
			maxStr=75*1000;
			break;
		case 9:
			maxStr=100*1000;
			break;
		case 10:
			maxStr=125*1000;
			break;
		default:
			maxStr=0;
	}
	return maxStr;
}

function outpostPotentialToMaxDefStrength(potential){
	var maxStr=0;

	switch(potential) {
		case 1:
			maxStr=5*1000;
			break;
		case 2:
			maxStr=10*1000;
			break;
		case 3:
			maxStr=10*1000;
			break;
		case 4:
			maxStr=20*1000;
			break;
		case 5:
			maxStr=30*1000;
			break;
		case 6:
			maxStr=40*1000;
			break;
		case 7:
			maxStr=50*1000;
			break;
		case 8:
			maxStr=75*1000;
			break;
		case 9:
			maxStr=100*1000;
			break;
		case 10:
			maxStr=125*1000;
			break;
		default:
			maxStr=0;
	}
	return maxStr;
}

function resourceTiltStringToImages(resStr){
	// returns an array of images to inserted
	var a=resStr.split(" + ");

	var returnArray=new Array;

	if (a.length>0){
		if (a[0]=='Hs'){
			var extraImg=createSingleElement('img','target_search_op_icon', '', 'images/icons/elements/hs42.png', '');
			returnArray.push(extraImg);
		}
		if (a[0]=='In'){
			var extraImg=createSingleElement('img','target_search_op_icon', '', 'images/icons/elements/in42.png', '');
			returnArray.push(extraImg);
		}
		if (a[0]=='Sr'){
			var extraImg=createSingleElement('img','target_search_op_icon', '', 'images/icons/elements/sr42.png', '');
			returnArray.push(extraImg);
		}
		if (a[0]=='Nd'){
			var extraImg=createSingleElement('img','target_search_op_icon', '', 'images/icons/elements/nd42.png', '');
			returnArray.push(extraImg);
		}
		if (a[0]=='Even'){
			var extraImg=createSingleElement('img','target_search_op_icon', '', 'images/icons/elements/even42.png', '');
			returnArray.push(extraImg);
		}
	}
	if (a.length>1){
		if (a[1]=='Hs'){
			var extraImg=createSingleElement('img','target_search_op_icon_2', '', 'images/icons/elements/hs42.png', '');
			returnArray.push(extraImg);
		}
		if (a[1]=='In'){
			var extraImg=createSingleElement('img','target_search_op_icon_2', '', 'images/icons/elements/in42.png', '');
			returnArray.push(extraImg);
		}
		if (a[1]=='Sr'){
			var extraImg=createSingleElement('img','target_search_op_icon_2', '', 'images/icons/elements/sr42.png', '');
			returnArray.push(extraImg);
		}
		if (a[1]=='Nd'){
			var extraImg=createSingleElement('img','target_search_op_icon_2', '', 'images/icons/elements/nd42.png', '');
			returnArray.push(extraImg);
		}
		if (a[1]=='Even'){
			var extraImg=createSingleElement('img','target_search_op_icon_2', '', 'images/icons/elements/even42.png', '');
			returnArray.push(extraImg);
		}
	}

	return returnArray;
}

function tutorialNavigation(id){
	// open the tutorial if not open
	if (document.getElementById('outgamehelp').contentWindow.document.getElementById(id)){
		if (outGameHelpVisible!=1){
			$("#gameinfo").click();
		}

		if (id.indexOf("upcoming_")==0){
			document.getElementById('outgamehelp').contentWindow.document.getElementById('upcoming').click();
		}
		else if (id.indexOf("theuniverse_")==0){
			document.getElementById('outgamehelp').contentWindow.document.getElementById('universe').click();
		}
		else {
			document.getElementById('outgamehelp').contentWindow.document.getElementById('tutorial').click();
		}
		document.getElementById('outgamehelp').contentWindow.document.getElementById(id).parentElement.parentElement.parentElement.firstElementChild.click();
		document.getElementById('outgamehelp').contentWindow.document.getElementById(id).click();
	}
}
ad2460.helpOverlays=new Array;
/*
use ad2460.currentPageSection and ad2460.openSlides to figure out where we are and what to show.
If there is anything in openslides, thats what's counting, and if not, the currentPageSection wins.
We can add support for checking openPanels later too, to make individual boxes for open panels...
*/

ladyhelperVars={};
ladyhelperVars.lastMsgId='';
ladyhelperVars.lastMsgTime=0;

// Object definition
function helpOverlayBox(section, panel, left, top, width, height, htmltext){
	this.section=section;
	this.panel=panel;
	this.left=left;
	this.top=top;
	this.height=height;
	this.width=width;
	this.htmltext=htmltext;
}

// The render-function called by the click on the help-button
function renderHelpOverlay(){
	removeChildNodes('help_overlay');

	// Where are we?
	var section=ad2460.currentPageSection;
	// section is now "Homeworld", "Alliances", "Outposts" or "Military"
	// But, we might want to override where we are if a slide is open
	if (ad2460.openSlides.length>0){
		// Pick the first one as there should only be one...I think...
		section=ad2460.openSlides[0];
	}

	section=section.toLowerCase();
	renderHelpBoxes(section);
	$("#help_overlay").fadeIn(120);
}

function renderHelpBoxes(section){
	//console.log(section);
	var topContainer=document.getElementById('help_overlay');
	var i=0;
	for (i=0;i<ad2460.helpOverlays.length ;i++ ){
		if (ad2460.helpOverlays[i].section==section){
			var thisBox=ad2460.helpOverlays[i];
			var outerDiv=document.createElement('div');
			outerDiv.setAttribute("class","help_overlay_box");
			outerDiv.style.top=thisBox.top+"px";
			outerDiv.style.left=thisBox.left+"px";
			outerDiv.style.width=thisBox.width+"px";
			outerDiv.style.height=thisBox.height+"px";

			var innerDiv=document.createElement('div');
			innerDiv.innerHTML=thisBox.htmltext;

			outerDiv.appendChild(innerDiv);
			topContainer.appendChild(outerDiv);
		}
	}

	// Adding support for the "general" stuff as well, triggered by the 4 normal sections
	for (i=0;i<ad2460.helpOverlays.length ;i++ ){
		if (ad2460.helpOverlays[i].section=='general' && ( section == 'homeworld' || section == 'outposts' || section == 'military' || section == 'alliance' || section == 'forumcategories' || section == 'mailslide' || section == 'starmapslide' || section == 'rankingslide' || section == 'economy') ){
			var thisBox=ad2460.helpOverlays[i];
			var outerDiv=document.createElement('div');
			outerDiv.setAttribute("class","help_overlay_box");
			outerDiv.style.top=thisBox.top+"px";
			outerDiv.style.left=thisBox.left+"px";
			outerDiv.style.width=thisBox.width+"px";
			outerDiv.style.height=thisBox.height+"px";

			var innerDiv=document.createElement('div');
			innerDiv.innerHTML=thisBox.htmltext;

			outerDiv.appendChild(innerDiv);
			topContainer.appendChild(outerDiv);
		}
	}

}

// Bjørn Arve:
// The order is: location , null , left, top, width, height, text
// The null-value will be used later for more specific options, just leave it at null for now
// Feel free to add boxes :)

//General
ad2460.helpOverlays.push(new helpOverlayBox("general",null, 200,  0,980, 10,"This area shows the resources currently stored on your homeworld, and available to you for use. Click on a resource for more information"));
ad2460.helpOverlays.push(new helpOverlayBox("general",null,   4,  0,180,140,"Use the buttons here to navigate to one of the four main administration sections. Each section contains its own set of panels."));
ad2460.helpOverlays.push(new helpOverlayBox("general",null,   4,160,180,220,"Every time there is a notable event related to you or your alliance in the game, you will be notified here. Sometimes there is also a direct link from this section to the relevant event."));
ad2460.helpOverlays.push(new helpOverlayBox("general",null,   4,399,180,187,"System and feedback messages to some of your actions are displayed here for a short while and then go away. Error messages appear here too, so if something doesn't seem to work, notice if there is a message popping up here."));
ad2460.helpOverlays.push(new helpOverlayBox("general",null,   4,605,180, 83,"Here you can view the current game rankings, adjust your account settings and get help from support. The '?' will help you with relevant game info for any current view."));
ad2460.helpOverlays.push(new helpOverlayBox("general",null, 221,601,275, 87,"This shows you any activity that is running for facilities, research, development and production. It also tells you about any outpost being upgraded or the current alliance project."));
ad2460.helpOverlays.push(new helpOverlayBox("general",null, 520,601,160, 87,"Here you can access additional section of the game that slide in on a separate panel. The starmap allows you to locate other planets and players, as well as launch attacks and place outposts."));
ad2460.helpOverlays.push(new helpOverlayBox("general",null, 712,601,298, 87,"Shows the most recently updated Forums-threads, Allianceforum-threads or Messages..."));
ad2460.helpOverlays.push(new helpOverlayBox("general",null,1022,601,161,87,"Buttons that will either toggle the chat-box, or open Messages or Forums."));

//Homeworld
ad2460.helpOverlays.push(new helpOverlayBox("homeworld",null,220, 44,459,160,"This is the facilities panel. It is where all facility upgrades are initiated, and it also shows the current state of all your facilies.<br/><br/> Notice the lower right corner of the panel. It will have an orange light when an upgrade is in progress and a green light when you can start a new upgrade. <br/>If you want to build a military unit, upgrade matter, energy or displacement production facility. This will give you access to your first military ships."));
ad2460.helpOverlays.push(new helpOverlayBox("homeworld",null,220,230,459,160,"The research panel allows you to start any available research. It also shows a list of upgrades already completed. <br/><br/>Notice the lower right corner of the panel. It will have an orange light when a research is in progress and a green light when you can initiate a new research."));
ad2460.helpOverlays.push(new helpOverlayBox("homeworld",null,220,414,459,160,"The development panel opens to show your available developments. This is the final stage before you are able to produce things. <br/><br/>Notice the lower right corner of the panel. It will have an orange light when a deveopment is in progress and a green light when you can start a new deveopment. <br/>If you haven't developed your outpost, you should do so now."));
ad2460.helpOverlays.push(new helpOverlayBox("homeworld",null,709,414,459,160,"This panel open your production panel. This is where you produce all your units. In order to get production items, you need to have the proper facilities, have done the right research and developed the unit. Once these criteria are met, you will be able to produce the unit.<br/><br/>Notice the lower right corner of the panel. It will have an orange light when a a unit is being produced. It will be green when it is not producing anything, or if there is room in the production queue for more units."));
ad2460.helpOverlays.push(new helpOverlayBox("homeworld",null,709, 44,459,332,"This is the overview of your current status. You can rename your homeworld by clicking on the name if you like.<br/><br/> Click on the coordinates for your homeworld to view it directly in the starmap.<br/><br/>At the bottom, the local resource production is listed. You can increase this output by upgrading your refinery facilities."));

//Outposts
ad2460.helpOverlays.push(new helpOverlayBox("outposts",null,220, 44,590,528,"This section lists all your owned outposts, and their location in the galaxy. In the brief listing, you can also see the output of each outspot, it's resource tilt (the resources it produces the most of). There is also an option to defend your outpost from attack. Clicking anywhere on the outpost-line will open the small panel in the lower-right corner, and this will bring up all the details about this specific outpost.<br/><br/>If you want to go directly to the location of your outpost on the starmap, click the coordinates of the outpost. This will open the starmap, and select your outpost planet.<br/><br/>Resources are automatically transported back to your homeworld regularly. Once an outpost is set up, it will automatically contribute to your income.<br/><br/>If you lose your outpost to an attacker, it will be shown on the outposts list as 'Lost', and the name of the player who took it along with the name of his alliance will be shown. <br><br>Losing anoutpost wil trigger OP-grace. The player who won the outpost is protected from any attempts at attacking the outpost won for 2 hours. Lost outpost remain on the list for 2 days.<br><br>If you successfully attack and steal an outpost from another player, it will be added to your outposts list. Your advancement level restricts how many outposts you are able to own and run. You can acquire 2 more outposts than you can run, but these two will not be operational until you abandon or lose some of your other outposts. It is always the two most recently acquired outposts above the limit that have their production put on hold.<br/><br/>You can find good planets to place your outpost at by using the starmap and the prospecting function. Remember, you need a prospecting ship to do this."));
ad2460.helpOverlays.push(new helpOverlayBox("outposts",null,834, 44,292,333,"The outpost overview shows the current total output of all your outposts and how the resources your are producing are distributed. <br/><br/>If you realise you're getting too little of a resource, check to see that your outposts are producing the kind of resources you are most likely to use. Depending on which technology you are specialising in, this will differ."));
ad2460.helpOverlays.push(new helpOverlayBox("outposts",null,835, 409,338,160,"This panel shows the currently selected outpost, and will open up to show the details for any outpost you click on in the outpost list.<br><br>While the panel is open, you can initiate outpost-only transportation, and begin an upgrade to the outpost, if you wish."));

//Military
ad2460.helpOverlays.push(new helpOverlayBox("military",null,215,40,280,160,"The Fleet Management section provides all the necessary options for setting up your military fleets.<br/><br/>Here, you can assign ships to individual fleets, assign and reassign commanders and provide resupplies of fighters and covettes."));
ad2460.helpOverlays.push(new helpOverlayBox("military",null,215,225,280,160,"The Commanders panel give you access to all your current commanders, both active and inactive. You can assign them to existing fleets, remove them from active duty, or retire them from the game. If you are in need of new commanders, you can also recruit new talent from the officer academy."));
ad2460.helpOverlays.push(new helpOverlayBox("military",null,215,410,280,160,"Intelligence encompasses scouts, spies and infiltrators. This section lets you view any past and current espionage operations, and revew the information they have provided.<br><br>Note that all intelligence operations are initiated at the planet-view level in the starmap, so if you wish to use your scouts and spies on other players, you need to go a planet in the starmap first."));
ad2460.helpOverlays.push(new helpOverlayBox("military",null,525,40,280,160,"The fleet movement section gives an overview of where all your fleets are located, and what they are doing. Most of the time, fleets are stading still at a location, but sometimes fleets can be travelling to a destination, or be in combat.<br><br>Any fleets that are stationary can be ordered to move to another location. This is done here."));
ad2460.helpOverlays.push(new helpOverlayBox("military",null,525,225,280,160,"The combat log contains a lost of all the battles that your fleets have been involved with. This can either be as an attacking force, a defending force, or in the service of your alliance members. Here you can see an overview of each battle, and view any of them over again."));
ad2460.helpOverlays.push(new helpOverlayBox("military",null,525,410,280,160,"Target Search.<br><br>This search tool allows you to quickly find players who are within your strength-bracket whn looking for outposts and homeworld to attack. Keep in mind that most players are members of an alliance, and that attacking at random can have unforseen consequences."));
ad2460.helpOverlays.push(new helpOverlayBox("military",null,835, 40,335,530,"This is your military overview.<br>All the relevant data is available to you here to see your current military capabilites. You also have an option to view all your ships by type and to view any military bonuses that you have acquired. "));

//Alliance
ad2460.helpOverlays.push(new helpOverlayBox("alliance",null,220, 44,459,160,"The Alliance Management section contains all the available settings and information about your alliance. From here, all the workings of the alliance is controlled.<br/><br/>Everything from member taxation, to rank management, bank management and alliance information is set up here. Most likely the officers of the alliance will have more to do here than other members."));
ad2460.helpOverlays.push(new helpOverlayBox("alliance",null,220,230,459,160,"The Member Directory is a list of all the players within the alliance. From here it is easy to see what avatar they have, what rank and responsibilities that are assigned in the alliance and any relevant news about any of the players."));
ad2460.helpOverlays.push(new helpOverlayBox("alliance",null,220,414,459,160,"The Marketplace is the section in which you trade your resources.<br/><br/>From here, you can set up trades for the resources you have too much of and trade them into resources you need. You can also browse possible trades set up by other alliance members, and accept any of these if they fit your needs."));
ad2460.helpOverlays.push(new helpOverlayBox("alliance",null,709,414,459,160,"The Alliance Development panel shows available and ongoing projects in your alliance. These projects are large, require a lot of resources, but give benefits to every member of the alliance. "));
ad2460.helpOverlays.push(new helpOverlayBox("alliance",null,709, 44,459,332,"This is an overview of the current status of your alliance.<br/><br/>"));

//Forums
ad2460.helpOverlays.push(new helpOverlayBox("forumcategories",null,200, 34,220,550,"Forum Categories.<br><br>Once you open the Forums, this is the first section available. Select the sub-section you wish to view the threads for, and the threads slide will be displayed.<br><br> If you wish to view the categories again, simple press the 'Categories'-header, and any panels covering it will be moved away."));
ad2460.helpOverlays.push(new helpOverlayBox("forumcategories",null,433, 34,275,550,"Category Threads. <br><br>Once you have selected a category to view, you will be shown all the threads available to read. You can see who created the thread, who posted in it last, and when it was last active.<br>Click on any thread to view the posts it contains.<br><br>At the bottom of the panel is a header labeled 'Create New Thread'. Click this to open to create a new thread within the selected category. Once you press 'Submit New Thread', the thread will be posted and visible for anyone with access to this category of the forum.<br><br>If you wish to view the threads again, press the 'Threads'-header to remove any panels that are covering it."));
ad2460.helpOverlays.push(new helpOverlayBox("forumcategories",null,721, 34,460,550,"Thread Posts.<br><br>This is a chronologcal listing of all the posts made by players on the selected thread. You can add your own entry in the thread by scrolling to the bottom and entering text in the field there. Once you press 'submit', your post will be visible for all to read.<br><br>If you wish to quote someone from a previous post, simple press the 'Reply'-button on their post, and the text will be copied into the text entry field for you.<br><br>If you click on the avatar image of any poster, you will be shown any publicly available information about that player.<br><br>When submitting a post, keep in mind:<br>- Be nice.<br>- Make sure you read the thread, so you don't ask questions already answered, or make comments that are inapporipriate for the topic under discussion.<br>- English is not everyone's first language. Miscommunications is often a source of tension. Ask people to clarify, if you are unsure before getting upset."));

//Messages
ad2460.helpOverlays.push(new helpOverlayBox("mailslide",null,240, 34,325,550,"Your conversation list.<br><br>This list shows the players you have been talking to, and how long since messages have been sent to any of them. If the name is bolded, you have a new message. Click on a name to view all the messages that have been sent between you and the recipient.<br><br>If you wish to start a new conversation with a player, and know the name of that player, you can press the 'New conversation' button, and then enter the name of that player in the top field in the message list section."));
ad2460.helpOverlays.push(new helpOverlayBox("mailslide",null,582, 34,600,550,"Your message list.<br><br>Any messages sent between you and your selected player will be listed here.<br><br>You can reply to that player using the text-entry field at the bottom. Messages are transmitted instantly, and the receiving player will be notified that you have send a message.<br><br>If you are starting a new conversation, enter the name of the player you wish to send the message to at the top.<br><br>Please keep in mind that all players are real people, and keep your communitaction civil, respectful and free of harassment."));

//Starmap
ad2460.helpOverlays.push(new helpOverlayBox("starmapslide",null,250, 25, 250, 26,"This shows the coordinates for your current view. They can be copied into the chat."));
ad2460.helpOverlays.push(new helpOverlayBox("starmapslide",null,250, 65, 440, 415,"The starmap has 5 levels of view:<br>1. Galaxy View.<br>2. Quadrant View.<br>3. Sector View<br>4. Cluster View.<br>5. Solar System View.<br><br>The 5th view changes the starmap display. Each zoom-level shows alliances and players differently, so it is easy to see which players and alliances are close to you, and how they are doing.<br><br>On the left side of the map, ther is a 'legend'-tab. Press this to see an overview of teh symbols used on the starmap and what they represent.<br><br>You can move the view sideways and up/down using the arrow buttons at the sides of the view. If you wish to zoom in, press any grid-square to do so. If you wish to zoom back out, you need to press the desired zoom-level on the zoom-bar at the top-right. This will shorten/lengthen depending on your current view."));
ad2460.helpOverlays.push(new helpOverlayBox("starmapslide",null,280, 498, 135, 80,"Here you can select which overlays you wish to view on the starmap."));
ad2460.helpOverlays.push(new helpOverlayBox("starmapslide",null,430, 498, 80, 80,"Press to zoom to your homeworld."));
ad2460.helpOverlays.push(new helpOverlayBox("starmapslide",null,525, 498,371,80,"This is the prospecting panel. This is where you send out your prospecting ships to scan the planets. It will tell you if you have any ships available and how long it takes to prospect.<br><br>Click on the 'Prospecting List'-button to see any ongoing scans and an overview of your most recent scans."));
ad2460.helpOverlays.push(new helpOverlayBox("starmapslide",null,704, 82,190,370,"This section of the starmap will show you lists of the most powerful alliances and players in your current view.<br><br> Once you zoom into the map, the list will change to only show the top players in the area.<br><br>Clicking on player-names in the list will instantly zoom to their local solar system."));
ad2460.helpOverlays.push(new helpOverlayBox("starmapslide",null,704, 25,206,40,"The zoom-bar will expand as you zoom into the starmap. Click on any of the visible levels to zoom back out."));
ad2460.helpOverlays.push(new helpOverlayBox("starmapslide",null,924, 25,267,561,"This is the links and search section.<br><br>Search.<br>If you wish to search for a player, an alliance or a planet, you can do this here. Simply select what you are searching for and enter the name (or part of the name), and press 'Search'. Your search results will be listed below. Any search results for players and planets will give you links directly to their location. Pressing this link will take you to the local solar system.<br><br>Clicking the results for Alliances will bring up any available information about the alliance.<br><br>Links<br>Links will show your current list of links. Links can be created by viewing a planet and pressing the 'Link'-button on it. Any planet you have done this for will appear on this list. <br><br>Clicking on the name of the link will open a small panel where you can rename the link and add some personal information on it. You are the only one who will see this information.<br><br>Clicking on the link-coordinates will take you to the location of the link."));

//Tech Tree
ad2460.helpOverlays.push(new helpOverlayBox("techtreeslide",null,240, 34,298,513,"The InTech Tree.<br><br>This part of the tech tree devotes most bonuses to improvements to your InTech units and your Indium resources.<br><br>If you like to have ships that are tough targets, able to withstand a lot of punishment in a battle, then this is the tech tree for you. InTech might not be the technology that can dish out the most damage, but they are certainly the technology that can withstand the most. InTech also has access to the largest transport-vessel in AD2460: The Adamant.<br><br>By placing your points in to this tree, you will also unlock other ship-types that will improve your the performance of your fleets."));
ad2460.helpOverlays.push(new helpOverlayBox("techtreeslide",null,560, 34,298,513,"The StronTech Tree.<br><br>This tech tree is devoted to the advancement and improvement of all things related to the StronTech way of doing things. StronTech are devoted to dealing as much damage as possible. They need their fights to be short, as their main deficit is their hull.<br><br>By placing your points in this tech tree, you will improve upon all of StronTechs strengths. You will also be able to unlock some of the special ships along the way.<br><br> At the bottom of the tree are some of the most dangerous damage-dealing ships in AD2460. A worthwhile goal to pursue."));
ad2460.helpOverlays.push(new helpOverlayBox("techtreeslide",null,880, 34,298,513,"The NeoTech Tree.<br><br>Neotech bases its technology on gravitaional forced and field disortions to uniquely take advantage of the most advanced forces in the universe. This gives the technology an edge over the other technologies when it comes to avoiding damage altogether, and use their weapons to rip apart the materials of their targets.<br><br>Placing points into the NeoTech tree will increase the manoeuvrability of your vessels, and unlock new and faster ships along the way. It will also increase your output of Neodymium, the main resource for the NeoTech.<br><br>Once you reach the final level of the tech tree, you will gain access to ships with unique abilities, that can change the entire course of a battle."));
ad2460.helpOverlays.push(new helpOverlayBox("techtreeslide",null,240, 560,940,26,"If you have any unspent points, they will be shown here. You can also check out how to gain more tech points. Once you have allocated new points, press 'Commit' to lock down the points and gain the bonuses. If you are unhappy with your current point-distribution, you can reset your points, at a cost."));

//Rankings
ad2460.helpOverlays.push(new helpOverlayBox("rankingslide",null,250, 44,400,50,"Select if you wish to see the ranking lists for yourself, or for that of your alliance."));
ad2460.helpOverlays.push(new helpOverlayBox("rankingslide",null,250, 130,400,315,"Select a category for which to view the current rankings."));
ad2460.helpOverlays.push(new helpOverlayBox("rankingslide",null,700, 44,440,520,"The ranking list shows the players/alliances in descending order for the chosen category.<br><br>At the bottom of the ranking list is your current position. For an explanation of how the rankings are determined see the help-box underneath the ranking category list."));
ad2460.helpOverlays.push(new helpOverlayBox("rankingslide",null,250, 465,400,50,"This box contains information about the chosen category and an explanation as to how the score in the selected category is calculated."));


//Economy
ad2460.helpOverlays.push(new helpOverlayBox("economy",null,260, 35,690,265,"This section shows you your current resource production and expenditures.<br><br>Each resource is listed separately, so you can see where you might be producing too little. If you are producing less that you are consuming, then your resource economy will begin to suffer, and this in turn will affect any ships in your fleets.<br><br>You should stop by this page often to see that you are not running into trouble with your production.<br><br>'Homeworld Production' shows you how much resources your homeworld is currently producing per hour.<br><br>'Outpost Production' is showing the total output of your outposts.<br><br>'Alliance Tax Distribution' shows how much tax is returned to you via the alliance tax system (if you are in a taxed alliance).<br><br>'Fleet Upkeep' shows how much you are currently spending keeping your fleet maintained and operational per hour.<br><br>'Alliance Upkeep' is how much you are paying per hour on average to be a part of your current alliance.<br><br>'Alliance Tax' shows the average amount you pay in alliance tax per hour."));

// Show hide help box

function showLocalHelpTopic(subject){
	//var subject='Help';
	var body='Helpful help-text here!';

	var i=0;
	for (i=0;i<ad2460.helpButtons.length ;i++ ){
		if (ad2460.helpButtons[i].subject==subject){
			body=ad2460.helpButtons[i].body;
		}
	}

	showSimpleBox(subject,body);
}

function hideSimpleBox(){
	$("#simple_popup").hide();
}

function hideSimpleBoxLarge(){
	$("#large_popup").hide();
}
function hideSimpleBoxNemesis(){
	$("#nemesis_popup").hide();
}

function showSimpleBox(heading,body,onclick){
	$("#simple_popup").css({'height':''});
	$("#simple_header_text").html(heading);
	$("#simple_main_text").html(body);
	if (!onclick){
		onclick=null;
	}
	document.getElementById("simple_ok_button").setAttribute("onclick","hideSimpleBox();"+onclick);
	$("#simple_popup").show();
	$("#simple_main_text").scrollTop(0);
}

function showSimpleBoxLarge(heading,body,onclick){
	// $("#simple_popup").css({'height':''});
	$("#large_header_text").html(heading);
	$("#large_main_text").html(body);
	if (!onclick){
		onclick=null;
	}
	document.getElementById("large_ok_button").setAttribute("onclick","hideSimpleBoxLarge();"+onclick);
	$("#large_popup").show();
	//$("#simple_main_text").scrollTop(0);
}

function showSimpleBoxNemesis(heading,body,onclick){
	$("#nemesis_header_text").html(heading);
	$("#nemesis_main_text").html(body);
	if (!onclick){
		onclick=null;
	}
	document.getElementById("nemesis_ok_button").setAttribute("onclick","hideSimpleBoxNemesis();"+onclick);
	$("#nemesis_popup").show();
	//$("#simple_main_text").scrollTop(0);
}

// The new help-boxes
// Adding dynamically when the page has been loaded.

ad2460.helpButtons=new Array;
// Tactics Slide
ad2460.helpButtons.push({dyn_id:"", subject:"Target Priority", parent_id:"tactics_slide_target_priority_container",      extraClass:"",            left:"308px",right:"",     top:"37px", bottom:"", body:"This setting decides what kind of targets will be preferred. Capital ships will find the best target for your selected priority within their own weapon range. If they do not have a target for their primary weapon, they will try to move to be able to fire.<br><br>Remember that all targets are allocated at the start of a combat-turn. Ships each target an opposing ship, and declares an estimation of damage dealt. Once a target is assumed to be dead, a new target is selected and damage allocated until all ships have a target.<br><br> The order of the targeting and declaration is different for each tactic.<br><br>Total Firepower - Ships with the highest primary weapon damage pick targets first.<br>Least Hull - Ships with the highest manoeuvrability pick their targets first.<br>Least Manoeuvrability - Ships with the lowest primary weapon targeting pick their targets first.<br> Closest Ship - Ships with the lowest primary weapon range pick their targets first.<br>Most Hull - Ships with the longest primary weapon range pick their targets first.<br>Most Manoeuvrability - Ships with highest primary weapon targeting pick their targets first."});
ad2460.helpButtons.push({dyn_id:"", subject:"Target Re-evaluation", parent_id:"tactics_slide_target_switching_container",extraClass:"",            left:"308px",right:"",     top:"157px",     bottom:"", body:"This setting decides if your ships will re-evaluate all target-allocations each turn. Ships may switch targets regardless of this setting, if their current target is killed, or  assumed to be killed by other ships in the same turn."});
ad2460.helpButtons.push({dyn_id:"", subject:"Fighter Priority", parent_id:"tactics_slide_fighter_priority_container",    extraClass:"",            left:"308px",right:"",     top:"2px",     bottom:"", body:"<p>Corvette Defense will instruct your Fighters to form up with the corvettes and protect them from incoming enemy Fighters and missiles. Used properly, your fighters will increase the usefullness of your Corvettes. Fighters in this mode can shoot down up to 2 missiles per turn.</p><p>Capital Ship Defense will instruct your Fighters to remain defensively with your capital ships, protecting them from incoming missiles. This setting can be very rewarding, but there is a risk involved if the enemy corvettes are on the offense, then your fighters might do better if they went Ship To Ship.</p><p>Ship To Ship means your Fighters will seek out and destroy enemy corvettes, if possible, and then enemy fighters. This does mean they might end up very close to the main bulk of the enemy fleet though, having to deal with the anti-fighter weaponry of the bigger ships. Fighters in this mode can shoot down up to 1 missile per turn.</p><p>Defend All will instruct your Fighters to spread out and take up position near a capital ship, a corvette or a homeworld defense unit, to protect it and shoot down incoming secondary fire. If it's designated defense-target is destroyed, it will attempt to find a new unit to defend. Note: Utility-ships will not be defended. </p><p>'Capital ship defense' and 'defend all' allows a fighter wing to attempt to shoot down up to 3 passing missiles. 'Corvette defense' will allow up to 2 missiles to be shot down, and 'ship-to-ship' allows for only 1 missile per wing to be shot down per combat round.</p>"});

ad2460.helpButtons.push({dyn_id:"", subject:"Corvette Priority", parent_id:"tactics_slide_corvette_priority_container",  extraClass:"",            left:"308px",right:"",     top:"82px",     bottom:"", body:"Offense instructs your corvettes to go on the offensive, and pick the closest capital ship as a target. Note that they will try to target the closest ship regardless of your Target Priority setting, to avoid them flying into too much anti-minor-fire. This will move your Corvettes to the front of the battle, and can be risky without Fighter escort. While in Offensive mode, corvettes can shoot down 1 incoming missile from the enemy.</p><p>Defense instructs your Corvettes to hang back and protect your capital ships. This way, they will be able to shoot down missiles aimed at the protected ships, and they will be under the protection of your own capital ships. Their missiles will target any ship that comes into range, but it will not leave its defensive position.<br>If there are no Capital Ships left to defend, they will switch to the Offensive priority.<br>While in Defensive mode, corvettes can shoot down up to 2 incoming enemy missiles.</p>"});

ad2460.helpButtons.push({dyn_id:"", subject:"Retreat Options", parent_id:"tactics_slide_retreat_options_container",      extraClass:"",            left:"308px",right:"",     top:"25px",     bottom:"", body:"<p>This section sets the rules for leaving combat. Keep in mind that retreat is not instant. It will take some time to set up the jump, and your fleets may take a lot of damage in the process.<br>You must also know that the attacking side may NOT retreat before 20% of its forces (measured through strength) has been killed. </p><p>The retreat % is a gauge of how much remaining % of a specific fleet value you want to reach before making a retreat. One you have selected the percentage, select the specific stat you wish to monitor the loss for. </p><p>If your opponent is losing about the same amount as you during the fight, you can choose not to retreat, even if your losses reach the retreat value by setting the 'Retreat even if losses are even'-option to 'No'.</p><p>If you get into a fight where the opposing force has more than twice your strength, it is considered unwinnable, and you then have the option to retreat as soon as possible from such a battle.</p>"});
ad2460.helpButtons.push({dyn_id:"", subject:"Retreat Options", parent_id:"launch_fleet_tactics",						extraClass:"",            left:"637px",right:"",     top:"20px",     bottom:"", body:"<p>This section sets the rules for leaving combat. Keep in mind that retreat is not instant. It will take some time to set up the jump, and your fleets may take a lot of damage in the process.<br>You must also know that the attacking side may NOT retreat before 20% of its forces (measured through strength) has been killed. </p><p>The retreat % is a gauge of how much remaining % of a specific fleet value you want to reach before making a retreat. One you have selected the percentage, select the specific stat you wish to monitor the loss for. </p><p>If your opponent is losing about the same amount as you during the fight, you can choose not to retreat, even if your losses reach the retreat value by setting the 'Retreat even if losses are even'-option to 'No'.</p><p>If you get into a fight where the opposing force has more than twice your strength, it is considered unwinnable, and you then have the option to retreat as soon as possible from such a battle.</p>"});

//Fleet Management
ad2460.helpButtons.push({dyn_id:"", subject:"Alliance-use", parent_id:"toggle_alliance_fleet_status_container",          extraClass:"ally_enable", left:"",     right:"",     top:"",     bottom:"", body:"You control which of your fleets can be used by your fellow allies. By allowing this, your allies can select your fleet along one or more of their own fleets to attack an opponent who would otherwise be too strong to take on alone. Your fleet may also be requested to defend an ally. You may of course recall your fleet at any time, should you choose to do so.<br><br>If your alliance fleet is involved in a battle, you will be awarded experience points in relation to the amount of strength you contribute to the total for your side in the fight."});
ad2460.helpButtons.push({dyn_id:"", subject:"Auto-defense", parent_id:"toggle_defense_fleet_status_container",           extraClass:"ally_enable", left:"",     right:"",     top:"",     bottom:"", body:"This is where you can instruct your fleets to jump out and defend your outposts automatically. After any such defense, the fleet will jump back to your homeworld right away. Only one such defense fleet will be sent out to confront and attack. Be careful what kind of tactics you set for these fleets though! Also, don't forget that these fleets will ALWAYS jump back to your homeworld after being the defending side in any combat, regardless of how it got there."});

// Target search
ad2460.helpButtons.push({dyn_id:"", subject:"Searching for targets", parent_id:"target_search_side_header",			extraClass:"", left:"467px",     right:"",     top:"0px",	bottom:"", body:"In AD2460, there are certain limits to who you can attack, and in what way.<br>Players below Level 5 are not allowed to attack anyone at all, nor can they be attacked by anyone.<br>Players at level 5-6 can only attack the outposts of others to try to capture them. At the same time, in this level-range, you can only be attacked at your outposts, not at your homeworld.<br>At level 7 your homeworld can be attacked, and you can attack other homeworlds, within certain limitations:<br>- You can only attack these homeworlds with as much strength as the target owns.<br>-- Exception: Homeworlds can always be hit by their Level * 1000 strength, even if it has 0 strength.- You can only attack homeworlds of the same level as your are, or higher. <br>-- Exception: Anyone can attack the homeworld of a level 12 player and upwards.<br><br><br>When using the search for Stations and Banks, all search parameters are ignored.<br><br>When using the search to look for outposts, keep in mind it will only find OWNED outposts, not available ones. Also, this search only looks at 3 parameters: Strength, Alliance-name and Quadrant. All other parameters are ignored.<br><br>Please note that searching for Outposts is a complex task and can noly be performed once every 3 minutes."});
ad2460.helpButtons.push({dyn_id:"", subject:"Alliance-name in target-search", parent_id:"target_search_form_box",	extraClass:"", left:"459px",	right:"",     top:"0px",	bottom:"", body:"If you enter characters in the alliance-field, to look for players from a specific alliance, you do not have to type the full alliance-name, as long as you get the first 3 characters correctly. <br>So if searching for players from 'UltraCool Alliance', typing in 'ultra' will be more than enough. Typing 'Cool' will not be sufficient, as the name doesn't begin with 'cool'.<br><br>Leave it blank to get as many targets listed as possible."});
//ad2460.helpButtons.push({dyn_id:"", subject:"Level", parent_id:"target_search_form_box",							extraClass:"", left:"459px",     right:"",     top:"27px",	bottom:"", body:"In AD2460 noone can attack targets that have not yet reached level 4. For targets who have, and who are within the range of level 4-6, you can hit their outposts only, not their homeworld. <br><br>If you want to hit someones homeworld, at your own peril, you must look for targets at level 7 and upwards."});
ad2460.helpButtons.push({dyn_id:"", subject:"Quadrants in target-search", parent_id:"target_search_form_box",       extraClass:"", left:"459px",     right:"",     top:"27px",	bottom:"", body:"The entire galaxy in AD2460 is divided into 4*4 quadrants. What lies beyond, and how to get there, is unknown for the time being. <br><br>Specify which quadrant you with to search in, the default setting is your own. We recommend leaving it there."});
ad2460.helpButtons.push({dyn_id:"", subject:"Distance", parent_id:"target_search_form_box",							extraClass:"", left:"459px",     right:"",     top:"54px",	bottom:"", body:"You might want to be careful when attacking someone too far away. Your fleet will spend 10 minutes recharging jumpengines at each jump on the way home. <br><br>The distance in Clusters is quite close to the number of jumps, but this may be changed by the content of the attacking fleet and bonuses to jumpengines etc. <br><br>The thumb rule is: Expect your fleet to be spending <br>10 minutes * (clusterdistance-1) <br>on it's way back home.<br><br>You should also consider that stealing outposts far away might cause inefficient use of your transport-ships, forcing them to spend most of their time travelling great distances and recharging jumpengines.<br><br>Please also note that if you attack and capture an outposts, your attacking fleet will park there in defense and remain there. To order it back home, use the Fleet Movement panel."});

// Homeworld Section

// XP!!
ad2460.helpButtons.push({dyn_id:"", subject:"Experience Points", parent_id:"hw_xp_container",		extraClass:"", left:"440px",     right:"",	top:"-1px",		bottom:"", body:"Experience points are needed to increase your advancement level. They are essentially a counter to show you how far you have progressed on the current level.<br><br> Experience points are gained in battles with other players, completing facilities, researches and developments, and through participation in missions. You also gain a small amount of experience points through intelligence operations and the prospecting of clusters.<br><br>Experience points requirement for each level:<br>Level 2: 250 XP<br>Level 3: 500 XP<br>Level 4: 2 000 XP<br>Level 5: 5 000 XP<br>Level 6: 10 000 XP<br>Level 7: 15 000 XP<br>Level 8: 20 000 XP<br>Level 9: 30 000 XP<br>Level 10: 50 000 XP<br>Level 11: 100 000 XP<br>Level 12: 150 000 XP<br>Level 13: 200 000 XP<br>Level 14: 250 000 XP<br>Level 15: 300 000 XP<br>Level 16: 350 000 XP<br>Level 17: 400 000 XP<br>Level 18: 500 000 XP<br>Level 19: 750 000 XP<br>Level 20: 1 000 000 XP<br>Level 21: 2 000 000 XP<br>Level 22: 3 000 000 XP<br>Level 23: 4 000 000 XP<br>Level 24: 5 000 000 XP<br>Level 25: 10 000 000 XP<br>"});
// XP!!

ad2460.helpButtons.push({dyn_id:"", subject:"Advancement Level", parent_id:"hw_level_container",	extraClass:"", left:"440px",     right:"",	top:"-1px",	bottom:"", body:"Your advancement level is not only an indication of your experience with the game. Each level also increases your ability to hold outposts and commanders. The limits are:<br><br>Level 1: 1 outpost and 3 commanders.<br>Level 2: 2 outposts and 4 commanders.<br>Level 3: 3 outposts and 5 commanders.<br>Level 4: 3 outposts and 6 commanders.<br>Level 5: 4 outposts and 7 commanders.<br>Level 6: 5 outposts and 8 commanders. -5% production time.<br>Level 7: 5 outposts and 9 commanders.<br>Level 8: 6 outposts and 10 commanders. -10% production time.<br>Level 9: 7 outposts and 11 commanders.<br>Level 10: 8 outposts and 12 commanders. -15% production time.<br>Level 11: 9 outposts and 13 commanders.<br>Level 12: 10 outposts and 14 commanders. -20% production time.<br>Level 13: 10 outposts and 15 commanders.<br>Level 14: 11 outposts and 16 commanders. -25% production time.<br>Level 15: 12 outposts and 17 commanders.<br>Level 16: 13 outposts and 18 commanders. -30% production time.<br>Level 17: 14 outposts and 19 commanders.<br>Level 18: 15 outposts and 20 commanders. -35% production time.<br>Level 19: 15 outposts and 21 commanders.<br>Level 20: 16 outposts and 22 commanders. -40% production time.<br>Level 21: 17 outposts and 23 commanders.<br>Level 22: 18 outposts and 24 commanders.<br>Level 23: 19 outposts and 25 commanders.<br>Level 24: 20 outposts and 25 commanders.<br>Level 25: 21 outposts and 25 commanders.<br><br><br><br>Each level also give you an additional tech point to spend.<br><br>Fighting-related information:<br>Level 1-4: You may not attack or be attacked by other players at all.<br>Level 5-6: You may only attack outposts or be attacked at your own outposts.<br>Level 7 and upwards: You may attack homeworlds belonging to players at your own level or higher. Likewise, your homeworld may be attacked by those of your level or below..<br>Level 11: You may attack stations<br>Level 12 and upwards: Any player of any level may attack your homeworld."});
ad2460.helpButtons.push({dyn_id:"", subject:"Tech", parent_id:"hw_tech_container",					extraClass:"", left:"440px",     right:"",	top:"-1px",	bottom:"", body:"This is an overview of how you have distributed your tech points. Based on this, you will be shown your tech tilt.<br><br>If you have put the most points in the InTech tree, you will be shown as InTech(x/x/x). If you have distributed your points evenly, this will also be indicated."});
ad2460.helpButtons.push({dyn_id:"", subject:"Score", parent_id:"hw_score_container",				extraClass:"", left:"440px",     right:"",	top:"-1px",	bottom:"", body:"Your score is a simple representation of your Strength, your XP, your Wins, your Tactical Victories, your Underdog Wins, your Outposts and your outpost ownership history."});
ad2460.helpButtons.push({dyn_id:"", subject:"Strength", parent_id:"hw_strength_container",	extraClass:"", left:"440px",     right:"",	top:"-1px",	bottom:"", body:"Strength is an indication of your military capabilities. For military ships, each ship adds a certain amount of strength based on their weapons shields and hull. Transports add a set amount per ship, and outposts add 10 strength per level.<br><br>This strength value is used when calculating experience points bonuses and penalties when launching attacks on other players. Attacking players who are stronger than you gives better xp for the fight than attacking players that are weaker. If you attack too weak players, you may even lose experience points.<br>Player strength will be coloured in the planet information about the player.<br><span style='color: red;'>Red</span> - indicates a player with more than 150% of your own total strength.<br><span style='color: orange;'>Orange</span> - indicates a player with 125-150% of your own total strength.<br><span style='color: yellow;'>Yellow</span> - indicates a player with 110-125% of your own total strength.<br><span style='color: green;'>Green</span> - indicates a player with 90-110% of your own total strength.<br><span style='color: cyan;'>Cyan</span> - indicates a player with 75-90% of your own total strength.<br><span style='color: pink;'>Pink</span> - indicates a player with less than 75% of your own total strength.<br><br>Please note that units that are defending your outposts are not included."});
ad2460.helpButtons.push({dyn_id:"", subject:"Coordinates", parent_id:"hw_locaction_container",		extraClass:"", left:"440px",     right:"",	top:"-1px",		bottom:"", body:"In AD2460, a location has a set of 5 coordinates, like [2:3:4:12.5].<br>The first number is the quadrant.<br>The second number is the sector.<br>The third number is the cluster.<br>The fourth number is the solar-system.<br>The fifth number is the planet-number inside the solar system.<br><br>You can search for planet-names and player-names in the Starmap.<br><br>Coordinates in AD2460 are usually clickable, and will take you directly to the listed location in the starmap. Try clicking on the coordinates for your homeworld and see."});
ad2460.helpButtons.push({dyn_id:"", subject:"Outlook", parent_id:"hw_outlook_container",			extraClass:"", left:"440px",     right:"",	top:"-1px",	bottom:"", body:"The outlook stat in the game is a gauge of how you are playing your missions. Certain missions in the game will add to your score in a certain outlook type. The more you select a specific outlook type when doing missions that require you to select an option on how to perform the mission, the more locked into a specific outlook you will be.<br><br>Outlook will allow you to engage in and complete certain mission packs especially designed for your outlook, which may have special rewards.<br><br>There are three types of outlooks in the game:<br>- Tactical: This outlook means you are working to get the most efficient results, or the most precise results you possibly can, using all the available means at your disposal. You can be quite sneaky about matters to get what you want.<br>- Diplomatic: You are working to make sure your goals are met, but at the same time taking into account the other parties in the situation, and accounting for future scenarios where you might need to interact with them again. However, you are interested in your own gains, and can bend the truth if the situation calls for it. You also know at what point diplomacy loses its purpose.<br>- Conqueror: You're interested in results. They may come at a cost, but as long as it is not your own, it really doesn't make that much difference. You can be quite heavy-handed when it comes to solving your problems."});

// Commander Section
ad2460.helpButtons.push({dyn_id:"", subject:"Your Commanders", parent_id:"commanders_sidepanel_bg",           extraClass:"", left:"",     right:"20px",     top:"9px",     bottom:"", body:"Commanders are used primarily for commanding your fleets. They are also used in diplomatic missions.<br><br>To rename your commander, click on the commander name, type the new name and press enter.<br><span style='color: yellow; font-style: italic;'>Renaming your commander costs 2 credits (FREE for VIPs).</span><br><br>The personality of your commander determines how he or she acts and reacts in a battle. In broad terms, the commander is responsible for target selection and assessment of how much damage you can inflict on an enemy ship. Cautious commanders tend to play it safe by allocating a lot of damage to enemy ships, while nonchalant commanders will assign less. The range of personalities go from most to least 'safe' as follows:<br>Zealot - Tactician - Veteran - Independent - Loose Cannon<br>The personality will also affect how the commanders view your retreat-settings, and a Loose Cannon is more likely to 'bend' your orders than a Zealot is. This includes how much your commander will be influenced by his own Tactics-stat (see below).<br><br>The attributes of the commander play a role in each battle.<br>Commanding: Affects use of commander ability. A higher stat increases chance ot triggering it early.<br>Perception : Affects targeting performance. A higher stat improves targeting for ALL weapons.<br>Tactics: Affects target priority. A high stat in Tactics will allow the commander to override target-priority for single ships if he thinks it makes sense! <br>Morale : Affects damage-output. A higher stat improves ALL damage output.<br><br>The Experience counter shows how much of the required experience points the commander has acquired towards gaining a rank. Experience points are gained through battles and missions.<br><br> Each rank allows the commander a certain amount of total strength within a fleet. In order to build larger and stronger fleets, your commanders need to gain ranks. The strength limits are as follows:<span style='line-height: 22px;'><br><img src='images/icons/insignias/rank01.png' height='18' style='vertical-align:text-bottom;' />Rank 1: 2nd Commander - 10 000 Strength. Max 1 fleet.<br><img src='images/icons/insignias/rank02.png' height='18' style='vertical-align:text-bottom;' />Rank 2: 1st Commander - 20 000 Strength. Max 1 fleets.<br><img src='images/icons/insignias/rank03.png' height='18' style='vertical-align:text-bottom;' />Rank 3: Captain: 30 000 Strength. Max 2 Fleets.<br><img src='images/icons/insignias/rank04.png' height='18' style='vertical-align:text-bottom;' />Rank 4: Fleet Major: 40 000 Strength. Max 2 fleets.<br><img src='images/icons/insignias/rank05.png' height='18' style='vertical-align:text-bottom;' />Rank 5: Vice Marshal: 50 000 Strength. Max 3 fleets.<br><img src='images/icons/insignias/rank06.png' height='18' style='vertical-align:text-bottom;' />Rank 6: Fleet Marshal: 60 000 Strength. Max 4 fleets.<br><img src='images/icons/insignias/rank07.png' height='18' style='vertical-align:text-bottom;' />Rank 7: Vice Commodore: 70 000 Strength. Max 5 fleets.<br><img src='images/icons/insignias/rank08.png' height='18' style='vertical-align:text-bottom;' />Rank 8: Chief Commodore: 80 000 Strength. Max 7 fleets.<br><img src='images/icons/insignias/rank09.png' height='18' style='vertical-align:text-bottom;' />Rank 9: Master Commodore: 90 000 Strength. Max 10 fleets.<br><img src='images/icons/insignias/rank10.png' height='18' style='vertical-align:text-bottom;' />Rank 10: Vice Admiral: 100 000 Strength, Max 15 fleets.</span>"});
ad2460.helpButtons.push({dyn_id:"", subject:"Recruits", parent_id:"academy_recruits",						extraClass:"", left:"",     right:"20px",     top:"9px",     bottom:"", body:"Fresh recruits are made available to you every 2 hours in the game. If you don't like one, just ignore him / her and wait for a new recruit to volunteer.<br><br>The rank of any new recruit is determined by your Officer Academy facility."});

// Fleet Management Section
ad2460.helpButtons.push({dyn_id:"", subject:"Fleet Management", parent_id:"fleet_management_sidepanel_bg",           extraClass:"", left:"",     right:"20px",     top:"9px",     bottom:"", body:"You will be using this section a lot. This is where you set up your fleets, manage all your capital ships, your minor ships (fighters and corvettes) and any other utility, defense or transport units you may have.<br><br>In order to set up a fleet, you need only one thing: an available commander. If you have this, then you can click 'create new fleet' in order to set up a fleet using an available commander. Once the fleet has been set up, you can transfer ships from your base fleet into the new fleet. All ships that are produced on your homeworld are placed in the base fleet.<br><br>Once you have selected a fleet, you will see the details for that fleet on the right hand side. <br><br>'Recharge' means that your fleet has used it's jump engines recently, and has to wait for the displayed amount of time until it can make another jump.<br>'Shortage' is the number of minor ship wings that you still have room for in your fleet. Click 'Minor Ships' to assign more to your fleet.<br><br>You also have several functions you can use to modify your fleet.<br><br>'Move Ships' is used for moving capital ships between fleets. This will move ships FROM your currently selected fleet and into another of your fleets. 'Move Ships' Also allows you to scrap any unwanted ships by moving them to the 'Scrapyard', by selecting it as a destination for the ships you move.<br><br>'Minor Ships' will supply your currenty selected fleet with fighters and corvettes. It moves minor ships INTO your fleet from the base fleet.<br><br>'Tactics' will set up the default tactics for the selected fleet. These will be used if the fleet is attacked, and if the commander of the fleet is the ranking officer at an outpost. These settings are also the default settings when you initiate an attack where the selected fleet has the commanding officer of that attack.<br><br>'Disband' will delete the fleet. All ships will be moved into the base-fleet, and your commander will be available to use in another fleet, or used for a diplomatic mission.<br><br>The fleet log shows all the relevant activities for your selected fleet."});

// Fleet Movement Section
ad2460.helpButtons.push({dyn_id:"", subject:"Your Fleet Movements", parent_id:"fleet_tracking_sidepanel_bg",           extraClass:"", left:"",     right:"20px",     top:"9px",     bottom:"",    zIndex:"2",body:"Select any of your fleets to access the details about that fleet.<br><br>Apart from getting the details of your fleet, like how many capital ships it contains, what its relative strength is and where it is located, you can order any of your fleets to move to a location of your choosing.<br><br>In order to move a fleet, select if and use the dropdown menu under 'move to:' to select your destination. Clicking on 'Launch' will initiate the move-order.<br><br>In the fleet log, you can also see where your fleet has been, and what it has been doing recently."});

//Outpost
ad2460.helpButtons.push({dyn_id:"", subject:"Number of outposts", parent_id:"outpostspane",           extraClass:"", left:"",     right:"45px",     top:"33px",     bottom:"",body:"This shows the current number of outposts you have, as well as the total amount of outposts you can claim based on your advancement level.<br><br>Note that you are allowed to capture outposts beyond this number, but they will not be operational until you abandon one of your older outposts. <br><br>The amount of additional outposts you can have beyond your limit is 2. If you gain a level, or lose an outpost, you can choose to activate one of the outposts that was previously on hold due to having too many. Open the details for the one you wish to activate, and press 'Activate' on the top right section of the outpost. As you gain in Levels, you can have more outposts.<br><br>Even though your outposts can be attacked and taken, you cannot lose all your outposts through continued attacks from others. If you lose too many outposts in a short time, you will gain a grace-period, where no one can attack you for a while.<br><br>The amount of outposts you can have per level are:<br>Level 1: 1 outposts<br>Level 2: 2 outposts<br>Level 3: 3 outposts<br>Level 4: 3 outposts<br>Level 5: 4 outposts<br>Level 6: 5 outposts<br>Level 7: 5 outposts<br>Level 8: 6 outposts<br>Level 9: 7 outposts<br>Level 10: 8 outposts<br>Level 11: 9 outposts<br>Level 12: 10 outposts<br>Level 13: 10 outposts<br>Level 14: 11 outposts<br>Level 15: 12 outposts<br>Level 16: 13 outposts<br>Level 17: 14 outposts<br>Level 18: 15 outposts<br>Level 19: 15 outposts<br>Level 20: 16 outposts<br>Level 21: 17 outposts<br>Level 22: 18 outposts<br>Level 23: 19 outposts<br>Level 24: 20 outposts<br>Level 25: 21 outposts<br><br>If someone captures one of your outposts, you will be granted 'Outpost-grace' for 3 hours. This means that noone are able to attack any of your outposts for the next 3 hours."});

ad2460.helpButtons.push({dyn_id:"", subject:"Your Outpost", parent_id:"selected_outpost_sidepanel_bg",           extraClass:"", left:"",     right:"165px",     top:"10px",     bottom:"",body:"To rename your outpost planet, click on the outpost name, type the new name and press enter.<br><span style='color: yellow; font-style: italic;'>Renaming your outpost costs 2 credits.</span><br><br>You can find all the relevant details about your selected outpost here. Most of the entries should be self-explanatory, but there are some specific functions that will be explained in more detail.<br><br>You can choose to upgrade your outpost to the next level. The top right panel shows all of the details for this. It displayes your current output, and the output that will be active once the upgrade has been completed. The cost of the upgrade is listed as normal, and you can click the center button to start upgrading the outpost. Keep in mind that only one outpost can be upgraded at a time, and that while the upgrading is in progress, the outpost will stop producing resources for you.<br><br>If you click on 'Abandon Outpost' the outpost station will be destroyed, and the planet will be available to claim for other players. <br>If there are any units present defending the outpost, they will be destroyed. You can also click 'defensive overview' to see which commander is in change at the moment, and what the current tactics for the defense of the outpost is."});

ad2460.helpButtons.push({dyn_id:"", subject:"The Outpost List", parent_id:"outpost_list_header_container",           extraClass:"", left:"",     right:"6px",     top:"4px",     bottom:"",body:"This list contains all the outposts you currently own (some exceptions are descibed below).<br><br>Each row on the list shows you the most relevant information about a specific outpost location. Image, planet name and starmap coordinates come first. Clicking on the coordinates will take you directly to the solar system containing the outpost planet, and select it. Clicking anywhere else in the row will open the outpost details panel. This is the panel in the lower right corner of your screen.<br><br>'T-Time' is an indication of how long it will take a fleet to return to your homeworld from the specific outpost.<br><br>'Lvl' shows you the current level of the outpost.<br>'Pot' shows you the output potential of the outpost planet. 10/10 is the best, while 1/10 is the worst.<br>The 'Def' column shows you how much defense is present at the outpost. If this number is red, you need more defense there. <br><br>Defending outposts also gives your ships certain advantages in the fight. Note that the following bonuses apply to all ships defending an outpost:<br>- The outpost will boost all shields of all defending units. The higher the level of the outpost, the bigger the shield boost.<br>- When defending an outpost, the commander can tap into the outpost power-relays, resulting in more damage on all weapons per outpost level.<br><br>'Output' is the combined output of resources per hour for this outpost at its current level. You can see the distribution of resources in the detailed view.<br><br>If you are upgrading your outpost, it will shut down while upgrading, not producing any more resources until the upgrade is complete.<br><br>If you lose an outpost, it will be maked as 'Lost'. You will see who took it and what alliance they belong to. Lost outposts remain on your outpost list for 2 days. After that, they are removed from your list."}) ;

//Alliance Section
ad2460.helpButtons.push({dyn_id:"alliance_military", subject:"Alliance Military Settings", parent_id:"alliance_section_side_header",           extraClass:"", left:"",     right:"0px",     top:"0px",     bottom:"", body:"In this section the alliance leader can set up the requirements for the use of alliance fleets, based on member rank, and set limits on the amount of fleets available per rank as well.<br><br>These settings can only be adjusted by those with the two highest ranks in the alliance."});
ad2460.helpButtons.push({dyn_id:"alliance_missions", subject:"Alliance Missions", parent_id:"alliance_section_side_header",           extraClass:"", left:"",     right:"0px",     top:"0px",     bottom:"", body:"Alliance missions are initiated by members that have the right to do so. Only one mission can be active at any time, and a mission cannot be cancelled once initiated."});
ad2460.helpButtons.push({dyn_id:"alliance_officers", subject:"Alliance Officers and Rank Management", parent_id:"alliance_section_side_header",           extraClass:"", left:"",     right:"0px",     top:"0px",     bottom:"", body:"This section allows the alliance leader to determine which of the member ranks have access to specific actions and rights within the alliance. Select a rank, and then edit the rights by toggling them in the lower panel. This is done for each rank in the alliance.<br><br>The alliance leader can also customize each of the rank names, to make the alliance more fun, original, and personal."});
ad2460.helpButtons.push({dyn_id:"alliance_invites", subject:"Active Alliance Invites", parent_id:"alliance_section_side_header",           extraClass:"", left:"",     right:"0px",     top:"0px",     bottom:"", body:"Any pending invites to the alliance will be listed here. any officer with the rights to invite players into the alliance will be able to add an invite in this section. Those thatdo not, will only see the currently issued invites.<br><br>If you do not have the right to invite players in, contact your alliance officert to ask if they can add a friend, or let you have invite rights."});
ad2460.helpButtons.push({dyn_id:"alliance_motd", subject:"Message of the Day", parent_id:"alliance_section_side_header",           extraClass:"", left:"",     right:"0px",     top:"0px",     bottom:"", body:"The Message of the Day (MOTD) can be edited by any officer with rights. All other members will simply see the currently active text. <br><br>The MOTD is used primarily for announcing important information to all members, so remember to check yout MOTD whenever you log in, so you're not missing out on important information."});
ad2460.helpButtons.push({dyn_id:"alliance_information", subject:"Alliance Information", parent_id:"alliance_section_side_header",           extraClass:"", left:"",     right:"0px",     top:"0px",     bottom:"", body:"The alliance information section contains information that as accessible to players who are not members of the alliance. Any member with the correct rights can edit the text and change the alliance-image.<br><br>The officers with special responsibilities are also listed here. Member responbilities are set in the 'Member List'-section."});
ad2460.helpButtons.push({dyn_id:"alliance_tax", subject:"Alliance Tax System", parent_id:"alliance_management_sidepanel_content",           extraClass:"", left:"",     right:"10px",     top:"0px",     bottom:"", body:"The tax system for the alliance has a big impact on player economies. The default setting for the alliances is 'Free Alliance'.<br><br>Free alliances do not pay any taxes to the alliance bank. This means that any funds for alliance projects, missions and other alliance expenses such as donations will require the alliance members to first make a deposit to the bank. <br><br> Initially, a free alliance has a lower alliance upkeep cost initially, but as the amount of members increase, the upkeep costs rise more for a free alliance than a taxed one. For free alliances, the upkeep costs are as follows:<br>1-10 members: 3% alliance upkeep.<br>11-20 members: 6% alliance upkeep.<br>21-30 members: 9% alliance upkeep.<br>31-40 members: 12% alliance upkeep.<br>41-50 members: 15% alliance upkeep.<br>51-60 members: 18% alliance upkeep.<br>61-70 members: 21% alliance upkeep.<br>71-80 members: 24% alliance upkeep.<br>81-90 members: 27% alliance upkeep.<br>91-100 members: 30% alliance upkeep.<br>101-110 members: 32% alliance upkeep.<br>111-120 members: 34% alliance upkeep.<br>121-130 members: 36% alliance upkeep.<br>131-140 members: 38% alliance upkeep.<br>141 or more members: 40% alliance upkeep.<br><br>If 'Taxed Alliance' is selected, the alliance pays a smaller sum to keep the peace internally in the alliance, but each member is also required to pay a certain amount of all resources produced, both on the homeworld and any resources delivered to the homeworld. Taxes are deposited into the alliance bank (see help in the 'Alliance Bank'-section). The taxes for a taxed alliance are as follows:<br>1-10 members: 7% alliance upkeep.<br>11-20 members: 9% alliance upkeep.<br>21-30 members: 11% alliance upkeep.<br>31-40 members: 13% alliance upkeep.<br>41-50 members: 15% alliance upkeep.<br>51-60 members: 17% alliance upkeep.<br>61-70 members: 19% alliance upkeep.<br>71-80 members: 21% alliance upkeep.<br>81-90 members: 23% alliance upkeep.<br>91-100 members: 25% alliance upkeep.<br>101-110 members: 27% alliance upkeep.<br>111-120 members: 29% alliance upkeep.<br>121-130 members: 31% alliance upkeep.<br>131-140 members: 33% alliance upkeep.<br>141-150 members: 35% alliance upkeep.<br>151-160 members: 37% alliance upkeep.<br>161-170 members: 38% alliance upkeep.<br>171-180 members: 39% alliance upkeep.<br>181 or more members: 40% alliance upkeep.<br><br>The taxed alliance also has a 'Bank Deposit %'-setting. This shows how much of the collected taxes are deposited into the alliance bank. The rest of the collected resources will be distributed to each alliance member, and go into their homeworld resource holdings (not the local bank holdings).<br><br>The withdrawal limit is set by the alliance leader, and shows the maximum amount of resources that can be moved out of the alliance bank to any one player in a 24-hour period. The default value is 1 000 000."});

ad2460.helpButtons.push({dyn_id:"alliance_bank", subject:"The Alliance Bank", parent_id:"alliance_section_side_header",           extraClass:"", left:"",     right:"0px",     top:"0px",     bottom:"", body:"The alliance bank contains resources that are collected via taxes in a taxed alliance, or deposited into the bank by members of the alliance. The resources in the alliance bank can be used to initiate alliance projects, or they can be used to donate resources to players who are in need of them. The alliance-bank can currently hold a maximum of 400 millions of each resource-type.<br><br>The alliance bank is located on it's own planet. This bank-planet has it's own defense-fleet. All members of an alliance can donate ships to this special fleet from Fleet Management. All such donations must be done from the Base-fleet, and are one-way, the ships can never be returned. The members with Military Rights can control the tactics at the station. The bank-fleet can receive ships up to 1 000 000 strength, and it may contain 1 500 minor ships. It has it's own Hangar-space, so there is no need to send Carriers into the bank-fleet.<br><br>The bank pays fleet-upkeep out of it's own resources. The bank-fleet can only be repaired by repair-ships inside the bank-fleet.<br><br> If attacked, the bank can be robbed for 40% of it's content, if the attacker wins and brings enough transport-ships.<br>Keep in mind, the alliance-bank will always retain at least 1 000 000 of each resources after a robbery, and this amount can never be stolen."});

ad2460.helpButtons.push({dyn_id:"alliance_news", subject:"Alliance News", parent_id:"alliance_section_side_header",           extraClass:"", left:"",     right:"0px",     top:"0px",     bottom:"", body:"The alliance news shows all the important events in the life of the alliance. Each event gets an entry in the list, and using the filters, you can select to view only certain types of events.<br><br>The events that are listed are (by type);<br>- Members battles.<br>- Members joining or leaving the alliance.<br>- New marketplace trades, if the list has been empty.<br>- Important changes to the alliance, such as changing from taxed alliance to free alliance or change in alliance leader<br>- Alliance missions being initated, and reports of their outcome.<br>- Initiation and completion of alliance projects."});
ad2460.helpButtons.push({dyn_id:"alliance_stations", subject:"Stations and Sector Control", parent_id:"alliance_section_side_header",           extraClass:"", left:"",     right:"0px",     top:"0px",     bottom:"", body:"Within each quadrant, there are active ancient stations that an alliance can gain control over. These stations add a substantial and specific bonus to the entire alliance. To see what bonus a specific station gives, go to the sector it resides in, and the bonus will be displayed in the stamap view, along with the name of the controlling alliance.<br><br><b>The bonuses shown in the sector view are divided by the number of members in your alliance.</b><br><br>If you zoom in to the cluster where the station is you get the same iformation. The owner of the alliance controlling the station is also the owner of the station in this view.<br><br>Holding stations is also a territorial control function, and the alliance with the most stations held within a quadrant are 'Rulers of the Quadrnt', and if an alliance has the most stations in the galaxy, they are given the title 'Rulers of the Galaxy'. This is displayed in the quadrant and galaxy views on the starmap.<br><br>If a station is lost, the losing alliance immediately lose their bonuses from that station. They may also lose their standing as rulers of a quadrant or the galaxy.<br><br>In order to keep a station secure, the alliance must defend the station. This is done by placing fleet at the station. Using the 'Fleet Movements'-panel, you can move one of your fleets to any of the stations that your alliance is holding.<br><br><i>Fleets at a station DO NOT return to your homeworld after a battle unless the station has been lost.</i><br><br>Tactical settings and an overview of the current ships defending a station can be accessed via the station list at the bottom right of the panel.<br><br>There is more information about station battles in the AD-Info section as well."});

ad2460.helpButtons.push({dyn_id:"", subject:"InTech", parent_id:"tech_tree_heading_intech", extraClass:"", left:"160px",     right:"",     top:"4px",     bottom:"", body:"<span style='color: yellow; font-style: italic;'>Resetting your tech points costs 5 credits if you are level 8 or higher.</span><br><br>All research and development within the InTech specialisation  deals with modifying the physical properties of materials. The InTech specialisation also deals with advanced engineering and construction with these materials. The key element for this technology is Indium, from which it also takes its name. Nations that rely heavily on  InTech will be able to construct immense transportation vehicles. InTech ships also have an extreme focus on the physical defences. This means that the hulls of those ships are considered the strongest in the universe.<br><br>Strong and heavy isn't the only trademark of this technological direction though. By focusing on physical properties of matter and advanced structural engineering, this technology can also build some of the most lightweight ships, while still maintaining a high degree of protection.<br><br>Keep in mind that the current maximum tech point cap is 75 points."});
ad2460.helpButtons.push({dyn_id:"", subject:"StronTech", parent_id:"tech_tree_heading_strontech", extraClass:"", left:"160px",     right:"",     top:"4px",     bottom:"", body:"<span style='color: yellow; font-style: italic;'>Resetting your tech points costs 5 credits if you are level 8 or higher.</span><br><br>Nations choosing to specialize into StronTech focus on developing their technology to gain the most from the harnessing and release of energy. StronTech gets its name from the element is is most reliant upon: Strontium.<br><br>This specialisation allows for greatly increased energy efficiency in all types of production, and boosts both the relative power of both high energy weapons and energy-shielding. StronTech specialists rely heavily on shielding for protection, and ships built to accommodate this technology are usually built around the needs of its energy-related components rather than practicality, and this gives these ships a distinct look. Non-symmetrical, or angled, and sometimes sleek are words often used to describe these ships.<br><br>Keep in mind that the current maximum tech point cap is 75 points."});
ad2460.helpButtons.push({dyn_id:"", subject:"NeoTech", parent_id:"tech_tree_heading_neotech", extraClass:"", left:"160px",     right:"",     top:"4px",     bottom:"", body:"<span style='color: yellow; font-style: italic;'>Resetting your tech points costs 5 credits if you are level 8 or higher.</span><br><br>NeoTech specialists are the masters of the manipulation of gravitational and magnetic fields. This technology is perhaps the most obscure, as it deals with mostly exclusively invisible elements in the universe. It is nevertheless an extremely powerful technological direction, since it works around the manipulation of space itself.<br><br>NeoTech takes its name from the most essential building block for any field modification devices: Neodymium.<br><br>Keep in mind that the current maximum tech point cap is 75 points."});

ad2460.helpButtons.push({dyn_id:"", subject:"Payment-information", parent_id:"purchase_frame", extraClass:"", left:"",     right:"35px",     top:"8px",     bottom:"", body:"We charge mostly in Euros.<br><br>1 euro is approximately:<br>-- 1.28 USD <br>-- 0.80 GBP <br>-- 1.40 AUD <br>-- 8.30 NOK<br>-- 9.10 SEK<br><br>If you have questions regarding the credit system, please post them on the forums.<br><br>If you are having problems with payments or payment options, please send an e-mail to support@ad2460.com and describe your problem.<br>"});

ad2460.helpButtons.push({dyn_id:"", subject:"Homeworld Production",			parent_id:"eco_title_hwprod", extraClass:"",		left:"260px",     right:"",     top:"4px",     bottom:"", body:"Here you can see the amount of resources extracted by your homeworld refineries every hour. With refineries providing resources 4 times per hour, you can expect 1/4 of this amount every 15 minutes."});
ad2460.helpButtons.push({dyn_id:"", subject:"Outpost Production",			parent_id:"eco_title_opprod", extraClass:"",		left:"260px",     right:"",     top:"4px",     bottom:"", body:"Here you can see the amount of resources extracted by your outposts every hour. With outpost-mining happening 4 times per hour, you can expect 1/4 of this amount every 15 minutes, spread out on all your outposts."});
ad2460.helpButtons.push({dyn_id:"", subject:"Alliance Tax Distribution",	parent_id:"eco_title_ataxdist", extraClass:"",		left:"260px",     right:"",     top:"4px",     bottom:"", body:"Taxed alliances can choose to tax their members with a set percentage of all income. <br><br>The alliance then also decides wether the tax should go into the alliance-bank, or if some part of it should be handed out equally to its members. Such tax-distribution can be a huge help for the smaller members, who pay little and receive more, and the richer members will contribute more and receive the same amount.<br><br>The numbers here are based on what you have received in the past 24 hours, and divided by 24 to estimate how much income this will bring you per hour."});
ad2460.helpButtons.push({dyn_id:"", subject:"Fleet Upkeep",					parent_id:"eco_title_fleetupkeep", extraClass:"",	left:"260px",     right:"",     top:"4px",     bottom:"", body:"Fleet upkeep is paid every 15 minutes. The amount you see here is the hourly rate, so you will pay 1/4 of this every 15 minutes.<br><br>If you fail to pay this upkeep-cost, you will end up with ships not being repaired, some might even be damaged, and some might even be destroyed."});
ad2460.helpButtons.push({dyn_id:"", subject:"Alliance Upkeep",				parent_id:"eco_title_allianceupkeep", extraClass:"",left:"260px",     right:"",     top:"4px",     bottom:"", body:"As alliances grow, more upkeep must be paid to retain the diplomatic relations with all members. Alliance-upkeep is paid whenever your homeworld is extracting resources, or when your transport-ships return home with raw resources to refine. <br><br>The numbers listed here show you your average hourly alliance-upkeep for the past 24 hours."});
ad2460.helpButtons.push({dyn_id:"", subject:"Alliance Tax",					parent_id:"eco_title_alliancetax", extraClass:"",	left:"260px",     right:"",     top:"4px",     bottom:"", body:"Taxed alliances can choose to tax their members with a set percentage of all income. This tax is paid every time your homeworld extracts resources through the refinery-facilities and every time transports return home with resources. <br><br>The numbers listed here show you your average hourly alliance-tax for the past 24 hours."});
ad2460.helpButtons.push({dyn_id:"", subject:"Balance",						parent_id:"eco_title_balance", extraClass:"",		left:"260px",     right:"",     top:"4px",     bottom:"", body:"This is an estimate on how your overall economy is going. If you see a profit here, it means that you can cover your current and expected expenses if you bring home all available resources from all outposts every hour."});

ad2460.helpButtons.push({dyn_id:"", subject:"Upkeep-debt",					parent_id:"eco_title_upkeepdebt", extraClass:"",	left:"260px",     right:"",     top:"4px",     bottom:"", body:"Every hour, ship-upkeep is paid. If you are unable to pay this upkeep, what you can not pay is added to your upkeep-debt. While you have debt, no repairs will occur. Debts are always paid first before any new upkeep is considered, every hour."});

ad2460.helpButtons.push({dyn_id:"combat_status", subject:"Status Meters",	parent_id:"battle_live_stats", extraClass:"",	left:"",     right:"5px",     top:"160px",     bottom:"", body:"The status gauges for the battle show the three factors by which retreat options can be set:<br>- Capital Ships.<br>- Fire Power.<br>- Hull.<br><br>These gauges are updated live throughout the battle, and can be useful tools for gauging how the battle is going initially, but also for evaluating the battle in retrospect.<br><br>All gauges show the percentage of total remaining for each side. Actual values for capital ships, firepower and hull might not be equal, even if the gauges show the same percentage value.<br><br>Green always shows the defending player, while red designates the attacker."});
ad2460.helpButtons.push({dyn_id:"combat_option_text", subject:"Combat Controls",	parent_id:"battle_controls", extraClass:"",	left:"377px",     right:"",     top:"87px",     bottom:"", body:"This is the control section of the battle view. From here you can change the speed at which the battle is displayed. Use the 'Play/Pause', 'Slow' and 'Fast'-buttons to set the speed. The current speed indicator is just below the controls.<br><br>The current round indicator is shown on the left.<br><br>The tactics toggle will show you the current tactics of the combatants. Keep in mind that these are not shown until round 3.<br><br>The presentation options allow you to add or remove certain graphical features and information. Sometimes it can be smart to turn these off to increase performance, depending on what device you are viewing the battle from.<br><br>The 'Text on/Text Off'-button will hide or show the text-description of the combat. While the text can be useful when learning the game, and to see more details, it can also make the rendering of combat more 'sluggish'. If the combat is slow, or the text is simply 'in the way', try turning the text off.<br><br>The 'Full-Text'/'Per Turn'-button allows you to choose if you want to see the details of every shot in the battle, or if you just want to be shown a summary of damage dealt and sustained during the previous round. Selecting 'Per Turn' can greatly increase performance on some devices.<br><br>The 'Extra FX On'/'Extra FX Off'-button is on by default. If you feel the combat is rendering too slow on your device, you might have a lot to gain by clicking this button. <br>It will make missiles and certain explosions look a bit less fun, but it might make the rendering a lot faster and smoother. <br><br>If you want to share your battle with other players in the chat, simply click the 'Combat-link'-number, and it will be pasted into your chat entry field.<br><br>click 'Exit Battle' to leave the battle view."});

ad2460.helpButtons.push({dyn_id:"combat_metrics", subject:"The Battle Metrics",	parent_id:"battle_stats_field", extraClass:"",	left:"223px",     right:"",     top:"7px",     bottom:"", body:"The Metrics show you the hard values of the battle. In exact numbers, it will show you: <br>- How many fleets each side has.<br>- Capital ships remaining in battle.<br>- Total losses for each side. This includes minors ships(fighters and corvettes).<br><br>Red shows the numbers for the attacker, and green shows the numbers for the defender in the battle.<br><br>The Strength-gauge shows the total strength-value of the ships that are still engaged in the ongoing battle.<br><br>Relative losses measures how close one of the combatants are to the criteria of an unwinnable fight. The colour shown, is the side which is currently closest to fulfilling this retreat condition.<br><br>Fleet values show the resource cost for all the ships on each side of the battle. You will also get a number for the total remaining value on each side, once the battle has completed."});

//ad2460.helpButtons.push({dyn_id:"vacation_mode_full_text", subject:"Vacation-mode",	parent_id:"vacation_mode_options_help", extraClass:"",	left:"98px",     right:"",     top:"94px",     bottom:"", body:"- Once activated, it lasts for a minimum of 60 hours, and until you log back in or run out of credits<br>- Your account will still be charged 1 credit per day<br>- This will prevent any attack against your homeworld and outposts<br>- There will be no resource-generation on your homeworld or outposts<br>- You will not be charged for fleet-upkeep<br>- If used, it can not be used again for 24 days<br>- You may not enter vacation-mode if<br>-- any of your fleets are out<br>-- there are units in your production-queue<br>-- if you are under attack<br>-- if you have attacked anyone during the past 12 hours<br>-- while you have active Infiltration-missions<br>-- if you are an alliance-banker<br>-- you have less than 3 credits remaining<br>"});
ad2460.helpButtons.push({dyn_id:"vacation_mode_full_text", subject:"Vacation-mode",	parent_id:"vacation_mode_options_help", extraClass:"",	left:"196px",     right:"",     top:"0px",     bottom:"", body:"- Once activated, it lasts for 2 - 4 days. You can not log in for these first 2 days, but after that, vacation-mode will end upon login. The vacation mode will last maximum 4 days, and then your account is forced out of vacation-mode by the system.<br>- Your account will be charged 1 credit per day<br>- This will prevent any attack against your homeworld and outposts<br>- There will be no resource-generation on your homeworld or outposts<br>- You will not be charged for fleet-upkeep<br>- If used, it can not be used again for 24 days<br>- You may not enter vacation-mode if<br>-- any of your fleets are out<br>-- there are units in your production-queue<br>-- if you are under attack<br>-- if you have attacked anyone during the past 12 hours<br>-- while you have active Infiltration-missions<br>-- if you are an alliance-banker<br>-- you have less than 3 credits remaining<br>-- If we are close to the END of a Cycle"});

ad2460.helpButtons.push({dyn_id:"launch_helper", subject:"Launching attacks",	parent_id:"launchslide", extraClass:"",	left:"750px",     right:"",     top:"7px",     bottom:"", body:"This panel is where you attack other players, either to take over/raid one of their outposts or attack a homeworld to raid it for resources<br>The fleet list shows you the available fleets for your attack. By clicking on one, highlighting it in green, it will be part of the attack. You can unselect it by clicking it again. If you click the (i) at the end of the fleet row, you can see the ships that make up the fleet. The button below the fleet list will show you all the ships in the fleets you have currently selected.<br><br>You can only attack with the same amount of strength in one attack as your own strength rating in the game.<br>You can attack any other player (within the normal level 5 and 7 limitiations) in the game, but the experience points you gain from an attack will differ depending on your target. This is listed just above the 'Launch'-button. Make sure to look at this before hitting 'Launch'. It is possible to lose XP if you attack a player that is much weaker than yourself. Make sure you are willing to pay that price for such an attack.<br><br>The tactics given on this panel is only valid for the attack itself. Individual fleet tactics are not affected by changes you make here. The tactics of the highest ranking commander is always chosen, unless you change it before hitting 'Launch'. If the highest ranking commander in the attack changes, the tactics change to that of his or her fleet. You should make your tactical dispositions after you have selected your fleets."});

ad2460.helpButtons.push({dyn_id:"sector_help", subject:"Sector Control",	parent_id:"sector_station_info", extraClass:"sectorhelp",	left:"-23px",     right:"",     top:"48px",     bottom:"", body:"<img src='images/fixed/sector_icon.png' style='float:left;'><br>The short version: <br>- The Alliance that holds the Sector Station Controls the sector.<br>- Controlling the sector gives all members of your alliance a special bonus.<br><br><strong>The Long Version</strong><br>The sector is controlled by maintaining ownership over the local Ancient Station. Owning the station gives every member of the alliance a specific bonus. This is seen in the sector view. The bonus is divided among all the members of the alliance, so the bigger the alliance, the smaller the overall bonus.<br><br>Stations can only be claimed for the alliance by the alliance leader.<br><br>Regardsless of which player initiates the attack, the 'owner' of the station will be the alliance leader should an attack be successful and the attacking alliance gain control of it.<br><br>In the event that an alliance leader leaves the alliance, or steps down as leaders, the 'ownership' of the station will be transferred to the new leader. If the alliance is disbanded, the station will be abandoned and can be claimed by any other alliance leader."});
ad2460.helpButtons.push({dyn_id:"station_help", subject:"Sector Station Info",	parent_id:"cluster_station_info", extraClass:"sectorhelp",	left:"-5px",     right:"",     top:"57px",     bottom:"", body:"<img src='../images/fixed/station.jpg' class='helpimg'>The Short Version:<br>Holding this station secures sector control.<br>Holding it provides alliance-wide bonuses.<br><br>The Long Version:<br>The station needs to be defended in order to maintain ownership. Initially, the station will not have its own defenses, and members of the alliance must place fleets at the station in order to keep it secure.<br><br>Over time, the station will start producing its own defensive units, and the need for alliance ships to protect it will diminish.<br><br>The station is itself a combat unit, and will participate in any attacks made on it.<br><br>In order for another alliance to take over the station, an attack must be made, and the station muct be brought down to zero hull during the attack.<br><br>After a set number of rounds, the station wil initiate a special pushback-function, and essentially kick every enemy ship out of the combat. Once this happens, the attack is over.<br><br>The station then goes into a 4-hour grace, in which no attacks are possible. The station's hull will not regenerate during this period, and one the grace ends, it will be possible to attack it again to further reduce its hull."});

ad2460.helpButtons.push({dyn_id:"counter_intel_help", subject:"Counter Intelligence",	parent_id:"new_intel_buttons_container", extraClass:"",	left:"182px",     right:"",     top:"291px",     bottom:"", body:"You can use two counter-intelligence features in AD2460. The first one, the Spy Sweep, requires one of your spies to go undercover on your own homeworld to search for, identify and eliminate potential spies from other players. The infiltrator sweep works the same way, and will try to detect and eliminate other infiltrators operating on your homeworld.<br>These services are not free of charge.<br>Spy Sweep : 100.000 of each resource<br>Infiltrator-sweep : 200.000 of each resource<br><br>There is no guarantee of success here.<br><br>Spy-sweeps and Infiltrator-sweeps last for 8 hours when purchased.<br><br>"});

ad2460.helpButtons.push({dyn_id:"wargame_challenge_help", subject:"Wargame Challenge",	parent_id:"direct_challenge_shortcut_container", extraClass:"",	left:"",     right:"85px",     top:"0px",     bottom:"", body:"If you want to challenge another player to a battle, you can issue a wargame.<br><br>A wargame is a battle between two players involving a single fleet on each side. You can even challenge your own alliance-members. You select the fleet you would like to use to challenge your opponent, and issue the challenge. Note that the tactical settings for the fleet you are using is defined in the 'Fleet Management'-section.<br><br>You will be notified if you are challenged by other players, or if one of your challenges are accepted.<br><br>If you change the strength of your fleet for any reason, any challenges pending with that fleet are removed.<br><br>Issuing a challenge to another player costs 2 credits. (FREE for VIPs!)<br>The minimum fleet strength for a wargame is 5.000.<br>You can participate in up to 3 wargames per 24 hours.<br>Commanders get LEVEL*LEVEL*10 experience points for the fight, while players gain LEVEL*10 experience points from wargames.<br><br> Great for fun fights, testing tactical settings and fleet compositions.<br><br><span style='color: yellow; font-style: italic;'>Note that players involved in a wargame are considered 'in combat' and cannot be attacked while the wargame is running.</span><br><br>"});

ad2460.helpButtons.push({dyn_id:"wargame_starmap_help", subject:"Wargame Challenge",	parent_id:"starmap_challenge_container", extraClass:"",	left:"",     right:"5px",     top:"48px",     bottom:"", body:"If you want to challenge another player to a battle, you can issue a wargame.<br><br>A wargame is a battle between two players involving a single fleet on each side. You can even challenge your own alliance-members. You select the fleet you would like to use to challenge your opponent, and issue the challenge. Note that the tactical settings for the fleet you are using is defined in the 'Fleet Management'-section.<br><br>You will be notified if you are challenged by other players, or if one of your challenges are accepted.<br><br>If you change the strength of your fleet for any reason, any challenges pending with that fleet are removed.<br><br>Issuing a challenge to another player costs 2 credits. (Free for VIPs!)<br>The minimum fleet strength for a wargame is 5.000.<br>Great for fun fights, testing tactical settings and fleet compositions.<br>You can participate in up to 3 wargames per 24 hours.<br>Commanders do get some experience points for the fight, and players gain LEVEL*LEVEL*10 experience points from wargames.<br><br><span style='color: yellow; font-style: italic;'>Note that players involved in a wargame are considered 'in combat' and cannot be attacked while the wargame is running.</span><br><br>"});

ad2460.helpButtons.push({dyn_id:"bounty_hunting_help", subject:"Placing a Bounty on a Player",	parent_id:"issue_bounty", extraClass:"",	left:"",     right:"8px",     top:"28px",     bottom:"", body:"In order for you to place a bounty on another player, you simply have to offer a credit reward and the required strength you would like to have destroyed on the target.<br><br>Click 'Issue Bounty', and your most hated nemesis will be the target of someone else's rage. You can only claim the bounty if you are the attacker in a battle. You can only claim bounties in battles at homeworlds or outposts. Station battles do not award bounties.<br><br><br><br><span style='color: yellow; font-style: italic;'>If alliance fleets are used in the collection of bounty, the credit reward is split among the participating players. Rounding numbers favours the player launching the attack.</span><br><br>Be advised that bounties cannot be cancelled, and you cannot claim the bounty yourself.<br><br>You can set a maximium of 20 credits for a single bounty<br><br>If you want to search for targets to claim the bounty for, this can be done under 'Target Search' in the 'Military'-section.<br><br>In addition to the credit-bounty you offer, there is a service charge of 2 credits for issuing the bounty."});
ad2460.helpButtons.push({dyn_id:"prospecting_help", subject:"Prospecting Clusters",	parent_id:"starmap_blue_container", extraClass:"",	left:"178px",     right:"",     top:"62px",     bottom:"", body:"<img src='images/planets/notification/notify_prospecting.jpg' style='float:left; margin: 0px 10px 10px 0px;' />A cluster contains 16 solar systems. By sending a prospecting ship to prospect a cluster, you will be informed of the potential output of all the resource planets for that entire cluster.<br><br>The measuring probe that your prospector places on these planets will also keep your information about all these planets up to date, since the potential of a planet can change over time.<br><br>To prospect a cluster, simply click on the 'Prospect Now'-button, and a prospecting ship(if available) will be sent out to place the probes on the planets. The prospecting ship is lost in the process, so you will need to produce more of them to prospect more clusters.<br><br>Once the prospecting is done, you can access the data by clicking on the 'Prospect List'-button. This will then give you a list of the best planets within each cluster.<br><br>If you are in sector-view, you can access a compiled list of all the cluster reports within the sector, and get a list of the best planets for that entire sector based on the available reports from the clusters within.<br><br>"});
/* Mission Help*/
ad2460.helpButtons.push({dyn_id:"missions_help", subject:"Ad2460 Missions",	parent_id:"pl_mis_cont", extraClass:"missionshelp",	left:"316px",     right:"",     top:"79px",     bottom:"", body:"Missions in AD2460 is a great way to get into combats, take part in the story of the galaxy, gain experience points, and gain resources and other rewards.<br><br>The list of the available mission-packs each contain a set of missions that make up a story. Clicking on a mission-pack will give you the list of the missions within it, and let you read more about story of the pack.<br><br><img src='images/icons/mission/mission_pack.png' style='float: left; vertical-align:middle;'> This is a mission pack with available missions.<br><br><img src='images/icons/mission/mission_pack_locked.png' style='float: left; vertical-align:middle;'>This is a mission pack with available missions.<br><br><img src='images/icons/mission/mission_pack_completed.png' style='float: left; vertical-align:middle;'> This is a mission pack with all missions completed.<br><br>Once you select a mission-pack, there will be a list of missions within the pack. You can navigate back to the packs again by clicking 'Return to story selection' at the bottom of the list. Click on a mission to read the description and see teh requirements for the mission.<br><br>There are some icons that are frequently used in the missions list:<br><br><img src='images/icons/mission/mission_completed.png' style='float: left; vertical-align:middle;'>This shows that the mission has been completed successfully.<br><br><img src='images/icons/mission/mission_failed.png' style='float: left; vertical-align:middle;'>This shows that the mission has failed. You can try again.<br><br><img src='images/icons/mission/mission_locked.png' style='float: left; vertical-align:middle;'>This mission is not unlocked yet.<br><br><img src='images/icons/mission/mission_chained.png' style='float: left; vertical-align:middle;'>This shows that the mission is dependent on a preceding mission being completed successfully.<br><br><img src='images/icons/mission/mission_repeatable.png' style='float: left; vertical-align:middle;'>This shows that the mission can be done more than once.<br><br><br>There are 5 types of missions: Scout, Recon, Espionage, Diplomatic and Combat.<br><br><img src='images/fixed/scout_icon.png' style='float: left; '>Scout and recon missions are very similar. A scout mission requires you to have scout ships available. A recon mission uses prospecting ships. You can over-allocate ships in the mission to increase your chances of a successful result. For both these mission-types, the unit used in the mission is lost, regardless of the outcome.<br><br><img src='images/fixed/espionage_icon.png' style='float: left; '>Espionage missions require either spies or infiltrators to be available when initiating the mission. Spies and infiltrators are never lost, but you cannot allocate the ones used in a mission for anything else while the mission is ongoing. It is also possible to allocate more than the required amount in order to increase the chances of a successful mission.<br><br><img src='images/fixed/diplomatic_icon.png' style='float: left;'>The diplomatic mission requires you to allocate one of your commanders. Sometimes there is a minimum rank required for your commander to participate. Once the mission is selected, you will be able to choose from the commanders that are available and fulfill the criteria for the mission. Commanders who are actively in charge of a fleet cannot be used for missions.<br><br><img src='images/fixed/attack_icon.png' style='float: left; '>Combat missions require an actual fleet to be used. Any ships brought into a mission combat can be destroyed and lost. Most missions have certain requirements for the fleet that have to be met in order to initiate it. Read the description and the requirements to make the best possible choices when setting up the fleet and tactics.<br><br>"});

ad2460.helpButtons.push({dyn_id:"move_new_ships_to_help", subject:"Move new ships to...",	parent_id:"move_new_ships_to_description", extraClass:"",	left:"370px",     right:"",     top:"0px",     bottom:"", body:"The system will try to follow your setting as much as it can. If you select Largest fleet, and the largest fleet doesn't have room for the new ship, it will go to the second largest fleet, and so on.<br><br>When selecting either Largest Fleet or Smallest Fleet, it will check all other fleets before it will select the Base Fleet.<br><br>The Base Fleet is always the fallback option in case no other fleet is available, no other fleet can fit the strength, or no other fleet has the required hangar-space.<br>"});

ad2460.helpButtons.push({dyn_id:"auto_resize_gui_help", subject:"Auto-resize GUI",	parent_id:"auto_resize_gui_container", extraClass:"",	left:"370px",     right:"",     top:"0px",     bottom:"", body:"Experimental! Be careful with this one. This feature will not work on mobile deveices or in FireFox browsers. But if you use Chrome or IE it might work perfectly by scaling the game to your browser-window. Give it a try if you dare!"});
ad2460.helpButtons.push({dyn_id:"donate_credits_help", subject:"Donate credits",	parent_id:"donate_credits_container", extraClass:"",	left:"330px",     right:"",     top:"0px",     bottom:"", body:"To donate credits, you must have purchased credits recently.<br>You must have 15 or more credits remaining after the donation.<br>The donation service charge is 1 credit, +10% rounded down.<br>A donation of 20 credits to a player will charge you 23 credits. 20 + 1 + 2 (10% of 20 rounded down). <br>Donating 35 credits to someone will charge you 35 + 1 + 3 (10% of 35 rounded down)"});

ad2460.helpButtons.push({dyn_id:"vip_pack_helper", subject:"V.I.P Package",	parent_id:"vip_pack_option", extraClass:"",	left:"370px",     right:"",     top:"8px",     bottom:"", body:"The V.I.P. pack is a simple solution for anyone who wishes to add a little extra to their AD2460 experience. The offer is very simple. This is what you get in the 30 days you are V.I.P.: <br>- All renaming is free.<br>- All commander customisation is free.<br>- All wargames are free to issue.<br>- Custom icon shown in chat, player info and forums.<br>- Choose your own chat name colour.<br>- Homeworld planet visual selection is free.<br>- Convenient AUTO-buttons when respeccing techpoints.<br>- 20% reduced base-production-time on all units<br><br>The VIP pack costs 50 credits. The V.I.P. period lasts 30 days from the time of purchase. Once the V.I.P. period is over, you are reverted to normal. You can then choose to upgrade back to V.I.P. again whenever you want.<br><br>Resetting the tech points, donating credits to other players and issuing bounties still carry the normal credit charge."});
ad2460.helpButtons.push({dyn_id:"vip_pack_helper", subject:"V.I.P Package",	parent_id:"vip_pack_option_2", extraClass:"",	left:"370px",     right:"",     top:"8px",     bottom:"", body:"The V.I.P. pack is a simple solution for anyone who wishes to add a little extra to their AD2460 experience. The offer is very simple. This is what you get in the 30 days you are V.I.P.: <br>- All renaming is free.<br>- All commander customisation is free.<br>- All wargames are free to issue.<br>- Custom icon shown in chat, player info and forums.<br>- Choose your own chat name colour.<br>- Homeworld planet visual selection is free.<br>- Convenient AUTO-buttons when respeccing techpoints.<br>- 20% reduced base-production-time on all units<br><br>The VIP pack costs 50 credits. The V.I.P. period lasts 30 days from the time of purchase. Once the V.I.P. period is over, you are reverted to normal. You can then choose to upgrade back to V.I.P. again whenever you want.<br><br>Resetting the tech points, donating credits to other players and issuing bounties still carry the normal credit charge."});

ad2460.helpButtons.push({dyn_id:"chat_input_field_helper", subject:"Chat Help",	parent_id:"chat_input", extraClass:"",	left:"840px",     right:"",     top:"3px",     bottom:"", body:"This chat supports /me emotes. You can also type things like (smile) (wink) (cry) (omg) and some others.<br><br><b>Commonly used abbreviations:</b><br><table><tr><td>S2S</td><td>Ship To Ship, a tactical setting for your fighters</td></tr><tr><td>HW</td><td>Homeworld</td></tr><tr><td>OP / ops</td><td>Outpost / Outposts</td></tr><tr><td>FI / FIs</td><td>Fighter(s)</td></tr><tr><td>CO / COs</td><td>Corvette(s)</td></tr><tr><td>FR /FRs</td><td>Frigate(s)</td></tr><tr><td>CR /CRSRS</td><td>Cruiser(s)</td></tr><tr><td>BS</td><td>Battleships(s)</td></tr><tr><td>PDS</td><td>Defensive units</td></tr><tr><td>PDS + Nasty word</td><td>Someone who only builds PDS</td></tr><tr><td>GWs</td><td>Gravity Wells, a NeoTech special ship</td></tr><tr><td>FP</td><td>Firepower (damage-output)</td></tr><tr><td>ETA</td><td>Estimated Time of Arrival</td></tr><tr><td>XP</td><td>Experience points, used to gain Levels</td></tr><tr><td>LVL</td><td>Advancement Level</td></tr><tr><td>TS</td><td>Transport-ships</td></tr><tr><td>LT</td><td>Large Transports</td></tr><tr><td>AF</td><td>Alliance fleet</td></tr><tr><td>DEVS</td><td>Developers, those who make this game</td></tr></table>"});



function addHelpButton(button){
	try{
		var parent=document.getElementById(button.parent_id);
		if (parent){
			var newContainer=createSingleElement('div', 'localhelp '+button.extraClass, '', '', "showLocalHelpTopic('"+button.subject+"')");
			var img=createSingleElement('img', '', '', 'images/icons/buttons/whatsthis.png', '');
			if (button.top!=''){
				newContainer.style.top=button.top;
			}
			if (button.left!=''){
				newContainer.style.left=button.left;
			}
			if (button.bottom!=''){
				newContainer.style.bottom=button.bottom;
			}
			if (button.right!=''){
				newContainer.style.right=button.right;
			}
			if (button.zIndex!=''){
				newContainer.style.zIndex=button.zIndex;
			}

			newContainer.appendChild(img);
			parent.appendChild(newContainer);
		}
	}
	catch(err){
		//console.log(err);
	}
}

function addHelpButtons(){
	var i=0;
	for (i=0;i<ad2460.helpButtons.length ;i++ ){
		addHelpButton(ad2460.helpButtons[i]);
	}
}

function addDynamicHelpButtons(id){
	for (i=0;i<ad2460.helpButtons.length ;i++ ){
		if (ad2460.helpButtons[i].dyn_id==id){
			addHelpButton(ad2460.helpButtons[i]);
		}
	}
}

var denyLadyHelp=true;

 $(window).load(function () {
	addHelpButtons();
	initLadyHelperInterval();
	setTimeout(function(){
		denyLadyHelp=false;
		// console.log("Allowing lady in timeout after 15...");
		ladyHelperMain();
	},15000);
});

var incompleteGetStartedItems=0;
var getStartedList=new Array;
/*
getStartedList.push({id:1, in_progress:false, completed:false, name:"Build the Hassium Refinery facility-addon",	description:"<img src='images/tut/facilities.jpg' style='float: right; height: 94px; padding-left: 10px;'>In AD2460, you will need resources to build ships, to enhance your infrastructure, to perform research and perform many other actions. The general purpose resource which you will need most in the beginning is called Hassium. The first thing you should do is to open the white panel named 'Facilities'. All panels like this are clickable, and will open up to reveal more content and possible actions.<br><br>You can click on the 'Start Here' button to hide this helper. You can easily reference back and forth if you need to.<br><br><img src='images/tut/refinery.png' style='float: right; padding-left: 10px;'>Once the panel is open, click on the 'Refinery'-image in the lower left section of the panel. The lower right section will now show the facility and its addon-facilities. You can click on any addon facility to upgrade it or to view its bonuses. This goes for all facilities with addons.<br>Select the 'Hassium Refinery' by clicking on it. The lights on the selected facility will light up.<br><br>In the top right section of the panel, the price for the upgrade will be visible, with a 'Build'-button in the middle. These costs correspond to the different types of resources you have (shown at the very top of the screen). You probably have enough resources to start this upgrade, so click the upgrade and it will start. <br><br>If you notice at the right side of your interface, the facility-upgrade will display a timer there, that you can keep track of wherever you are in the game.<br><br>If you want help to get to the facilities panel and select the facility, (FACITEM:370:click here) and it will open for you."});
getStartedList.push({id:2, in_progress:false, completed:false, name:"Research Improved Gunnery",					description:"<img src='images/tut/research.jpg' style='float: right; height: 94px; padding-left: 10px;'>You will be spending a fair amount of time in this game either preparing for, or participating in a combat, either in Single Player Missions, or against other players. It is always a good idea to make sure your fleet is strong. One way of improving your ships is through research. In order to start a new research you need to open the research panel. Click on it and the panel opens. In the lower left section of the panel, there is a list of available researches. The first one on the list is the 'Improved Gunnery', and we just blinked it for you so you can easily spot it. Click on this item now to select it.<br><br><img src='images/tut/gunnery.png' style='float: left; padding-right: 10px;'>(RESITEM:101:Click here to open the panel directly). Your selected research will now be shown in the top right section of the panel. Here you can see the bonuses it provides, and initiate the research. Click 'Order' to start the research. Once again you can see a new timer all the way to the right on your screen, showing you how much time it will take to complete.<br><br>If you re-open the Research-panel, notice that you can scroll the list of researches (and other lists in other panels) by clicking the arrows beside the list. These light up in the direction there is more to show."});
getStartedList.push({id:3, in_progress:false, completed:false, name:"Develop Basic Outpost",						description:"<img src='images/tut/development.jpg' style='float: right; height: 94px; padding-left: 10px;'>To build new, other and better units, their blueprints must be developed. Open your 'Development' panel by clicking on it. Find the 'Basic Outpost' in the 'Available Projects' list at the bottom left section, and click it.<br><br><img src='images/tut/outpost.png' style='float: right; padding-left: 10px;'><br>Top right section now shows you the selected development. You can now click on 'Order' to start the development of the outpost.<br><br>As before, the timer for this is shown on the right.<br><br>If you wonder what this 'outpost-thing' is, it is a orbital mining-station that you can send out to available planets to start mining-operations to enhance your economy. They come in 3 different sizes, but can be improved later by leveling them up. Outposts are absolutely vital in this game, as you will need the resources they generate."});
getStartedList.push({id:4, in_progress:false, completed:false, name:"Produce Prospector",							description:"<img src='images/tut/production.jpg' style='float: right; height: 94px; padding-left: 10px;'>Prospecting-ships are used to 'map' an area of space called 'a cluster'. The Prospecting-ship will take a little time to analyze the planets in the cluster, and provide you with a list of the most suitable planets to convert to Outposts. So let's get one of those Prospecting-ships.  Click on your 'Production'-panel. This is where you actually build things. You will be using this panel a lot. (PRODITEM:431:Click here) to open the Production panel directly.<br>The panel works the same as research and development, but there are a couple of different things you should notice on this panel.<br><img src='images/tut/prod_info.png' style='float: right; padding-left: 10px;'>Once you select an item for production, it will be shown in the top right section.<strong>You can click on the image here to reveal more information about the thing you want to build.</strong> Try this. Click on the panel that slides in again to close it.<br><img src='images/tut/build_info_red.png' style='padding-left: 3px; padding-right: 3px; float:right;'>There is a small icon on far right of strip with the name of the item you have selected. This icon is red if you are missing a facility, research, development or tech point in order to produce it. If you click on the icon, you will get a view of which parts you need to improve in order to produce the item. If you click on the boxes with red labels, you will see what is needed to complete that particular part again, and you can move backwards until you find something that is all green and start building that if you want to.<br><img src='images/tut/prospector.png' style='float: left; padding-right: 10px;'>But for now, all you have to do is select the 'Prospector' and order one.<br><br>This will be added to a list in the bottom right section of the panel. You can queue more than one item under 'Production'. Initially you can have a list of 8 items. The timer for the top item is also always shown on the right of your screen for easy reference."});
getStartedList.push({id:5, in_progress:false, completed:false, name:"Prospect your home-cluster",					description:"Once the prospecting ship is complete, you can put it to use. Outposts, Prospecting ships and Scouts are not part of your normal military ships and are used differently. The prospecting ship is used from within the starmap. Click on the 'Starmap'-button in the main menu of your interface (top left section). This will show the starmap and its related information.<img onclick='zoomToHomeworld(); event.stopPropagation();' src='images/tut/home.jpg' style='padding-left: 3px; padding-right: 3px; float:right;'><br>The <b>STARMAP</b> has 5 zoom-levels, from the entire galaxy, a single quadrant (Q), a single sector (S), a cluster (C), and all the way in to a single solar system.<br>There is a lot of navigation to be done here, but all you need to do right now is to click the button labelled 'Home'. This will bring you directly to your own solar system and select your homeworld, the one planet you start this game with.<br><br><img src='images/tut/prospect_new.png' style='float: left; padding-right: 10px;'>Right at the bottom left of the map you should see a 'Prospect Now' button. Click it and your prospector will be off to check every planet in the cluster for resources and potential of the planets. We will return to this later in this guide."});
getStartedList.push({id:6, in_progress:false, completed:false, name:"Produce your first outpost",					description:"<img src='images/tut/prod_outpost.png' style='float: right; padding-left: 10px;'>Assuming you have completed your development of the 'Basic Outpost', we should be able to actually build one. Click 'Homeworld' in the main menu, and then open your 'Production'-panel and select the 'Outpost Lvl 1' from the list. You may have to scroll the list down to see it. Once you have selected it, click on 'Order' (in the top right panel) to start producting one. This will take some time, so just continue the start helper. We will get back to placing your outpost once it has completed.<br><br>If you need help finding it, (PRODITEM:438:Click here) to go directly to the item."});
getStartedList.push({id:7, in_progress:false, completed:false, name:"Develop Scout Ship Design",					description:"<img src='images/tut/scout_design.png' style='float: right;padding-left: 10px;'>Scout-ships are small unmanned vessels, like a probe, that can be launched towards a planet. There, it will attempt to transmit its finding back to you, before self-destructing. You will use these ships both in Missions, and against other players. They CAN be detected though, and the target may be able to tell where the scout came from! We will need one for a mission this time, so lets develop the blueprints for the Scout. Open your 'Development'-panel. The scout ship design should be on your list. Select this and click 'Order'. <br><br>This will take a few minutes. Once it is done, go to the next step."});
getStartedList.push({id:14, in_progress:false, completed:false, name:"Promote A Commander",						description:"Go to your military section. Click on 'Military' in the top-left menu. Open the 'Commanders'-panel by clicking on it. Once it is open, click on the 'View Academy Recruits' at the bottom of the commanders list. This will show you the commanders that are available to recruit.<br><br>Select one of the available recruits (don't worry about the stats yet, you will deal with those later), and click on 'Activate' below the main protrait of the commander.<br>You now have a commander ready to assign to a fleet.<br><br>If you like, you can rename the commander by clicking on the name in the top right section of the panel and type in your own."});
getStartedList.push({id:15, in_progress:false, completed:false, name:"Create a Mobile Fleet",						description:"In this game, you will need to create fleets both to defend yourself and also to attack others. You already have 1 fleet, but this is your 'Base-fleet' which is always located at your homeworld. A fleet is a container for ships. Click on 'Military' in the main menu. Open the 'Fleet Management'-panel by clicking on it. At the bottom left of the panel, find the button labelled 'Create New Fleet' and click it. This will create a fleet and assign an available commander. If you have no available commanders, you can not create new fleets.<br><br>If you wish to change the commander in change of the fleet, you can reassign commanders as you like later.<br><br>You can give the fleet a name the same way as for the commander. Click on the name of the fleet at the top right, and type in a new name."});

getStartedList.push({id:16, in_progress:false, completed:false, name:"Move Ships Into the New Fleet",				description:"In the 'Fleet Management'-panel in the 'Military'-section, select your base fleet by clicking on it in the list.<br><br>Ships are always moved FROM the selected fleet, and into a new fleet.<br><br>With your base fleet selected, click on 'Move Ships' in the top right part of the panel. This will bring up a new panel from the bottom, showing the ships you have available in the base fleet.<br><br>Click on the ship type you want to move (in this case most likely a Light Frigate). Then select from the 'Into Fleet'-dropdown the new fleet which you want the Light Frigates to be moved into, and select all the ships by clicking on them.<br><br>Click on 'Add Move-order' at the bottom to create a reassignment. The reassignment will then be added to the list on the right. You can do more than one ship move before you press 'Complete All Move-orders, but for now, just click this button, and the Light Frigates will be moved to your mobile fleet.<br><br>You now have a fleet ready to perform a mission. You might also notice that the new fleet now shows with several hundred 'STR' or 'Strength'. This is a relative indication of how strong your fleet is. The more ships, or the bigger the ships, the higher the stength." });
getStartedList.push({id:17, in_progress:false, completed:false, name:"First Combat: Border Patrol",				description:"As mentioned before, Missions in AD2460 are single player storylines. Now you will try your first combat-mission. Combats are your greatest source of valuable experience-points that you need to advance in this game. The more ships you kill, the more XP you gain. In order to do this mission, you should have completed the previous steps and have a mobile fleet ready for the mission.<br><br>Open the missions-slide by clicking on 'Missions' in the top left main menu.<br><br>You now have a list of mission-packs available. Each mission pack contains a set of missions. Usually these tell a story about your home-planet, or about the game-universe. Once you select a mission-pack, you will be shown a list of missions for the pack, and you can see which missions are available to you at this time.<br><br>Click on the pack called 'Encroachment'.<br>Once you see the list of missions, click on the mission called 'Border Patrol'. A description of the mission and the story behind it will be available to read. You should read the descriptions for most missions, as they give you valuable information about how to solve the mission effectively.<br><br>Once you are ready to start the mission, click the button labelled 'Prepare'.<br><br>The mission preparation screen should now be visible, and you can select your mobile fleet to perform the mission for you. Once you select this, you will be ready to start the mission. You don't need to change the tactics, but may do so if you wish.<br><br>Click on the 'Initiate'-button to start your first combat.<br><br>There will be a lot of information available within the combat viewer. Do not worry about this at this time, it will become more familiar and useful to you later on."});
getStartedList.push({id:8, in_progress:false, completed:false, name:"Produce a scout",                            description:"<img src='images/tut/scout_prod.png' style='float: right;padding-left: 10px;'>Once the design for the scout ship is complete, you can produce it. Open your 'Production'-panel again and you will see that the scout ship has now been added to the list of items you can produce. Select it and order one. If you need help (PRODITEM:430:Click here).<br> If you have been quick it will be queued after your Outpost. It will take a little time to complete."});
getStartedList.push({id:9, in_progress:false, completed:false, name:"Complete the mission The Missing Frigate",   description:"'Missions' is the 'single-player' part of AD2460. In the beginning, they will be easy, but soon enough they will provide you with ample challenge. Missions can provide you with experience-points (XP), resources and even new units as rewards. Some missions can be done multiple times, while others can only be completed once.<br> Click 'Missions' in the main menu (top left). This will open the missions-panel. It will show you the mission-packs in the game, also known as 'storylines'. Missions will help you get to grips with some of the functions in AD2460, and help prepare you for greater battles. They also give you valuable experience points that will allow you to gain levels, which again will allow you to own more outposts and retain more commanders. This will be important later.<br><br>In the list of 'Available Missionpacks', click on 'First Steps'. The list now changes to contain all the individual missions within the mission pack.<br>Select the first mission, 'The Missing Frigate'. The description and story of the mission will now be displayed. To get into the story of the mission pack, you should read this.<br><br>Now, click on 'Prepare'. This will slide in the mission preparation slide. Here you set up how you want to handle a mission. This one is pretty straightforward. You need to allocate your scout ship to the mission by clicking on the '+' button. More than one scout can be required sometimes, so make sure you notice what the requirements of the mission are. This is displayed on the top right. Using more scouts than required will increase chances of success. For now, one will do.<br><br>You then select how you want to handle the mission by selecting one of the options below the scout allocation. This one is up to you. There are no wrong choices right now.<br><br>Once you have done this, click 'Initiate' and the mission will commence. <br><br>Note: Scout ships and prospecting ships are single-use and are lost whenever you use them."});
getStartedList.push({id:10, in_progress:false, completed:false, name:"Claim your first outpost",                   description:"It is time to boost our economy! Once you have produced your basic outpost, you are now ready to place it in orbit around a resource planet. You have already done the preparation for this by prospecting your local cluster. If this has not completed yet, you will need to wait for this.<br><br>To find a suitable planet, go to your own solar system. You can either do this via the starmap and the 'Home'-button, or you can click on the coordinates of your homeworld directly from the 'Homeworld'-section, just below your homeworld planet name.<br><br>Once you are there, click on the other planets of your system, and notice the Output Potential, and the Resource Tilt values. These are shown at the very bottom of the information about the planet filling the right side of your view. You want to get a planet that has an 'Even' resource tilt, and you will want to get a high potential planet. 10/10 is the best.<br><br><img src='images/tut/clusterbutton.jpg' style='padding-left: 10px; float:right;'>If you cannot find a good one in your own system, click on 'Cluster', and try one of the neighbouring systems. Click on one of the 16 systems in your cluster to zoom into it.<br><br><img src='images/tut/claim_op.png' style='padding-right: 10px; float:left;'>Once you have found a reasonably good planet, notice the 'Claim Planet'-tab just across the image of the planet in the right hand view. Click on this. You only have a basic outpost, this will be denoted (1). If you have more than one, or other types, their number will be shown as well.<br><br><img src='images/tut/claim_outpost_op.png' style='padding-left: 10px; float:right;'>In order to move your outpost to this planet and claim it, all you have to do is click the 'Basic Outpost'-line. <br><br>Congratulations, you now have your first outpost."});
getStartedList.push({id:11, in_progress:false, completed:false, name:"Develop Small Transport Design",            description:"<img src='images/tut/small_trans.png' style='padding-left: 10px; float:right;'>Now that you have an outpost, your income has increased. Another way to gain resources is by stealing from others. To do this, you will need to bring transports into combat. Go to your 'Development'-panel, and start developing the 'Small Transport Design'.<br><br>Once this is complete, you can start producing transport ships.<br><br>To go directly to the development design, (DEVITEM:239:Click here)."});
getStartedList.push({id:12, in_progress:false, completed:false, name:"Build the Intelligence Branch facility-addon", description:"Now that you have successfully completed your first mission, you will be eager to know what happens next and to get more experience, resources and other rewards.<br><br><img src='images/tut/dip_office.png' style='float: right;padding-left: 10px;'>In order to do the second mission, you will need to upgrade another one of your facility-addons. This time you need to upgrade your 'Intelligence Branch' This will give you a spy to use for the mission. Open your 'Facilities'-panel (Click 'Homeworld' in the main menu first) and select the 'Diplomatic Office'-facility. The top left addon here is the 'Intelligence Branch'. Select it and start upgrading it.<br><br>If you have trouble finding it, (FACITEM:349:click here) to go there directly. Once this is done, you can start doing the next part of the mission-pack.<br><br>Spies also allow you to gather information about other players in the game. This is done via the small action-menu you saw when a planet is selected in the solar system view."});
getStartedList.push({id:13, in_progress:false, completed:false, name:"Complete the mission The Retrieval",        description:"Once you have completed upgrading the 'Intelligence Branch' you can initiate and complete the mission named 'The Retrieval'.<br><br> Good luck."});

function updateGetStartedList(first){
	if (ad2460.scores.level>=4){
		hideGetStartedButton();
		return;
	}

	incompleteGetStartedItems=0;
	var i=0;
	for (i=0;i<getStartedList.length ;i++ ){
		var item=getStartedList[i];
		if (item.completed==false){
			// check it for completion
			if (item.id==1){
				var a=returnGameObjectById(370);
				if (a.user_id==ad2460.user_id && a.upgrading==0){
					item.completed=true;
				}
				if (a.user_id==ad2460.user_id && a.upgrading==1){
					item.in_progress=true;
				}

			}
			if (item.id==2){
				var a=returnGameObjectById(101);
				if (a.user_id==ad2460.user_id && a.upgrading==0){
					item.completed=true;
				}
				if (a.user_id==ad2460.user_id && a.upgrading==1){
					item.in_progress=true;
				}

			}
			if (item.id==3){
				var a=returnGameObjectById(232);
				if (a.user_id==ad2460.user_id && a.upgrading==0){
					item.completed=true;
				}
				if (a.user_id==ad2460.user_id && a.upgrading==1){
					item.in_progress=true;
				}

			}
			if (item.id==4){
				if (ad2460.prospectedClusters.length>0){
					item.completed=true;
				}
				var storageFleet=returnStorageFleet();
				if (storageFleet!=false){
					if (storageFleet.storage[11].counter>0){
						item.completed=true;
					}
					// Should work!
				}

				if (ad2460.prospectingMissions.length>0){
					item.completed=true;
				}
				// Check the queue for one to find the in_progress
				for (var p=0;p<ad2460.productionqueue.length ;p++ ){
					if (ad2460.productionqueue[p].id==431){
						item.in_progress=true;
					}
				}
			}
			if (item.id==5){
				if (ad2460.prospectedClusters.length>0){
					item.completed=true;
				}
				if (ad2460.prospectingMissions.length>0){
					item.in_progress=true;
				}
			}
			if (item.id==6){
				// Produce your first outpost..Check both storage and outposts ofc
				if (ad2460.outposts.length>0){
					item.completed=true;
				}
				var t=0;
				for (t=0;t<ad2460.homeworld.orbit.length ;t++ ){
					if (ad2460.homeworld.orbit[t].id==438 || ad2460.homeworld.orbit[t].id==439 || ad2460.homeworld.orbit[t].id==440){
						if (ad2460.homeworld.orbit[t].count>0){
							item.completed=true;
						}

					}
				}
				// Check the queue for one to find the in_progress
				for (var p=0;p<ad2460.productionqueue.length ;p++ ){
					if (ad2460.productionqueue[p].id==438 || ad2460.productionqueue[p].id==439 || ad2460.productionqueue[p].id==440 ){
						item.in_progress=true;
					}
				}

			}
			if (item.id==7)	{
				var a=returnGameObjectById(238);
				if (a.user_id==ad2460.user_id && a.upgrading==0){
					item.completed=true;
				}
				if (a.user_id==ad2460.user_id && a.upgrading==1){
					item.in_progress=true;
				}
			}
			if (item.id==8)	{
				// produce a scout
				// check for storage and scout-reports
				var storageFleet=returnStorageFleet();
				if (storageFleet!=false){
					if (storageFleet.storage[10].counter>0){
						item.completed=true;
					}
				}
				var t=0;
				for (t=0;t<ad2460.intel.missions ;t++ ){
					if (ad2460.intel.missions[t].type=='scout'){
						item.completed=true;
					}
				}
				for (t=0;t<ad2460.intel.reports ;t++ ){
					if (ad2460.intel.reports[t].type=='scout-report' && ad2460.intel.reports[t].user_id==ad2460.user_id){
						item.completed=true;
					}
				}
				var m=returnMissionByMissionId(1);
				if (m!=false){
					if (m.completed_counter>0){
						item.completed=true;
					}
				}

				// Check the queue for one to find the in_progress
				for (var p=0;p<ad2460.productionqueue.length ;p++ ){
					if (ad2460.productionqueue[p].id==430){
						item.in_progress=true;
					}
				}

			}
			if (item.id==9){
				// completed the mission missing frig
				var m=returnMissionByMissionId(1);
				if (m!=false){
					if (m.completed_counter>0){
						item.completed=true;
					}
				}
				if (ad2460.missionVars.active_mission_id==1){
					item.in_progress=true;
				}
			}
			if (item.id==10){
				// claim your first outpost
				if (ad2460.outposts.length>0){
					item.completed=true;
				}
			}
			if (item.id==11){
				// Develop Small Transport Design
				var a=returnGameObjectById(239);
				if (a.user_id==ad2460.user_id && a.upgrading==0){
					item.completed=true;
				}
				if (a.user_id==ad2460.user_id && a.upgrading==1){
					item.in_progress=true;
				}
			}
			if (item.id==12){
				// Build the Intelligence Branch facility-addon
				var a=returnGameObjectById(349);
				if (a.user_id==ad2460.user_id && a.upgrading==0){
					item.completed=true;
				}
				if (a.user_id==ad2460.user_id && a.upgrading==1){
					item.in_progress=true;
				}
			}
			if (item.id==13){
				// completed the mission missing frig
				var m=returnMissionByMissionId(9);
				if (m!=false){
					if (m.completed_counter>0){
						item.completed=true;
					}
				}
				if (ad2460.missionVars.active_mission_id==9){
					item.in_progress=true;
				}
			}
			if (item.id==14){
				// have you promoted a commander? Check the techpoint thingie :)
				var n=0;
				for (n=0;n<ad2460.techpointsList.length ;n++ ){
					if (ad2460.techpointsList[n].type=='academy_use' && ad2460.techpointsList[n].timestamp>0){
						item.completed=true;
					}
				}
			}

			if (item.id==15){
				//getStartedList.push({id:15, completed:false, name:"Create a Mobile Fleet",
				var n=0;
				for (n=0;n<ad2460.myFleets.length ;n++ ){
					if (ad2460.myFleets[n].homeworld_fleet==0 && ad2460.myFleets[n].storage_fleet==0){
						item.completed=true;
					}
				}
			}
			if (item.id==16){
				//getStartedList.push({id:16, completed:false, name:"Move Ships Into the New Fleet",
				for (n=0;n<ad2460.myFleets.length ;n++ ){
					if (ad2460.myFleets[n].homeworld_fleet==0 && ad2460.myFleets[n].storage_fleet==0 && ad2460.myFleets[n].strength>0){
						item.completed=true;
					}
				}
			}

			if (item.id==17){
				//getStartedList.push({id:18, completed:false, name:"First Combat: Border Patrol",
				var m=returnMissionByMissionId(64);
				if (m!=false){
					if (m.completed_counter>0){
						item.completed=true;
					}
				}
				if (ad2460.missionVars.active_mission_id==64){
					item.in_progress=true;
				}

			}
		}
		if (item.completed==false){
			// and if it still not complete, increase counter
			incompleteGetStartedItems++;
		}
	}

	if (incompleteGetStartedItems>0){
		if (first==true){
			showGetStartedButton();
		}
	}
	else {
		hideGetStartedButton();
	}
	if (first==true){
		renderGetStartedList();
	}
	else {
		reRenderGetStartedList();
	}


}

function showGetStartedButton(){
	$("#checklist_initiate").show();

}

function hideGetStartedButton(){
	$("#checklist_initiate").hide();
	$("#helper_checklist").hide();
	checklistOpen=0;
	try{
		clearInterval(helperTimeout);
	}
	catch(err){
		// nah
	}

}

function renderGetStartedList(){
	if (ad2460.scores.level>=4){
		hideGetStartedButton();
		return;
	}

	var c=document.getElementById('helper_container');
	removeChildNodes('helper_container');
	var i=0;
	for (i=0;i<getStartedList.length ;i++ ){

		var item=getStartedList[i];
		var outer=createSingleElement('div', 'helper_entry', 'helper_'+i, '', 'helperItemClick(this.id)');
		var oneline=createSingleElement('div', 'helper_one_line', '', '', '');
		var text1=createSingleElement('span', '', '', item.name, '');
		var completeText=createSingleElement('div', 'helper_entry_completed', '','Completed' , '');
		completeText.style.display='none';
		var imgSrc="images/icons/helper_check_no.png";
		if (item.completed==true){
			imgSrc="images/icons/helper_check_yes.png";
		}
		var img=createSingleElement('img', 'helper_icon', 'helper_image_'+i, imgSrc, '');
		var text2=createSingleElement('div', 'helper_full_info', 'helper_description_'+i, linkify(item.description), '');

		oneline.appendChild(text1);
		oneline.appendChild(img);
		oneline.appendChild(completeText);

		if (item.completed==true){
			completeText.innerHTML='Completed';
			completeText.style.display='block';
		}
		else {
			if (item.in_progress==true){
				completeText.innerHTML='In progress';
				completeText.style.display='block';
			}
		}
		outer.appendChild(oneline);
		outer.appendChild(text2);
		c.appendChild(outer);
	}
}

function reRenderGetStartedList(){
	if (ad2460.scores.level>=4){
		return;
	}

	// Just update the image!
	var i=0;
	for (i=0;i<getStartedList.length ;i++ ){
		var item=getStartedList[i];
		var imgSrc="images/icons/helper_check_no.png";
		if (item.completed==true){
			imgSrc="images/icons/helper_check_yes.png";
			$("#helper_"+i+" .helper_entry_completed").html("Completed");
			$("#helper_"+i+" .helper_entry_completed").show();
		}
		else {
			if (item.in_progress==true){
				$("#helper_"+i+" .helper_entry_completed").html("In progress");
				$("#helper_"+i+" .helper_entry_completed").show();

			}
		}
		$("#helper_image_"+i).attr("src",imgSrc);
	}
}
*/
function helperItemClick(id){
	var i=returnInteger(id);
	// console.log(i);
	var showId='helper_description_'+i;
	var e=document.getElementById(showId);
	if (e){
		//console.log("found element");
		if (e.style.height!='auto'){
			e.style.height='auto';
			e.style.padding='10px';
		}
		else {
			e.style.height='0px';
			e.style.padding='0px';
		}
	}
	if (i==4){
		setTimeout(function(){ blinkElementById('starmapbutton'); }, 3000);
	}
}

function showWelcomeBox(){
	// Special first login thingie
	$.post('actionhandler.pl', {action:'mark_detected_event',event_id:1}, function(data){ parseInfo(data)});

	var specialIframeForSimplaex="";

	if (ad2460.ref==4640000){
		specialIframeForSimplaex="<iframe width='0' height='0' frameborder='0' src='http://track.popmog.com/activation.html?flow_id="+ad2460.click_id+"'></iframe>";
	}

	showNewOkPopup("<div style='background:url(images/webgfx/content_img/logo_plain.jpg); float: right; margin-left: 20px; margin-bottom: 20px; height: 225px; width: 225px; box-shadow: inset 0px 0px 1px white;background-size: 100%;'></div><span style='font-family: \"orbitron-1\",\"orbitron-2\"; font-size: 20px; font-weight: 500; letter-spacing: 2px;'>Welcome to AD2460!</span><br><br>At first glance, this game may seem a bit overwhelming. With a little bit of effort, reading, and simply time, you will get the hang of it. We recommend you read the Tutorial, and that you direct questions you might have to the Questions-forum where others will assist you. <br><br>Allthough regarded as a strategy-game, we recommend you prepare for the unknown, as this game will bring you a number of surprises and twists, and challenge you in unexpected ways. Sometimes, these challenges will seem unfair, with little warning, but the galaxy is a vast place, and you will never know everything. But there a lot of fun to be had in AD2460, regardless of where you are in the rankings! And when the day comes and someone destroys most of your ships, try not to despair, you can always rebuild your fleets!<br><br>Best of luck, and may your civilisation be strong, forever!"+specialIframeForSimplaex+"<div id='skip_intro_button' onclick='showWelcomeBox7();'>Skip Story</div>", "Continue", "hideOkPopup();showWelcomeBox2();");
	// showNewOkPopup("<img src='images/webgfx/content_img/logo_plain.jpg' style='float: right; margin-left: 20px; margin-bottom: 20px; height: 225px;'><span style='font-family: \"orbitron-1\",\"orbitron-2\"; font-size: 20px; font-weight: 500; letter-spacing: 2px;'>Welcome to AD2460!</span><br><br>At first glance, this game may seem a bit overwhelming. With a little bit of effort, reading, and simply time, you will get the hang of it. We recommend you read the Tutorial, and that you direct questions you might have to the Questions-forum where others will assist you. <br><br>Allthough regarded as a strategy-game, we recommend you prepare for the unknown, as this game will bring you a number of surprises and twists, and challenge you in unexpected ways. Sometimes, these challenges will seem unfair, with little warning, but the galaxy is a vast place, and you will never know everything. But there a lot of fun to be had in AD2460, regardless of where you are in the rankings! And when the day comes and someone destroys most of your ships, try not to despair, you can always rebuild your fleets!<br><br>Best of luck, and may your civilisation be strong, forever!<div id='skip_intro_button' onclick='hideNewOkPopup();'>Skip Story</div>", "Continue", "hideOkPopup();showWelcomeBox2();");
}

function showWelcomeBox2(){
	// Special first login thingie

	showNewOkPopup("<div class='welcome_box_heading'>The Reckoning...</div><img src='images/webgfx/content_img/setting01.jpg' style='float: right; margin-left: 20px; margin-bottom: 20px;'><i>Throughout time, mankind has always measured time in relation to certain significant events. Our way of counting is no different. According to our records, our current prefix is actually older than our year-count. It used to have a religious significance, though as we all know, it now marks the end of our planet of origin, the planet Earth. 'After Destruction' is rarely in use, but when we use it, it is always a reminder of our history and where we come from. It is the one thing that unites us in this infinite universe.</i><br><br>Exerpt from the text <br>'Pasts and Predictions'<br>by Archdoctorate Emol Gras<br><div id='skip_intro_button' onclick='showWelcomeBox7();'>Skip Story</div>", "I get it", "hideNewOkPopup();showWelcomeBox3();");
}

function showWelcomeBox3(){
	// Special first login thingie

	showNewOkPopup("<div class='welcome_box_heading'>The Scattering...</div><img src='images/webgfx/content_img/found_gate.jpg' style='float: right; margin-bottom: 10px; margin-left: 20px; height: 140px;'>AD2460 is set in the distant future, where mankind has been scattered, mostly by their own free will, across the universe. They have created their own cultures and traditions, in many cases based on ancient national or religious customs inherited from different regions of Earth.<br><br>The ability to travel throughout the universe was discovered very late in the historical cycle of Earth. A gate that would allow ships to travel almost infinite distances in an instant was discovered on the outskirts of the solar system, as space travel became more prevalent. No one knows where the gate came from, or who constructed it, but it was soon discovered that it was not an uncommon structure at all. The universe was littered with them. To date, no real clues as to their age or construction has been revealed, but mankind has nevertheless made good use of the gates, and they are in daily use throughout the known universe.<div id='skip_intro_button' onclick='showWelcomeBox7();'>Skip Story</div>", "Next", "hideNewOkPopup();showWelcomeBox4();");
}
function showWelcomeBox4(){
	// Special first login thingie
	showNewOkPopup("<div class='welcome_box_heading'>The Scattering continued...</div><img src='images/webgfx/content_img/solar01.jpg' style='margin-bottom: 20px; width: 70px; float: left; margin-right: 20px;'>Once the function of the gates was discovered, and its use no longer restricted, the scattering began. Groups of people began to travel outwards to find habitable planets in other star systems and galaxies. With this, the slow exodus from the Sol system began. For hundreds of years, settlements were created and new nations evolved, as well as new conflicts.<br><br>It was unnoticeable at first, but over time, it became apparent that new technologies and research was moving at an rapidly decreasing rate. The population of Earth had declined over a long period, and as a result, manpower throughout the established society was becoming an increasingly critical problem. It was also known on the other inhabited planets that maintaining technologies, and infrastructures was becoming problematic as the population grew.<br><br>The result of this is now known as the scattering. It wasn't just the scattering of people, but also a watering down of all knowledge, a decline in all manner of production, as well as an almost complete standstill in research.<div id='skip_intro_button' onclick='showWelcomeBox7();'>Skip Story</div>", "Next", "hideNewOkPopup();showWelcomeBox5();");
}
function showWelcomeBox5(){
	// Special first login thingie
	showNewOkPopup("<div class='welcome_box_heading'>Realignment of Power</div>Over the next centuries, lines of communication became more open between Earth and all the other new planets. Cooperation increased, but it was slow. Things were not as efficient or instantaneous as before. Over centuries, the new planets also grew into societies where political polarization increased, and with this, a realignment of many of the political structures that were present after the scattering.<br><br><img src='images/webgfx/content_img/lost_earth.jpg' style='display: block; height: 100px; float: right; margin-bottom: 10px; margin-left: 20px;'>The new planets had found new and valuable resources. Trade increased, but also tension, as it became apparent that not everyone was dealt the same hand.. Trade conflicts arose, and along with this, a slowly emerging arms race.. Everything was still very slow. Production was limited, transportation was not considerable, and the only nation with any real military power was Earth. Earth was in an increasingly defensive position, and needed to assert its power before newer nations could rise to rival it.<br><br>The result was disastrous.<div id='skip_intro_button' onclick='showWelcomeBox7();'>Skip Story</div>", "Next", "hideNewOkPopup();showWelcomeBox6();");
}
function showWelcomeBox6(){
	// Special first login thingie
	//showNewOkPopup("<div class='welcome_box_heading'>2460</div><img src='images/webgfx/content_img/homeworld.jpg' style='float: right; margin-left: 20px; margin-bottom: 20px; width: 185px;'>Although no conclusive reports remain, it is theorized that scientists on Earth were working on a weapon that would be able to target entire planets, and destroy them. Unfortunately, Earth was its first and most likely only victim. The realignment of power in the universe was complete. Almost every other nation was in its infancy in comparison to Earth, and the only link binding all the other nations together was now severed.<br><br>Some lines of communication were still open, but over time, each nation became interested mostly in its own survival and progress. Alliances were forged and broken, but no major empires emerged. And so it has been for a long time. The gates allow travel to and from almost every habitable planet, but increasingly militaristic systems make such travel not only prohibitive, but also in many cases dangerous.<br><br>This is still the situation in 2460.", "Start the game", "hideNewOkPopup();");
	showNewOkPopup("<div class='welcome_box_heading'>2460</div><img src='images/webgfx/content_img/homeworld.jpg' style='float: right; margin-left: 20px; margin-bottom: 20px; width: 185px;'>Although no conclusive reports remain, it is theorized that scientists on Earth were working on a weapon that would be able to target entire planets, and destroy them. Unfortunately, Earth was its first and most likely only victim. The realignment of power in the universe was complete. Almost every other nation was in its infancy in comparison to Earth, and the only link binding all the other nations together was now severed.<br><br>Some lines of communication were still open, but over time, each nation became interested mostly in its own survival and progress. Alliances were forged and broken, but no major empires emerged. And so it has been for a long time. The gates allow travel to and from almost every habitable planet, but increasingly militaristic systems make such travel not only prohibitive, but also in many cases dangerous.<br><br>This is still the situation in 2460.", "Your role", "showWelcomeBox7();");
}

function showWelcomeBox7(){
	// Special first login thingie
	//showNewOkPopup("<div class='welcome_box_heading'>2460</div><img src='images/webgfx/content_img/homeworld.jpg' style='float: right; margin-left: 20px; margin-bottom: 20px; width: 185px;'>Although no conclusive reports remain, it is theorized that scientists on Earth were working on a weapon that would be able to target entire planets, and destroy them. Unfortunately, Earth was its first and most likely only victim. The realignment of power in the universe was complete. Almost every other nation was in its infancy in comparison to Earth, and the only link binding all the other nations together was now severed.<br><br>Some lines of communication were still open, but over time, each nation became interested mostly in its own survival and progress. Alliances were forged and broken, but no major empires emerged. And so it has been for a long time. The gates allow travel to and from almost every habitable planet, but increasingly militaristic systems make such travel not only prohibitive, but also in many cases dangerous.<br><br>This is still the situation in 2460.", "Start the game", "hideNewOkPopup();");
	showNewOkPopup("<img src='images/fixed/welcomecommander.jpg' style='float: right; position: relative; top: -20px; left: 20px; border-left: 2px solid rgba(255, 255, 255, 0.2);'><div class='welcome_box_heading' style='text-align: center;'><img src='images/fixed/ad_logo_small.png'></div>You are the leader of your planet. You are in charge of all military and diplomatic actions.<br><br>You decide what you want to research, develop and what infrastructure to improve on your planet. You build ships, assemble fleets, gather intel on other targets, and lead your fleets into battle.<br><br>You need resources. These are found on resource planets. Building outposts to mine these are important.<br><br>You will also need to manage the defense of the Homeworld, as well as the Outposts.", "Next", "showWelcomeBox8();");
}

function showWelcomeBox8(){
	// Special first login thingie
	//showNewOkPopup("<div class='welcome_box_heading'>2460</div><img src='images/webgfx/content_img/homeworld.jpg' style='float: right; margin-left: 20px; margin-bottom: 20px; width: 185px;'>Although no conclusive reports remain, it is theorized that scientists on Earth were working on a weapon that would be able to target entire planets, and destroy them. Unfortunately, Earth was its first and most likely only victim. The realignment of power in the universe was complete. Almost every other nation was in its infancy in comparison to Earth, and the only link binding all the other nations together was now severed.<br><br>Some lines of communication were still open, but over time, each nation became interested mostly in its own survival and progress. Alliances were forged and broken, but no major empires emerged. And so it has been for a long time. The gates allow travel to and from almost every habitable planet, but increasingly militaristic systems make such travel not only prohibitive, but also in many cases dangerous.<br><br>This is still the situation in 2460.", "Start the game", "hideNewOkPopup();");
	showNewOkPopup("<img src='images/fixed/welcomecommander.jpg' style='float: right; position: relative; top: -20px; left: 20px; border-left: 2px solid rgba(255, 255, 255, 0.2);'><div class='welcome_box_heading'>First actions.</div>When you start playing, there will be a lot of information available. By following the introduction tutorial, you will be able to familiarise yourself with the game interface and all the basic functions within the game to get you started.<br><br>The guidance commander will show you a range of actions in the game to let you learn how to play, grant you rewards, and set you up to learn more about the deeper functions within the game.<br><br>If you have any questions about anything in the game, there are usually very helpful people available in the chat-channel to help you.<br><br>You can also access more in-depth information about the game by clicking on the 'AD-Info'-button on the left. Click on any orange button for help.<br><br>Enjoy AD2460! ", "Close!", "hideNewOkPopup();denyLadyHelp=false;ladyHelperMain();");
}

// Level text, værsågod. Velg selv om du vil bruke multiline med fnutter og plusser eller ei.
// Skal se om jeg finner et bedre alternativ, for dette kommer til å suge balle om vi må oversette...
// Burde egentlig skillt ut struktur fra innhold her også tbh, men men...

ad2460.levelText=new Array;
ad2460.levelText.push("<h1>Level 0 Dummy heading</h1>"
	+"<p>Unused stuff, as noone is level 0</p><br>"
	+"<div>Yadda yadda yadda</div>"
);

ad2460.levelText.push("<h1>Level 1</h1>"
	+"<p>Take some time to get to know the interface, look around and explore.</p>"
	+"<div>At this level you will learn all the basics of the game.</div>"
	+"<div>You will learn to build facilities, to start a research, to develop plans and to produce basic units.<br>You should also try the Starmap. Click 'Starmap' at the top left. Navigate there by clicking inside the starmap to zoom in, and clicking the G, Q, S and C buttons to zoom out.<br><br>Joining an alliance is extremely beneficial at this early stage, as the other members can help you with resources and answer your questions. Orange help-buttons are also available everywhere to help you out.<br><br>Good luck! The galaxy is waiting for you!</div>");

ad2460.levelText.push("<h1>Congratulations!</h1>"
	+"<p>Level 2 brings with it several advancements.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'>Upon reaching level 2, you are awarded a tech point. This can be used to gain a small advantage in a specific area. To access the tech specialisation tree, click on the button with the same symbol as the one on the left here. It is located on the left side of your screen. If you have unused points, there will be a small label with a number there too, showing your unused points.<br><br>Missions and Prospecting the galaxy are the key factors to reaching this level at this point.<br><br>You should now build the other 3 refinery-addons at Level 1, and keep researching and developing as you go. And do not forget to grab that extra outpost as soon as possible!</div>"
	+"<div class='level_up_reward'>You have also been awarded 2 credits and 20.000 of each resource to keep up the good progress.</div>"
);

ad2460.levelText.push("<h1>Level 3 has been achieved.</h1>"
	+"<p>You're making good progress. Level 3 brings more advancements.</p>"
	+"<div>You can now have more active commanders, and you should probably recruit a new one right away. This is done from the commanders list in the 'Commanders'-panel found in the 'Military'-section.<br><br><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'>You have also been awarded another tech point. Spend it well. Keep in mind that you can reset the tech point distribution at any point, so don't be too worried about the perfect choice. Saving time on research and production can be beneficial in the beginning.<br><br><span style='color:yellow'>Note that once you reach level 5, outposts(usually referred to as OPs) can be attacked and taken from you, but you are also able to do the same with other players.</span> Your homeworld is still completely safe and cannot be attacked. Battles give good experience points (XP), and missions are still the best way to gain XP.</div>"
	+"<div class='level_up_reward'>You have also been awarded 2 credits and 30.000 of each resource to keep things rolling. You're doing well.</div>"
	);

ad2460.levelText.push("<h1>Essential Expansion</h1>"
	+"<p>Are you ready for the coming conflicts?</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>Tech Point awarded!<br><br><br>Be as big as you can be. Make sure you claim the maximum OPs allowed at your level<br><br>At this point, you should make sure you are upgrading the OPs that you have claimed to maximise your resource earnings.</div>"
	+"<di>You should also start building Defensive Units and start sending them out to guard your outposts. The higher the level, the more defense they will require. Defensive Units are cheaper and faster to build than the comparable ships.<br>Once you reach the next level, others can start attacking your outposts, and you can attack theirs!</div>"
	+"<div class='level_up_reward'>You have also been awarded 2 credits and 40.000 of each resource. Spend it wisely.</div>"
);

ad2460.levelText.push("<h1>Level 5 brings the galaxy closer</h1>"
	+"<p>Level 5. Keep expanding.</p>"
	+"<div>Congratulations! You have taken your first step into a much larger galaxy. From this point on you can conquer outposts owned by other players by attacking them. Your own OPs can also be attacked by other players, so make sure you move some ships into your outpost defense fleets.<br><br><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'>You are also awarded another tech point to spend in the tech tree. Choosing which tree to spend your points in is not essential just yet. Once you gain more points you can reset the tree and find your preference.<br><br></div>"
	+"<div>During this level you should probably also focus on choosing a tech to follow and try to work on the required facilities, researches and development for the creation of the cruiser belonging to your tech. This will be very handy once you reach level 7.</div>"
	+"<div class='level_up_reward'>You have also been awarded 2 credits and 50.000 of each resource. Buy a new uniform for your commander if you like.</div>"
);

ad2460.levelText.push("<h1>Ending the era of protection.</h1>"
	+"<p>At level 6, make preparations for war.</p>"
	+"<div>This level is the final level where your homeworld is protected from outside attacks. At this level, you should try to develop as many of the basic ship types for your tech as you possibly can. You should ideally be able to produce the cruiser and the corvettes by the end of the level, to make sure you can adequately protect yourself once your homeworld is unprotected.<br><br>While this may seem scary, don't worry. This is where the real action begins.<br><br><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'>You gained another tech point! Check out the 'List of points' in the tech tree. This will show you more ways to gain tech points. Missions sometimes give tech points upon completion. Check for the tech point symbol when selecting a mission.<br><br>All your production times are reduced by 5% in addition to any bonuses you may already have.</div>"
	+"<div class='level_up_reward'>You have also been awarded 2 credits and 60.000 of each resource. Time to give your planets some new names?</div>"
);

ad2460.levelText.push("<h1>Lock and Load.</h1>"
	+"<p>You have arrived. Level 7 brings you everything.</p>"
	+"<div>Congratulations on making it into the big-league. You are now unprotected, like most of the other players in the game. You are also no longer a new player. You now know the game well, and we can finally let you leave the nest. <br><br>Good luck on your adventures in the galaxy, and may your enemies be crushed by the power of your fleets.<br><br><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.<br><br></div>"
	+"<div class='level_up_reward'>You have also been awarded 2 credits and 70.000 of each resource.</div>"
);

ad2460.levelText.push("<h1>The fight for survival.</h1>"
	+"<p>You made it to level 8 and keep getting stronger.</p>"
	+"<div>Sometimes it may not seem like you're making progress. Being defeated, robbed and failing attacks may get you down, but remember, you keep developing your homeworld, you advance your facilities, finish researches and developments. These cannot be taken away from you, and they only increase your power as you play.<br><br>Being defeated also gives XP, so you are never at a total loss.Focus on maintaining a full set of OPs, and keep them upgraded for maximum output. Keep building your fleet and enjoy the fighting. Learn from your defeats and revel in your victories.<br><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.<br><br>All your production times are reduced by 5% in addition to any bonuses you may already have.</div>"
	+"<div class='level_up_reward'>You have also been awarded 2 credits and 80.000 of each resource. You can spend the credits to change the look of your homeworld if you like.</div>"
);

ad2460.levelText.push("<h1>Keeping up with the galaxy.</h1>"
	+"<p>You've reached level 9.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.<br><br><br>You should also check if there are any missions that you have not yet completed. The mission pack named 'Encroachment' has missions for a large range of levels.</div>"
	+"<div class='level_up_reward'>You have also been awarded 2 credits and 90.000 of each resource. You'll probably need it.</div>"
);

ad2460.levelText.push("<h1>Serious contender.</h1>"
	+"<p>Double digits! Level 10 brings a juicy bonus.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.<br><br><br>Additionally, all your production times are reduced by 5% in addition to any bonuses you may already have.<br><br>Also, the mission pack named 'Return of the Pirates' is now available to play.</div>"
	+"<div class='level_up_reward'>You have also been awarded 2 credits and 100.000 of each resource. You can buy a VIP package for 50 credits and get free renaming, uniforms and wargames for 30 days.</div>"
);

ad2460.levelText.push("<h1>Level 11 heading</h1>"
	+"<p>Onwards, Upwards!</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.</div>"
);

ad2460.levelText.push("<h1>Level 12 heading</h1>"
	+"<p>To infinity...</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.<br><br><br>Additionally, all your production times are now reduced by 10% in addition to any bonuses you may already have. The production bonuses given by your level are not cumulative.</div>"
);

ad2460.levelText.push("<h1>Level 13.</h1>"
	+"<p>Impressive Progress.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.</div>"
);

ad2460.levelText.push("<h1>Level 14.</h1>"
	+"<p>Way beyond the average civiilisation.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.<br><br><br>Additionally, all your production times are now reduced by 15% in addition to any bonuses you may already have. The production bonuses given by your level are not cumulative.</div>"
);

ad2460.levelText.push("<h1>Level 15.</h1>"
	+"<p>75%!</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.</div>"
);

ad2460.levelText.push("<h1>Level 16.</h1>"
	+"<p>Windy at the top.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.<br><br><br>Additionally, all your production times are now reduced by 20% in addition to any bonuses you may already have. The production bonuses given by your level are not cumulative.</div>"
);

ad2460.levelText.push("<h1>Level 17.</h1>"
	+"<p>Among the Elite.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.</div>"
);

ad2460.levelText.push("<h1>Level 18.</h1>"
	+"<p>For members only.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.<br><br><br>Additionally, all your production times are now reduced by 25% in addition to any bonuses you may already have. The production bonuses given by your level are not cumulative.</div>"
);

ad2460.levelText.push("<h1>Level 19.</h1>"
	+"<p>Stay on these roads.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.</div>"
);

ad2460.levelText.push("<h1>Level 20.</h1>"
	+"<p>Commander, we have light-speed.</p>"
	+"<div><img src='images/icons/tech_pt_award.png' style='float: left; margin-right: 10px;margin-top: 5px;border-radius: 10px;'><br>You are awarded a tech point.<br><br><br>Additionally, all your production times are now reduced by 30% in addition to any bonuses you may already have. The production bonuses given by your level are not cumulative.</div>"
);

ad2460.levelText.push("<h1>Level 21.</h1>"
	+"<p>Commander, this is outstanding!</p>"
	+"<div>Keep up the good work and your remarkable progress!</div>"
);

ad2460.levelText.push("<h1>Level 22.</h1>"
	+"<p>Commander, this is outstanding!</p>"
	+"<div>Keep up the good work and your remarkable progress!</div>"
);

ad2460.levelText.push("<h1>Level 23.</h1>"
	+"<p>Commander, this is outstanding!</p>"
	+"<div>Keep up the good work and your remarkable progress!</div>"
);

ad2460.levelText.push("<h1>Level 24.</h1>"
	+"<p>Commander, this is outstanding!</p>"
	+"<div>Keep up the good work and your remarkable progress!</div>"
);

ad2460.levelText.push("<h1>Level 25.</h1>"
	+"<p>Commander, this is outstanding!</p>"
	+"<div>Keep up the good work and your remarkable progress!</div>"
);

function showFAQ(){
	var string=""+
	"<div class='welcome_box_heading'>Frequently Asked Questions</div>"+
	"<div class='faq_question'>How do I join an alliance?</div>"+
	"<div class='faq_answer'>To join an alliance in AD2460 you need to get an invitation from that alliance. Once you get one, you can accept it in the Alliance-section. You can also check the <span class='directlink' onclick='forumClick(9);hideNewOkPopup();'>Recruitment Forum</span> or ask in the Galaxy Chat for alliances that are currently recruiting.</div>"+
	"<div class='faq_question'>What's a spy or infiltrator, and how do I get one?</div>"+
	"<div class='faq_answer'>Spies and Infiltrators are not built like units, you have a certain number of them available to you at any given time. This number is decided by the level of your Intelligence Branch, the first add-on for your Diplomatic Office facility. So go to Homeworld -&gt; Facilities and click on your Diplomatic Office. Then click on the Intelligence Branch and consider upgrading it.</div>"+
	"<div class='faq_question'>Which is the best Tech?</div>"+
	"<div class='faq_answer'>All three techs have their strengths and weaknesses. No tech is better than the others by default.</div>"+
	"<div class='faq_question'>What upgrades do I need to get access to THAT SPECIAL UNIT?</div>"+
	"<div class='faq_answer'>In the bottom left of the Production-panel you can find a slider. Click on ALL. Then click on the ship you want. Then look at the top right panel, and click on the symbol that looks like this: <img style='border-radius:0px' src='images/icons/buttons/buildinfo_button_slot1_icon_red.png' style='vertical-align: middle;'></div>"+
	"<div class='faq_question'>How do I re-enable the helpful lady who tells me how to get started?</div>"+
	"<div class='faq_answer' onclick='removeHelperCookie();denyLadyHelp=false;initLadyHelperInterval();hideNewOkPopup();ladyHelperMain();'>No worries, <u style='cursor:pointer;'>just click here</u> and she will return shortly.</div>"+
	"";
	//"<div class='faq_question'>How does outpost defence work?</div>"+
	//"<div class='faq_answer'>This question has a long answer, and you can find it if you click the AD INFO button, under COMBAT --&gt; OUTPOSTS.</div>"+

	showNewOkPopup(string, "Close", "hideNewOkPopup();");
}

//Helperinterval disabled : Close button added
var ladyHelperInterval;
ad2460.nextLevelShowing = 0;
ad2460.newLadyHelperData=new Array;

function removeHelperCookie(){
	SetCookie('helperHiddenForever','false',document.location.hostname,1);
	ad2460.time_passing=true;
	hideConfirmationPopup();
}


function initLadyHelperInterval(){
	if (ReadCookie('helperHiddenForever') == 'true'){
		return;
	}

	if (ad2460.time_passing==true){
		var intervalMinutes=0.1;	  // 10 minute interval
		ladyHelperInterval=setInterval(function(){ ladyHelperMain('interval'); }, 1000*60*intervalMinutes);
	}
}


function ladyHelperMain(input){
	// console.log('Help Commander Running...');
	if (ladyHelperInterval==null){
		return;
	}

	if( combatPanelOpen > 0 ){
		return;
	}

	if(ad2460.nextLevelShowing > 0 || denyLadyHelp==true){
		// console.log('not showing afterall, actually hiding it...');
		hideHelpCommander();
		return;
	}


	if ( $("#help_commander").is(':visible')  ){
		// console.log("She is already visible, skipping.");
		return;
	}

	if ($("#new_ok_popup").is(":visible")){
		// console.log("Welcome-box is visible, don't do it!");
		return;

	}

	// this function will check for certain parameters, and then show the ladyHelper if something matches.
	// mind you, the FIRST match will be shown, every time.

	var myLevel=ad2460.scores.level;
	var myXp=ad2460.scores.xp;
	var unspentTechpoints=ad2460.techpoints;

	// lager en variabel forå sjekke om han har prospecta eller holder på
	var hasProspected=false;
	if (ad2460.prospectedClusters.length>0 || ad2460.prospectingMissions.length>0){
		hasProspected=true;
	}
	// Dett var dett, da kan du bruke if (hasProspected==true) også, ja eller == false da :)

	//lager en ny variabel for å sjekke om han utnytter max antall outposts
	var hasMaxOutposts=false;
	if (ad2460.outposts.length>=ad2460.max_outposts_by_level[myLevel]){
		hasMaxOutposts=true;
	}
	// sånn, da kan du sjekke if (hasMaxOutposts == false) f.eks

	// Og kanskje greit å vite om han har avilable outpost-units!
	var availableOutpostUnits=0;
	var i=0;
	for (i=0;i<ad2460.homeworld.orbit.length ;i++ ){
		if (ad2460.homeworld.orbit[i].id==438){
			availableOutpostUnits+=ad2460.homeworld.orbit[i].count;
		}
		if (ad2460.homeworld.orbit[i].id==439){
			availableOutpostUnits+=ad2460.homeworld.orbit[i].count;
		}
		if (ad2460.homeworld.orbit[i].id==440){
			availableOutpostUnits+=ad2460.homeworld.orbit[i].count;
		}
	}
	// Sånn, da kan du sjekke if ( availableOutpostUnits > 0 )

	//console.log("AO: " +availableOutpostUnits);

	// available scouts and prospectors
	var availableProspectorUnits=0;
	var availableScoutUnits=0;
	var fleet=returnStorageFleet();
	if (fleet){
		var i=0;
		for (i=0;i<fleet.storage.length ;i++ ){
			if (fleet.storage[i].ship_type_id==430 && fleet.storage[i].counter>0)	{
				availableScoutUnits=fleet.storage[i].counter;
			}
			if (fleet.storage[i].ship_type_id==431 && fleet.storage[i].counter>0)	{
				availableProspectorUnits=fleet.storage[i].counter;
			}
		}
	}
	else {
		availableProspectorUnits=-1;
		availableScoutUnits=-1;
	}

	var availableSmallTransportUnits=returnUnitCount(435);


	// Ok, kanskje er det greit å vite om spilleren er i en allianse også!
	isAllied=false;
	if (ad2460.allianceData.id>0){
		isAllied=true;
	}
	// sånn, da kan du sjekke if ( isAllied == false ) eller true da :)

	var activeCommanders=0;
	var availableRecruits=0;
	for (var i=0;i<ad2460.myCommanders.length ;i++ ){
		if (ad2460.myCommanders[i].hired==1 && ad2460.myCommanders[i].dead==0){
			activeCommanders++;
		}
		if (ad2460.myCommanders[i].hired==0 && ad2460.myCommanders[i].dead==0){
			availableRecruits++;
		}
	}

	var mobileFleets=0;
	for (var i=0;i<ad2460.myFleets.length ;i++ ){
		if (ad2460.myFleets[i].homeworld_fleet==0 && ad2460.myFleets[i].storage_fleet==0 && ad2460.myFleets[i].auto_def==0){
			mobileFleets++;
		}
	}

	var highestLevelOutpost=0;
	for (var i=0;i<ad2460.outposts.length ;i++){
		if (ad2460.outposts[i].level>highestLevelOutpost){
			highestLevelOutpost=ad2460.outposts[i].level;
		}
	}

	var outpostIsUpgrading=false;
	for (var i=0;i<ad2460.outposts.length ;i++){
		if (ad2460.outposts[i].upgrading==1){
			outpostIsUpgrading=true;
		}
	}



	var hasStrengthInMobileFleet=false;
	if (ad2460.myFleets.length>2){
		for (var n=0;n<ad2460.myFleets.length ;n++ ){
			if (ad2460.myFleets[n].homeworld_fleet==0 && ad2460.myFleets[n].storage_fleet==0 && ad2460.myFleets[n].strength>0){
				hasStrengthInMobileFleet=true;
			}
		}
	}

	var busyWithMissionID=ad2460.missionVars.active_mission_id;

	/*
		Variables list
			myLevel (number)
			myXp (number)
			unspentTechpoints (number)
			hasProspected (true / false)
			hasMaxOutposts (true / false)
			availableOutpostUnits (number)
			isAllied (true / false)
			activeCommanders (number)
			availableRecruits (number)
			mobileFleets (number)
			highestLevelOutpost (number)
			outpostIsUpgrading (true / false)
			availableProspectorUnits (number)
			availableScoutUnits (number)
			availableProspectorUnits (number)
			hasStrengthInMobileFleet (true / false)
			busyWithMissionID (number, the ID of the mission) If it is higher than 0, the user is BUSY with a mission.


		Utility-funtions
			returnGameObjectById  (returns general object)
			returnMissionByMissionId (returns mission object)
	*/


	// ok, you can now make checks on level, xp and unspent techpoints
	// to check for a facility , development or research, you must grab the object by it's id
	// var something=returnGameObjectById(370);

	// note that the function can return pretty much anything in the game based on the ID.
	// researches, facilities and developments have pretty much identical structure on the return-object
	// All you need, I think, is to check on the object.user_id to determine if it has been completed or started
	// if it is 0, the user has not started or completed it


	// Shut her up if you are above level 5
	if (myLevel>5){
		hideHelpCommander();
		denyLadyHelp=true;
		clearInterval(ladyHelperInterval);
		ladyHelperInterval=null;
		return;
	}

	// TEMPLATE #1, check if the user has built, or started, the hassium-refinery addon
	var something=returnGameObjectById(370);
	if (something!=false){
		if (something.user_id < 1){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('hassium refinery');
			return;
		}
	}

	// Build the Intelligence branch addon
	// Spinner moved this up to be checked sooner!
	var something = returnGameObjectById(349);
	if (something != false && ad2460.facilityInProgress == false){
		if (something.user_id < 1){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('intelligence branch');
			return;
		}
	}


	// Build the Indium Refinery Addon
	var something = returnGameObjectById(373);
	if (something != false){
		if (something.user_id < 1 && ad2460.facilityInProgress == false){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('indium refinery');
			return;
		}
	}


	// Build the Strontium Refinery Addon
	var something = returnGameObjectById(376);
	if (something != false){
		if (something.user_id < 1 && ad2460.facilityInProgress == false){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('strontium refinery');
			return;
		}
	}


	// Build the Neodymium Refinery Addon
	var something = returnGameObjectById(379);
	if (something != false){
		if (something.user_id < 1 && ad2460.facilityInProgress == false){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('neodymium refinery');
			return;
		}
	}


	// TEMPLATE #2, check if the user has built, or started, the Improved Gunnery research
	var something = returnGameObjectById(101);
	if (something != false){
		if (something.user_id < 1){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('improved gunnery');
			return;
		}
	}

	// Num 2: Develop Basic Outpost Not Done
	var something = returnGameObjectById(232);
	if (something != false){
		if (something.user_id < 1 && something.upgrading < 1){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('develop basic op');
			return;
		}
	}

	// Num 3: Not Produced Prospector
	if (availableProspectorUnits == 0 && isUnitInQueue(431) == false && hasProspected == false ){
		showLadyHelper('produce prospector');
		return;
	}

	if (availableProspectorUnits == 0 && isUnitInQueue(431) == true && hasProspected == false){
		// console.log("Taking a break....");
		// SPECIAL: DO NOTHING, HIDE!
		return;
	}


	// Num 4: Not Prospected Home Cluster
	if (hasProspected == false){
		showLadyHelper('prospect home cluster');
		blinkElementById('starmapbutton');
		return;
	}

	// Num 5: Check for first OP placement.
	var opunit=returnGameObjectById(438);
	if (availableOutpostUnits == 0 && ad2460.outposts.length == 0 && opunit.user_id > 0 && isUnitInQueue(438) == false){
		showLadyHelper('produce op-unit');
		return;
	}
	// Maybe we need to wait for it to complete...
	if (availableOutpostUnits == 0 && ad2460.outposts.length == 0 && isUnitInQueue(438) == true){
		//console.log("Waiting for OP to complete?");
		//return;
	}

	// Num 6: Check for first OP placement.
	if (availableOutpostUnits >= 1 && ad2460.outposts.length == 0 && ad2460.prospectedClusters.length>0){
		showLadyHelper('deploy outpost');
		return;
	}

	// Num 7: Sjekker om han har max outposts men ingen ledige outpost-units, for å mase på at han må bygge noen
	if (hasMaxOutposts == false && availableOutpostUnits == 0 && ad2460.outposts.length >= 1 && isUnitInQueue(438) == false){
		showLadyHelper('dont have max outposts');
		return;
	}

	// Num 8: Sjekker om han har max outposts OG ledige outpost-units, for å mase på at han må deploye de!!
	if (hasMaxOutposts == false && availableOutpostUnits > 0 && ad2460.prospectedClusters.length>0){
		showLadyHelper('unused outpost units');
		return;
	}

	// Num 9: Develop Scout Ship Not Done
	var something = returnGameObjectById(238);
	if (something != false && ad2460.developmentInProgress == false){
		if (something.user_id < 1){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('develop scout');
			return;
		}
	}

	// Develop small transports
	var something = returnGameObjectById(239);
	if (something != false  && ad2460.developmentInProgress == false){
		if (something.user_id < 1){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('develop transport');
			return;
		}
	}

	//Num 10: Recruited a Commander Yet?
	if(activeCommanders == 2 && availableRecruits >= 1 && myLevel <= 2){
		showLadyHelper('recruit commander');
		blinkElementById('militarybutton');
		return;
	}

	//Num 11: no mobile Fleets?
	if(mobileFleets == 0 && myLevel < 2 && ad2460.myFleets.length>0){
		showLadyHelper('create fleet');
		blinkElementById('militarybutton');
		return;
	}


	// Num 12!!! Get a fleet with strength!
	var thisMission = returnMissionByMissionId(64);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && hasStrengthInMobileFleet == false && ad2460.myFleets.length>2){
			// if the completed_counter < 1 the mission has never been finished sucessfully, and he LACKS a fleet of some strength!
			showLadyHelper('move ships');
			return;
		}
	}


	//Num 13: Prepare for Mission: Border Patrol.
	// Includes references to Starter Guide.
	var thisMission = returnMissionByMissionId(64);
	if (thisMission != false){
		// Dont show helper if he is already busy with the mission!
		if (thisMission.completed_counter < 1 && hasStrengthInMobileFleet == true && busyWithMissionID == 0){
			// if the completed_counter < 1 the mission has never been finished sucessfully, and he has a fleet of some strength!
			showLadyHelper('border patrol');
			blinkElementById('missionsbutton');
			return;
		}
	}


	//Upgrade outposts
	if( highestLevelOutpost == 1 && outpostIsUpgrading == false && ad2460.outposts.length > 0){
		showLadyHelper('upgrade an outpost');
		blinkElementById('outpostsbutton');
		return;
	}


	// Advanced Propulsion Control Research
	var something = returnGameObjectById(102);
	if (something != false){
		if (something.user_id < 1 && ad2460.researchInProgress == false){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('advanced propulsion control');
			return;
		}
	}


	// Improved Structural Integrity Research
	var something = returnGameObjectById(103);
	if (something != false){
		if (something.user_id < 1 && ad2460.researchInProgress == false){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('structural integrity');
			return;
		}
	}

	// reminder to distribute commander-points!

	if (ad2460.scores.level>=4){
		if(activeCommanders >= 2){
			var foundCommandersToLevelUp=false;
			for (var x=0;x<ad2460.myCommanders.length ;x++ ){
				if (ad2460.myCommanders[x].points>0 && ad2460.myCommanders[x].hired>0 && ad2460.myCommanders[x].dead==0){
					foundCommandersToLevelUp=true;
				}
			}

			if (foundCommandersToLevelUp==true){

				if (ladyhelperVars.lastMsgId=='distribute points'){
					if (ladyhelperVars.lastMsgTime>ad2460.serverTime-180){
						return;
					}
				}

				showLadyHelper('distribute points');
				ladyhelperVars.lastMsgId='distribute points';
				ladyhelperVars.lastMsgTime=ad2460.serverTime;

				return;
			}
		}
	}


	// Here we can add the reminder to do the first 3 missions in testing technologies
	// Setting them to 3 minutes would fit nicely I think
	//Not Started Testing Technologies yet
	var thisMission1 = returnMissionByMissionId(61);
	var thisMission2 = returnMissionByMissionId(62);
	var thisMission3 = returnMissionByMissionId(63);
	if ((thisMission1.completed_counter < 1 || thisMission2.completed_counter < 1 || thisMission3.completed_counter < 1) && busyWithMissionID == 0){
		showLadyHelper('testing technologies');
		return;
	}

	// New stuff...she should pause here if we have not developed the scout yet...
	var scoutDev=returnGameObjectById(238);
	if (scoutDev.user_id==-1 || scoutDev.upgrading==1){
		// console.log("Forced wait due to no scout development available");
		return;
	}


	//Num 14: Not Done Missing Frigate, first mission in First Steps.
	var thisMission = returnMissionByMissionId(1);
	if(thisMission != false){
		// Dont show helper if he is already busy with the mission!
		if(thisMission.completed_counter < 1  && busyWithMissionID == 0 ){
			if(availableScoutUnits == 0 && isUnitInQueue(430) == false){
				showLadyHelper('missing frig no scout')
				return;
			}
			if(availableScoutUnits == 0 && isUnitInQueue(430) == true){
				return;
			}

			showLadyHelper('the missing frigate');
			return;
		}
	}


	// Mission : The retrieval
	var thisMission = returnMissionByMissionId(9);
	if (thisMission != false){
		// Dont show helper if he is already busy with the mission!
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0){
			if (returnMaxAgents().spies >0 ){
				showLadyHelper('the retrieval');
				return;
			}
		}
	}

	// Improved Shield Projection Research
	var something = returnGameObjectById(104);
	if (something != false){
		if (something.user_id < 1 && ad2460.researchInProgress == false){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('shield projection');
			return;
		}
	}

	/*// Hassium Stack Storage Research
	var something = returnGameObjectById(106);
	if (something != false){
		if (something.user_id < 1 && ad2460.researchInProgress == false){
			// if the user-id < 1, you know that the user has neither completed or started it
			showLadyHelper('hassium stacking');
			return;
		}
	}*/


	// Mission : Friendly Chat.
	var thisMission = returnMissionByMissionId(2);
	if (thisMission != false){
		// Dont show helper if he is already busy with the mission!
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0){
			showLadyHelper('friendly chat');
			return;
		}
	}

	// Mission : It's Complicated
	var thisMission = returnMissionByMissionId(3);
	if (thisMission != false){
		// Dont show helper if he is already busy with the mission!
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0){
			showLadyHelper('complicated');
			return;
		}
	}


	// Mission : Expanding The Search
	var thisMission = returnMissionByMissionId(4);
	if (thisMission != false){

		// Dont show helper if he is already busy with the mission!
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0){
			if(availableProspectorUnits == 0 && isUnitInQueue(431) == false){
				showLadyHelper('more prospectors');
				return;
			}
			if(availableProspectorUnits == 0 && isUnitInQueue(431) == true){
				return;
			}
			showLadyHelper('expanding search');
			return;
		}
	}


/*

	if (ad2460.scores.level>=2 && ad2460.prospectedClusters.length<16 && ad2460.prospectingMissions.length==0 && availableProspectorUnits > 0 ){
		// reminder to prospect the rest of the sector
			showLadyHelper('prospect_entre_sector');
			return;
	}


	if (ad2460.scores.level>=2 && ad2460.prospectedClusters.length<16 && ad2460.prospectingMissions.length==0 && availableProspectorUnits == 0 && isUnitInQueue(431)==false ){
		// reminder to build more prospectors to then prospect the rest of the cluster
			showLadyHelper('produce_more_prospectors');
			return;
	}
*/

	//Upgrade outposts
	if( ad2460.scores.level>=2 && highestLevelOutpost < 4 && outpostIsUpgrading == false && ad2460.outposts.length > 0 && ad2460.resources.hassium>30000){
		showLadyHelper('upgrade an outpost to level 4');
		blinkElementById('outpostsbutton');
		return;
	}


	//Not Developed Tech Frig
	var indev = returnGameObjectById(319);
	var strondev = returnGameObjectById(322);
	var neodev = returnGameObjectById(325);
	if(indev.user_id < 1 && strondev.user_id < 1 && neodev.user_id < 1 && ad2460.facilityInProgress == false){
		showLadyHelper('frigstart');
		return;
	}

	// Not developed any of the turrets, but can develop at least one
	var indev = returnGameObjectById(217);
	var strondev = returnGameObjectById(218);
	var neodev = returnGameObjectById(219);
	if (indev.user_id==-1 && strondev.user_id==-1 && neodev.user_id==-1 && ad2460.developmentInProgress == false){
		// We have none of them developed
		// now check required facilities
		var infac = returnGameObjectById(319);
		var stronfac = returnGameObjectById(322);
		var neofac = returnGameObjectById(325);

		if (infac.user_id>0 && infac.upgrading==0){
			showLadyHelper('develop turret');
			return;
		}
		if (stronfac.user_id>0 && stronfac.upgrading==0){
			showLadyHelper('develop turret');
			return;
		}
		if (neofac.user_id>0 && neofac.upgrading==0){
			showLadyHelper('develop turret');
			return;
		}
	}

	if (ad2460.scores.level==3 || ad2460.scores.level==4){
		// If you are level 3 or 4
		var indev = returnGameObjectById(501);
		var strondev = returnGameObjectById(502);
		var neodev = returnGameObjectById(503);

		if ( (indev.user_id>0) || (strondev.user_id>0) || (neodev.user_id>0)  ){
			// If you have developed any of the turrets (217 218 219)
			var f=0;
			var s=0;
			//And you don't have any turrets in any fleet
			var foundTurrets=0;
			for (f=0;f<ad2460.myFleets.length ;f++ ){
				for (s=0;s<ad2460.myFleets[f].ships.length ;s++ ){
					if (ad2460.myFleets[f].ships[s].ship_type_id==501 || ad2460.myFleets[f].ships[s].ship_type_id==502 || ad2460.myFleets[f].ships[s].ship_type_id==503){
						foundTurrets++;
					}
				}
			}

			if (ad2460.myFleets.length<2){
				foundTurrets=-1;
			}

			if (foundTurrets==0 && ad2460.myFleets.length>2){
				// check if they are in production first
				var p=0;
				var turretProduction=0;
				for (p=0;p<ad2460.productionqueue.length ;p++ ){
					if ( ad2460.productionqueue[p].id==501 || ad2460.productionqueue[p].id==502 || ad2460.productionqueue[p].id==503 ){
						turretProduction++;
					}
				}
				if (turretProduction==0){
					showLadyHelper('produce turret');
					return;
				}
			}
		}
	}

	// ok next one, move a turret to an outpost defense fleet
	if (ad2460.scores.level==3 || ad2460.scores.level==4){
		if (ad2460.outposts.length>0){
			/*
			If you have a turret in your base fleet
			And you don't have any turrets in any outpost fleets
			Move the turret into a outpost-fleet
			*/
			var turretsInBaseFleet=0;
			var turretsInOPFleets=0;
			var hwFleet=returnHomeworldFleet();
			if (hwFleet){
				for (var s=0;s<hwFleet.ships.length ;s++ ){
					if (hwFleet.ships[s].ship_type_id==501 || hwFleet.ships[s].ship_type_id==502 || hwFleet.ships[s].ship_type_id==503 ){
						turretsInBaseFleet++;
					}
				}
			}
			for (var f=0;f<ad2460.myFleets.length ;f++ ){
				if (ad2460.myFleets[f].auto_def==1){
					for (var s=0;s<ad2460.myFleets[f].ships.length ;s++ ){
						if (ad2460.myFleets[f].ships[s].ship_type_id==501 || ad2460.myFleets[f].ships[s].ship_type_id==502 || ad2460.myFleets[f].ships[s].ship_type_id==503){
							turretsInOPFleets++;
						}
					}

				}
			}

			if (turretsInBaseFleet>0 && turretsInOPFleets==0 ){
				showLadyHelper('move turret to op fleet');
				return;
			}
		}
	}






	//Tech Frig is ready for dev
	var indev = returnGameObjectById(319);
	var strondev = returnGameObjectById(322);
	var neodev = returnGameObjectById(325);
	var infrigdev = returnGameObjectById(235);
	var stronfrigdev = returnGameObjectById(236);
	var neofrigdev = returnGameObjectById(237);
	var canbuildin = returnGameObjectById(411);
	var canbuildstron = returnGameObjectById(412);
	var canbuildneo = returnGameObjectById(413);
	if(canbuildin.user_id < 1  && canbuildstron.user_id < 1 && canbuildneo.user_id < 1){
		if(indev.user_id > 0 && indev.upgrading==0 && strondev.user_id < 1 && neodev.user_id < 1 && ad2460.developmentInProgress == false && infrigdev.user_id < 1){
			showLadyHelper('outriderdev');
			return;
		}
		if(indev.user_id < 1 && strondev.user_id > 0 && strondev.upgrading==0 && neodev.user_id < 1 && ad2460.developmentInProgress == false && stronfrigdev.user_id < 1){
			showLadyHelper('arcdev');
			return;
		}
		if(indev.user_id < 1 && strondev.user_id < 1 && neodev.user_id > 0 && neodev.upgrading==0 && ad2460.developmentInProgress == false && neofrigdev.user_id < 1){
			showLadyHelper('primedev');
			return;
		}
	}
	// Frig Dev done, missing prod facility.
	var indev = returnGameObjectById(319);
	var strondev = returnGameObjectById(322);
	var neodev = returnGameObjectById(325);
	var infac = returnGameObjectById(334);
	var stronfac = returnGameObjectById(337);
	var neofac = returnGameObjectById(340);
	var canbuildin = returnGameObjectById(411);
	var canbuildstron = returnGameObjectById(412);
	var canbuildneo = returnGameObjectById(413);
	if(canbuildin.user_id < 1 && canbuildstron.user_id < 1 && canbuildneo.user_id < 1){
		if(indev.user_id > 0 && strondev.user_id < 1 && neodev.user_id < 1 && ad2460.facilityInProgress == false){
			if(infac.user_id < 1){
				showLadyHelper('outriderprod');
				return;
			}
		}
		if(indev.user_id < 1 && strondev.user_id > 0 && neodev.user_id < 1 && ad2460.facilityInProgress == false){
			if(stronfac.user_id < 1){
				showLadyHelper('arcprod');
				return;
			}
		}
		if(indev.user_id < 1 && strondev.user_id < 1 && neodev.user_id > 0 && ad2460.facilityInProgress == false){
			if(neofac.user_id < 1){
				showLadyHelper('primeprod');
				return;
			}
		}
	}

	// Frigate is done, but not Corvette
	var canbuildin = returnGameObjectById(411);
	var canbuildstron = returnGameObjectById(412);
	var canbuildneo = returnGameObjectById(413);
	var cores = returnGameObjectById(108);
	if (((canbuildin.user_id > 0 || canbuildstron.user_id > 0 || canbuildneo.user_id > 0) && ad2460.researchInProgress == false) && cores.user_id != -1 && cores.user_id<1 ){
		showLadyHelper('corv step 1');
		return;
	}

	// Corvette Chassis done, but not CO Dev
	var co_in = returnGameObjectById(408);
	var co_sr = returnGameObjectById(409);
	var co_nd = returnGameObjectById(410);
	var in_dev_station = returnGameObjectById(319);
	var stron_dev_station = returnGameObjectById(322);
	var neo_dev_station = returnGameObjectById(325);
	var co_res=returnGameObjectById(108);
	if (co_in.user_id<1 && co_sr.user_id<1 && co_nd.user_id<1 && ad2460.developmentInProgress == false){
		// We can't build the units
		if (co_res.user_id>0 && co_res.upgrading==0){
			// We did the common research
			if (in_dev_station.user_id>0 && in_dev_station.upgrading==0){
				showLadyHelper('corv step 2');
				return;

			}
			if (stron_dev_station.user_id>0 && stron_dev_station.upgrading==0){
				showLadyHelper('corv step 2');
				return;

			}
			if (neo_dev_station.user_id>0 && neo_dev_station.upgrading==0){
				showLadyHelper('corv step 2');
				return;
			}
		}
	}

	// Mission : Resource Roundup
	var thisMission = returnMissionByMissionId(10);
	if (thisMission != false){
		// Dont show helper if he is already busy with the mission!
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0){
			showLadyHelper('resource roundup');
			return;
		}
	}

	// Mission : The Pirate Vault
	var thisMission = returnMissionByMissionId(13);
	if (thisMission != false){
		// Dont show helper if he is already busy with the mission!
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0){
			showLadyHelper('pirate vault');
			return;
		}
	}

	// Encroachment reminders
	var thisMission = returnMissionByMissionId(66);
	if (myLevel>1 && thisMission.completed_counter < 1 && busyWithMissionID == 0){
		showLadyHelper('encroachment');
		return;
	}

	var thisMission = returnMissionByMissionId(71);
	if (myLevel>2 && thisMission.completed_counter < 1 && busyWithMissionID == 0){
		// We need a check for if it was failed!
		if (thisMission.last_failed_time==0){
			showLadyHelper('encroachment');
			return;
		}
	}

	var thisMission = returnMissionByMissionId(75);
	if (myLevel>2 && thisMission.completed_counter < 1 && busyWithMissionID == 0){
		showLadyHelper('encroachment');
		return;
	}

	// We should remind him to do the commander academy mission pack.
	// mission-ids from 125 to 135
	// can push for 136-128 too if he has a strength of more than 2000
	var thisMission = returnMissionByMissionId(125);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}

	var thisMission = returnMissionByMissionId(126);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}

	var thisMission = returnMissionByMissionId(127);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}

	var thisMission = returnMissionByMissionId(128);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}

	// 4 reminders should be enough..or, hmm...it will skip over to the next pack if we don't do them all...hmm
	var thisMission = returnMissionByMissionId(129);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}
	var thisMission = returnMissionByMissionId(130);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}
	var thisMission = returnMissionByMissionId(131);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}
	var thisMission = returnMissionByMissionId(132);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}
	var thisMission = returnMissionByMissionId(133);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}
	var thisMission = returnMissionByMissionId(134);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}
	var thisMission = returnMissionByMissionId(135);
	if (thisMission != false){
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 2){
			showLadyHelper('commander academy reminder');
			return;
		}
	}




	//Not Started Outpost Business yet
	var thisMission = returnMissionByMissionId(27);
	if (thisMission != false){
		// Dont show helper if he is already busy with the mission!
		if (thisMission.completed_counter < 1 && busyWithMissionID == 0 && myLevel > 1 && isUnitInQueue(430) == false){
			showLadyHelper('outpost business');
			return;
		}
	}

	// Main refinery level 2
	if (ad2460.scores.level==4){
		var fac=returnGameObjectById(368);
		if (fac.user_id<1 && fac.upgrading<1 && ad2460.facilityInProgress==false){
			// We have not built it yet, so it's really about time
				showLadyHelper('upgrade_main_refinery');
				return;
		}
	}

	// Advanced OP
	var op4_dev = returnGameObjectById(233);
	var cargo_eff = returnGameObjectById(109);
	var res_lab_2 = returnGameObjectById(302);
	var mass_volume = returnGameObjectById(111); /* Also needs Tech points*/;
	var dev_lab_2 = returnGameObjectById(317);
	if(op4_dev.user_id < 1 && highestLevelOutpost == 4){
		if(cargo_eff.user_id < 1 && ad2460.researchInProgress == false){
			showLadyHelper('cargo efficiency')
			return;
		}
		if(res_lab_2.user_id < 1 && ad2460.facilityInProgress == false){
			showLadyHelper('research lab 2')
			return;
		}
		if(mass_volume.user_id < 1 && ad2460.researchInProgress == false && res_lab_2.user_id > 0 && res_lab_2.upgrading == 0){
			showLadyHelper('mass volume')
			return;
		}
		if(dev_lab_2.user_id < 1 && ad2460.facilityInProgress == false && res_lab_2.user_id > 0){
			showLadyHelper('dev lab 2')
			return;
		}
	}

	// Late-ish Reminder to do the small level 1 research-labs

	if (ad2460.facilityInProgress==false){
		var intech_res_lab_1=returnGameObjectById(304);
		var strontech_res_lab_1=returnGameObjectById(307);
		var neotech_res_lab_1=returnGameObjectById(310);
		var theory_res_lab_1=returnGameObjectById(313);

		if (theory_res_lab_1.user_id==-1){
			showLadyHelper('upgrade theory res lab 1')
			return;
		}

		if (intech_res_lab_1.user_id==-1 || strontech_res_lab_1.user_id==-1 || neotech_res_lab_1.user_id==-1 ){
			showLadyHelper('upgrade all res lab 1')
			return;
		}



	}

	//Start spending your tech points
	if(unspentTechpoints > 0 && myLevel == 3){
		showLadyHelper('tech points');
		return;
	}

}

function hideHelpCommanderUntilNextLogin(){
	clearInterval(ladyHelperInterval);
	ladyHelperInterval=null;
	denyLadyHelp=true;
	hideHelpCommander();
	hideConfirmationPopup();
}

function hideHelpCommanderFor2Minutes(){
	clearInterval(ladyHelperInterval);
	ladyHelperInterval=null;
	hideHelpCommander();
	hideConfirmationPopup();
	denyLadyHelp=true;
	setTimeout(function(){
		ladyHelperInterval=setInterval(function(){ denyLadyHelp=false;ladyHelperMain(); }, 1000*60*0.2);
	},120000);
}



function hideHelpCommanderAsk(){
	showConfirmationPopup("I am here to help new players onto the right path in AD2460. You might not want to turn me off completely, but the choice is yours. Would you like me to go away until your next login, or just for 2 minutes?<br><br>A third option is clicking <span style='color:yellow;cursor:pointer;' onclick='hideHelperLadyForever()'>HERE</span> to get rid of me forever on this device!", 'Until login', '2 minutes', 'hideHelpCommanderUntilNextLogin();', 'hideConfirmationPopup();hideHelpCommanderFor2Minutes();', false, false);

}

function hideHelperLadyForever(){
	ladyHelperInterval=null;
	hideHelpCommander();
	denyLadyHelp=true;
	SetCookie('helperHiddenForever','true',document.location.hostname,30);
	hideConfirmationPopup();
}

function showLadyHelper(id){
	// fill in the text required for the lady
	// then call some show-function
	var i=0;

	for (i=0;i<ad2460.openSlides.length ;i++ ){
		if (ad2460.openSlides[i]=='techtreeslide'){
			return;
		}
		if (ad2460.openSlides[i]=='missionslide'){
			return;
		}

	}

	for (i=0;i<ad2460.newLadyHelperData.length ;i++ ){
		if (ad2460.newLadyHelperData[i].id==id){
			$("#help_comm_text").html(ad2460.newLadyHelperData[i].body);
			$("#help_comm_head").html(ad2460.newLadyHelperData[i].header);
			$("#help_comm_text").append("<div class='slide_closer helper_close' id='helper_close' title='You can always hit ESC to close me temporarily!'></div>");

			//ladyhelperVars.lastMsgId=id;
			//ladyhelperVars.lastMsgTime=ad2460.serverTime;

			$("#helper_close").click(function(){
				//hideHelpCommander();
				hideHelpCommanderAsk();
			});
			showHelpCommander();
			return;
		}
	}
}

ad2460.newLadyHelperData.push({
id:'hassium refinery',
header:'You need a Hassium refinery.',
body:"<p>Hello, and welcome. I will be guiding you through the first steps of the game to get you started, and give you some advice now and then. You'll be managing fine without me in a very short time. But for now, it is beneficial to follow the advice that I provide.<p>In order to increase our resources, you need to upgrade the Hassium refinery on our homeworld. This will increase our output significantly. This is very important in order to develop our planets infrastructure, research new technology, develop new vessels and create ships and other important structures you need in the game.</p>"
	+"<p><span class='clicklink'>Click on the 'Facilities'-panel</span> to open it. Then <span class='clicklink'>click  the 'Refinery'</span> in the bottom left listing. Now <span class='clicklink'>select the 'Hassium Refinery'</span> from the bottom right view, and then <span class='clicklink'>click 'Build'</span> in the top-right part of the panel.</p>"
});

ad2460.newLadyHelperData.push({
id:'improved gunnery',
header:'You need to initiate some research.',
body:"<p>Our scientists have told me they can look into improving resource-extraction on our homeworld. By researching 'Improved Homeworld Mining' we can increase the output of all refineries. <span class='clicklink'>Click on the 'Research'-panel</span> to open it. <span class='clicklink'>Select the first icon</span> in the bottom left listing, and then <span class='clicklink'>click 'Order'</span> in the top right part of the panel.</p>"
+"<p><span class='directlink' onclick='specialProcessOpenPanel(&quot;research&quot;,101,event);return false;''>Click here to open the panel directly</span></p>"
});

ad2460.newLadyHelperData.push({
id:'develop basic op',
header:'Outposts are essential to progression.',
body:"<p>We cannot sustain our development on the resources our homeworld produces alone. You need to gather resources from other planets. Start developing a basic outpost to mine other planets. Development of a unit is required before it can be produced.</p>"
+"<p><span class='clicklink'>Click on the 'Development'-panel</span>. Once it opens, <span class='clicklink'>select 'basic outpost'</span> from the list, and then <span class='clicklink'>click 'Order'</span> to start the development of the outpost.</p>"
+"<p><span class='directlink' onclick='specialProcessOpenPanel(&quot;development&quot;,232,event);return false;''>Click here to open the panel directly</span></p>"
+"<p>Once the development is complete, you can start producing your basic outpost.</p>"
});

ad2460.newLadyHelperData.push({
id:'produce prospector',
header:'Probing the planets for resources.',
body:"<p>You need more resources. In order to secure them, you need to find out what the planets in our local cluster of solar systems is capable of delivering. To do this, you need to produce a prospector unit. This unit will visit each of the planets in a cluster of solar systems and place a probe on them that sends information about the potential resource output of each. Once this is done, I will guide you further.</p>"
+"<p>Before we can start prospecting, you need to build a prospector. <span class='clicklink'>Open your 'Production'-panel</span> and <span class='clicklink'>select the prospector unit</span>, then <span class='clicklink'>click 'Order'</span>. Alternatively, <span class='directlink' onclick='specialProcessOpenPanel(&quot;production&quot;,431,event);return false;''>click here to open the panel directly</span>.</p>"
});


ad2460.newLadyHelperData.push({
id:'prospect home cluster',
header:'Prospect your home cluster.',
body:"<p>Your home cluster is the set of solar systems in your immediate vicinity. It is essential that you become familiar with this one first. It is time to use the prospector.</p>"
+"<p>Open the starmap  by <span class='clicklink'>clicking 'Starmap'</span> in the top left menu. To find your own planet, <span class='clicklink'>click the 'Home'-icon</span> beneath the visual map.</p>"
+"<p>You will need to prospect the cluster by <span class='clicklink'>clicking the 'Prospect Now'-button</span> in the lower left corner of the solar system view. Notice that you will prospect the other 15 solar systems nearby by doing this. There are 16 solar systems in a cluster.</p>"
});

ad2460.newLadyHelperData.push({
id:'produce_more_prospectors',
header:'Produce more prospectors',
body:"<p>With every cluster we prospect, we get a wider rane of outposts to choose from.</p>"
+"<p>Before we can prospect another cluster, you need to build a prospector. <span class='clicklink'>Open your 'Production'-panel</span> and <span class='clicklink'>select the prospector unit</span>, then <span class='clicklink'>click 'Build'</span>. Alternatively, <span class='directlink' onclick='specialProcessOpenPanel(&quot;production&quot;,431,event);return false;''>click here to open the panel directly</span>.</p>"
});

ad2460.newLadyHelperData.push({
id:'prospect_entre_sector',
header:'Prospect 16 clusters (1 sector)',
body:"<p>To be able to find more and better outposts close to home, it is a good idea to prospect all 16 clusters in your sector.</p>"
+"<p>You do have available prospecting ships awaiting your orders. Click <span style='color:yellow;cursor:pointer;' onclick='zoomInTo(ad2460.homeworld.quadrant, ad2460.homeworld.sector);'>HERE</span> to go to the starmap sector-view and notice the small radar-like icons in the corners showing you which clusters you have prosepcted and which you have not. Then enter one cluster, and click 'Prospect Now.'</p>"
});

ad2460.newLadyHelperData.push({
id:'produce op-unit',
header:"You need to mine other planets.",
body:"<p>It is essential for our continued progress that you gather more resources. You can now produce a Basic Outpost to mine planets, so you should order it immediately. Start with one, so you have some resources to spare for other important tasks as well. <span class='clicklink'>Click your 'Production'-panel</span></p>"
+"<p><span class='directlink' onclick='specialProcessOpenPanel(&quot;production&quot;,438,event);return false;''>Click here to open the panel directly</span></p>"
+"<p>You can find the outpost-unit at the very bottom of the list, so you might need to scroll down.</p>"
+"<p>Once the basic outpost has been produced, you can place it in orbit around a resource planet. Your prospecting ship will already have placed probes on the local planets to let you choose a good one.</p>"
});

ad2460.newLadyHelperData.push({
id:'deploy outpost',
header:'You have not deployed your basic outpost.',
body:"<p>The basic outpost does not produce any resources unless it is deployed to another planet. Your prospector has now completed its task of mapping out the local planets, and you can read the report to find a suitable planet to deploy your outpost to. Once deployed, the outpost will immediately start producing resources for you.</p>"
+"<p><span class='directlink' onclick='zoomInTo(ad2460.homeworld.quadrant, ad2460.homeworld.sector, ad2460.homeworld.cluster);fetchProspectingReport(ad2460.homeworld.quadrant, ad2460.homeworld.sector, ad2460.homeworld.cluster);return false;''>Click here to open your first prospecting report.</span></p>"
+"<p>In the list that opens, find a planet that is listed as 'Even', with a good potential (pot). 10/ 10 is the best. You also need to make sure that it doesn't already have an owner. Once you find one, <span class='clicklink'>click on the blue planet name</span>, and you will be taken directly to the planet.</p>"
+"<p>On the right side, where the large image of the planet is, <span class='clicklink'>click on 'Claim Planet'</span>. This brings up the outpost deployment panel. <span class='clicklink'>Click on 'Basic Outpost(1)'</span>, and your outpost will be deployed. It will now gather resources for you.</p>"
});

ad2460.newLadyHelperData.push({
id:'dont have max outposts',
header:"You can mine more planets.",
body:"<p>There are still planets out there that you can mine, and you still have capacity for holding more planets. You should start producing more basic outpost units and claim some more planets. You should always make sure you have the maximum allowable planets producing resources for you.</p><p><span class='directlink' onclick='specialProcessOpenPanel(&quot;production&quot;,438,event);return false;''>Click here to open the production-panel.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'unused outpost units',
header:"You've got basic outposts that have not been deployed.",
body:"<p>One or more basic outposts are sitting in orbit around our homeworld, and you have not claimed the maximum amount of planets for your level at this time. The units are ready, so you should really find locations for the units to start producing resources.</p>"
+"<p>Hassium is the resource you are currently spending the most of, but later on you will most likely focus on one of the resources connected to a tech specialisation. For now, you should try to find planets that are 'Even' in their output, or of you are feeling confident, you can add one that produces more hassium 'Hs'.</p>"
+"<p><span class='directlink' onclick='zoomInTo(ad2460.homeworld.quadrant, ad2460.homeworld.sector, ad2460.homeworld.cluster);fetchProspectingReport(ad2460.homeworld.quadrant, ad2460.homeworld.sector, ad2460.homeworld.cluster);return false;''>Click here to open your prospecting report.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'develop scout',
header:"You need more eyes on the galaxy.",
body:"<p>Scout ships are important. They allow us to get a glimpse of what is out there. It can be used for scout-missions, and to discover basic information about other players. You have not yet developed the design needed to produce this unit, so you need you to initiate the development.</p><p><span class='clicklink'>Open the 'Development'-panel</span> and <span class='clicklink'>select the 'Scout Ship Design'</span>, then <span class='clicklink'>'order' the development</span>."
+"<p><span class='directlink' onclick='specialProcessOpenPanel(&quot;development&quot;,238,event);return false;''>Click here to open the panel directly</span></p>"
+"<p>Once the scout is ready, there is a mission available where the unit is needed.</p>"
});

ad2460.newLadyHelperData.push({
id:'recruit commander',
header:"Recruit a Commander.",
body:"<p>Your base fleet, the one protecting out homeworld is led by a commander, but in order to perform battle-missions and initiate attacks on other planet, you need more commanders.</p><p>In order to get more commanders, you need to recruit them from the officer academy. Open your <span class='directlink' onclick='specialProcessOpenPanel(&quot;commanders&quot;,0,event);return false;''>'Commanders'-panel</span> in the 'Military'-section. At the bottom of the list of available commanders, you will be able to access possible recruits. Pick one and recruit one. This will allow you to create a mobile fleet.</p>"
+"<p>You are now preparing for your first battle. Keep going.</p>"
});

ad2460.newLadyHelperData.push({
id:'create fleet',
header:"Create A Mobile Fleet.",
body:"<p>It seems that you have enough commanders to set up an additional fleet. Since you currently only have the base fleet, it will be impossible to do much without a mobile fleet. The base fleet is permanently located at your homeworld. In order to do missions or perform attacks, you need a fleet that can move.</p>"
+"<p>At the bottom of the fleet list in the 'Fleet Management'-Panel in the 'Military'-section, you can create a new fleet. <span class='clicklink'>Click on the 'Create New Fleet'-button</span>. This takes one of the available commanders, assigns him or her to the fleet. You now have a fleet to put some ships in.</p>"
+"<p><span class='directlink' onclick='specialProcessOpenPanel(&quot;fleet_management&quot;,0,event);return false;''>Click here to open the panel directly.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'move ships',
header:"Moving Ships",
body:"<p>Before a mobile fleet can be of any use, it needs to have some ships in it. Open your <span class='directlink' onclick='specialProcessOpenPanel(&quot;fleet_management&quot;,0,event);return false;''>'Fleet Management'-panel</span>.</p>"
+"<p><span class='clicklink'>Select your base fleet</span> from the list, and then <span class='clicklink'>click on 'Move Ships'</span> in the top right section. The orange help-boxes on top of the ship move panel will guide you through the next steps.</p>"
+"<p><span class='clicklink'>Make sure you move ALL your light frigates into the mobile fleet.</span>"
});

ad2460.newLadyHelperData.push({
id:'border patrol',
header:"Prepare Border Patrol.",
body:"<p>It's time to patrol the territory around your homeworld. Space is a big place, and there's always something lurking out there. At least it's healthy to assume as much. Click on the '<span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();'>Missions</span>'-button (top left), and then <span class='clicklink'>select the mission pack named 'Encroachment'</span>. Once you get the missions list for this pack, you <span class='clicklink'>select 'Border Patrol'</span>. Take a little time to read the description before clicking on 'Prepare'. The description should give you enough information about how to initiate.</p>"
+"<p>You should also make sure to check out the information contained in the help section for missions. <span class='clicklink'>Click on the orange '?'-button</span> to access it.</p>"
/*+"<p>Missions are single-player. You will not have to fight other players through missions. They provide an excellent source of experience points and resources to help you gain levels and become more proficient in the game.</p>"*/
});

ad2460.newLadyHelperData.push({
id:'missing frig no scout',
header:"Build A scout ship.",
body:"<p>Now that the development of the scout unit is complete, you should build one. It will no doubt come in handy very soon.</p>"
+"<p>Initially, you will be using the scout ship to complete scouting missions in the missions section. Later, you will  be using the scouts to investigate the strength and composition of fleets owned by other players in the game. It is always handy to have a few scout ships available at all times.</p>"
+"<p><span class='clicklink'>Open your 'Production'-panel</span> to build the scout.</p>"
});

ad2460.newLadyHelperData.push({
id:'the missing frigate',
header:"The Missing Frigate",
body:"<p>Well done taking care of the Border Patrol mission. Your help is once again needed, and this time in the mission-pack called 'The First Steps' which contains 7 different missions. The first mission requires a scout ship, so if do not have one available right now, you should produce it.</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(1);selectMission(1);'>Click here to go directly to the mission when you are ready.</span></p>"
+"<div>Then <span class='clicklink'>click PREPARE</span>.</div>"
});

ad2460.newLadyHelperData.push({
id:'intelligence branch',
header:"We need some spies.",
body:"<p>Spies are used for several tasks. Like all spies, their prime function is to gather information to allow you to make good decisions. Initially, you can use them to complete espionage missions. Later on you will need them to gather information about other players. They can also work counter-intelligence, seeking out possible spies and infiltrators from other players that are active on your homeworld.</p>In order to gain access to spies, <span class='clicklink'>open the 'Facilities'-panel</span>, <span class='clicklink'>click the 'Diplomatic Office'-facility</span>, and <span class='clicklink'>select the 'Intelligence Branch'-addon</span>. Once selected, you can <span class='clicklink'>click the 'Build'-button</span>."
});

ad2460.newLadyHelperData.push({
id:'develop transport',
header:"Transportation",
body:"<p>In order to transport resources back to your homeworld after a combat, you need something to transport them. We will need to develop some blueprints for the most basic transport-ship to get started. It will also be essential in one of your next missions.</p>"
+"<p><span class='clicklink'>Open the 'Development'-panel</span by clicking on it. <span class='clicklink'>Click on the 'small transport design'</span>, then <span class='clicklink'>click 'Order'</span>.</p>"
+"<p><span class='directlink' onclick='specialProcessOpenPanel(&quot;development&quot;,239,event);return false;''>Click here to open the panel directly</span> and <span class='clicklink'>click 'Order'</span> to start developing the design.</p>"
});

ad2460.newLadyHelperData.push({
id:'the retrieval',
header:"The Retrieval",
body:"<p>As soon as you have completed the Intelligence Branch, you can use spies. We need to continue to find our missing frigate!</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(1);selectMission(9);'>Click here to go directly to the mission when you are ready.</span></p>"
+"<div>Then <span class='clicklink'>click 'Prepare'</span>.</div>"
});

ad2460.newLadyHelperData.push({
id:'upgrade an outpost',
header:"Upgrade your outpost.",
body:"<p>In order to get more resources faster, you should try upgrading one of your outposts to level 2. This will increase the output of the outposts, and secure resources at a higher rate than before.</p>"
+"<p><span class='directlink' onclick='$(&quot;#outpostsbutton&quot;).click();return false;'>Click here to go to the 'Outposts'-section.</span> Select your outpost by <span class='clicklink'>clicking on the name</span>. This will open the panel for that outpost. Now <span class='clicklink'>click on the 'Upgrade'-button</span> in the top right part of the panel. You can upgrade as many outposts as you want at the same time.</p>"
+"<p>You can upgrade any of your outposts up to level 4 without the need for any further developments. This will be very beneficial, and is always worth the investment.</p>"
+"<p>To upgrade an outpost beyond level 4, you will need to develop the advanced outpost. You do not need to start this just yet.</p>"
});

ad2460.newLadyHelperData.push({
id:'upgrade an outpost to level 4',
header:"Upgrade all outposts to level 4.",
body:"<p>In order to get more resources faster, you should try upgrading all of your outposts to level 4. This will increase the output of the outposts, and secure resources at a higher rate than before.</p>"
+"<p><span class='directlink' onclick='$(&quot;#outpostsbutton&quot;).click();return false;'>Click here to go to the 'Outposts'-section.</span> Select your outpost by <span class='clicklink'>clicking on the name</span>. This will open the panel for that outpost. Now <span class='clicklink'>click on the 'Upgrade'-button</span> in the top right part of the panel. You can upgrade as many outposts as you want at the same time.</p>"
+"<p>You can upgrade any of your outposts up to level 4 without the need for any further developments. To upgrade an outpost beyond level 4, you will need to develop the advanced outpost. You do not need to start this just yet.</p>"
});



ad2460.newLadyHelperData.push({
id:'indium refinery',
header:"Indium Refinery Addon",
body:"<p>Our homeworld is still able to produce more resources. If you upgrade the indium refinery addon, you can increase the output of the homeworld. This is a good thing, since the amount of resources you gain from your homeworld will never diminish. It's a good investment at this point.</p>"
+"<p>Indium is the primary resource used by those who wish to build InTech ships and specialise in that technology.</p>"
+"<p><span class='clicklink'>Click on the 'Facilities'-panel</span> in the 'Homeworld'-section. Then <span class='clicklink'>click  the 'Refinery'</span> in the bottom left listing. Now <span class='clicklink'>select the 'Indium Refinery'</span> from the bottom right view, and then <span class='clicklink'>click 'Build'</span> in the top-right part of the panel.</p>"
+"<p>We also recommend that you continue by upgrading the strontium and neodymium refineries as well.</p>"
});

ad2460.newLadyHelperData.push({
id:'strontium refinery',
header:"Strontium refinery addon",
body:"<p>Even if resources from the outposts are coming in, it's always a good idea to have a good production on your homeworld as well. You should start the construction of the strontium refinery addon now. Strontium is the most important resource for those who build StronTech ships and specialise in that technology-branch.</p>"
+"<p><span class='clicklink'>Click on the 'Facilities'-panel</span> in the 'Homeworld'-section. Then <span class='clicklink'>click  the 'Refinery'</span> in the bottom left listing. Now <span class='clicklink'>select the 'Strontium Refinery'</span> from the bottom right view, and then <span class='clicklink'>click 'Build'</span> in the top-right part of the panel.</p>"
});

ad2460.newLadyHelperData.push({
id:'neodymium refinery',
header:"A complete set of refineries.",
body:"<p>Only one more refinery, and you will have increased all your resource income from your homeworld. If you wish to create NeoTech ships, then is will be important to make sure that you are gathering a lot of neodymium, since this is the primary resource for that technology.</p>"
+"<p><span class='clicklink'>Click on the 'Facilities'-panel</span> in the 'Homeworld'-section. Then <span class='clicklink'>click  the 'Refinery'</span> in the bottom left listing. Now <span class='clicklink'>select the 'Neodymium Refinery'</span> from the bottom right view, and then <span class='clicklink'>click 'Build'</span> in the top-right part of the panel.</p>"
+"<p>To upgrade the add-ons further, you will need the main facility at level 2.</p>"
});

ad2460.newLadyHelperData.push({
id:'advanced propulsion control',
header:"Keep up the research.",
body:"<p>Making sure that the most basic researches are being done is important. These lay the foundation for a lot of the more advanced researches. Some facilities and developments depend on research being complete in order to initiate them.</p>"
+"<p>You should start the <span class='directlink' onclick='specialProcessOpenPanel(&quot;research&quot;,102,event);return false;''>Construction Efficiency</span> research at this point. It will reduce costs on all facilities you will build later.</p>"
});

ad2460.newLadyHelperData.push({
id:'structural integrity',
header:"Research Efficiency",
body:"<p>Researches benefit your entire civilisation, and you should keep doing the researches available whenever you can. The <span class='directlink' onclick='specialProcessOpenPanel(&quot;research&quot;,103,event);return false;''>Research Efficiency</span> research will allow you to research faster. There will be time-consuming research-projects coming, so any way to make them faster will be very useful.</p>"
+"<p><span class='clicklink'>Click on the 'Research'-panel</span> in the 'Homeworld'-section to access your available researches.</p>"
});

ad2460.newLadyHelperData.push({
id:'shield projection',
header:"Development Efficiency",
body:"<p>Development-projects are vital to our technological advancement. These projects can be expensive, but our scientists belive they can find ways to cut costs. Please initiate the <span class='directlink' onclick='specialProcessOpenPanel(&quot;research&quot;,104,event);return false;''>Development Efficiency</span> research.</p>"
});

ad2460.newLadyHelperData.push({
id:'hassium stacking',
header:"Improved Hassium Storage",
body:"<p>Hassium is always going to be a resource you will need. If you are away from your homeworld for some time, the incoming resources will start adding up, and we may even fill up to our current maximum capacity.</p>"
+"<p>In order to make sure we can store more resources you should complete the <span class='directlink' onclick='specialProcessOpenPanel(&quot;research&quot;,106,event);return false;''>Hassium Stack Storage</span> research.</p>"
+"<p><span class='clicklink'>Click on the 'Research'-panel</span> in the 'Homeworld'-section to access your available researches.</p>"
});

ad2460.newLadyHelperData.push({
id:'friendly chat',
header:"First Steps: A Friendly Chat.",
body:"<p>You are currently in the middle of a mission pack. You should make sure you complete all the missions in this pack. It will make sure you gains valuable XP, and also secure a lot of resources for your continued development.</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(1);selectMission(2);'>Click here to go directly to the mission when you are ready.</span></p>"
+"<p>For this mission you will need to have an unassigned commander available (a commander not assigned to a fleet).</p>"
});

ad2460.newLadyHelperData.push({
id:'complicated',
header:"First Steps: It's Complicated",
body:"<p>You are currently in the middle of a mission pack. You should make sure you complete all the missions in this pack. It will make sure you gains valuable XP, and also secure a lot of resources for your continued development.</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(1);selectMission(3);'>Click here to go directly to the mission when you are ready.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'more prospectors',
header:"Further prospecting.",
body:"<p>We've mapped out our local cluster for good planets, but you should keep prospecting the clusters in our local sector. A sector consists of 16 clusters. If you prospect your entire sector, you will have a very good selection of planets to choose from once your maximum allowed outposts increases.</p><p>The prospectors are also sometimes needed for the completion of single-player missions, so it is a good idea to always have some on hand for this purpose.</p><p><span class='directlink' onclick='specialProcessOpenPanel(&quot;production&quot;,431,event);return false;''>Click here to open the 'Production'-panel directly</span>.</p>"
});

ad2460.newLadyHelperData.push({
id:'expanding search',
header:"First Steps: Expanding the Search",
body:"<p>You are currently in the middle of a mission pack. You should make sure you complete all the missions in this pack. It will make sure you gains valuable XP, and also secure a lot of resources for your continued development.</p>"
+"<p>This next mission will require a Prospector-unit, so produce one if you don't have any.</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(1);selectMission(4);'>Click here to go directly to the mission</span> when you are ready.</p>"
});

ad2460.newLadyHelperData.push({
id:'resource roundup',
header:"First Steps: Resource Round-up",
body:"<p>The next mission is a combat mission. This mission will require a small transport ship. If you do not already have one produced, you should build it.</p><p>You should read the mission description first, and then set up a fleet in the 'Fleet Management'-section in order to initiate it. It is probably best not to only bring the minimum required strength. You will lose less of your own ships if you bring more strength.</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(1);selectMission(10);'>Click here to go directly to the mission.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'pirate vault',
header:"First Steps: The Pirate Vault",
body:"<p>The next mission is a combat mission and the last mission in this pack. You should read the mission description first, and then set up a fleet in the 'Fleet Management'-section in order to initiate it. It is probably best not to only bring the minimum required strength. You will lose less of your own ships if you bring more strength.</p><p>Some of your ships might be injured from the previous mission. Repairs happen automatically every 15 minutes, so you might wish to wait until your ships are fully repaired.</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(1);selectMission(13);'>Click here to go directly to the mission.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'join alliance',
header:"Alliances.",
body:"<p>There are a number of alliances in the galaxy. It can be very beneficial to join an alliance. Members of an alliance often take great pride in helping other members out. As part of an alliance, you can access a resource market to trade resources that you have a surplus of for the types you really need. You gain access to a separate alliance chat channel, and you also get to know a lot of people a lot better in an alliance.</p>"
	+"<p>Since you are not part of an alliance yet, you can ask in the chat if anyone is recruiting members, or you can check out the Alliance Recruitment section in the forums. <span onclick='forumClick(9)'>Click here</span> to view the alliance recruitment forum.</p>"
});

ad2460.newLadyHelperData.push({
id:'frigstart',
header:"There are better frigates to be built.",
body:"<p>Although the light frigate is a nice ship, you really should consider working on the development of one of the better tech-frigates. InTech, StronTech and NeoTech frigates offer considerably better performance on the battlefield. It is also a very simple process to acquire one.</p>"
	+"<p>By initiating one of the tech-addons in the development facility, you will gain access to the development for the frigate corresponding to the chosen tech. You will also gain access to develop your first Defensive Unit, which is excellent at defending your Outposts.</p>"
	+"<p><span class='clicklink'>Click on the 'Facilities'-panel</span> in the 'Homeworld'-section. Then <span class='clicklink'>click  the 'Dev-Station'</span> in the bottom left listing. In the bottom right view, select between the Intech, StronTech and NeoTech addon facility. <span class='clicklink'>Click on InTech, StronTech or Neotech development station</span> and then <span class='clicklink'>click 'Build'</span>.</p>"
});

ad2460.newLadyHelperData.push({
id:'develop turret',
header:"Defensive Units",
body:"<p>Defensive units are cheaper and faster to produce than ships. They do not have a jump-engine, and only a basic set of maneuvering thrusters. They are as such well suited to defend both your outposts and your homeworld.</p>"
	+"<p>You can now develop the plans for your first defensive unit.</p>"
	+"<p><span class='clicklink'>Click on the 'Development'-panel</span> in the 'Homeworld'-section. Find the appropriate turret development, and initiaite it.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'produce turret',
header:"Defensive Turret Production",
body:"<p>Turrets / Cannons are the smallest of the defensive units. They are cheap and can be built quickly. In the early stages of the game, you will want some on your outposts to protect them.</p>"
	+"<p>Open the Production-panel and order one.</p>"
});

ad2460.newLadyHelperData.push({
id:'move turret to op fleet',
header:"Move one or more defensive units to defend an outpost",
body:"<p>You must now move one of your newly built defensive units to an outpost defense-fleet. Please navigate to MILITARY and open the FLEET MANAGEMENT panel. Then select your Base Fleet.</p>"
	+"<ul><li>Then click the button MOVE SHIPS and click on the Turret / Cannon you wish to move.</li>"
	+"<li>In the second column, in the first Dropdown-menu, select Outpost Defense.</li>"
	+"<li>In the second dropdown-menu, you can select any of the outposts listed there.</li>"
	+"<li>Then click on as many of the unit-boxes below the % / All / None as you wish, and click Add Move-Order.</li>"
	+"<li>Finalize this by clicking the MOVE UNITS button in the third column.</li></ul>"
});


ad2460.newLadyHelperData.push({
id:'outriderdev',
header:"The Outrider Frigate is ready for Development.",
body:"<p>You've now upgraded the InTech development facility. This facility specialises in the creation of designs for InTech. The first design is now available in your development panel. This is the Outrider. I think you will find that this ship is an excellent replacement for the light frigate.</p>"
	+"<p>You should initiate the development immediately. You can <span class='directlink' onclick='specialProcessOpenPanel(&quot;development&quot;,235,event);return false;''>find the Outrider development here.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'arcdev',
header:"The Arc Frigate is ready for Development.",
body:"<p>You've now upgraded the StronTech development facility. This facility specialises in the creation of designs for StronTech. The first design is now available in your development panel. This is the Arc. I think you will find that this ship is an excellent replacement for the light frigate.</p>"
	+"<p>You should initiate the development immediately. You can <span class='directlink' onclick='specialProcessOpenPanel(&quot;development&quot;,236,event);return false;''>find the Arc development here.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'primedev',
header:"The Prime Frigate is ready for Development.",
body:"<p>You've now upgraded the NeoTech development facility. This facility specialises in the creation of designs for NeoTech. The first design is now available in your development panel. This is the Prime. I think you will find that this ship is an excellent replacement for the light frigate.</p>"
	+"<p>You should initiate the development immediately. You can <span class='directlink' onclick='specialProcessOpenPanel(&quot;development&quot;,237,event);return false;''>find the Prime development here.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'outriderprod',
header:"The Outrider and the Projectile Cannon will both need a production facility.",
body:"<p>The Outrider and the Projectile Cannon need a special InTech production facility to be constructed. In order to produce any InTech units, you need this facility. It has been specially set up to meet the requirements for the InTech units. Once this is complete, as well as the development-projects for the Intech Frigate or Intech Turret, these new units will be ready for production.</p>"
+"<p><span class='clicklink'>Open the Facilities-panel, select the Prod-Facility, and then click on the corresponding facility-addon. Then click Build.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'arcprod',
header:"The Arc frigate and the Plasma Cannon will both need a production facility.",
body:"<p>The Arc and the Plasma Cannon need a special StronTech production facility to be constructed. In order to produce any StronTech units, you need this facility. It has been specially set up to meet the requirements for the StronTech units. Once this is complete, as well as the development-projects for the StronTech Frigate or StronTech Turret, these new units will be ready for production.</p>"
+"<p><span class='clicklink'>Open the Facilities-panel, select the Prod-Facility, and then click on the corresponding facility-addon. Then click Build.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'primeprod',
header:"The Prime frigate and the Ion Cannon will both need a production facility.",
body:"<p>The Prime and the Ion Cannon need a special NeoTech production facility to be constructed. In order to produce any NeoTech units, you need this facility. It has been specially set up to meet the requirements for the NeoTech units. Once this is complete, as well as the development-projects for the NeoTech Frigate or NeoTech Turret, these new units will be ready for production.</p>"
+"<p><span class='clicklink'>Open the Facilities-panel, select the Prod-Facility, and then click on the corresponding facility-addon. Then click Build.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'upgrade_main_refinery',
header:"Upgrade your main Refinery facility",
body:"<p>Your economy is growing, but it could be even better. Your main refinery is ready to be upgraded</p>"
+"<p><span class='clicklink'>Open the Facilities-panel, select the Refinery, and click Upgrade.</span></p>"
});


ad2460.newLadyHelperData.push({
id:'corv step 1',
header:"Frigates and corvettes are a good combination.",
body:"<p>You've now got access to a tech frigate. This is excellent. It will serve you very well in the future. However, you can improve further upon the efficiency of the frigate. It can carry with it a wing of minor ships (a collective term for both fighter and corvette-class ships). These are very small, and are shown as either triangles (fighters) or squares(corvettes) on the battlefield.</p>"
	+"<p>By combining a frigate with a corvette, you can get much more destructive power into your fleet. Corvettes always shoot at their nearest target, and are also good for creating split targeting priorities, where your frigates can focus on one type of ship, while the corvettes turn their attention to the closest ones.</p>"
	+"<p>You will need to complete the research <span class='directlink' onclick='specialProcessOpenPanel(&quot;research&quot;,108,event);return false;''>Advanced Fighter Chassis</span>. Once that is complete, you can then develop the corvette.</p>"
});

ad2460.newLadyHelperData.push({
id:'corv step 2',
header:"You are now ready to develop your corvette.",
body:"<p>Depending on which development station addon you upgraded, you will now have access to the development of the corvette for that particular tech. You should start the development right away. Corvettes will never become obsolete in your fleets.</p>"
});

ad2460.newLadyHelperData.push({
id:'cargo efficiency',
header:"Advanced Outpost: Cargo Efficiency Research.",
body:"<p>You are doing well on upgrading your outposts. Level 4 is the final improvement we can do before we reach the limits of our current capabilities. You should now start the initial research for the next version of the outpost, the advanced outpost.</p>"
+"<p>The first step is to make sure that we have reseached <span class='directlink' onclick='specialProcessOpenPanel(&quot;research&quot;,109,event);return false;''>cargo efficiency</span>. Once that is complete, I will guide you further.</p>"
});

ad2460.newLadyHelperData.push({
id:'research lab 2',
header:"Advanced Outpost: Research Lab Level 2.",
body:"<p>We have more research to do to complete the preparations for the construction of the advanced outpost. However, you need to upgrade the main research facility to level 2 in order to carry out more advanced researches.</p>"
+"<p><span class='clicklink'>Click on the 'Facilities'-panel</span> in the 'Homeworld'-section. Then <span class='clicklink'>click  the 'Research Lab'</span> in the bottom left listing. The main facility will now automatically be selected. <span class='clicklink'>Click 'Upgrade'</span> in the top-right part of the panel.</p>"
});

ad2460.newLadyHelperData.push({
id:'mass volume',
header:"Advanced Outpost: Mass Volume Dynamics Research.",
body:"<p>There are still a few more things we need to complete in oder to enable the development of the advanced outpost. You need to finish the research <span class='directlink' onclick='specialProcessOpenPanel(&quot;research&quot;,111,event);return false;''>Mass Volume Dynamics</span>. This research is also required in order to develop the large transport vessel. This will become useful when trying to steal resources from other players later in the game.</p>"
});

ad2460.newLadyHelperData.push({
id:'dev lab 2',
header:"Advanced Outpost: Development Station Level 2.",
body:"<p>The final step towards initiating the advanced outpost is upgrading our development station. At its current level, it is unable to support the type of development structure we need to initiate the project. Once the upgrade is done, we will have all the development capabilities in place.</p>"
+"<p><span class='clicklink'>Click on the 'Facilities'-panel</span> in the 'Homeworld'-section. Then <span class='clicklink'>click  the 'Dev-Station'</span> in the bottom left listing. The main facility will now automatically be selected. <span class='clicklink'>Click 'Build'</span> in the top-right part of the panel, and the upgrade will be in progress.</p>"
});


ad2460.newLadyHelperData.push({
id:'commander academy reminder',
header:"There are more missions available for you.",
body:"<p>Our commanders need more experience..</p>"
+"<p>Please proceed with the missions waiting in the Commander Academy.</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(18);'>Click here to go directly to the mission pack.</span></p>"
});



ad2460.newLadyHelperData.push({
id:'outpost business',
header:"There are more missions available for you.",
body:"<p>Our outposts are being harassed, and you really should take a closer look at what's happening out there...</p>"
+"<p>This mission requires a couple of Scout-ships so make sure you have some! I recommend using as many as 4.</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(6);'>Click here to go directly to the mission pack.</span></p>"
});



ad2460.newLadyHelperData.push({
id:'testing technologies',
header:"There are more missions available for you.",
body:"<p>There are three known technological specialisations in the galaxy. Our current knowledge does not allow for a very good combination of these. They all have their strengths and weaknesses.</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(11);'>Click here to go directly to the mission pack.</span></p>"
});


ad2460.newLadyHelperData.push({
id:'upgrade theory res lab 1',
header:"Upgrade your Theory Research Lab",
body:"<p>You should consider building the first Theory Research Lab facility-addon, as it will allow you to initialize more researches. These researches are not directly related to any one tech, but can be a required component for some of them.</p>"
+"<p>The new researches include items such as <span class='nicklink' onclick='showGameInfoBox(182,event)'>Development Efficiency II</span> and <span class='nicklink' onclick='showGameInfoBox(183,event)'>Infrastructure Improvement</span></p>"
});

ad2460.newLadyHelperData.push({
id:'upgrade all res lab 1',
header:"Upgrade your Research Labs",
body:"<p>You should consider building the first level of all 3 tech-based Research Labs, as they are both cheap, fast and open up new research that may be relevant to you. In the future, you may want to change which technology you specialise in, and having these labs ready at that point will save you a bit of time and resources as well.</p>"
+"<p><span class='clicklink'>Click on the 'Facilities'-panel</span> in the 'Homeworld'-section. Then <span class='clicklink'>click  the 'Research Lab'</span> in the bottom left listing. You can now <span class='clicklink'>select the relevant addon lab</span> to upgrade.</p>"
});

ad2460.newLadyHelperData.push({
id:'tech points',
header:"You have unspent Tech Points",
body:"<p>At this point it will be important to learn how to use tech points to gain bonuses for your ships and start finding out what kind of specialisation you would like to have initially. You have some tech points that you have gained from completing missions and other tasks within the game. You should consider spending those points at this point.</p>"
+"<p>Use the '?'-buttons to get more informaiton, and look at the list of actions that award tech points as well. Don't worry too much about your inital distribution of points. You can reset them for free while you are under level 8.</p>"
+"<p><span class='directlink' onclick='$(&quot;#techtreebutton&quot;).click();'>Click here to go directly to the tech tree</span>.</p>"
});

ad2460.newLadyHelperData.push({
id:'encroachment',
header:"New mission in the Encroachment-pack",
body:"<p>There is a new mission for you in the pack called Encroachment!</p>"
+"<p><span class='directlink' onclick='$(&quot;#missionsbutton&quot;).click();selectMissionPack(12);'>Click here to go directly to the mission-pack.</span></p>"
});

ad2460.newLadyHelperData.push({
id:'distribute points',
header:"One of your commanders have stat-points available",
body:"<p>You can customize your commanders abilities by distributing stat-points! More details about commander-stats can be found <span class='directlink' onclick='showLocalHelpTopic(\"Your Commanders\");'>here</span>.</p>"
+"<p>Just go to MILITARY and open the <span class='directlink' onclick='specialProcessOpenPanel(&quot;commanders&quot;,0,event);return false;''>'Commanders'-panel</span> and click on your commanders to find the right one, then use the green + buttons in the top right panel to distribute them!</p>"
});





// Help boxes on MOVE SHIPS get their text from here
ad2460.fmCol1Text="<p>To move a ship into a new fleet, click a ship type in the column below.</p><p>Only ship types in the selected fleet will be available to select.</p><p>The selected ship type is now shown in column two.</p>";
ad2460.fmCol2Text="<p>Choose where to move the selected ship type. Drop-downs show available destinations.</p><p>Select how many ships to move by selecting percentage, all, or clicking on individual ships in the listing.</p><p>Click 'Add move-order' to set up the move in column three.</p>";
ad2460.fmCol3Text="<p>You can create a number of moves at the same time. 'Add move-order' will bring the order into the list below.</p><p>Clicking on 'Move Units' will perform all the moves you have ordered.</p>";
// So there!

function showWorldChangeHelp(){
	var heading="Change Homeworld Picture";
	var introText="<p>In AD2460, there are 8 different homeworld-types. The only difference between them is how they look. That is all. However, if you would like to change it, you can do so here. Click SELECT to change your homeworld. This change will be visible for all other players as well. A homeworld-change costs 10 credits, unless you are a VIP.</p><p>You can view your homeworld fully by clicking the 'Homeworld Class'-text.";
	var listText=""
		+"<div class='planet_select_container'><img class='planet_select_img' src='images/planets/planettype01.png'><div class='planet_class_label'>Class 1:<br>Cooling Planet</div><div class='lightbutton160 green planet_select_select' onclick='changeHomeWorld(1)'>SELECT</div></div>"
		+"<div class='planet_select_container'><img class='planet_select_img' src='images/planets/planettype02.png'><div class='planet_class_label'>Class 2:<br>Oceanic Planet</div><div class='lightbutton160 green planet_select_select' onclick='changeHomeWorld(2)'>SELECT</div></div>"
		+"<div class='planet_select_container'><img class='planet_select_img' src='images/planets/planettype03.png'><div class='planet_class_label'>Class 3:<br>Forest Planet</div><div class='lightbutton160 green planet_select_select' onclick='changeHomeWorld(3)'>SELECT</div></div>"
		+"<div class='planet_select_container'><img class='planet_select_img' src='images/planets/planettype04.png'><div class='planet_class_label'>Class 4:<br>Ringed Planet</div><div class='lightbutton160 green planet_select_select' onclick='changeHomeWorld(4)'>SELECT</div></div>"
		+"<div class='planet_select_container'><img class='planet_select_img' src='images/planets/planettype05.png'><div class='planet_class_label'>Class 5:<br>Super Earth</div><div class='lightbutton160 green planet_select_select' onclick='changeHomeWorld(5)'>SELECT</div></div>"
		+"<div class='planet_select_container'><img class='planet_select_img' src='images/planets/planettype06.png'><div class='planet_class_label'>Class 6:<br>Binary Planets</div><div class='lightbutton160 green planet_select_select' onclick='changeHomeWorld(6)'>SELECT</div></div>"
		+"<div class='planet_select_container'><img class='planet_select_img' src='images/planets/planettype07.png'><div class='planet_class_label'>Class 7:<br>Desert Planet</div><div class='lightbutton160 green planet_select_select' onclick='changeHomeWorld(7)'>SELECT</div></div>"
		+"<div class='planet_select_container'><img class='planet_select_img' src='images/planets/planettype08.png'><div class='planet_class_label'>Class 8:<br>Arid Planet</div><div class='lightbutton160 green planet_select_select' onclick='changeHomeWorld(8)'>SELECT</div></div>";

		showSimpleBox(heading, introText+listText);
}

function showCruiserHelp(){
	var subject="How to build Cruisers";
	var body="Cruisers are considered Tier 2 ships, so even though the requirements differ a bit, you can expect to need at least:<br>Research Lab Level 2<br>Development Station Level 2<br>Production Facility Level 2<br><br>Once you have the Research Lab Level 2, you can look for the new research named Cruiser Class Construction, that must be completed.<br>If you can't see it, you probably have not completed the Advanced Fighter Chassis.<br><br>To proceed, you will also need<br><br>Tech-specific Research Lab Level 2<br>Tech-specific Development Station Level 2<br>Tech-specific Production Facility Level 2<br><br>Do the research lab first, so you can start the tech-specific Cruiser Research.<br><br>And after you have completed that, and completed the tech-specific development-station, you need to develop the tech-specific Cruiser-design.<br><br>And then, provided you have enough tech points in the correct branch of the tech tree, you can produce your first cruisers!";
	showSimpleBox(subject,body);
}
var scrollerBusy=0;

$(document).ready(function() {
	$('#postscontainer').mousewheel(function(event, delta) { 
		var el = event.target || event.srcElement;
		if (el){
			if (el.id=='post_reply_body'){
				return;
			}
		}

		/*
		var extraCheckElement=document.activeElement;
		if (extraCheckElement){
			if (extraCheckElement.id=='post_reply_body'){
				return;
			}
		}
		*/
		
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*80);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#threadscontainer').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});


	$('#allyNews').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#target_search_container').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#market_scroller').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#launch_fleet_select_scroller').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});
/*
	$('#facility_list_container').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});
*/
	/*
	$('#production_list_container').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});
*/
/*
	$('#research_list_container').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);

		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#development_list_container').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});
/*
/*
	$('#currentconv').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#convlist').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

*/
	$('#gameArtContentScroller').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*150);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#gameInfoContentScroller').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#gameNewsContentScroller').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#gameNewsMenuScroller').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#rank_listing_slide').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#rank_category_slide').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#member_dir').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*84);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#infopanel_completed_development_container').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#infopanel_completed_research_container').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#allYourCommanders').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#moveYourFleets').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#allYourFleets').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});

	$('#combat_log_container').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});	

	$('#spyMissions').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});	


	$('#soloMissions').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});	

	$('#soloMissionPack').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});	




	$('#spyLog').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});	

	// special news-scrolling attempt
	$('#latest_updates_outer_container').mousewheel(function(event, delta) { 
		if (delta<0){
			nextPlayerUpdateClick()
		}
		else {
			previousPlayerUpdateClick();
		}
	});

	$('#link_scroller').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});	
	
	$('#infopanel_production_queue_container').mousewheel(function(event, delta) { 
		var curTop=parseInt($(this).css('top'),10);
//		var contentHeight=parseInt($(this).css('height'));
		var contentHeight=parseInt($(this).outerHeight(),10);
		var windowHeight=parseInt($(this).parent().css('height'),10);
		var maxTop=0;
		var minTop=0-contentHeight+windowHeight-parseInt($(this).css('padding-bottom'),10);
		var newTop=curTop+(delta*60);
		if (newTop>maxTop){	newTop=maxTop;	}
		if (newTop<minTop){	newTop=minTop;	}
		if (contentHeight>windowHeight){
			this.style.top=newTop+'px';
		}
		checkScrollButtonStatus(this.id);
	});	
	





});

function tutScrollTo(to_id){
	var tut=document.getElementById('main_tut_container');
	if (tut){
		var p=$("#"+to_id);
		var hheight=$(".tutorial_image").outerHeight();
		var position = p.position();
		console.log(position);
		var newTop=position.top-hheight;
		$(window).scrollTop(newTop);
		//document.body.scrollTop=newTop;
	}
}


function myScroll(id,deltaTop,scrollDuration,tableBG){
	if (scrollerBusy==1){return false;}
	var curTop=parseInt($("#"+id).css('top'),10);
	var contentHeight=parseInt($("#"+id).outerHeight(),10);
	var windowHeight=parseInt($("#"+id).parent().css('height'),10);
	
	var maxTop=0;
	var minTop=0-contentHeight+windowHeight-parseInt($("#"+id).css('padding-bottom'),10);
	var newTop=curTop+deltaTop;
	if (newTop>maxTop){	newTop=maxTop;}
	if (newTop<minTop){	newTop=minTop;}
	var actual_y_movement=Math.abs(curTop-newTop);

	//console.log(curTop, contentHeight, windowHeight);

	if (contentHeight>windowHeight){
		if (scrollDuration>0){
			scrollDuration=Math.floor(scrollDuration/Math.abs(deltaTop)*actual_y_movement);
			scrollerBusy=1;
			$("#"+id).stop().animate( { top: newTop+"px" }, {duration :scrollDuration, easing : "easeInOutQuad", complete: function() {	scrollerBusy=0;checkScrollButtonStatus(id);}} );
		}
		else {
			document.getElementById(id).style.top=newTop+'px';
		}
	}
	else if (contentHeight-curTop>windowHeight && curTop<0){
		//console.log("Special-case!!");
		$("#"+id).stop().animate( { top: "0px" }, {duration :scrollDuration, easing : "easeInOutQuad", complete: function() {	scrollerBusy=0;checkScrollButtonStatus(id);}} );
	}

	if (contentHeight>windowHeight){
		if (typeof(tableBG)=='string'){
			var bgLocationY = parseInt($("#"+id).parent().parent(".scrollBG").css("backgroundPositionY"),10);
			var bgScrollY = 0-Math.floor((curTop-newTop)/4);
			$("#"+id).parent().parent(".scrollBG").stop().animate( {  backgroundPositionY: (bgLocationY+bgScrollY)+"px" }, {duration :scrollDuration, easing : "easeInOutQuad", complete: function() {	scrollerBusy=0;checkScrollButtonStatus(id);}} );
		}
	}

	return false;
}

function myScrollBottom(id,deltaBottom,scrollDuration,tableBG){
	if (scrollerBusy==1){return false;}
	var curBottom=parseInt($("#"+id).css('bottom'),10);
//	var contentHeight=parseInt($("#"+id).css('height'));
	var contentHeight=parseInt($("#"+id).outerHeight(),10);
//	console.log("CH :"+contentHeight);
	var windowHeight=parseInt($("#"+id).parent().css('height'),10);
//	console.log("WH :"+windowHeight);
	
	var maxBottom=0;
	var minBottom=0-contentHeight+windowHeight-parseInt($("#"+id).css('padding-top'),10);
	var newBottom=curBottom+deltaBottom;
	if (newBottom>maxBottom){	newBottom=maxBottom;}
	if (newBottom<minBottom){	newBottom=minBottom;}
	var actual_y_movement=Math.abs(curBottom-newBottom);
//	console.log(maxTop);
//	console.log(minTop);
//	console.log(newTop);
//	console.log(actual_y_movement);

	if (contentHeight>windowHeight){
//		console.log('OK');
		if (scrollDuration>0){
//			console.log('Scrollduration OK');
			// Adjust the scrollDuration if we are not scrolling the full delta-amount
			scrollDuration=Math.floor(scrollDuration/Math.abs(deltaBottom)*actual_y_movement);
			scrollerBusy=1;
			$("#"+id).stop().animate( { bottom: newBottom+"px" }, {duration :scrollDuration, easing : "easeInOutQuad", complete: function() {	scrollerBusy=0;}} );
		}
		else {
			document.getElementById(id).style.bottom=newBottom+'px';
		}
	}
	if (contentHeight>windowHeight){
		//animates the .lowpanel_table_borderwrapper background
		if (typeof(tableBG)=='string'){
			var bgLocationY = parseInt($("#"+id).parent().parent(".scrollBG").css("backgroundPositionY"),10);
			var bgScrollY = 0-Math.floor((curBottom-newBottom)/4);
			$("#"+id).parent().parent(".scrollBG").stop().animate( {  backgroundPositionY: (bgLocationY+bgScrollY)+"px" }, {duration :scrollDuration, easing : "easeInOutQuad"} );
		}
	}
//	console.log ('bgLocationY');
//	console.log ('Scroller= '+actual_y_movement);
//	console.log ('BG scrolls: '+bgScrollY)
	return false;
}



function myScrollToId(id,scrollDuration){
	
	var curTop=parseInt($("#"+id).parent().css('top'),10);
	var contentHeight=parseInt($("#"+id).parent().css('height'),10);
	var windowHeight=parseInt($("#"+id).parent().parent().css('height'),10);
	var maxTop=0;
	var minTop=0-contentHeight+windowHeight;
	
	var p=$("#"+id);
	var position = p.position();
	var newTop=0-position.top;
	
	if (newTop>maxTop){	newTop=maxTop; }
	if (newTop<minTop){	newTop=minTop; }

	if (contentHeight>windowHeight){
		if (scrollDuration>0){
			scrollerBusy=1;
			$("#"+id).parent().stop().animate( { top: newTop+"px" }, {duration :scrollDuration, easing : "linear", complete: function() {	scrollerBusy=0;}} );
		}
		else {
			document.getElementById(id).parentNode.style.top=newTop+'px';
		}
	}
}

function myScrollToTop(id,scrollDuration){
	
	if (scrollDuration>0){
		scrollerBusy=1;
		$("#"+id).stop().animate( { top: "0px" }, {duration :scrollDuration, easing : "linear", complete: function() {	scrollerBusy=0;}} );
	}
	else {
		document.getElementById(id).style.top='0px';
	}
}

function myScrollToBottom(id,scrollDuration){
	if (scrollDuration>0){
		scrollerBusy=1;
		//console.log(id);
		$("#"+id).stop().animate( { bottom: "0px" }, {duration :scrollDuration, easing : "linear", complete: function() {	scrollerBusy=0;}} );
	}
	else {
		document.getElementById(id).style.bottom='0px';
	}
}




function scrollToBottomPost(){
	myScroll('postscontainer',-1000000,0);
	checkScrollButtonStatus('postscontainer')
}
function scrollToBottomConvMessage(){
	var objDiv=document.getElementById('outer_conversation_container');
	objDiv.scrollTop = objDiv.scrollHeight;
}

function checkIfOutOfRange(id){
	// Must check to see if we are actually somewhat out of content!
	if (scrollerBusy==1){return false;}
	var curTop=parseInt($("#"+id).css('top'),10);
	var contentHeight=parseInt($("#"+id).outerHeight(),10);
	var windowHeight=parseInt($("#"+id).parent().css('height'),10);

	//console.log(curTop, contentHeight, windowHeight);
	
	if (contentHeight<windowHeight)	{
		return;
	}
	
	var maxTop=0;
	var minTop=0-contentHeight+windowHeight-parseInt($("#"+id).css('padding-bottom'),10);

	var newTop=-1;
	if (curTop<minTop){	
		newTop=minTop;
	}

	if (newTop!=-1){
		document.getElementById(id).style.top=newTop+'px';
	}

}

function checkScrollButtonStatus(id){
	checkIfOutOfRange(id);

	var curTop=parseInt($("#"+id).css('top'),10);
	var contentHeight=parseInt($("#"+id).outerHeight(),10);
	var windowHeight=parseInt($("#"+id).parent().css('height'),10);

	//console.log(id, curTop,contentHeight,windowHeight);

	var lightUpButton=false;
	var lightDownButton=false;

	if (contentHeight>windowHeight){
		if (curTop<0){
			lightUpButton=true;
		}
		if (-curTop+windowHeight<contentHeight){
			lightDownButton=true;
		}
	}
	if (lightUpButton==true){
		$("#"+id+"_up").addClass("hover");
	}
	else {
		$("#"+id+"_up").removeClass("hover");
	}
	if (lightDownButton==true){
		$("#"+id+"_down").addClass("hover");
	}
	else {
		$("#"+id+"_down").removeClass("hover");
	}

	//console.log(contentHeight,windowHeight, curTop);

	if (contentHeight<windowHeight && curTop<0){
		//console.log("Special-case!!");
		$("#"+id).stop().animate( { top: "0px" }, {duration :200, easing : "easeInOutQuad", complete: function() {	scrollerBusy=0;checkScrollButtonStatus(id);}} );
	}


}

function checkInfopanelScrollButtons(id){
	
	// the id is the id of the entire panel
	// look for elements with the class infopanel_scroll_content
	var parent=document.getElementById(id);
	if (parent){
		var scrolls=parent.getElementsByClassName('infopanel_scroll_content');
		var i=0;
		for (i=0;i<scrolls.length ;i++ ){
			checkScrollButtonStatus(scrolls[i].id);
		}
	}
}
function checkLowpanelScrollButtons(id){
	// the id is the id of the entire panel
	// look for elements with the class lowpanel_scroll_content under that id...
	// and for each elements, run 
	// checkScrollButtonStatus(id)
	// where id is the name of the matched element

	var parent=document.getElementById(id);
	if (parent){
		var scrolls=parent.getElementsByClassName('lowpanel_scroll_content');
		var i=0;
		for (i=0;i<scrolls.length ;i++ ){
			checkScrollButtonStatus(scrolls[i].id);
		}
	}
}
//** Forums Variables **//

var postPanelOpen=0;
var threadPanelOpen=0;
var categoryPanelOpen=0;
var newThreadPanelOpen=0;
var newPostPanelOpen=0;
var techtreePanelOpen=0;
var buildtreePanelOpen=0;
var starmapPanelOpen=0;
var shipslidePanelOpen=0;
var combatPanelOpen=0;
var mailPanelOpen=0;
var rankPanelOpen=0;
var supportPanelOpen=0;
var posterDetailsVisible=0;
var launchPanelOpen = 0;
var combathudVisible = 1;
var awardsPanelOpen = 0;


//** Forum Functions **//

function openCategoryPanel(){
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#forumcategories").show().transition({ x : -1000 }, 500);
	categoryPanelOpen=1;
	if 	(typeof ad2460 != 'undefined'){
		ad2460.forumPaneVisible=1;
	}

}

function openThreadPanel(){
	if (categoryPanelOpen==0){openCategoryPanel();}
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#forumthreads").show().transition({ x : -965 }, 500);
	threadPanelOpen=1;
}

function openPostPanel(){
	if (categoryPanelOpen==0){openCategoryPanel();}
	if (newThreadPanelOpen==1){closeNewThreadPanel();}
	if (threadPanelOpen==0){openThreadPanel();}
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#forumposts").show().transition({ x : -700 }, 500);
	postPanelOpen=1;
}

function openNewThreadPanel(){
	if (newPostPanelOpen==1){closeNewPostPanel();}
	if (postPanelOpen==1) {closePostPanel();}
	if (categoryPanelOpen==0){openCategoryPanel();}
	if (threadPanelOpen==0){openThreadPanel();}
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$(".new_thread_panel").show().transition({ y : -195 }, 500);
	newThreadPanelOpen=1;
}

function openNewPostPanel(){
	if (categoryPanelOpen==0){openCategoryPanel();}
	if (newThreadPanelOpen==1){closeNewThreadPanel();}
	if (threadPanelOpen==0){openThreadPanel();}
	if (postPanelOpen==0) {openPostPanel();}
	$("#postreply").show().stop().animate({ top : "340px" }, 500);
	newPostPanelOpen=1;
}

function closeCategoryPanel(){
	if (threadPanelOpen==1){closeThreadPanel();}
	if (postPanelOpen==1) {closePostPanel();}
	if (newPostPanelOpen==1) {closeNewPostPanel();}
	if (newThreadPanelOpen==1){closeNewThreadPanel();}
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#forumcategories").transition({ x : 0 }, 500,  function() {$("#forumcategories").hide();});
	categoryPanelOpen=0;
	if 	(typeof ad2460 != 'undefined'){
		ad2460.forumPaneVisible=0;
	}

}

function closeThreadPanel(){
	if (postPanelOpen==1) {closePostPanel();}
	if (newPostPanelOpen==1) {closeNewPostPanel();}
	if (newThreadPanelOpen==1){closeNewThreadPanel();}
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#forumthreads").stop().transition({ x : 0 },  500, function() {$("#forumthreads").hide();});
	threadPanelOpen=0;
}

function closePostPanel(){
	if (newPostPanelOpen==1) {closeNewPostPanel();}
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#forumposts").transition({ x: 0 },  500, function() {$("#forumposts").hide();});
	postPanelOpen=0;
}

function closeNewThreadPanel(){
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$(".new_thread_panel").transition({ y : 0 }, 500);
	newThreadPanelOpen=0;
}

function closeNewPostPanel(){
	$("#postreply").stop().animate({ top : "675px" }, {duration: 500, complete: function() {$("#postreply").hide(); }});
	newPostPanelOpen=0;
}

function showPosterDetails(){
	$("#poster_details").show().stop().animate({opacity: 1},500);
	posterDetailsVisible=1;
}

function hidePosterDetails(){
	$("#poster_details").stop().animate({opacity: 0}, {duration: 500, complete: function() {$("#poster_details").hide(); }});
	posterDetailsVisible=0;
}

//Techtree//

function openTechTreeSlide(){
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#techtreeslide").show().transition({ x : -1000 }, 500);
	techtreePanelOpen=1;
}

function closeTechTreeSlide(){
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#techtreeslide").stop().transition({ x : 0 },  500, function() {$("#awardsslide").hide(); });
	techtreePanelOpen=0;
}

//End Techtree

//Awards//

function openAwardsSlide(){
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#awardsslide").show().transition({ x : -1000 }, 500);
	awardsPanelOpen=1;
}

function closeAwardsSlide(){
	acceptClick = false;
	setTimeout('acceptClick=true', 550);
	$("#awardsslide").stop().transition({ x : 0 },  500, function() {$("#awardsslide").hide(); });
	awardsPanelOpen=0;
}

//End Techtree

//Buildtree//

function openBuildTreeSlide(){
	$("#buildtreeslide").show().stop().animate({ left : "199px" }, 500);
	buildtreePanelOpen=1;
}

function closeBuildTreeSlide(){
	$("#buildtreeslide").stop().animate({ left : "1200px" }, {duration: 500, complete: function() {$('#buildtreeslide').hide();}});
	buildtreePanelOpen=0;
}

//End Buildtree

//Shipslide//

//function openShipSlide(){
//	 $("#shipslide").stop().animate({ left : "199px" }, 500);
//	shipslidePanelOpen=1;
//}

function closeShipSlide(){
	$("#shipslide").stop().transition({ left : "1200px" }, 500, function() {$("#shipslide").hide(); } );
	//$("#shipslide").stop().animate({ left : "1200px" }, 500);

	shipslidePanelOpen=0;
}

//function hoverShipinfo(){
//	$("#shipslidebutton").stop().animate ( {opacity: 1 }, 500  );
//}
//
//function unhoverShipinfo(){
//	$("#shipslidebutton").stop().animate ( {opacity: 0 }, 500  );
//}

//End shipslide

//Star Map//

function openStarMapSlide(){
	$("#starmapslide").stop().animate({ left : "199px" }, 500);
	starmapPanelOpen=1;
	blinkElementById("homebutton");
}

function closeStarMapSlide(){
	$("#starmapslide").stop().animate({ left : "1200px" }, 500);
	starmapPanelOpen=0;
}

// end Star Map //


//Combat Slide//

function launchSlide(){
	if (launchPanelOpen==0) {
		$("#launchslide").show().stop().animate({ left : "199px" }, 500);
		//console.log('Opened Launch Panel');
		launchPanelOpen=1;
	}
	else if (launchPanelOpen==1) {
		$("#launchslide").stop().animate({ left : "1200px" }, {duration: 500, complete: function() {$("#launchslide").hide(); }} );
		//console.log('Closed Launch Panel');
		launchPanelOpen=0;
	}
}
// End Launch Slide



//Combat Slide//

function openCombatSlide(){
	$("#combatslide").show().stop().animate({ left : "199px" }, 500);
	$('#visualhud').delay(1000).animate( { backgroundPositionX: "-400px", backgroundPositionY: "-100px" },2000);
	$('#combat_label').show().delay(1000).animate({ top: '0px', left: '-400px' }, {duration:1800, complete: function(){$('#combat_label').hide().css({ top: '40px', left: '100px' });}});
	//$("#battleporttop").stop().delay(200).animate({ top : "-376px" }, 1600);
	//$("#battleportbottom").stop().delay(200).animate({ bottom : "-200px" }, 1600);
	
	combatPanelOpen=1;
}

function closeCombatSlide(){
	$("#combatslide").stop().animate({ left : "1200px" }, {duration:500, complete: function(){$('#visualhud').css( { backgroundPositionX: "0px", backgroundPositionY: "0px" });$('#combatslide').hide();}});
	
	//$("#battleporttop").stop().delay(500).animate({ top : "0px" }, 500);
	//$("#battleportbottom").stop().delay(500).animate({ bottom : "0px" }, 500);
	combatPanelOpen=0;
}

// end Combat Slide //

// Show Battle View //
//openBattleView('BlobStar','Grand Vizirs','defaultcrest','Muhahahaha','Timewasters','defaultcrest','Pimpt Up Planet','[5:3:12:5.6]','05')

function openBattleView(attackerName,attackerAlliance,attackerAllianceImg,defenderName,defenderAlliance,defenderAllianceImg,locationName,locationCoords,locationPlanetImg,attackerAvatar,defenderAvatar,packImg,missionPackName,missionName, mission_id){
	acceptClick = false;
	if (mission_id>0){

		$('#combat_mission_container').show().css({opacity:0}).show().delay(1000).animate({opacity:1},500).delay(5000).transition({ y: -50, opacity: 0}, 1000, 'linear', function(){$('#combat_mission_container').hide().css({y:0});});	
		$('#leftFrame').css({x: -400}).delay(1500).transition({x: 0},300,'easeInQuart');
		$('#rightFrame').css({x: 400}).delay(1500).transition({x: 0},300,'easeInQuart');
		$('#leftLine').css({x: -400}).delay(1500).transition({x: 0},300,'easeInQuart');
		$('#rightLine').css({x: 400}).delay(1500).transition({x: 0},300,'easeInQuart');
		$('#combatMissionImg').css({opacity: 0}).delay(1800).transition({opacity: 1},300);
		$('#combatMissionImg').attr("src", packImg);

		$('#missionHeaderCont').css({x: 0, y: 0, opacity:0}).delay(2000).animate({opacity:1},1000).delay(3500).transition({ x: 0, y: 100, opacity: 0}, 1000, 'linear');
		$('#combat_mission_pack_name').html(missionPackName);
		$('#combat_mission_name').html(missionName);
	}
	else{
		$('#combat_mission_container').hide();
		$('#attackerName').html(attackerName);
		$('#combat_att_pane_name').html(attackerName);
		$('#attackerAlliance').html(attackerAlliance);
		$('#defenderName').html(defenderName);
		$('#combat_def_pane_name').html(defenderName);
		$('#defenderAlliance').html(defenderAlliance);
		$('#locationName').html(locationName);
		$('#locationCoords').html(locationCoords);
		$('#locationPlanetImg').attr('src','images/planets/planettype'+locationPlanetImg+'.png');
		$('#combat_title_def').css({opacity:0, }).show().delay(1000).animate({opacity:1},500).delay(4000).animate({ right: '-300px'}, {duration:1000, easing: 'easeInCirc', complete: function(){$('#combat_title_def').hide().css({ top: '50px', right: '50px', fontSize: '36px' });}});
		$('#combat_title_att').css({opacity:0, }).show().delay(1000).animate({opacity:1},500).delay(4000).animate({ left: '-300px'}, {duration:1000, easing: 'easeInCirc', complete: function(){$('#combat_title_att').hide().css({ top: '50px', left: '50px', fontSize: '36px' });}});
		$('#combat_planet').css({opacity:0, }).show().delay(1000).animate({opacity:1},500).delay(4000).animate({ top: '700px'}, {duration:1000, easing: 'easeInCirc', complete: function(){$('#combat_planet').hide().css({ top: '350px', left: '50px'});}});
	}
	
	$('#game_container').animate({/*left: '-1200px'*/ opacity: 0},{duration: 1000, complete: function(){$('#game_container').hide();}});
	$('.menuicon').animate({/*left: '-1200px'*/ opacity: 0},{duration: 1000, complete: function(){$('.menuicon').hide();}});
	$('#logo').hide();
	$('.systemtextcontainer').hide();
	$('.combat_summary_pane').hide().css({opacity: 0});
	$('.battle_attacker_field').css({x: 250, opacity: 0}).transition({opacity: 1},500);
	$('#battle_container').delay(1000).show().css({opacity:1});
	$('.battle_defender_field').css({x: -250, opacity: 0}).transition({opacity: 1},500);		
	$('#combatcanvas').css({opacity:0}).show().delay(6000).animate({opacity:1},1000);
	$('#minorcanvas').css({opacity:0}).show().delay(6000).animate({opacity:1},1000);
	$('#rightcombatcanvas').css({opacity:0}).show().delay(6000).animate({opacity:1},1000);
	$('#rightminorcanvas').css({opacity:0}).show().delay(6000).animate({opacity:1},1000);

	$("#in_combat_planet").hide();

	

	if (ad2460.combat.loadedLaunchData.location_planet_type<60){
		$("#in_combat_planet").attr('src','images/planets/planettype'+zeroPad(ad2460.combat.loadedLaunchData.location_planet_type)+'.png');
		$('#in_combat_planet').css({opacity:0}).show().delay(6000).animate({opacity:1},1000);
	}

	$('.tactical_plate').css({width: '0px'}).show();
	var innerTactics = $('#inner_tactics').outerHeight();
	$('.tactical_plate').css({bottom: '0px', width: '0px', height: innerTactics});
	$('#battlepane').css({opacity:0}).delay(1000).animate({opacity:1},500);
	
	if (typeof specialPublicPlayer !== 'undefined') {
		if (specialPublicPlayer==true){
			return;
		}
	}
	$('#chatpane').transition({x: 3, width: '865px'},500);
	$('#chatfunctions').css({left: '690px', top: '1px', opacity: 0.9});
	$('.chat_wrapper').css({paddingRight: '30px'});
	$('#chatbg').css({opacity:0}).hide();
	$('#chat_input').css({left:'50px', right: '180px'});
	$('#chatcontent').css({background: 'rgba(0,0,0,0.4)', right: '122px' ,left: '46px'});
	$('#view_channels').trigger('click');
	$('#view_channels').hide();
	$('#view_combat_text').show();
	$('#view_combat_text').trigger('click');
	$('.vert_chat_line').addClass('combat_line').transition({top: '20px', delay: 300},500);
	$('#chat_channel_buttons_container').transition({top: '19px',delay: 300},500);
	$('#gameinfo').hide().css({opacity: 0});
	$('#combat_text_on_off').addClass('pot_on');
	$('.att_ret_ver').hide();
	$('.def_ret_ver').hide();

	// $("#servertime").css({left: '555px'});

	if (ad2460.extendedGUI==true){
		$("#chatpane").addClass("extended_chatpane_combat");
	}

	chatMin();
	$("#chat_input .localhelp").hide();
	stopIngameMusic();
	setTimeout('acceptClick = true', 3000);
	combatPanelOpen=1;

	
	document.getElementById("global_chat_container_table_body").setAttribute("aria-live","off");
	document.getElementById("combat_commentary_container").setAttribute("aria-live","assertive");

}

function closeBattleView(){
	$('#game_container').css({left:0,opacity:0}).show().animate({opacity: 1},1000);
	$('.menuicon').css({opacity:0}).show().animate({opacity: 1},1000);
//	$('#homeworld_content').delay(500).css({left:'1200px'}).animate({left: '200px'},{duration: 500});;
	$('#logo').css({opacity:0}).show().animate({opacity: 1},1000);
	$('.systemtextcontainer').css({opacity:0}).show().animate({opacity: 1},1000);
	$('#battle_container').hide();
	$('.tactical_plate').hide();
	$('.ship_info_plate').css({width: '0px'}).hide();
	$('.fleet_info_plate').css({left: '0px'}).hide();

	//$("#servertime").css({left: '1171px'});

	$('#chatpane').transition({x: 0, width: '985px'},500);
	$('#chatbg').show().transition({opacity:1, delay: 300},200);
	$('#chat_input').css({left:'0px', right: '131px'});
	$('#chatcontent').css({background: 'rgba(0,0,0,0.9)', right: '129px', left: '44px'});
	$('#chatfunctions').css({left: '0px', top: '0px'}).hide();
	$('.chat_wrapper').css({paddingRight: '0px'});
	$('#view_headers').show();
	$('#view_combat_text').hide();
	$('.vert_chat_line').removeClass('combat_line').transition({top: '1px', delay: 300},500);
	$('#chat_channel_buttons_container').transition({top: '0px', delay: 300},500);
	$('#chatfunctions').show().css({top: '0px'})
	$('#gameinfo').css({opacity: 0}).show().transition({opacity: 1, delay: 600},500);
	viewChannels(previousHeader);

	$("#chatpane").removeClass("extended_chatpane_combat");


	
	try{
		resetCombatData();
	}
	catch(err){
		//console.log("Unable to call resetCombatData, but don't worry about it.");
	}
//	$('.battle_defender_field').delay(3000).transition({x:0},300);
//	$('.battle_attacker_field').delay(3000).transition({x:0},300);
	if(starMapVisible==1){
		startIngameMusic();
	}
	combatPanelOpen=0;
	$("#chat_input .localhelp").show();

	document.getElementById("global_chat_container_table_body").setAttribute("aria-live","polite");
	document.getElementById("combat_commentary_container").setAttribute("aria-live","off");

}

function maximizeCombatComment(){
	$('.combat_commantary').animate({height: '400px'},500);
}
function minimizeCombatComment(){
	$('.combat_commantary').animate({height: '72px'},500);
}

function showTacticalPlate() {
	if ($('.tactical_plate').width() < 250) {
		$('.tactical_plate').show().stop().animate({width: '400px'});
	}
	else {
		$('.tactical_plate').stop().animate({width: '0px'},{complete: function(){$('.tactical_plate').hide();}});
	}
}
function enableComOption(id){
	$('#'+id+' .control_pot').addClass('pot_on');
}
function disableComOption(id){
	$('#'+id+' .control_pot').removeClass('pot_on');
}
// Commented out by Christian
//function selectTactic () {
//}
function showCombatSummary(mission){
	if(mission>=1){
		$('.com_sum_top').css({height:'220px', marginTop: '30px'});
		$('.combat_summary_pane').css({opacity:0}).show().animate({opacity: 1},1500);
		$('.combat_result_text').hide();
		$('#location_planet_img_sum').hide();
		$('#combat_location_title_sum').hide();
		$('#leftSumFrame').show().css({x: -400, top: '5px'}).delay(500).transition({x: 0},300,'easeInQuart');
		$('#rightSumFrame').show().css({x: 400, top: '5px'}).delay(500).transition({x: 0},300,'easeInQuart');
		$('#leftSumLine').show().css({x: -400, top: '70px'}).delay(500).transition({x: 0},300,'easeInQuart');
		$('#rightSumLine').show().css({x: 400, top: '170px'}).delay(500).transition({x: 0},300,'easeInQuart');
		$('#combatMissionSumImg').show().css({left: '98px', top: '10px' , opacity: 0}).delay(800).transition({opacity: 1},300);
		$('#comSumEndText').show().css({opacity: 0}).delay(800).transition({opacity: 1},300);
	}
	else{
		$('#leftSumFrame').hide();
		$('#rightSumFrame').hide();
		$('#leftSumLine').hide();
		$('#rightSumLine').hide();
		$('#combatMissionSumImg').hide();
		$('#comSumEndText').hide();
		$('.com_sum_top').css({height:'auto', marginTop: '-10px'});
		$('.combat_summary_pane').css({opacity:0}).show().animate({opacity: 1},1500);
		$('.combat_result_text').show().css({ scale: 0.3}).transition({ scale: 1 }, 1500, 'ease');
		$('#location_planet_img_sum').show().css({ left: '-250px', rotate: '15deg'}).transition({ left: '0px', rotate: '0deg' }, 1500, 'ease');
		$('#combat_location_title_sum').show().css({ left: '700px'}).transition({ left: '115px'}, 1500, 'ease');
	}
}


function hideCombatSummary(){
	$('.combat_summary_pane').animate({opacity: 0},{duration: 500, complete: function(){$('.combat_summary_pane').hide();}});
}

function showShipInfoLeft(){
	$('.ship_info_plate').css({left: '-114px', width: '312px'}).show().stop().animate({left: '250px'}, 500);
}
function showShipInfoRight(){
	$('.ship_info_plate_right').css({left: 'auto', right: '100px', width: '312px'}).show().stop().animate({right: '413px'}, 500);
}
function hideShipInfoLeft(){
	$('.ship_info_plate').stop().animate({left: '-114px'}, {duration: 500, complete: function(){$('.ship_info_plate').hide();}});
}
function hideShipInfoRight(){
	$('.ship_info_plate_right').stop().animate({right: '100px'}, {duration: 500, complete: function(){$('.ship_info_plate_right').hide();}});
}

function showFleetInfoLeft(){
	$('.fleet_info_plate').css({left: '-114px', width: '312px'}).show().stop().animate({left: '250px'}, 500);
}
function showFleetInfoRight(){
	$('.fleet_info_plate_right').css({left: 'auto', right: '-114px', width: '312px'}).show().stop().animate({right: '250px'}, 500);
}
function hideFleetInfoLeft(){
	$('.fleet_info_plate').stop().animate({left: '-114px'}, {duration: 500, complete: function(){$('.ship_info_plate').hide();}});
}
function hideFleetInfoRight(){
	$('.fleet_info_plate_right').stop().animate({right: '-114px'}, {duration: 500, complete: function(){$('.ship_info_plate_right').hide();}});
}

// End Battle View //

//SupportSlide//

function openSupportSlide(){
	$("#supportslide").stop().animate({ left : "199px" }, 500);
	supportPanelOpen=1;
}

function closeSupportSlide(){
	$("#supportslide").stop().animate({ left : "1200px" }, 500);
	supportPanelOpen=0;
}

// end Support Slide //

// Mail Slide //

function openMailSlide(){
	$("#mailslide").stop().transition({ left : "199px" }, 500);
	mailPanelOpen=1;
	if 	(typeof ad2460 != 'undefined'){
		ad2460.mailPaneVisible=1;
	}
}

function closeMailSlide(){
	$("#mailslide").stop().transition({ left : "1200px" }, 500);
	mailPanelOpen=0;
	if 	(typeof ad2460 != 'undefined'){
		ad2460.mailPaneVisible=0;
	}

}

// end Mail Slide //

// Mail Slide //

function openRankingSlide(){
	$("#rankingslide").transition({ x : -1000 }, {duration: 500, complete: function(){if(static_page==false){rankingSlideOpened();} } });
	rankPanelOpen=1;
}

function closeRankingSlide(){
	$("#rankingslide").transition({ x : 0 }, {duration: 500, complete: function(){if(static_page==false){rankingSlideClosed();} } });
	rankPanelOpen=0;
}

function selectPlayerRanks(){	
	$('.player_ranking').transition({ boxShadow: '0px 0px 10px white, 0px 0px 20px lightblue', border: '1px solid white', rotate:'0deg', scale: 1, x: 0, y: 0, opacity: 1,  transformOrigin: '100% 50%', borderRadius: '5px'},500,'easeInOutQuad');
	$('.alliance_ranking').transition({ boxShadow: '0px 0px 20px black', border: '1px solid black', rotate:'-180deg', scale: 0.8, x: 225, y: 68, opacity: 0.6, transformOrigin: '100% 100%', borderRadius: '20px' },500,'easeInOutQuad');
	if (static_page==false)	{
		selectPlayerRankings();
	}
}

function selectAllianceRanks(){
	$('.alliance_ranking').transition({ boxShadow: '0px 0px 10px white, 0px 0px 20px lightblue', border: '1px solid white', rotate:'0deg', scale: 1, x: 0, y: 0, opacity: 1,  transformOrigin: '0% 50%', borderRadius: '5px'},500,'easeInOutQuad');
	$('.player_ranking').transition({ boxShadow: '0px 0px 20px black', border: '1px solid black', rotate:'180deg', scale: 0.8, x: -225, y:-68, opacity: 0.6, transformOrigin: '0% 0%', borderRadius: '20px' },500,'easeInOutQuad');
	if (static_page==false)	{
		selectAllianceRankings();
	}
}

// end Mail Slide //

//**  Forums Page Live Javascript **//


// General slide functionality
function openSlide(id){
	//console.log(id);
	// First check if it is open, then we close it and return
	if(acceptClick==true){
		acceptClick = false;
		if(outGameHelpVisible == 1){
				$('#gameinfo').trigger('click');
		}
		setTimeout('acceptClick=true', 550);
		var i=0;
		for (i=0;i<ad2460.openSlides.length ;i++ ){
			if (ad2460.openSlides[i]==id){
				closeSlide(id);
//				if(selectedButtonID !=''){
//					$("#"+selectedButtonID).click();
//				}
				return;
			}
		}
		closeSlides();
		showSlideCloser();
		$("#"+id).show().transition({ x : -1000 }, 500, 'easeOutCubic');
		ad2460.openSlides.push(id);
		alertSystemToSlideOpened(id);
		shipListDown();
		if(chatPaneVisible ==2){chatMin();}
		
		if (id=='starmapslide')	{
			//console.log("blink");
			blinkElementById("homebutton");
		}

	}
}

function closeSlide(id){
	var i=0;
	var found=0;
	for (i=0;i<ad2460.openSlides.length ;i++ ){
		if (ad2460.openSlides[i]==id){
			$("#"+id).transition({ x : 0 }, 500,'easeOutCubic', function(){$("#"+id).hide();} );
			ad2460.openSlides.splice(i,1);
			i--;
			found=1;
			alertSystemToSlideClosed(id);
			if (id=='forumcategories'){
				$("#forumthreads").transition({ x : 0 }, 500,function(){$("#forumthreads").hide();} );
				$("#forumposts").transition({ x : 0 }, 500, function(){$("#forumposts").hide();} );
			}
			if (id=='mailslide'){
				ad2460.selectedConversationId=0;
				unrenderCurrentConversation();
			}
			if (id=='techtreeslide'){
				$('.tech_point_gains').hide();
			}
		}
	}
	hideSlideCloser();
	if (found==0){
		openSlide(id);
	}
}

function closeSlides(){
	var i=0;
	for (i=0;i<ad2460.openSlides.length ;i++ ){
		closeSlide(ad2460.openSlides[i]);
		i--;
		hideStarMapInfoSlide();
	}
	hideSlideCloser();
	//console.log("Allowing lady");
	denyLadyHelp=false;
}

function showSlideCloser(){
	$('#slidecloser').show().css({x: 0, y: 0, zIndex: 3 }).transition({x: -40, y:40},500);
}
function showHelpSlideCloser(){
	$('#slidecloserhelp').show().css({x: 0, y: 0, zIndex: 4 }).transition({x: -40, y:40},500);
}
function hideSlideCloser(){
	$('#slidecloser').show().css({zIndex: 3 }).transition({x:0, y:0},500);
	$('#slidecloserhelp').show().css({zIndex: 4 }).transition({x:0, y:0},500);
}

function showMissionSlide(){
	$('#missionslide').show().transition({x:-1000}, 500);	
}
function hideMissionSlide(){
	$('#missionslide').show().transition({x:0}, 500, function(){$('#missionslide').hide();});	
}
function showBattleMission(){
	$('.battle_mission_container').show();
	$('.scout_mission_container').hide();
	$('.espionage_mission_container').hide();
	$('.diplomatic_mission_container').hide();
}
function showScoutMission(){
	$('.battle_mission_container').hide();
	$('.scout_mission_container').show();
	$('.espionage_mission_container').hide();
	$('.diplomatic_mission_container').hide();
}
function showEspionageMission(){
	$('.battle_mission_container').hide();
	$('.scout_mission_container').hide();
	$('.espionage_mission_container').show();
	$('.diplomatic_mission_container').hide();
}
function showDiplomaticMission(){
	$('.battle_mission_container').hide();
	$('.scout_mission_container').hide();
	$('.espionage_mission_container').hide();
	$('.diplomatic_mission_container').show();
}
function showBattleMissionComplete(){
	$('.used_battle_tactics').show();
	$('.mission_combat_box').show();
	$('.used_scouts').hide();
	$('.used_setting').hide();
	$('.used_commander').hide();
	$('.used_commander_setting').hide();
}
function showEspionageMissionComplete(){
	$('.used_battle_tactics').hide();
	$('.mission_combat_box').hide();
	$('.used_scouts').show();
	$('.used_setting').show();
	$('.used_commander').hide();
	$('.used_commander_setting').hide();
}
function showScoutMissionComplete(){
	$('.used_battle_tactics').hide();
	$('.mission_combat_box').hide();
	$('.used_scouts').show();
	$('.used_setting').show();
	$('.used_commander').hide();
	$('.used_commander_setting').hide();
}
function showDiplomaticMissionComplete(){
	$('.used_battle_tactics').hide();
	$('.mission_combat_box').hide();
	$('.used_scouts').hide();
	$('.used_setting').hide();
	$('.used_commander').show();
	$('.used_commander_setting').show();
}

function showMission01(){
	$('.mission_pack_img img').removeClass('mission_anim_start');	
}


function showMissionSummarySlide(){
	if (static_page==false)	{
		openSlide('mission_summary');
	}
	else {
		$('#mission_summary').show().transition({x:-1000}, 500);		
	}

}
function hideMissionSummarySlide(){
	if (static_page==false)	{
		closeSlide('mission_summary');
	}
	else {
		$('#mission_summary').show().transition({x:0}, 500, function(){$('#mission_summary').hide();});	
	}
}

// End General slide functionality

//** Tech Point Award Script **//
function showTechAward() {
	$('#tech_award_display').show();
	$('#techpoint_icon').html('<img src="images/fixed/techpointline_icon.png" />');
	//$('#techpoint_head').html('TECH POINT AWARDED!');
	//$('#techpoint_desc').html('You upgraded a facility to level 3, and for this you have been awarded 1 tech point. This can be spent in the tech tree section. Go there to spend the point and claim your boni.');
	$('#techpoint_bg').show().transition({opacity: 1},1000);
	$('#techpoint_gfx').css({left: '1000px'}).show().transition({left: '150px'},1000);
	$('#techpoint_icon').css({top: '-200px'}).show().transition({top: '-65px'},1000);
	$('#techpoint_head').css({left: '-1000px'}).show().transition({left: '0px'},1000);
	$('#techpoint_desc').show().delay(800).transition({opacity: 1},500);
}

function hideTechAward() {
	$('#techpoint_bg').animate({opacity: 0},{duration: 400, complete: function(){$('#techpoint_bg').hide(); if (static_page==false){ ad2460.levelBoxOpen=false;ad2460.techpointsBoxOpen=false;} }});
	$('#techpoint_gfx').animate({left: 1000},{duration: 400, complete: function(){$('#techpoint_gfx').hide();}});
	$('#techpoint_icon').animate({top: -200},{duration: 400, complete: function(){$('#techpoint_icon').hide();}});
	$('#techpoint_head').animate({left: -1000},{duration: 400, complete: function(){$('#techpoint_head').hide();$('#tech_award_display').hide();}});
	$('#techpoint_desc').animate({opacity: 0},{duration: 200, complete: function(){$('#techpoint_desc').hide();}});
}

function showLevelUp() {
	$('#tech_award_display').show();
	$('#techpoint_icon').html('<img src="images/fixed/levelup_icon.png" />');
	//$('#techpoint_head').html('YOU GAINED A LEVEL!');
	//$('#techpoint_desc').html('You now are one level higher than just a minute ago. Perks and benefits follow. Oh and boni.');
	$('#techpoint_bg').show().transition({opacity: 1},1000);
	$('#techpoint_gfx').css({left: '1000px'}).show().transition({left: '150px'},1000);
	$('#techpoint_icon').css({top: '-200px'}).show().transition({top: '-65px'},1000);
	$('#techpoint_head').css({left: '-1000px'}).show().transition({left: '0px'},1000);
	$('#techpoint_desc').show().delay(800).transition({opacity: 1},500);
	hideHelpCommander();
}

function hideLevelUp() {
	$('#techpoint_bg').animate({opacity: 0},{duration: 400, complete: function(){$('#techpoint_bg').hide(); if (static_page==false){ ad2460.levelBoxOpen=false;ad2460.techpointsBoxOpen=false;} }});
	$('#techpoint_gfx').animate({left: 1000},{duration: 400, complete: function(){$('#techpoint_gfx').hide();}});
	$('#techpoint_icon').animate({top: -200},{duration: 400, complete: function(){$('#techpoint_icon').hide();}});
	$('#techpoint_head').animate({left: -1000},{duration: 400, complete: function(){$('#techpoint_head').hide();$('#tech_award_display').hide();}});
	$('#techpoint_desc').animate({opacity: 0},{duration: 200, complete: function(){$('#techpoint_desc').hide();}});
}

function showAttack() {
	$('#tech_award_display').show();
	$('#techpoint_icon').html('<img src="images/fixed/attack_icon.png" />');
	$('#techpoint_head').html('OUTPOST: AHAMMILON PRIME WAS ATTACKED!');
	$('#techpoint_desc').html('Click here to view the battle.');
	$('#techpoint_bg').show().transition({opacity: 1},1000);
	$('#techpoint_gfx').css({left: '1000px'}).show().transition({left: '150px'},1000);
	$('#techpoint_icon').css({top: '-200px'}).show().transition({top: '-65px'},1000);
	$('#techpoint_head').css({left: '-1000px'}).show().transition({left: '0px'},1000);
	$('#techpoint_desc').show().delay(800).transition({opacity: 1},500);
}

function hideAttack() {
	$('#techpoint_bg').animate({opacity: 0},{duration: 400, complete: function(){$('#techpoint_bg').hide(); if (static_page==false){ ad2460.techpointsBoxOpen=false;} }});
	$('#techpoint_gfx').animate({left: 1000},{duration: 400, complete: function(){$('#techpoint_gfx').hide();}});
	$('#techpoint_icon').animate({top: -200},{duration: 400, complete: function(){$('#techpoint_icon').hide();}});
	$('#techpoint_head').animate({left: -1000},{duration: 400, complete: function(){$('#techpoint_head').hide();$('#tech_award_display').hide();}});
	$('#techpoint_desc').animate({opacity: 0},{duration: 200, complete: function(){$('#techpoint_desc').hide();}});
}

function showMissionCompleteAward() {
	$('#mission_complete_display').show();
	//$('#techpoint_head').html('TECH POINT AWARDED!');
	//$('#techpoint_desc').html('You upgraded a facility to level 3, and for this you have been awarded 1 tech point. This can be spent in the tech tree section. Go there to spend the point and claim your boni.');
	$('#mission_complete_bg').show().transition({opacity: 1},1000);
	$('#mission_complete_gfx').css({left: '1000px'}).show().transition({left: '150px'},1000);
	$('#mission_complete_icon').css({top: '-200px'}).show().transition({top: '-65px'},1000);
	$('#mission_complete_head').css({left: '-1000px'}).show().transition({left: '0px'},1000);
	$('#mission_complete_desc').show().delay(800).transition({opacity: 1},500);
}

function hideMissionCompleteAward() {
	$('#mission_complete_bg').animate({opacity: 0},{duration: 400, complete: function(){$('#mission_complete_bg').hide(); if (static_page==false){ ad2460.levelBoxOpen=false;ad2460.techpointsBoxOpen=false;} }});
	$('#mission_complete_gfx').animate({left: 1000},{duration: 400, complete: function(){$('#mission_complete_gfx').hide();}});
	$('#mission_complete_icon').animate({top: -200},{duration: 400, complete: function(){$('#mission_complete_icon').hide();}});
	$('#mission_complete_head').animate({left: -1000},{duration: 400, complete: function(){$('#mission_complete_head').hide();$('#mission_complete_display').hide();}});
	$('#mission_complete_desc').animate({opacity: 0},{duration: 200, complete: function(){$('#mission_complete_desc').hide();}});
}

function showShipList() {
	$('#shiplistslide').show().transition({x: -1000}, 500 );
}
function hideShipList() {
	$("#shiplistslide").transition({ x : 0 }, 500,  function() {$("#shiplistslide").hide();});
}


function showLevelUpPlate(){
	setTimeout(function(){

	$('#level_up_container').show(0).css({height: '577px', width: '1005px'});
			$('#level_up_text').css({ transform: 'translate3d(-1000px, -0px, 0px)', transition: 'transform 1000ms ease-in-out'});
			$('#level_up_line').css({transition: 'all 1000ms cubic-bezier(0.215, 0.61, 0.355, 1) 0s ', transform: 'translate3d(1150px, 0px , 0px)'});
			$('#level_up_icon').css({transition: 'all 1000ms cubic-bezier(0.215, 0.61, 0.355, 1) 0s', transform: 'translate3d(0px, 150px, 0px)'});
			setTimeout('showLevelInfo()',500);
			ad2460.nextLevelShowing = 1;
	},2000);
}
function showLevelInfo(){
	$('#level_up_container').show(0).css({height: '577px', width: '1005px'});
	$('#level_up_main').css({ opacity: 1, transition: 'all 1000ms ease-in-out'});
	var nextLevelShowing = 1;
}
function hideLevelUpPlate(){
	$('#level_up_container').hide().css({height: '0px', width: '0px'});
	$('#level_up_text').css({transform: 'translateX(0px)'});
	$('#level_up_line').css({transform: 'translateX(0px)'});
	$('#level_up_icon').css({transform: 'translateY(0px)'});
	$('#level_up_main').css({ opacity: 0});
	ad2460.nextLevelShowing = 0;
}
// End Functions


$(document).ready(function() {
	if (static_page == true){
		$('#rankingbutton').click(function(){
			if( rankPanelOpen == 0){
				openRankingSlide();
			}
			else {
				closeRankingSlide();
			}
		});
	}
});

var ok_to_update_tactics=true;

$(document).ready(function() {
	$('.tactical_list').click(function(){
		if (ok_to_update_tactics){
			$(this).parent().children().removeClass('selected');
			$(this).addClass('selected');
			//console.log(id+' clicked');
		}
	})
});

$(document).ready(function() {
	$('.scout_option').click(function(){
	$(this).parent().children().removeClass('selected');
	$(this).addClass('selected');
	//console.log(id+' clicked');
	})
});

$(document).ready(function() {
	$('.mission_commander_list_entry').click(function(){
	$(this).parent().children().removeClass('selected');
	$(this).addClass('selected');
	//console.log(id+' clicked');
	})
});

$(document).ready(function() {
//	$("#combat_comment_max_button").hover(function(){
//		commentHeight = parseInt($('.combat_commentary').height());
//		if (commentHeight == 88){
//			$('.combat_commentary').stop().transition({opacity: 0},500);
//		}
//		else {}
//		
//	},
//	function(){
//		commentHeight = parseInt($('.combat_commentary').height());
//		if (commentHeight == 88){
//			$('.combat_commentary').stop().transition({opacity: 1},500);
//		}
//		else {}
//	}
//	);	
	$("#combat_comment_max_button").click(function(){
		 commentHeight = parseInt($('.combat_commentary').height());
		 if (commentHeight > 88) {
			 $("#combat_comment_max_button").css( {background : "url(../images/fixed/upqueue.png) no-repeat" } );
			 $('.combat_commentary').stop().transition({height: '88px', backgroundColor: 'rgba(0,0,0,0.5)'},500);
			 $('.combat_commentary .scrollbuttons').css({right: '-20px'});
			 myScrollToBottom('combat_commentary_container',250);
		 }
		 else if (commentHeight <= 88) {
			$("#combat_comment_max_button").css( {background : "url(../images/fixed/downqueue.png) no-repeat" } );
			$('.combat_commentary').stop().transition({height: '680px', backgroundColor: 'rgba(0,0,0,0.9)'},500);			
			$('.combat_commentary .scrollbuttons').stop().delay(500).animate({right: '5px'},500);	 
		}
	});
});


$(document).ready(function() {
	$('.battle_capital_ship_entry').click(function(){
	shipInfoPlateOpen = $('.ship_info_plate').width();
	if(shipInfoPlateOpen == 0) {$('.ship_info_plate').show().stop().animate({width: '312px'}, 500);}
	else{$('.ship_info_plate').stop().animate({width: '0px'}, {duration: 500, complete: function(){$('.ship_info_plate').hide();}});}
	})
	
	$('.battle_commander_container').click(function(){
		fleetInfoPlateOpen = parseInt($('.fleet_info_plate').css('left'));
		if(fleetInfoPlateOpen == 0) {$('.fleet_info_plate').show().stop().animate({left: '249px'}, 500);}
		else{$('.fleet_info_plate').stop().animate({left: '0px'}, {duration: 500, complete: function(){$('.fleet_info_plate').hide();}});}
	})
	
});

$(document).ready(function() {
	$('#bonus_gains').click(function(){
		$('.tech_point_gains').show();
	});
	
	$('#bonus_close').click(function(){
		$('.tech_point_gains').hide();
	});
	
});

//Opens the forum categories panel


$(document).ready(function() {

	//$("#shipslidebutton").hover(function(){ hoverShipinfo(); },
	//	function(){ unhoverShipinfo();	
	//});

	if (static_page == true) {
	
		$("#forumopenbutton").click(function(){
			openSlide('forumcategories');
		});

		//Opens the Forum threads for the selected Forum category
		$(".categorylink").click(function(){
			openThreadPanel();
		});

		//Opens the posts for the selected thread
		$(".threadslink").click(function(){
			// Commented out by Spinner, sorry!
			openPostPanel();
		});

		//Closes the Forums
		$("#forumclosebutton").click(function(){
			closeCategoryPanel();
		});

		//closes everything but the categories panel
		$("#showforumcategories").click(function(){
			closeThreadPanel();
		});

		//closes everything but the threads
		$("#showforumcategories").click(function(){
			closePostPanel();
		});

		//closes everything but the posts
		$("#showforumthreads").click(function(){
			closePostPanel();
		});

		//opens the post reply
		$(".replypostbutton").click(function(){
			if (newPostPanelOpen==0) {openNewPostPanel();}
			else {closeNewPostPanel();}
		});

		//opens the new thread creation (closes posts view)
		$("#newthreadbutton").click(function(){
			if (newThreadPanelOpen==0) {openNewThreadPanel();}
			else {closeNewThreadPanel();}
		});

		//closes thread creation
		//	$("#threadsubmit").click(function(){
		//		closeNewThreadPanel();
		//	});

		//closes the post reply
		//	$("#replysubmit").click(function(){
		//		closeNewPostPanel();
		//	});

		//shows poster details
		$("#show_poster_details").click(function(){
			if (posterDetailsVisible==0) {showPosterDetails();}
			else {hidePosterDetails();}
		});

		//techtreebutton//
		$("#techtreebutton").click(function(){
			openSlide('techtreeslide');
		});

		//buildtreebutton//
		$("#buildtreebutton").click(function(){
			openSlide('buildtreeslide');
		});

		//shipslide
		//	$("#shipslidebutton").click(function(){
		//		if (shipslidePanelOpen==0) {openShipSlide(); closeBuildTreeSlide();closeTechTreeSlide();closeCategoryPanel(); closeStarMapSlide();closeSupportSlide();closeMailSlide();closeRankingSlide();}
		//		else {closeShipSlide();}
		//	});

		//	$("#shipslide").click(function(){
		//		closeShipSlide();
		//	});

		


		$("#combatbutton").click(function(){
			openSlide('combatslide');
		});

		$("#messagesbutton").click(function(){
			openSlide('mailslide');
		});

		$("#rankingbutton").click(function(){
			openSlide('rankingslide');
		});

//		//buildtreebutton//
		$("#starmapbutton").click(function(){
			openSlide('starmapslide');
		});

		$("#supportbutton").click(function(){
			openSlide('supportslide');
		});
		$("#optionsbutton").click(function(){
			openSlide('optionsslide');
		});


	} // If static-page == true
});

$(document).ready(function() {
	$("#visualhud").click(function(){
		 if (combathudVisible == 1) {
			 $('#visualhud').animate({top:'-390px'},500);
			 $('#hud_helper').show().delay(500).animate({opacity: 1},500);
			 combathudVisible = 0;
		 }
		 else if (combathudVisible == 0) {
			$('#visualhud').animate({top:'0px'},500);
			$('#hud_helper').hide().css({opacity: 0});
			combathudVisible = 1;	 
		}
	});
});
var rankslided = 0;
$(document).ready(function() {
	
	//$(".rank_listing").click(function() {
	//	console.log('Did a click on the list.');
	//	if (rankslided == 0) {
	//	rankslided = 1;
	//	$('#rank_listing_slide').stop().transition( {marginTop: '-500px' },1000);		
	//	}
	//	else {
	//	rankslided = 0;
	//		$('#rank_listing_slide').stop().transition( {marginTop: '0px' },1000);
	//		
	//	}
	//	$('#rank_listing_slide .number_rank').stop(true);
	//	$('#rank_listing_slide .number_rank').transition({marginLeft: '-30px', marginRight: '30px' },100).delay(800).transition({marginLeft: '0px', marginRight: '0px' },400);
	//});
	
	$('.rank_line').hover(
		function(){ 
			rankLineId = $(this).attr('id');
			//console.log('hovering!');
			$('#'+id+' .rank_line').transition( {height: '50px'}, 300);
		},
		function(){ 
			rankLineId = $(this).attr('id');
			//console.log('unhovering!');
			$('#'+id+' .rank_line').transition( {height: '50px'}, 300);	
	});
	
//	$(".rank_category_list").click(function() {
//		console.log('Did a click on the list.');
//		if (rankslided == 0) {
//		rankslided = 1;
//		$('#rank_category_slide').stop().transition( {marginTop: '-500px' },1000);		
//		}
//		else {
//		rankslided = 0;
//			$('#rank_category_slide').stop().transition( {marginTop: '0px' },1000);
//			
//		}
//		$('#rank_category_slide .number_rank').stop(true);
//		$('#rank_category_slide .number_rank').transition({marginLeft: '-30px', marginRight: '30px' },100).delay(800).transition({marginLeft: '0px', marginRight: '0px' },400);
//	});

});

$(document).ready(function() {
	if (static_page==true){
		return;
	}
	techPane = 0;
	paneOwner = 0;
	paneHeight = 0;
	panePosition = 0;
	paneId= 0;
	
	$(".techitem").click(function(){
		$("#bonuspane .techitem").click(function(e) {
					e.preventDefault();
					//console.log('Stopped click.');
		  
		});
		paneImg = 0;
		paneOwner_old = paneOwner;
		paneOwner = $(this).parent().parent().attr('id');	
		paneId_old = paneId;
		paneId = $(this).attr('id');
		paneImg = $(this).find('img').attr('src');
//		console.log('Image: '+paneImg);
		panePos = 0;
//		console.log('Old ID: '+paneId_old+'  New ID: '+paneId);
		if (paneId == paneId_old && techPane == 1) {
			$("#bonuspane").css({width: '0px'});
			techPane = 0;
			paneOwner_old = 0;
			paneOwner = 0;	
		}
		else {
	
			if(paneOwner == 'matterTech')		{ panePos = 350; }
			if(paneOwner == 'energyTech')		{ panePos = 670; }
			if(paneOwner == 'displacementTech')	{ panePos = 318; }
			
			if(paneOwner_old == paneOwner) {
				$("#bonuspane_text_content").css({opacity: 0}).html('The Aftershock of the much needed upgrade deppletion in an otherwise barren technical landcape necessitates the further improvment and augmentation of existing technology to alleviate the aforementioned problems, thereby solving the population issue and the immediate need for a fundamental rethink of the whole thing.');
				paneHeight = $("#bonuspane_entry").outerHeight();			
				$("#bonuspane .techitem_dup img").attr({'src' : paneImg});		
				if (paneOwner != 'displacementTech') {
					$("#bonuspane_entry").removeAttr( 'style' ).removeClass('bonuspane_entry_mirror').addClass('bonuspane_entry');
					$("#bonuspane").removeAttr( 'style' ).removeClass('bonuspane_mirror').addClass('bonuspane').css({left: panePos+'px', width: '250px', height: paneHeight+10});
				}
				else {
					$("#bonuspane").removeAttr( 'style' ).removeClass('bonuspane').addClass('bonuspane_mirror').css({right: panePos+'px', width: '250px', height: paneHeight+10});
					$("#bonuspane_entry").removeAttr( 'style' ).removeClass('bonuspane_entry').addClass('bonuspane_entry_mirror');
				}
				$("#bonuspane_text").css({opacity: 1});
				$("#bonuspane_text_content").css({opacity: 1});
//				console.log('Pane activated from same tech');
				techPane=1;
			}
			else if(paneOwner_old != paneOwner) {
				$("#bonuspane_text_content").css({opacity: 0}).html(
				'Sometimes, the bonus text is really short.');
				paneHeight = $("#bonuspane_entry").outerHeight();
				$("#bonuspane .techitem_dup img").attr({'src' : paneImg});				
				$("#bonuspane").css({width: '0px'});
				if (paneOwner != 'displacementTech') {
					$("#bonuspane_entry").removeAttr( 'style' ).removeClass('bonuspane_entry_mirror').addClass('bonuspane_entry');
					$("#bonuspane").removeAttr( 'style' ).removeClass('bonuspane_mirror').addClass('bonuspane').css({left: panePos+'px', height: paneHeight+10});
				}
				else {
					$("#bonuspane").removeAttr( 'style' ).removeClass('bonuspane').addClass('bonuspane_mirror').css({right: panePos+'px', height: paneHeight+10});
					$("#bonuspane_entry").removeAttr( 'style' ).removeClass('bonuspane_entry').addClass('bonuspane_entry_mirror');
				}
				$("#bonuspane_text").css({opacity: 1})
				$("#bonuspane_text_content").css({opacity: 1});
				$("#bonuspane").css({width: '0px'}).animate({width: '250px'},200);
//				console.log('Pane moved from other tech');
				techPane=1;
			}
//			console.log('Pane Height: '+paneHeight);
		}
		
	
	//Note: pressing same tech twice closes the pane (id for each tech item needed for this).
	//Note: pressing other tech within same tree switches content, but does not close the pane.
	
	});
	
//	$("#bonuspane_close").click(function(){
//		$("#bonuspane").css({width: '0px'});
//		techPane = 0;
//		paneOwner_old = 0;
//		paneOwner = 0;	
//	});
	$(".bonuspane_button").click(function(){
		$(this).children('.bonuspane_click').css({opacity: 1});
		$(this).children('.bonuspane_click').stop().animate({opacity: 0},200);
	});
	
});

// Handler for switching between alliance and solo missions (Redundant for now)
//$(document).ready(function() {
//	if (static_page == true){
//		$('#playerMissions').click(function(){
//			$('#playerMissions').transition({top: '76px', width: '400px', borderRadius: '50px 0px 0px 0px'},500);
//			$('#allianceMissions').transition({top: '25px',width: '300px', borderRadius: '00px 0px 50px 0px'},500);
//			$('.player_mission_container').show();
//			$('.alliance_mission_container').hide();
//			showAllyMissions();
//		});
//		$('#allianceMissions').click(function(){
//			$('#playerMissions').transition({top: '25px', width: '300px', borderRadius: '0px 0px 50px 0px'},500);
//			$('#allianceMissions').transition({top: '76px', width: '400px', borderRadius: '50px 0px 0px 0px'},500);
//			$('.player_mission_container').hide();
//			$('.alliance_mission_container').show();
//			showSoloMissions();
//		});
//	}
//});

//** Chat Panel Bubble
function showChatPlayerInfo () {
	$('.player_info_bubble_wrapper').show();
	// console.log(chatPaneVisible);console.log(combatPanelOpen);
	if(chatPaneVisible==1 && combatPanelOpen==1){
		$('.player_info_bubble_wrapper').css({right: '176px'});
	}
	else{
		$('.player_info_bubble_wrapper').css({right: '148px'});
	}
	$('.player_info_bubble').transition({y: 101},400);

}
function hideChatPlayerInfo () {
	$('.player_info_bubble').transition({y: 0},400, function(){$('.player_info_bubble_wrapper').css({right: '148px' });});
	$('.player_info_bubble_wrapper').fadeOut(400);
}

//** New Player Helper Functions

var checklistOpen = 0;

function showHelperIcon() {
	$('#checklist_initiate').show();	
}
function hideHelperIcon() {
	$('#checklist_initiate').hide();	
}
function showHelperPanel(){
	$('.helper_checklist').show();
	$('#check_help').css({color: 'darkred'}).html('Click to close helper.');
}
function hideHelperPanel(){
	$('.helper_checklist').hide();
	$('#check_help').css({color: 'darkgreen'}).html('Click to open helper.');
}
function expandHelperEntry(helperid){
	$('#'+helperid+' .helper_full_info').css({height: 'auto', padding: '10px'});
}
function minimizeHelperEntry(helperid){
	$('#'+helperid+' .helper_full_info').transition({height: '0px',padding: '0px'},250);
}

$(document).ready(function() {
	$("#checklist_initiate").click(function(){
		if(checklistOpen==1){
		hideHelperPanel();
		checklistOpen = 0;
		}
		else{
		if (static_page!=true){
		alertSystemToOpenChecklist();	
//		restoreHelperChecklist();
		}
		showHelperPanel();
		checklistOpen = 1;
		}
	});
	
	$( ".helper_entry" ).toggle(function() {
		helperid = $(this).attr('id');
		expandHelperEntry(helperid);
		//console.log('Expaaaaaand!');
		}, function() {
		helperid = $(this).attr('id');
		minimizeHelperEntry(helperid);
		//console.log('Mini...');
	});	
	
});
$(document).ready(function() {
	$('.hoz_control_option').click(function(){
		var id = $(this).attr('id');
		if ($(this).find('.control_pot').hasClass('pot_on')){
			disableComOption(id);
		}
		else{enableComOption(id)}
	});
});
// JavaScript Document

// Variables for Starmap Navigation
ad2460.starmap={};
ad2460.starmap.galaxy1visible = 0; //Christian?
ad2460.starmap.gridSelect = 0;	   //Christian?
ad2460.starmap.xgrid = 0;
ad2460.starmap.ygrid = 0;
ad2460.starmap.gridId = 0;
ad2460.starmap.prevGridId = 0;
ad2460.starmap.mapAcceptClick = true;

ad2460.starmap.galaxyView = 1;
ad2460.starmap.quadrantView = 0;
ad2460.starmap.sectorView = 0;
ad2460.starmap.clusterView = 0;
ad2460.starmap.systemView = 0;

ad2460.starmap.quadrantSquare = 0;
ad2460.starmap.sectorSquare = 0;
ad2460.starmap.clusterSquare = 0;
ad2460.starmap.systemSquare = 0;

// Arrays
ad2460.starmap.quadrantCoords = 0;
ad2460.starmap.sectorCoords =  0;
ad2460.starmap.clusterCoords =  0;
ad2460.starmap.systemCoords =  0;

// Variables for Solar System View
ad2460.starmap.systemViewVars={};
ad2460.starmap.systemViewVars.solPlanetSelected = 0;
ad2460.starmap.systemViewVars.solId = 0;
ad2460.starmap.systemViewVars.oldSol = 0;
ad2460.starmap.systemViewVars.topsol = 0;
ad2460.starmap.systemViewVars.leftsol= 0;
ad2460.starmap.systemViewVars.topsol_old = 0;
ad2460.starmap.systemViewVars.leftsol_old = 0;
ad2460.starmap.systemViewVars.previousPlanetSelect=0;
ad2460.starmap.systemViewVars.currentPlanetSelect=0;

ad2460.starmap.systemViewVars.planetCoords=new Array;
ad2460.starmap.systemViewVars.planetCoords.push({left:0,top:0});
ad2460.starmap.animationComplete=true;
ad2460.starmap.dataFetch=true;

ad2460.starmap.animationTimer=1550;

var i=0;
for (i=1;i<16 ;i++ ){
	ad2460.starmap.systemViewVars.planetCoords.push({left:0,top:0});
}


//Notes and Search Variables
var maplink_note = 0;
var PlayerAllianceInfoOpen = 0;
var espionageOptionOpen = 0;
var starmapLegendOpen = 0;
var prospectingListOpen = 0;

//Helper functions

//Swap image ids to prepare for next zoom animation.
function swapId(id1,id2) {
	var elm1 = $('#'+id1);
	var elm2 = $('#'+id2);
	elm1.attr('id',id2);
	elm2.attr('id',id1);
	//console.log('Ids swapped');
}

//Which view is current?
function getCurrentZoomLevel(){
	// Returns either 'galaxy', 'quadrant', 'sector', 'cluster', 'system'
	if (ad2460.starmap.galaxyView==1){
		return "galaxy";
	}
	else if (ad2460.starmap.quadrantView==1){
		return "quadrant";
	}
	else if (ad2460.starmap.sectorView==1){
		return "sector";
	}
	else if (ad2460.starmap.clusterView==1){
		return "cluster";
	}
	else if (ad2460.starmap.systemView==1){
		return "system";
	}
	else {
		alert("getCurrentZoomLevel returns unknown view");
	}
	//console.log('Zoomlevel updated');
}

//Shows different Ranking views per zoom level
function rankViewSelect() {
	if 	(ad2460.starmap.galaxyView==1) {
		$('#starmap_top_players').html('Top 5 Players');
		$('.starmap_rank_container.alliances').delay(200).fadeIn(500);
		$('.starmap_rank_container.players').animate( { height: '125px' } );
		$('#cluster_station_info').hide();
		$('#sector_station_info').hide();
	}
	else if 	(ad2460.starmap.quadrantView==1) {
		$('#starmap_top_players').html('Top 5 Players');
		$('.starmap_rank_container.alliances').delay(200).fadeIn(500);
		$('.starmap_rank_container.players').animate( { height: '125px' } );
		$('#cluster_station_info').hide();
		$('#sector_station_info').hide();
	}
	else if 	(ad2460.starmap.sectorView==1) {
		$('.starmap_rank_container.alliances').hide();
		$('#starmap_top_players').html('Top 5 Players');
		$('.starmap_rank_container.players').animate( { height: '125px' } );
		$('#cluster_station_info').hide();
		$('#sector_station_info').css({opacity: 0}).show().transition({opacity: 1}, 1500);
	}
	else if 	(ad2460.starmap.clusterView==1) {
		$('.starmap_rank_container.alliances').hide();
		$('#starmap_top_players').html('Top 5 Players');
		$('.starmap_rank_container.players').animate( { height: '125px' } );
		$('#cluster_station_info').css({opacity: 0}).show().transition({opacity: 1}, 1500);
		$('#sector_station_info').hide();
	}
	else {}
}

//Deconstruct a grid square to x and y coordinates
function returnCoordsArray(input){
	var x=1;
	var y=1;

	y = (Math.floor((input-1)/4))+1;
	x = (input-((y-1)*4));

	var myArray= new Array;
	myArray[0]=x;
	myArray[1]=y;

	return myArray;
	//console.log('Coords array returned...');
}

//Calculate which way the movment is going.
function returnFromToViews(quadrant,sector,cluster,system,planet){
	var viewList={};
	if (!isNaN(quadrant) && !isNaN(sector) && !isNaN(cluster) && !isNaN(system) && !isNaN(planet)   ) {
		viewList.to='system';
		viewList.toDepth=5;
	}
	else 	if (!isNaN(quadrant) && !isNaN(sector) && !isNaN(cluster) && !isNaN(system)    ) {
		viewList.to='system';
		viewList.toDepth=5;
	}
	else 	if (!isNaN(quadrant) && !isNaN(sector) && !isNaN(cluster)   ) {
		viewList.to='cluster';
		viewList.toDepth=4;
	}
	else 	if (!isNaN(quadrant) && !isNaN(sector)   ) {
		viewList.to='sector';
		viewList.toDepth=3;
	}
	else 	if (!isNaN(quadrant)  ) {
		viewList.to='quadrant';
		viewList.toDepth=2;
	}
	else {
		viewList.to='galaxy';
		viewList.toDepth=1;
	}

	viewList.from=getCurrentZoomLevel();
	if (viewList.from=='galaxy') {viewList.fromDepth=1;}
	if (viewList.from=='quadrant') {viewList.fromDepth=2;}
	if (viewList.from=='sector') {viewList.fromDepth=3;}
	if (viewList.from=='cluster') {viewList.fromDepth=4;}
	if (viewList.from=='system') {viewList.fromDepth=5;}
	if (viewList.from=='planet') {viewList.fromDepth=5;}

	return viewList;
	//console.log('viewList updated...');
}

//Ready function for new input
function animationsComplete() {
	ad2460.starmap.mapAcceptClick=true;
	ad2460.starmap.animationComplete=true;
	//console.log("Setting mapAcceptClick and animationComplete to true now.");
}

function bonusTypeToString(type){
	if (type=='absorbption')	{ return 'Absorption';	}
	if (type=='homeworld_mining')	{ return 'Homeworld mining';	}
	if (type=='outpost_mining')	{ return 'Outpost mining';	}
	if (type=='primary_damage')	{ return 'Primary firepower';	}
	if (type=='secondary_damage')	{ return 'Secondary firepower';	}
	if (type=='tertiary_damage')	{ return 'Tertiary firepower';	}
	if (type=='production_cost')	{ return 'Production cost';	}
	if (type=='shield_regen')	{ return 'Shield Regeneration';	}
}

//Update coordinates in Starmap View.
function coordsUpdate(quadrant,sector,cluster,system,viewList) {

	ad2460.starmap.quadrantSquare = quadrant;
	ad2460.starmap.sectorSquare = sector;
	ad2460.starmap.clusterSquare = cluster;
	ad2460.starmap.systemSquare = system;
	if (isNaN(ad2460.starmap.quadrantSquare)) {ad2460.starmap.quadrantSquare = 0};
	if (isNaN(ad2460.starmap.sectorSquare)) {ad2460.starmap.sectorSquare = 0};
	if (isNaN(ad2460.starmap.clusterSquare)) {ad2460.starmap.clusterSquare = 0};
	if (isNaN(ad2460.starmap.systemSquare)) {ad2460.starmap.systemSquare = 0};
	//$('#coordlist').html('[ '+ad2460.starmap.quadrantSquare+', '+ad2460.starmap.sectorSquare+', '+ad2460.starmap.clusterSquare+', '+ad2460.starmap.systemSquare+' ]');
	if (static_page!=true){
		var coordsstring="";
		if (ad2460.starmap.systemSquare > 0){ 		coordsstring="(COORDS:"+ad2460.starmap.quadrantSquare+":"+ad2460.starmap.sectorSquare+":"+ad2460.starmap.clusterSquare+":"+ad2460.starmap.systemSquare+")";	}
		else if (ad2460.starmap.clusterSquare > 0){	coordsstring="(COORDS:"+ad2460.starmap.quadrantSquare+":"+ad2460.starmap.sectorSquare+":"+ad2460.starmap.clusterSquare+")";		}
		else if (ad2460.starmap.sectorSquare > 0){
			coordsstring="(COORDS:"+ad2460.starmap.quadrantSquare+":"+ad2460.starmap.sectorSquare+")";
		}
		else if (ad2460.starmap.quadrantSquare > 0){coordsstring="(COORDS:"+ad2460.starmap.quadrantSquare+")"+" The "+ad2460.universe.quadrants[ad2460.starmap.quadrantSquare-1].quadrant_name+" quadrant";		}
		$('#coordlist').html(coordsstring);


	}

	if(viewList.toDepth == 1) {
		ad2460.starmap.galaxyView = 1;
		ad2460.starmap.quadrantView = 0;
		ad2460.starmap.sectorView = 0;
		ad2460.starmap.clusterView = 0;
		ad2460.starmap.systemView = 0;
		$('#mapviewlevelindicator').animate({opacity:0},{duration: 200,complete:function(){$('#mapviewlevelindicator').html('Galaxy View');}}).animate({opacity:1},500);
	}
	else if(viewList.toDepth == 2) {
		ad2460.starmap.galaxyView = 0;
		ad2460.starmap.quadrantView = 1;
		ad2460.starmap.sectorView = 0;
		ad2460.starmap.clusterView = 0;
		ad2460.starmap.systemView = 0;
		$('#mapviewlevelindicator').animate({opacity:0},{duration: 200,complete:function(){$('#mapviewlevelindicator').html('Quadrant View');}}).animate({opacity:1},500);
	}
	else if(viewList.toDepth == 3) {
		ad2460.starmap.galaxyView = 0;
		ad2460.starmap.quadrantView = 0;
		ad2460.starmap.sectorView = 1;
		ad2460.starmap.clusterView = 0;
		ad2460.starmap.systemView = 0;
		$('#mapviewlevelindicator').animate({opacity:0},{duration: 200,complete:function(){$('#mapviewlevelindicator').html('Sector View');}}).animate({opacity:1},500);
	}
	else if(viewList.toDepth == 4) {
		ad2460.starmap.galaxyView = 0;
		ad2460.starmap.quadrantView = 0;
		ad2460.starmap.sectorView = 0;
		ad2460.starmap.clusterView = 1;
		ad2460.starmap.systemView = 0;
		$('#mapviewlevelindicator').animate({opacity:0},{duration: 200,complete:function(){$('#mapviewlevelindicator').html('Cluster View');}}).animate({opacity:1},500);
	}
	else if(viewList.toDepth == 5) {
		ad2460.starmap.galaxyView = 0;
		ad2460.starmap.quadrantView = 0;
		ad2460.starmap.sectorView = 0;
		ad2460.starmap.clusterView = 0;
		ad2460.starmap.systemView = 1;
		$('#mapviewlevelindicator').animate({opacity:0},{duration: 200,complete:function(){$('#mapviewlevelindicator').html('System View');}}).animate({opacity:1},500);
	}
	//console.log('Updating Coordinates');
}

//Get Simulated Grid click for Zoom In
function getAutoGridClick(quadrant,sector,cluster,system,viewList) {
	var myArray;
	if (viewList.fromDepth==1){
		myArray = returnCoordsArray(quadrant);
		ad2460.starmap.xgrid = myArray[0]-1;
		ad2460.starmap.ygrid = myArray[1]-1;
	}
	else if (viewList.fromDepth==2){
		myArray = returnCoordsArray(sector);
		ad2460.starmap.xgrid = myArray[0]-1;
		ad2460.starmap.ygrid = myArray[1]-1;
	}
	else if (viewList.fromDepth==3){
		myArray = returnCoordsArray(cluster);
		ad2460.starmap.xgrid = myArray[0]-1;
		ad2460.starmap.ygrid = myArray[1]-1;
	}
	else if (viewList.fromDepth==4){
		myArray = returnCoordsArray(system);
		ad2460.starmap.xgrid = myArray[0]-1;
		ad2460.starmap.ygrid = myArray[1]-1;
	}
	//console.log('Simulated click: '+myArray[0]+','+myArray[1]);
}

//Get Simulated Grid click for Zoom Out
function getAutoGridClickOut(viewList) {
	var myArray;
	if (viewList.toDepth==1){
		myArray = returnCoordsArray(ad2460.starmap.quadrantSquare);
		ad2460.starmap.xgrid = myArray[0]-1;
		ad2460.starmap.ygrid = myArray[1]-1;
	}
	else if (viewList.toDepth==2){
		myArray = returnCoordsArray(ad2460.starmap.sectorSquare);
		ad2460.starmap.xgrid = myArray[0]-1;
		ad2460.starmap.ygrid = myArray[1]-1;
	}
	else if (viewList.toDepth==3){
		myArray = returnCoordsArray(ad2460.starmap.clusterSquare);
		ad2460.starmap.xgrid = myArray[0]-1;
		ad2460.starmap.ygrid = myArray[1]-1;
	}
	else if (viewList.toDepth==4){
		myArray = returnCoordsArray(ad2460.starmap.systemSquare);
		ad2460.starmap.xgrid = myArray[0]-1;
		ad2460.starmap.ygrid = myArray[1]-1;
	}
	else {}
	//console.log('Simulated click: '+myArray[0]+','+myArray[1]);
}

//Zoom Bar functions
function zoomOutBar() {

	if (ad2460.starmap.galaxyView+ad2460.starmap.quadrantView+ad2460.starmap.sectorView+ad2460.starmap.clusterView+ad2460.starmap.systemView > 1){
		console.log("Ooops, Godbluff! ", ad2460.starmap.galaxyView,ad2460.starmap.quadrantView,ad2460.starmap.sectorView,ad2460.starmap.clusterView,ad2460.starmap.systemView);
	}

	if (ad2460.starmap.galaxyView == 1) {
		$('.zoomlevelslider').transition( {left: '227px' },500 );
		$('.zoomslidercontainer').transition( {right: '0px' },500 );
	}
	else if (ad2460.starmap.quadrantView == 1) {
		$('.zoomlevelslider').transition( {left: '178px' },500 );
		$('.zoomslidercontainer').transition( {right: '0px' },500 );
	}
	else if (ad2460.starmap.sectorView == 1) {
		$('.zoomlevelslider').transition( {left: '117px' },500 );
		$('.zoomslidercontainer').transition( {right: '0px' },500 );
	}
	else if (ad2460.starmap.clusterView == 1) {
		$('.zoomlevelslider').transition( {left: '59px' },500 );
		$('.zoomslidercontainer').transition( {right: '0px' },500 );
	}
	else if (ad2460.starmap.systemView == 1) {
		$('.zoomlevelslider').transition( {left: '0px' },500 );
		$('.zoomslidercontainer').transition( {right: '0px' },500 );
	}
	//console.log('trying to move the bar..... it is heavy');
}

//Zoom in animation
function starmapZoomIn(viewList) {
	removeStarmapCanvasOverlay();

	ad2460.starmap.gridId = 'grid'+parseInt(ad2460.starmap.xgrid+1)+'_'+parseInt(ad2460.starmap.ygrid+1);

	//Hiding unused transition elements.
		$('#translr').hide();
		$('#transud').hide();

		// Run grid animation
		//console.log('This is the Id to show: '+ad2460.starmap.gridId);
		//console.log('Moving to: '+(ad2460.starmap.ygrid*200),(ad2460.starmap.xgrid*200));
		//console.log('Zooming to: '+(ad2460.starmap.ygrid*400),(ad2460.starmap.xgrid*400));
		$('.grid').not('#'+ad2460.starmap.gridId).hide().delay({duration: 1000, complete: function() {
				$('#'+ad2460.starmap.gridId).css({top: (ad2460.starmap.ygrid*100-1)+'px', left: (ad2460.starmap.xgrid*100-1)+'px', height: '99px', width: '99px'});
				$('.grid').show().transition({opacity: 1},500);
			}
		});

		$('#'+ad2460.starmap.gridId).transition({top: '0px', left: '0px', height: '400px', width: '400px'},350, 'easeInQuad', function() {
				$('#'+ad2460.starmap.gridId).css({top: (ad2460.starmap.ygrid*100-1)+'px', left: (ad2460.starmap.xgrid*100-1)+'px', height: '99px', width: '99px'});
				$('.grid').css({opacity: 0}).delay(800).show().transition({opacity: 1},500);
			}
		);

		//Run main transition
		$('#csv2').show().css({ zIndex: 6, top: '0px', left: '0px', height: '400px', width: '400px', opacity: 0}).stop().delay(700).transition({top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1},650);
			if (viewList.fromDepth == 1 && viewList.toDepth > 2) {
				$('#csv1').show()
					.css({ zIndex: 1 ,top: '0px', left: '0px', height: '400px', width: '400px',opacity: 1}).stop()
					.transition( {top: -((ad2460.starmap.ygrid*300)+200)+'px', left: -((ad2460.starmap.xgrid*300)+200)+'px',height: '1600px', width: '1600px'}, 350, 'easeInQuad')
					.transition({top: -((ad2460.starmap.ygrid*450)+400)+'px', left: -((ad2460.starmap.xgrid*450)+400)+'px', height: '2400px', width: '2400px', opacity: 0}, 650, 'easeOutQuad', function(){
						swapId('csv1','csv2');
					}
				);
		}
		else {
				$('#csv1').show()
					.css({ zIndex: 1 ,top: '-100px', left: '-100px', height: '600px', width: '600px',opacity: 1}).stop()
					.transition( {top: -((ad2460.starmap.ygrid*300)+200)+'px', left: -((ad2460.starmap.xgrid*300)+200)+'px',height: '1600px', width: '1600px'}, 350, 'easeInQuad')
					.transition({top: -((ad2460.starmap.ygrid*450)+400)+'px', left: -((ad2460.starmap.xgrid*450)+400)+'px', height: '2400px', width: '2400px', opacity: 0},650, 'easeOutQuad',  function(){
						swapId('csv1','csv2');
					}
				);
		}
		$('#trans').show()
			.css({top: '00px', left: '-00px', height: '400px', width: '400px', opacity: 0}).stop().delay(500)
			.transition({top: '-200px', left: '-200px', height: '800px', width: '800px', opacity: 1}, 650, function(){
				$('#trans').hide();
			}
		);
}

//Zoom Out function
function starmapZoomOut(viewList) {
	removeStarmapCanvasOverlay();

	// hide transitions not in use
		$('#translr').hide();
		$('#transud').hide();

		// Hide grid, delay and show.
		ad2460.starmap.gridId = 'grid'+parseInt(ad2460.starmap.xgrid+1)+'_'+parseInt(ad2460.starmap.ygrid+1);
		$('.grid').not('#'+ad2460.starmap.gridId).transition({opacity: 0},300).delay(800).animate({opacity: 1},500);

		//console.log('gridId : '+ad2460.starmap.gridId);
		//console.log('X: '+ad2460.starmap.xgrid+', Y: '+ad2460.starmap.ygrid);

		// Animate single grid cell from max to prvious location.
		$('#'+ad2460.starmap.gridId).css({top: '0px', left: '0px', height: '398px', width: '398px'}).delay(700).transition({top: (ad2460.starmap.ygrid*100-1)+'px', left: (ad2460.starmap.xgrid*100-1)+'px', height: '99px', width: '99px'}, 400, 'easeInOutSine');

		// Run zoom effect
		$('#csv1').show().css({zIndex: 6, top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1})
			.transition({top: '0px', left: '0px', height: '400px', width: '400px', opacity: 0 }, 650, function(){
				$('#csv1').hide();
			}
		);
		if (viewList.fromDepth >= 2 && viewList.toDepth == 1) {
				$('#csv2').show().css({ zIndex: 1,top: -((ad2460.starmap.ygrid*300)+400)+'px', left: -((ad2460.starmap.xgrid*300)+400)+'px', height: '2400px', width: '2400px', opacity: 0}).delay(350)
				.transition({top: -((ad2460.starmap.ygrid*200)+200)+'px', left: -((ad2460.starmap.xgrid*200)+200)+'px', height: '1600px', width: '1600px', opacity: 0.8}, 350, 'easeInQuad')
				.transition({top: '0px', left: '0px', opacity: 1, height: '400px', width: '400px'}, 400, 'easeOutQuad', function(){
					swapId('csv1','csv2');
					//starmapViewLevel();
				}
			);
		}
		else{
				$('#csv2').show().css({zIndex: 1,top: -((ad2460.starmap.ygrid*300)+400)+'px', left: -((ad2460.starmap.xgrid*300)+400)+'px', height: '2400px', width: '2400px', opacity: 0}).delay(350)
					.transition({top: -((ad2460.starmap.ygrid*200)+200)+'px', left: -((ad2460.starmap.xgrid*200)+200)+'px', height: '1600px', width: '1600px', opacity: 0.8}, 350, 'easeInQuad')
					.transition({top: '-100px', left: '-100px', opacity: 1, height: '600px', width: '600px'}, 400, 'easeOutQuad', function(){
						swapId('csv1','csv2');
						//starmapViewLevel();
					}
				);
		}
		$('#trans').show().css({top: '-200px', left: '-200px', height: '800px', width: '800px', opacity: 1})
			.transition({top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 0}, 1000, function(){
				$('#trans').hide();
			}
		);
}

function starmapPan(quadrant,sector,cluster) {
	removeStarmapCanvasOverlay();

	// Check active view. Insert end image for transition.
	/*if (ad2460.starmap.sectorView == 1 && ad2460.starmap.mapAcceptClick==true) {
		var bgRandom = 1;
		bgRandom = Math.floor(Math.random()*29)+1;
		rndAngle= Math.floor(Math.random()*4)*90;
		console.log(bgRandom);
		console.log(rndAngle);
		if (bgRandom >= 10) {
		$('#csv2').attr( 'src', 'images/starmap/sec_cls_'+bgRandom+'.jpg' );
		}
		else {
		$('#csv2').attr( 'src', 'images/starmap/sec_cls_0'+bgRandom+'.jpg' );
		}
	}
	else if (ad2460.starmap.clusterView == 1 && ad2460.starmap.mapAcceptClick==true) {
		var bgRandom = 1;
		bgRandom = Math.floor(Math.random()*29)+1;
		rndAngle= Math.floor(Math.random()*4)*90;
		console.log(bgRandom);
		console.log(rndAngle);
		if (bgRandom >= 10) {
		$('#csv2').attr( 'src', 'images/starmap/sec_cls_'+bgRandom+'.jpg' );
		}
		else {
		$('#csv2').attr( 'src', 'images/starmap/sec_cls_0'+bgRandom+'.jpg' );
		}
	}	*/

	if (quadrant != ad2460.starmap.quadrantSquare) {
		var myArray = returnCoordsArray(quadrant);

		if (myArray[0] < ad2460.starmap.quadrantCoords[0] ){
			panLeft();
			//console.log('x_old HIGHER than x_new');
		}
		else if (myArray[0] > ad2460.starmap.quadrantCoords[0] ){
			panRight();
			//console.log('x_old LOWER than x_new');
		}
		else if (myArray[1] < ad2460.starmap.quadrantCoords[1] ){
			panUp();
			//console.log('y_old HIGHER than y_new');
		}
		else if (myArray[1] > ad2460.starmap.quadrantCoords[1] ){
			panDown();
			//console.log('y_old LOWER than y_new');
		}
	}
	else if (sector != ad2460.starmap.sectorSquare) {
		var myArray = returnCoordsArray(sector);

		if (myArray[0] != ad2460.starmap.sectorCoords[0] && myArray[0] < ad2460.starmap.sectorCoords[0] ){
			panLeft();
		}
		else if (myArray[0] != ad2460.starmap.sectorCoords[0] && myArray[0] > ad2460.starmap.sectorCoords[0] ){
			panRight();
		}
		else if (myArray[1] != ad2460.starmap.sectorCoords[1] && myArray[1] < ad2460.starmap.sectorCoords[1] ){
			panUp();
		}
		else if (myArray[1] != ad2460.starmap.sectorCoords[1] && myArray[1] > ad2460.starmap.sectorCoords[1] ){
			panDown();
		}
	}
	else if (cluster != ad2460.starmap.clusterSquare) {
		var myArray = returnCoordsArray(cluster);

		if (myArray[0] != ad2460.starmap.clusterCoords[0] && myArray[0] < ad2460.starmap.clusterCoords[0] ){
			panLeft();
		}
		else if (myArray[0] != ad2460.starmap.clusterCoords[0] && myArray[0] > ad2460.starmap.clusterCoords[0] ){
			panRight();
		}
		else if (myArray[1] != ad2460.starmap.clusterCoords[1] && myArray[1] < ad2460.starmap.clusterCoords[1] ){
			panUp();
		}
		else if (myArray[1] != ad2460.starmap.clusterCoords[1] && myArray[1] > ad2460.starmap.clusterCoords[1] ){
			panDown();
		}
	}

}

//Direct sideways movement functions
function moveLeft() {
		if (ad2460.starmap.quadrantCoords[0] > 1 && ad2460.starmap.quadrantCoords[0] < 5 && ad2460.starmap.quadrantView == 1) {
				var moveNumber	=  (parseInt(ad2460.starmap.quadrantCoords[1]-1)*4)+(parseInt(ad2460.starmap.quadrantCoords[0]-1));
				zoomInTo(moveNumber);
		}
		else if (ad2460.starmap.sectorCoords[0] > 1 && ad2460.starmap.sectorCoords[0] < 5 && ad2460.starmap.sectorView == 1) {
				var moveNumber	=  (parseInt(ad2460.starmap.sectorCoords[1]-1)*4)+(parseInt(ad2460.starmap.sectorCoords[0]-1));
				zoomInTo(ad2460.starmap.quadrantSquare,moveNumber);
		}
		else if (ad2460.starmap.clusterCoords[0] > 1 && ad2460.starmap.clusterCoords[0] < 5 && ad2460.starmap.clusterView == 1) {
				var moveNumber	=  (parseInt(ad2460.starmap.clusterCoords[1]-1)*4)+(parseInt(ad2460.starmap.clusterCoords[0]-1));
				zoomInTo(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,moveNumber);
		}
		else{ return; }
}

function moveRight() {
		if (ad2460.starmap.quadrantCoords[0] >= 1 && ad2460.starmap.quadrantCoords[0] <= 3 && ad2460.starmap.quadrantView == 1 ) {
				var moveNumber	=  (parseInt(ad2460.starmap.quadrantCoords[1]-1)*4)+(parseInt(ad2460.starmap.quadrantCoords[0]+1));
				zoomInTo(moveNumber);
		}
		else if (ad2460.starmap.sectorCoords[0] >= 1 && ad2460.starmap.sectorCoords[0] <= 3 && ad2460.starmap.sectorView == 1 ) {
				var moveNumber	=  (parseInt(ad2460.starmap.sectorCoords[1]-1)*4)+(parseInt(ad2460.starmap.sectorCoords[0]+1));
				zoomInTo(ad2460.starmap.quadrantSquare,moveNumber);
		}
		else if (ad2460.starmap.clusterCoords[0] >= 1 && ad2460.starmap.clusterCoords[0] <= 3 && ad2460.starmap.clusterView == 1 ) {
				var moveNumber	=  (parseInt(ad2460.starmap.clusterCoords[1]-1)*4)+(parseInt(ad2460.starmap.clusterCoords[0]+1));
				zoomInTo(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,moveNumber);
		}
		else{ return; }
}

function moveUp() {
		if (ad2460.starmap.quadrantCoords[1] > 1 && ad2460.starmap.quadrantCoords[1] < 5 && ad2460.starmap.quadrantView == 1) {
				var moveNumber	=  (parseInt(ad2460.starmap.quadrantCoords[1]-2)*4)+(parseInt(ad2460.starmap.quadrantCoords[0]));
				zoomInTo(moveNumber);
			}
		else if (ad2460.starmap.sectorCoords[1] > 1 && ad2460.starmap.sectorCoords[1] < 5 && ad2460.starmap.sectorView == 1 ) {
				var moveNumber	=  (parseInt(ad2460.starmap.sectorCoords[1]-2)*4)+(parseInt(ad2460.starmap.sectorCoords[0]));
				zoomInTo(ad2460.starmap.quadrantSquare,moveNumber);
		}
		else if (ad2460.starmap.clusterCoords[1] > 1 && ad2460.starmap.clusterCoords[1] < 5 && ad2460.starmap.clusterView == 1 ) {
				var moveNumber	=  (parseInt(ad2460.starmap.clusterCoords[1]-2)*4)+(parseInt(ad2460.starmap.clusterCoords[0]));
				zoomInTo(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,moveNumber);
		}
		else{ return; }
}

function moveDown() {
		if (ad2460.starmap.quadrantCoords[1] >= 1 && ad2460.starmap.quadrantCoords[1] <= 3 && ad2460.starmap.quadrantView == 1 ) {
				var moveNumber	=  (parseInt(ad2460.starmap.quadrantCoords[1])*4)+(parseInt(ad2460.starmap.quadrantCoords[0]));
				zoomInTo(moveNumber);
		}
		else if (ad2460.starmap.sectorCoords[1] >= 1 && ad2460.starmap.sectorCoords[1] <= 3 && ad2460.starmap.sectorView == 1 ) {
				var moveNumber	=  (parseInt(ad2460.starmap.sectorCoords[1])*4)+(parseInt(ad2460.starmap.sectorCoords[0]));
				zoomInTo(ad2460.starmap.quadrantSquare,moveNumber);
		}
		else if (ad2460.starmap.clusterCoords[1] >= 1 && ad2460.starmap.clusterCoords[1] <= 3 && ad2460.starmap.clusterView == 1 ) {
				var moveNumber	=  (parseInt(ad2460.starmap.clusterCoords[1])*4)+(parseInt(ad2460.starmap.clusterCoords[0]));
				zoomInTo(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,moveNumber);
		}
		else{ return; }
}

//Set Zoom out grid clicks for backtracking
function setZoomOutClicks(quadrant,sector,cluster,system){
		ad2460.starmap.quadrantCoords = returnCoordsArray(quadrant);
		ad2460.starmap.sectorCoords = returnCoordsArray(sector);
		ad2460.starmap.clusterCoords = returnCoordsArray(cluster);
		ad2460.starmap.systemCoords = returnCoordsArray(system);
}

//Change BG Images
function setBG(quadrant,viewList) {
	if (viewList.toDepth == 1)	{
		$('#csv2').attr( 'src', 'images/starmap/newgalaxyfull.jpg' );
	}
	else
	{return;}
	/*if (viewList.toDepth == 2)	{
		$('#csv2').attr( 'src', 'images/starmap/quadrant_'+quadrant+'.jpg' ).css({'-webkit-transform': "rotate(0deg)"});
		console.log('Getting img: quadrant_'+quadrant+'.jpg');
	}
	else if (viewList.toDepth == 3)	{
		var bgRandom = 1;
		bgRandom = Math.floor(Math.random()*29)+1;
		rndAngle= Math.floor(Math.random()*4)*90;
		console.log(bgRandom);
		console.log(rndAngle);
		if (bgRandom >= 10) {
		$('#csv2').attr( 'src', 'images/starmap/sec_cls_'+bgRandom+'.jpg' );
		}
		else {
		$('#csv2').attr( 'src', 'images/starmap/sec_cls_0'+bgRandom+'.jpg' );
		}
	}
	else if (viewList.toDepth == 4)	{
		var bgRandom = 1;
		bgRandom = Math.floor(Math.random()*29)+1;
		rndAngle= Math.floor(Math.random()*4)*90;
		console.log(bgRandom);
		console.log(rndAngle);
		if (bgRandom >= 10) {
		$('#csv2').attr( 'src', 'images/starmap/sec_cls_'+bgRandom+'.jpg' );
		}
		else {
		$('#csv2').attr( 'src', 'images/starmap/sec_cls_0'+bgRandom+'.jpg' );
		}
	}
	else if (viewList.toDepth == 5)	{
		$('#csv2').attr( 'src', 'images/starmap/galaxy5.jpg' ).css({'-webkit-transform': "rotate(0deg)"});;
	}*/
}

// Galaxy Zoom
function starmapGalaxyZoom(quadrant) {
		removeStarmapCanvasOverlay();
		//$('#csv2').attr( 'src', 'images/starmap/quadrant_'+quadrant+'.jpg').css({'-webkit-transform': "rotate(0deg)"});
		ad2460.starmap.gridId = 'grid'+parseInt(ad2460.starmap.xgrid+1)+'_'+parseInt(ad2460.starmap.ygrid+1);
		//console.log(ad2460.starmap.xgrid, ad2460.starmap.ygrid);
		//console.log((-(ad2460.starmap.ygrid-1)));
		//Hiding unused transition elements.
		$('#translr').hide();
		$('#transud').hide();

		// Run grid animation
		$('.grid').not('#'+ad2460.starmap.gridId).hide().delay({duration: 800, complete: function() {
				$('#'+ad2460.starmap.gridId).css({top: (ad2460.starmap.ygrid*100-1)+'px', left: (ad2460.starmap.xgrid*100-1)+'px', height: '99px', width: '99px'});
				$('.grid').show().transition({opacity: 1},500);
			}
		});

		$('#'+ad2460.starmap.gridId).transition({top: '0px', left: '0px', height: '400px', width: '400px'},650, 'easeInOutQuad', function() {
				$('#'+ad2460.starmap.gridId).css({top: (ad2460.starmap.ygrid*100-1)+'px', left: (ad2460.starmap.xgrid*100-1)+'px', height: '99px', width: '99px'});
				$('.grid').css({opacity: 0}).delay(150).show().transition({opacity: 1},500);
			}
		);

		$('#csv2').show().css({ zIndex: 1, top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1});
		$('#csv1').show()
			.css({ zIndex: 6 ,top: '0px', left: '0px', height: '400px', width: '400px',opacity: 1,'-webkit-transform': "rotate(0deg)"}).stop()
			.transition( { top: (-(ad2460.starmap.ygrid)*400)+'px', left: (-(ad2460.starmap.xgrid)*400)+'px',height: '1600px', width: '1600px', opacity: 1}, 740, 'easeInOutQuad', function(){
				$('#csv2').transition({opacity: 1},500);
				$('#csv1').transition({opacity: 0},500);
				swapId('csv1','csv2');

			}
		);


// Old Transition
//		$('#csv2').show().css({ zIndex: 1, top: ((ad2460.starmap.ygrid)*100)+'px', left: ((ad2460.starmap.xgrid)*100)+'px', height: '100px', width: '100px', opacity: 1}).stop().transition({top: '-100px', left: '-100px', height: '600px', width: //'600px', opacity: 1}, 800, 'easeInOutQuad');
//		$('#csv1').show()
//			.css({ zIndex: 6 ,top: '0px', left: '0px', height: '400px', width: '400px',opacity: 1,'-webkit-transform': "rotate(0deg)"}).stop()
//			.transition( { top: (-(ad2460.starmap.ygrid)*400)+'px', left: (-(ad2460.starmap.xgrid)*400)+'px',height: '1600px', width: '1600px', opacity: 0.8}, 740, 'easeInOutQuad', function(){
//				$('#csv1').animate({opacity: 0},500);
//				swapId('csv1','csv2');
//
//			}
//		);
		//console.log('I ran!');
}

function starmapGalaxyZoomOut() {
		removeStarmapCanvasOverlay();
		$('#csv2').attr( 'src', 'images/starmap/newgalaxyfull.jpg' );

	// hide transitions not in use
		$('#translr').hide();
		$('#transud').hide();

		// Hide grid, delay and show.
		ad2460.starmap.gridId = 'grid'+parseInt(ad2460.starmap.xgrid+1)+'_'+parseInt(ad2460.starmap.ygrid+1);
		$('.grid').not('#'+ad2460.starmap.gridId).transition({opacity: 0},200).delay(600).transition({opacity: 1},500);

		//console.log('gridId : '+ad2460.starmap.gridId);
		//console.log('X: '+ad2460.starmap.xgrid+', Y: '+ad2460.starmap.ygrid);

		// Animate single grid cell from max to prvious location.
		$('#'+ad2460.starmap.gridId).css({top: '0px', left: '0px', height: '398px', width: '398px'}).delay(200).transition({top: (ad2460.starmap.ygrid*100-1)+'px', left: (ad2460.starmap.xgrid*100-1)+'px', height: '99px', width: '99px'}, 600, 'easeInOutSine');

		// Run zoom effect
		$('#csv1').show().css({top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1, zIndex: 1}).stop().delay(200).animate({ top: ((ad2460.starmap.ygrid)*100)+'px', left: ((ad2460.starmap.xgrid)*100)+'px', height: '100px', width: '100px', opacity: 0},{duration: 600, easing:'easeInOutSine'});
		$('#csv2').show()
			.css({top: -(ad2460.starmap.ygrid*400)+'px', left: -(ad2460.starmap.xgrid*400)+'px', height: '1600px', width: '1600px', opacity: 0, zIndex: 6}, 350)
			.animate({opacity: 0.4},200).animate({top: '0', left: '0px', opacity: 1, height: '400px', width: '400px'}, {duration: 600, easing: 'easeInOutSine', complete: function(){
				swapId('csv1','csv2');
			}
		});
}
function selectPlanet(planet) {
		if (planet > 0) {
				planetClick('planetSelect'+planet, 1);
				//console.log("Select planet called on planet "+planet);
		}
}

function systemSwitch(planet){
		if (!planet){
			planet=1;
		}

		//console.log("Setting selectPlanet Timeout:");
		//ad2460.starmap.planetClickTimeout=setTimeout("selectPlanet("+planet+")", 1500);
		var hidePlanetId = 'viewerplanet'+ad2460.starmap.systemViewVars.currentPlanetSelect;
		var hidePlanetInfo = 'planetinfo'+ad2460.starmap.systemViewVars.currentPlanetSelect;
		removePlanet(hidePlanetId,hidePlanetInfo);
		$('#planetlist').transition({opacity: 0}, 1000, function(){
			$('.viewplanetn').css({transform: 'translate(300px,0px)'});
			ad2460.starmap.systemViewVars.solId=0;
			ad2460.starmap.systemViewVars.oldSol=0;
			ad2460.starmap.systemViewVars.solPlanetSelected=0;
			ad2460.starmap.systemViewVars.previousPlanetSelect=0;
			ad2460.starmap.systemViewVars.currentPlanetSelect=0;
			try{
				renderSolarSystem();
			}
			catch(err){
				//console.log("Unable to render dynamic system in systemSwitch");
			}
			showPlanets();
			directPlanetSelect('planetSelect'+planet, 1);
			hideStarMapInfoSlide();
			}).show().animate({opacity: 1},1000);
		$('#starmap_planetinfo').transition( {opacity: 0},1000);

		//console.log('New System. Planet '+planet+' clicked.');
		$('#coordlist').html('[ '+ad2460.starmap.quadrantSquare+', '+ad2460.starmap.sectorSquare+', '+ad2460.starmap.clusterSquare+', '+ad2460.starmap.systemSquare+' ]');
}

//General function for the zooom
function zoomInTo(quadrant,sector,cluster,system,planet) {

	if ($("#hw_icon").is(':visible')) {		$("#hw_icon").transition({x: 0, y: 0},500,function(){$("#hw_icon").hide();});		}
	if ($("#al_icon").is(':visible')) {		$("#al_icon").transition({x: 0, y: 0},500,function(){$("#al_icon").hide();});		}
	if ($("#mi_icon").is(':visible')) {		$("#mi_icon").transition({x: 0, y: 0},500,function(){$("#mi_icon").hide();});		}
	if ($("#op_icon").is(':visible')) {		$("#op_icon").transition({x: 0, y: 0},500,function(){$("#op_icon").hide();});		}

	hideEspionageOption();
	closeEspionagePanel();
	closeSlides();
	hideMissionSection();
	var rotString = returnMapRotation(quadrant,sector,cluster,system,planet);
	var bgName = returnMapBGName(quadrant,sector,cluster,system,planet);
	$('#csv2').css({'-webkit-transform': "rotate("+rotString+")"});
	$('#csv2').attr( 'src', 'images/starmap/'+bgName);
	if (ad2460.starmap.mapAcceptClick==false){ return; }

	if (!isNaN(quadrant) && (quadrant > 16 || quadrant < 1 )) {
		//console.log('Right... you know there are only 16 sqaures in a 4x4 grid, right?');
		return;
	}
	if (!isNaN(sector) && (sector > 16 || sector < 1)) { console.log('Right... you know there are only 16 sqaures in a 4x4 grid, right?');return; }
	if (!isNaN(cluster) && (cluster > 16 || cluster < 1)) { console.log('Right... you know there are only 16 sqaures in a 4x4 grid, right?');return; }
	if (!isNaN(system) && (system > 16 || system < 1)) { console.log('Right... you know there are only 16 sqaures in a 4x4 grid, right?');return; }
	if (!isNaN(planet) && (planet > 16 || planet < 1)) { console.log('Right... you know there are only 16 sqaures in a 4x4 grid, right?');return; }

	if (static_page==false && cluster>0){
		if (iHaveTheCluster(quadrant,sector,cluster)==false){
			var callbackString="zoomInTo("+quadrant+","+sector+","+cluster;
			if (!isNaN(system)){
				callbackString+=","+system;
			}
			if (!isNaN(planet)){
				callbackString+=","+planet;
			}
			callbackString+=");";

			specialNewLoadClusterContent(quadrant, sector, cluster,callbackString)

			return;
		}
	}

	ad2460.starmap.mapAcceptClick = false;

	// Open the starmap if it is not already open
/*	var i=0;
	var found=false;
	for (i=0;i<ad2460.openSlides.length ;i++ ){
		if (ad2460.openSlides[i]=='starmapslide'){
			found=true;
		}
	}
	if (found==false){
		//closePanels(function(){acceptClick=true;});
		acceptClick=true;
		openSlide('starmapslide');
	}
*/
	if(starMapVisible == 0){
		showStarMapSection();
		ad2460.currentPageSectionId = 'starmapslide';
	}

	// Lets help Christian to know if a planet is selected here!
	ad2460.starmap.getClusterPlanet=planet;

	// Get all variables needed for animations
	var viewList=returnFromToViews(quadrant,sector,cluster,system,planet);
	setBG(quadrant,viewList);

	//Changing view from System view to another system view ( no zoom )
	if (viewList.fromDepth==5 && viewList.toDepth==5 && (ad2460.starmap.quadrantSquare != quadrant || ad2460.starmap.sectorSquare != sector ||ad2460.starmap.clusterSquare != cluster || ad2460.starmap.systemSquare != system ))  {
		systemSwitch(planet);
		ad2460.starmap.animationTimer = 1550;
		setTimeout("animationsComplete()", ad2460.starmap.animationTimer);

		$('#coordlist').html('[ '+ad2460.starmap.quadrantSquare+', '+ad2460.starmap.sectorSquare+', '+ad2460.starmap.clusterSquare+', '+ad2460.starmap.systemSquare+' ]');
		//console.log('Moving to a new system...');
	}
	else if (viewList.fromDepth==5 && viewList.toDepth==5 && (ad2460.starmap.quadrantSquare == quadrant && ad2460.starmap.sectorSquare == sector && ad2460.starmap.clusterSquare == cluster && ad2460.starmap.systemSquare == system ) && ad2460.starmap.systemViewVars.currentPlanetSelect != planet )  {

		selectPlanet(planet);
		ad2460.starmap.animationTimer = 1550;
		setTimeout("animationsComplete()", ad2460.starmap.animationTimer);

		$('#coordlist').html('[ '+ad2460.starmap.quadrantSquare+', '+ad2460.starmap.sectorSquare+', '+ad2460.starmap.clusterSquare+', '+ad2460.starmap.systemSquare+' ]');
		//console.log('Showing new planet in SAME system...');
	}

	else if (viewList.fromDepth==5 && viewList.toDepth==5 && (ad2460.starmap.quadrantSquare == quadrant && ad2460.starmap.sectorSquare == sector && ad2460.starmap.clusterSquare == cluster && ad2460.starmap.systemSquare == system ) && ad2460.starmap.systemViewVars.currentPlanetSelect == planet ){
		//console.log('HAHA. Same place. Not doing anything.');
		animationsComplete();
		return;
	}

	//Galaxy to Quadrant Special zoom.
	else if (viewList.fromDepth==1 && viewList.toDepth==2) {
		getAutoGridClick(quadrant,sector,cluster,system,viewList);
		ad2460.starmap.animationTimer = 1550;
		setTimeout("animationsComplete()", ad2460.starmap.animationTimer);
		starmapGalaxyZoom(quadrant);
	}

	else if (viewList.fromDepth<5 && viewList.toDepth<5) {
		//console.log('Moving in on the starmap.');
		//Zoom In
		if (viewList.fromDepth<viewList.toDepth) {
			getAutoGridClick(quadrant,sector,cluster,system,viewList);
			ad2460.starmap.animationTimer = 1550;
			setTimeout("animationsComplete()", ad2460.starmap.animationTimer);
			starmapZoomIn(viewList);
		}

		//Zoom Out
		else if (viewList.fromDepth>viewList.toDepth) {
			if (viewList.fromDepth ==2 && viewList.toDepth == 1) {
			getAutoGridClickOut(viewList);
			ad2460.starmap.animationTimer = 1550;
			setTimeout("animationsComplete()", ad2460.starmap.animationTimer);
			starmapGalaxyZoomOut();
			}
			else {
			getAutoGridClickOut(viewList);
			ad2460.starmap.animationTimer = 1550;
			setTimeout("animationsComplete()", ad2460.starmap.animationTimer);
			starmapZoomOut(viewList);
			}
		}

		else if (viewList.fromDepth==viewList.toDepth) {
			//console.log("from = to, panning" + quadrant);
			ad2460.starmap.animationTimer = 900;
			setTimeout("animationsComplete()", ad2460.starmap.animationTimer);
			starmapPan(quadrant,sector,cluster);
		}
	}
	else if (viewList.fromDepth<5 && viewList.toDepth==5) {
			getAutoGridClick(quadrant,sector,cluster,system,viewList);
			ad2460.starmap.animationTimer = 1550;
			setTimeout("animationsComplete()", ad2460.starmap.animationTimer);
			starmapZoomIn(viewList);
			var solArray = returnCoordsArray(system);
	}
	else if (viewList.fromDepth==5 && viewList.toDepth<5) {
			var solArray = returnCoordsArray(system);
			ad2460.starmap.animationTimer = 1550;
			setTimeout("animationsComplete()", ad2460.starmap.animationTimer);
			swapBG(viewList);
			hideSol(solArray[0],solArray[1]);
	}

	//Set bactrack variables
	setZoomOutClicks(quadrant,sector,cluster,system);
	//update coordinates to new location
	//console.log("Updating coords with "+quadrant+" "+sector+" "+cluster+" "+system);
	coordsUpdate(quadrant,sector,cluster,system,viewList);

	if (viewList.fromDepth<5 && viewList.toDepth==5) {
		//console.log(viewList);
		ad2460.starmap.animationTimer = 1250;
		setTimeout("animationsComplete()", ad2460.starmap.animationTimer);
		try{
			renderSolarSystem();
		}
		catch(err){
			console.log("Unable to render dynamic system in zoomInTo");
		}
		showSol(solArray[0],solArray[1],planet);
		if (planet > 0) {
			directPlanetSelect('planetSelect'+planet, 1);
		}

	}
	starmapViewLevel();
	zoomOutBar();
	rankViewSelect();
	//console.log('Going to: '+quadrant+', '+sector+', '+cluster+', '+system,planet+' at Depth: '+(viewList.toDepth));
}

function swapBG(viewList) {
		$('#csv1').hide();

		if (viewList.toDepth==1){
				$('#csv2').show()
				.css({top: '0px', left: '0px', height: '400px', width: '400px', opacity: 1});
				swapId('csv1','csv2');
		}
		else {
				$('#csv2').show()
				.css({top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1});
				swapId('csv1','csv2');
		}
}

// Map Movement Functions
function panLeft() {
	$('#trans').hide();
	$('#transud').hide();
	$('.grid').animate({opacity: 0},100).delay(800).animate({opacity: 1},{duration: 300});
	if(ad2460.starmap.quadrantView == 1) {
		$('#csv1').show()
				.css({zIndex: 1, top: '-100px', left: '-100px', height: '600px', width: '600px', clip: 'auto', opacity: 1})
				.animate({top: '-100px', left: '300px', opacity: 1},{duration: 800, easing:'easeInOutCubic', complete: function(){
					$('#csv1').css({top: '-100px', left: '-100px', height: '600px', width: '600px',  clip: 'auto', opacity: 1})
			}
		});
		$('#csv2').show()
				.css({zIndex : 2, top: '-100px', left: '-500px', height: '600px', width: '600px', clip: 'rect(100px 500px 500px 100px)', opacity: 1})
				.animate({top: '-100px', left: '-100px', opacity: 1},{duration: 800,  easing:'easeInOutCubic', complete: function(){
					$('#csv2').css({top: '-100px', left: '-100px', height: '600px', width: '600px', clip: 'auto', opacity: 1})
					swapId('csv1','csv2');
			}
		});
	}

	else {
		$('#csv1').show()
				.css({zIndex: 2, top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1})
				.animate({top: '-100px', left: '000px', height: '600px', width: '600px', opacity: 0},{duration: 300});
		$('#csv2').show()
				.css({top: '-100px', left: '-200px', height: '600px', width: '600px', opacity: 0})
				.delay(500)
				.animate({top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1},{duration: 300, complete: function(){
					swapId('csv1','csv2');
					//starmapViewLevel();
				}});
		$('#translr').show()
				.css({zIndex: 1,top: '-000px', left: '-400px', height: '400px', width: '800px', opacity: 1})
				.animate({ left: '000px', opacity: 1},{duration: 800 ,complete: function(){
					$('#translr').hide();
			}
		});
	}
}

function panRight() {
	$('#trans').hide();
	$('#transud').hide();
	$('.grid').animate({opacity: 0},100).delay(600).animate({opacity: 1},{duration: 300});
	if(ad2460.starmap.quadrantView == 1) {
		$('#csv1').show()
				.css({zIndex: 1, top: '-100px', left: '-100px', height: '600px', width: '600px', clip: 'auto', opacity: 1})
				.animate({top: '-100px', left: '-500px', opacity: 1},{duration: 800, easing:'easeInOutCubic', complete: function(){
					$('#csv1').css({top: '-100px', left: '-100px', height: '600px', width: '600px',  clip: 'auto', opacity: 1})
			}
		});
		$('#csv2').show()
				.css({zIndex : 2, top: '-100px', left: '300px', height: '600px', width: '600px', clip: 'rect(100px 500px 500px 100px)', opacity: 1})
				.animate({top: '-100px', left: '-100px', opacity: 1},{duration: 800,  easing:'easeInOutCubic', complete: function(){
					$('#csv2').css({top: '-100px', left: '-100px', height: '600px', width: '600px', clip: 'auto', opacity: 1})
					swapId('csv1','csv2');
			}
		});
	}
	else {
		$('#csv1').show()
				.css({zIndex: 2, top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1})
				.animate({top: '-100px', left: '-200px', height: '600px', width: '600px', opacity: 0},{duration: 300});
		$('#csv2').show()
				.css({top: '-100px', left: '000px', height: '600px', width: '600px', opacity: 0})
				.delay(500)
				.animate({top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1},{duration: 300, complete: function() {
					swapId('csv1','csv2');
					//starmapViewLevel();
				}});
		$('#translr').show()
				.css({zIndex: 1, top: '-000px', left: '000px', height: '400px', width: '800px', opacity: 1})
				.animate({ left: '-400px', opacity: 1},{duration: 800,complete: function(){
					$('#translr').hide();
			}
		});
	}
}

function panUp() {
	$('#trans').hide();
	$('#translr').hide();
	$('.grid').animate({opacity: 0},100).delay(600).animate({opacity: 1},{duration: 300});
	if(ad2460.starmap.quadrantView == 1) {
		$('#csv1').show()
				.css({zIndex: 1, top: '-100px', left: '-100px', height: '600px', width: '600px', clip: 'auto', opacity: 1})
				.animate({top: '300px', left: '-100px', opacity: 1},{duration: 800, easing:'easeInOutCubic', complete: function(){
					$('#csv1').css({top: '-100px', left: '-100px', height: '600px', width: '600px',  clip: 'auto', opacity: 1})
			}
		});
		$('#csv2').show()
				.css({zIndex : 2, top: '-500px', left: '-100px', height: '600px', width: '600px', clip: 'rect(100px 500px 500px 100px)', opacity: 1})
				.animate({top: '-100px', left: '-100px', opacity: 1},{duration: 800,  easing:'easeInOutCubic', complete: function(){
					$('#csv2').css({top: '-100px', left: '-100px', height: '600px', width: '600px', clip: 'auto', opacity: 1})
					swapId('csv1','csv2');
			}
		});
	}
	else {
		$('#csv1').show()
				.css({zIndex: 2, top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1})
				.animate({top: '000px', left: '-100px', height: '600px', width: '600px', opacity: 0},{duration: 300});
		$('#csv2').show()
				.css({top: '-200px', left: '-100px', height: '600px', width: '600px', opacity: 0})
				.delay(500).animate({top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1},{duration: 300, complete: function() {
					swapId('csv1','csv2');
					//starmapViewLevel();
				}});
		$('#transud').show().css({zIndex: 1, top: '-400px', left: '000px', height: '800px', width: '400px', opacity: 1})
				.animate({top: '0px', opacity: 1},{duration: 800,complete: function(){
					$('#transud').hide();
			}
		});
	}
}

function panDown() {
	$('#trans').hide();
	$('#translr').hide();
	$('.grid').animate({opacity: 0},100).delay(600).animate({opacity: 1},{duration: 300});
	if(ad2460.starmap.quadrantView == 1) {
		$('#csv1').show()
				.css({zIndex: 1, top: '-100px', left: '-100px', height: '600px', width: '600px', clip: 'auto', opacity: 1})
				.animate({top: '-500px', left: '-100px', opacity: 1},{duration: 800, easing:'easeInOutCubic', complete: function(){
					$('#csv1').css({top: '-100px', left: '-100px', height: '600px', width: '600px',  clip: 'auto', opacity: 1})
			}
		});
		$('#csv2').show()
				.css({zIndex : 2, top: '300px', left: '-100px', height: '600px', width: '600px', clip: 'rect(100px 500px 500px 100px)', opacity: 1})
				.animate({top: '-100px', left: '-100px', opacity: 1},{duration: 800,  easing:'easeInOutCubic', complete: function(){
					$('#csv2').css({top: '-100px', left: '-100px', height: '600px', width: '600px', clip: 'auto', opacity: 1})
					swapId('csv1','csv2');
			}
		});
	}
	else {
		$('#csv1').show()
				.css({zIndex: 2, top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1})
				.animate({top: '-200px', left: '-100px', height: '600px', width: '600px', opacity: 0},{duration: 300});
		$('#csv2').show()
				.css({top: '000px', left: '-100px', height: '600px', width: '600px', opacity: 0})
				.delay(500)
				.animate({top: '-100px', left: '-100px', height: '600px', width: '600px', opacity: 1},{duration: 300, complete: function() {
					swapId('csv1','csv2');
					//starmapViewLevel();
				}});
		$('#transud').show()
				.css({zIndex: 1, top: '000px', left: '000px', height: '800px', width: '400px', opacity: 1})
				.animate({top: '-400px', opacity: 1},{duration: 800,complete: function(){
					$('#transud').hide();
			}
		});
	}
}

function hoverGrid(gridId,xgrid,ygrid){
	ad2460.starmap.prevGridId = ad2460.starmap.gridId;
	$('#'+ad2460.starmap.gridId).addClass('gridhover');
}

function unhoverGrid(){
	$('#'+ad2460.starmap.prevGridId).removeClass('gridhover');
	ad2460.starmap.prevGridId = 0;
}

//Solar System Functions

function showSol(gridX,gridY,planet){
	//console.log("ShowSol called : ",gridX,gridY,planet);
	ad2460.starmap.selectedSolX=gridX;
	ad2460.starmap.selectedSolY=gridY;

	showPlanets(planet);
	$('#starfieldcontainer').hide();
	$('.star_nav_panel').hide();
	$('#planetlist').css({left: '13px', opacity: 1}).show();
	$('#solrings').css({opacity: 0}).show().delay(500).animate({opacity: 1},1500);
	$('#planetviewer').show().delay(500).animate( {opacity: 1} ,500);
	$('#notes').animate( {left: '-225px'}, 500);
	$('#planetviewcontainer').delay(0).transition( {x: -280} ,500);
	ad2460.starmap.solIsShown=true;
}

function showPlanets(planet) {
	//console.log("showPlanets("+planet+")");
	var i=1;
	system1Array = [0,-132,-122,-118,-115,-106,-96,-108,-100,-74,-66,-78,-80,-48,-58,-62,-65];
	system2Array = [0,-132,-122,-118,-115,-106,-96,-108,-100,-74,-66,-78,-80,-48,-58,-62,-65];
	system3Array = [0,-132,-122,-118,-115,-106,-96,-108,-100,-74,-66,-78,-80,-48,-58,-62,-65];
	system4Array = [0,-132,-122,-118,-115,-106,-96,-108,-100,-74,-66,-78,-80,-48,-58,-62,-65];
	system5Array = [0,-132,-122,-118,-115,-106,-96,-108,-100,-74,-66,-78,-80,-48,-58,-62,-65];
	system6Array = [0,-132,-122,-118,-115,-106,-96,-108,-100,-74,-66,-78,-80,-48,-58,-62,-65];


	// Old Systems
	//system2Array = [0,-80,185,26,-55,268,10,243,6,-46,274,-53,-20,-50,300,301,-28];
	//system3Array = [0,-31,257,85,0,75,-22,42,-20,60,40,17,-15,47,19,13,-28];
	//system4Array = [0,107,120,103,71,116,68,113,41,60,89,49,66,84,81,70,-28];
	//system5Array = [0,148,123,150,158,160,155,108,98,161,120,130,128,98,73,145,-28];
	//system6Array = [0,282,248,280,254,289,302,266,270,300,290,260,296,241,323,300,-28];

//	for (i=1;i<=15 ;i++ ){
//		ad2460.starmap.systemViewVars.planetCoords[i].left=$('#solplanet_'+i).css("left");
//		ad2460.starmap.systemViewVars.planetCoords[i].top=$('#solplanet_'+i).css("top");
//	}
//	console.log(ad2460.starmap.systemViewVars.planetCoords[1].top)

	$('.solplanet_container .solplanet_label').css( {opacity: 1, transform: 'translate(-30px,0px)'});
	for (i=0;i<=16 ;i++ ){
		var systemNumber = returnInteger($('#planetlist').attr('class'));
		var systemArray;
		if (systemNumber==1){	systemArray=system1Array;		}
		if (systemNumber==2){	systemArray=system2Array;		}
		if (systemNumber==3){	systemArray=system3Array;		}
		if (systemNumber==4){	systemArray=system4Array;		}
		if (systemNumber==5){	systemArray=system5Array;		}
		if (systemNumber==6){	systemArray=system6Array;		}

		var translation = 'translate(0px,0px) scale(0.80) rotate('+systemArray[(i)]+'deg)';
		if ( $('.solplanet_container .solplanet_image.planet_'+i).hasClass('station')){
			translation = 'translate(0px,0px) scale(0.80) rotate(0deg)';
		}
		$('.solplanet_container .solplanet_image.planet_'+i).css( {opacity: 1, height: 80, width: 80,transform: translation});
	}
	$('.solplanet_container').show().delay(250).animate( { opacity: 1 }, {duration: 1250, complete: function(){}});
}


function hideSol() {
	$('#starfieldcontainer').css({opacity: 0}).show().delay(150).animate( {opacity: 1} ,500);
	$('.star_nav_panel').show();
	$('#solrings').animate({opacity: 0},{duration: 500, complete: function (){$('.solrings').hide();}} );
	$('#planetlist').animate( {opacity: 0} , {duration: 500, complete: function (){$('#planetlist').hide();}} );
	$('#planetviewer').animate( {opacity: 0} , {duration: 500, complete: function(){$('#planetviewer').hide();}});
	$('#universeview').show().delay(350).animate( {opacity: 1} ,500);
	$('#sliderfield').delay(350).animate( {opacity: 1} ,500);
	$('#planetviewcontainer').delay(0).transition( {x: 0} ,500);
	$('#notes').animate( {left: '36px'}, 500);
//	$('.viewplanetn').css( {left: '300px'});
	$('.viewplanetn').css({transform: 'translate(300px,0px)'});
	$('#starmap_planetinfo').css( {opacity: 0});
	hidePlanets();
	hideStarMapInfoSlide();
	ad2460.starmap.systemViewVars.solId=0;
	ad2460.starmap.systemViewVars.oldSol=0;
	ad2460.starmap.systemViewVars.solPlanetSelected=0;
	ad2460.starmap.systemViewVars.previousPlanetSelect=0;
	ad2460.starmap.systemViewVars.currentPlanetSelect=0;
	ad2460.starmap.solIsShown=false;
}

function hidePlanets(){
	$('.solplanet_container .solplanet_image').css( {opacity: 1});
	$('.solplanet_container .solplanet_label').css( {opacity: 1});
	$('.solplanet_container').animate( {opacity: 0}, 250);
	ad2460.starmap.solIsShown=false;
}


// Planet Expansion Functions
function directPlanetSelect(clickId,mapZoom) {
		if ( ad2460.starmap.mapAcceptClick == true || mapZoom == 1 ){
				ad2460.starmap.mapAcceptClick = false;
				setTimeout('ad2460.starmap.mapAcceptClick=true',800);
				ad2460.starmap.systemViewVars.oldSol = ad2460.starmap.systemViewVars.solId;
				ad2460.starmap.systemViewVars.solId = clickId;

				ad2460.starmap.systemViewVars.previousPlanetSelect = returnInteger(ad2460.starmap.systemViewVars.currentPlanetSelect);
				ad2460.starmap.systemViewVars.currentPlanetSelect = returnInteger(clickId.match(/\d+/));
				var showPlanetId = 'viewerplanet'+ad2460.starmap.systemViewVars.currentPlanetSelect;
				var showPlanetInfo = 'planetinfo'+ad2460.starmap.systemViewVars.currentPlanetSelect;
				ad2460.starmap.systemViewVars.topsol_old	= parseInt($('#'+ad2460.starmap.systemViewVars.oldSol+'.solplanet_container').css('top'));
				ad2460.starmap.systemViewVars.leftsol_old	= parseInt($('#'+ad2460.starmap.systemViewVars.oldSol+'.solplanet_container').css('left'));
				ad2460.starmap.systemViewVars.topsol		= parseInt($('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css('top'));
				ad2460.starmap.systemViewVars.leftsol		= parseInt($('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css('left'));
				//$('#'+ad2460.starmap.systemViewVars.solId+' .solplanet_image').css( {height: 60, width: 60}, 300);
				//$('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css( {top: ad2460.starmap.systemViewVars.topsol-20+'px', left: ad2460.starmap.systemViewVars.leftsol-20+'px'}, 300);
				ad2460.starmap.systemViewVars.solPlanetSelected=1;
				showPlanetRight(showPlanetId, showPlanetInfo, clickId);
				expandSelectedPlanet();
		}
}

function planetClick(clickId,mapZoom){
	if ( ad2460.starmap.mapAcceptClick == true || mapZoom == 1 ){
		ad2460.starmap.mapAcceptClick = false;
		setTimeout('ad2460.starmap.mapAcceptClick=true',800);
		ad2460.starmap.systemViewVars.oldSol = ad2460.starmap.systemViewVars.solId;
		ad2460.starmap.systemViewVars.solId = clickId;
		ad2460.starmap.systemViewVars.previousPlanetSelect = returnInteger(ad2460.starmap.systemViewVars.currentPlanetSelect);
		ad2460.starmap.systemViewVars.currentPlanetSelect = returnInteger(clickId.match(/\d+/));
		ad2460.starmap.getClusterPlanet=ad2460.starmap.systemViewVars.currentPlanetSelect;
		//console.log('Previous : '+previousPlanetSelect, 'Current: '+currentPlanetSelect);
		if (ad2460.starmap.systemViewVars.previousPlanetSelect < ad2460.starmap.systemViewVars.currentPlanetSelect) {
			var showPlanetId = 'viewerplanet'+ad2460.starmap.systemViewVars.currentPlanetSelect;
			var hidePlanetId = 'viewerplanet'+ad2460.starmap.systemViewVars.previousPlanetSelect;
			var showPlanetInfo = 'planetinfo'+ad2460.starmap.systemViewVars.currentPlanetSelect;
			var hidePlanetInfo = 'planetinfo'+ad2460.starmap.systemViewVars.previousPlanetSelect;
			//console.log('ShowId: '+showPlanetId, 'HideId: '+hidePlanetId);

			showPlanetRight(showPlanetId, showPlanetInfo, clickId);
			hidePlanetLeft(hidePlanetId, hidePlanetInfo, clickId);
			hideStarMapInfoSlide();
		}
		else if (ad2460.starmap.systemViewVars.previousPlanetSelect > ad2460.starmap.systemViewVars.currentPlanetSelect) {
			var showPlanetId = 'viewerplanet'+ad2460.starmap.systemViewVars.currentPlanetSelect;
			var hidePlanetId = 'viewerplanet'+ad2460.starmap.systemViewVars.previousPlanetSelect;
			var showPlanetInfo = 'planetinfo'+ad2460.starmap.systemViewVars.currentPlanetSelect;
			var hidePlanetInfo = 'planetinfo'+ad2460.starmap.systemViewVars.previousPlanetSelect;
			//console.log('ShowId: '+showPlanetId, 'HideId: '+hidePlanetId);
			showPlanetLeft(showPlanetId, showPlanetInfo, clickId);
			hidePlanetRight(hidePlanetId, hidePlanetInfo, clickId);
			hideStarMapInfoSlide();
		}
		else {
			updateStarmapSelectedPlanetInfo();
		}
		expandSelectedPlanet();
		hideStarMapInfoSlide();
		closeEspionagePanel();
		hideEspionageOption();
	}
}


function expandSelectedPlanet() {
	ad2460.starmap.systemViewVars.topsol_old	= parseInt($('#'+ad2460.starmap.systemViewVars.oldSol+'.solplanet_container').css('top'));
	ad2460.starmap.systemViewVars.leftsol_old	= parseInt($('#'+ad2460.starmap.systemViewVars.oldSol+'.solplanet_container').css('left'));
	ad2460.starmap.systemViewVars.topsol		= parseInt($('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css('top'));
	ad2460.starmap.systemViewVars.leftsol		= parseInt($('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css('left'));
	var planetBorder = 'rgba(220, 255, 220, 0.296875) 0px 0px 10px 5px, inset 0px 0px 11px rgba(0,0,0,0.3)';
	var revertBorder = 'rgba(255, 255, 255, 0.296875) 0px 0px 5px, inset 0px 0px 11px rgba(0,0,0,0.3)';

	if (ad2460.starmap.systemViewVars.solId == ad2460.starmap.systemViewVars.oldSol && ad2460.starmap.systemViewVars.solPlanetSelected == 1 ) {
		$('#'+ad2460.starmap.systemViewVars.oldSol+' .solplanet_image').transition({ scale:0.80, boxShadow: revertBorder},300);
		$('#'+ad2460.starmap.systemViewVars.oldSol+' .op').transition({transform: 'translate(-30px,0px)' },300);
//		$('#'+ad2460.starmap.systemViewVars.solId+' .solplanet_image').animate( {height: 20, width: 20}, 300);
//		$('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css({zIndex: 1}).animate( {top: ad2460.starmap.systemViewVars.topsol+20+'px', left: ad2460.starmap.systemViewVars.leftsol+20+'px'}, 300);
		ad2460.starmap.systemViewVars.solPlanetSelected=0;
	}

	else if (ad2460.starmap.systemViewVars.solId == ad2460.starmap.systemViewVars.oldSol && ad2460.starmap.systemViewVars.solPlanetSelected == 0 ) {
		$('#'+ad2460.starmap.systemViewVars.solId+' .solplanet_image').transition({ scale:1, boxShadow: planetBorder},300);
		$('#'+ad2460.starmap.systemViewVars.solId+' .op').transition({transform: 'translate(3px,0px)' },300);
//		$('#'+ad2460.starmap.systemViewVars.solId+' .solplanet_image').animate( {height: 60, width: 60}, 300);
//		$('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css({zIndex: 5}).animate( {top: ad2460.starmap.systemViewVars.topsol-20+'px', left: ad2460.starmap.systemViewVars.leftsol-20+'px'}, 300);
		ad2460.starmap.systemViewVars.solPlanetSelected=1;
	}

	else if (ad2460.starmap.systemViewVars.solId != ad2460.starmap.systemViewVars.oldSol  && ad2460.starmap.systemViewVars.solPlanetSelected == 1) {
//		$('#'+ad2460.starmap.systemViewVars.solId+' .solplanet_image').animate( {height: 60, width: 60}, 300);
		$('#'+ad2460.starmap.systemViewVars.solId+' .solplanet_image').transition({ scale:1,  boxShadow: planetBorder},300);
		$('#'+ad2460.starmap.systemViewVars.solId+' .op').transition({transform: 'translate(3px,0px)' },300);
//		$('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css({zIndex: 5}).animate( {top: ad2460.starmap.systemViewVars.topsol-20+'px', left: ad2460.starmap.systemViewVars.leftsol-20+'px'}, 300);
		$('#'+ad2460.starmap.systemViewVars.oldSol+' .solplanet_image').transition({ scale:0.80, boxShadow: revertBorder},300);
		$('#'+ad2460.starmap.systemViewVars.oldSol+' .op').transition({transform: 'translate(-30px,0px)' },300);
//		$('#'+ad2460.starmap.systemViewVars.oldSol+' .solplanet_image').animate( {height: 20, width: 20}, 300);
//		$('#'+ad2460.starmap.systemViewVars.oldSol+'.solplanet_container').css({zIndex: 1}).animate( {top: ad2460.starmap.systemViewVars.topsol_old+20+'px', left: ad2460.starmap.systemViewVars.leftsol_old+20+'px'}, 300);
		ad2460.starmap.systemViewVars.solPlanetSelected=1;
	}

	else if (ad2460.starmap.systemViewVars.solId != ad2460.starmap.systemViewVars.oldSol && ad2460.starmap.systemViewVars.solPlanetSelected == 0) {
		$('#'+ad2460.starmap.systemViewVars.solId+' .solplanet_image').transition({ scale:1,  boxShadow: planetBorder},300);
		$('#'+ad2460.starmap.systemViewVars.solId+' .op').transition({transform: 'translate(3px,0px)' },300);
//		$('#'+ad2460.starmap.systemViewVars.solId+' .solplanet_image').animate( {height: 60, width: 60}, 300);
//		$('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css({zIndex: 5}).animate( {top: ad2460.starmap.systemViewVars.topsol-20+'px', left: ad2460.starmap.systemViewVars.leftsol-20+'px'}, 300);
		ad2460.starmap.systemViewVars.solPlanetSelected=1;
	}

	// We need to get the data for the planet here.
	var planet=returnPlanet(ad2460.starmap.systemViewVars.currentPlanetSelect);
	if (planet){
		var coords=convertShortCoordsToLongCoords(planet.x,planet.y);
		$("#coordlist").html("(COORDS:"+coords.coordString+")");
	}

}

function minimizePlanet(){
	ad2460.starmap.systemViewVars.topsol_old	= parseInt($('#'+ad2460.starmap.systemViewVars.oldSol+'.solplanet_container').css('top'));
	ad2460.starmap.systemViewVars.leftsol_old	= parseInt($('#'+ad2460.starmap.systemViewVars.oldSol+'.solplanet_container').css('left'));
	ad2460.starmap.systemViewVars.topsol		= parseInt($('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css('top'));
	ad2460.starmap.systemViewVars.leftsol		= parseInt($('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css('left'));
	$('#'+ad2460.starmap.systemViewVars.oldSol+' .solplanet_image').transition({ scale:0.80, boxShadow: revertBorder},300);
	$('#'+ad2460.starmap.systemViewVars.oldSol+' .op').transition({transform: 'translate(-30px,0px)' },300);
//	$('#'+ad2460.starmap.systemViewVars.solId+' .solplanet_image').animate( {height: 20, width: 20}, 300);
//	$('#'+ad2460.starmap.systemViewVars.solId+'.solplanet_container').css({zIndex: 1}).animate( {top: ad2460.starmap.systemViewVars.topsol+20+'px', left: ad2460.starmap.systemViewVars.leftsol+20+'px'}, 300);
}

// Map Link Functions
//function ShowMapLinkInfo() {
//	$(".link_note").stop().animate( { width : "218px" } );
//}

//function HideMapLinkInfo() {
//	$(".link_note").stop().animate( { width : "0px" } );
//}

//function ShowMapLinkInfoEdit() {
//	$(".link_note").stop().animate( { width : "218px" } );
//}

//function HideMapLinkInfoEdit() {
//	$(".link_note").stop().animate( { width : "0px" } );
//}

function hoverLinkButton(linkButtonId){
	$("#"+linkButtonId+" .linkbuttonregular").stop().animate ( {opacity: 0 }, 500  );
	$("#"+linkButtonId+" .linkbuttonhover").stop().animate ( {opacity: 1 }, 500  );
}
function unhoverLinkButton(linkButtonId){
	$("#"+linkButtonId+" .linkbuttonregular").stop().animate ( {opacity: 1 }, 500  );
	$("#"+linkButtonId+" .linkbuttonhover").stop().animate ( {opacity: 0 }, 500  );
}

// Search functions

function showPlayerResults() {
	$('#player_scroller').css({top: '0px'});
	$('#searchplayers').delay(200).fadeIn(300);
	$('#searchalliances').hide();
	$('#searchplanets').hide();
	$('#searchline').stop().animate( {left: '15px'},500);
	$('#searchline_link').animate( {left: '44px'},500);
	//console.log('Showing Players...');
}

function showAllianceResults() {
	$('#searchplayers').hide();
	$('#alliance_scroller').css({top: '0px'});
	$('#searchalliances').delay(200).fadeIn(300);
	$('#searchplanets').hide();
	$('#searchline').stop().animate( {left: '108px'},500);
	$('#searchline_link').stop().animate( {left: '138px'},500);
	//console.log('Showing Alliances...');
}

function showPlanetResults() {
	$('#searchplayers').hide();
	$('#searchalliances').hide();
	$('#planet_scroller').css({top: '0px'});
	$('#searchplanets').delay(200).fadeIn(300);
	$('#searchline').stop().animate( {left: '200px'},500);
	$('#searchline_link').stop().animate( {left: '230px'},500);
	//console.log('Showing Planets...');
}

//Claim planet

function openPlanetClaim() {
	myHeight = parseInt($('#planet_claim_1').height());
	mySlide =  162-(myHeight-30);
	$('#claimtext_info').html('Select outpost to put in orbit.');
	$('.outpost_claim_icon').show();
	$(".planetinfo_claim").transition( {top: mySlide, height: (myHeight+8)},500);
}

function closePlanetClaim() {
	$(".planetinfo_claim").transition( {top: '162px', height: '38px'},500, function(){$('#claimtext_info').html('Click to deploy outpost.'); $('.outpost_claim_icon').hide();});
}

function openEspionagePanel() {
	$(".espionage_field").show();
	myHeight = parseInt($('.espionage_field_container').height());
	mySlide =  (myHeight+60);
	$(".espionage_field").stop().transition( { height: mySlide+"px"},500);
	closePlanetClaim();
}

function closeEspionagePanel() {
	$(".espionage_field").transition( {height: '0px'},500, function(){$(".espionage_field").hide();});
}

function showStarmapLegend(){
	$('.legend_panel').show().transition({opacity:1},400);
	starmapLegendOpen = 1;
}
function hideStarmapLegend(){
	$('.legend_panel').transition({opacity:0},400, function(){$('.legend_panel').hide()});
	starmapLegendOpen = 0;
}

// Prospect List
function showProspectList() {
	$("#prospecting_list").stop().animate( { width : "220px" } );
}

function hideProspectList() {
	$("#prospecting_list").stop().animate( { width : "0px" } );
}

//Issue bounty

function openBountyIssue() {
	myHeight = parseInt($('#issue_bounty').height());
	mySlide =  142-(myHeight-30);
	$(".bounty_issue_container").stop().animate({top: mySlide, height: (myHeight+8)},500);
	//$('#bounty_issue_help').html('Place bounty, or cancel to close.');
}

function closeBountyIssue() {
	$(".bounty_issue_container").stop().animate( {top: '142px', height: '38px'},500);
	//$('#bounty_issue_help').html('Click to place bounty.');
}


// Click Functions

$(document).ready(function(){
		$(".grid").click(
		function() {
		//Check which sqaure was clicked, put in array.
			ad2460.starmap.gridcoords = ($(this).attr('id')).match(/\d+/ig);
			if (ad2460.starmap.galaxyView == 1) {
				ad2460.starmap.quadrantCoords = ad2460.starmap.gridcoords;
				var quadrantSquareClick	=  (parseInt(ad2460.starmap.quadrantCoords[1]-1)*4)+(parseInt(ad2460.starmap.quadrantCoords[0]));
			}
			if (ad2460.starmap.quadrantView == 1) {
				ad2460.starmap.sectorCoords = ad2460.starmap.gridcoords;
				var quadrantSquareClick	=  ad2460.starmap.quadrantSquare;
				var sectorSquareClick 	=  (parseInt(ad2460.starmap.sectorCoords[1]-1)*4)+(parseInt(ad2460.starmap.sectorCoords[0]));
			}
			if (ad2460.starmap.sectorView == 1) {
				ad2460.starmap.clusterCoords = ad2460.starmap.gridcoords;
				var quadrantSquareClick	=  ad2460.starmap.quadrantSquare;
				var sectorSquareClick 	=  ad2460.starmap.sectorSquare;
				var clusterSquareClick 	=  (parseInt(ad2460.starmap.clusterCoords[1]-1)*4)+(parseInt(ad2460.starmap.clusterCoords[0]));
			}
			if (ad2460.starmap.clusterView == 1) {
				ad2460.starmap.systemCoords = ad2460.starmap.gridcoords;
				var quadrantSquareClick	=  ad2460.starmap.quadrantSquare;
				var sectorSquareClick 	=  ad2460.starmap.sectorSquare;
				var clusterSquareClick 	=  ad2460.starmap.clusterSquare;
				var systemSquareClick 	=  (parseInt(ad2460.starmap.systemCoords[1]-1)*4)+(parseInt(ad2460.starmap.systemCoords[0]));
				//console.log("Christian: SystemSquareClick is "+systemSquareClick);
			}

		//Run Zoom animation
			zoomInTo(quadrantSquareClick,sectorSquareClick,clusterSquareClick,systemSquareClick);
		}

	);
});

$(document).ready(function(){
	$(".grid").hover(
		function() {
			ad2460.starmap.gridId = $(this).attr("id");
			ad2460.starmap.gridcoords = ($(this).attr('id')).match(/\d+/ig);
			ad2460.starmap.xgrid = ad2460.starmap.gridcoords[0]-1;
			ad2460.starmap.ygrid = ad2460.starmap.gridcoords[1]-1;
			//hoverGrid(gridId,xgrid,ygrid);
		},
		function() {
			unhoverGrid();
		}
	);
});

//$(document).ready(function() {
//	$(".starmap_entryline").click(function(){
//	if (maplink_note == 0) {
//		ShowMapLinkInfo();
//		maplink_note = 1;
//		}
//	else if (maplink_note==1) {
//		HideMapLinkInfo();
//		maplink_note = 0;
//		}
//	});
//});

$(document).ready(function() {
	$(".starmap_entryline img").click(function(){ ShowMapLinkInfoEdit(); },
		  function(){ HideMapLinkInfo();
	});
});

$(document).ready(function() {
	$("#seachresultplayers").click(function(){
		showPlayerResults();
	});
});

$(document).ready(function() {
	$("#seachresultalliances").click(function(){
	showAllianceResults();
	});
});

$(document).ready(function() {
	$("#seachresultplanets").click(function(){
	showPlanetResults();
	});
});

$(document).ready(function() {
	$(".linkbutton").hover(
		function(){
			linkButtonId = $(this).attr("id");
			hoverLinkButton(linkButtonId);
			//console.log('Hovering...');
		},
		function(){
			//console.log('Unhovering...')
			unhoverLinkButton(linkButtonId);
	});
});

$(document).ready(function() {

	$("#sidebar_toggle_search").click(function(){
			$('#starmap_link_panel').css({ opacity: 0}).hide();
			$('#starmap_search_panel').show().css({ opacity: 1});
			$('#sidebar_toggle_search').addClass('starmap_side_header_selected');
			$('#sidebar_toggle_links').removeClass('starmap_side_header_selected');
			$('#sidebar_selection_line_02').animate({left: '60px'}, 500);

	});
	$("#sidebar_toggle_links").click(function(){
			$('#starmap_link_panel').show().css({ opacity: 1});
			$('#starmap_search_panel').css({ opacity: 0}).hide();
			$('#sidebar_toggle_search').removeClass('starmap_side_header_selected');
			$('#sidebar_toggle_links').addClass('starmap_side_header_selected');
			$('#sidebar_selection_line_02').animate({left: '210px'}, 500);
			if (static_page==0){
				renderPlayerLinks();
			}
	});
});

$(document).ready(function() {
//	$('#planet_add_info').toggle(function(){
//		showPlanetInfoAdd();
//	},
//	function() {
//		hideStarMapInfoSlide();
//	});

	if (static_page==false){
		$('#planet_player_info').click(function(){
			if(PlayerAllianceInfoOpen == 0) {
				showPlanetOwnerInfo();
			}
			else if(PlayerAllianceInfoOpen == 1) {
				hideStarMapInfoSlide();
			}
		});
	}
	$('#planet_espionage_option').click(function(){
		if(EspionageOptionOpen == 0) {
			showEspionageOption();
		}
		else if(EspionageOptionOpen == 1) {
			hideEspionageOption();
		}
	});
	$('#bottomslider_close').click(function(){
		hideStarMapInfoSlide();
		PlayerAllianceInfoOpen = 0;
	});

	$('#planet_alliance_info').toggle(function(){
		showPlanetOwnerAlliance();
	},
	function() {
		hideStarMapInfoSlide();
	});

	$('#planet_alliance_info').toggle(function(){
		showPlanetOwnerAlliance();
	},
	function() {
		hideStarMapInfoSlide();
	});

	if (static_page==1){
		$('#starmap_spy').click(function(){
			openEspionagePanel();
			closeBountyIssue();
			closePlanetClaim();
		});
	}

	$('#start_spy').click(function(){
		showEspionageOption();
	});
});

$(document).ready(function() {
	$("#open_claim").click(function(){
	openPlanetClaim();
	closeEspionagePanel();
	});
});

$(document).ready(function() {
	$("#open_bounty").click(function(){
	openBountyIssue();
	closeEspionagePanel();
	});
});

$(document).ready(function() {
	$(".star_nav_legend").click(function(){

	if(starmapLegendOpen == 0) {showStarmapLegend();}
	else {
		hideStarmapLegend();
	}
	closeEspionagePanel();
	});
});
function timer(id, domIds, domProgressIndicators, start, end, callback){
	this.id=id;
	this.domIds=domIds;
	this.domProgressIndicators=domProgressIndicators;
	this.start=start;
	this.end=end;
	this.callback=callback;	
}

function returnTimerById(id){
	for (i=0;i<ad2460.timers.length ;i++ ){
		if (ad2460.timers[i].id==id){
			return ad2460.timers[i];
		}
	}
	return false;
}

function registerNewTimer(id, domIds, domProgressIndicators, start, end, callback){
	// Add this to an array of live timers
	// Then each second we need to go through these timers and update the id's with the right time.
	// if there is already a timer with the same ID, that timer must be cleared and reset.
	// When a timer reaches 0 it must be cleared, and the callback must be processed.
	var i=0;
	var update=false;
	for (i=0;i<ad2460.timers.length ;i++ ){
		if (ad2460.timers[i].id==id){
			ad2460.timers[i].start=start;
			ad2460.timers[i].end=end;
			ad2460.timers[i].callback=callback;
			update=true;
		}
	}

	if (update==false){
		// We wanted a new one
		ad2460.timers.push(new timer(id, domIds, domProgressIndicators, start, end, callback));
	}
}

function removeTimer(id){
	for (i=0;i<ad2460.timers.length ;i++ ){
		if (ad2460.timers[i].id==id){
			ad2460.timers.splice(i,1);
			i--;
		}
	}
}

function handleTimers(){
	var i=0;
	ad2460.serverTime++;
	for (i=0;i<ad2460.timers.length ;i++ ){
		//ad2460.timers[i].secondsToCount--;
		//ad2460.timers[i].secondsPassed++;
		if (ad2460.serverTime>ad2460.timers[i].end){
			ad2460.timers[i].callback();
			// a little "hack" to update the starmap with new prospected-icons etc
			if (ad2460.timers[i].hasOwnProperty('quadrant')){
				loadSectorContent(ad2460.timers[i].quadrant,ad2460.timers[i].sector);
			}
			ad2460.timers.splice(i,1);
			i--;
			//console.log("There are now "+ad2460.timers.length+" active timers");
		}
		else {
			// Just update the counters I guess?
			var secondsLeft=ad2460.timers[i].end-ad2460.serverTime;
			var secondsPassed=ad2460.serverTime-ad2460.timers[i].start;

			var a=0;
			for (a=0;a<ad2460.timers[i].domIds.length ;a++ ){
				if ($('#'+ad2460.timers[i].domIds[a]).hasClass('longtime')){
					$('#'+ad2460.timers[i].domIds[a]).html(secondsToFullTimeLong(secondsLeft));
				}
				else if ($('#'+ad2460.timers[i].domIds[a]).hasClass('noseconds')){
					$('#'+ad2460.timers[i].domIds[a]).html(secondsToFullTimeNosecs(secondsLeft));
				}
				else {
					$('#'+ad2460.timers[i].domIds[a]).html(secondsToFullTime(secondsLeft));
				}
			}
			var a=0;
			for (a=0;a<ad2460.timers[i].domProgressIndicators.length ;a++ ){
				var completePercent=0;
				var total=ad2460.timers[i].end-ad2460.timers[i].start;
				completePercent=Math.floor(secondsPassed*100/total);
				$('#'+ad2460.timers[i].domProgressIndicators[a]).css('width',completePercent+'%');
			}
		}
	}

	// this runs very frequently on the client.
	// Lets add the hook to check for paused production or not
	
	if (ad2460.productionqueue.length>0){
		if (ad2460.productionqueue[0].building>0){
			document.getElementById('process_6_progress').style.backgroundColor='rgba(30,255,0,0.8)';
			document.getElementById('process_6_name').style.color='white';
		}
		else {
			document.getElementById('process_6_progress').style.backgroundColor='red';
			document.getElementById('process_6_name').style.color='red';
			document.getElementById('process_6_eta').innerHTML='Paused';
		}
	}
}

function handleTimersNoUpdate(){
	var i=0;

	for (i=0;i<ad2460.timers.length ;i++ ){
		//ad2460.timers[i].secondsToCount--;
		//ad2460.timers[i].secondsPassed++;
		if (ad2460.serverTime>=ad2460.timers[i].end){
			ad2460.timers[i].callback();
			ad2460.timers.splice(i,1);
			i--;
		}
		else {
			// Just update the counters I guess?
			var secondsLeft=ad2460.timers[i].end-ad2460.serverTime;
			var secondsPassed=ad2460.serverTime-ad2460.timers[i].start;

			var a=0;
			for (a=0;a<ad2460.timers[i].domIds.length ;a++ ){
				if ($('#'+ad2460.timers[i].domIds[a]).hasClass('longtime')){
					$('#'+ad2460.timers[i].domIds[a]).html(secondsToFullTimeLong(secondsLeft));
				}
				else if ($('#'+ad2460.timers[i].domIds[a]).hasClass('noseconds')){
					$('#'+ad2460.timers[i].domIds[a]).html(secondsToFullTimeNosecs(secondsLeft));
				}
				else {
					$('#'+ad2460.timers[i].domIds[a]).html(secondsToFullTime(secondsLeft));
				}
			}
			var a=0;
			for (a=0;a<ad2460.timers[i].domProgressIndicators.length ;a++ ){
				var completePercent=0;
				var total=ad2460.timers[i].end-ad2460.timers[i].start;
				completePercent=Math.floor(secondsPassed*100/total);
				$('#'+ad2460.timers[i].domProgressIndicators[a]).css('width',completePercent+'%');
			}
		}
	}
}

var altInterval=setInterval( function(){alternateDoubleTimers()}, 10000 );

function alternateDoubleTimers(){
	// All changed this one now!!
	// Only process 7 and 8 will swap around
	// That means Intel-mission and Prospecting-mission

	var i=0;
	var found_prospecting_mission=false;
	var found_intel_mission=false;


	for (i=0;i<ad2460.timers.length ;i++ ){
		if (ad2460.timers[i].id=="currentProspectingProgressTimer"){
			found_prospecting_mission=true;
		}
		if (ad2460.timers[i].id=="currentIntelProgressTimer"){
			found_intel_mission=true;
		}
	}

	if (found_prospecting_mission==true && found_intel_mission==false){
		$("#process_7").show();
		$("#process_8").hide();
	}
	else if (found_prospecting_mission==false && found_intel_mission==true){
		$("#process_8").show();
		$("#process_7").hide();
	}
	else{
		// They have the same status, so pick one at random :)
		var r=Math.random()*100;
		if (r<50){
			$("#process_7").hide();
			$("#process_8").show();
		}
		else {
			$("#process_8").hide();
			$("#process_7").show();
		}
	}
}// Audio logic for AD2460
// The global variables that control whether to play or not are found in globalvars.js

var channel_max = 20;										// number of channels
var audiochannels = new Array();

var music=document.getElementById('combatmusic');
var ingamemusic=document.getElementById('music');

var last_impact_timestamp=0;
var last_emp_timestamp=0;
var last_beam_timestamp=0;
var last_volker_timestamp=0;
var last_missiledown_timestamp=0;
var last_explosion_timestamp=0;
var last_gravityeffect_timestamp=0;
var last_shield_drain_timestamp=0;
var last_station_shot_timestamp=0;

var lowerAttackWarning=false;


for (a=0;a<channel_max;a++) {									// prepare the channels
	audiochannels[a] = new Array();
	audiochannels[a]['channel'] = new Audio();						// create a new audio object
	audiochannels[a]['finished'] = -1;							// expected end time for this channel
}

function play_multi_sound(s) {
	if ( document.getElementById(s).hasOwnProperty('type') ) {
		if (document.getElementById(s).type=='combat'){
			if (ad2460.sound.playeffects!=true || ad2460.audioVars.combatsfxVolume==0){
				return;
			}
		}
		else {
			if (ad2460.sound.playeffects!=true || ad2460.audioVars.sfxVolume==0){
				return;
			}
		}
	}
	else {
		if (ad2460.sound.playeffects!=true || ad2460.audioVars.sfxVolume==0){
			return;
		}
	}

	if (s.indexOf('station_shot') > -1 ) {
		var now=new Date().getTime();
		var delay=100+(Math.random()*500);
		if (last_station_shot_timestamp>now-delay){
			return;
		}
		else {
			last_station_shot_timestamp=now;
		}
	}
	
	if (s.indexOf('missile_impact') > -1 ) {
		var now=new Date().getTime();
		var delay=100+(Math.random()*400);
		if (last_impact_timestamp>now-delay){
			return;
		}
		else {
			last_impact_timestamp=now;
		}
	}
	
	if (s.indexOf('shield_drain_effect') > -1 ) {
		var now=new Date().getTime();

		var delay=100+(Math.random()*1000);

		if (last_shield_drain_timestamp>now-delay){
			return;
		}
		else {
			last_shield_drain_timestamp=now;
		}
	}

	if (s.indexOf('gravityeffect') > -1 ) {
		var now=new Date().getTime();

		var delay=100+(Math.random()*400);

		if (last_gravityeffect_timestamp>now-delay){
			return;
		}
		else {
			last_gravityeffect_timestamp=now;
		}
	}


	if (s.indexOf('beam_weapon') > -1 ) {
		var now=new Date().getTime();
		if (last_beam_timestamp>now-200){
			return;
		}
		else {
			last_beam_timestamp=now;
		}
	}
	if (s.indexOf('volker') > -1 ) {
		var now=new Date().getTime();
		if (last_volker_timestamp>now-400){
			return;
		}
		else {
			last_volker_timestamp=now;
		}
	}
	if (s.indexOf('empeffect') > -1 ) {
		var now=new Date().getTime();
		if (last_emp_timestamp>now-200){
			return;
		}
		else {
			last_emp_timestamp=now;
		}
	}

	if (s.indexOf('missile_down') > -1 ) {
		var now=new Date().getTime();
		if (last_missiledown_timestamp>now-300){
			return;
		}
		else {
			last_missiledown_timestamp=now;
		}
	}

	if (s.indexOf('explosion_01') > -1 ) {
		var now=new Date().getTime();
		if (last_explosion_timestamp>now-200){
			return;
		}
		else {
			last_explosion_timestamp=now;
		}
	}


	if ( document.getElementById(s).hasOwnProperty('type') ) {
		if (document.getElementById(s).type=='combat'){
			if (ad2460.sound.playeffects!=true || ad2460.audioVars.combatsfxVolume==0){
				return;
			}
		}
		else {
			if (ad2460.sound.playeffects!=true || ad2460.audioVars.sfxVolume==0){
				return;
			}
		}
	}

	var startedit=false;

	for (a=0;a<audiochannels.length;a++) {
		thistime = new Date();
		if (audiochannels[a]['finished'] < thistime.getTime()) {			// is this channel finished?
			audiochannels[a]['finished'] = thistime.getTime() + document.getElementById(s).duration*1000;
			audiochannels[a]['channel'].src = document.getElementById(s).src;
			audiochannels[a]['channel'].load();
			audiochannels[a]['channel'].volume=ad2460.audioVars.sfxVolume;
			
			if (s.indexOf('sfx_incoming_alarm') > -1 && lowerAttackWarning==true ) {
				audiochannels[a]['channel'].volume=0.1;
			}
			if ( document.getElementById(s).hasOwnProperty('type') ) {
				if (document.getElementById(s).type=='combat'){
					audiochannels[a]['channel'].volume=ad2460.audioVars.combatsfxVolume;
				}
			}
			audiochannels[a]['channel'].play();
			startedit=true;
			break;
		}
	}
}

function stop_multi_sound(d){
	for (a=0;a<audiochannels.length;a++) {
		thistime = new Date();
		if (audiochannels[a]['finished'] < thistime.getTime()) {			// is this channel finished?
			audiochannels[a]['finished'] = thistime.getTime() + document.getElementById(d).duration*1000;
			audiochannels[a]['channel'].pause();
			break;
		}
	}

}

function toggleSound(){
	ad2460.sound.playeffects=1-ad2460.sound.playeffects;
	renderSoundIcon();
}
function renderSoundIcon(){
	if (ad2460.sound.playeffects==1){
		$("#soundicon").attr("src", "images/icons/soundIsOn.png");
	}
	else {
		$("#soundicon").attr("src", "images/icons/soundIsOff.png");
	}
}

function updateVolume(silent){
	ad2460.audioVars.sfxVolume=document.getElementById('sfxvolume').value/100;
	ad2460.audioVars.musicVolume=document.getElementById('musicvolume').value/100;
	ad2460.audioVars.combatsfxVolume=document.getElementById('combatsfxvolume').value/100;
	ad2460.audioVars.combatmusicVolume=document.getElementById('combatmusicvolume').value/100;

	document.getElementById('combatmusic').volume=ad2460.audioVars.combatmusicVolume;
	document.getElementById('music').volume=ad2460.audioVars.musicVolume;

	var c_name='sfxvolume';
	var value=ad2460.audioVars.sfxVolume;
	var exdate=new Date();
	var exdays=3650;
	exdate.setDate(exdate.getDate() + exdays);
	var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
	document.cookie=c_name + "=" + c_value;

	var c_name='musicvolume';
	var value=ad2460.audioVars.musicVolume;
	var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
	document.cookie=c_name + "=" + c_value;

	var c_name='combatsfxvolume';
	var value=ad2460.audioVars.combatsfxVolume;
	var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
	document.cookie=c_name + "=" + c_value;

	var c_name='combatmusicvolume';
	var value=ad2460.audioVars.combatmusicVolume;
	var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
	document.cookie=c_name + "=" + c_value;

	if (silent=!true){
		play_multi_sound('sfx_click1');
	}


	if (ad2460.audioVars.musicVolume<0.05){
		document.getElementById('music').pause();
	}
}

function initVolume(){
	var sfxVolume=ReadCookie('sfxvolume');
	var musicVolume=ReadCookie('musicvolume');
	var combatsfxVolume=ReadCookie('combatsfxvolume');
	var combatmusicVolume=ReadCookie('combatmusicvolume');
	var showFullcombatText=ReadCookie('fullcombattext');

	// console.log("Reading cookies ",sfxVolume, musicVolume, combatsfxVolume, combatmusicVolume );

	if (showFullcombatText=='true'){
		ad2460.combat.showFullCombatText=true;
		$("#show_full_combat_text_button_text").html("Text: Full");
	}
	else {
		ad2460.combat.showFullCombatText=false;
		$("#show_full_combat_text_button_text").html("Text: Per Turn");
	}
	

	if (sfxVolume!=""){
		ad2460.audioVars.sfxVolume=sfxVolume;
		// console.log("Setting sfxVolume to "+sfxVolume);
	}
	else {
		ad2460.audioVars.sfxVolume=0.5;
		// console.log("Setting sfxVolume to 0.5");
	}
	if (musicVolume!=""){
		ad2460.audioVars.musicVolume=musicVolume;
	}
	else {
		ad2460.audioVars.musicVolume=0.5;
	}
	if (combatsfxVolume!=""){
		ad2460.audioVars.combatsfxVolume=combatsfxVolume;
	}
	else {
		if (ad2460.mobilebrowser==true){
			ad2460.audioVars.combatsfxVolume=0;
		}
		else {
			ad2460.audioVars.combatsfxVolume=0.5;
		}
		
	}
	if (combatmusicVolume!=""){
		ad2460.audioVars.combatmusicVolume=combatmusicVolume;
	}
	else {
		ad2460.audioVars.combatmusicVolume=0.5;
	}

	document.getElementById('sfxvolume').value=ad2460.audioVars.sfxVolume*100;
	document.getElementById('musicvolume').value=ad2460.audioVars.musicVolume*100;
	document.getElementById('combatsfxvolume').value=ad2460.audioVars.combatsfxVolume*100;
	document.getElementById('combatmusicvolume').value=ad2460.audioVars.combatmusicVolume*100;

	updateVolume(true);

}

function toggleFullCombatOutput(){
	ad2460.combat.showFullCombatText=!ad2460.combat.showFullCombatText;
	if (ad2460.combat.showFullCombatText==true){
		$("#show_full_combat_text_button_text").html("Text: Full");
	}
	else {
		$("#show_full_combat_text_button_text").html("Text: Per Turn");
	}

	var c_name='fullcombattext';
	var value="false";
	if (ad2460.combat.showFullCombatText==true){
		value="true";
	}
	var exdate=new Date();
	var exdays=3650;
	exdate.setDate(exdate.getDate() + exdays);
	var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
	document.cookie=c_name + "=" + c_value;

}
function musicIngameEnded(){
	var m=document.getElementById('music');
	
	if (m.src.indexOf('starmap_loop')>0){
		m.src='audio/starmap_loop.mp3';
		//m.currentTime = 0;
		//m.pause();
		m.play();
	}
	else {
		m.src='audio/starmap_loop.mp3';
		//m.currentTime = 0;
		//m.pause();
		m.play();
	}
}
function musicEnded(){
	var m=document.getElementById('combatmusic');
	
	if (m.src.indexOf('ad_battle_glory')>0){
		m.src='audio/battle_drama.mp3';
		//m.currentTime = 0;
		//m.pause();
		m.play();
	}
	else {
		m.src='audio/ad_battle_glory.mp3';
		//m.currentTime = 0;
		//m.pause();
		m.play();
	}
}

function startIngameMusic(){
	if (ad2460.audioVars.musicVolume>0){
		document.getElementById('music').volume=ad2460.audioVars.musicVolume;
		document.getElementById('music').play();
	}

}
function stopIngameMusic(){
	if (document.getElementById('music').paused==false){
		$("#music").animate({	volume: 0.0	} , 4000, function() {
			document.getElementById('music').currentTime = 0;
			document.getElementById('music').pause();
			document.getElementById('music').volume=ad2460.audioVars.combatmusicVolume;
		});
	}
}

var easing="easeInOutQuad";
var homeworldVisible = 1;
var outpostsVisible = 0;
var allianceVisible = 0;
var militaryVisible = 0;
var buttonId = 0;
var buttonHover = 0;
var economyVisible=0;
var missionsVisible=0;
var starMapVisible=0;
var outGameHelpVisible = 0;
function hoverMain(buttonId){
	if(buttonId == 'homeworldbutton'){
		$("#hw_icon").transition({x: 200, y: 0, rotate: '180deg'},500);
	}
	if(buttonId == 'alliancebutton'){
		$("#al_icon").transition({x: 200, y: 0},500);	
	}
	if(buttonId == 'outpostsbutton'){
		$("#op_icon").transition({x: 200, y: 0},500);	
	}
}
function unhoverMain(buttonId){
	if(buttonId == 'homeworldbutton'){
		$("#hw_icon").transition({x: 0, y: 0},500);	
	}
		if(buttonId == 'alliancebutton'){
		$("#al_icon").transition({x: 0, y: 0},500);	
	}
		if(buttonId == 'outpostsbutton'){
		$("#op_icon").transition({x: 0, y: 0},500);	
	}
}
function clickMain(buttonId){
	if(buttonId == 'homeworldbutton'){
		$('.main_menu_item').not('#'+buttonId).transition({scale: 1.0},200);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ms_icon").hide();});
		$('#'+buttonId).transition({scale: 1.2},200);
	}
	if(buttonId == 'alliancebutton'){
		$('#'+buttonId).transition({scale: 1.2},200);
		$('.main_menu_item').not('#'+buttonId).transition({scale: 1.0},200);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ms_icon").hide();});
	}
	if(buttonId == 'outpostsbutton'){
		$('#'+buttonId).transition({scale: 1.2},200);
		$('.main_menu_item').not('#'+buttonId).transition({scale: 1.0},200);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ms_icon").hide();});
	}
	if(buttonId == 'militarybutton'){

		$('#'+buttonId).transition({scale: 1.2},200);
		$('.main_menu_item').not('#'+buttonId).transition({scale: 1.0},200);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ms_icon").hide();});
	}
	if(buttonId == 'economybutton'){
		$("#ec_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$('#'+buttonId).transition({scale: 1.2},200);
		$('.main_menu_item').not('#'+buttonId).transition({scale: 1.0},200);			
		$("#hw_icon").transition({x: 0, y: 0},500,function(){$("#hw_icon").hide();});
		$("#al_icon").transition({x: 0, y: 0},500,function(){$("#al_icon").hide();});
		$("#mi_icon").transition({x: 0, y: 0},500,function(){$("#mi_icon").hide();});
		$("#op_icon").transition({x: 0, y: 0},500,function(){$("#op_icon").hide();});
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ms_icon").hide();});
		$("#sm_icon").transition({x: 0, y: 0},500,function(){$("#sm_icon").hide();});
		//console.log('showing op_icon');
	}
	if(buttonId == 'missionsbutton'){
		$("#ms_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$('#'+buttonId).transition({scale: 1.2},200);
		$('.main_menu_item').not('#'+buttonId).transition({scale: 1.0},200);			
		$("#hw_icon").transition({x: 0, y: 0},500,function(){$("#hw_icon").hide();});
		$("#al_icon").transition({x: 0, y: 0},500,function(){$("#al_icon").hide();});
		$("#mi_icon").transition({x: 0, y: 0},500,function(){$("#mi_icon").hide();});
		$("#op_icon").transition({x: 0, y: 0},500,function(){$("#op_icon").hide();});
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		$("#sm_icon").transition({x: 0, y: 0},500,function(){$("#sm_icon").hide();});
		//console.log('showing op_icon');
	}
	if(buttonId == 'starmapbutton'){
		$("#sm_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$('#'+buttonId).transition({scale: 1.2},200);
		$('.main_menu_item').not('#'+buttonId).transition({scale: 1.0},200);			
		$("#hw_icon").transition({x: 0, y: 0},500,function(){$("#hw_icon").hide();});
		$("#al_icon").transition({x: 0, y: 0},500,function(){$("#al_icon").hide();});
		$("#mi_icon").transition({x: 0, y: 0},500,function(){$("#mi_icon").hide();});
		$("#op_icon").transition({x: 0, y: 0},500,function(){$("#op_icon").hide();});
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ms_icon").hide();});

		setTimeout(function(){if (ad2460.starmap.galaxyView==1 && ad2460.starmap.solIsShown==true){	zoomToHomeworld();}} , 1500);
	}
}

function hoverButton(buttonId){
	$("#"+buttonId+" .buttonregular").stop().animate( {opacity: 0 }, 500  );
	$("#"+buttonId+" .buttonhover").show().stop().animate( {opacity: 1 }, 500  );
}
function unhoverButton(buttonId){
	$("#"+buttonId+" .buttonregular").stop().animate ( {opacity: 1 }, 500  );
	$("#"+buttonId+" .buttonhover").show().stop().animate( {opacity: 0 }, 500  );
}
function clickButton(buttonId){
	$("#"+buttonId+" .buttonclick").stop().animate( {opacity: 1 }, 50  ).animate ( {opacity: 0 }, 400 );
}

function hoverDynaButton(buttonId){
	$("#"+buttonId+" .dyna_button_regular").stop().animate( {opacity: 1 }, { duration: 300/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} ); 
	$("#"+buttonId+" .dyna_button_hover").show().stop().animate( {opacity: 1 }, 300  );
	buttonHover = 1;
}
function unhoverDynaButton(buttonId){
	$("#"+buttonId+" .dyna_button_regular").show().stop().animate( {opacity: 1 }, 600  );
	$("#"+buttonId+" .dyna_button_hover").stop().animate( {opacity: 0 }, { duration: 600/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} ); 
	buttonHover = 0;
	
}
function clickDynaButton(buttonId){
	if (buttonHover == 1) {
		$("#"+buttonId+" .dyna_button_click").show().stop().css( {opacity: 1 }  ).animate({ opacity : 0 }, {duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
		$("#"+buttonId+" .dyna_button_hover").stop().css( {opacity: 0 }  ).animate({ opacity : 1 }, { duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
		$("#"+buttonId+" .dyna_button_regular").stop().css( {opacity: 0 } ).animate({ opacity : 1 }, { duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
	}
	else if (buttonHover == 0) {
		$("#"+buttonId+" .dyna_button_click").show().stop().css( {opacity: 1 }  ).animate({ opacity : 0 }, {duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
		$("#"+buttonId+" .dyna_button_hover").stop().css( {opacity: 0 }  ).animate({ opacity : 0 }, { duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
		$("#"+buttonId+" .dyna_button_regular").stop().css( {opacity: 0 } ).animate({ opacity : 1 }, { duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
	}
}

function hoverFixedButton(buttonId){
	$("#"+buttonId+" .fixed_button_regular").stop().animate( {opacity: 1 }, { duration: 300/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} ); 
	$("#"+buttonId+" .fixed_button_hover").show().stop().animate( {opacity: 1 }, 300  );
	buttonHover = 1;
}
function unhoverFixedButton(buttonId){
	$("#"+buttonId+" .fixed_button_regular").show().stop().animate( {opacity: 1 }, 600  );
	$("#"+buttonId+" .fixed_button_hover").stop().animate( {opacity: 0 }, { duration: 600/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} ); 
	buttonHover = 0;
	
}
function clickFixedButton(buttonId){
	if (static_page==true){
		if (buttonHover == 1) {
			$("#"+buttonId).transition({scale: 1.0});
			$("#"+buttonId+" .fixed_button_click").show().stop().css ( {opacity: 1 }  ).animate({ opacity : 0 }, {duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
			$("#"+buttonId+" .fixed_button_hover").stop().css ( {opacity: 0 }  ).animate({ opacity : 1 }, { duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
			$("#"+buttonId+" .fixed_button_regular").stop().css ( {opacity: 0 } ).animate({ opacity : 1 }, { duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
		}
		else if (buttonHover == 0) {
			$("#"+buttonId+" .fixed_button_click").show().stop().css ( {opacity: 1 }  ).animate({ opacity : 0 }, {duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
			$("#"+buttonId+" .fixed_button_hover").stop().css ( {opacity: 0 }  ).animate({ opacity : 0 }, { duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
			$("#"+buttonId+" .fixed_button_regular").stop().css ( {opacity: 0 } ).animate({ opacity : 1 }, { duration: 400/*, complete: function() {$("#"+buttonId+" .dyna_button_click").hide();}*/} );
		}

	}
}

function initiateButtonHover(buttonId){
	$("#"+buttonId+" .initiatebutton").stop().animate ( {opacity: 0 }, 300 );
	$("#"+buttonId+" .initiatebuttonhover").stop().animate ( {opacity: 1 }, 300  );
}
function initiateButtonUnhover(buttonId){
	$("#"+buttonId+" .initiatebutton").stop().animate ( {opacity: 1 }, 100  );
	$("#"+buttonId+" .initiatebuttonhover").stop().animate ( {opacity: 0}, 500  );
}

function elementButtonNormal(elementId){
	$("#"+elementId+" .elementhover").stop().animate ( {opacity: 0 }, 500  );
	$("#"+elementId+" .element").stop().animate ( {opacity: 1 }, 500  );
}
function elementButtonHover(elementId){
	$("#"+elementId+" .elementhover").stop().animate ( {opacity: 1 }, 500  );
	$("#"+elementId+" .element").stop().animate ( {opacity: 0 }, 500  );
}
function elementButtonClick(elementId){	
	var elm=document.getElementById(elementId);
	var parentId=elm.parentNode.id;
	$("#"+parentId+".element").not("#"+elementId).stop().animate ( {opacity: 1 }, 300  );
	$(".elementhover").not("#"+elementId).stop().animate ( {opacity: 0 }, 300  );
	$("#"+elementId+" .elementhover").stop().animate ( {opacity: 1 }, 100  );
}


function nextUpdate(){
	$("#update1").stop().animate ( {opacity: 1 }, 300  );
	$("#update2").stop().stop().animate ( {opacity: 0 }, 300  );
}

function prevUpdate(){
	$("#update2").stop().animate ( {opacity: 1 }, 300  );
	$("#update1").stop().delay(200).stop().animate ( {opacity: 0 }, 300  );
}

function showSection(buttonId){
	var moveTo = '';
	var openNow = ad2460.currentPageSectionId;
	var iconIn = '';
	var iconOut = '';
	if(buttonId == 'homeworldbutton'){moveTo = 'homeworld_content';}
	if(buttonId == 'outpostsbutton'){moveTo = 'outposts_content';}
	if(buttonId == 'alliancebutton'){moveTo = 'alliance_content';}
	if(buttonId == 'militarybutton'){moveTo = 'military_content';}
	if(buttonId == 'starmapbutton'){moveTo = 'starmapslide';}
	if(buttonId == 'missionsbutton'){moveTo = 'mission_section';}
	if (moveTo == 'homeworld_content'){ iconIn = 'hw_icon';}
	if (moveTo == 'outposts_content'){ iconIn = 'op_icon';}
	if (moveTo == 'alliance_content'){ iconIn = 'al_icon';}
	if (moveTo == 'military_content'){ iconIn = 'mi_icon';}
	if (moveTo == 'mission_section'){ iconIn = 'ms_icon';}
	if (moveTo == 'starmapslide'){ iconIn = 'sm_icon';}
	/* 2 possibilities
		This section comes in from the left and the current visible section leaves to the right (a = 1)
		This section comes in from the right and the current visible section leaves to the left (a = 2)
		This section fades in over the other sections. (a = 3)
		Remove a section that's over a basic section. (a = 4)
	*/
	var a=1;
	if(openNow =='homeworld_content'){
		if( moveTo =='outposts_content' || moveTo =='alliance_content' || moveTo =='military_content'){
			a = 2;
		}
		if( moveTo =='starmapslide' || moveTo =='mission_section' ){
			a = 3;
		}
		iconOut = 'hw_icon';
	}
	if(openNow =='outposts_content'){
		if( moveTo =='alliance_content' || moveTo =='military_content'){
			a = 2;
		}
		if( moveTo =='starmapslide' || moveTo =='mission_section' ){
			a = 3;
		}
		iconOut = 'op_icon';
	}
	if(openNow =='alliance_content'){
		if( moveTo =='military_content'){
			a = 2;
		}
		if( moveTo =='starmapslide' || moveTo =='mission_section' ){
			a = 3;
		}
		iconOut = 'al_icon';
	}
	if(openNow =='military_content'){
		if( moveTo == 'starmapslide' || moveTo =='mission_section' ){
			a = 3;
		}
		iconOut = 'mi_icon';
	}
	if(openNow =='starmapslide'){
		if( moveTo == 'homeworld_content' || moveTo =='outposts_content' || moveTo =='alliance_content' || moveTo =='military_content'){
			a = 4;
		}
		if( moveTo == 'mission_section'){
			a = 5;
		}		
		iconOut = 'sm_icon';
	}
	if(openNow =='mission_section'){
		if( moveTo == 'homeworld_content' || moveTo =='outposts_content' || moveTo =='alliance_content' || moveTo =='military_content'){
			a = 4;
		}
		if(moveTo == 'starmapslide'){
			a = 5;
		}		
		iconOut = 'ms_icon';
	}

	if(moveTo == openNow){a=0;}
	if(a==1){
		$("#"+moveTo).show().css( { x: 0, opacity: 1} ).transition( {x: 1400}, 750, 'cubic-bezier(.29,.57,.4,1)');
		$("#"+openNow).transition( {x: 2400}, 750, 'cubic-bezier(.29,.57,.4,1)', function() {$("#"+openNow).hide();});
		
	}
	else if(a == 2) {
		$("#"+moveTo).show().css( { x: 2400, opacity: 1 } ).transition( {x: 1400}, 750, 'cubic-bezier(.29,.57,.4,1)');
		$("#"+openNow).transition( { x: 0 }, 750,'cubic-bezier(.29,.57,.4,1)', function() {$("#"+openNow).hide();})
	}
	else if(a == 3){
		if(moveTo == 'starmapslide'){
			showStarMapSection();
			$("#"+openNow).fadeOut(500);
		}
		else{
			showMissionSection();
			$("#"+openNow).fadeOut(500);
		}		
	}
	else if(a == 4) {
		if(openNow == 'starmapslide'){
			hideStarMapSection();
			$("#"+moveTo).show().css( { x: 1400, opacity: 1} );
		}
		if(openNow == 'mission_section'){
			hideMissionSection();
			$("#"+moveTo).show().css( { x: 1400, opacity: 1 } );
		}
	}
	else if(a == 5) {
		if(openNow == 'starmapslide'){
			hideStarMapSection();
			showMissionSection();
		}
		if(openNow == 'mission_section'){
			hideMissionSection();
			showStarMapSection();
		}
	}
	else {
		// do nothing		
	}
		// replace icons
	$('#'+iconIn).show().delay(300).transition({x: 100, y: 0},1500);
	$('#'+iconOut).transition({x: 0, y: 0},500,function(){$('#'+iconOut).hide();checkForUnspentCommanderPoints();});
		
		// change menu selection
	$('#'+buttonId).transition({scale: 1.2},200);
	$('.main_menu_item').not('#'+buttonId).transition({scale: 1.0},200);

	ad2460.currentPageSectionId = moveTo;

	setTimeout ( function(){fixBuggedStarmap()}, 1000 );
}

function sectionInRight(inSection){

}
function sectionInLeft(inSection){

}
function sectionOutRight(outSection){

}
function sectionOutLeft(outSection){

}

function showHomeworld(){
	if (starMapVisible==1){
		$("#hw_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#sm_icon").transition({x: 0, y: 0},500,function(){$("#sm_icon").hide();});
		$("#homeworld_content").css({x: 1400, y:0,opacity: 0}).show().transition({opacity: 1},800);
		$(".section_container").css({y:0});
		hideStarMapSection();
		homeworldVisible=1;
		outpostsVisible=0;
		allianceVisible=0;
		militaryVisible=0;
		return;
	}
	if (economyVisible==1){
		$('#outposts_content, #alliance_content, #military_content').css({x: 0, y: 0}).hide();
		$("#hw_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		$("#homeworld_content").css({x:1400}).show();
		hideEconomy();
	}
	if (missionsVisible==1 && homeworldVisible==1){
		$("#hw_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		$("#homeworld_content").show();
		hideMissions();
	}
	if (missionsVisible==1 && outpostsVisible==1){
		$("#homeworld_content").show().css( { x: 1400} );
		$("#outposts_content").hide();
		$("#hw_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
	}
	if (missionsVisible==1 && allianceVisible==1){
		$("#homeworld_content").show().css( { x: 1400 } );
		$("#alliance_content").hide();
		$("#hw_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		allianceVisible=0;
	}
	if (missionsVisible==1 && militaryVisible==1){
		$("#homeworld_content").show().css( { x: 1400 } );
		$("#military_content").hide();
		$("#hw_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
	}
	if (outpostsVisible==1) {
		$("#homeworld_content").show().css( { x: 0} ).transition( {x: 1400},  750 , 'easeInOutQuad');
//		$(".animated_moon").css("-webkit-animation-play-state", "running"); 
//		$(".animated_moon_image").css("-webkit-animation-play-state", "running");
		$("#outposts_content").transition( {x: 2400}, 750 , 'easeInOutQuad', function() {$("#outposts_content").hide();});
		$("#hw_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#op_icon").transition({x: 0, y: 0},500,function(){$("#op_icon").hide();});
	}
	else if (allianceVisible==1) {
		$("#homeworld_content").show().css( { x: 0} ).transition( {x: 1400}, 750 , 'easeInOutQuad');
		$("#alliance_content").transition( {x: 2400}, 750 , 'easeInOutQuad',  function() {$("#alliance_content").hide();});
		$("#hw_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#al_icon").transition({x: 0, y: 0},500,function(){$("#al_icon").hide();});
	}
	else if (militaryVisible==1) {
		$("#homeworld_content").show().css( { x: 0} ).transition( {x: 1400}, 750 , 'easeInOutQuad');
		$("#military_content").transition( {x: 2400}, 750 , 'easeInOutQuad', function() {$("#military_content").hide();})
		$("#hw_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#mi_icon").transition({x: 0, y: 0},500,function(){$("#mi_icon").hide();});
	}
	
	homeworldVisible=1;
	outpostsVisible=0;
	allianceVisible=0;
	militaryVisible=0;
}

function showOutposts(){
	if (starMapVisible==1){
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#sm_icon").transition({x: 0, y: 0},500,function(){$("#sm_icon").hide();});
		$("#outposts_content").show().css( { x: 1400, y:0, opacity: 0} ).transition({opacity: 1},800);
		$(".section_container").css({y:0});
		hideStarMapSection();
		homeworldVisible=0;
		outpostsVisible=1;
		allianceVisible=0;
		militaryVisible=0;
		return;
	}
	if (economyVisible==1 && outpostsVisible==1){
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		$("#outposts_content").show();
		hideEconomy();
	}
	if (economyVisible==1 && homeworldVisible==1){
		$("#outposts_content").show().css( { x: 1400 } );
		$("#homeworld_content").hide();
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideEconomy();
		homeworldVisible=0;
	}
	if (economyVisible==1 && allianceVisible==1){
		$("#outposts_content").show().css( { x: 1400 } );
		$("#alliance_content").hide();
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideEconomy();
		allianceVisible=0;
	}
	if (economyVisible==1 && militaryVisible==1){
		$("#outposts_content").show().css( { x: 1400 } );
		$("#military_content").hide();
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideEconomy();
		militaryVisible=0;
	}
	if (missionsVisible==1 && outpostsVisible==1){
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ms_icon").hide();});
		$("#outposts_content").show();
		hideMissions();
	}
	if (missionsVisible==1 && homeworldVisible==1){
		$("#outposts_content").show().css( { x: 1400 } );
		$("#homeworld_content").hide();
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		homeworldVisible=0;
	}
	if (missionsVisible==1 && allianceVisible==1){
		$("#outposts_content").show().css( { x: 1400 } );
		$("#alliance_content").hide();
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		allianceVisible=0;
	}
	if (missionsVisible==1 && militaryVisible==1){
		$("#outposts_content").show().css( { x: 1400 } );
		$("#military_content").hide();
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		militaryVisible=0;
	}
	if (homeworldVisible==1) {
		$("#outposts_content").show().css( { x: 2400 } ).transition( {x: 1400}, 750 , 'easeInOutQuad');
		//$(".animated_moon").css("-webkit-animation-play-state", "paused"); 
		//$(".animated_moon_image").css("-webkit-animation-play-state", "paused"); 
		$("#homeworld_content").transition( {x: 0}, 750 , 'easeInOutQuad', function() {$("#homeworld_content").hide();});
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#hw_icon").transition({x: 0, y: 0},500,function(){$("#hw_icon").hide();});
		homeworldVisible=0;
	}
	else if (allianceVisible==1) {
		$("#outposts_content").show().css( { x: 0 } ).transition( { x: 1400 }, 750 , 'easeInOutQuad');
		$("#alliance_content").transition( {x: 2400}, 750 , 'easeInOutQuad', function() {$("#alliance_content").hide();});
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#al_icon").transition({x: 0, y: 0},500,function(){$("#al_icon").hide();});
		allianceVisible=0;
	}
	else if (militaryVisible==1) {
		$("#outposts_content").show().css( { x: 0 } ).transition( { x: 1400 }, 750 , 'easeInOutQuad');
		$("#military_content").transition( { x: 2400 }, 750 ,'easeInOutQuad', function() {$("#military_content").hide();})
		$("#op_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#mi_icon").transition({x: 0, y: 0},500,function(){$("#mi_icon").hide();});
		militaryVisible=0;
	}
	outpostsVisible=1;
}

function showAlliance(){
	if (starMapVisible==1){
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#sm_icon").transition({x: 0, y: 0},500,function(){$("#sm_icon").hide();});
		$("#alliance_content").show().css( { x: 1400, y:0, opacity: 0} ).transition({opacity: 1},800);
		$(".section_container").css({y:0});
		hideStarMapSection();
		homeworldVisible=0;
		outpostsVisible=0;
		allianceVisible=1;
		militaryVisible=0;
		return;
	}
	if (economyVisible==1 && allianceVisible==1){
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		$("#alliance_content").show();
		hideEconomy();
	}
	if (economyVisible==1 && homeworldVisible==1){
		$("#alliance_content").show().css( { x: 1400 } );
		$("#homeworld_content").hide();
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideEconomy();
		homeworldVisible=0;
	}
	if (economyVisible==1 && outpostsVisible==1){
		$("#alliance_content").show().css( { x: 1400 } );
		$("#outposts_content").hide();
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideEconomy();
		outpostsVisible=0;
	}
	if (economyVisible==1 && militaryVisible==1){
		$("#alliance_content").show().css( { x: 1400 } );
		$("#military_content").hide();
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideEconomy();
		militaryVisible=0;
	}
	if (missionsVisible==1 && allianceVisible==1){
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		$("#alliance_content").show()
		hideMissions();
	}
	if (missionsVisible==1 && homeworldVisible==1){
		$("#alliance_content").show().css( { x: 1400 } );
		$("#homeworld_content").hide();
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		homeworldVisible=0;
	}
	if (missionsVisible==1 && outpostsVisible==1){
		$("#alliance_content").show().css( { x: 1400 } );
		$("#outposts_content").hide();
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		outpostsVisible=0;
	}
	if (missionsVisible==1 && militaryVisible==1){
		$("#alliance_content").show().css( { x: 1400 } );
		$("#military_content").hide();
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		militaryVisible=0;
	}
	if (homeworldVisible==1) {
		$("#alliance_content").show().css( { x: 2400 } ).transition( { x: 1400 }, 750 , 'easeInOutQuad');
		$(".animated_moon").css("-webkit-animation-play-state", "paused"); 
		$(".animated_moon_image").css("-webkit-animation-play-state", "paused"); 
		$("#homeworld_content").transition( { x: 0 }, 750 , 'easeInOutQuad', function() {$("#homeworld_content").hide();});
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#hw_icon").transition({x: 0, y: 0},500,function(){$("#hw_icon").hide();});
		homeworldVisible=0;
	}
	else if (outpostsVisible==1) {
		$("#alliance_content").show().css( { x: 2400} ).transition( { x: 1400 }, 750 , 'easeInOutQuad');
		$("#outposts_content").transition( { x: 0 }, 750 ,'easeInOutQuad', function() {$("#outposts_content").hide();});
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#op_icon").transition({x: 0, y: 0},500,function(){$("#op_icon").hide();});
		outpostsVisible=0;
	}
	else if (militaryVisible==1) {
		$("#alliance_content").show().css( { x: 0 } ).stop().animate( { x: 1400 }, 750 , 'easeInOutQuad');
		$("#military_content").transition({ x: 2400 }, 750 , 'easeInOutQuad', function() {$("#military_content").hide();});
		$("#al_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#mi_icon").transition({x: 0, y: 0},500,function(){$("#mi_icon").hide();});
		militaryVisible=0;
	}
	allianceVisible=1;
}
function showMilitary(){
	if (starMapVisible==1){
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#sm_icon").transition({x: 0, y: 0},500,function(){$("#sm_icon").hide();});
		$("#military_content").show().css( { x: 1400, y:0, opacity: 0} ).transition({opacity: 1},800);
		$(".section_container").css({y:0});
		hideStarMapSection();
		homeworldVisible=0;
		outpostsVisible=0;
		allianceVisible=0;
		militaryVisible=1;
		return;
	}
	if (economyVisible==1 && militaryVisible==1){
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		$("#military_content").show();
		hideEconomy();
	}
	if (economyVisible==1 && homeworldVisible==1){
		$("#military_content").show().css( { x: 1400 } );
		$("#homeworld_content").hide();
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideEconomy();
		homeworldVisible=0;
	}
	if (economyVisible==1 && outpostsVisible==1){
		$("#military_content").show().css( { x: 1400 } );
		$("#outposts_content").hide();
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideEconomy();
		outpostsVisible=0;
	}
	if (economyVisible==1 && allianceVisible==1){
		$("#military_content").show().css( { x: 1400 } );
		$("#alliance_content").hide();
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ec_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideEconomy();
		allianceVisible=0;
	}
	if (missionsVisible==1 && militaryVisible==1){
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		$("#military_content").show();
		hideMissions();
	}
	if (missionsVisible==1 && homeworldVisible==1){
		$("#military_content").show().css( { x: 1400 } );
		$("#homeworld_content").hide();
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		homeworldVisible=0;
	}
	if (missionsVisible==1 && outpostsVisible==1){
		$("#military_content").show().css( { x: 1400 } );
		$("#outposts_content").hide();
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		outpostsVisible=0;
	}
	if (missionsVisible==1 && allianceVisible==1){
		$("#military_content").show().css( { x: 1400 } );
		$("#alliance_content").hide();
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#ms_icon").transition({x: 0, y: 0},500,function(){$("#ec_icon").hide();});
		hideMissions();
		allianceVisible=0;
	}
	if (homeworldVisible==1) {
		$("#military_content").show().css( { x: 2400 } ).transition( {x: 1400}, 750 , 'easeInOutQuad');
		$(".animated_moon").css("-webkit-animation-play-state", "paused"); 
		$(".animated_moon_image").css("-webkit-animation-play-state", "paused"); 
		$("#homeworld_content").transition( { x: 0 }, 750 , 'easeInOutQuad', function() {$("#homeworld_content").hide();});
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#hw_icon").transition({x: 0, y: 0},500,function(){$("#hw_icon").hide();});
		homeworldVisible=0;
	}
	else if (outpostsVisible==1) {
		$("#military_content").show().css( { x: 2400 } ).transition( { x: 1400 }, 750 , 'easeInOutQuad');
		$("#outposts_content").transition( { x: 0 }, 750 , 'easeInOutQuad', function() {$("#outposts_content").hide();})
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#op_icon").transition({x: 0, y: 0},500,function(){$("#op_icon").hide();});
		outpostsVisible=0;
	}
	else if (allianceVisible==1) {
		$("#military_content").show().css( { x: 2400 } ).transition( { x: 1400 }, 750 , 'easeInOutQuad');
		$("#alliance_content").transition( { x: 0 }, 750 , 'easeInOutQuad', function() {$("#alliance_content").hide();});
		$("#mi_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#al_icon").transition({x: 0, y: 0},500,function(){$("#al_icon").hide();});
		allianceVisible=0;
	}
	militaryVisible=1;
}

function showEconomy(){
	if (starMapVisible==1){
		$("#ec_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#sm_icon").transition({x: 0, y: 0},500,function(){$("#sm_icon").hide();});
		hideStarMapSection();
	}
	if (missionsVisible==1) {
		hideMissions(1);
	}
	else {
		$('.section_container').transition({y:-776},750, 'easeInOutQuad', function(){$('.section_container').hide();});
	}
		$('.economy_slide').show().css({ y: 0 }).transition({y:-776},750, 'easeInOutQuad', function(){$('.section_container').hide();});
		$('.plate_heading').transition({y:-624},750, 'easeInOutCubic');
		$('.resource_box').css({y: -20}).transition({y:0},750, 'easeInOutQuad');		
		$('.starfield').transition({y:-776},750, 'easeInOutQuad');
		economyVisible=1;
}

function hideEconomy(mis){
	if (mis==1){
		$('.economy_slide').transition({y:0},750, 'easeInOutQuad', function(){$('.economy_slide').hide();});
		$('.plate_heading').transition({y:0},750, 'easeInOutQuad');
		$('.resource_box').transition({y:-20},750, 'easeInOutQuad');
		$('.starfield').css({y:600});
		$('.section_container').css({y:600});
	}
	else {
		$('.economy_slide').transition({y:0},750, 'easeInOutQuad', function(){$('.economy_slide').hide();});
		$('.section_container').transition({y:0},750, 'easeInOutQuad');
		$('.plate_heading').transition({y:0},750, 'easeInOutQuad');
		$('.resource_box').transition({y:-20},750, 'easeInOutQuad');
		$('.starfield').transition({y:0},750, 'easeInOutQuad');
	}
		economyVisible=0;
	
}

function showMissions(){
	if (starMapVisible==1){
		$("#ms_icon").show().delay(300).transition({x: 100, y: 0},1500);
		$("#sm_icon").transition({x: 0, y: 0},500,function(){$("#sm_icon").hide();});
		hideStarMapSection();
	}
	if (economyVisible==1) {
		hideEconomy(1);		
	}
	else{
		$('.section_container').transition({y:600},750, 'easeInOutQuad', function(){$('.section_container').hide();});
		homeworldVisible = 0;
		outpostsVisible = 0;
		allianceVisible = 0;
		militaryVisible = 0
	}
	$('#mission_section').show().css({ y: 0 }).transition({y: 600},750, 'easeInOutQuad');
	$('.starfield').transition({y:600},750, 'easeInOutQuad');
	missionsVisible=1;	
}

function hideMissions(eco){
	if (eco==1){
		$('#mission_section').transition({y:0},750, 'easeInOutQuad', function(){$('#mission_section').hide();});
		$('.starfield').css({y:-776});
		$('.section_container').css({y:-776});
	}
	else{
		$('.section_container').transition({y:0},750, 'easeInOutQuad');
		$('#mission_section').transition({y:0},750, 'easeInOutQuad', function(){$('#mission_section').hide();});
		$('.starfield').transition({y:0},750, 'easeInOutQuad');	
	}
	missionsVisible=0;
}


function getRotationDegrees(obj) {
    var matrix = obj.css("-webkit-transform") ||
    obj.css("-moz-transform")    ||
    obj.css("-ms-transform")     ||
    obj.css("-o-transform")      ||
    obj.css("transform");
    if(matrix !== 'none') {
        var values = matrix.split('(')[1].split(')')[0].split(',');
        var a = values[0];
        var b = values[1];
        var angle = Math.round(Math.atan2(b, a) * (180/Math.PI));
    } else { var angle = 0; }

    if(angle < 0) angle +=360;
    return angle;
}

function cycleTrack(id, deg){		
		var currentRotation = getRotationDegrees($("#"+id+" .cyclepoint"));
		var newAngle = currentRotation + deg;
		$("#"+id+" .cyclepoint").transition({ rotate: (currentRotation+deg)+'deg' }, 500, function(){
			if ( newAngle == 360) {
				$("#"+id+" .cyclepoint").css({ rotate: '0deg' });
			}
		});	
}
					 
function showEarning() {
	$('#earn_credits').fadeIn(50).delay(1000).animate({height: '18px'},500);	
}
function hideEarning() {
	$('#earn_credits').css({height: '0px'},500);	
}



function chatMax(){
	if (typeof(steamLoaded) != "undefined"){
		$('#chatcontent').transition({top: '-578px'},500);
		$('.player_info_bubble_wrapper').hide().css({top: '-577px'});
		$('#slot1').transition( {rotateX: 180},500 );
		if(combatPanelOpen == 1){
			$('#chatcontent').transition({background: 'rgba(0,0,0,0.8)'},500);
		}
		else{}
	}	
	else{
		$("#chatpane").show().animate({height: "743px"}, { duration: 400  ,  easing : easing });		
		$("#chatmaxbutton").css( {background : "url(../images/fixed/downqueue.png) no-repeat" } );
		if(combatPanelOpen == 1){
			$('#chatcontent').transition({background: 'rgba(0,0,0,0.8)'},500);
		}
		else{}
	}
		
	chatPaneVisible=2;
	if 	(typeof ad2460 != 'undefined'){
		ad2460.chatPaneVisible=2;
	}

}

function chatMin(){
	if (typeof(steamLoaded) != "undefined"){
		$('#chatcontent').transition({top: '0px'},500, function(){setTimeout('scrollChatToBottom()',100)});		
		$('#slot1').transition( {rotateX:0},500 );
		$('.player_info_bubble_wrapper').hide().css({top: '1px'});
		if(combatPanelOpen == 1){
			$('#chatcontent').transition({background: 'rgba(0,0,0,0.4)'},500);
		}
		else{}
		
	}
	else{
		$("#chatpane").show().transition({height: "167px"}, 500, function(){setTimeout('scrollChatToBottom()',100)});
		$("#chatmaxbutton").css( {background : "url(../images/fixed/upqueue.png) no-repeat" } );
		if(combatPanelOpen == 1){
			$('#chatcontent').transition({background: 'rgba(0,0,0,0.4)'},500);
		}
		else{}
	}	
	chatPaneVisible=1;
	if 	(typeof ad2460 != 'undefined'){
		ad2460.chatPaneVisible=1;
	}
}

//** The Main Functions **//
//var easing = 'easeInOutSine';
//var audioElement = document.createElement('audio');
//var audioElement2 = document.createElement('audio');

//$(document).ready(function() {
//	audioElement.setAttribute('src', 'audio/click.wav');
//	audioElement2.setAttribute('src', 'audio/click2.wav');
//});

$(document).ready(function() {
	$('#homeworldbutton, #outpostsbutton, #alliancebutton, #militarybutton, #starmapbutton, #missionsbutton').click(function(){
		if(acceptClick){

			if(outGameHelpVisible ==1){
				$('#gameinfo').trigger('click');
			}
			
			buttonId = $(this).attr("id");
			if(buttonId == 'starmapbutton'){
			}
			else{
				closePanels();
			}
			if (categoryPanelOpen==1) {closeCategoryPanel();}
			closeSlides();
			acceptClick = false;
//			clickMain(buttonId);			
			if(buttonId == 'starmapbutton' && starMapVisible == 1){
				removeStarMap();
				setTimeout('acceptClick=true',1500);
			}
			else{
			showSection(buttonId);
			setTimeout('acceptClick=true',850);
			}
			if(chatPaneVisible ==2){chatMin();}						
		}
	});
});

/*$(document).ready(function() {
	$("#outpostsbutton").click(function(){
		if(acceptClick){
			closePanels();
			closeSlides();
			if (categoryPanelOpen==1) {closeCategoryPanel();}
			acceptClick = false;
			buttonId = $(this).attr("id");
			clickMain(buttonId);			
			showOutposts();			
			setTimeout('acceptClick=true',850);
			hideEarning();
			try{
				checkScrollButtonStatus('outpost_list_scroller');
			}
			catch(err) {
				// ignore
			}
			
		}
	});
});

$(document).ready(function() {
	$("#alliancebutton").click(function(){
		if(acceptClick){
			closePanels();
			closeSlides();
			if (categoryPanelOpen==1) {closeCategoryPanel();}
			acceptClick = false;
			buttonId = $(this).attr("id");
			clickMain(buttonId);			
			showAlliance();	
			hideEarning();	
			setTimeout('acceptClick=true',850);
	}
	});
});

$(document).ready(function() {
	$("#militarybutton").click(function(){
		if(acceptClick){
			closePanels();
			closeSlides();
			if (categoryPanelOpen==1) {closeCategoryPanel();}
			acceptClick = false;
			buttonId = $(this).attr("id");
			clickMain(buttonId);			
			showMilitary();
			hideEarning();	
			setTimeout('acceptClick=true',850);
	}
	});
});

$(document).ready(function() {
	$("#economybutton").click(function(){
		if(acceptClick){
			closePanels();
			closeSlides();
			acceptClick = false;
			buttonId = $(this).attr("id");
			clickMain(buttonId);
			if(economyVisible==0){				
				showEconomy();
			}
			else{
				closePanels();
				closeSlides();	
			}
			setTimeout('acceptClick=true',850);
			hideEarning();
		}
	});
});

$(document).ready(function() {
	$("#missionsbutton").click(function(){
		if(acceptClick){
			closePanels();
			closeSlides();
			acceptClick = false;
			buttonId = $(this).attr("id");
			clickMain(buttonId);
			if(missionsVisible==0){				
				showMissions();
			}
			else{
				closePanels();
				closeSlides();
			}
			setTimeout('acceptClick=true',850);
			hideEarning();
			
		}
	});
});
*/

$(document).ready(function() {
	$(".lightbutton").hover(
		function(){ 
			buttonId = $(this).attr("id");
			hoverButton(buttonId); 
		},
		function(){ 
			unhoverButton(buttonId);	
	});
	
});
$(document).ready(function() {
	$(".lightbutton").click(
		function(){ 
			buttonId = $(this).attr("id");
			clickButton(buttonId); 	
	});	
});

$(document).ready(function() {
	$("#body").on("mouseover", ".costbutton",
		function(){ 
			buttonId = $(this).attr("id");
			initiateButtonHover(buttonId);  
		});
});

$(document).ready(function() {
	$("#body").on("mouseleave", ".costbutton",
		function(){ 
			buttonId = $(this).attr("id");
			initiateButtonUnhover(buttonId);
		});
});


$(document).ready(function() {
	var clickedElement = 0;
	var elementId = 0;
	var elementSectionId = 0;
	$(".elementbutton").hover(
	function(){ 
		elementId = $(this).attr("id");
		if (clickedElement != elementId) {
			elementButtonHover(elementId); 	
		}},
	function(){ 
		elementId = $(this).attr("id");	
		if (clickedElement != elementId) {
		elementButtonNormal(elementId);
		}});
	
	$(".elementbutton").click(
		function(){ 
			clickedElement = $(this).attr("id");
			elementButtonClick(elementId); 	
	});	

});
	

$(document).ready(function() {
	
});


$(document).ready(function() {
	$("#nextupdate").click(function(){ 
		nextUpdate()
	});
});

$(document).ready(function() {
	$("#prevupdate").click(function(){ 
		prevUpdate();
	});
});

/*
$(document).ready(function() {
	$("#forumheaders").click(function(){
		$(".player_comm_selection_glow").css({top: '-13px'});
		$("#forumheaderfield").show();
		$("#allianceheaderfield").hide();
		$("#mailheaderfield").hide();												 
	});
	$("#allianceheaders").click(function(){
		$(".player_comm_selection_glow").css({top: '18px'});
		$("#forumheaderfield").hide();
		$("#allianceheaderfield").show();
		$("#mailheaderfield").hide();												 
	});
	$("#mailheaders").click(function(){
		$(".player_comm_selection_glow").css({top: '49px'});
		$("#forumheaderfield").hide();
		$("#allianceheaderfield").hide();
		$("#mailheaderfield").show();													 
	});
});
*/

$(document).ready(function() {
	$(".dyna_button").hover(
		function(){ 
			buttonId = $(this).attr("id");
			hoverDynaButton(buttonId); 
		},
		function(){ 
			unhoverDynaButton(buttonId);	
	});
	
});
$(document).ready(function() {
	$(".dyna_button").click(
		function(){ 
			buttonId = $(this).attr("id");
			clickDynaButton(buttonId); 	
	});	
});


$(document).ready(function() {
	$("#body").on("click", ".fixed_button", 
		function(){ 
			buttonId = $(this).attr("id");
			clickFixedButton(buttonId); 	
	});
});


$(document).ready(function() {
	$("#body").on("mouseover", ".fixed_button",
		function(){ 
			buttonId = $(this).attr("id");
			hoverFixedButton(buttonId); 
		});
});

$(document).ready(function() {
	$("#body").on("mouseleave", ".fixed_button",
		function(){ 
			buttonId = $(this).attr("id");
			unhoverFixedButton(buttonId);
		});
});

$(document).ready(function() {
	$("#gameinfo").click(function(){
		//$('#outgamehelp').toggle();
		if(outGameHelpVisible ==0){
			$('#outgamehelp').css({opacity: 0}).show().transition({opacity: 1},300);
			outGameHelpVisible = 1;
			closeSlides();
			showHelpSlideCloser();
		}
		else{
			$('#outgamehelp').transition({opacity: 0},300, function(){$('#outgamehelp').hide();});
			$('#slidecloserhelp').show().css({zIndex: 4 }).transition({x:0, y:0},500);
			outGameHelpVisible = 0;
		}
		if($(this).hasClass('adv_selected')){
			$(this).removeClass('adv_selected');
		}
		else{
			$(this).addClass('adv_selected');
		}
	});
});

//$(document).ready(function() {
//	$(".main_menu_item").hover(
//		function(){ 
//			buttonId = $(this).attr("id");
//			hoverMain(buttonId); 
//		},
//		function(){ 
//			unhoverMain(buttonId);	
//	});
//	
//}); 
//$(document).ready(function() {
//	$(".main_menu_item").click(function(){ 
//			if(acceptClick){
//				buttonId = $(this).attr("id");
//				clickMain(buttonId);
//			}
//	});	
//});//** Content Box Variables **//

var boxInFront=0;
var mainContainerActive=0;
var mainPanelExpanded=0;
var sidePanelVisible=0;
var lowerPanelVisible=0;
var rearPanelVisible=0;
var easing = "easeInOutSine";
var id = 0;
var boxtop = 0;
var boxleft = 0;
var boxheight = 0;
var boxwidth = 0;
var mainConTop = 0;
var mainConLeft = 0;

var acceptClick=true;
var panelOpen = 0;
/* Notater fra Christisn
	Vi må fixe litt på åpning og lukking av paneler. Det å ha en global variabel som holder IDen på det åpnede panelet er uheldig.
	Samme med de andre globale variablene her.
	Det er bedre å ha en liste med alle paneler som eksisterer som holder på dataene det panelet trenger..
	Det hadde vært fint med tilgang til dynamisk creation også...
	spesielt om vi begynner å slite med hastighet grunnet for mange elementer i dokumentet...
	function Panel(var1,var2,var3,var4,var5,var6,var7,var8,var9,var10,var11,var12,var13,var14,var15,var16,var17,var18,var19,var20){
		this.id=var1;
		osv
		this.mainContainerActive=0;
		this.mainPanelExpanded=0;
		this.sidePanelVisible=0;
		this.lowerPanelVisible=0;
		this.rearPanelVisible=0;
		this.boxtop=var2;
		this.boxleft=var3;
		this.boxheight=var4;
		this.boxwidth=var5;
	}
	Noe slikt..
	og så en funksjon for å rendre det rett og slett.
	function renderPanel(){
		// create all divs, populate with content according to it's data etc.
	}
*/



/* Content Box Functions */

// Variable box sizes
	var mainHeight = 250;
	var mainWidth = 400;
	var sideHeight = 240;
	var sideWidth = 500;
	var lowHeight = 360;
	var lowWidth = 400;
	var InfoHeight = 0;
	var infoWidth = 0;
	var infoSolo = 0;
	var darkpanelWidth = 0;

//openMainContainer

function markPanelAsClosed(id){
	var i=0;
	for (i=0;i<ad2460.openPanels.length ;i++ ){
		if (ad2460.openPanels[i]==id){
			ad2460.openPanels.splice(i,1);
			i--;
		}
	}
	if (static_page==false){
		if (id=='fleet_management'){
			fleetTacticsPanelDown();
			fleetAssignPanelDown();
			fleetResupplyPanelDown();
		}
	}
}

function closePanels(callback){
	var i=0;
	for (i=0;i<ad2460.openPanels.length ;i++ ){
//		$("#"+ad2460.openPanels[i]).click();
		$("#"+ad2460.openPanels[i]+" .main_panel").click();
	}

	if (static_page==false){
		// Close down open small panels as well
		if (ad2460.galaxynewsVisible==true){
			ad2460.galaxynewsVisible=false;
			hideTickerPanel();
		}
		if (ad2460.fullnewsVisible==true){
			ad2460.fullnewsVisible=false;
			hideFullNews();
			unrenderFullNews();
		}

		if (ad2460.openQuickMenues.selected_fleet_reassign){
			fleetAssignPanelDown();
		}
		if (ad2460.openQuickMenues.selected_fleet_resupply){
			fleetResupplyPanelDown();
		}
		if (ad2460.openQuickMenues.selected_fleet_configuration){
			// Unused after design-spec
		}
		if (ad2460.openQuickMenues.selected_fleet_tactics){
			fleetTacticsPanelDown();
		}
		if (ad2460.openQuickMenues.outpost_transport_panel){
			transportOptionsMenuDown();
		}
		if (ad2460.openQuickMenues.starmap_intel_panel){
			hideEspionageOption();
		}
		if(typeof(callback) === 'function') {
			callback();
		}
	}
}

function mainContainerSelect(id){
		$("#"+id+".main_container").css( { zIndex: 2 } );
		//$(".main_container").not("#"+id).css( { zIndex: 1 } );
		mainConTop = parseInt($("#"+id+".main_container").css('top'));
		mainConLeft = parseInt($("#"+id+".main_container").css('left'));
		$("#"+id+".main_container").css( { transition: 'transform 200ms ease-in-out', transform: 'translateX(-'+(mainConLeft-10)+'px) translateY(-'+(mainConTop-10)+'px)'});
		mainContainerActive=1;
}

//open main panel
function mainPanelOpen(id){
		var thisId = id;
		var mainpanel=$("#"+thisId+" .main_panel");
		var mainpanelbg=$("#"+thisId+" .main_panel_bg");
		var mainpanelextended=$("#"+thisId+" .main_panel_extended_content");
		var textchange=$("#"+thisId+" .textchange");
		var mainpaneldarkpanel=$("#"+thisId+" .main_panel_darkpanel");
		var mainpanelcontent=$("#"+thisId+" .main_panel_content");		
		currentHeight = $("#"+thisId).height();
		currentWidth = $("#"+thisId).width();
		mainpanel.css({height: currentHeight, width: currentWidth }).transition({ width:mainWidth, height: mainHeight},200,'easeInOutSine');
		mainpanelextended.show().delay(250).transition( { opacity: 1 }, 400);
		textchange.html("CLICK PANEL TO COLLAPSE");
		if (mainpanel.hasClass("darkpanel") ) {
			//	mainpaneldarkpanel.click(function(e) {
			//		e.stopPropagation();
			//	});
			mainpaneldarkpanel.css({height: mainHeight-30, width: darkpanelWidth, right: -(darkpanelWidth)-45}).show().delay(200).transition({opacity: 1},200);
			mainpanelcontent.transition({width: mainWidth-darkpanelWidth-75},200);			
		}
		mainPanelExpanded=1;
		ad2460.openPanels.push(id);
}

//open side panel
function sidePanelOpen(id){
		var thisId = id;
		var sidepanel=$("#"+id+" .sidepanel");
		var sidepanelContent=$("#"+id+" .sidepanel_bg");
		sidepanel.css( {width: sideWidth, height: sideHeight, left: mainWidth-15}).show();
		$("#"+id+" .sidepanel_content").css( { width:sideWidth-50, height: sideHeight-35});
		sidepanelContent.css({transform: 'translateX(-'+sideWidth+'px)', height: (sideHeight-16)}).show().transition({delay:0},220, function(){sidepanelContent.css( { transition: 'transform 400ms ease-in-out', transform: 'translateX(0px)'})});		
		sidePanelVisible=1;
}

//open lower panel

function lowerPanelOpen(id){
		var thisId = id;
		var lowpanel=$("#"+id+" .lowpanel");
		var lowpanelbg=$("#"+id+" .lowpanel_bg");
		var lowpanelcontent=$("#"+id+" .lowpanel_content");
		var lowpaneltable=$("#"+id+" .lowpanel_table");
		var borderwrapper=$("#"+id+" .lowpanel_table_borderwrapper");
		var scrollbuttons=$("#"+id+" .lowpanel .scrollbuttons");
		var selfilter=$("#"+id+" .lowpanel_content .selection_filter_container");
		var scrollButtonHeight = parseInt(scrollbuttons.css("height"));
		var tableHeight = parseInt(lowpaneltable.css("height"));
		var scrollButtonPosition = (tableHeight-scrollButtonHeight)/2;
		//console.log('table: '+tableHeight+' Scrollbuttonheight: '+scrollButtonHeight+' Position: '+scrollButtonPosition);
		if (lowpaneltable.hasClass("market_table")) {
				lowpaneltable.css( { width: lowWidth-217 } );
				borderwrapper.css( { backgroundPosition: "0px 0px", width: lowWidth-247 } );
		}
		else if (lowpaneltable.hasClass("production_list_selection")) {
				lowpaneltable.css( { width: lowWidth-15 } );
				borderwrapper.css( { backgroundPosition: "0px 0px", width: lowWidth-247 } );
		}
		else if (lowpaneltable.hasClass("res_list_selection")) {
				lowpaneltable.css( { width: lowWidth-15 } );
				borderwrapper.css( { backgroundPosition: "0px 0px", width: lowWidth-247 } );
		}
		else if (lowpaneltable.hasClass("dev_list_selection")) {
				lowpaneltable.css( { width: lowWidth-15 } );
				borderwrapper.css( { backgroundPosition: "0px 0px", width: lowWidth-247 } );
		}
		
		else {		
				lowpaneltable.css( { width: lowWidth-25 } );
				borderwrapper.css( { backgroundPosition: "0px 0px", width: lowWidth-55 } );
				//console.log('Fixing table width.');		
		}
		scrollbuttons.css( { top: scrollButtonPosition}); 
		selfilter.css( { width: lowWidth, left: -10}); 
		//lowpanel.css( { top: mainHeight-15}).css( { width: lowWidth}).show();
		if (static_page==false){
			checkLowpanelScrollButtons(id);
		}
		setTimeout(
			function(){
				$("#"+id+" .lowpanel").css( { top: mainHeight-15}).css( { width: lowWidth}).show();
				$("#"+id+" .lowpanel_bg").css({transform: 'translateY(-'+(lowHeight-8)+'px)', height: lowHeight-8}).show().css( { transition: 'all 400ms ease-in-out', transform: 'translateY(0px)'});				
			}, 220
		)
		
		
		lowpanel.css( { width: lowWidth , height: lowHeight+2});
		lowpanelcontent.css( {height: lowHeight-30, width: lowWidth-30, opacity: 1});			
		lowerPanelVisible=1;
}


//open rear panel
function rearPanelOpen(id){
	var infopanel=$("#"+id+" .infopanel");
	var scrollbuttons=$("#"+id+" .infopanel .scrollbuttons");
	var selectioncontainer=$("#"+id+" .infopanel .selection_container");
	var scrollButtonHeight = parseInt(scrollbuttons.css("height"));
	var tableHeight = parseInt(selectioncontainer.css("height"));
	var scrollButtonPosition = (tableHeight-scrollButtonHeight)/2;
	scrollbuttons.css( { top: scrollButtonPosition}); 
	if (infoSolo==1) { 
		infopanel.css( { top: sideHeight-16 , left: 5, height: infoHeight, width: mainWidth+sideWidth-40, opacity: 0}).show().delay(620).transition( { opacity: 1 }, 200 , 'easeInOutSine' );
	}
	else {
		infopanel.css( { top: sideHeight-16 , left: lowWidth-1, height: lowHeight+mainHeight-sideHeight-5, width: mainWidth+sideWidth-lowWidth-30, opacity: 0}).show().delay(620).animate( { opacity: 1 }, 200 , 'easeInOutSine' );
	}

	rearPanelVisible=1;
	if (static_page!=true){
		panelOpenCallback(id);
		checkInfopanelScrollButtons(id);
	}

}

//close main container
function mainContainerDeselect(id, boxtop, boxleft, boxheight, boxwidth){
	setTimeout(
		function(){
			$("#"+id+".main_container").css( { transition: 'transform 300ms ease-in-out', transform: 'translateX(0px) translateY(0px)'});	
		}, 300
	);
	setTimeout(
		function(){
			$("#"+id+".main_container").css( { zIndex: 1 });
		}, 600
	);
	mainContainerActive=0;
}

//close main panel
function closeMainPanel(id, boxheight, boxwidth){
		var thisId = id;
		var mainpanel=$("#"+thisId+" .main_panel");
		var mainpanelbg=$("#"+thisId+" .main_panel_bg");
		var mainpanelextended=$("#"+thisId+" .main_panel_extended_content");
		var textchange=$("#"+thisId+" .textchange");
		var mainpaneldarkpanel=$("#"+thisId+" .main_panel_darkpanel");
		var mainpanelcontent=$("#"+thisId+" .main_panel_content");
		
		mainpanel.delay(250).transition( { width:boxwidth , height:boxheight }, 300 );
		mainpanelextended.transition( { opacity: 0 }, 200, function(){mainpanelextended.hide();} );
		textchange.html("CLICK PANEL TO EXPAND");
		if ( mainpanel.hasClass("darkpanel") ) {
			mainpaneldarkpanel.transition({opacity: 0}, 300 );
			mainpanelcontent.delay(250).transition({width: parseInt(boxwidth)-45},200);			
		}
		mainPanelExpanded=0;
		
		markPanelAsClosed(id);
}

//close side panel
function closeSidePanel(id){		
		var thisId = id;
		var sidepanel=$("#"+id+" .sidepanel");
		var sidepanelContent=$("#"+id+" .sidepanel_bg");
		
		if (sideHeight > mainHeight) {
			sidepanelContent.css({transition: 'all 200ms ease-in-out', transform: 'translateX(-'+sideWidth+'px)', height: mainHeight});	
//			sidepanel.transition( { width:0, height: mainHeight}, 200, 'easeInOutSine', function(){sidepanel.hide();} );		
		}
		else {
		sidepanelContent.css({transition: 'all 200ms ease-in-out', transform: 'translateX(-'+sideWidth+'px)'});			
		}
		setTimeout(
			function(){
				$("#"+id+" .sidepanel").hide();
			}, 200
		);
		
		sidePanelVisible=0;
}

//close lower panel
function closeLowerPanel(id){
		var thisId = id;
		var lowpanel=$("#"+id+" .lowpanel");
		var lowpanelbg=$("#"+id+" .lowpanel_bg");
		var lowpanelcontent=$("#"+id+" .lowpanel_content");
		
		lowpanelbg.css( { transition: 'all 200ms ease-in-out', transform: 'translateY(-'+(lowHeight-6)+'px)'});

		lowpanel.transition( { width: lowWidth+"px" , height:"0px" }, 200, function(){lowpanel.hide();});
//		lowpanelbg.transition( { height: "0px"}, 200 );
		lowpanelcontent.transition( { opacity: 0 }, 200  );		
		lowerPanelVisible=0;
}

function rearPanelClose(id){
		var infopanel=$("#"+id+" .infopanel");
		
		infopanel.css({opacity: 0}).hide();
		rearPanelVisible=0;
		if (static_page!=true){
			panelCloseCallback(id);
		}
}
function slideCenterOut(id){
	$("#"+id+" .centerslide_container_homeworld").css({ bottom: '-30px', right: '-30px', height:'80px', width: '80px'});
	$("#"+id+" .centerslide_homeworld").css({ transform: 'translateX(0px) translateY(0px)', transition: 'transform 300ms ease-in-out 320ms'})
}
function slideCenterIn(id){
	$("#"+id+" .centerslide_homeworld").css({ transform: 'translate3d(-35px, -35px, 0px)', transition: 'transform 100ms ease-in-out'});
	setTimeout(
		function(){
			$("#"+id+" .centerslide_container_homeworld").css({ bottom: '6px', right: '7px', height:'45px', width: '45px'});
		}, 150
	);
}

function slideCenterOutAlliance(id){
		$("#"+id+" .circular3").css({'rotate': 270});
		$("#"+id+" .circular2").css({'rotate': 180});
		$("#"+id+" .circular1").css({'rotate': 90});
		$("#"+id+" .circular1").show().delay(500).transition({rotate: '360deg'},280);
		$("#"+id+" .circular2").show().delay(600).transition({rotate: '360deg'},190);
		$("#"+id+" .circular3").show().delay(700).transition({rotate: '360deg'},100);
}
function slideCenterInAlliance(id){
		$("#"+id+" .circular3").transition({rotate: '270deg'},50, function(){$("#"+id+" .circular3").hide();});
		$("#"+id+" .circular2").transition({rotate: '180deg'},125, function(){$("#"+id+" .circular2").hide();});
		$("#"+id+" .circular1").transition({rotate: '90deg'},250, function(){$("#"+id+" .circular1").hide();});
}


function slideCenterOutOutpost(id){
		$("#"+id+" .insideslide").stop().delay(400).animate( {top: "0px", left: "20px"}, 300);
		/*$("#"+id+" .activeOutpost").stop().animate( {opacity: 0}, 300);
		$("#"+id+" .inactiveOutpost").stop().animate( {opacity: 1}, 300);*/
		$("#"+id+" .centerslide_mid_outpost").stop().delay(400).transition( {backgroundPosition: "-32px -32px"}, 300);
		$("#"+id+" .centerslide_high_outpost").stop().delay(400).transition( {backgroundPosition: "-42px -22px"}, 300);
		$("#"+id+" .centerslide_low_outpost").stop().delay(400).transition( {backgroundPosition: "-22px -42px"}, 300);
}

function slideCenterInOutpost(id){
		$("#"+id+" .insideslide").stop().delay(600).transition( {top: "0px", left: "0px"}, 500);
		/*$("#"+id+" .activeOutpost").stop().animate( {opacity: 1}, 300);
		$("#"+id+" .inactiveOutpost").stop().animate( {opacity: 0}, 300);*/
		$("#"+id+" .centerslide_mid_outpost").stop().transition( {backgroundPosition: "-62px -62px"}, 100);
		$("#"+id+" .centerslide_high_outpost").stop().transition( {backgroundPosition: "-72px -52px"}, 100);
		$("#"+id+" .centerslide_low_outpost").stop().transition( {backgroundPosition: "-52px -72px"}, 100);
}

function slideMissionSliderOut(id,sideHeight,mainHeight,innerSlide) {
		$("#"+id+" .outer_corner_slider").stop().delay(200).transition( {height: (sideHeight-mainHeight)+45+"px"}, 400);
		$("#"+id+" .inner_corner_slider").stop().delay(200).transition( {height: innerSlide}, 400);
		/*
		$("#"+id+" .inner_corner_slider").click(function(event){
		  event.stopPropagation();
		});
		$("#"+id+" .outer_corner_slider").click(function(event){
		  event.stopPropagation();
		});
		*/
}
function slideMissionSliderIn(id) {
		$("#"+id+" .outer_corner_slider").stop().transition( {height: "32px"}, 200);
		$("#"+id+" .inner_corner_slider").stop().transition( {height: "26px"}, 200);
		
}

function fillOutpost(id) {
		$("#"+id+" .zerofill").animate( {opacity: 1}, 500).delay(500).animate( {opacity: 1}, 500);
		$("#"+id+" .twentyfill").delay(1000).animate( {opacity: 1}, 500).delay(500).animate( {opacity: 0}, 500);
		$("#"+id+" .fortyfill").delay(2000).animate( {opacity: 1}, 500).delay(500).animate( {opacity: 0}, 500);
		$("#"+id+" .sixtyfill").delay(3000).animate( {opacity: 1}, 500).delay(500).animate( {opacity: 0}, 500);
		$("#"+id+" .eightyfill").delay(4000).animate( {opacity: 1}, 500).delay(500).animate( {opacity: 0}, 500);
		$("#"+id+" .hundredfill").delay(5000).animate( {opacity: 1}, 500);
}

function emptyOutpost(id) {
		$("#"+id+" .zerofill").stop().animate( {opacity: 1}, 500);
		$("#"+id+" .twentyfill").stop().animate( {opacity: 0}, 500);
		$("#"+id+" .fortyfill").stop().animate( {opacity: 0}, 500);
		$("#"+id+" .sixtyfill").stop().animate( {opacity: 0}, 500);
		$("#"+id+" .eightyfill").stop().animate( {opacity: 0}, 500);
		$("#"+id+" .hundredfill").stop().animate( {opacity: 0}, 500);
}

function showFullInfoPanel(id) {
		var thisId = id;
		var sidepanel=$("#"+id+" .sidepanel");
		var infopanel=$("#"+id+" .infopanel");
		var infoHeight=$("#"+id+" .infopanel").height();	
		if (sideHeight > mainHeight) {
			sidepanel.stop().transition( { width:0, height: mainHeight}, 400, 'easeInOutSine', function(){sidepanel.hide();} );		
		}
		else {
			sidepanel.stop().transition( { width:0, height: sideHeight}, 400, 'easeInOutSine', function(){sidepanel.hide();} );			
		}
		sidePanelVisible=0;
		infopanel.css( { top: '1px', height: (sideHeight+infoHeight)-17});
}
function reduceFullInfoPanel(id) {
		var thisId = id;
		var sidepanel=$("#"+id+" .sidepanel");
		var infopanel=$("#"+id+" .infopanel");
		var infoHeight=$("#"+id+" .infopanel").height();	
		if (sideHeight > mainHeight) {
			sidepanel.show().transition( { width:sideWidth, height: mainHeight}, 400, 'easeInOutSine');		
		}
		else {
			sidepanel.show().transition( { width: sideWidth, height: sideHeight}, 400, 'easeInOutSine');			
		}
		sidePanelVisible=1;
		infopanel.delay(400).queue(function(){
			$(this).css( { top: sideHeight-16, height: (sideHeight+infoHeight)-17});
			$(this).dequeue();
		});
}

//** Content Box Live Page Functions **//

//		$(".main_panel").on("click",

$(document).ready(function(){
		$("#body").on("click",".main_panel",
		function(event) {
			var testId = $(this).parent("div").attr("id");
			if (acceptClick==true && panelOpen==0){
				acceptClick=false;
				id = $(this).parent("div").attr("id");
//				console.log(id);
				boxtop = ""+$(this).parent().css("top");
				boxleft = ""+$(this).parent().css("left");
				boxheight = ""+$(this).parent().css("height");
				boxwidth = ""+$(this).parent().css("width");
				mainHeight = 250;
				mainWidth = 400;
				sideHeight = 250;
				sideWidth = 500;
				lowHeight = 300;
				lowWidth = 380;
				infoSolo = 0;
				// Lagt til av Christian, da den må være DEFINERT....
				innerSlide=0;

				// alert(id);

				if ($(this).hasClass("production")) { 
				mainHeight = 250; mainWidth = 400; 
				sideHeight = 250; sideWidth= 600;
				lowHeight = 325; lowWidth = 380;
				infoSolo = 0;
				slideCenterOut(id);
				}
				else if ($(this).hasClass("development")) { 
				mainHeight = 250; mainWidth = 400; 
				sideHeight = 250; sideWidth= 600;
				lowHeight = 325; lowWidth = 380;
				infoSolo = 0;
				slideCenterOut(id);
				}
				else if ($(this).hasClass("research")) { 
				mainHeight = 250; mainWidth = 400; 
				sideHeight = 250; sideWidth= 600;
				lowHeight = 325; lowWidth = 380;
				infoSolo = 0;
				slideCenterOut(id);
				}
				else if ($(this).hasClass("facilities")) { 
				mainHeight = 250; mainWidth = 480; 
				sideHeight = 250; sideWidth= 520;
				lowHeight = 325; lowWidth = 470;
				infoSolo = 0;
				slideCenterOut(id);
				//console.log("Facilities-panel clicked!");
				//mainHeight = 225; mainWidth = 500; 
				//sideHeight = 225; sideWidth= 500;
				//lowHeight = 350; lowWidth = 480;
				//infoSolo = 0;
				//slideCenterOut(id);
				}

				else if ($(this).hasClass("signup")) { 
				mainHeight = 200; mainWidth = 350; 
				sideHeight = 200; sideWidth= 450;
				lowHeight = 0; lowWidth = 380;
				infoSolo = 1; infoHeight = 150;
				}		
				else if ($(this).hasClass("login")) { 
				mainHeight = 200; mainWidth = 350; 
				sideHeight = 200; sideWidth= 450;
				lowHeight = 0; lowWidth = 380;
				infoSolo = 1;  infoHeight = 150;
				}
				else if ($(this).hasClass("empty")) { 
				mainHeight = 200; mainWidth = 400; 
				sideHeight = 200; sideWidth= 600;
				lowHeight = 375; lowWidth = 380;
				infoSolo = 0;
				slideCenterOutAlliance(id);
				}
				else if ($(this).hasClass("marketplace")) { 
				mainHeight = 250; mainWidth = 650; 
				sideHeight = 250; sideWidth= 355;
				lowHeight = 325; lowWidth = 635;
				infoSolo = 0; darkpanelWidth = 200;
				slideCenterOutAlliance(id);
				}
				else if ($(this).hasClass("alliancedevelopment")) { 
				mainHeight = 250; mainWidth = 500; 
				sideHeight = 220; sideWidth= 500;
				lowHeight = 325; lowWidth = 485;
				slideCenterOutAlliance(id);
				}
				else if ($(this).hasClass("alliancemanage")) { 
				mainHeight = 225; mainWidth = 410; 
				sideHeight = 245; sideWidth= 590;
				lowHeight = 350; lowWidth = 395;
				slideCenterOutAlliance(id);
				}
				else if ($(this).hasClass("member_directory")) { 
				mainHeight = 250; mainWidth = 450; 
				sideHeight = 330; sideWidth= 550;
				lowHeight = 325; lowWidth = 435;
				slideCenterOutAlliance(id);
				}
				else if ($(this).hasClass("fleetmanagement")) { 
				mainHeight = 225; mainWidth = 500; 
				sideHeight = 250; sideWidth= 500;
				lowHeight = 350; lowWidth = 480;
				infoSolo = 0; darkpanelWidth = 200;
				innerSlide = 28;
				slideMissionSliderOut(id,sideHeight,mainHeight,innerSlide);
				}
				else if ($(this).hasClass("fleetmovement")) { 
				mainHeight = 210; mainWidth = 550; 
				sideHeight = 210; sideWidth= 450;
				lowHeight = 365; lowWidth = 530;
				infoSolo = 0; darkpanelWidth = 200;
				innerSlide = 28;
				slideMissionSliderOut(id,sideHeight,mainHeight,innerSlide);
				}
				else if ($(this).hasClass("commanders")) { 
				mainHeight = 240; mainWidth = 500; 
				sideHeight = 380; sideWidth= 500;
				lowHeight = 335; lowWidth = 480;
				infoSolo = 0; darkpanelWidth = 180;
				innerSlide = 50; innerSlide = 64;
				slideMissionSliderOut(id,sideHeight,mainHeight,innerSlide);
				}
				else if ($(this).hasClass("outpost")) { 
				mainHeight = 300; mainWidth = 500; 
				sideHeight = 300; sideWidth= 500;
				lowHeight = 275; lowWidth = 480;
				infoSolo = 0; darkpanelWidth = 200;
				slideCenterOutOutpost(id);
				}
				else if ($(this).hasClass("intelligence")) { 
				mainHeight = 200; mainWidth = 450; 
				sideHeight = 200; sideWidth= 550;
				lowHeight = 375; lowWidth = 430;
				infoSolo = 0; innerSlide = 32;
				slideMissionSliderOut(id,sideHeight,mainHeight,innerSlide);
				}
				else if ($(this).hasClass("missions")) { 
				mainHeight = 215; mainWidth = 400; 
				sideHeight = 280; sideWidth= 600;
				lowHeight = 360; lowWidth = 380;
				infoSolo = 0; innerSlide = 64;
				slideMissionSliderOut(id,sideHeight,mainHeight,innerSlide);
				}
				else if ($(this).hasClass("combat_log")) { 
				mainHeight = 200; mainWidth = 450; 
				sideHeight = 210; sideWidth= 550;
				lowHeight = 375; lowWidth = 430;
				infoSolo = 0; innerSlide = 36;
				slideMissionSliderOut(id,sideHeight,mainHeight,innerSlide);
				};
				
				
				mainContainerSelect(id);
				mainPanelOpen(id);
				rearPanelOpen(id);
				sidePanelOpen(id);
				lowerPanelOpen(id);
								
				setTimeout('acceptClick=true',600);
				panelOpen=1;
				if (!static_page){
					alertSystemToPanelOpened(testId);
				}
			}
			if (acceptClick==true && panelOpen==1){			
				acceptClick=false;
				mainContainerDeselect(id, boxtop, boxleft, boxheight, boxwidth);
				closeMainPanel(id, boxheight, boxwidth);
				closeSidePanel(id);
				closeLowerPanel(id);
				rearPanelClose(id);
				slideCenterIn(id);
				slideCenterInOutpost(id);
				slideCenterInAlliance(id);
				slideMissionSliderIn(id);
				setTimeout('acceptClick=true',600);
				panelOpen=0;
				if (!static_page){
					alertSystemToPanelClosed(testId);
				}
				if ($(this).hasClass("outpost")){
					if (ad2460.openQuickMenues.outpost_transport_panel)	{
						transportOptionsMenuDown();
					}
				}
			}
		});
	});// JavaScript Document
var easing = "easeInOutSine";
var tableid = 0;
var expanderOpen = 0;
var rowOpen = 0;
//openSelectedRow

function openSelectedRow(id, height){
		$("#"+id).animate( { height:"100px" , top:"-35px" , right: "10px" , left: "10px" }, {duration :300, easing : easing} );
		$("#"+id).css( { zIndex: 2 } );
		$("#"+id+" .queue_entry_name").animate( { left: "100px" }, 300);
		$("#"+id+" .queue_entry_info").delay(300).animate( { opacity: 1 }, 300);	
		$("#"+id+" .queue_entry_img").delay(300).animate( { opacity: 1} , {duration :500 } );
		expanderOpen=1;
}


function openSelectedRowTop(id, height){
		$("#"+id).animate( { height:"100px" , top:"-5px" , right:"10px" , left: "10px" }, {duration :300, easing : easing} );
		$("#"+id).css( { zIndex: 2 } );
		$("#"+id+" .queue_entry_name").animate( { left: "100px" }, 300);	
		$("#"+id+" .queue_entry_info").delay(300).animate( { opacity: 1 }, 300);	
		$("#"+id+" .queue_entry_img").delay(300).animate( { opacity: 1} , {duration :500 } );
		expanderOpen=1;
}

function openSelectedRowBottom(id, height){
		$("#"+id).animate( { height:"100px" , top:"-65px" , right: "10px" , left: "10px" }, {duration :300, easing : easing} );
		$("#"+id).css( { zIndex: 2 } );
		$("#"+id+" .queue_entry_name").animate( { left: "100px" }, 300);	
		$("#"+id+" .queue_entry_info").delay(300).animate( { opacity: 1 }, 300);	
		$("#"+id+" .queue_entry_img").delay(300).animate( { opacity: 1} , {duration :500 } );
		expanderOpen=1;
}

function closeSelectedRow(id){
	//$("#"+id).animate( { height:"20px" , top:"0px" }, {duration :300, easing : easing} ).css( {z-index: 0 });
	//$("#"+id).delay(300).css( { zIndex: 0 } );
	//$("#"+id).animate( { height:"20px" , top:"0px" }, {duration :300, easing : easing, complete: function(){$("#"+id).css("z-index",0};} );
	$("#"+id).stop().animate({
		height:"28px" , top:"0px" , right: "0px" , left: "0px"
	}, 
	{
		duration: 300, 
		easing : easing, 
		complete: function() {
			$("#"+id).css("z-index",0);
		}
	});
	$("#"+id+" .queue_entry_name").stop().animate( { left: "0px" }, 300);
	$("#"+id+" .queue_entry_info").stop().animate( { opacity: 0 }, 100);	
	$("#"+id+" .queue_entry_img").stop().animate( { opacity: 0} , {duration :100 } );

	expanderOpen=0;
}


function expandSelectedRow(tableid){
		/* DUCUMENTATION
		itemheight: the height of the inner content of the box (what needs to be shown when expanded).
		itemdisplace: a modifier to the top value when expanding.
		itemdisplaceleft : how far the left of the parent container the floating element will be.
		itemdisplaceright : how far the right of the parent container the floating element will be.
		rowheight: the initial height of the parent container.
		scrollmod: 
		topmod: 
		*/
		var itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
		if ($("#"+tableid+" .queue_entry_info").hasClass('fleet_info_bg')){}
		else{
			var originalWidth = parseInt($("#"+tableid+" .queue_entry_info").width());
			$("#"+tableid+" .queue_entry_info").css( {width: (originalWidth-20)+'px'});
			var openWidth = $("#"+tableid+" .queue_entry_info").width();
		}
		var itemoffset_top = $("#"+tableid).parent().position().top;
		//console.log(itemoffset_top);
		var parentheight = $("#"+tableid).parent().parent().height();
		var itemdisplace = -35;
		var itemdisplaceleft = 10;
		var itemdisplaceright = 10;
		var rowheight = parentheight;
		var scrollmod = 1;
		var topmod = 20;
		
		if ($('#'+tableid).hasClass("dev_bonus_entry")) { /* THIS IS THE GOOD SOLUTION!!! */
				itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
				itemdisplace = 0;
				itemdisplaceleft = 10;
				itemdisplaceright = 10;
				scrollmod = parseInt($("#"+tableid).parent().parent().css('top'));
				parentheight = $("#"+tableid).parent().parent().parent().height();
			}
		
		else if ($('#'+tableid).hasClass("outpostships")) { 
				itemheight =  parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
				itemdisplace = 0;
				topmod = 0;
				if ($('#'+tableid).hasClass("list_right")) { 
					itemdisplaceleft= -(parseInt($("#"+tableid+".row_entry").outerWidth())-6);
				}
				else if ($('#'+tableid).hasClass("list_left")) { 
					itemdisplaceright= -(parseInt($("#"+tableid+".row_entry").outerWidth()))+6;
				}				
			}
		else if ($('#'+tableid).hasClass("outpostships_top")) { 
				itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
				itemdisplace = -5;
			}
		else if ($('#'+tableid).hasClass("outpostships_bottom")) { 
				itemdisplace = -65;	
			}
		else if ($('#'+tableid).hasClass("list_right")) { 
				itemdisplaceleft= -(parseInt($("#"+tableid+".row_entry").outerWidth())-6);
			}
		else if ($('#'+tableid).hasClass("list_left")) { 
				itemdisplaceright= -(parseInt($("#"+tableid+".row_entry").outerWidth()))+6;
			}
		else if ($('#'+tableid).hasClass("commander_entry")) { 
				//$("#"+tableid+" .defensive_commander_img").animate( { left: "5px"}, 300);
				//$("#"+tableid+" .defensive_commander_name").animate( { left: "5px" }, 300);
				$("#"+tableid+" .def_commander_statcontainer").css( {opacity: 0}).show().delay(400).animate( { opacity: 1 }, 300);
				itemheight = 228;
		    	itemdisplace = 0;
				itemdisplaceleft = -300;
				itemdisplaceright = 0;	
				scrollmod = 0;
			}
		else if ($('#'+tableid).hasClass("def_tactics_entry")) {
				itemheight = 270;
		    	itemdisplace = 0;
				itemdisplaceleft = 0;
				itemdisplaceright = -158;
			
				var tmp=0;
				var tactical_rows=$('#'+tableid).children(".tactical_row");
			
				for (tmp=0;tmp<tactical_rows.size();tmp++){
					var myElement=tactical_rows[tmp];
					var def_tactical_options=$(myElement).children('.def_tactical_options');
					// id 0 av disse skal ha høyden
					var tmpHeight=0;
					var tmp2=0;
					for (tmp2=0;tmp2<def_tactical_options.size();tmp2++){
						var myElement2=def_tactical_options[tmp2];
						var tactical_wrapper=$(myElement2).children('.tactical_wrapper:first');
						var thisHeight=$(tactical_wrapper[0]).height();
						tmpHeight+=thisHeight;
					}
					$(def_tactical_options[0]).stop().delay(50).animate({ height: (tmpHeight-18)+"px" },300);
					
				}
			$(".def_current_tactic").stop().delay(50).animate( { height: "0px" }, 300);				
			//$("#"+tableid+" .def_tactical_options").each( function() {
			//$("#"+tableid+" .def_tactical_options").stop().animate( { height: ($('.tactical_wrapper').height()) }, 450);
			//});
			}
			
		else if ($('#'+tableid).hasClass("reserve_ship")) { 
				$("#"+tableid+" .queue_entry_reserve").animate({width: '100px'},350);
				$("#"+tableid+" .column_button.reserve").animate({opacity: 0},{duration :100, complete: function() {$("#"+tableid+" .column_button.reserve").css({top: '30px', right: '5px', width: '150px'});}}).delay(200).animate({opacity: 1},300);
				$("#"+tableid+" .column_button.reserve2").show().animate({opacity: 1},400);
			}
			
		else if ($('#'+tableid).hasClass("current_ally_dev")) { 
				itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
				rowheight = 58;
		    	itemdisplace = -5;
				itemdisplaceleft = 10;
				itemdisplaceright = 10;
				$("#"+tableid+" .dev_closed_time").animate( { opacity: 0 }, 200);
				$("#"+tableid+" .dev_opened_time").animate( { opacity: 1 }, 500);
			}
			
//		if ($('#'+tableid).hasClass("dev_bonus_entry")) { 
//			
//				itemdisplace = 0;
//				itemdisplaceleft = 10;
//				itemdisplaceright = 10;
//				$("#"+tableid+" .queue_entry_info").css({paddingRight: (itemdisplaceleft+itemdisplaceright)});
//				itemheight = parseInt($("#"+tableid+" .queue_entry_info").height())+40;
//				scrollmod = parseInt($("#"+tableid).parent().parent().css('top'));
//				console.log('scrollmod value: '+scrollmod);
//				parentheight = $("#"+tableid).parent().parent().parent().height();
//				console.log('parentheight value: '+parentheight);
//			}
		
		else {}
		if (scrollmod <= 0) {topmod = 0};
		if (itemheight < 100) {itemheight = 100}; //Removed to clear up height issue. Still buggy. Look into it : Fleet Management. queue_entry_info changes size after first closing. Check it out. *Width defined, temp fix*
		topdisplacement = -(((itemheight-30)/2)-0);
			if((((itemoffset_top +scrollmod) +topdisplacement) + itemheight) > parentheight) {topdisplacement = -((itemheight + (itemoffset_top+scrollmod)) - (parentheight-5))}
			if(topdisplacement < topmod-(itemoffset_top+scrollmod) ) {topdisplacement = topmod-(itemoffset_top+scrollmod)}; //removed else if. Check for bugs!!!
		//console.log('Top displacement: '+topdisplacement);
		//console.log('Item Height: '+itemheight);
		$("#"+tableid).stop().animate( { height: itemheight+0 , top: topdisplacement, right: itemdisplaceright , left: itemdisplaceleft }, {duration :300, easing : easing} );
		$("#"+tableid).css( { zIndex: 2 } );
		if ($("#"+tableid+" .queue_entry_name").hasClass("trade")) {
			$("#"+tableid+" .queue_entry_name").stop().animate( { left: "10px" }, 300);
		}
		else {
			$("#"+tableid+" .queue_entry_name").stop().animate( { left: "100px" }, 300);
		}
		$("#"+tableid+" .queue_entry_info").css( {paddingRight: 0}).stop().delay(300).animate( { opacity: 1 }, 300);	
		$("#"+tableid+" .queue_entry_img").stop().delay(300).animate( { opacity: 1} , {duration :500 } );
		//rowOpen=1;
}

/*function expandSelectedRow(tableid,itemheight,itemdisplace,itemdisplaceleft, itemdisplaceright, itemoffset_top, parentheight){
		if (itemheight < 100) {itemheight = 100};
		topdisplacement = -(((itemheight-30)/2)-0);
			if(((itemoffset_top +topdisplacement) + itemheight) > parentheight) {topdisplacement = -((itemheight + itemoffset_top) - (parentheight))} //old: parentheight-20
			if(topdisplacement < 20-itemoffset_top ) {topdisplacement = 20-itemoffset_top};
		$("#"+tableid).animate( { height: itemheight , top: topdisplacement, right: itemdisplaceright , left: itemdisplaceleft }, {duration :300, easing : easing} );
		$("#"+tableid).css( { zIndex: 2 } );
		$("#"+tableid+" .queue_entry_name").stop().animate( { left: "100px" }, 300);
		$("#"+tableid+" .queue_entry_info").stop().delay(300).animate( { opacity: 1 }, 300);	
		$("#"+tableid+" .queue_entry_img").stop().delay(300).animate( { opacity: 1} , {duration :500 } );
		rowOpen=1;
}*/

function minimizeSelectedRow(tableid,rowheight){
	var rowheight = 28;
	var itemdisplaceleft = 10;
	var itemdisplaceright = 10;
	
	if ($('#'+tableid).hasClass("commander_entry")) { 
				//$("#"+tableid+" .defensive_commander_img").animate( { left: "16px" }, 300);
				//$("#"+tableid+" .defensive_commander_name").animate( { left: "15px" }, 300);
				$("#"+tableid+" .def_commander_statcontainer").hide();
			
			rowheight = 228;
			}
			if ($('#'+tableid).hasClass("def_tactics_entry")) { 
				rowheight = 154;
				$("#"+tableid+" .def_tactical_options").each( function() {
				$('.def_tactical_options').stop().animate( { height: "18px" }, 300);
				$(".def_current_tactic").stop().animate( { height: "18px" }, 300);
			});
			$("#"+tableid+" .retreat_condition").stop().animate( { height: "0px" }, 300);
			}
			if ($('#'+tableid).hasClass("reserve_ship")) { 
				$("#"+tableid+" .queue_entry_reserve").animate({width: '220px'},350);
				$("#"+tableid+" .column_button.reserve").animate({opacity: 0},{duration :200, complete: function() {$("#"+tableid+" .column_button.reserve").css({top: '-3px', right: '0px', width: '120px',zIndex: 3});}}).delay(100).animate({opacity: 1},400);
				$("#"+tableid+" .column_button.reserve2").animate({opacity: 0},{duration :100, complete: function() {$("#"+tableid+" .column_button.reserve2").css({zIndex: 0}).hide();}});
			}
			
			if ($('#'+tableid).hasClass("current_ally_dev")) { 
				rowheight = 58;
				$("#"+tableid+" .dev_closed_time").animate( { opacity: 1 }, 500);
				$("#"+tableid+" .dev_opened_time").animate( { opacity: 0 }, 200);
			}
			
			if ($('#'+tableid).hasClass("dev_bonus_entry")) { 
				
			}
		
	
	
	
	$("#"+tableid).stop().animate({
		height:rowheight+"px" , top:"0px" , right: "0px" , left: "0px"
	}, 
	{
		duration: 300, 
		easing : easing, 
		complete: function() {
			$("#"+tableid).css("z-index",0);
		}
	});
	$("#"+tableid+" .queue_entry_name").stop().animate( { left: "0px" }, 300);
	if ($("#"+tableid+" .queue_entry_info").hasClass('fleet_info_bg')){
		$("#"+tableid+" .queue_entry_info").stop().animate( { opacity: 0 },{duration: 100, complete: function() {$("#"+tableid+" .queue_entry_info").css({paddingRight: (itemdisplaceleft+itemdisplaceright)})}});	
	}
	else {
		$("#"+tableid+" .queue_entry_info").stop().animate( { opacity: 0 },{duration: 100, complete: function() {$("#"+tableid+" .queue_entry_info").css({paddingRight: (itemdisplaceleft+itemdisplaceright), width: 'auto'})}});
	}
	$("#"+tableid+" .queue_entry_img").stop().animate( { opacity: 0} , {duration :100 } );
	
	

	//rowOpen=0;
}



function shipTypesUp(){
		$("#shipselection").stop().animate( { top:"-210px" }, {duration :600, easing : easing} );
}

function shipTypesDown(){
		$("#shipselection").stop().animate( { top:"0px" }, {duration :600, easing : easing} );
}

function devTypesUp(){
		$("#devselection").stop().animate( { top:"-190px" }, {duration :600, easing : easing} );
}

function devTypesDown(){
		$("#devselection").stop().animate( { top:"10px" }, {duration :600, easing : easing} );
}

function resTypesUp(){
		$("#resselection").stop().animate( { top:"-190px" }, {duration :600, easing : easing} );
}

function resTypesDown(){
		$("#resselection").stop().animate( { top:"10px" }, {duration :600, easing : easing} );
}

function out1TypesUp(){
		$("#out1selection").stop().animate( { top:"-190px"}, {duration :600, easing : easing} );
		$("#out1bg").stop().animate( {  backgroundPosition: "0px -50px" }, {duration :600, easing : easing} );
}

function out1TypesDown(){
		$("#out1selection").stop().animate( { top:"0px" }, {duration :600, easing : easing} );
		$("#out1bg").stop().animate( {  backgroundPosition: "0px 0px" }, {duration :600, easing : easing} );
}

function trackFleetListUp(){
		$("#fleetList").stop().animate( { top:"-180px"}, {duration :600, easing : easing} );
		$("#fleetListBG").stop().animate( {  backgroundPosition: "0px -60px" }, {duration :600, easing : easing} );
}

function trackFleetListDown(){
		$("#fleetList").stop().animate( { top:"0px" }, {duration :600, easing : easing} );
		$("#fleetListBG").stop().animate( {  backgroundPosition: "0px 0px" }, {duration :600, easing : easing} );
}

function outpostListUp(){
		$(".lowpanel_table_scrollwrapper").stop().animate( { top:"-180px"}, {duration :600, easing : easing} );
		$(".lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "0px -60px" }, {duration :600, easing : easing} );
}

function outpostListDown(){
		$(".lowpanel_table_scrollwrapper").stop().animate( { top:"0px" }, {duration :600, easing : easing} );
		$(".lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "0px 0px" }, {duration :600, easing : easing} );
}

//function showTransports (){
//		$("#transportoptions").show().stop().animate( { opacity: 1 } , 400 );
//		$("#fleetdetails").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#fleetdetails").hide();}}   );
//		$("#outpost_fleet_overview").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#outpost_fleet_overview").hide();}}  );
//}

function showFleets(){
		//$("#transportoptions").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#transportoptions").hide();}}  );
		$("#outpost_fleet_overview").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#outpost_fleet_overview").hide();}}  );
		$("#fleetdetails").show().stop().animate( { opacity: 1 } , 400 );
}

function showDefenses(){
		//$("#transportoptions").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#transportoptions").hide();}}  );
		$("#fleetdetails").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#fleetdetails").hide();}}  );
		$("#outpost_fleet_overview").show().stop().animate( { opacity: 1 } , 400 );
}

function showReserves(){
		$("#manage_selected_fleet").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#manage_selected_fleet").hide(); }}  );
		$("#reserve_fleet").show().stop().animate( { opacity: 1 } , 400 );
		//console.log('Showing Reserves');
}

function manageSelectedFleet(){
		$("#reserve_fleet").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#reserve_fleet").hide(); }}  );
		$("#manage_selected_fleet").show().stop().animate( { opacity: 1 } , 400 );
		//console.log('Showing Selected Fleet');
}

function showRecruits(){
		//$("#transportoptions").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#transportoptions").hide();}}  );
		$("#commander_history").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#commander_history").hide();}}  );
		$("#academy_recruits").show().stop().animate( { opacity: 1 } , 400 );
		$("#commander_sheet").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#commander_sheet").hide();}}  );
		$("#recruit_sheet").show().stop().animate( { opacity: 1 } , 400 );
}

function showCommanderHistory(){
		//$("#transportoptions").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#transportoptions").hide();}}  );
		$("#academy_recruits").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#academy_recruits").hide();}}  );
		$("#commander_history").show().stop().animate( { opacity: 1 } , 400 );
		$("#recruit_sheet").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#recruit_sheet").hide();}}  );
		$("#commander_sheet").show().stop().animate( { opacity: 1 } , 400 );
}

//function showSpyDetails(){
//		//$("#transportoptions").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#transportoptions").hide();}}  );
//		$('#report_side_panel').show();
//		$('#spy_side_panel').hide();
//		$("#full_spy_log").hide();
//		$("#single_spy_report").show();
//}
//function showSpyLog(){
//		//$("#transportoptions").stop().animate( { opacity: 0 } , {duration :400, complete: function() {$("#transportoptions").hide();}}  );
//		$("#single_spy_report").hide();
//		$("#full_spy_log").show();
//		$('#report_side_panel').hide();
//		$('#spy_side_panel').show();
//}
function showScoutDetails(){
		$("#single_spy_report").hide();
		$("#single_scout_report").show();
		//$("#single_scout_report").css({opacity: 0}).delay(200).queue(function(){$("#single_scout_report").animate({opacity: 1},250);console.log('Done!');});
		$("#single_infiltration_report").hide();
		$("#single_outpost_report").hide();
		$("#full_spy_log").hide();
}
function showSpyDetails(){
		$("#single_spy_report").show();
		$("#single_scout_report").hide();
		$("#single_infiltration_report").hide();
		$("#single_outpost_report").hide();
		$("#full_spy_log").hide();
}
function showInfiltrationDetails(){
		$("#single_spy_report").hide();
		$("#single_scout_report").hide();
		$("#single_infiltration_report").delay(400).fadeIn(300);
		$("#single_outpost_report").hide();
		$("#full_spy_log").hide();
}
function showOutpostDetails(){
		$("#single_spy_report").hide();
		$("#single_scout_report").hide();
		$("#single_infiltration_report").hide();
		$("#single_outpost_report").delay(400).fadeIn(300);
		$("#full_spy_log").hide();
}
function showIntelLog(){
		$("#single_spy_report").hide();
		$("#single_scout_report").hide();
		$("#single_infiltration_report").hide();
		$("#single_outpost_report").hide();
		$("#full_spy_log").delay(400).fadeIn(300);
		//$("#full_spy_log").delay({duration :200, complete: function() {$("#full_spy_log").css({opacity: 0}).show().transition({opacity: 1},250);}}  );
}


function lowtableSlideRight(){
		$("#spaceMissions").transition( { x:-325},600 );
		$("#PackContents").transition( { x:-325, top: '0px'}, 600);
		$("#missions_panel .lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "-60px -0px" }, {duration :600, easing : easing} );
		$("#missionScrollButtonUp").attr("onclick","myScroll('PackContents',181,500,'scrollBG')");
		$("#missionScrollButtonDown").attr("onclick","myScroll('PackContents',-181,500,'scrollBG')");
		$("#missions_footer").transition( { y: -30}, 600);
		$("#soloMissionHeader").transition( { x: -323}, 600);
		$("#missionContents").transition( { bottom:"30px"},600 );
}

function lowtableSlideLeft(){
		$("#spaceMissions").transition({ x: 0 },600 );
		$("#PackContents").transition( { x:0, top: '0px'}, 600 );
		$("#missions_panel .lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "0px 0px" }, {duration :600, easing : easing} );
		$("#missionScrollButtonUp").attr("onclick","myScroll('spaceMissions',181,500,'scrollBG')");
		$("#missionScrollButtonDown").attr("onclick","myScroll('spaceMissions',-181,500,'scrollBG')");
		$("#missions_footer").transition( { y: -0}, 600);
		$("#soloMissionHeader").transition( { x: -0}, 600);
		$("#missionContents").transition( { bottom:"0px"},600 );
		
		
}
//Old Side Panel Function - Reference only
/*function showAllyMissionPack(){
		$("#allyMissions").transition( { x: -250},600 );
		$("#allyMissionPack").transition( { x: -340, top: '0px'},600 );
		$("#view_missions_Side .lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "-60px -0px" }, {duration :600, easing : easing} );
		$("#allyMissionSBUp").attr("onclick","myScroll('allyMissionPack',181,500,'scrollBG')");
		$("#allyMissionSBDown").attr("onclick","myScroll('allyMissionPack',-181,500,'scrollBG')");
		$("#allymissions_footer").transition( { y: -30}, 600);
		$("#selectedAllyPack").transition( { y: 30}, 600);
		$("#allymission_scrollcontainer").transition( { bottom:"30px", top: "30px"},600 );
}


function showAllyMissions(){
		$("#allyMissions").transition( { x: 0},600 );
		$("#allyMissionPack").transition( { x: 0, top: '0px'},600 );
		$("#view_missions_Side .lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "0px 0px" }, {duration :600, easing : easing} );
		$("#allyMissionSBUp").attr("onclick","myScroll('soloMissions',181,500,'scrollBG')");
		$("#allyMissionSBDown").attr("onclick","myScroll('soloMissions',-181,500,'scrollBG')");
		$("#allymissions_footer").transition( { y: 0}, 600);
		$("#selectedAllyPack").transition( { y: 0}, 600);
		$("#allymission_scrollcontainer").transition( { bottom:"0px", top: "0px"}, 600 );
}

function showAllyMissionPack(){
		$("#allyMissions").transition( { x: -250},600 );
		$("#allyMissionPack").transition( { x: -340, top: '0px'},600 );
		$("#view_missions_Side .lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "-60px -0px" }, {duration :600, easing : easing} );
		$("#allyMissionSBUp").attr("onclick","myScroll('allyMissionPack',181,500,'scrollBG')");
		$("#allyMissionSBDown").attr("onclick","myScroll('allyMissionPack',-181,500,'scrollBG')");
		$("#allymissions_footer").transition( { y: -30}, 600);
		$("#selectedAllyPack").transition( { y: 30}, 600);
		$("#allymission_scrollcontainer").transition( { bottom:"30px", top: "30px"},600 );
}*/


function showAllyMissions(){
		$("#allyMissions").transition( { x: 0},600 );
		$("#allyMissionPack").transition( { x: 0, top: '0px'},600 );
		$("#view_missions_Side .lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "0px 0px" }, {duration :600, easing : easing} );
		$("#allyMissionSBUp").attr("onclick","myScroll('allyMissions',181,500,'scrollBG')");
		$("#allyMissionSBDown").attr("onclick","myScroll('allyMissions',-181,500,'scrollBG')");
		$("#allymissions_footer").transition( { y: 0}, 600);
		$("#selectedAllyPack").transition( { y: 0}, 600);
		$("#allymission_scrollcontainer").transition( { bottom:"0px", top: "0px"}, 600 );
}
function showAllyMissionPack(packName){
		$('#allyPackTitle').html(packName);
		$("#allyMissions").transition( { x: -300},600 );
		$("#allyMissionPack").transition( { x: -340, top: '0px'},600 );
		$("#view_missions_Side .lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "-60px -0px" }, {duration :600, easing : easing} );
		$("#allyMissionSBUp").attr("onclick","myScroll('allyMissionPack',181,500,'scrollBG')");
		$("#allyMissionSBDown").attr("onclick","myScroll('allyMissionPack',-181,500,'scrollBG')");
		$("#allymissions_footer").transition( { y: -30}, 600);
		$("#selectedAllyPack").transition( { y: 30}, 600);
		$("#allymission_scrollcontainer").transition( { bottom:"30px", top: "30px"},600 );
}

function showSoloMissionPack(packName,packNumber){
		
		if (static_page==true){
			$('.mission_pack_img').html('');
			if (packNumber == 1) {$('.mission_pack_img').prepend('<img class="img_pack" src="images/fixed/missions/mission_pack_img_1.jpg" />'); console.log('showing image: '+packNumber);}
			if (packNumber == 2) {$('.mission_pack_img').prepend('<img class="img_pack" src="images/fixed/missions/mission_pack_img_2.jpg" />'); console.log('showing image: '+packNumber);}
			if (packNumber == 3) {$('.mission_pack_img').prepend('<img class="img_pack" src="images/fixed/missions/mission_pack_img_3.jpg" />'); console.log('showing image: '+packNumber);}
			if (packNumber == 4) {$('.mission_pack_img').prepend('<img class="img_pack" src="images/fixed/missions/mission_pack_img_4.jpg" />'); console.log('showing image: '+packNumber);}
			if (packNumber == 5) {$('.mission_pack_img').prepend('<img class="img_pack" src="images/fixed/missions/mission_pack_img_5.jpg" />'); console.log('showing image: '+packNumber);}
			if (packNumber == 6) {$('.mission_pack_img').prepend('<img class="img_pack" src="images/fixed/missions/mission_pack_img_6.jpg" />'); console.log('showing image: '+packNumber);}
			if (packNumber == 7) {$('.mission_pack_img').prepend('<img class="img_pack" src="images/fixed/missions/mission_pack_img_7.jpg" />'); console.log('showing image: '+packNumber);}
			$('.img_pack').addClass('pack_in');
			$('#soloPackTitle').html(packName);
			$('.mission_pack_img').append('<div class="mission_pack_name" id="bigPackName" style="opacity: 0;">Story: '+packName+'</div>');
		}
		
		$('#bigPackName').textillate({ in: { shuffle: false, delay: 15, effect: 'flipInY' } }).transition({opacity: 1},100);
		$("#soloMissions").transition( { x: -300},600 );
		$("#soloMissionPack").transition( { x: -340, top: '0px'},600 );
		$("#view_missions_Side .lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "-60px -0px" }, {duration :600, easing : easing} );

		$("#soloMissionsPack_up").attr("id","soloMissions_up");
		$("#soloMissionsPack_down").attr("id","soloMissions_down");

		$("#soloMissions_up").attr("onclick","myScroll('soloMissionPack',181,500,'scrollBG')");
		$("#soloMissions_down").attr("onclick","myScroll('soloMissionPack',-181,500,'scrollBG')");

		$("#solomissions_footer").transition( { y: -30}, 600);
		$("#selectedSoloPack").transition( { y: 30}, 600);
		$("#solomission_scrollcontainer").transition( { bottom:"30px", top: "30px"},600 );
}

function showSoloMissions(){
		//console.log("showSoloMissions called");
		$("#soloMissions").transition( { x: 0},600 );
		$("#soloMissionPack").transition( { x: 0, top: '0px'},600 );
		$("#view_missions_Side .lowpanel_table_borderwrapper").stop().animate( {  backgroundPosition: "0px 0px" }, {duration :600, easing : easing} );

		$("#soloMissions_up").attr("id","soloMissionsPack_up");
		$("#soloMissions_down").attr("id","soloMissionsPack_down");
		
		
		$("#soloMissionsPack_up").attr("onclick","myScroll('soloMissions',181,500,'scrollBG')");
		$("#soloMissionsPack_down").attr("onclick","myScroll('soloMissions',-181,500,'scrollBG')");


		//$("#soloMissionSBUp").attr("onclick","myScroll('soloMissions',181,500,'scrollBG')");
		//$("#soloMissionSBDown").attr("onclick","myScroll('soloMissions',-181,500,'scrollBG')");
		$("#solomissions_footer").transition( { y: 0}, 600);
		$("#selectedSoloPack").transition( { y: 0}, 600);
		$("#solomission_scrollcontainer").transition( { bottom:"0px", top: "0px"}, 600 );
		$("#mission_select_header").html("Available missionpacks");
		if (static_page!=true){
			unselectMission();
		}
}

function openTopSpyList(id){
	console.log(id);
		if ($('.top_spy_list  #'+id).height() <= 30){			
			var listContentHeight = $('#'+id+' .outposts_list_container').outerHeight();
			if(id == 'recent_battles'){
				//console.log('minimize outposts, fix z-index, and open recent battles.');
				$('.top_spy_list  #top_outposts').css({zIndex: 0}).transition({height: '28px', width: '224px', top: '0px', left: '0px', zIndex: 1},300);
				$('#top_outposts .outposts_list_container').transition({opacity: 0}, 300, function(){$('#top_outposts .outposts_list_container').hide();});
			}
			if(id == 'top_outposts'){
				//console.log('minimize battles, fix z-index, and open top outposts.');
				$('.top_spy_list  #recent_battles').css({zIndex: 0}).transition({height: '28px', width: '224px', top: '0px', left: '0px', zIndex: 1},300);
				$('#recent_battles .outposts_list_container').transition({opacity: 0}, 300, function(){$('#recent_battles .outposts_list_container').hide();});
			}
			if(id == 'top_bankers'){
				$('.top_spy_list  #'+id).css({zIndex: 3}).transition({height: listContentHeight+40, width: '240px', top: '-109px', left: '-8px', height: '250px'},300);
				$('#'+id+' .outposts_list_container').css({opacity: 0}).show().transition({opacity: 1},300);
			}
			else{
				$('.top_spy_list  #'+id).css({zIndex: 3}).transition({height: listContentHeight+40, width: '240px', top: '0px', left: '-8px', height: '250px'},300);
				$('#'+id+' .outposts_list_container').css({opacity: 0}).show().transition({opacity: 1},300);
			}
		}
		else{
			$('.top_spy_list  #'+id).css({zIndex: 3}).transition({height: '28px', width: '224px', top: '0px', left: '0px', zIndex: 1},300);
			$('#'+id+' .outposts_list_container').transition({opacity: 0}, 300, function(){$('#'+id+' .outposts_list_container').hide();});
		}
}

function showMissionPurchase() {
	$('#purchase_mission').show();	
}
function hideMissionPurchase() {
	$('#purchase_mission').hide();	
}
function buyMission(){
	if (static_page==true){
		$('#purchase_mission').html('Awesome!<br /><br />Select any available mission from the mission list to start your new storyline.');
		$('#purchase_mission').transition({opacity: 0, delay:3000}, 1000, function(){$('#purchase_mission').hide().html('This mission pack is available for purchase for 10 credits.<br />Would you like to purchase this mission pack now?<br /><br /><div class="lightbutton160" id="buy_mission" onclick="buyMission()"><div class="buttontext24">Yes</div></div><div class="lightbutton160" id="nobuy_mission" onclick="noBuyMission()"><div class="buttontext24">Later</div></div>').css({opacity: 1});});

	}
}
function noBuyMission(){
	if (static_page==true){
		hideMissionPurchase();
		showSoloMissions();
		showAllyMissions();	
	}
}



//** Table Expansion Functions **//

$(document).ready(function(){
		$(".queue_entry").bind("click", function(){	
		tableid = $(this).attr("id");
		if (expanderOpen==0) {
			openSelectedRow(tableid);
		}
		else if (expanderOpen==1) {
			closeSelectedRow(tableid);			
		}
	});
});


$(document).ready(function(){
		$(".queue_entry_top").bind("click", function(){	
		tableid = $(this).attr("id");
		if (expanderOpen==0) {
			openSelectedRowTop(tableid);
		}
		else if (expanderOpen==1) {
			closeSelectedRow(tableid);			
		}
	});
});

$(document).ready(function(){
		$(".queue_entry_bottom").bind("click", function(){
		tableid = $(this).attr("id");
		if (expanderOpen==0) {
			openSelectedRowBottom(tableid);
		}
		else if (expanderOpen==1) {
			closeSelectedRow(tableid);			
		}
	});
});

$(document).ready(function(){
		$(".row_entry").bind("click", function(){	
		var tableid = $(this).attr("id");
		if (ad2460.allianceProjectsExpanderOpen=='') {
				ad2460.allianceProjectsExpanderOpen=tableid;
				expandSelectedRow(tableid);
			}
			else if(ad2460.allianceProjectsExpanderOpen==tableid){
				minimizeSelectedRow(tableid);
				ad2460.allianceProjectsExpanderOpen='';
			}
			else {
				closeSelectedRow(ad2460.allianceProjectsExpanderOpen);
				ad2460.allianceProjectsExpanderOpen=tableid;
				setTimeout("expandSelectedRow(ad2460.allianceProjectsExpanderOpen)",250);
			}
		
/*		var itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
		var itemoffset_top = $("#"+tableid).parent().position().top;
		console.log(itemoffset_top);
		var parentheight = $("#"+tableid).parent().parent().height();
		var itemdisplace = -35;
		var itemdisplaceleft = 10;
		var itemdisplaceright = 10;
		var rowheight = 28;
		var scrollmod = 1;
		if (rowOpen==0) {
			if ($(this).hasClass("outpostships")) { 
				itemheight =  120//parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
				itemdisplace = -35;
			};
			if ($(this).hasClass("outpostships_top")) { 
				itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
				itemdisplace = -5;
			};
			if ($(this).hasClass("outpostships_bottom")) { 
				itemdisplace = -65;	
			};
			if ($(this).hasClass("list_right")) { 
				itemdisplaceleft= -(parseInt($("#"+tableid+".row_entry").outerWidth())-6);
			};
			if ($(this).hasClass("list_left")) { 
				itemdisplaceright= -(parseInt($("#"+tableid+".row_entry").outerWidth()))+6;
			};
			if ($(this).hasClass("commander_entry")) { 
				$("#"+tableid+" .defensive_commander_img").animate( { left: "5px" }, 300);
				$("#"+tableid+" .defensive_commander_name").animate( { left: "5px" }, 300);
				$("#"+tableid+" .def_commander_statcontainer").delay(200).animate( { opacity: 1 }, 300);
				itemheight = 150;
		    	itemdisplace = 0;
				itemdisplaceleft = -210;
				itemdisplaceright = 0;	
			};
			if ($(this).hasClass("def_tactics_entry")) {
				itemheight = 265;
		    	itemdisplace = -155;
				itemdisplaceleft = 0;
				itemdisplaceright = 0;
			
				var tmp=0;
				var tactical_rows=$(this).children(".tactical_row");
			
				for (tmp=0;tmp<tactical_rows.size();tmp++){
					var myElement=tactical_rows[tmp];
					var def_tactical_options=$(myElement).children('.def_tactical_options');
					// id 0 av disse skal ha høyden
					var tmpHeight=0;
					var tmp2=0;
					for (tmp2=0;tmp2<def_tactical_options.size();tmp2++){
						var myElement2=def_tactical_options[tmp2];
						var tactical_wrapper=$(myElement2).children('.tactical_wrapper:first');
						var thisHeight=$(tactical_wrapper[0]).height();
						tmpHeight+=thisHeight;
					}
					$(def_tactical_options[0]).stop().delay(50).animate({ height: (tmpHeight-18)+"px" },300);
					
				}
			$(".def_current_tactic").stop().delay(50).animate( { height: "0px" }, 300);				
			//$("#"+tableid+" .def_tactical_options").each( function() {
			//$("#"+tableid+" .def_tactical_options").stop().animate( { height: ($('.tactical_wrapper').height()) }, 450);
			//});
			};
			
			if ($(this).hasClass("reserve_ship")) { 
				$("#"+tableid+" .queue_entry_reserve").animate({width: '100px'},350);
				$("#"+tableid+" .column_button.reserve").animate({opacity: 0},{duration :100, complete: function() {$("#"+tableid+" .column_button.reserve").css({top: '30px', right: '5px', width: '150px'});}}).delay(200).animate({opacity: 1},300);
				$("#"+tableid+" .column_button.reserve2").show().animate({opacity: 1},400);
			};
			
			if ($(this).hasClass("current_ally_dev")) { 
				itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
				rowheight = 58;
		    	itemdisplace = -5;
				itemdisplaceleft = 10;
				itemdisplaceright = 10;
				$("#"+tableid+" .dev_closed_time").animate( { opacity: 0 }, 200);
				$("#"+tableid+" .dev_opened_time").animate( { opacity: 1 }, 500);
			};
			
			if ($(this).hasClass("dev_bonus_entry")) { 
				itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+50;
		    	itemdisplace = 0;
				itemdisplaceleft = 10;
				itemdisplaceright = 10;
				scrollmod = parseInt($("#"+tableid).parent().parent().css('top'));
				console.log('scrollmod value: '+scrollmod);
				parentheight = $("#"+tableid).parent().parent().parent().height();
				console.log('parentheight value: '+parentheight);
			};
						
			expandSelectedRow(tableid , itemheight, itemdisplace,itemdisplaceleft, itemdisplaceright,itemoffset_top,parentheight,scrollmod);
			console.log(tableid, itemdisplaceright, itemdisplaceleft, itemoffset_top, parentheight,scrollmod);
						
		}
		
		else if (rowOpen==1) {
			if ($(this).hasClass("commander_entry")) { 
				$("#"+tableid+" .defensive_commander_img").animate( { left: "25px" }, 300);
				$("#"+tableid+" .defensive_commander_name").animate( { left: "25px" }, 300);
				$("#"+tableid+" .def_commander_statcontainer").animate( { opacity: 0 }, 100);
			
			rowheight = 150;
			};
			if ($(this).hasClass("def_tactics_entry")) { 
				rowheight = 110;
				$("#"+tableid+" .def_tactical_options").each( function() {
				$('.def_tactical_options').stop().animate( { height: "18px" }, 300);
				$(".def_current_tactic").stop().animate( { height: "18px" }, 300);
			});
			$("#"+tableid+" .retreat_condition").stop().animate( { height: "0px" }, 300);
			};
			if ($(this).hasClass("reserve_ship")) { 
				$("#"+tableid+" .queue_entry_reserve").animate({width: '220px'},350);
				$("#"+tableid+" .column_button.reserve").animate({opacity: 0},{duration :200, complete: function() {$("#"+tableid+" .column_button.reserve").css({top: '-3px', right: '0px', width: '120px',zIndex: 3});}}).delay(100).animate({opacity: 1},400);
				$("#"+tableid+" .column_button.reserve2").animate({opacity: 0},{duration :100, complete: function() {$("#"+tableid+" .column_button.reserve2").css({zIndex: 0}).hide();}});
			};
			
			if ($(this).hasClass("current_ally_dev")) { 
				rowheight = 58;
				$("#"+tableid+" .dev_closed_time").animate( { opacity: 1 }, 500);
				$("#"+tableid+" .dev_opened_time").animate( { opacity: 0 }, 200);
			};
			
			if ($(this).hasClass("dev_bonus_entry")) { 
				
			};
		
			minimizeSelectedRow(tableid ,rowheight);			
		}*/
	});
});

$(document).ready(function() {
		$("#up").click(function() {
			shipTypesUp();
		});
	});

$(document).ready(function() {
		$("#down").click(function() {
			shipTypesDown();
		});
	});
$(document).ready(function() {
		$("#ship001").click(function() {
                               // List all items to change content using this function
			$('#'+id+' .selected_item_statcontainer').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .selected_item_statcontainer').html('<div class="selected_item_statname">Rel. Firepower (Space):</div><div class="selected_item_statvalue">1.000</div><div class="selected_item_statname">Shields (Energy):</div><div class="selected_item_statvalue">15.000</div><div class="selected_item_statname">Hull:</div><div class="selected_item_statvalue">10.000</div><div class="selected_item_statname">Targeting:</div><div class="selected_item_statvalue">77</div><div class="selected_item_statname">Maneuverability:</div><div class="selected_item_statvalue">44</div><div class="selected_item_statname">Hangar Capacity:</div><div class="selected_item_statvalue">35</div><div class="selected_item_statname">Jump Range:</div><div class="selected_item_statvalue">12AU</div>');
                        }}).animate({opacity: 1},250);
                        $('#'+id+' .selected_item_statcontainer_2').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .selected_item_statcontainer_2').html('<div class="selected_item_statname">Cargo Capacity:</div><div class="selected_item_statvalue">4.000</div>	<div class="selected_item_statname">Upkeep:</div><div class="selected_item_statvalue">54</div><div class="selected_item_statname">Cost:</div><div class="selected_item_statvalue">127 credits</div><div class="selected_item_helpinfo">Click on ship image for a detailed stat view.</div>');
                        }}).animate({opacity: 1},250);
                        $('#'+id+' .selected_item_typename').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .selected_item_typename').html('Energy Class Carrier');                                
                                }})
                        .animate({opacity: 1},250);
                        $('#'+id+' .selected_item_name').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .selected_item_name').html('INTERGALACTC HUB');                                
                                }})
                        .animate({opacity: 1},250);
                        $('#'+id+' .item_img').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .item_img').attr("src","images/fixed/shipimg250x100test2.jpg");                                
                                }})
                        .animate({opacity: 1},250);
                        $('#'+id+' .selected_item_description').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .selected_item_description').html('The Intergalactic Hub is a massive placeholder ship, fitted with probably ne most advanced escape-pod ejection system in the universe. It is a complete dream to evacuate it. Drills are preformed quite often.');                                
                                }})
                        .animate({opacity: 1},250);
		});
	});
$(document).ready(function() {
		$("#ship002").click(function() {
                                // List all items to change content using this function
			$('#'+id+' .selected_item_statcontainer').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .selected_item_statcontainer').html('<div class="selected_item_statname">Rel. Firepower (Space):</div><div class="selected_item_statvalue">24.000</div><div class="selected_item_statname">Shields (Energy):</div><div class="selected_item_statvalue">135.000</div><div class="selected_item_statname">Hull:</div><div class="selected_item_statvalue">65.000</div><div class="selected_item_statname">Targeting:</div><div class="selected_item_statvalue">12</div><div class="selected_item_statname">Maneuverability:</div><div class="selected_item_statvalue">86</div><div class="selected_item_statname">Hangar Capacity:</div><div class="selected_item_statvalue">46</div><div class="selected_item_statname">Jump Range:</div><div class="selected_item_statvalue">9AU</div>');
                                }}).animate({opacity: 1},250);
                        $('#'+id+' .selected_item_statcontainer_2').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .selected_item_statcontainer_2').html('<div class="selected_item_statname">Cargo Capacity:</div><div class="selected_item_statvalue">800.000</div>	<div class="selected_item_statname">Upkeep:</div><div class="selected_item_statvalue">Infinite</div><div class="selected_item_statname">Cost:</div><div class="selected_item_statvalue">48In, 12 St, 44 Nd, 10 Ha</div><div class="selected_item_helpinfo">Click on ship image for a detailed stat view.</div>');
                        }}).animate({opacity: 1},250);
                         $('#'+id+' .selected_item_typename').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .selected_item_typename').html('Displacement-class Frigate');
                                
                                }})
                        .animate({opacity: 1},250);
                        $('#'+id+' .selected_item_name').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .selected_item_name').html('THE STARBEAMER');
                                
                                }})
                        .animate({opacity: 1},250);
                        $('#'+id+' .item_img').animate({opacity: 0},{duration: 250, complete: function() {
                                $('#'+id+' .item_img').attr("src","images/fixed/shipimg250x100test.jpg");
                                
                                }})
                        .animate({opacity: 1},250);
                        $('#'+id+' .selected_item_description').animate({opacity: 0},{duration: 250, complete: function() {
                                $('.selected_item_description').html('This energy-class capital ship is the jack of all trades. And jack of all trade-offs. It can do virtually anything, and is, in greater numbers a formidable force. As a solitary force, it is rather lacking.');                                
                                }})
                        .animate({opacity: 1},250);
		});
	});

$(document).ready(function() {
		$("#updev").click(function() {
			devTypesUp();
		});
	});

$(document).ready(function() {
		$("#downdev").click(function() {
			devTypesDown();
		});
	});

$(document).ready(function() {
		$("#upres").click(function() {
			resTypesUp();
		});
	});

$(document).ready(function() {
		$("#downres").click(function() {
			resTypesDown();
		});
	});

$(document).ready(function() {
		$("#upout1").click(function() {
			out1TypesUp();
		});
	});

$(document).ready(function() {
		$("#downout1").click(function() {
			out1TypesDown();
		});
	});

$(document).ready(function() {
		$("#fleetListUp").click(function() {
			trackFleetListUp();
		});
	});

$(document).ready(function() {
		$("#fleetListDown").click(function() {
			trackFleetListDown();
		});
	});

//$(document).ready(function() {
//		$("#outpostdefup").click(function() {
//		outpostListUp();
//		});
//	});

//$(document).ready(function() {
//		$("#outpostdefdown").click(function() {
//			outpostListDown();
//		});
//	});

//$(document).ready(function() {
//		$("#transportoptionsbutton").click(function() {
//			showTransports();
//		});
//	});

$(document).ready(function() {
		$(".tableselection").click(function() {
			showFleets();
		});
	});

$(document).ready(function() {
		$(".def_overview").click(function() {
			showDefenses();
		});
	});

$(document).ready(function() {
		$("#reserve_fleet_button").click(function() {
			showReserves();
		});
		$("#manage_selected_fleet_button").click(function() {
			manageSelectedFleet();
		});
	});
	
$(document).ready(function() {
	if (static_page==true){
		$("#extras").click(function() {
			showRecruits();
		});
	}
});
$(document).ready(function() {
	$("#manage_selected_commander").click(function() {
		showCommanderHistory();
	});
});

$(document).ready(function() {
		$("#open_spy_log").click(function() {
			if (static_page==true){
				showSpyLog();
				showIntelLog();
			}
		});
});
$(document).ready(function() {
		$("#spy_details").click(function() {
			if (static_page==true){
			showSpyDetails();
			}
		});
});

$(document).ready(function() {
	$("#select_mission_pack").click(function() {
		if (static_page==true){
		lowtableSlideRight();
    	$('.tlt').textillate({ 
		in: {
			effect: 'fadeIn',
			delayScale: 1,
			delay: 10,
			sync: false,
			shuffle: false,
			}
		}).show();
		$('.mission_title').textillate({ 
		in: {
			effect: 'flipInY',
			delayScale: 1.5,
			delay: 10,
			sync: true,
			shuffle: false,
			}
		}).show();
		$('.mission_txt').textillate({ 
		in: {
			effect: 'flipInX',
			delayScale: 1.5,
			delay: 500,
			sync: true,
			shuffle: false,
			}
		}).show();
		/*$('.tlt').show();
		$('.mission_title').show();
		$('.mission_txt').show();*/
		}
	});
	$("#view_mission_packs").click(function() {
		if (static_page==true){
		lowtableSlideLeft();
		}
	});
});

$(document).ready(function() {
	$("div[id^='select_ally_mission_pack_']").click(function() {
		packName = $(this).children('.table_fleet_name').text();
		console.log(packName);
		if (static_page==true){
		showAllyMissionPack(packName);
    	
		}
	});
	$("#view_ally_missions_list").click(function() {
		//console.log('default mission view');
		if (static_page==true){
		showAllyMissions();
		}
	});
});

$(document).ready(function() {
	$("div[id^='select_solo_mission_pack_']").click(function() {
		packNumber = parseInt(/^.*\_(\d+)$/.exec(this.id)[1]);
		if (static_page==true){
		packName = $(this).children('.table_fleet_name').text();
		console.log(packName, packNumber);
		showSoloMissionPack(packName,packNumber);
		 	
		}
	});
	$("#view_solo_missions_list").click(function() {
		//console.log('default mission view');
		//if (static_page==true){
		showSoloMissions();
		//}
	});
	
	$(".purchase_mission").click(function() {
		if (static_page==true){
		showMissionPurchase();
		}
	});
});
			
			// JavaScript Document
var planet1Visible=1;
var planet2Visible=0;
var planet3Visible=0;
var planet4Visible=0;
var planet5Visible=0;
var planet6Visible=0;
var planet7Visible=0;
var planet8Visible=0;
var planetBGPosX = 0;
var planetBGPosY = 0;

var currentPlanetSelect = 0;
var previousPlanetSelect = 0;


function showPlanetRight(showPlanetId,showPlanetInfo, clickId){
		//console.log('showing...'+showPlanetId, showPlanetInfo);
		//Transitions Only using Jquery plug-in
		$('#'+showPlanetId).show().stop().css({transform: 'translate(300px,-200px) scale(5)'}).transition({ x: 0, y: 0, scale:1, delay:200 },800);
		//jQuery Only via straight animations
		//$('#'+showPlanetId).show().css( {left: '300px', height: '2000px', width: '2000px', top: '-200px'} ).stop().delay(500).stop().animate( { top: '15px', left: '30px', height: '400px' , width: '400px'} ,1000);
		//Attempt at making jQuery trigger css scaling
		//$('#'+showPlanetId).show().css( {left: '300px', height: '2000px', width: '2000px', top: '-200px',transform: 'scale(5)'} ).stop().delay(500).stop().animate( { top: '15px', left: '30px', height: '400px' , width: '400px', transform: 'scale(1)'} ,1000);
//		var currentBGPosX = parseInt( $("#planetviewcontainer").css("backgroundPositionX"),10 );
//		var currentBGPosY = parseInt( $("#planetviewcontainer").css("backgroundPositionY"),10 );
//		var newBGPosX = currentBGPosX + 250 + 'px';
//		var newBGPosY = currentBGPosY + 100 + 'px';
		var currentBGPos = $("#planetviewcontainer").css("background-position");
		//console.log("currentBGPos: "+currentBGPos);
		var BGArray = currentBGPos.split(' ');
	
		var left=0;
		var top=0;

		if (BGArray.length==2){
			left=returnInteger(BGArray[0]);
			top = returnInteger(BGArray[1]);
		}
		if (BGArray.length==4){
			left=returnInteger(BGArray[1]);
			top = returnInteger(BGArray[3]);
		}


		var newBGPosX = left + 375 + 'px';
		var newBGPosY = top + 150 + 'px';
		var newfullBGPos = newBGPosX+' '+newBGPosY;
		//$('#planetviewcontainer').stop().animate( {backgroundPositionX: newBGPosX, backgroundPositionY:newBGPosY } ,1500);
		$('#planetviewcontainer').stop().transition( {'background-position': newfullBGPos } ,790, 'cubic-bezier(0.160, 0.060, 0.365, 1.000)');
		if (static_page==true){
			$('.planetinfo').show().stop().transition( { opacity: 0 }, 200)/* INSERT data replacement function as callback */.delay(800).transition( { opacity: 1 }, 500);
		}
		else {
			$('#starmap_planetinfo').show().stop().animate({
				opacity: 0
				}, {
				duration: 200,
				complete: function() {
					updateStarmapSelectedPlanetInfo();
				}
			}).delay(500).animate( { opacity: 1 }, 300);
		}
		// 
		//$('#'+showPlanetInfo).show().stop().animate( {opacity: 0},1000 ).animate( {opacity: 1},500 );

}
function showPlanetLeft(showPlanetId,showPlanetInfo, clickId) {
		//console.log('showing...'+showPlanetId, showPlanetInfo);
		$('#'+showPlanetId).show().stop().css({transform: 'translate(-300px,0px) scale(0.25)'}).transition({ x: 0, y: 0, scale:1, delay:200},800);
		//$('#'+showPlanetId).show().css( {left: '-300px', height: '100px', width: '100px', top: '0px'} ).stop().delay(500).stop().animate( {top: '15px', left: '30px', height: '400px' , width: '400px' } ,1000);
		//$('#'+showPlanetId).show().css( {left: '-300px', height: '100px', width: '100px', top: '0px', transform: 'scale(0.25)'} ).stop().delay(500).stop().animate( {top: '15px', left: '30px', height: '400px' , width: '400px', transform: 'scale(1)' } ,1000);
//		var currentBGPosX = parseInt( $("#planetviewcontainer").css("backgroundPositionX"),10 );
//		var currentBGPosY = parseInt( $("#planetviewcontainer").css("backgroundPositionY"),10 );
		var currentBGPos = $("#planetviewcontainer").css("background-position");
		//console.log("currentBGPos: "+currentBGPos);
		var BGArray = currentBGPos.split(' ');
		var left=0;
		var top=0;

		if (BGArray.length==2){
			left=returnInteger(BGArray[0]);
			top = returnInteger(BGArray[1]);
		}
		if (BGArray.length==4){
			left=returnInteger(BGArray[1]);
			top = returnInteger(BGArray[3]);
		}


		var newBGPosX = left - 375 + 'px';
		var newBGPosY = top - 150 + 'px';

		var newfullBGPos = newBGPosX+' '+newBGPosY;
		//console.log('New BG Position: '+newfullBGPos);
		//$('#planetviewcontainer').stop().animate( {backgroundPositionX: newBGPosX, backgroundPositionY:newBGPosY } ,1500);
		$('#planetviewcontainer').stop().transition( {'background-position': newfullBGPos } ,790, 'cubic-bezier(0.160, 0.060, 0.365, 1.000)');
		if (static_page==true){
			$('.planetinfo').show().stop().transition( { opacity: 0 }, 200)/* INSERT data replacement function as callback */.delay(800).transition( { opacity: 1 }, 500);
	}
		else {
			$('#starmap_planetinfo').show().stop().animate({
				opacity: 0
				}, {
				duration: 200,
				complete: function() {
					updateStarmapSelectedPlanetInfo();
				}
			}).delay(500).animate( { opacity: 1 }, 300);
		}
		// $('#'+showPlanetInfo).show().stop().animate( {opacity: 0},1000 ).animate( {opacity: 1},500 );

}
function hidePlanetRight(hidePlanetId,hidePlanetInfo, clickId) {
		//console.log('hiding...'+hidePlanetId, hidePlanetInfo);
		$('#'+hidePlanetId).stop().css({transform: 'translate(0px,0px) scale(1)'}).transition({ x: 400, y: -300, scale:5 }, 500, 'ease-in-out', function(){$('#'+hidePlanetId).hide();} );
		/*$('#'+hidePlanetId).stop().animate( {left: '400px', height: '2000px', width: '2000px', top: '-300px'} ,{duration: 1000, complete: function(){$('#'+hidePlanetId).hide();}})*/
		//$('#'+hidePlanetInfo).stop().animate( {opacity: 0},{duration: 300, complete: function(){$('#'+hidePlanetInfo).hide();}});
}
function hidePlanetLeft(hidePlanetId,hidePlanetInfo, clickId) {
		//console.log('hiding...'+hidePlanetId, hidePlanetInfo);
		$('#'+hidePlanetId).stop().css({transform: 'translate(0px,0px) scale(1)'}).transition({ x: -200, y: 0, scale:0.25 }, 500, 'ease-in-out', function(){$('#'+hidePlanetId).hide();} );
		/*$('#'+hidePlanetId).stop().animate( {left: '-200px', height: '100px', width: '100px', top: '0px'} ,{duration: 1000, complete: function(){$('#'+hidePlanetId).hide();}})*/
		//$('#'+hidePlanetInfo).stop().animate( {opacity: 0},{duration: 300, complete: function(){$('#'+hidePlanetInfo).hide();}});
}

function removePlanet(hidePlanetId,hidePlanetInfo) {
		//console.log('removing...'+hidePlanetId, hidePlanetInfo);
 		var currentBGPosX = parseInt( $("#planetviewcontainer").css("backgroundPositionX"),10 );
		var currentBGPosY = parseInt( $("#planetviewcontainer").css("backgroundPositionY"),10 );
  		var newBGPosX = currentBGPosX - 250 + 'px';
		var newBGPosY = currentBGPosY - 500 + 'px';
		var newfullBGPos = newBGPosX+' '+newBGPosY;
		//$('#planetviewcontainer').stop().animate( {backgroundPositionX: newBGPosX, backgroundPositionY:newBGPosY } ,1000);
		$('#planetviewcontainer').stop().transition( {backgroundPositionX: newBGPosX, backgroundPositionY:newBGPosY } ,1000);
		$('#'+hidePlanetId).stop().css({transform: 'translate(0px,0px) scale(1)'}).transition({ x: -200, y: 0, scale:0.25 }, 1000, 'ease-in-out', function(){$('#'+hidePlanetId).hide();} );
		//$('#'+hidePlanetId).stop().animate( {left: '000px', height: '50px', width: '50px', top: '-300px'} ,{duration: 1000, complete: function(){$('#'+hidePlanetId).hide();}});
		if (static_page==true){
			$('.planetinfo').show().stop().animate( { opacity: 0 }, 300);
		}
		//$('#'+hidePlanetInfo).stop().animate( {opacity: 0},{duration: 300, complete: function(){$('#'+hidePlanetInfo).hide();}});
}

function showPlanetInfoAdd() {
	$('#starmap_slidepanel').show().stop().animate( { height: '120px' }, 500);
	$('#starmap_planet_add').show();
	$('.starmap_slidepanel_content').not('#starmap_planet_add').hide();
}

function showPlanetOwnerInfo() {
	$('#starmap_slidepanel').show();
	var panelHeight = $('#starmap_planet_player').outerHeight();
	$('#starmap_slidepanel').stop().animate( { height: panelHeight+'px' }, 500);	
	$('#starmap_planet_player').show();
	$('.starmap_slidepanel_content').not('#starmap_planet_player').hide();
	PlayerAllianceInfoOpen = 1;
}

function showPlanetOwnerAlliance() {
	$('#starmap_slidepanel').show().stop().animate( { height: '130px' }, 500);
	$('#starmap_planet_alliance').show();
	$('.starmap_slidepanel_content').not('#starmap_planet_alliance').hide();	
}

function hideStarMapInfoSlide() {
	$('#starmap_slidepanel').stop().animate( { height: '0px' }, {duration: 500, complete: function(){$('#starmap_slidepanel').hide();}});
	PlayerAllianceInfoOpen = 0;
}

function showEspionageOption() {
	//console.log('Opening Espionage Options');
	$('#starmap_espionage_slidepanel').show().stop().animate( { height: '280px' }, 500);
	$('.starmap_slidepanel_content').show();	
	if (static_page!=true){
		ad2460.openQuickMenues.starmap_intel_panel=true;
	}
	else {
		espionageOptionOpen = 1;
	}
	
}

function hideEspionageOption() {
	$('#starmap_espionage_slidepanel').stop().animate( { height: '0px' }, {duration: 500, complete: function(){$('#starmap_espionage_slidepanel').hide();}});
	if (static_page!=true){
		ad2460.openQuickMenues.starmap_intel_panel=false;
	}
	else {
		espionageOptionOpen = 0;
	}

}// JavaScript Document
var researchLabVisible=1;
var matterLabVisible=0;
var energyLabVisible=0;
var spaceLabVisible=0;
var theoryLabVisible=0;



function selectMainFacility (){
		$(".facility_1_selected").stop().animate({opacity: 0},600);
		$(".facility_2_selected").stop().animate({opacity: 0},600);
		$(".facility_3_selected").stop().animate({opacity: 0},600);
		$(".facility_4_selected").stop().animate({opacity: 0},600);
		$(".facility_main_selected").stop().animate({opacity: 1},200);	
}

function selectAddon1 (){
		$(".facility_1_selected").stop().animate({opacity: 1},200);
		$(".facility_2_selected").stop().animate({opacity: 0},600);
		$(".facility_3_selected").stop().animate({opacity: 0},600);
		$(".facility_4_selected").stop().animate({opacity: 0},600);
		$(".facility_main_selected").stop().animate({opacity: 0},600);	
}

function selectAddon2 (){
		$(".facility_1_selected").stop().animate({opacity: 0},600);
		$(".facility_2_selected").stop().animate({opacity: 1},200);
		$(".facility_3_selected").stop().animate({opacity: 0},600);
		$(".facility_4_selected").stop().animate({opacity: 0},600);
		$(".facility_main_selected").stop().animate({opacity: 0},600);	
}
function selectAddon3 (){
		$(".facility_1_selected").stop().animate({opacity: 0},600);
		$(".facility_2_selected").stop().animate({opacity: 0},600);
		$(".facility_3_selected").stop().animate({opacity: 1},200);
		$(".facility_4_selected").stop().animate({opacity: 0},600);
		$(".facility_main_selected").stop().animate({opacity: 0},600);	
}
function selectAddon4 (){
		$(".facility_1_selected").stop().animate({opacity: 0},600);
		$(".facility_2_selected").stop().animate({opacity: 0},600);
		$(".facility_3_selected").stop().animate({opacity: 0},600);
		$(".facility_4_selected").stop().animate({opacity: 1},200);
		$(".facility_main_selected").stop().animate({opacity: 0},600);	
}

function startUpgradeMain () {
		$(".facility_main_upgrade").stop().animate({opacity: 1},1000);
}
function endUpgradeMain () {
		$(".facility_main_upgrade").stop().animate({opacity: 0},1000);
}
function startUpgradeAddon1 () {
		$(".facility_1_upgrade").stop().animate({opacity: 1},1000);
}
function endUpgradeAddon1 () {
		$(".facility_1_upgrade").stop().animate({opacity: 0},1000);
}
function startUpgradeAddon2 () {
		$(".facility_2_upgrade").stop().animate({opacity: 1},1000);
}
function endUpgradeAddon2 () {
		$(".facility_2_upgrade").stop().animate({opacity: 0},1000);
}
function startUpgradeAddon3 () {
		$(".facility_3_upgrade").stop().animate({opacity: 1},1000);
}
function endUpgradeAddon3 () {
		$(".facility_3_upgrade").stop().animate({opacity: 0},1000);
}
function startUpgradeAddon4 () {
		$(".facility_4_upgrade").stop().animate({opacity: 1},1000);
}
function endUpgradeAddon4 () {
		$(".facility_4_upgrade").stop().animate({opacity: 0},1000);
}

function showResearchLab (){
	$("#researchlab").stop().animate( {opacity: 1},500 );
	reseachLabVisible=1;
}

function hideResearchLab (){
	$("#researchlab").stop().animate( {opacity: 0},500 );
	researchLabVisible=0;
}

function showMatterLab (){
	$("#matterlab").stop().animate( {opacity: 1},500 );
	matterLabVisible=1;
}

function hideMatterLab (){
	$("#matterlab").stop().animate( {opacity: 0},500 );
	matterLabVisible=0;
}

function showEnergyLab (){
	$("#energylab").stop().animate( {opacity: 1},500 );
	energyLabVisible=1;
}

function hideEnergyLab (){
	$("#energylab").stop().animate( {opacity: 0},500 );
	energyLabVisible=0;
}

function showSpaceLab (){
	$("#spacelab").stop().animate( {opacity: 1},500 );
	spaceLabVisible=1;
}

function hideSpaceLab (){
	$("#spacelab").stop().animate( {opacity: 0},500 );
	spaceLabVisible=0;
}

function showTheoryLab (){
	$("#theorylab").stop().animate( {opacity: 1},500 );
	theoryLabVisible=1;
}

function hideTheoryLab (){
	$("#theorylab").stop().animate( {opacity: 0},500 );
	theoryLabVisible=0;
}

$(document).ready(function() {
		$("#researchLabField").click(function(){
		showResearchLab();
		hideMatterLab();
		hideEnergyLab();
		hideSpaceLab();
		hideTheoryLab();
		});
});

$(document).ready(function() {
		$("#matterLabField").click(function(){
		hideResearchLab();
		showMatterLab();
		hideEnergyLab();
		hideSpaceLab();
		hideTheoryLab();
		});
});

$(document).ready(function() {
		$("#energyLabField").click(function(){
		hideResearchLab();
		hideMatterLab();
		showEnergyLab();
		hideSpaceLab();
		hideTheoryLab();
		});
});

$(document).ready(function() {
		$("#spaceLabField").click(function(){
		hideResearchLab();
		hideMatterLab();
		hideEnergyLab();
		showSpaceLab();
		hideTheoryLab();
		});
});

$(document).ready(function() {
		$("#theoryLabField").click(function(){
		hideResearchLab();
		hideMatterLab();
		hideEnergyLab();
		hideSpaceLab();
		showTheoryLab();
		});
});

$(document).ready(function() {
		$(".facility_addon.box_1").click(function(){
		selectAddon1();
		console.log("Yeah. Clicked Addon 1!");
	});
});

$(document).ready(function() {
		$(".facility_addon.box_2").click(function(){
		selectAddon2();
		console.log("Yeah. Clicked Addon 2!");
	});
});

$(document).ready(function() {
		$(".facility_addon.box_3").click(function(){
		selectAddon3();
		console.log("Yeah. Clicked Addon 3!");
	});
});

$(document).ready(function() {
		$(".facility_addon.box_4").click(function(){
		selectAddon4();
		console.log("Yeah. Clicked Addon 4!");
	});
});
$(document).ready(function() {
		$(".facility_main_facility_box").click(function(){
		selectMainFacility();
		console.log("Yeah. Clicked Main!");
	});
});// JavaScript Document
var facilreq1Visible=0;
var devreq1Visible=0;
var researchreq1Visible=0;
var techreq1Visible=0;
var facilreq1Visible=0;
var devreq1Visible=0;
var researchreq1Visible=0;
var techreq1Visible=0;

function showfacilreq1 (){
	$("#facilreq1").stop().animate( {opacity: 1},500 );
	facilreq1Visible=1;
}

function hidefacilreq1 (){
	$("#facilreq1").stop().animate( {opacity: 0},500 );
	facilreq1Visible=0;
}

function showdevreq1 (){
	$("#devreq1").stop().animate( {opacity: 1},500 );
	devreq1Visible=1;
}

function hidedevreq1 (){
	$("#devreq1").stop().animate( {opacity: 0},500 );
	devreq1Visible=0;
}

function showresearchreq1 (){
	$("#researchreq1").stop().animate( {opacity: 1},500 );
	researchreq1Visible=1;
}

function hideresearchreq1 (){
	$("#researchreq1").stop().animate( {opacity: 0},500 );
	researchreq1Visible=0;
}

function showtechreq1 (){
	$("#techreq1").stop().animate( {opacity: 1},500 );
	techreq1Visible=1;
}

function hidetechreq1 (){
	$("#techreq1").stop().animate( {opacity: 0},500 );
	techreq1Visible=0;
}

function showfacilreq2 (){
	$("#facilreq2").stop().animate( {opacity: 2},500 );
	facilreq2Visible=2;
}

function hidefacilreq2 (){
	$("#facilreq2").stop().animate( {opacity: 0},500 );
	facilreq2Visible=0;
}

function showdevreq2 (){
	$("#devreq2").stop().animate( {opacity: 2},500 );
	devreq2Visible=2;
}

function hidedevreq2 (){
	$("#devreq2").stop().animate( {opacity: 0},500 );
	devreq2Visible=0;
}

function showresearchreq2 (){
	$("#researchreq2").stop().animate( {opacity: 2},500 );
	researchreq2Visible=2;
}

function hideresearchreq2 (){
	$("#researchreq2").stop().animate( {opacity: 0},500 );
	researchreq2Visible=0;
}

function showtechreq2 (){
	$("#techreq2").stop().animate( {opacity: 2},500 );
	techreq2Visible=2;
}

function hidetechreq2 (){
	$("#techreq2").stop().animate( {opacity: 0},500 );
	techreq2Visible=0;
}

function BuildButtonPulse (){
	$(".tab_build_button").transition( {scale:(1.5,1.5)}, 2000);
}

$(document).ready(function() {
		$("#faciltype").click(function(){
		showfacilreq1();
		hidedevreq1();
		hideresearchreq1();
		hidetechreq1();
		});
});

$(document).ready(function() {
		$("#devtype").click(function(){
		hidefacilreq1();
		showdevreq1();
		hideresearchreq1();
		hidetechreq1();
		});
});

$(document).ready(function() {
		$("#researchtype").click(function(){
		hidefacilreq1();
		hidedevreq1();
		showresearchreq1();
		hidetechreq1();
		});
});

$(document).ready(function() {
		$("#techtype").click(function(){
		hidefacilreq1();
		hidedevreq1();
		hideresearchreq1();
		showtechreq1();
		});
});

$(document).ready(function() {
		$("#faciltype2").click(function(){
		showfacilreq2();
		hidedevreq2();
		hideresearchreq2();
		hidetechreq2();
		});
});

$(document).ready(function() {
		$("#devtype2").click(function(){
		hidefacilreq2();
		showdevreq2();
		hideresearchreq2();
		hidetechreq2();
		});
});

$(document).ready(function() {
		$("#researchtype2").click(function(){
		hidefacilreq2();
		hidedevreq2();
		showresearchreq2();
		hidetechreq2();
		});
});

$(document).ready(function() {
		$("#techtype2").click(function(){
		hidefacilreq2();
		hidedevreq2();
		hideresearchreq2();
		showtechreq2();
		});
});

$(document).ready(function() {
		var fontSize=0;
		$("#itemenlarge").click(function(){
		  if(fontSize==0) {
		  $("#textfield2").animate({ fontSize : '24px' },300);
		  $("#itemfield2").animate({ height : '200px' },300);
		  fontSize=1;}
		  else { 
		  $("#textfield2").animate({ fontSize : '10px' },300);
		  $("#itemfield2").animate({ height : '100px' },300);
		  fontSize=0;}
		});
});
// JavaScript Document
ad2460.openResourceId="";

function hideResource (resourcePanelId) {
	$("#"+resourcePanelId).animate( {top: "-320px"}, {duration:300, complete: function() {$("#"+resourcePanelId).hide();}});
}
function showResource (resourcePanelId,panel_height) {
	$("#"+resourcePanelId).animate( {top: (-320+panel_height+40)+'px'}, 300);
	$(".resourceinfopanel").not("#"+resourcePanelId).animate( {top: "-320px"}, {duration:300, complete: function() {$(".resourceinfopanel").not("#"+resourcePanelId).hide();}});
}
function hideResources () {
	$('.resourceinfopanel').animate( {top: "-320px"}, {duration:300, complete: function() {$('.resourceinfopanel').hide();}});
	ad2460.openResourceId = 0;
}

$(document).ready(function() {
	$(".resourcedisplay").click(function() {
		var resourceId = parseInt($(this).attr('id').match(/\d/),10);
		if(resourceId != ad2460.openResourceId) {
			ad2460.openResourceId = resourceId;
			var resourcePanelId = 'resource'+resourceId+'panel';
			$('#'+resourcePanelId).show();
			panel_height = $('#'+resourcePanelId+' .resourceinfotext').outerHeight();
			showResource(resourcePanelId,panel_height);
			
		}
		else {
			var resourcePanelId = 'resource'+resourceId+'panel';
			ad2460.openResourceId = 0;
			hideResource(resourcePanelId);
		}
	});
	$(".resourceinfopanel").click(function() {
		var resourceId = parseInt($(this).attr('id').match(/\d/),10);
		var resourcePanelId = 'resource'+resourceId+'panel';
		ad2460.openResourceId = 0;
		hideResource(resourcePanelId);
	});
});// JavaScript Document
var homeworldInfoVisible=1;

function showHomeworldInfo() {
	$(".homeworld_name_panel").stop().animate({height: "350px"},750);	
	$(".homeworld_info_container").stop().animate({height: "350px"},750);
	homeworldInfoVisible=1;
}

function hideHomeworldInfo() {
	$(".homeworld_name_panel").stop().animate({height: "30px"},750);
	$(".homeworld_info_container").stop().animate({height: "30px"},750);
	homeworldInfoVisible=0;
}


function showFullNews() {
		$("#fullnewspanel").css({x:0}).show().transition({x: -250},500);
		$("#fullnewsscroller").css({x: 250}, 500);
		$("#fullnews_top_header").css({x: 250}, 500);	
}

function hideFullNews() {
	$("#fullnewspanel").hide();
	$("#fullnewsscroller").transition({x: 0}, 0);
	$("#fullnews_top_header").transition({x: 0}, 0);
}

function showTickerPanel() {
	$("#tickerpanel").css({ x:0}).show().transition({x:-350},500);	
}

function hideTickerPanel() {
//	$("#tickerpanel").transition({x: 0}, 300).transition({delay: 500},0, $("#tickerpanel").hide());
	$('#tickerpanel').transition({x: 0},300, function(){$('#tickerpanel').hide();});

}


$(document).ready(function() {
	//if (static_page==true){
		$(".homeworld_name_class").click(function(){
			if (homeworldInfoVisible==0) {showHomeworldInfo();}
		  	else {hideHomeworldInfo();}
		});
	//}
});

$(document).ready(function() {
if (static_page==true){
	var fullNews=0;
	var tickerOpen=0;
		$("#latest_update_counter").click(function(){
			if (fullNews==0) {
				if (tickerOpen==1) {hideTickerPanel();tickerOpen=0;}
				showFullNews();fullNews=1;}
		  	else { hideFullNews();fullNews=0;}
		});
		$("#close_fullnews").click(function(){
			hideFullNews();
			fullNews=0;
		});
	
		$("#ticker_view").click(function(){
			console.log('clicked the ticker!');
			if (tickerOpen==0) {
				if (fullNews==1) {hideFullNews();fullNews=0;}
				showTickerPanel();tickerOpen=1;}
		  	else { hideTickerPanel();tickerOpen=0;}
		});
		$("#close_tickerpanel").click(function(){
			hideTickerPanel();
			tickerOpen=0;
		});
	}
});// JavaScript Document

function showSelectedAllianceOption(idSection, idSelectedSide, idSelectedInfo, newSideHeight) {
    $('#'+idSection+'.table_alliance_management_section').addClass('lowpanel_table_selected_line').animate( {left: '5px'},250);
    $('.table_alliance_management_section').not('#'+idSection).removeClass('lowpanel_table_selected_line').animate( {left: '0px'},100);

	if(static_page == true){
	    $("#"+id+" .sidepanel").transition( { height: newSideHeight},300);
	    $("#"+id+" .sidepanel_bg").transition( { height: (newSideHeight-16)},300); console.log('I adjusted the side panel for ya!');
	    $("#"+id+" .infopanel").transition( { top: newSideHeight-16+"px" , left: lowWidth-1+"px", height: lowHeight+mainHeight-newSideHeight-5+"px", width: mainWidth+sideWidth-lowWidth-30+"px"},300);

	    $('#'+idSelectedSide+".alliance_section_content").show();
	    $(".alliance_section_content").not('#'+idSelectedSide).hide();
	    $('#'+idSelectedInfo+".alliance_section_info_content").show();
	    $(".alliance_section_info_content").not('#'+idSelectedInfo).hide();
	}
	else {
	    $("#alliance_management .sidepanel").transition( { height: newSideHeight},300);
	    $("#alliance_management .sidepanel_bg").transition( { height: (newSideHeight-16)},300);
		$("#alliance_management .infopanel").transition( { top: newSideHeight-16+"px" , left: lowWidth-1+"px", height: lowHeight+mainHeight-newSideHeight-5+"px", width: mainWidth+sideWidth-lowWidth-30+"px"},300);
	
	}
}

$(document).ready(function(){
	$(".table_alliance_management_section").click(
		function() {
			idSection = $(this).attr("id");
		    //console.log(idSection);
		    idSelectedSide = idSection+"_Side";
		    idSelectedInfo = idSection+"_Info";
		    newSideHeight = null;
		    if ($(this).hasClass("view_motd")) {
				newSideHeight = 350;
			}
		    else if ($(this).hasClass("view_bank")) {
				newSideHeight = 350;
			}
			else if ($(this).hasClass("view_alliance_info")) {
				newSideHeight = 245;
			}
			else if ($(this).hasClass("view_tax")) {
				newSideHeight = 265;
			}
			else if ($(this).hasClass("view_alliance_news")) {
				newSideHeight = 160;
			}
			else if ($(this).hasClass("view_missions")) {
				newSideHeight = 300;
			}
			else if ($(this).hasClass("view_military")) {
				newSideHeight = 300;
			}
			else if ($(this).hasClass("view_stations")) {
				newSideHeight = 280;
			}
		    else {
				newSideHeight = 225;   
		    }
			showSelectedAllianceOption (idSection, idSelectedSide, idSelectedInfo, newSideHeight);
		}
	);
});

function selectIntelReport(){
	newSideHeight = 230;
	$("#intelligence_sidepanel").animate( { height: '230px'},300);
	$("#intelligence_infopanel").animate( { top: newSideHeight-16+"px" , left: lowWidth-1+"px", height: lowHeight+mainHeight-newSideHeight-5+"px", width: mainWidth+sideWidth-lowWidth-30+"px"},300);
}
function showIntelLog(){
	newSideHeight = 200;
	$("#intelligence_sidepanel").animate( { height: '200px'},300);
	$("#intelligence_infopanel").animate( { top: newSideHeight-16+"px" , left: lowWidth-1+"px", height: lowHeight+mainHeight-newSideHeight-5+"px", width: mainWidth+sideWidth-lowWidth-30+"px"},300);
}

// JavaScript Document
// Javascript for Steam and Cycles
var cyclesOpen = 0;
var steamLoaded=true;
var openRankID = 0;
var selectedButtonID = '';
var selectedChatID = 0;
var previousChannel = 'global';
var previousHeader = 'global';

function showCycles(){
	openSlide('cycles_slide');
	showCyclesMainInfo();
//	$('#cycle_menu').transition({borderRadius : '30px', scale: 1},300);
//	cyclesOpen = 1;
}
function hideCycles() {
	openSlide('cycles_slide');
//	$('#cycle_menu').transition({borderRadius : '1500px', scale: 0.1},300);
//	cyclesOpen = 0;
}

function showCyclesMainInfo(){
	nameArray  = ['Inception', 'Inaugural', 'Argus', 'Prime', 'The Opening', 'Celemonious', 'The Silent Storm', 'Tidal Flood', 'The Vast Emptiness', 'Initiation'];
	var randomnumber=Math.floor(Math.random()*21)-10;
	randomName = nameArray[randomnumber];
	//console.log(randomName);
	$('#cycles_main_info #cycle_title_full').html(randomName);
	$('#cycles_main_info').css({opacity: 0}).show().transition({opacity: 1}, 500);
	$('.cycle_title_full').each(function(){
        $(this).strech_text();
    });
    showCyclesHistory();
    hideCyclesCategories();
    //console.log('showing Cycles Main Info');
	
}
function hideCyclesMainInfo(){
	$('#cycles_main_info').fadeOut(250);
	hideCyclesHistory();
    showCyclesCategories();
	//console.log('hiding Cycles Main Info');

}
function showCyclesHistory(){
	$('#history_select').fadeIn(250);
}
function hideCyclesHistory(){
	$('#history_select').fadeOut(250);
}
function showCyclesCategories(){
	$('#category_select').fadeIn(250);
}
function hideCyclesCategories(){
	$('#category_select').fadeOut(250);
}

$.fn.strech_text = function(){
    var elmt          = $(this),
        cont_width    = elmt.width(),
        txt           = elmt.html(),
        one_line      = $('<span class="stretch_it">' + txt + '</span>'),
        nb_char       = elmt.text().length,
        spacing       = cont_width/nb_char,
        txt_width;
    
    elmt.html(one_line);
    txt_width = one_line.width();
    
    if (txt_width < cont_width){
        var  char_width     = txt_width/nb_char,
             ltr_spacing    = spacing - char_width + (spacing - char_width)/nb_char ; 
  
        one_line.css({'letter-spacing': ltr_spacing});
    } else {
        one_line.contents().unwrap();
        elmt.addClass('justify');
    }
};

function showLines(){
	$('#sm_line_01').css({x:0}).transition({x: 1800}, 1680);
	$('#sm_line_02').css({x:0}).transition({x: 1800, delay: 300}, 1380);
	$('#sm_line_03').css({y:0}).transition({y: 1200}, 1200);
	$('#sm_line_04').css({y:0}).transition({y: 1200, delay: 240}, 1440);
	$('#sm_line_05').css({y:0}).transition({y: 1200,delay:360}, 1200);
	$('#sm_line_06').css({y:0}).transition({y: 1200,delay: 270}, 900);
	$('#sm_line_07').css({y:0}).transition({y: 1200,delay: 285}, 900);
	$('#sm_line_08').css({y:0}).transition({y: 1200,delay: 300}, 900);
	$('#sm_line_09').css({x:0}).transition({x: 1200,delay: 270}, 900);
	$('#sm_line_10').css({x:0}).transition({x: 1200,delay: 285}, 900);
	$('#sm_line_11').css({x:0}).transition({x: 1200,delay: 300}, 900);
}
function showStarMapSection(){
	if (ad2460.galaxynewsVisible==true){
			ad2460.galaxynewsVisible=false;
			hideTickerPanel();
	}
	if (ad2460.fullnewsVisible==true){
			ad2460.fullnewsVisible=false;
			hideFullNews();
			unrenderFullNews();
	}
	 if(ad2460.starmap.systemView==1){
		$('#starmapslide').css({opacity: 1}).show();
		$('#starmap_tracker').css({y:-55}).transition({y:0, delay: 600},300);
// 		$('.section_container').transition({x: 0},500, function(){$('.section_container').hide().css({y:0});});
		$('.section_container').transition({opacity: 0},500, function(){$('.section_container').hide();});
		$('#planetlist').css({ opacity: 0}).transition({opacity: 1},1400);
		//revert other parts as well
		$('#starmapslide').css({opacity: 1}).show();
		$('#star_nav_container').show().css({ opacity: 1,scale: 1});
		$('#universeview').css({ x: 0, opacity: 1});
		$('.starmap_bg').show().css({ opacity: 1, scale:1.1});
		$('.starmap_rank_container').show().css({ opacity: 1, scale: 1});
		$('.starmap_blue_container').show().css({ opacity: 1, scale: 1});
		$('.star_nav_arrows').css({ opacity: 1, scale: 1});
		$('#star_nav_legend').css({ opacity: 1, x:0});
		$('#starmap_tracker').css({y:0});
		$('#starmap_headerslate').css({x:0});
		$('.homebutton').css({y:0, opacity: 1});
		//console.log('opening starmap at Sol View');
	 }
	 else{
	$('#sm_line_container').show().animate({opacity:1},{duration:1500, complete:function(){$('#sm_line_container').hide()}} );
	$('#starmapslide').css({opacity: 1}).show();
	$('#star_nav_container').css({opacity: 0, scale: 1}).show().transition({ opacity: 1,delay: 300},900);
	$('#universeview').css({opacity: 0, x: 0}).transition({ opacity: 1,delay: 600},600);
	$('.starmap_bg').css({opacity: 0, scale: 1}).show().transition({ opacity: 1, scale:1.1},1400);
	
	if(ad2460.starmap.galaxyView == 1 || ad2460.starmap.quadrantView == 1){
		$('.starmap_rank_container .alliance').css({opacity: 0, scale: 1}).show().transition({ opacity: 1, delay: 600},300);
	}
	else{
		$('.starmap_rank_container .alliance').css({opacity: 0, scale: 1}).hide();
	}
	

	$('.starmap_blue_container').css({opacity: 0, scale: 1}).show().transition({ opacity: 1, delay: 600},300);
	$('.star_nav_arrows').css({opacity: 0, scale: 0.8}).transition({ opacity: 1, scale: 1, delay: 600},300);
	$('#star_nav_legend').css({opacity: 0, x:25}).transition({ opacity: 1, x:0, delay: 600},300);
	$('#starmap_tracker').css({y:-55}).transition({y:0, delay: 600},300);
	$('#starmap_headerslate').css({x:-40}).transition({x:0, delay: 500},500);
	$('#homebutton').css({y:250, opacity: 0}).transition({y:0, opacity: 1, delay: 600},500);
	if (ad2460.scores.level<3){
		blinkElementById("homebutton");
	}

//	$('.main_container').transition({scale: 0},1000);
//	$('.homeworldpane').transition({scale: 0},1000);
	$('.section_container').transition({opacity: 0},500, function(){$('.section_container').hide().css({opacity: 1});});
	 }
	if(economyVisible==1)
	{
		$('.economy_slide').transition({y:0, opacity: 0},500, 'easeInOutQuad', function(){$('.economy_slide').hide().css({opacity:1});});
		$('.plate_heading').transition({y:0},500, 'easeInOutQuad');
		$('.resource_box').transition({y:-20},500, 'easeInOutQuad');
		$('.starfield').transition({y:0},500, 'easeInOutQuad');	
	}
	if(missionsVisible==1){
		$('#mission_section').transition({y:0, opacity: 0},500, 'easeInOutQuad', function(){$('#mission_section').hide().css({opacity: 1});});
		$('.starfield').transition({y:0},500, 'easeInOutQuad');	
		missionsVisible=0;	
	}
//	$('#bgstars').transition({ scale: 1.2},2500);
	showLines();
//	homeworldVisible = 0;
//	outpostsVisible = 0;
//	allianceVisible = 0;
//	militaryVisible = 0;
//	economyVisible=0;
//	missionsVisible=0;
	starMapVisible=1;
	alertSystemToSlideOpened('starmapslide');
	startIngameMusic();
}

function hideLines(){
	$('#sm_line_01').transition({x: 0}, 1800);
	$('#sm_line_02').transition({x: 0}, 2000);
	$('#sm_line_03').transition({y: 0}, 1700);
	$('#sm_line_04').transition({y: 0}, 2100);
	$('#sm_line_05').transition({y: 0}, 2500);
}

function removeStarMap(){
	if(ad2460.currentPageSection == 'Homeworld' || ad2460.currentPageSection == 'Outposts' || ad2460.currentPageSection == 'Alliance' || ad2460.currentPageSection == 'Military'){
		if(ad2460.currentPageSection == 'Homeworld'){
			showHomeworld();
			ad2460.currentPageSectionId = 'homeworld_content';
		}
		if(ad2460.currentPageSection == 'Outposts'){
			showOutposts();
			ad2460.currentPageSectionId = 'outposts_content';
		}
		if(ad2460.currentPageSection == 'Alliance'){
			showAlliance();
			ad2460.currentPageSectionId = 'alliance_content';
		}
		if(ad2460.currentPageSection == 'Military'){
			showMilitary();
			ad2460.currentPageSectionId = 'military_content';
		}
	}
	hideStarMapSection();
}

function hideStarMapSection(){
	$('.starmap_bg').transition({ scale:1},600);
//	$('.starmap_rank_container').transition({ scale: 0.8},600);
//	$('.starmap_blue_container').transition({ scale: 0.8},600);
	$('#star_nav_container').transition({ scale: 0.9},600);
	$('#universeview').transition({x: 300},600);
	$('.star_nav_arrows').transition({opacity: 0, scale: 0.8},500);
	$('#starmapslide').transition({opacity: 0},600, function(){$('#starmapslide').hide();});
	$('#starmap_headerslate').transition({x:-40},600);
	$('#star_nav_legend').transition({ opacity: 0, x:-300, },500);
	$('#starmap_tracker').transition({  y:-55},300);
	$('#star_nav_arrows').transition({ opacity: 0, scale: 0.8},400);
	$('#homebutton').transition({y:250},500);
//	$('.section_container').transition({opacity: 1},2500);
//	$('#bgstars').transition({ scale: 1},2500);
//	hideLines();
	$('#bottomslider_close').click();
	stopIngameMusic();
	starMapVisible=0;
}

function showMissionSection(){
	$('#mission_section').fadeIn(500);
	alertSystemToSlideOpened('missionslide');
}

function hideMissionSection(){
	$('#mission_section').fadeOut(500);
	missionsVisible=0;
}

function expandCycleEntry(cycleEntryId){
	/* DOCUMENTATION
	itemheight: the height of the inner content of the box (what needs to be shown when expanded).
	itemdisplace: a modifier to the top value when expanding.
	itemdisplaceleft : how far the left of the parent container the floating element will be.
	itemdisplaceright : how far the right of the parent container the floating element will be.
	rowheight: the initial height of the parent container.
	scrollmod: 
	topmod: 
	*/
	var itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
	var originalWidth = parseInt($("#"+tableid+" .queue_entry_info").width());
	$("#"+tableid+" .queue_entry_info").css( {width: (originalWidth-20)+'px'});
	var openWidth = $("#"+tableid+" .queue_entry_info").width();
	var itemoffset_top = $("#"+tableid).parent().position().top;
	//console.log(itemoffset_top);
	var parentheight = $("#"+tableid).parent().parent().height();
	var itemdisplace = -35;
	var itemdisplaceleft = 10;
	var itemdisplaceright = 10;
	var rowheight = parentheight;
	var scrollmod = 1;
	var topmod = 20;
	
	if ($('#'+tableid).hasClass("dev_bonus_entry")) { /* THIS IS THE GOOD SOLUTION!!! */
			itemheight = parseInt($("#"+tableid+" .queue_entry_info").outerHeight())+35;
			itemdisplace = 0;
			itemdisplaceleft = 10;
			itemdisplaceright = 10;
			scrollmod = parseInt($("#"+tableid).parent().parent().css('top'));
			parentheight = $("#"+tableid).parent().parent().parent().height();
		}
	}


function showAwardCard(cardId){
	$('.award_card').css({opacity: 0, scale: 3, perspective: '400px', rotate: '15deg', rotateY: '45deg', x: 20, y: 200, boxShadow: '0px 0px 50px rgba(255,255,255,0)', left: '660px'})
					.show().transition({opacity: 1, scale: 1, perspective: '400px', rotate: '0deg',  rotateY: '0deg', x: 0, y: 0},500,'cubic-bezier(1.000, 1.540, 0.540, 0.750)').transition({boxShadow: '0px 0px 50px rgba(255,255,255,1)'});
	$('.awardimg').css({x: -50, y: 25}).transition({x: 0, y: 0},500,'cubic-bezier(1.000, 1.540, 0.540, 0.750)');
	$('.awardicon').css({x: 50, y: -75}).transition({x: 0, y: 0},500,'cubic-bezier(1.000, 1.540, 0.540, 0.750)');
	$('.awardnumber').css({x: 100, y:50}).transition({x: 0, y: 0},500,'cubic-bezier(1.000, 1.540, 0.540, 0.750)');
}
function hideAwardCard(cardId){
	$('.award_card').transition({opacity: 0, perspective: '0px', rotateY: '10deg', rotate: '-5deg', x: 1000, y: 50, scale: 0.3}, 500,'cubic-bezier(0.000, 0.550, 0.470, 1.000)');
}

function presentAwardCard(cardId){
	//console.log('Showing award card details of card '+cardId);
	$('.award_card_view')	.transition({scale: 0.80, perspective: '600px', rotate: '-3deg',  rotateY: '-7deg', rotateX: '7deg' , x: -10, y: 10},250,'cubic-bezier(0.420, 0.000, 1.000, 1.000)')
							.transition({scale: 1, perspective: '600px', rotate: '0deg',  rotateY: '-0deg', rotateX: '0deg' , x: 0, y: 15},250,'cubic-bezier(0.000, 0.000, 0.500, 1.500)');
//	$('.awardimg').css({x: -50, y: 25}).transition({x: 0, y: 0},500,'cubic-bezier(1.000, 1.540, 0.540, 0.750)');
	$('.awardicon')	.transition({scale: 1, x: -5, y: -5} ,350,'cubic-bezier(1.000, 1.540, 0.540, 0.750)')
					.transition({scale: 1, x: 0, y: 0} ,250,'cubic-bezier(1.000, 1.540, 0.540, 0.750)');
	$('.awardnumber').transition({x: -5, y: 0},250,'cubic-bezier(1.000, 1.540, 0.540, 0.750)').transition({x: 0, y: 0},250,'cubic-bezier(1.000, 1.540, 0.540, 0.750)');
	$('.awarddesc').css({zIndex: -1}).transition({rotateX: -60, x: 20, y: 20},250).css({}).transition({zIndex: 0, rotateX: 0, x: 0, y: 0},250);
	$('.award_card_view').attr('onclick','returnAwardCard()');
	//$('#'+cardId).attr('onclick','returnAwardCard');
}
function returnAwardCard(cardId){
	//console.log('Returning award card to base position '+cardId);
	$('.award_card_view').transition({scale: 0.6, perspective: '400px', rotate: '0deg',  rotateY: '0deg', x: 0, y: 0},250,'cubic-bezier(1.000, 1.540, 0.540, 0.750)');
	$('.award_card_view').attr('onclick','presentAwardCard()');
	$('.awarddesc').css({zIndex: 0}).transition({rotateX: -45, x: 20, y: 20},250).transition({zIndex: -1, rotateX: -90, x: 0, y: 0},250);
	//$('#'+cardId).attr('onclick','presentAwardCard');
}

function hideCycleEntries(){
	$('.cycle3d_element').transition({rotateY: '0deg', scale: 0, opacity: 0},300);
	$('.cycles_rank_entry').animate({opacity: 0, backgroundColor: '#fff'},{duration: 200, complete: function(){$('#cycles_rank_container').hide();}});	
	$('.cycles_tier_description').transition({ opacity: 0, x: -20, scale: 0.8},300);
	$('#cy_cat_head').transition({ opacity: 0, scale: 0.9},300);

	hideTierDescription(id);
}
function showCycleEntries(){
	$('#cycles_rank_container').show();
	$('.cycle3d_element').transition({scale: 1.2},50).transition({opacity:1, scale: 1.0},300);
	$('.cycles_rank_entry').animate({opacity: 1}, 100);	
	$('.cycles_tier_description').css({x: -40, scale: 1}).transition({ opacity: 1, x: 0},300);
	$('#cy_cat_head').css({scale: 1.2}).transition({ opacity: 1, scale: 1.0},200);
}
function replaceCategoryData(){
//	add functionality to replace boxes and layout before showing everything again.
	showCycleEntries();
}

function showTierDescription(id){
	left = $('#'+id).position().left;
	//console.log(left);
	$('#'+id+' .cycles_tier_desc_inner').transition({x : -left, width: '775px'}, 300,'cubic-bezier(0.000, 0.550, 0.470, 1.000)');
	$('#'+id+' .cycles_tier_desc_inner div').delay(300).fadeIn(300);


}
function hideTierDescription(id){
	$('#'+id+' .cycles_tier_desc_inner').transition({x : 0, width: '30px'}, 300,'cubic-bezier(0.000, 0.550, 0.470, 1.000)');
	$('#'+id+' .cycles_tier_desc_inner div').hide();


}
function deselectAdvButtons(){
	$('#'+selectedButtonID).removeClass('adv_selected');
}

function viewHeaders(){
	$('#forumtopics , #alliancetopics , #messageheaders , #view_channels').removeClass('chat_selected').fadeIn(200);
	$('#local , #group , #global , #view_headers').removeClass('chat_selected').fadeOut(200);	
	$('#chatbg').css({height: '167px', bottom: '1px'});
	$('#chat_input_field').addClass('chat_input_field_off').attr('placeholder','');
	$('#chatcontent').fadeOut(200);
	$('#forumheaders').show().addClass('header_field_open');
	$('#chatfunctions').hide();
	$('#chatfunctionsoff').show();
//	$('#overline').removeClass('local group combat global').addClass(previousHeader);
//	$('#underline').removeClass('local group combat global').addClass(previousHeader);
	if(previousHeader == 'global'){
		$('#forumtopics').trigger('click');
	}
	if(previousHeader == 'local'){
		$('#alliancetopics').trigger('click');
	}
	if(previousHeader == 'group'){
		$('#messageheaders').trigger('click');
	}
}
function viewChannels(){
	$('#local , #group , #global , #view_headers').removeClass('chat_selected').show();
	$('#forumtopics , #alliancetopics , #messageheaders , #view_channels').hide().removeClass('chat_selected');
	$('#chatbg').css({height: '137px', bottom: '31px'});
	$('#chat_input_field').removeClass('chat_input_field_off').attr('placeholder','Click and type here...');
	$('#chatcontent').fadeIn(200);
	$('#forumheaders').removeClass('header_field_open').hide();
	$('#chatfunctions').show()
	$('#chatfunctionsoff').hide();
//	$('#overline').removeClass('local group combat global').addClass(previousChannel);
//	$('#underline').removeClass('local group combat global').addClass(previousChannel);
	$('#'+previousChannel).trigger('click');

}


function changeTurn(num){
	$('#turn_circle').css({rotate: '0deg'}).transition({rotate: '360deg'},1000);
	$('#turn_digit').css({perspective: '100px', rotate3d: '1,1,0,0deg'}).transition({perspective: '100px', rotate3d: '1,1,0,90deg'},500,'linear',function(){$('#turn_digit').html(num)}).transition({perspective: '100px', rotate3d: '1,1,0,0deg'},500,'linear');
}
function setNameMentioned(channel){
	$('#'+channel+' .chat_activity_indicator').show().animate({opacity: 0.8},1000);
}
function unsetNameMentioned(channel){
	$('#'+channel+' .chat_activity_indicator').hide();
}
function flashChatIndicator(channel){
	$('#'+channel+' .chat_activity_indicator').show().css({opacity: 0}).animate({opacity: 0.8},150).animate({opacity: 0.5},100).animate({opacity: 1},50).animate({opacity: 0},300);
}
function setChatChannelUnread(channel){
	$('#'+channel+' .chat_unread_indicator').show().animate({opacity: 0.8},1000);
}
function setChatChannelRead(channel){
	/*
	$('#'+channel+' .chat_unread_indicator').animate(
		{opacity: 0},1000, complete: function(){
			$('#'+channel+' .chat_unread_indicator').hide();
		}
	);
	*/

	$('#'+channel+' .chat_unread_indicator').animate({opacity: 0},1000);
	setTimeout("$('#"+channel+" .chat_unread_indicator').hide()",1000);


}


function setDefenderRetreat(gauge,value){
	if(gauge == 'firepower'){
		var gaugesetting = (2*value)+21;
		$('.firepower_gauge .def_ret_ver').css({opacity: 0, bottom: '21px'}).show().transition({opacity: 1, bottom: gaugesetting+'px'},1000);
	}
	if(gauge == 'capitals'){
		var gaugesetting = (2*value)+23;
		$('.capitals_gauge .def_ret_ver').css({opacity: 0, bottom: '23px'}).show().transition({opacity: 1, bottom: gaugesetting+'px'},1000);
	}
	if(gauge == 'hull')	{
		var gaugesetting = value+20;
		$('.hull_gauge .def_ret_ver').css({opacity: 0, left: '20px'}).show().transition({opacity: 1, left: gaugesetting+'px'},1000);
	}
}
function setAttackerRetreat(gauge,value){
	if(gauge == 'firepower'){
		var gaugesetting = (2*value)+21;
		$('.firepower_gauge .att_ret_ver').css({opacity: 0, bottom: '21px'}).show().transition({opacity: 1, bottom: gaugesetting+'px'},1000);
	}
	if(gauge == 'capitals'){
		var gaugesetting = (2*value)+23;
		$('.capitals_gauge .att_ret_ver').css({opacity: 0, bottom: '23px'}).show().transition({opacity: 1, bottom: gaugesetting+'px'},1000);
	}
	if(gauge == 'hull')	{
		var gaugesetting = value+20;
		$('.hull_gauge .att_ret_ver').css({opacity: 0, left: '20px'}).show().transition({opacity: 1, left: gaugesetting+'px'},1000);
	}
}


function showHelpCommander(){
	$('#help_commander').stop().css({opacity: 0}).show().stop().transition({opacity: 1},300);
	$('#help_comm_field').css({opacity: 0}).transition({opacity: 1, delay: 200},300);
	play_multi_sound('helperin');
}

function hideHelpCommander(){
	//$('#help_commander').transition({opacity: 0},300,function(){$('#help_commander').hide()});
	$('#help_commander').css({opacity: 0}).hide();
	denyLadyHelp = true;
	setTimeout(
		function(){
			denyLadyHelp = false;
		}, 15000
	);
}
function moveHelpCommanderRight(){
	$('#help_commander').removeClass('left');
}
function moveHelpCommanderLeft(){
	$('#help_commander').addClass('left');
}


function pulseElementOn(targetId){
	var target = $('#'+targetId);
	var targetHeight = target.outerHeight();
	var targetWidth = target.outerWidth();
	var position = target.position();
	target.before('<div class="pulsering" id="'+targetId+'_pulse"></div>');
	$('#'+targetId+'_pulse').css({left:  position.left , top: position.top, height: targetHeight, width: targetWidth, position: 'absolute'});
}
function pulseElementOff(){

}



//$(document).ready(function () {
//    $('.cycle_title_gui').each(function(){
//        $(this).strech_text();
//    });
//});


/*  Cycle marker click function
$(document).ready(function() {
	$("#cycle_overview").click(function(){
		if(cyclesOpen==1){
			hideCycles();
		}
		else{
			showCycles();
		}

	});

	$("#cycle_marker").click(function(){
		openSlide('cycles_slide');
		showCyclesMainInfo();
		hideCycles();
	});
	$("#open_full_cycles").click(function(){
		openSlide('cycles_slide');
		showCyclesMainInfo();
		hideCycles();
	});
});
*/
/*$(document).ready(function() {
	$("#starmapbutton").click(function(){
		if(acceptClick){
			closePanels();
			closeSlides();
			if (categoryPanelOpen==1) {closeCategoryPanel();}
			acceptClick = false;
			buttonId = $(this).attr("id");
			clickMain(buttonId);		
			if(starMapVisible==0){
			showStarMapSection('starmapslide');
			}
			hideEarning();		
			setTimeout('acceptClick=true',1500);
	}
	});
});*/

$(document).ready(function() {
	$(".cycle3d_element").click(function(){
		var cycle_box_id = $(this).attr('id');
		var cycle_entry_top = $(this).parent().parent().position().top;
		var cycle_entry_left = parseInt($(this).parent().position().left);
		// console.log('Box is '+cycle_entry_top+' from top and '+cycle_entry_left+' from left of container.');
		var box_displace_y = 150-cycle_entry_top;
		var box_displace_x = 280-(cycle_entry_left-1);
		var boxHeight = $(this).height();
		//console.log(cycle_box_id+' is '+boxHeight+' high.')
		if(boxHeight <= 80){
			$("#"+cycle_box_id).css({zIndex: 5}).transition({scale: 1.0, height: '200px', width: '200px', x: box_displace_x, y: box_displace_y},500);
			$("#"+cycle_box_id+' .cycles_entry_avatar').transition({scale: 1.5, y: 16, x: 5, boxShadow: '2px 2px 10px rgba(0,0,0,0.5)'},500);
			$("#"+cycle_box_id+' .cycles_entry_score').transition({paddingLeft: '75px', paddingTop: '25px', fontSize: '18px'},500);
			$("#"+cycle_box_id+' .cycle_rank_player_info').css({opacity: 0}).show().transition({delay: 500, opacity: 1},500);
			//console.log('Box is: '+boxHeight+'. Regular box is closed: opening...');	
		}
		else if($(this).height() >= 80 && $(this).height() <= 101 && $(this).parent().hasClass('leader') ){
			$("#"+cycle_box_id).css({zIndex: 5}).transition({scale: 1.0, height: '230px', width: '220px', x: (box_displace_x-25), y: box_displace_y},500);
			$("#"+cycle_box_id+' .cycles_entry_avatar').transition({scale: 1.25, y: 11, x: 1, boxShadow: '2px 2px 10px rgba(0,0,0,0.5)'},500);
			$("#"+cycle_box_id+' .cycles_entry_score').transition({paddingLeft: '95px', paddingTop: '30px', fontSize: '18px'},500);
			$("#"+cycle_box_id+' .cycles_entry_heading').transition({width: '223px'},500);
			$("#"+cycle_box_id+' .cycle_rank_player_info').css({opacity: 0}).show().transition({delay: 500, opacity: 1},500);
			//console.log('Box is: '+boxHeight+'. Leader box is closed: opening leader box.');
		}
		else if($(this).height() >= 210){
			$("#"+cycle_box_id).transition({scale: 1.0, height: '100px', width: '200px', zIndex: 0, x: 0, y: 0},500)
			$('#'+cycle_box_id+' .cycles_entry_avatar').transition({scale: 1.0, y: 0, x: 0, boxShadow: '0px 0px 0px black'},500);
			$("#"+cycle_box_id+' .cycles_entry_score').transition({paddingLeft: '80px', paddingTop: '10px', fontSize: '15px'},500);
			$("#"+cycle_box_id+' .cycles_entry_heading').transition({width: '203px'},500);
			$("#"+cycle_box_id+' .cycle_rank_player_info').hide();
			//console.log('Box is: '+boxHeight+'. Leader box is open: Closing leader box.');
		}
		else{
			$("#"+cycle_box_id).transition({scale: 1.0, height: '75px', width: '140px', zIndex: 0, x: 0, y: 0},500)
			$('#'+cycle_box_id+' .cycles_entry_avatar').transition({scale: 1.0, y: 0, x: 0, boxShadow: '0px 0px 0px black'},500);
			$("#"+cycle_box_id+' .cycles_entry_score').transition({paddingLeft: '54px', paddingTop: '0px', fontSize: '15px'},500);
			$("#"+cycle_box_id+' .cycle_rank_player_info').hide();
			//console.log('regular box is open: closing...');	
		}
		if(openRankID == cycle_box_id){return;}
		else{
			if($('#'+openRankID).parent().hasClass('leader')){
				//console.log('This is: '+cycle_box_id+'. '+openRankID+' is open. closing it.')
				$('#'+openRankID).transition({scale: 1.0, height: '100px', width: '200px', zIndex: 0, x: 0, y: 0},500)
				$('#'+openRankID+' .cycles_entry_avatar').transition({scale: 1.0, y: 0, x:0, boxShadow: '0px 0px 0px black'},500);
				$('#'+openRankID+' .cycles_entry_score').transition({paddingLeft: '80px', paddingTop: '10px', fontSize: '15px'},500);
				$("#"+openRankID+' .cycles_entry_heading').transition({width: '203px'},500);
				$('#'+openRankID+' .cycle_rank_player_info').hide();
				openRankID = cycle_box_id;
				//console.log('Box is Leader. Leader box is open: Closing leader box.');
			}
			else{
				//console.log('This is: '+cycle_box_id+'. '+openRankID+' is open. closing it.')
				$('#'+openRankID).transition({scale: 1.0, height: '75px', width: '140px', zIndex: 0, x: 0, y: 0},500)
				$('#'+openRankID+' .cycles_entry_avatar').transition({scale: 1.0, y: 0, x:0, boxShadow: '0px 0px 0px black'},500);
				$('#'+openRankID+' .cycles_entry_score').transition({paddingLeft: '54px', paddingTop: '0px', fontSize: '15px'},500);
				$('#'+openRankID+' .cycle_rank_player_info').hide();
				openRankID = cycle_box_id;			
//			$('.cycles_entry_avatar').not('#'+cycle_box_id+' .cycles_entry_avatar').transition({scale: 1.0, y: 0, x:0, boxShadow: '0px 0px 0px black'},500);
//			$('.cycles_entry_score').not('#'+cycle_box_id+' .cycles_entry_score').transition({paddingLeft: '54px', paddingTop: '0px', fontSize: '15px'},500);
//			$('.cycle_rank_player_info').not('#'+cycle_box_id+' .cycle_rank_player_info').hide();
			
			}
		}
		
		
		
	});
});

$(document).ready(function() {
	$("#select_ally_cycle").click(function(){
		if ($("#select_ally_cycle").hasClass("allycycle_selected")) {
        	$("#select_ally_cycle").removeClass('allycycle_selected');
        	hideCycleEntries();
        	showCyclesMainInfo();
    	}
    	else{
			$("#select_ally_cycle").addClass('allycycle_selected');
			$("#select_player_cycle").removeClass('playercycle_selected');
			hideCyclesMainInfo();
			hideCycleEntries();
			setTimeout('replaceCategoryData()',300);
		}
	});
});
$(document).ready(function() {
	$("#select_player_cycle").click(function(){
		if ($("#select_player_cycle").hasClass("playercycle_selected")) {
        	$("#select_player_cycle").removeClass('playercycle_selected');
        	hideCyclesMainInfo();
        	hideCycleEntries();
        	showCyclesMainInfo();
    	}
    	else{
			$("#select_ally_cycle").removeClass('allycycle_selected');
			$("#select_player_cycle").addClass('playercycle_selected');
			hideCyclesMainInfo();
			hideCycleEntries();
			setTimeout('replaceCategoryData()',300);
		}
	});
});

$(document).ready(function() {
	$("#category_01").click(function(){
		hideCycleEntries();
		setTimeout('replaceCategoryData()',300);
		
	});
});
$(document).ready(function() {
	$("#category_02").click(function(){
		hideCycleEntries();
		setTimeout('replaceCategoryData()',300);
	});
});
$(document).ready(function() {
	$(".cycles_tier_description").click(function(){
		var id = $(this).attr('id');
		var tierDescWidth = $(this).children().width();
		//console.log('Tier ID: '+id+' Width: '+tierDescWidth);
		if(tierDescWidth <= 750){
			showTierDescription(id);
		}
		else{
			hideTierDescription(id);
		}
	});
});
$(document).ready(function() {
	if (static_page == true) {
		$(".adv_button").click(function(){
			var adv_box_id = $(this).attr('id');
			if($(this).hasClass('adv_selected')){
				$(this).removeClass('adv_selected');
			}
			else{
				$(this).addClass('adv_selected');
			}

			//console.log('This is '+adv_box_id+'. Selecting.');
	//		if(selectedButtonID == adv_box_id){
	//			selectedButtonID = '';
	//			return;
	//		}
			if(selectedButtonID != adv_box_id){
				$('#'+selectedButtonID).removeClass('adv_selected');
				//console.log('De-selecting '+selectedButtonID+'.');
			}
			selectedButtonID = adv_box_id;	
		});
	}
});

$(document).ready(function() {
	$(".cycles_tier_award").click(function(event){
		cardId=$(this).attr(id);
		event.stopPropagation();
		event.preventDefault();
		showAwardCard(cardId);

	});
});
$(document).ready(function() {
	$(".chat_heading").click(function(){
		var chat_channel_id = $(this).attr('id');
		if ($(this).attr('id') == 'local'){
			previousChannel = $(this).attr('id'); 
		}
		
		if(selectedChatID == chat_channel_id){
			return;
		}
		
		$(this).addClass('chat_selected');
		$('#'+selectedChatID).removeClass('chat_selected');		
		selectedChatID = chat_channel_id;
		scrollChatToBottom();
	});
});
;


$(document).on('click', '#view_headers', function(){
		viewHeaders(previousChannel);
	})
	.on('click', '#view_channels', function() {
		viewChannels(previousHeader);
	});


$(document).ready(function() {
	$('#global, #local, #group, #forumtopics, #alliancetopics, #messageheaders').click(function(){
		$('#chat_input').show();
		$('#chatcontent').css({bottom: '37px'});
	});
	$("#global").click(function(){
		$('#overline').addClass('global').removeClass('local group combat');
		$('#underline').addClass('global').removeClass('local group combat');
		previousChannel = 'global';
		//console.log(previousChannel);
	});
	$("#local").click(function(){
		$('#overline').addClass('local').removeClass('global group combat');
		$('#underline').addClass('local').removeClass('global group combat');
		previousChannel = 'local';
		//console.log(previousChannel);
	});
	$("#group").click(function(){
		$('#overline').addClass('group').removeClass('local global combat');
		$('#underline').addClass('group').removeClass('local global combat');
		previousChannel = 'group';
		//console.log(previousChannel);
	});
	$("#view_combat_text").click(function(){
		$('#overline').addClass('combat').removeClass('local global group');
		$('#underline').addClass('combat').removeClass('local global group');
		$('#chat_input').hide();
		$('#chatcontent').css({bottom: '0px'});
	});
	$("#forumtopics").click(function(){
		$('#overline').addClass('global').removeClass('local group combat');
		$('#underline').addClass('global').removeClass('local group combat');
		previousHeader = 'global';
		//console.log(previousHeader);
	});
	$("#alliancetopics").click(function(){
		$('#overline').addClass('local').removeClass('global group combat');
		$('#underline').addClass('local').removeClass('global group combat');
		previousHeader = 'local';
		//console.log(previousHeader);
	});
	$("#messageheaders").click(function(){
		$('#overline').addClass('group').removeClass('local global combat');
		$('#underline').addClass('group').removeClass('local global combat');
		previousHeader = 'group';
		//console.log(previousHeader);
	});

	$("#slot1").hover(
		function(){
		$('#chatfunctions').addClass('slot1').removeClass('slot2 slot3 slot4');
		},
		function(){
		$('#chatfunctions').removeClass('slot1').removeClass('slot2 slot3 slot4');
	});
	$("#slot2").hover(
		function(){
		$('#chatfunctions').addClass('slot2').removeClass('slot1 slot3 slot4');
		},
		function(){
		$('#chatfunctions').removeClass('slot2').removeClass('slot1 slot3 slot4');
	});
	$("#slot3").hover(
		function(){
		$('#chatfunctions').addClass('slot3').removeClass('slot2 slot1 slot4');
		},
		function(){
		$('#chatfunctions').removeClass('slot3').removeClass('slot2 slot1 slot4');
	});
	$("#slot4").hover(
		function(){
		$('#chatfunctions').addClass('slot4').removeClass('slot2 slot3 slot1');
		},
		function(){
		$('#chatfunctions').removeClass('slot4').removeClass('slot2 slot3 slot1');
	});


	$("#slot4").click(function(){
		var fontSize = parseInt($('.chat_wrapper').css('font-size'));
		if(fontSize == 12){
			$('.chat_wrapper').css({fontSize: '14px', lineHeight: '18px'});
		}
		else{
			$('.chat_wrapper').css({fontSize: '12px', lineHeight: '16px'});
		}
		scrollChatToBottom();
	});

});

$(document).ready(function() {
	$("#forumtopics").click(function(){
		$("#forumheaderfield").show();
		$("#allianceheaderfield").hide();
		$("#mailheaderfield").hide();												 
	});
	$("#alliancetopics").click(function(){
		$("#forumheaderfield").hide();
		$("#allianceheaderfield").show();
		$("#mailheaderfield").hide();												 
	});
	$("#messageheaders").click(function(){
		$("#forumheaderfield").hide();
		$("#allianceheaderfield").hide();
		$("#mailheaderfield").show();													 
	});
});

$(document).ready(function() {
	if (static_page == true) {
		$("#turn_circle").click(function(){
		num = Math.floor((Math.random() * 10) + 1);
		changeTurn(num);											 
	});
	}
});

$(document).ready(function() {
	$("#helper_close").click(function(){
//		if($("#help_commander").hasClass('left')){
//			moveHelpCommanderRight();
//			console.log('moving Commander to Right side.');
//		}
//		else{
//			moveHelpCommanderLeft();
//			console.log('moving Commander to Left side.');
//		}
		hideHelpCommander();	
	});
});


			</script>

			<link rel='image_src' href='http://www.ad2460.com/images/webgfx/logo.jpg'>
			
			<link href='css/game13.css?rn=_v2_1507203681' rel='stylesheet' type='text/css' />
		

		
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68867717-1', 'auto');
  ga('send', 'pageview');

</script>
		</head>
		<body id='body'>
		<script>
			window.fbAsyncInit = function() {
				FB.init({
				appId      : '150112398364747',
				xfbml      : true,
				version    : 'v2.1'
				});
			};
			(function(d, s, id){
				var js, fjs = d.getElementsByTagName(s)[0];
				if (d.getElementById(id)) {return;}
				js = d.createElement(s); js.id = id;
				js.src = '//connect.facebook.net/en_US/sdk.js';
				fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));
		</script>
		<div id='fb-root'></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = '//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=150112398364747&version=v2.0';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

			<div class='main_bg' id='main_bg'>
				<div class='starfield' id='bgstars'></div>
				<img class='menuicon' id='hw_icon' src='images/fixed/homeworld_menu.png'>
				<img class='menuicon' id='op_icon' src='images/fixed/outpost_menu.png'>
				<img class='menuicon' id='al_icon' src='images/fixed/allycrest_menu.png'>
				<img class='menuicon' id='mi_icon' src='images/fixed/military_menu.png'>
				<img class='menuicon' id='ec_icon' src='images/fixed/economy_menu.png'>
				<img class='menuicon' id='ms_icon' src='images/fixed/mission_menu.png'>
				<div class='main_content_container' id='game_container'>
	
					<div class='points_msg unused_tech_points' id='unused_tech_points_indicator' style='display:none;'>0</div>
					<div class='points_msg unread_msg' id='points_msg_unread_msg_indicator' style='display:none;'>0</div>
					<div class='new_forum_activity_buttons' id='unread_chat_indicator_global' style='display:none;'>!</div>
					<div class='new_forum_activity_buttons' id='unread_chat_indicator_local' style='display:none;'>!</div>
					<div class='new_forum_activity_buttons' id='unread_chat_indicator_alliance' style='display:none;'>!</div>
					<div class='guileft'></div>
					<div class='guiright'></div>
					<div class='guitop'></div>
					<div class='guibottom'></div>
					<div class='guicornertop'></div>
					<div class='guiconerbottom'></div>
	
					<div class='mainmenupanel' id='menupanel'>
						<h1 tabindex='1' class='main_menu_item' id='homeworldbutton'>Homeworld</h1>
						<h1 tabindex='2' class='main_menu_item' id='outpostsbutton'>Outposts</h1>
						<h1 tabindex='3' class='main_menu_item' id='alliancebutton'>Alliance</h1>
						<h1 tabindex='4' class='main_menu_item' id='militarybutton'>Military</h1>
						<h1 tabindex='5' class='main_menu_item' id='missionsbutton'>Missions</h1>
						<h1 tabindex='6' class='main_menu_item' id='starmapbutton'>Starmap</h1>

						<div class='cycle_marker' id='cycle_marker'>
							<span class='test_text'></span>
							<div class='cycle_number' id='main_menu_cycle_number'>Cycle V</div>
							<div class='cycle_title_gui' id='cycle_title_gui'>Vae Victis</div>
							<div class='cycle_timer' id='main_menu_cycle_timer' onclick='specialNavigateToLatestPatchNotes()'><span id='main_menu_cycle_goals_remaining'>What's new in AD2460</span><br><span style='font-size: 10px;text-transform: none; font-style: italic;'>Click to Open</span></div>
							<div class='cycle_extra' id='main_menu_cycle_extra'><span id='cycle_extra_text'>Sep 29th - Dec 17th</span></div>
						</div>
						<!--<div class='levelup_info_button' onclick='showLevelHelp()'></div>-->
						<h2 class='adv_button gamelevelbutton' title='Level-specific help' id='gameinfo_level' onclick='showLevelHelp()'><img src='images/icons/buttons/UI_levelinfo_icon.png'></h2>
						<h2 class='adv_button faqbutton' title='Frequently Asked Questions' id='gameinfo_faq' onclick='showFAQ()'><img src='images/icons/buttons/UI_faq_icon.png'></h2>

					</div>
	
		<h2 class='adv_button techbutton' id='techtreebutton' onclick="openSlide('techtreeslide')" title='Techpoints'>
			<img src='images/icons/buttons/UI_techpoints_icon.png'>
		</h2>
		<h2 class='adv_button shortcut01' id='economy_button'  onclick="openSlide('economy_slide')" title='Economy'>
			<img src='images/icons/buttons/UI_economy_icon.png'>
		</h2>
		<h2 class='adv_button rankingsbutton' id='rankingbutton' onclick='openRankingsSlide()' title='Rankings'>
			<img src='images/icons/buttons/UI_rankings_icon.png'>
		</h2>

		<h2 class='optionsbutton adv_button' id='optionsbutton' onclick='openOptionsSlide()' title='Options'>
			<img src='images/icons/buttons/UI_options_icon.png'>
		</h2>
		<h2 class='creditsbutton adv_button' id='creditsbutton' onclick='openSlide("purchaseslide")' title='Purchase Credits'>
			<img src='images/icons/buttons/UI_button_cred_icon.png'>
		</h2>
		<h2 class='supportbutton adv_button' id='supportbutton' onclick='openSlide("supportslide")' title='Support'>
			<img src='images/icons/buttons/UI_support_icon.png'>
		</h2>

		<h2 class='adv_button messagesbutton' id='messagesbutton' onclick="openSlide('mailslide')" title='Messages'>
			<img src='images/icons/buttons/UI_messages_icon.png'>
		</h2>
		<h2 class='adv_button forumsbutton' id='forumopenbutton' onclick="openSlide('forumcategories')" title='Forums'>
			<img src='images/icons/buttons/UI_forums_icon.png'>
		</h2>
		<h2 class='adv_button notesbutton' id='notesbutton' onclick="openSlide('noteslide')" title='Notes'>
			<img src='images/icons/buttons/UI_notes_icon.png'>
		</h2>

		<div class='bottompanel' id='bottompanel'>

			<h2 class='adv_button tutorialbutton' onclick="window.open('tutorial_page.html','tutWindow','toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=SomeSize,height=SomeSize')" title='Tutorial'>
				<img src='images/icons/buttons/UI_tutorial_icon.png'>
			</h2>

			<div class='tip_of_the_day' id='todaytip'>
				<div><span id='front_ally_motd_header' onclick='toggleMotdDisplay()' class='forumheader_heading' style='cursor:pointer;'>Alliance</span><br><span id='front_ally_motd'>You should really consider joining an alliance. They can help you out a great deal in the early game! <br><br>Keep in mind, until someone reaches level 5, no alliances can be created!</span></div>
			</div>

			<div class='forumheaderdisplay'>
            	<div class='forumheader_heading' id='active_topics_header' style='cursor:pointer;' onclick='forceRecentThreadsToggle()'>Active Topics</div>
            	<div id='front_threads_container'>
	            </div>
            </div>

		</div>

		
		<div class='rightpanel' id='rightpanel'>
			<div id='latest_updates_outer_container' class='latest_updates'>
				<div class='latest_updates_black_border'></div>
                <div class='latest_updates_white_border'></div>

				<div id='playerUpdateItemContainer' class='latest_updates_container'>
					<div class='latest_update_image_container'><img id='playerUpdateItemImage' class='latest_update_image' src='images/fixed/spacer.gif'></div>
					<div class='latest_update_info'>
						<div class='latest_update_location' id='playerUpdateItemHeader'></div>
						<div class='latest_update_details' id='playerUpdateItemBody'></div>
						<div class='latest_update_timestamp' id='playerUpdateItemTimestamp'></div>
					</div>
				</div>

				<div class='latest_updates_navigation'>
					<img id='player_update_previous_button' title='Next News' class='latest_update_next' src='images/icons/buttons/prev_yes.png' onclick='nextPlayerUpdateClick()'>
					<img id='player_update_next_button' title='Previous News' class='latest_update_previous' src='images/icons/buttons/next_yes.png' onclick='previousPlayerUpdateClick()'>
					<div id='latest_update_counter' title='Toggle Full News View' class='latest_update_counter' onclick='toggleFullNews()'>No news</div>
                </div>
			</div>

			<div class='processdisplay' id='homeworld_process_display'>
				<div id='process_1' class='processtracker process_1'>
					<div id='process_1_colour' class='processcolour'></div>
					<div id='process_1_progress' class='processprogress' ></div>
					<div id='process_1_eta' class='processeta'></div>
					<div id='process_1_name' class='processname'>No facility under construction</div>
				</div>
				<div id='process_3' class='processtracker process_2'>
					<div id='process_3_colour' class='processcolour'></div>
					<div id='process_3_progress' class='processprogress' ></div>
					<div id='process_3_eta' class='processeta'></div>
					<div id='process_3_name' class='processname'>No research in progress</div>
				</div>
				<div id='process_5' class='processtracker process_3'>
					<div id='process_5_colour' class='processcolour'></div>
					<div id='process_5_progress' class='processprogress' ></div>
					<div id='process_5_eta' class='processeta'></div>
					<div id='process_5_name' class='processname'>No development in progress</div>
				</div>
				<div id='process_2' class='processtracker process_4'>
					<div id='process_2_colour' class='processcolour'></div>
					<div id='process_2_progress' class='processprogress' ></div>
					<div id='process_2_eta' class='processeta'></div>
					<div id='process_2_name' class='processname'>No outpost is upgrading</div>
				</div>
				<div id='process_4' class='processtracker process_5'>
					<div id='process_4_colour' class='processcolour'></div>
					<div id='process_4_progress' class='processprogress'></div>
					<div id='process_4_eta' class='processeta'></div>
					<div id='process_4_name' class='processname'>No alliance-project upgrading</div>
				</div>
				<div id='process_6' class='processtracker process_6'>
					<div id='process_6_colour' class='processcolour'></div>
					<div id='process_6_progress' class='processprogress' ></div>
					<div id='process_6_eta' class='processeta'></div>
					<div id='process_6_name' class='processname'>No ongoing production</div>
				</div>
				<div id='process_7' class='processtracker process_7'>
					<div id='process_7_colour' class='processcolour'></div>
					<div id='process_7_progress' class='processprogress' ></div>
					<div id='process_7_eta' class='processeta'></div>
					<div id='process_7_name' class='processname'>No active prospecting</div>
				</div>
				<div id='process_8' class='processtracker process_7' style='display:none'>
					<div id='process_8_colour' class='processcolour'></div>
					<div id='process_8_progress' class='processprogress'></div>
					<div id='process_8_eta' class='processeta'></div>
					<div id='process_8_name' class='processname'>No active intel</div>
				</div>
				<div id='process_9' class='processtracker process_8'>
					<div id='process_9_colour' class='processcolour'></div>
					<div id='process_9_progress' class='processprogress' ></div>
					<div id='process_9_eta' class='processeta'></div>
					<div id='process_9_name' class='processname'>No mission in progress</div>
				</div>
			</div>

 			<div class='news_ticker_entry' id='ticker_view' onclick='toggleTickerPanel()'></div>

            <div class='window_controls_container'>
            	<div class='minimize_window'></div>
            	<div class='windowed_window'></div>

				<div class='reload_game' style='cursor:pointer' title='Reload' onclick='document.location.reload()'></div>
				<div class='close_game' style='cursor:pointer' title='Log Out' onclick='logout()'></div>
            </div>

        </div>



	
					<div class='toppanelcontent' id='toppanel'>
						<div class='resourcedisplay' id='resource1display'>
							<div class='resourcename'>Hassium</div>
							<div class='active_trade' id='active_trade_hs'></div>
							<div class='resourcevolume' id='hassium'>0</div>
						</div>
						<div class='resourcedisplay' id='resource2display'>
							<div class='resourcename'>Indium</div>
							<div class='active_trade' id='active_trade_in'></div>
							<div class='resourcevolume' id='indium'>0</div>
						</div>
						<div class='resourcedisplay' id='resource3display'>
							<div class='resourcename'>Strontium</div>
							<div class='active_trade' id='active_trade_sr'></div>
							<div class='resourcevolume' id='strontium'>0</div>
						</div>
						<div class='resourcedisplay' id='resource4display'>
							<div class='resourcename'>Neodymium</div>
							<div class='active_trade' id='active_trade_nd'></div>
							<div class='resourcevolume' id='neodymium'>0</div>
						</div>
						<div class='resourcedisplay' id='resource5display'>
							<div class='resourcename'>Credits</div>
							<div class='resourcevolume' id='energy'>0</div>
						</div>
						<div class='logout_button' onclick='logout()'></div>
					</div>

					<div class='resourceinfopanel' id='resource1panel'>
						<div class='resourceinfotext'>
							<div class='resourceinfoheader'>Capacity:</div>
							<div class='resourceinfoentry' id='max_hassium_homeworld_storage'></div>
							<div class='resourceinfoheader'>In Trade:</div>
							<div class='resourceinfoentry' id='hassium_trade_resource_storage'></div>
							<div class='resourceinfoheader'>Fill Level:</div>
							<div class='resourceinfoentry bottom_line' id='max_hassium_homeworld_storage_percent'></div>
							<img class='resourceinfosymbol' src='http://live.ad2460.com/images/fixed/Hs.png' />
							Hassium has been found to be one of the most versatile elements in the galaxy. In ancient times, it was largely disregarded, but has shown itself to be extremely useful in many of the important processes of material production. It is also used in many chemical processes, and even as a part of many end-products in the galaxy of today.
						</div>
					</div>
					<div class='resourceinfopanel' id='resource2panel'>
						<div class='resourceinfotext'>
							<div class='resourceinfoheader'>Capacity:</div>
							<div class='resourceinfoentry' id='max_indium_homeworld_storage'></div>
							<div class='resourceinfoheader'>In Trade:</div>
							<div class='resourceinfoentry' id='indium_trade_resource_storage'></div>
							<div class='resourceinfoheader'>Fill Level:</div>
							<div class='resourceinfoentry bottom_line' id='max_indium_homeworld_storage_percent'></div>
							<img class='resourceinfosymbol' src='http://live.ad2460.com/images/fixed/In.png' />
							Indium was a common metal in the old days, but it is now rarer, and it's properties are widely regarded as exceptional, especially in certain alloys which will strengthen metals to exceedingly high levels. It can therefore be used to create incredibly strong constructions with relatively little material.
						</div>
					</div>
					<div class='resourceinfopanel' id='resource3panel'>
						<div class='resourceinfotext'>
							<div class='resourceinfoheader'>Capacity:</div>
							<div class='resourceinfoentry' id='max_strontium_homeworld_storage'></div>
							<div class='resourceinfoheader'>In Trade:</div>
							<div class='resourceinfoentry' id='strontium_trade_resource_storage'></div>
							<div class='resourceinfoheader'>Fill Level:</div>
							<div class='resourceinfoentry bottom_line' id='max_strontium_homeworld_storage_percent'></div>
							<img class='resourceinfosymbol' src='http://live.ad2460.com/images/fixed/Sr.png' />
							Strontium has come to be a main proponent of energy amplification, and is a key component in the energy technology branch of research. It is used both in the production of weapons as well as propulsion systems, and even works as part of the energy storage systems.
						</div>
					</div>
					<div class='resourceinfopanel' id='resource4panel'>
						<div class='resourceinfotext'>
							<div class='resourceinfoheader'>Capacity:</div>
							<div class='resourceinfoentry' id='max_neodymium_homeworld_storage'></div>
							<div class='resourceinfoheader'>In Trade:</div>
							<div class='resourceinfoentry' id='neodymium_trade_resource_storage'></div>
							<div class='resourceinfoheader'>Fill Level:</div>
							<div class='resourceinfoentry bottom_line' id='max_neodymium_homeworld_storage_percent'></div>
							<img class='resourceinfosymbol' src='http://live.ad2460.com/images/fixed/Nd.png' />
							Neodymium has always been known for its high magnetic property. It is an absolute necessity in the displacement technology field, as it can, with the right treatment, become a very powerful field-adjustment component, and has been proven to affect gravitational fields to great effect.
						</div>
					</div>
					<div class='resourceinfopanel' id='resource5panel'>
						<div class='resourceinfotext'>
							<img class='resourceinfosymbol' src='http://live.ad2460.com/images/fixed/Cr.png' />
							<span >
								AD2460 is a free game. If you want to, you can purchase Credits to enhance your experience inside the game, as they give you access to more fun! You can fill up on credits in the Purchase-screen. Buying credits helps keep the game alive, and allows us to keep making it better with expansions, add-ons and new features.
								<br><br>
								Credits are not expensive, and we don't have any pay2win-features or things like that, just more fun, more customisation and cooler visuals! Help support us, and you get a better game, it's that simple.
							</span>
							<br>

							<span onclick='openPurchaseSection()' style='font-weight:bold;cursor:pointer'>
							Click here to purchase credits.
							</span>

						</div>
					</div>


	
		<!-- Star Map Slide -->
		<div class='starmap_slide' id='starmapslide'>
			<div class='starmap_bg'></div>
			<div class='starmapcontainer'>
				<!-- New Starmap -->

				<div class='star_nav_panel'>
					<div class='star_nav_arrows'>
						<div class='starmap_nav_left'  id='PanLeft'  onclick='moveLeft()'></div>
						<div class='starmap_nav_up'  id='PanUp'  onclick='moveUp()'  ></div>
						<div class='starmap_nav_right'  id='PanRight' onclick='moveRight()'></div>
						<div class='starmap_nav_down'  id='PanDown'  onclick='moveDown()'></div>
					</div>
					<div class='star_nav_legend'>
                    	<div class='legend_label'>Legend</div>
                    </div>

					<div class='star_nav_container' id='star_nav_container'>
						<div class='star_nav_helpline'>Click on a grid square to zoom in</div>
						<canvas id='starmapCanvasOverlay' width='400' height='400' style='z-index: 40; position: absolute; display:none;'></canvas>
						<div class='grid' id='grid1_1' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>1</div></div><div class='grid' id='grid2_1' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>2</div></div><div class='grid' id='grid3_1' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>3</div></div><div class='grid' id='grid4_1' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>4</div></div>
						<div class='grid' id='grid1_2' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>5</div></div><div class='grid' id='grid2_2' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>6</div></div><div class='grid' id='grid3_2' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>7</div></div><div class='grid' id='grid4_2' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>8</div></div>
						<div class='grid' id='grid1_3' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>9</div></div><div class='grid' id='grid2_3' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>10</div></div><div class='grid' id='grid3_3' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>11</div></div><div class='grid' id='grid4_3' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>12</div></div>
						<div class='grid' id='grid1_4' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>13</div></div><div class='grid' id='grid2_4' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>14</div></div><div class='grid' id='grid3_4' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>15</div></div><div class='grid' id='grid4_4' style='background-color: rgba(255,255,255,0.001);'><div class='grid_number'>16</div></div>

						<img id='translr' src='images/starmap/zoomlr_trans.jpg' />
						<img id='transud' src='images/starmap/zoomud_trans.jpg' />
						<img id='csv1' src='images/starmap/newgalaxyfull.jpg' />
						<img id='trans' src='images/starmap/zoominout_trans.jpg' />
						<img id='csv2' src='images/starmap/galaxy2.jpg' />

						<div class='star_nav_containershade'></div>

						<img id='sm_planet_marker' src='images/fixed/glass_square.png' height='25' width='25' style='display:none; position:absolute; z-index: 44; left: 200px;top:200px;'/>
					</div>

					<div class='legend_panel' onclick='hideStarmapLegend()'>
						<div class='legend_heading'>Starmap Legend</div>
						<div class='legend_line'><img src='images/icons/prospected.png'> This cluster has been prospected.</div>
						<div class='legend_line'><img src='images/icons/prospecting.png'> This cluster is currently being prospected.</div>
						<div class='legend_line'><img src='images/icons/intel.png'> Active intelligence mission.</div>
						<div class='legend_line'><img src='images/icons/legend_player.png'>This is a player.</div>
						<div class='legend_line'><img src='images/icons/legend_memberhub.png'>This is a hub-player. If other members are closer to a hub-member, their lines will connect there instead of the alliance leader.</div>
						<div class='legend_line'><img src='images/icons/legend_allianceleader.png'>This is the alliance leader.</div>
						<div class='legend_line'><img src='images/icons/legend_alliancelink.png'>This is an alliance-link.</div>
						<div class='legend_line'><img src='images/icons/legend_outpost.png'>This is is one of your outposts.</div>
						<div class='legend_line'><img src='images/icons/legend_fleet.png'>This is a moving fleet.</div>
					</div>

					<div class='rulers_container' id='rulers_container'>
						<div class='rulers_header' id='rulers_header'>Rulers of the Galaxy</div>
						<div class='rulers_alliancename'>
							<div class='ruler_namecontent' id='ruling_aliance_name'>Honorverse of Quadrant 5</div>
						</div>
						<div class='rulers_icon'>
							<img id='ruling_alliance_avatar' src='images/fixed/shipbg_defence.png'>
						</div>
					</div>

					<div class='starmap_rank_container alliances'>
						<div class='starmap_rank_header'>Top 5 Alliances</div>
						<span id='starmap_alliance_rank_container'></span>
					</div>
					<div class='starmap_rank_container players'>
						<div class='starmap_rank_header' id='starmap_top_players'>Top 5 Players</div>
						<span id='starmap_player_rank_container'></span>
					</div>

					<div class='sector_info' id='sector_station_info'>
                    	<img class='sector_info_icon' src='images/fixed/sector_icon.png'>
                    	<div class='grid_info_top_heading' id='sector_view_sector_name'>Name</div>
                    	<div class='grid_info_subheading'>Sector Bonus</div>
                    	<div class='grid_info_entry' id='sector_view_sector_bonus'>Primary Firepower</div>
                    	<div class='grid_info_owner'>
                    		<div class='sector_info_alliance_name'  id='sector_view_alliance_name'>Owner</div>
                    		<div class='sector_info_alliance_avatar'><img  id='sector_view_sector_alliance_logo' src='images/icons/alliancepro.jpg'></div>
                    	</div>

                    	<div class='grid_info_desc'>
                    		<div class='sector_stations_container' id='sector_stations_container'>
                    			<div class='sector_stations_title'>Stations</div><div id='sector_stations_count' class='sector_stations_count'>2</div>
                    		</div>
                    		<div class='sector_bonus_desc' id='sector_bonus_desc'>Controlling this sector gives the owning alliance +10% primary firepower on all capital ships.</div>
                    	</div>
                    </div>

					<div class='cluster_info' id='cluster_station_info' >
                    	<img class='sector_info_icon' id='cluster_station_info_image'  src='images/fixed/cluster_station_main_icon.png'>
                    	<div class='grid_info_top_heading'>Cluster Station</div>
                    	<div class='grid_info_owner'>
                    		<div class='sector_info_alliance_name' id='cluster_view_owner_name' style='color: orange;'>Owner</div>
                    		<div class='sector_info_alliance_avatar'><img id='cluster_view_owner_avatar' src='images/icons/research/displacement_icon_placeholder.jpg'></div>
                    	</div>

                    	<div class='grid_info_desc'>
                    		<div class='sector_stations_container'>
                    			<div class='sector_stations_title'>Strength</div><div id='cluster_view_station_strength' class='sector_stations_count'>Unknown</div>
                    		</div>
                    		<div class='sector_bonus_desc' id='cluster_bonus_desc'>A successful attack on this station will give you control of it.</div>
                    	</div>
                    </div>

					<div class='homebutton' title='Link to homeworld' onclick='zoomToHomeworld()' id='homebutton'>
						<div class='home_title'>HOME</div>
					</div>
					<div class='starmap_blue_container view_selection'><div class='map_overlay_header'>Map Overlays</div>
						<div style='cursor:pointer;' class='map_overlay_selection selected' id='sm_layer_toggle_topalliances' onclick='toggleStarmapOverlay(1)'>Top Alliances</div>
						<div style='cursor:pointer;' class='map_overlay_selection selected' id='sm_layer_toggle_myalliance' onclick='toggleStarmapOverlay(2)'>My Alliance</div>
						<div style='cursor:pointer;' class='map_overlay_selection selected' id='sm_layer_toggle_highconflict' onclick='toggleStarmapOverlay(3)'>High Conflict</div>
						<div style='cursor:pointer;' class='map_overlay_selection' id='sm_layer_toggle_none' onclick='toggleStarmapOverlay(4)' onclick='clearAllStarmapOverlayFlags();renderMapData("nodelay");'>Clear</div>
					</div>

					<div class='starmap_blue_container prospecting' id='starmap_blue_container'>
						<img src='images/icons/prospect100.png' class='prospect_img'>
						<div id='prospect_time' class='prospect_time'></div>
						<span class='prospect_txt'>Prospect from Cluster View.<br>Prospecting shows occurrence of resources for each planet.</span>
						<div class='lightbutton160 prospect_cluster_button' id='prospect_cluster_button' onclick='prospectCluster()' >
							<div class='buttontext24' id='prospect_cluster_button_text'>Prospect Now</div>
						</div>
						<div class='lightbutton160' id='show_prospect_list' style='display: inline-block;' onclick='showProspectList()'>
							<div class='buttontext24'>Prospect List</div>
						</div>
					</div>

				</div>

				<div class='link_note prospecting' id='prospecting_list'>
					<div class='link_note_container prospecting'>
						<div class='prospect_heading'>Prospecting...</div>
						<span id='current_prospecting_missions_container'>
						</span>
					</div>
					<div class='link_note_container prospecting pr_comp'>
						<div class='prospect_heading'>Completed</div>
						<span id='completed_prospecting_missions_container'>
						</span>
					</div>
					<div class='lightbutton160 close_prospect_list' id='hide_prospecting_list'  onclick='hideProspectList()'>
						<div class='buttontext24'>Close</div>
					</div>
					<div class='link_note_prospect_list_help'>Click on coordinates to go to propecting location.</div>
				</div>

				<div class='link_note' id='link_note'>
					<div class='link_note_container'>
						<input id='starmap_player_link_head' class='link_note_header input_styling' value='Note Header' maxlength='20'/><input type='hidden' name='starmap_player_link_hidden_id' id='starmap_player_link_hidden_id' value='0'/>
						<textarea id='starmap_player_link_body' name='limitedtextarea' class='link_note_entry input_styling' onkeydown="limitText(this.getAttribute('id'),'link_note_counter',360)" onkeyup="limitText(this.getAttribute('id'),'link_note_counter',360)"></textarea>
						<div class='link_actions'>
							<input class='link_note_counter' id='link_note_counter' readonly='' type='text' name='countdown' value='360'/>
							<div class='link_note_counter_text'>characters left.</div>
						</div>
						<div class='link_actions'>
							<div class='lightbutton160 link_save' id='save_link_note' onclick='saveMapLinkInfo()'>
								<div class='buttontext24'>Save Note</div>
							</div>
							<div class='delete_link' onclick='deletePlayerLinkClick()'><img src='images/fixed/cancel.png'></div>
						</div>
					</div>
				</div>

			</div> <!-- Starmap Container Universe sans Sol -->
			<div class='systemcontainer'>
				<div class='planetlist_04' id='planetlist'>
					<div class='solrings' id='solrings'>
						<img src='images/fixed/fullsol5.jpg' class='solrings_01_bg' id='solrings_image' />
					</div>
					<canvas id='sol_canvas' width='520' height='520'></canvas>
					<div class='system_prospect_container' id='system_prospect_container' >
						<img src='images/icons/prospect100.png' >
						<div class='lightbutton140_double green' id='prospect_cluster_from_system_button' onclick='prospectClusterFromSystem()'>
							<div class='buttontext24' id='prospect_cluster_from_system_button_text'>Prospect Now</div>
						</div>
					</div>
					<!-- content will be added here when rendering the system -->
					<div class='solplanet_container planet_1' id='planetSelect1' >
						<img class='solplanet_image planet_1' src='images/homeworlds/starmap_planets/planet_01.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_2' id='planetSelect2'>
						<img class='solplanet_image planet_2' src='images/homeworlds/starmap_planets/planet_02.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_3' id='planetSelect3'>
						<img class='solplanet_image planet_3' src='images/homeworlds/starmap_planets/planet_03.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_4' id='planetSelect4'>
						<img class='solplanet_image planet_4' src='images/homeworlds/starmap_planets/planet_04.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_5' id='planetSelect5'>
						<img class='solplanet_image planet_5' src='images/homeworlds/starmap_planets/planet_05.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_6' id='planetSelect6'>
						<img class='solplanet_image planet_6' src='images/homeworlds/starmap_planets/planet_06.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_7' id='planetSelect7'>
						<img class='solplanet_image planet_7' src='images/homeworlds/starmap_planets/planet_07.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_8' id='planetSelect8'>
						<img class='solplanet_image planet_8' src='images/homeworlds/starmap_planets/planet_08.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_9' id='planetSelect9'>
						<img class='solplanet_image planet_9' src='images/homeworlds/starmap_planets/planet_09.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_10' id='planetSelect10'>
						<img class='solplanet_image planet_10' src='images/homeworlds/starmap_planets/planet_17.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_11' id='planetSelect11'>
						<img class='solplanet_image planet_11' src='images/homeworlds/starmap_planets/planet_08.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_12' id='planetSelect12'>
						<img class='solplanet_image planet_12' src='images/homeworlds/starmap_planets/planet_12.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_13' id='planetSelect13'>
						<img class='solplanet_image planet_13' src='images/homeworlds/starmap_planets/planet_15.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_14' id='planetSelect14'>
						<img class='solplanet_image planet_14' src='images/homeworlds/starmap_planets/planet_22.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_15' id='planetSelect15'>
						<img class='solplanet_image planet_15' src='images/homeworlds/starmap_planets/planet_18.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>

					<div class='solplanet_container planet_16' id='planetSelect16' >
						<img class='solplanet_image planet_16' src='images/homeworlds/starmap_planets/planet_01.png' />
						<div class='solplanet_label op'>
							<span class='sol_hw_name'>If you see</span>
							<span class='sol_hw_player'>This Text</span>
							<span class='sol_hw_alliance'>(Log in again)</span>
						</div>
					</div>


				</div>

			</div> <!-- Planet Listing -->
			<div class='starmap_tracker'>
				<div class='mapcoords' id='coords'>
					<span onclick='coordsClick()' style='cursor:alias;' id='coordlist'></span>
				</div>
				<div class='starmapheader' style='display: none;'>THE STARMAP</div>
				<div class='mapviewlevelindicator' id='mapviewlevelindicator' aria-live='polite'>Galaxy View</div>

				<div class='zoomslidercontainer' style='position: absolute;top: 2px; right: 0px;overflow: hidden;width: 227px;height: 50px;' id='map_nav_container'>
					<div class='zoomlevelslider' style='height: 50px;position: absolute; left: 227px; width: 227px;'>
						<img src='images/icons/mapzoomgalaxy.png' class='navbutton'  title='Zoom out to view the entire galaxy' id='nav_to_galaxy' style='position: absolute; top: 0px; left: 0px; height: 50px; width: 60px;' onclick='zoomInTo();' />
				   		<img src='images/icons/mapzoomquadrant.png' class='navbutton' title='Zoom out to view the entire quadrant' id='nav_to_quadrant' style='position: absolute;top: 0px;left: 49px;height: 50px;width: 70px;' onclick='zoomInTo(ad2460.starmap.quadrantSquare);' />
				   		<img src='images/icons/mapzoomsector.png' class='navbutton' title='Zoom out to view the entire sector' id='nav_to_sector' style='position: absolute;top: 0px;left: 108px;height: 50px;width: 70px;' onclick='zoomInTo(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare);' />
				   		<img src='images/icons/mapzoomcluster.png' class='navbutton'  title='Zoom out to view the entire cluster' id='nav_to_cluster' style='position: absolute;top: 0px;left: 167px;height: 50px;width: 60px;' onclick='zoomInTo(ad2460.starmap.quadrantSquare,ad2460.starmap.sectorSquare,ad2460.starmap.clusterSquare);' />
			   		</div>
				</div>

			</div>
			<!-- Starmap Location Info -->

			<!-- Universe view -->
			<div class='universeview' id='universeview'> <!-- Universe View -->
				<div class='starmap_side_header links' id='sidebar_toggle_links'>Links</div>
				<div class='starmap_side_header search' id='sidebar_toggle_search'>Search</div>
				<div class='sidebar_selection_line_01' id='sidebar_selection_line_01'></div>
				<div class='sidebar_selection_line_02' id='sidebar_selection_line_02'></div>

				<div class='starmap_search_panel' id='starmap_search_panel'>
					<div class='starmap_search_results_headers' id='seachresultplayers'>Players</div>
					<div class='starmap_search_results_headers' id='seachresultalliances'>Alliances</div>
					<div class='starmap_search_results_headers' id='seachresultplanets'>Planets</div>
					<div class='starmap_searchline_container'>
						<div class='starmap_searchline' id='searchline'></div>
						<div class='starmap_searchline_link' id='searchline_link'></div>
						<div class='starmap_result_container_top'></div>
					</div>
					<div class='starmap_search_result_container' id='searchplayers'>
						<div class='starmap_search_input_container'>
							<input class='create_alliance_name starmap_search' id='starmap_search_input_player' value=''/>
								<div class='lightbutton160' id='initiate_starmap_search' onclick="searchUniverseClick('player')">
								<div class='buttontext24'>Search</div>
							</div>
						</div>
						<div class='starmap_side_header results'>Search Results</div>
						<div class='starmap_result_nav_up' id='search_player_scroll_up' onmousedown='return false' onclick="myScroll('sm_search_player_scroller',252,800)"></div>
						<div class='starmap_search_wrapper' id='player_search_wrapper'>
							<div class='search_scroller' id='sm_search_player_scroller'>

							</div>
						</div>
						<div class='starmap_result_nav_down' id='search_player_scroll_down' onmousedown='return false' onclick="myScroll('sm_search_player_scroller',-252,800)"></div>
					</div>
					<div class='starmap_search_result_container' id='searchalliances' style='display: none;'>
						<div class='starmap_search_input_container'>
							<input class='create_alliance_name starmap_search' id='starmap_search_input_alliance' value=''/>
								<div class='lightbutton160' id='initiate_starmap_search' onclick="searchUniverseClick('alliance')">
								<div class='buttontext24'>Search</div>
							</div>
						</div>
						<div class='starmap_side_header results'>Search Results</div>
						<div class='starmap_result_nav_up' id='search_alliance_scroll_up' onmousedown='return false' onclick="myScroll('sm_search_alliance_scroller',252,800)"></div>
						<div class='starmap_search_wrapper' id='alliance_search_wrapper'>
							<div class='search_scroller' id='sm_search_alliance_scroller'>

							</div>
						</div>
						<div class='starmap_result_nav_down' id='search_alliance_scroll_down' onmousedown='return false' onclick="myScroll('sm_search_alliance_scroller',-252,800)"></div>
					</div>
					<div class='starmap_search_result_container' id='searchplanets' style='display: none;'>
						<div class='starmap_search_input_container'>
							<input class='create_alliance_name starmap_search' id='starmap_search_input_planet' value=''/>
								<div class='lightbutton160' onclick="searchUniverseClick('planet')">
								<div class='buttontext24'>Search</div>
							</div>
						</div>
						<div class='starmap_side_header results'>Search Results</div>
						<div class='starmap_result_nav_up' id='search_planet_scroll_up' onmousedown='return false' onclick="myScroll('sm_search_planet_scroller',252,800)"></div>
						<div class='starmap_search_wrapper' id='planet_search_wrapper'>
							<div class='search_scroller' id='sm_search_planet_scroller'>

							</div>
						</div>
						<div class='starmap_result_nav_down' id='search_planet_scroll_down' onmousedown='return false' onclick="myScroll('sm_search_planet_scroller',-252,800)"></div>
					</div>
				</div>

				<div class='starmap_search_panel' id='starmap_link_panel' style='position: absolute; opacity: 0;'>
					<div class='starmap_link_container'>
						<div class='starmap_result_nav_up' id='starmap_link_scroll_up' onmousedown='return false' onclick="myScroll('link_scroller',420,800)"></div>
						<div class='starmap_link_wrapper' id='link_wrapper'>
							<div class='link_scroller' id='link_scroller'>
								<div class='starmap_entryline' id='link_01'>
									<div class='linkname'>Jimmy's located at</div>
									<div class='linkcoords'>[ 1:12:4:2.4 ]</div>
								</div>
							</div>
						</div>
						<div class='starmap_result_nav_down' id='starmap_link_scroll_down' onmousedown='return false' onclick="myScroll('link_scroller',-420,800)"></div>
					</div>
				</div>
			</div>
			<!-- Universe view -->

			<!-- Side Panel -->
			<div id='planetviewcontainer' class='planetview_01'>

				<div id='viewerplanet1' class='viewplanetn'><img id='viewerplanetimg1' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet2' class='viewplanetn'><img id='viewerplanetimg2' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet3' class='viewplanetn'><img id='viewerplanetimg3' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet4' class='viewplanetn'><img id='viewerplanetimg4' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet5' class='viewplanetn'><img id='viewerplanetimg5' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet6' class='viewplanetn'><img id='viewerplanetimg6' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet7' class='viewplanetn'><img id='viewerplanetimg7' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet8' class='viewplanetn'><img id='viewerplanetimg8' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet9' class='viewplanetn'><img id='viewerplanetimg9' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet10' class='viewplanetn'><img id='viewerplanetimg10' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet11' class='viewplanetn'><img id='viewerplanetimg11' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet12' class='viewplanetn'><img id='viewerplanetimg12' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet13' class='viewplanetn'><img id='viewerplanetimg13' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet14' class='viewplanetn'><img id='viewerplanetimg14' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet15' class='viewplanetn'><img id='viewerplanetimg15' src='images/planets/planettype01.png' height='400' width='400' /></div>
				<div id='viewerplanet16' class='viewplanetn'><img id='viewerplanetimg16' src='images/planets/planettype01.png' height='400' width='400' /></div>

				<div id='starmap_planetinfo' class='planetinfo'>
					<div class='planetinfo_headerline'>
						<div class='planetinfo_header' >
							<span class='planetinfo_planetname' id='sm_pi_planetname'></span>
							<span class='planetinfo_player' id='sm_pi_ownername'></span>&nbsp;<span id='sm_pi_alliancename' class='planetinfo_alliance'></span>
						</div>
					</div>
					<div class='planet_status' id='starmap_grace_indicator' style='display:none;'>
                    	<img class='planet_status_icon' id='planet_status_icon' src='images/icons/grace_icon.png'>
                        <div class='planet_status_text' id='planet_status_text'>Player is in grace-time and cannot be attacked at this time.</div>
                    </div>
					<div class='planet_status' id='inactive_station_indicator' style='display:none; height:55px;'>
						<div class='planet_status_text' id='inactive_station_text' style='padding-left:15px;font-size:13px;'>This ancient station is inactive and we have found no meaningful way of interacting with it yet.</div>
					</div>
					<div class='espionage_field'>
						<div class='espionage_field_container'>
							<div class='espionage_activation' id='start_scout' onclick='setupStarmapIntelPanel(1)'>
								<div class='espionage_inteltype'>Scout (<span id='live_scout_counter'></span>)</div>
								<div class='espionage_intelcost'></div>
								<div class='espionage_inteltime' id='sm_spypanel_scout_time'>15m</div>
							</div>
							<div class='espionage_activation' id='start_spy'  onclick='setupStarmapIntelPanel(2)'>
								<div class='espionage_inteltype'>Espionage (<span id='live_espionage_counter_active'></span>/<span id='live_espionage_counter_available'></span>)</div>
								<div id='espionage_available' class='espionage_intelcost'></div>
								<div class='espionage_inteltime' id='sm_spypanel_espionage_time'>8h</div>
							</div>
							<div class='espionage_activation' id='start_infiltration'  onclick='setupStarmapIntelPanel(3)'>
								<div class='espionage_inteltype'>Infiltration (<span id='live_infiltration_counter_active'></span>/<span id='live_infiltration_counter_available'></span>)</div>
								<div id='infiltration_available' class='espionage_intelcost'></div>
								<div class='espionage_inteltime' id='sm_spypanel_infiltration_time'>16h</div>
							</div>
							<div class='espionage_activation' id='sm_view_current_intel' onclick='viewLatestIntelOnSelectedPlanet()'>
                            	<div class='espionage_inteltype_done' style='width: 100%;'>View Current Intel</div>
                            </div>
							<div class='lightbutton160 red' id='quit_intel_op' onclick='closeEspionagePanel();hideEspionageOption();' style='margin-top: 2px;'>
								<div class='buttontext24'>Cancel</div>
							</div>
						</div>
					</div>

					<div class='planetinfo_claim' id='claim_planet_container' style='display:none;'>
						<div class='claim_slider' id='planet_claim_1'>
							<div class='claimtext_header' id='open_claim'>Claim Planet</div>
							<div class='claimtext_info' id='claimtext_info'>Click to select outpost</div>
							<div class='claim_select_outpost_type' id='basic_selected_outpost' onclick="claimSelectedOutpost('basic')"><img src='images/icons/outpost1.png' class='outpost_claim_icon outpost_1_img'>Basic Outpost (<span id='claim_basic_outpost_counter'>0</span>)</div>
							<div class='claim_select_outpost_type' id='advanced_selected_outpost' onclick="claimSelectedOutpost('advanced')"><img src='images/icons/outpost2.png' class='outpost_claim_icon outpost_2_img'>Advanced Outpost (<span id='claim_advanced_outpost_counter'>0</span>)</div>
							<div class='claim_select_outpost_type' id='superior_selected_outpost' onclick="claimSelectedOutpost('superior')"><img src='images/icons/outpost3.png' class='outpost_claim_icon outpost_3_img'>Superior Outpost (<span id='claim_superior_outpost_counter'>0</span>)</div>
							<div class='lightbutton160 red' id='quit_claim' onclick='closePlanetClaim()' style='margin-top: 5px;'>
								<div class='buttontext24'>Cancel</div>
							</div>
						</div>
					</div>

					<div class='planetinfo_claim' id='claim_station_container' style='display:none;' onclick="claimStation()">
						<div class='claim_slider' id='station_claim_1'>
							<div class='claimtext_header' id='station_open_claim'>Claim Station</div>
							<div class='claimtext_info' id='station_claimtext_info'>Claim this station for your alliance</div>
						</div>
					</div>

					<div class='bounty_issue_container' id='bounty_issue_container'>
						<div class='bounty_issue_slider' id='issue_bounty'>
							<div class='bounty_issue_header' id='open_bounty'>
								<div class='bounty_icon'></div>
								<div class='claimtext_header'>Place Bounty</div>
								<div class='claimtext_info' id='bounty_issue_help'>Click to place bounty</div>

							</div>
							<div id='place_bounty_inner_container'>
								<div class='bounty offer'>
									<div class='bounty_entry'>Offer credits:</div>
									<input class='bounty_input input_styling' id='credit_bounty_offer'>
								</div>
								<div class='strength_destroy'>
									<div class='bounty_entry'>For destroying:</div>
									<select class='bounty_input' id='bounty_destroy_amount'>
										<option value='0'>Select...</option>
										<option value='5'>5 000 STR</option>
										<option value='10'>10 000 STR</option>
										<option value='15'>15 000 STR</option>
										<option value='20'>20 000 STR</option>
										<option value='30'>30 000 STR</option>
										<option value='40'>40 000 STR</option>
										<option value='50'>50 000 STR</option>
										<option value='60'>60 000 STR</option>
										<option value='70'>70 000 STR</option>
										<option value='80'>80 000 STR</option>
										<option value='90'>90 000 STR</option>
										<option value='100'>100 000 STR</option>
										<option value='150'>150 000 STR</option>
										<option value='200'>200 000 STR</option>
									</select>
								</div>
								<div class='commit_bounty'>
									<div class='lightbutton160 green' id='initiate_bounty' onclick='issueBountyClick()'>
										<div class='buttontext24'>Place</div>
									</div>
								</div>
							</div>
							<div class='lightbutton160 red' id='cancel_bounty' onclick='closeBountyIssue()'>
								<div class='buttontext24'>Close</div>
							</div>
						</div>
					</div>

					<div class='planetinfo_iconline' style='z-index: 5;'>
                        <div title='Message the owner' style='position: relative; float:left; cursor: pointer; width:56px;' id='starmap_message' >
                        	<img src='images/icons/planet_chaticon_regular.png'>
                        </div>
                        <div title='Perform Intel-operations on this target' style='position: relative; float:left; cursor: pointer; width:54px;' id='starmap_spy'>
                        	<img src='images/icons/planet_spyicon_regular.png'>
                        </div>
                        <div title='Launch Attack' style='position: relative; float:left; cursor: pointer; width:56px;' id='sm_selectedPlanet_launch_button' onclick='launchSlide()'>
                        	<img src='images/icons/planet_attackicon_regular.png'>
                        </div>
                        <div title='Open the Player-info popup' style='position: relative; float:left; cursor: pointer; width:53px;' id='planet_player_info'>
                        	<img src='images/icons/planet_playerinfo_regular.png'>
                        </div>
                        <div title='Create a link / shortcut to this planet' style='position: relative; float:left; cursor: pointer; width:56px;' id='planet_link_button'>
                        	<img src='images/icons/planet_allianceinfo_regular.png' id='planet_link_image'>
                        </div>
                    </div>

					<div id='planetintel' class='planetinfo_intel selectable_text'>
						<div class='planetintel_info_title' id='sm_pi_planet_type_header'>Planet type</div>
						<div class='planetintel_info_entry' id='sm_pi_planet_type'></div>
						<div class='planetintel_info_title'>Est. traveltime:</div>
						<div class='planetintel_info_entry' id='sm_pi_estimated_traveltime'></div>
						<div id='sm_pi_planet_specific'>
							<div class='planetintel_info_title' >Player Level:</div>
							<div class='planetintel_info_entry' id='sm_pi_player_level'></div>
							<div class='planetintel_info_title' id='sm_pi_player_strength_title'>Player Strength:</div>
							<div class='planetintel_info_entry' id='sm_pi_player_strength'></div>
						</div>
						<div id='sm_pi_station_specific' style='display:none'>
							<div class='planetintel_info_title'>Bonus:</div>
							<div class='planetintel_info_entry' id='sm_pi_bonus'></div>
							<div class='planetintel_info_title'>Station Strength:</div>
							<div class='planetintel_info_entry' id='sm_pi_alliance_strength'></div>
						</div>
						<div class='planetintel_header'>Gathered Information</div>
						<div class='planetintel_update_time' id='sm_pi_last_update'></div>
						<div class='planetintel_info_title'>Present Strength</div>
						<div class='planetintel_info_entry' id='sm_pi_firepower_present'></div>
						<div class='planetintel_info_title'>Capital Ships</div>
						<div class='planetintel_info_entry' id='sm_pi_ships_present'></div>
						<div class='planetintel_info_title'>Minor Ships</div>
						<div class='planetintel_info_entry' id='sm_pi_minor_ships_present'></div>

						<div class='planetintel_info_title'>Present Cannons</div>
						<div class='planetintel_info_entry' id='sm_pi_cannons_present'></div>
						<div class='planetintel_info_title'>Present Shieldboosters</div>
						<div class='planetintel_info_entry' id='sm_pi_shieldgens_present'></div>
						<div class='planetintel_info_title'>Present Artillery</div>
						<div class='planetintel_info_entry' id='sm_pi_artillery_present'></div>
						<div class='planetintel_info_title'>Present Stations</div>
						<div class='planetintel_info_entry' id='sm_pi_stations_present'></div>

						<!-- Spacer 1-->
						<div class='planetintel_info_title' style='height:5px;'></div>		<div class='planetintel_info_entry' style='height:5px;'></div>

						<div class='planetintel_info_title'>Stored Hassium:</div>
						<div class='planetintel_info_entry' id='sm_pi_stored_hassium'></div>
						<div class='planetintel_info_title'>Stored Indium:</div>
						<div class='planetintel_info_entry' id='sm_pi_stored_indium'></div>
						<div class='planetintel_info_title'>Stored Strontium:</div>
						<div class='planetintel_info_entry' id='sm_pi_stored_strontium'></div>
						<div class='planetintel_info_title'>Stored Neodymium:</div>
						<div class='planetintel_info_entry' id='sm_pi_stored_neodymium'></div>
						<div class='planetintel_info_title' style='height:5px;'></div>
						<div class='planetintel_info_entry' style='height:5px;'></div>
						<div class='planetintel_info_title' id='sm_pi_outpost_level_header'>Outpost Level:</div>
						<div class='planetintel_info_entry' id='sm_pi_outpost_level'>Superior Level 1</div>
						<div class='planetintel_info_title' id='sm_pi_outpost_current_output_header'>Current Output:</div>
						<div class='planetintel_info_entry' id='sm_pi_outpost_current_output'>145.000 u/hr</div>
						<div class='planetintel_info_title' id='sm_pi_outpost_resource_tilt_header'>Resource Tilt:</div>
						<div class='planetintel_info_entry' id='sm_pi_outpost_resource_tilt'>Neodymium</div>
						<div class='planetintel_info_title' id='sm_pi_outpost_output_potential_header'>Output Potential</div>
						<div class='planetintel_info_entry' id='sm_pi_outpost_output_potential'>Extremely High</div>

						<!-- Spacer 2-->
						<div class='planetintel_info_title' id='spacer_2_title'></div> 		<div class='planetintel_info_entry'  id='spacer_2_entry'></div>

						<!--<div class='planetintel_header' id='planet_add_info' style='cursor:pointer;'>Additional Information (0)</div>-->

						<div class='starmap_challenge_container' id='starmap_challenge_container' style='display: block;	width: 100%; text-align: center; float: left;'>
							<div class='planetintel_header'>Challenge to Wargame</div>
							<select id='starmap_challenge_fleet_dropdown'></select>
							<div class='starmap_challenge_button' id='starmap_challenge_button' onclick='starmapWargameChallengeClick()' >Challenge</div>
						</div>


					</div>



				</div>
			</div> <!-- Planet Viewer -->


			<div class='slide_label'><div class='slide_heading'>The Starmap</div></div>

			<!-- Notes -->
				<div class='starmap_notes' id='notes' style='display: none;'>
					<div class='starmap_side_header'>Map Links</div>
					<div class='starmap_link_container'>
						<div class='starmap_nav_up'></div>
						<div class='starmap_link_wrapper'>

						</div>
						<div class='starmap_nav_down'></div>
					</div>

					<div class='starmap_side_header new_note'>Create link</div>
					<div class='lightbutton160' id='zoom_to_button' style='margin-left: 25px;'>
					   	<div class='buttontext24'>Link Here</div>
					</div>
				   <span style='display:block; margin: 10px; margin-left: 15px; font-style:italic;'> Press 'link here' to create a link to the current view.</span>
					<div class='starmap_side_header direct_link'>Direct Zoom</div>
					<input class='input_styling_dark direct_zoom_input' />
					<input class='input_styling_dark direct_zoom_input' />
					<input class='input_styling_dark direct_zoom_input' />
					<input class='input_styling_dark direct_zoom_input' />
					<input class='input_styling_dark direct_zoom_input' />
					<div class='lightbutton160' id='zoom_to_button' style='margin-left: 25px;'>
					   	<div class='buttontext24'>Zoom</div>
					</div>
				</div>
			<!-- Notes -->
		</div>
		<!-- End Star Map Slide -->

	
	<div class='forumslide missionslide' id='missionslide'>
		<div class='slide_label'>
			<div class='slide_heading'>Mission Preparation</div>
		</div>
		<div class='missionslide_container' id='missionslide_container'>
		<!-- This is where the content goes -->
		</div>
	</div>
	

		<div class='forumslide mission_summary_slide' id='mission_summary'>
			<div class='slide_label'>
				<div class='slide_heading' id='m_s_heading'>Mission Summary</div>
			</div>
			<div class='mission_box mission_result'>
				<span class='mission_text_heading'  id='m_s_result_heading'>Mission Result</span>
				<div class='mission_pack_sum' id='m_s_result_packname'></div>
				<div class='mission_name_sum' id='m_s_result_missionname'></div>
				<img id='m_s_mission_type_image' src='images/fixed/scout_icon.png'>
				<div class='mission_requirement_met' id='m_s_result' >Mission Successful!</div>
			</div>
			<div class='mission_box mission_wrapup'>
				<span class='mission_text_heading'>Mission Wrapup</span>
				<div class='mission_scrollcontainer'>
					<span class='mission_text_body' id='m_s_mission_complete_text'>The mission was a resoundig success...</span>
				</div>
				<div class='mission_scroller_bottom_shade'></div>
			</div>
			<div class='mission_box used_battle_tactics' id='m_s_middle_combat_1' style='display: none;'>
				<span class='mission_text_heading'>Used Tactical Settings</span>
				<div class='used_tacticals'>
					<div class='tactical_setting_header'>Target Priority</div>
					<div class='tactical_setting_entry' id='m_s_tac_tp'>Most Firepower</div>
					<div class='tactical_setting_header'>Target Switching</div>
					<div class='tactical_setting_entry' id='m_s_tac_ts'>No Switch</div>
					<div class='tactical_setting_header'>Fighter Priority</div>
					<div class='tactical_setting_entry' id='m_s_tac_fp'>Ship-to-ship</div>
					<div class='tactical_setting_header'>Corvette Priority</div>
					<div class='tactical_setting_entry' id='m_s_tac_cp'>Offensive</div>
					<div class='tactical_setting_header'>Retreat Condition</div>
					<div class='tactical_setting_entry' id='m_s_tac_rc'>At 60% of <br>available Firepower</div>
					<div class='tactical_setting_header'>But if losses are even...</div>
					<div class='tactical_setting_entry' id='m_s_tac_even'>Stay and Fight</div>
					<div class='tactical_setting_header'>If unwinnable?</div>
					<div class='tactical_setting_entry' id='m_s_tac_unwin'>Yes.</div>
				</div>
			</div>

			<div class='mission_box mission_combat_box' id='m_s_middle_combat_2' style='display: none;'>
				<span class='mission_text_heading'>Combat Summary</span>
				<div class='shiptypes typeheader'>Shiptype</div>
				<div class='shiptotal typeheader'>Total</div>
				<div class='shiplosses typeheader'>Lost</div>
				<div class='shiptypes'>Frigates</div>
				<div class='shiptotal' id='m_s_bat_tot_fr'>30</div>
				<div class='shiplosses' id='m_s_bat_lost_fr'>21</div>
				<div class='shiptypes'>Cruisers</div>
				<div class='shiptotal' id='m_s_bat_tot_cr'>30</div>
				<div class='shiplosses' id='m_s_bat_lost_cr'>21</div>
				<div class='shiptypes'>Battleships</div>
				<div class='shiptotal' id='m_s_bat_tot_bs'>30</div>
				<div class='shiplosses' id='m_s_bat_lost_bs'>21</div>
				<div class='shiptypes'>Carriers</div>
				<div class='shiptotal' id='m_s_bat_tot_ca'>30</div>
				<div class='shiplosses' id='m_s_bat_lost_ca'>21</div>
				<div class='shiptypes'>Utility</div>
				<div class='shiptotal' id='m_s_bat_tot_ut'>30</div>
				<div class='shiplosses' id='m_s_bat_lost_ut'>21</div>
				<div class='shiptypes'>Transports</div>
				<div class='shiptotal' id='m_s_bat_tot_tr'>30</div>
				<div class='shiplosses' id='m_s_bat_lost_tr'>21</div>
				<div class='shiptypes'>Fighters</div>
				<div class='shiptotal' id='m_s_bat_tot_fi'>30</div>
				<div class='shiplosses' id='m_s_bat_lost_fi'>21</div>
				<div class='shiptypes'>Corvettes</div>
				<div class='shiptotal' id='m_s_bat_tot_co'>30</div>
				<div class='shiplosses' id='m_s_bat_lost_co'>21</div>
				<div class='lightbutton160 mission_battle_button' id='m_s_view_combat_button'>
					<div class='buttontext24'>View Combat</div>
				</div>
				<span class='mission_text_heading' style='margin-top:6px;'>Previous Attempts</span>
				<div class='previous_mission_battles' id='previous_mission_battles'></div>
			</div>
			<div class='mission_white_box scouts used_scouts' id='m_s_middle_scouting_1' style='display: none;'>
				<span class='mission_text_heading' id='m_s_allocation_heading'>Allocated Scouts</span>
				<img src='images/planets/notification/notify_scout.jpg' id='m_s_allocation_image' class='spy_slider_image' style='left: 25%; margin-left: -60px; top: 25px;'>
				<div class='bonuspane_counter' style=' top: 10px; right: 40px;'>
					<div class='bonuspane_bonuses' style=' box-shadow: inset 0px 0px 10px black; background: rgba(0,0,0,0.5);height: 120px; width: 80px;' id='m_s_agents_used'>3</div>
				</div>
			</div>
			<div class='mission_box scout_settings used_setting' id='m_s_middle_scouting_2' style='display: block;'>
				<span class='mission_text_heading'>Active Setting</span>
				<div class='mission_option_set_container' id='m_s_scouting_selected_option_container'>
					<div class='mission_options_list scout_option selected'>
						<span class='mission_option_inner_header' id='m_s_choice_selected'>?</span>
						<span class='mission_option_description' id='m_s_choice_selected_description'>?</span>
					</div>
				</div>
				<div class='mission_scroller_bottom_shade'></div>
			</div>
			<div class='mission_box selected_commander used_commander' id='m_s_middle_diplomacy_1' style='display: none;'>
				<span class='mission_text_heading'>Selected Commander</span>
				<div class='mission_commander_list_entry'>
					<div class='mission_commander_list_image'>
						<img class='selected_commander_bg' id='m_s_commander_img_bg' src='../images/commanders/comm_bg_01.jpg'>
						<img class='selected_commander_uniform' id='m_s_commander_img_uniform' src='../images/commanders/female/rank01.png'>
						<img class='selected_commander_head' id='m_s_commander_img_head' src='../images/commanders/female/heads/f01r01.png'>
					</div>
					<div class='mission_commander_stats'>
						<div class='mission_commander_namerank' id='m_s_commander_namerank'>Fleet Major Biana</div>
						<div class='commander_select_personality' id='m_s_commander_personality'>Zelot</div>
						<div class='commander_select_statname' >Commanding:</div><div id='m_s_commander_commanding' class='commander_select_statvalue'>100</div>
						<div class='commander_select_statname' >Perception:</div><div id='m_s_commander_perception' class='commander_select_statvalue'>100</div>
						<div class='commander_select_statname' >Tactics:</div><div id='m_s_commander_tactics' class='commander_select_statvalue'>100</div>
						<div class='commander_select_statname' >Morale</div><div id='m_s_commander_morale' class='commander_select_statvalue'>100</div>
					</div>
				</div>
			</div>
			<div class='mission_box diplomatic_options used_commander_setting' id='m_s_middle_diplomacy_2' style='display: none;'>
				<span class='mission_text_heading'>Diplomatic Strategy</span>
				<div class='mission_option_set_container' id='m_s_diplomacy_selected_option_container'>
					<div id='opt_01_02' class='mission_options_list scout_option selected'>
						<span class='mission_option_inner_header' id='m_s_diplomatic_choice_selected'>?</span>
						<span class='mission_option_description'  id='m_s_diplomatic_choice_selected_description'>?</span>
					</div>
				</div>
				<div class='mission_scroller_bottom_shade'></div>
			</div>

			<div class='mission_box end_rewards' id='m_s_rewards_container'>
				<span class='mission_text_heading'>Mission Rewards</span>
				<div class='mission_no_rewards' id='m_s_no_rewards' style='display:none'>There are no rewards for failure.</div>
				<div class='mission_scrollcontainer' id='m_s_rewards_content' style='text-align: center; margin-left:1px;'>
					<div class='xp_header'>Experience Points</div>
					<div class='xp_counter' id='m_s_reward_xp'>9.999.000</div>
					<div class='mission_reward_container' id='m_s_reward_unit_container_1'>
						<img class='reward_img' src='images/icons/production/435.jpg' id='m_s_reward_unit_image_1'>
						<div class='reward_counter' id='m_s_reward_unit_counter_1'>2</div>
					</div>
					<div class='mission_reward_container' id='m_s_reward_unit_container_2'>
						<img class='reward_img' src='images/icons/production/435.jpg' id='m_s_reward_unit_image_2'>
						<div class='reward_counter' id='m_s_reward_unit_counter_2'>2</div>
					</div>
					<div class='mission_reward_container' id='m_s_reward_unit_container_3'>
						<img class='reward_img' src='images/icons/production/435.jpg' id='m_s_reward_unit_image_3'>
						<div class='reward_counter' id='m_s_reward_unit_counter_3'>2</div>
					</div>
					<div class='mission_reward_container' id='m_s_reward_unit_container_4'>
						<img class='reward_img' src='images/icons/production/435.jpg' id='m_s_reward_unit_image_4'>
						<div class='reward_counter' id='m_s_reward_unit_counter_4'>2</div>
					</div>
					<div class='outpost_levels mission'>
						<div class='resouce_level hs_level' id='m_s_reward_hs'>128.635</div>
						<div class='resouce_level sr_level' id='m_s_reward_sr'>40.127</div>
						<div class='resouce_level nd_level' id='m_s_reward_nd'>61.842</div>
						<div class='resouce_level in_level' id='m_s_reward_in'>5.689</div>
					</div>
				</div>
				<div class='mission_effect_container' style='display:none;'>
					<div class='mission_option_inner_header'>Mission Effect</div>
					<div class='mission_option_description'>N/A</div>
				</div>
				<div class='mission_scroller_bottom_shade'></div>
			</div>

			<!--<div class='lightbutton160' style='position: absolute; bottom: 7px; left: 760px;' onclick='hideMissionSummarySlide()'>
				<div class='buttontext24'>Close</div>
			</div>-->
		</div>
	
       <!-- Forum Slides -->
		<!-- First, the forums -->
		<div id='forumcategories' class='forumslide'>

			<div class='forumpanel' ></div>
			<div class='forumheader'>The Forums</div>
			<div class='forumheader_active'>My recent threads</div>
			<div class='forumcategorycontainer'>
			<div class='categories_recent_threads' id='my_recent_threads_container'></div>
	
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(11)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/fs_button.png' alt=''/>Announcements</div>
					<div class='categorydescription'>Here we will post official announcements about patches and other important pieces of information.</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(5)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/question_button.png' alt=''/>Questions</div>
					<div class='categorydescription'>Ask your questions about the game here.</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(1)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/gen_button.png' alt=''/>General discussions</div>
					<div class='categorydescription'>Talk about the game, the tricks of the trade, brag about your achievements and share experiences.</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(9)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/alliance_button.png' alt=''/>Alliance Recruitment</div>
					<div class='categorydescription'>A forum where alliances can promote themselves to recruit new members.</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(2)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/gen_button.png' alt=''/>Feedback</div>
					<div class='categorydescription'>Share your feedback about AD2460, and we will listen.</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(3)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/tech_button.png' alt=''/>Technical</div>
					<div class='categorydescription'>If you have technical issues with the game, please share them here so we can assist.</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(4)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/tech_button.png' alt=''/>Bugs</div>
					<div class='categorydescription'>Report bugs with the game here, there should be plenty!</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(6)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/sugg_button.png' alt=''/>Suggestions</div>
					<div class='categorydescription'>We would love to hear your suggestions for AD2460!</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(7)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/offtopic_button.png' alt=''/>Off-topic discussions</div>
					<div class='categorydescription'>Here you can discuss whatever you want as long as it does not violate the rules.</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(8)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/alliance_button.png' alt=''/>Alliance-forums</div>
					<div class='categorydescription'>This is a private forum for your alliance.</div>
				</div>
				<!-- End Per forum -->
		
				<!-- Per forum -->
				<div class='categorylink' onclick='forumClick(10)'>
					<div class='categorylink_top_border'></div>
					<div class='categorylink_bottom_border'></div>
					<div class='categorylink_left_border'></div>
					<div class='categorylink_right_border'></div>
					<div class='categoryname'><img class='categoryicon' src='images/forumbuttons/alliance_button.png' alt=''/>Galactic Alliance Discussion</div>
					<div class='categorydescription'>A forum where alliances can discuss public affairs.</div>
				</div>
				<!-- End Per forum -->
		
			</div>

			<div id='showforumcategories' class='slide_label' onclick='closeThreadPanel()'><div class='slide_heading'>Categories</div></div>
		</div>
		<!-- End of forums listing -->
		<!-- Now the thread-listing container stuff -->
		<div id='forumthreads' class='threadsslide'>
			<div class='bigscroller_up' id='threadscontainer_up' onclick="myScroll('threadscontainer',200,200)"></div>
			<div class='bigscroller_down' id='threadscontainer_down' onclick="myScroll('threadscontainer',-200,200)"></div>
			<div class='forumheader' id='forumheader'><!--forum header goes here once selected--></div>
			<!--<button id='newthreadbutton' style='position: absolute; top: 550px; width: 180px; left: 50px;'>Create New Thread</button> -->

			<div class='forum_threads_middle_container'>

				<div class='thread_list_heading'>
					<div class='threadcol tcol1'>Thread Name</div>
					<div class='threadcol tcol2'>Icon</div>
					<div class='threadcol tcol3'>Posts</div>
					<div class='threadcol tcol4'>Author</div>
					<div class='threadcol tcol5'>Last Post By</div>
					<div class='threadcol tcol6'>Time</div>
					<div class='threadcol tcol7'>Forum Moderator Tools</div>
				</div>

				<div id='threadsscroller' class='threadscroller'>
					<div id='threadscontainer' style='position:relative;top:0px;'>
					<!-- threads will be placed here -->
					</div>
				</div>
			</div>

			<!-- Here is the panel that pops up from below if you want to make a new thread... -->
			<div id='newthread' class='new_thread_panel' >
				<div class='new_thread_header' onclick='newThreadClick()'>Create New Thread</div>
				<div class='new_thread_name_header'>Subject</div>
				<div class='new_thread_subject_input_container'><input class='new_thread_subject_input' onkeyup='focusBodyIfTab(event)' id='new_thread_subject'/></div>
               <!--
				<div class='thread_type_heading'>Thread Type<br />
					<div style='float: left;'>
						<img src='images/fixed/radioselect.png' /><br />
						<img src='images/fixed/radiounselect.png' /><br />
						<img src='images/fixed/radiounselect.png' /><br />
						<img src='images/fixed/radiounselect.png' />
					</div>
					Normal<br />
					Annoucement<br />
					Recruitment<br />
					Moderated<br />
				</div>
				-->
				<div class='new_thread_body_heading'>Write Your Post Here</div>
				<div class='new_thread_body_container'><textarea class='new_thread_body_textarea' onfocus='checkForChatClosing()' id='new_thread_body'></textarea></div>
				<button id='threadsubmit' class='new_thread_submit_button' onclick='submitNewThreadClick()'>Submit New Thread</button>
			</div>
			<div id='showforumthreads' onclick='closePostPanel()' class='slide_label'><div class='slide_heading'>Threads</div></div>
		</div>
		<!-- End of thread-listing content -->
		<!-- Now, for the post-containers -->
		<div id='forumposts' class='postsslide'>
			<div id='postscontainer_up' class='bigscroller_up' onclick="myScroll('postscontainer',485,200)"></div>
			<div id='postscontainer_down' class='bigscroller_down' onclick="myScroll('postscontainer',-485,200)"></div>
			<div class='bigscroller_top'  onclick="myScroll('postscontainer',30000000,1000)"></div>
			<div class='bigscroller_bottom'  onclick="myScroll('postscontainer',-30000000,1000)"></div>

			<div id='postsscroller' style='position: absolute;	width: 670px; left: 0px; top: 40px;	height: 535px; overflow:hidden;'>
				<div class='postscontainer' id='postscontainer' style='position:relative;'>
					<!-- Posts will be placed here -->
				</div>
			</div>
			<div class='thread_heading' id='threadheader'>The Forum Posts</div>
			<div class='' style='position:absolute;top:3px;left:450px; width:32px;height:32px;background-image:url(images/fixed/forumfontsize.png);' id='forum_text_size' onclick='toggleForumTextSize()'>&nbsp;</div>
			<div class='thread_link_info' id='thread_link_info' onclick='threadLinkClick()'></div>
			<div class='thread_report_button' id='thread_report_button'></div>
			<div class='slide_label'><div class='slide_heading'>Posts</div></div>
			<!--
			<div id='postreply' class='postreplyslide'>
				<div class='postreplyheader'>Post Reply
					<div class='postreply_body_header'>Write Your Reply Here</div>
					<div class='postreply_textarea_container'><textarea id='post_reply_body' onfocus='checkForChatClosing()' class='postreply_textarea'></textarea></div>
					<button id='replysubmit' class='postreply_submit_button' onclick='postReplyClick()'>Post Reply</button>
				</div>
			</div>
			-->
		</div><!-- End Forum Slides -->
	
        <!-- Mail Slide -->
		<div class='conversationslide' id='mailslide'>
			<div class='conversationbg'>
				<div class='slide_label'><div class='slide_heading'>Conversations</div></div>
				<div class='convnames_container'>
				<div class='convnames_nonames' id='noconvpanel1'>You have no conversations.</div>
					<div class='convnames_scrollcontainer' id='convlist'>


					</div>
				</div>

				<!--
				<div class='bigscroller_up conv_list' id='convlist_up'  onclick="myScroll('convlist',250,500)"></div>
				<div class='bigscroller_down conv_list' id='convlist_down' onclick="myScroll('convlist',-250,500)"></div>
				-->

				<div class='newconvbutton' onclick='newConversationClick()'>New Conversation</div>
				<!--
				<div class='sortfavbutton'>Favs</div>
				<div class='sortrecentbutton'>Recent</div>
				<div class='sortunreadbutton'>Unread</div>
				<div class='sortactivebutton'>Active</div>
                -->
				<div class='conventry_container' id='outer_conversation_container'>
					<div class='convnames_noconv' id='noconvpanel2'>To start a conversation, follow these steps: <br />1. Click "New Conversation"<br />2. Enter the name of the player you want to converse with in the input field on the top of the conversation field.<br />3. Type the text you wish to send in the input field a the bottom.<br />4. Press Send.</div>
					<div class='conventry_entry_container' id='currentconv'>



					</div>

				</div>
				<div class='convheader'>
					<div class='convheader_title'>Conversation with: <span id='conversation_with_name'></span> <input id='conversation_with_input' onkeyup='checkMessageReceiverForAlliance()' class='newconvnameentry' style='display:none;' placeholder='Enter nickname...' title='Enter a nickname or *Alliance* to send to your entire alliance (if you have the rights to do so)'/></div>
					<div class='convblock' id='blockConversationButton' onclick='blockConversationClick()' style='opacity:0.3;'>Block</div>
					<!--<div class='convaddfav'>Add to Fav</div> -->
				</div>

				<!--
				<div class='bigscroller_up conv_entries'  id='currentconv_up'  onclick="myScroll('currentconv',400,500)"></div>
				<div class='bigscroller_down conv_entries' id='currentconv_down' onclick="myScroll('currentconv',-400,500)"></div>

				<div class='bigscroller_top conv_entries'  onclick="myScroll('currentconv',30000000,1000)"></div>
				<div class='bigscroller_bottom conv_entries'  onclick="myScroll('currentconv',-30000000,1000)"></div>
				-->

				<textarea id='conversation_textarea_body' class='conv_textentry' placeholder='Write something here...'></textarea>
				<div class='conv_sendbutton' onclick='conversationSendClick()'>Send</div>
			</div>
		</div>
		<!-- End Mail Slide -->


	
        <!-- Notes Slide -->
		<div class='conversationslide' id='noteslide'>
			<div class='conversationbg'>
				<div class='slide_label'><div class='slide_heading'>My Notes</div></div>
				<div class='notelist_container' id='notelist_container'>
					<div class='convnames_nonames' id='nonotes' >You have no saved notes.</div>
					<div class='notelist' id='notelist'>
					</div>
				</div>

				<div class='newconvbutton' id='new_note_button' onclick='newNoteClick()'>New Note</div>
				<div class='conventry_container' id='selected_note_container'>
					<div class='conventry_entry_container' id='selected_note'>
					</div>
					<div class='noteheader'>
						<div class='convheader_title'><span id='selected_note_subject'>No note selected.</span></div>
					</div>
				</div>

			</div>
		</div>
		<!-- End Notes Slide -->
	
<!-- Build Tree Slide -->
<div id='buildtreeslide' style='position: absolute; top: 24px; left: 1200px; right: 0px; bottom: 100px; opacity: 1;z-index: 3;'>
</div>
<!-- End Tutorial Slide -->


	

		<div id='rankingslide' class='rankingslide'>
			<div class='rank_slide_bg'>
				<div class='slide_label'><div class='slide_heading'>Game Rankings</div></div>
				<div class='rank_type_select player_ranking' onclick='selectPlayerRanks()'>
					<img src='images/fixed/player_rank_img.png'>
					<div class='rank_type_title'>PLAYERS</div>
				</div>
				<div class='rank_type_select alliance_ranking' onclick='selectAllianceRanks()'>
					<img src='images/fixed/alliance_rank_img.png'>
					<div class='rank_type_title'>ALLIANCES</div>
				</div>

				<div class='rank_select_info' id='ranking_description'>
					This is the place where the alliance and player info about the rankings is displayed. It should have the capacity to contain a rather substantial amount of information regarding the rankings and how to navigate them.
				</div>
				<div class='rank_category_list'>
					<div class='scrollbuttons rank_category_scroll'>
						<div class='scrollbutton_up' id='rank_category_slide_up' onclick="myScroll('rank_category_slide',300,1000)"></div>
						<div class='scrollbutton_down' id='rank_category_slide_down' onclick="myScroll('rank_category_slide',-300,1000)"></div>
					</div>
					<div class='shaded_recess'>
						<div class='rank_list_bg'>
							<div class='rank_list_outer'>
								<div id='rank_category_slide' class='rank_list_wrapper'>
									<div id='rank_line_01'>Weekly Resources Gathered</div>
								</div>
							</div>
						</div>
					</div>
						</div>
				<div class='rank_category_list_header'>RANK CATEGORY</div>
				<div class='rank_list_header' id='selected_ranking_list_header'>No ranking-list selected</div>

				<div class='rank_listing'>
					<div class='bigscroller_up rank_list_scroll' id='rank_listing_slide_up' onclick="myScroll('rank_listing_slide',450,1000)"></div>
					<div class='bigscroller_down rank_list_scroll' id='rank_listing_slide_down' onclick="myScroll('rank_listing_slide',-450,1000)"></div>
					<div class='bigscroller_top rank_list_scroll' id='rank_listing_slide_top' onclick="myScroll('rank_listing_slide',30000,1000)"></div>
					<div class='bigscroller_bottom rank_list_scroll' id='rank_listing_slide_bottom' onclick="myScroll('rank_listing_slide',-30000,1000)"></div>
					<div class='shaded_recess'>
						<div class='rank_listing_bg'>
							<div class='rank_listing_wrapper' id='rank_listing_slide'>

							</div>
						</div>
						<div class='player_rank_field'>
							<div id='own_rank_number' class='player_rank_number'></div>
							<div id='own_rank_name' class='player_rank_name'></div>
							<div id='own_rank_value' class='player_rank_value'></div>
						</div>
					</div>
				</div>
			</div>
		</div>


	
		<!-- Tech Tree -->
		<div id='techtreeslide' class='techtreeslide'>
			<div class='techslide_bg'>

				<div class='slide_label'><div class='slide_heading'>Tech Tree</div></div>
				<div class='techtree_border' id='outer_tech_tree_border_intech'>
					<div class='techtree_heading' id='tech_tree_heading_intech'>InTech</div>
					<div class='techtree_bonuscontainer' id='matterTech'>
						<div class='techtree_available_bonus' id='available_matter_techs'>
							<div class='techtree_bonus_header'>Available Bonuses</div>
							<!-- Per item here
							<div class='techitem' id='m01'>
								<img src='images/icons/research/101.jpg' />
								<div class='techitem_level'>3</div>
							</div>
							-->
							<!-- If there is a new tier introduced we do this:
							<div class='tech_line_separate'></div>
							-->
						</div>
						<div id='unavailable_matter_techs'>
							<div class='techbonus_separator'><span id='matter_tech_point_needed_to_unlock'>3</span> <span id='matter_tech_point_needed_to_unlock_text'>points needed to unlock next tier</span></div>
							<!-- Techitem_level element added only when it becomes available to add points to -->
							<!-- Per item here
							<div class='techitem' id='m01'>
								<img src='images/icons/research/101.jpg' />
								<div class='techitem_level'>3</div>
							</div>
							<!-- If there is a new tier introduced we do this:
							<div class='tech_line_separate'></div>
							-->
						</div>
					</div>
				</div>

				<div class='techtree_border'  id='outer_tech_tree_border_strontech'>
					<div class='techtree_heading'  id='tech_tree_heading_strontech'>StronTech</div>
					<div class='techtree_bonuscontainer' id='energyTech'>
						<div class='techtree_available_bonus' id='available_energy_techs'>
							<div class='techtree_bonus_header'>Available Bonuses</div>
							<!-- Per item here
							<div class='techitem' id='m01'>
								<img src='images/icons/research/101.jpg' />
								<div class='techitem_level'>3</div>
							</div>
							-->
							<!-- If there is a new tier introduced we do this:
							<div class='tech_line_separate'></div>
							-->
						</div>
						<div id='unavailable_energy_techs'>
							<div class='techbonus_separator'><span id='energy_tech_point_needed_to_unlock'>3</span> <span id='energy_tech_point_needed_to_unlock_text'>points needed to unlock next tier</span></div>
							<!-- Techitem_level element added only when it becomes available to add points to -->
							<!-- Per item here
							<div class='techitem' id='m01'>
								<img src='images/icons/research/101.jpg' />
								<div class='techitem_level'>3</div>
							</div>
							<!-- If there is a new tier introduced we do this:
							<div class='tech_line_separate'></div>
							-->
						</div>
					</div>
				</div>

				<div class='techtree_border'  id='outer_tech_tree_border_neotech'>
					<div class='techtree_heading'  id='tech_tree_heading_neotech'>NeoTech</div>
					<div class='techtree_bonuscontainer' id='displacementTech'>
						<div class='techtree_available_bonus' id='available_displacement_techs'>
							<div class='techtree_bonus_header'>Available Bonuses</div>
							<!-- Per item here
							<div class='techitem' id='m01'>
								<img src='images/icons/research/101.jpg' />
								<div class='techitem_level'>3</div>
							</div>
							-->
							<!-- If there is a new tier introduced we do this:
							<div class='tech_line_separate'></div>
							-->
						</div>
						<div id='unavailable_displacement_techs'>
							<div class='techbonus_separator'><span id='displacement_tech_point_needed_to_unlock'>3</span> <span id='displacement_tech_point_needed_to_unlock_text'>points needed to unlock next tier</span></div>
							<!-- Techitem_level element added only when it becomes available to add points to -->
							<!-- Per item here
							<div class='techitem' id='m01'>
								<img src='images/icons/research/101.jpg' />
								<div class='techitem_level'>3</div>
							</div>
							<!-- If there is a new tier introduced we do this:
							<div class='tech_line_separate'></div>
							-->
						</div>
					</div>
				</div>

				<div id='bonuspane' class='bonuspane'>
					<img src='images/fixed/cancel.png' id='bonuspane_close' onclick='closeTechtreeBonusPanel()'>
					<div id='bonuspane_entry' class='bonuspane_entry'>
						<div class='bonuspane_heading'>
							<div class='techitem_dup'>
								<img src='images/icons/missingimage.png' />
							</div>
							<span id='bonuspane_title_content'>No item selected</span>
						</div>
						<div id='bonuspane_text' class='bonuspane_text'>
							<div class='bonuspane_counter'>
								<div class='bonuspane_bonuses'>
									<div class='bonuspane_button' onmousedown='techtreePlusClick()' id='techtreePlusButton'>
										<div class='bonuspane_click' ></div>
										<div class='buttontext bonuspane_buttontext'>+</div>
									</div>
									<span id='bonus_allocated'>0</span>/<span id='bonus_total'>0</span>
									<div class='bonuspane_button' onmousedown='techtreeMinusClick()'  id='techtreeMinusButton'>
										<div class='bonuspane_click' ></div>
										<div class='buttontext bonuspane_buttontext'>-</div>
									</div>
								</div>
							</div>
							<span id='bonuspane_text_content'></span>
						</div>
					</div>
				</div>

				<div class='techtree_bottombuttons'>
					<div class='lightbutton160 techtree_buttons' id='techtree_cancel_button' onclick='techTreeCancelClick()'>
						<div class='buttontext24'>Cancel</div>
					</div>
					<div class='lightbutton160 techtree_buttons green' id='techtree_commit_button' onclick='techTreeCommitClick()'>
						<div class='buttontext24'>Commit</div>
					</div>
					<div class='lightbutton160 techtree_buttons green' id='techtree_reset_button' onclick='techTreeResetClick()'>
						<div class='buttontext24'>Reset Points</div>
					</div>
					<div class='lightbutton160 techtree_buttons' id='bonus_gains' onclick='renderTechPointList()'>
                        <div class='buttontext24'>List of points</div>
                    </div>
					<span>Available Points: </span><span id='current_available_techpoints'>1</span>
				</div>
				<div class='tech_point_gains'>
					<img src='images/fixed/cancel.png' class='bonus_close' id='bonus_close'>
					<div class='tech_gains_header'>Tech points gained</div>
					<div class='tech_column' id='tech_desc_column_1'>
						<!--<div class='tech_point_gain_entry'>1 point gained from Delivering mail to outpost 44.</div>-->
					</div>
					<div class='tech_column' id='tech_desc_column_2'>
						<!--<div class='tech_point_gain_entry done'>1 point gained from Delivering mail to outpost 44.</div>-->
					</div>
					<div class='tech_column' id='tech_desc_column_3'>
						<!--<div class='tech_point_gain_entry'>1 point gained from Delivering mail to outpost 44.</div>-->
					</div>
				</div>


			</div>
		</div>

		<!-- End Tech Tree -->

	
		<div id='economy_slide' class='economy_slide'>
			<div class='economy_bg'>
				<div class='economy_box resource_box'>
					<div class='economy_box_header'>Resource Overview</div>

					<div class='eco_ovr_column nd_column'></div>
					<div class='eco_ovr_column sr_column'></div>
					<div class='eco_ovr_column in_column'></div>
					<div class='eco_ovr_column hs_column'></div>

					<div class='eco_ovr_line first_line in'>
						<div class='eco_ovr_title' id='eco_title_hwprod'>Homeworld Production</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_h'>0</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_i'>0</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_s'>0</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_n'>0</div>
					</div>
					<div class='eco_ovr_line in'>
						<div class='eco_ovr_title' id='eco_title_opprod'>Outpost Production</div>
						<div class='eco_ovr_entry' id='eco_op_prod_h'>0</div>
						<div class='eco_ovr_entry' id='eco_op_prod_i'>0</div>
						<div class='eco_ovr_entry' id='eco_op_prod_s'>0</div>
						<div class='eco_ovr_entry' id='eco_op_prod_n'>0</div>
					</div>
					<div class='eco_ovr_line in'>
						<div class='eco_ovr_title' id='eco_title_ataxdist'>Alliance Tax Distribution</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_h'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_i'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_s'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_n'>0</div>
					</div>
					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title' id='eco_title_fleetupkeep'>Fleet Upkeep</div>
						<div class='eco_ovr_entry' id='eco_flt_up_h'>0</div>
						<div class='eco_ovr_entry' id='eco_flt_up_i'>0</div>
						<div class='eco_ovr_entry' id='eco_flt_up_s'>0</div>
						<div class='eco_ovr_entry' id='eco_flt_up_n'>0</div>
					</div>
					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title'  id='eco_title_allianceupkeep'>Alliance Upkeep</div>
						<div class='eco_ovr_entry' id='eco_all_up_h'>0</div>
						<div class='eco_ovr_entry' id='eco_all_up_i'>0</div>
						<div class='eco_ovr_entry' id='eco_all_up_s'>0</div>
						<div class='eco_ovr_entry' id='eco_all_up_n'>0</div>
					</div>
					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title' id='eco_title_alliancetax'>Alliance Tax</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_h'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_i'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_s'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_n'>0</div>
					</div>
					<div class='eco_ovr_line balance'>
						<div class='eco_ovr_title'  id='eco_title_balance'>Est. Income Balance</div>
						<div class='eco_ovr_entry' id='eco_balance_h'>0</div>
						<div class='eco_ovr_entry' id='eco_balance_i'>0</div>
						<div class='eco_ovr_entry' id='eco_balance_s'>0</div>
						<div class='eco_ovr_entry' id='eco_balance_n'>0</div>
					</div>

					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title' id='eco_title_alliancetax'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_h'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_i'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_s'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_n'>&nbsp;</div>
					</div>

					<div class='eco_ovr_line notenough'>
						<div class='eco_ovr_title' id='eco_title_upkeepdebt'>Upkeep-debt</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_h'>0</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_i'>0</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_s'>0</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_n'>0</div>
					</div>



				</div>


				<div class='economy_box infra_bonus_box'>
					<div class='economy_box_header'>Bonuses</div>
					<div class='infra_entry'>
						<div class='infra_header'>Homeworld Mining Bonus</div>
						<div class='infra_value' id='eco_bonus_hw_mining'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Production Cost</div>
						<div class='infra_value' id='eco_bonus_prodcost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Research Cost</div>
						<div class='infra_value' id='eco_bonus_rescost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Development Cost</div>
						<div class='infra_value' id='eco_bonus_devcost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Facility Cost</div>
						<div class='infra_value' id='eco_bonus_faccost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Alliance Upkeep</div>
						<div class='infra_value' id='eco_bonus_allyupkeep'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Unit Upkeep</div>
						<div class='infra_value' id='eco_bonus_upkeep'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Vault Size</div>
						<div class='infra_value' id='eco_bonus_vaultsize'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Alliance HW Mining Bonus</div>
						<div class='infra_value' id='eco_bonus_alliance_sector_hw_mining'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Alliance OP Mining Bonus</div>
						<div class='infra_value' id='eco_bonus_alliance_sector_op_mining'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Production Speed Bonus</div>
						<div class='infra_value' id='eco_bonus_production_speed'>0 %</div>
					</div>

				</div>

				<div class='slide_label'><div class='slide_heading'>Economy</div></div>

				<!--
				<div class='economy_box plate_heading'>
					<div class='slide_heading'>Economic Overview</div>
				</div>
				-->

			</div>
		</div>
	
		<div id='mission_section' class='mission_section'>
			<div class='missionsbg_full'></div>
			<div class='missionsbg_bottom'></div>
			<div class='player_mission_container' id='pl_mis_cont'>
				<div class='mission_tag'>
					<img src='images/fixed/missions/mission_player_tag.png'>
				</div>
				<div class='player_missions_listing' style='height:406px;'>
					<div class='scrollBG launch_fleet_scrollbg' style='background-position-y: 11px;'>
						<div class='lowpanel_table_headers missions' id='selectedSoloPack' style='transform: translate(0px, 0px);'>
							<div class='allymissions_footer_title' id='soloPackTitle' onclick='showPackDescription()'>Selected pack</div>
						</div>
						<div class='lowpanel_table_footers allymissions' id='solomissions_footer' style='transform: translate(0px, 0px);'>
							<div class='lowpanel_table_footer_bg'></div>
							<div class='allymissions_footer_title' id='view_solo_missions_list' onclick='hideMissionRankings()'> &lt;&lt; Return to Story Selection</div>
						</div>
						<div class='solomission_scrollcontainer' id='solomission_scrollcontainer' style='bottom: 0px; top: 0px;'>
							<div class='lowpanel_table_scrollwrapper' id='soloMissions' style='transform: translate(0px, 0px); top: 0px;'>
							</div>
							<div class='lowpanel_table_scrollwrapper footer' id='soloMissionPack' style='left: 340px; transform: translate(0px, 0px); top: 0px;'>
							</div>
						</div>
					</div>
					<div class='scrollbuttons_allymission'>
						<div class='scrollbutton_up' id='soloMissions_up' onclick="myScroll('soloMissions',181,500,'scrollBG')"></div>
						<div class='scrollbutton_down' id='soloMissions_down' onclick="myScroll('soloMissions',-181,500,'scrollBG')"></div>
					</div>
				</div>
				<div class='mission_pack_img' id='mission_pack_image_container'>
					<img src='images/fixed/missions/no_mission_selected.jpg' class='img_pack' id='mission_pack_image'>
					<div class='mission_pack_name' id='bigPackName'>No mission-pack selected</div>

				</div>

				<div class='ranked_mission_list_official' id='missions_ranking_outer_container' style='display:none;'></div>
				<div class='ranked_mission_list_personal' id='missions_ranking_personal_container' style='display:none;'></div>

				<div class='mission_description'>
					<div class='mission_header'>
						<span class='mission_text_heading' id='selected_mission_name'>No mission selected</span>
					</div>
					<div>
						<div class='mission_short_details'>
							<div class='mission_detail_title solo'>Mission Type:</div>
							<div class='mission_detail_entry solo' id='selected_mission_type'>No mission selected</div>
							<div class='mission_detail_title solo'>Mission Difficulty:</div>
							<div class='mission_detail_entry solo' id='selected_mission_difficulty'>No mission selected</div>
							<div class='mission_detail_title solo'>Strength:</div>
							<div class='mission_detail_entry solo' id='selected_mission_minimum_strength'>No mission selected</div>
							<div class='mission_detail_title solo'>Essential Ships:</div>
							<div class='mission_detail_entry solo' id='selected_mission_essential_ships'>No mission selected</div>
							<div class='mission_detail_title solo'>Duration:</div>
							<div class='mission_detail_entry solo' id='selected_mission_extra_field'>N/A</div>
							<div class='mission_detail_title solo'>Repeatable:</div>
							<div class='mission_detail_entry solo' id='selected_mission_repeatable'>N/A</div>

							<div id='selected_mission_prepare_button' class='lightbutton160' onclick='prepareMissionClick()' style='margin-left: 20px;display:none;'>
								<div class='buttontext24'>Prepare</div>
							</div>
							<div id='selected_mission_summary_button' class='lightbutton160' onclick='showSelectedMissionSummary()' style='margin-left: 20px;display:none;'>
								<div class='buttontext24'>Show Summary</div>
							</div>
						</div>
						<div class='mission_description_text'>
							<span class='tlt selectable_text' style='visibility: visible;' id='main_mission_description'>
								Please select a mission-pack and a mission
							</span>
						</div>
					</div>
				</div>

				<div class='mission_filters' style='top:509px;'>
					<div class='mission_filter_toggle' >
						<img id='mission_filter_toggle_1' src='images/icons/buttons/26x26green.png'>
					</div>
					<div class='mission_filter_text'  onclick='toggleMissionFilter(1)'>Show Completed-Packs</div>
					<!--
					<div class='mission_filter_toggle' >
						<img id='mission_filter_toggle_2' src='images/icons/buttons/26x26green.png' >
					</div>
					<div class='mission_filter_text' onclick='toggleMissionFilter(2)'>Show Purchase-Packs</div>

					<div class='mission_filter_toggle' >
						<img id='mission_filter_toggle_3' src='images/icons/buttons/26x26green.png'>
					</div>
					<div class='mission_filter_text' onclick='toggleMissionFilter(3)'>Show Other Packs</div>
					-->
				</div>

			</div>

			<div class='player_mission_list_header_container'>
				<div class='player_mission_list_header' id='mission_select_header'>Available Missionpacks</div>
			</div>
			<div class='mission_section_header'>
				Missions
			</div>
			<div class='purchase_mission_pack_plate' id='purchase_mission'>
				This mission pack is available for purchase<br>
				Would you like to purchase this mission pack now?
				<div id='purchase_missionpack_cost_div'>Cost: 10 credits</div>
				<div class='lightbutton160' id='buy_mission' onclick='buyMissionPackClick()'>
					<div class='buttontext24'>Yes</div>
				</div>
				<div class='lightbutton160' id='nobuy_mission' onclick='hideMissionPurchase()'>
					<div class='buttontext24'>Later</div>
				</div>
			</div>
		</div>

	
		<div id='purchaseslide' class='optionsslide'>
			<div class='optionsslide_content'>
				<div class='slide_label'><div class='slide_heading'>Purchase Credits</div></div>

				<div class='options_frame purchase_frame' id='purchase_frame'>
					<div class='purchase_header_text'>Purchase credits</div>
					<hr>
					<div class='purchase_header_text'>Pay by credit-card, bank-transfer, pre-paid cards etc.</div>
					<div class='cards_container'><img src='images/fixed/various_cards.png'></div>
					<span class='purchase_body_text'>Select the number of credits, click the BUY-button, and you will be sent to a secure page that handles the payment. No sensitive information is stored here. The exact payment-options will differ from country to country. After the payment has been completed, you will return to the game.</span>
					<div>
						<form action='https://live.adyen.com/hpp/select.shtml' method='post' id='adyen_form'>
							<select name='credits' id='adyen_credits' onchange='update_adyen_form()'>
								<option value=0>Choose number of credits</option>
								<option value=10>10 credits for 2 &euro;</option>
								<option value=30>30 credits for 4 &euro;</option>
								<option value=65>65 credits for 8 &euro;</option>
								<option value=90>90 credits for 10 &euro;</option>
								<option value=180>180 credits for 18 &euro;</option>
								<option value=365>365 credits for 32 &euro;</option>
								<option value=750>750 credits for 60 &euro;</option>
							</select>
							<input type='hidden' name='merchantReference' id='adyen_merchant_reference' value='66151:60:EUR' />
							<input type='hidden' name='paymentAmount' id='adyen_amount' value='' />
							<input type='hidden' name='currencyCode' value='EUR' />
							<input type='hidden' name='shipBeforeDate' value='2017-10-06' />
							<input type='hidden' name='skinCode' value='cv0aGtpe' />
							<input type='hidden' name='merchantAccount' value='AD2460' />
							<input type='hidden' name='orderData' id='adyen_order_data' value='' />
							<input type='hidden' name='shopperLocale' value='en' />
							<input type='hidden' name='sessionValidity' value='2017-10-06T11:41:21Z' />
							<input type='hidden' name='merchantSig' id='adyen_merchant_sig' value='' />
							<!--<input type='submit' value='Buy Now' id='adyen_submit_button' disabled='disabled' />-->

								<div class='lightbutton160 threaddisabled'  id='adyen_buy_text' onclick='adyenClick()' style='margin-top:3px;'>
									<div class='buttontext24 notenough' >Buy now</div>
								</div>

						</form>
					</div>
					<hr>
					<div class='purchase_header_text'>Pay through PayPal</div>
					<span class='purchase_body_text'>When you click the BUY-button below, after selecting the number of credits you wish to buy, you will be sent to PayPal to complete the purchase. After the payment has been completed, you will return to the game.</span>
					<div class='cards_container'><img height='70' src='images/fixed/paypal_icon.png'></div>
					<div>
						<form method='post' action='https://www.paypal.com/cgi-bin/webscr' id='paypal_form'>

							<select id='paypal_credits' onchange='update_paypal_form()'>
								<option value=0>Choose number of credits</option>
								<option value=10>10 credits for 2 &euro;</option>
								<option value=30>30 credits for 4 &euro;</option>
								<option value=65>65 credits for 8 &euro;</option>
								<option value=90>90 credits for 10 &euro;</option>
								<option value=180>180 credits for 18 &euro;</option>
								<option value=365>365 credits for 32 &euro;</option>
								<option value=750>750 credits for 60 &euro;</option>
							</select>
							<input type='hidden' name='cmd' value='_xclick' />
							<input type='hidden' name='business' value='payment@ad2460.com' />
							<input type='hidden' name='item_name' id='paypal_item_name' value='0 Credits for AD2460' />
							<input type='hidden' name='item_number' id='paypal_item_number' value='0' />
							<input type='hidden' name='amount' id='paypal_amount' value='0.00' />
							<input type='hidden' name='return' value='http://live.ad2460.com/returnFromPaypal.pl?complete=true' />
							<input type='hidden' name='cancel_return' value='http://live.ad2460.com/returnFromPaypal.pl?complete=false' />
							<input type='hidden' name='no_note' value='1' />
							<input type='hidden' name='currency_code' value='EUR' />
							<input type='hidden' name='on0' value='USERID' />
							<input type='hidden' name='os0' maxlength='10' value='66151' />
							<input type='hidden' name='custom' maxlength='10' value='66151' />
							<!--<input type='submit' value='Buy now' id='paypal_submit_button' disabled='disabled' />-->

							<div class='lightbutton160 threaddisabled' id='paypal_buy_text' onclick='paypalClick()'  style='margin-top:3px;'>
								<div class='buttontext24 notenough' >Buy now</div>
							</div>

						</form>
					</div>
					<div id='currency_text_field' class='currency_text_field' style='	border-radius: 10px;	border-color: black;	border: 1px solid black;	width: 94%;	position: absolute;	top: 500px;	font-size: 17px;	padding: 4px;'></div>


				</div>

				<div class='options_frame purchase_frame_2' id='purchase_frame_2'>
					<div class='purchase_header_text'>Pay with your mobile phone</div>
					<hr>
					<div class='cards_container'><img style='height:100px;border-radius:10px;' src='images/fixed/fortumo_logo.png'></div>
					<span class='purchase_body_text' style='text-align:center;'>
					
			Send "<b>FOR ADTIME 66151</b>" to 79279<br>
			Credits: 89<br>
			Price: 10.00 GBP<br>
			Support: +4722591608 | support@ad2460.com<br>
			Mobile Payment by <a target='_blank' href='http://www.fortumo.com'>fortumo.com</a>
			
					</span>
					<br>
					<span class='purchase_body_text' style='text-align:justify;'>
					The time it takes for an SMS-payment to clear is anywhere from 'immediately' to 'several minutes'. This is beyond our control. Some subscriptions / carriers may not support mobile payments at all. You are not billed if your subscription / carrier does not support this.
					</span>

				</div>

				<div class='options_frame reward_code_container'>
					<div class='lowpanel_header'>Redeem Codes</div>
					<span class='account_rename_text'>Here you may spend 'codes' that you have obtained through competitions or giveaways. Punch in the code in the textbox and hit the button, couldn't be easier than that!</span>
					<div style='width:100%;text-align:center;'><input type='text' value='' id='reward_code' placeholder='Enter code here' style='width:150px;padding:3px;margin-bottom:5px;'></div>
					<div class='lightbutton160' onclick='spendCodeClick()'>
						<div class='buttontext24'>Use Code</div>
					</div>
				</div>


			</div>
		</div>

		
			<script type='text/javascript'>
				var amounts=[200,400,800,1000,1800,3200,6000];
				var order_data=['H4sIAGEa1lkAAzM0UEguSk3JLClWSMsvUjDSMzBQcA0NAgCjN3CDFwAAAA==','H4sIAGEa1lkAAzM2UEguSk3JLClWSMsvUjDRMzBQcA0NAgDN7YmoFwAAAA==','H4sIAGEa1lkAAzMzVUguSk3JLClWSMsvUrDQMzBQcA0NAgAFRIAvFwAAAA==','H4sIAGEa1lkAA7M0UEguSk3JLClWSMsvUjA00DMwUHANDQIAxTwUkhgAAAA=','H4sIAGEa1lkAAzO0MFBILkpNySwpVkjLL1IwtNAzMFBwDQ0CAER/aMcZAAAA','H4sIAGEa1lkAAzM2M1VILkpNySwpVkjLL1IwNtIzMFBwDQ0CAP5IJxEZAAAA','H4sIAGEa1lkAAzM3NVBILkpNySwpVkjLL1IwM9AzMFBwDQ0CAFiiGSEZAAAA'];
				var sigs=['JNT5XnsIgkM+5+H3Wy+IaAjeN64=','uBl3ftG8gYH3Fc9JuGCOG6VM4Qk=','zgllu6OKlGmOs2aYO2LCF+7k9+c=','NdAK+NXbXskbkf3VgX9iKXvakxs=','OZuGvNT40DfA0WJtnpaFa9BAIG0=','5BA3J8LIWlrUgaWlmI77UxsKqbU=','tPR8M5RVrG21xUuDiopNnaXCHSs='];
				var refs=['66151:2:EUR','66151:4:EUR','66151:8:EUR','66151:10:EUR','66151:18:EUR','66151:32:EUR','66151:60:EUR'];
			</script>
		
		<div id='economy_slide' class='economy_slide'>
			<div class='economy_bg'>
				<div class='economy_box resource_box'>
					<div class='economy_box_header'>Resource Overview</div>

					<div class='eco_ovr_column nd_column'></div>
					<div class='eco_ovr_column sr_column'></div>
					<div class='eco_ovr_column in_column'></div>
					<div class='eco_ovr_column hs_column'></div>

					<div class='eco_ovr_line first_line in'>
						<div class='eco_ovr_title' id='eco_title_hwprod'>Homeworld Production</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_h'>0</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_i'>0</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_s'>0</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_n'>0</div>
					</div>
					<div class='eco_ovr_line in'>
						<div class='eco_ovr_title' id='eco_title_opprod'>Outpost Production</div>
						<div class='eco_ovr_entry' id='eco_op_prod_h'>0</div>
						<div class='eco_ovr_entry' id='eco_op_prod_i'>0</div>
						<div class='eco_ovr_entry' id='eco_op_prod_s'>0</div>
						<div class='eco_ovr_entry' id='eco_op_prod_n'>0</div>
					</div>
					<div class='eco_ovr_line in'>
						<div class='eco_ovr_title' id='eco_title_ataxdist'>Alliance Tax Distribution</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_h'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_i'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_s'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_n'>0</div>
					</div>
					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title' id='eco_title_fleetupkeep'>Fleet Upkeep</div>
						<div class='eco_ovr_entry' id='eco_flt_up_h'>0</div>
						<div class='eco_ovr_entry' id='eco_flt_up_i'>0</div>
						<div class='eco_ovr_entry' id='eco_flt_up_s'>0</div>
						<div class='eco_ovr_entry' id='eco_flt_up_n'>0</div>
					</div>
					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title'  id='eco_title_allianceupkeep'>Alliance Upkeep</div>
						<div class='eco_ovr_entry' id='eco_all_up_h'>0</div>
						<div class='eco_ovr_entry' id='eco_all_up_i'>0</div>
						<div class='eco_ovr_entry' id='eco_all_up_s'>0</div>
						<div class='eco_ovr_entry' id='eco_all_up_n'>0</div>
					</div>
					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title' id='eco_title_alliancetax'>Alliance Tax</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_h'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_i'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_s'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_n'>0</div>
					</div>
					<div class='eco_ovr_line balance'>
						<div class='eco_ovr_title'  id='eco_title_balance'>Est. Income Balance</div>
						<div class='eco_ovr_entry' id='eco_balance_h'>0</div>
						<div class='eco_ovr_entry' id='eco_balance_i'>0</div>
						<div class='eco_ovr_entry' id='eco_balance_s'>0</div>
						<div class='eco_ovr_entry' id='eco_balance_n'>0</div>
					</div>

					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title' id='eco_title_alliancetax'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_h'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_i'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_s'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_n'>&nbsp;</div>
					</div>

					<div class='eco_ovr_line notenough'>
						<div class='eco_ovr_title' id='eco_title_upkeepdebt'>Upkeep-debt</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_h'>0</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_i'>0</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_s'>0</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_n'>0</div>
					</div>



				</div>


				<div class='economy_box infra_bonus_box'>
					<div class='economy_box_header'>Bonuses</div>
					<div class='infra_entry'>
						<div class='infra_header'>Homeworld Mining Bonus</div>
						<div class='infra_value' id='eco_bonus_hw_mining'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Production Cost</div>
						<div class='infra_value' id='eco_bonus_prodcost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Research Cost</div>
						<div class='infra_value' id='eco_bonus_rescost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Development Cost</div>
						<div class='infra_value' id='eco_bonus_devcost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Facility Cost</div>
						<div class='infra_value' id='eco_bonus_faccost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Alliance Upkeep</div>
						<div class='infra_value' id='eco_bonus_allyupkeep'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Unit Upkeep</div>
						<div class='infra_value' id='eco_bonus_upkeep'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Vault Size</div>
						<div class='infra_value' id='eco_bonus_vaultsize'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Alliance HW Mining Bonus</div>
						<div class='infra_value' id='eco_bonus_alliance_sector_hw_mining'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Alliance OP Mining Bonus</div>
						<div class='infra_value' id='eco_bonus_alliance_sector_op_mining'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Production Speed Bonus</div>
						<div class='infra_value' id='eco_bonus_production_speed'>0 %</div>
					</div>

				</div>

				<div class='slide_label'><div class='slide_heading'>Economy</div></div>

				<!--
				<div class='economy_box plate_heading'>
					<div class='slide_heading'>Economic Overview</div>
				</div>
				-->

			</div>
		</div>
	
	<div id='optionsslide' class='optionsslide'>
		<div class='optionsslide_content'>
			<div class='slide_label'><div class='slide_heading'>Options</div></div>
			<div class='options_frame avatar_selection'>
				<div class='lowpanel_header'>Customize Avatar</div>
				<div class='selected_member_avatar main_header_image_holder_dynamic avatar_selection_image_frame' id='avataruploader'>
					<img id='options_avatar_image' src='images/uploads/avatars/00066151_990.jpg'>
				</div>
				<div class='lowpanel_helpinfo'>Click image to upload a new avatar</div>
			</div>

			<div class='options_frame account_details_container'>
				<div class='lowpanel_header'>Refer new players</div>
				You can refer new players to AD2460 and earn referral credits when they buy their own credits.<br>
				Make sure they go to <br><b><span class='selectable_text'>http://www.ad2460.com?ref=66151</span></b><br> when they register, and it's done!<br>
	
	<a href='https://www.facebook.com/sharer/sharer.php?u=http://www.ad2460.com?ref=66151' target='_blank' onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://www.ad2460.com?ref=66151','FBshare','width=600,height=400');return false;">
	 Or simply share it on Facebook!
	</a>
	<br>
	<div style='cursor:pointer;' onclick='fetchReferrals()'>Click here to see your referrals</div>
		<!--Or just click here: <div class='fb-share-button' data-href='http://www.ad2460.com?ref=66151' data-layout='icon_link'></div>-->
	
			</div>

			<!--
			<div class='options_frame account_sms_container'>
				<div class='lowpanel_header'>SMS Options</div>
				<span style='display: block; text-align: left;'>Current Phone # is: 0000</span>
				<div class='tax_setting_title sms_header'>Update Phone #</div><input class='input_styling sms_input'>
				<div class='lightbutton160' onclick='updatePhoneNumber()'>
					<div class='buttontext24'>Change</div>
				</div>
			</div>
			-->

			<div class='options_frame account_sounds_container'>
				<div class='lowpanel_header'>Sound Options</div>
				SFX Volume<br>
				Off <input type='range' name='sfxvolume' id='sfxvolume' min='0' max='100' onchange='updateVolume()' style='width:200px'> Max<br/>
				Music Volume<br>
				Off <input type='range' name='musicvolume' id='musicvolume' min='0' max='100' onchange='updateVolume()' style='width:200px'> Max<br/>
				Combat SFX Volume<br>
				Off <input type='range' name='combatsfxvolume' id='combatsfxvolume' min='0' max='100' onchange='updateVolume()' style='width:200px'> Max<br/>
				Combat Music Volume<br>
				Off <input type='range' name='combatmusicvolume' id='combatmusicvolume' min='0' max='100' onchange='updateVolume()' style='width:200px'> Max<br/>
			</div>

			<div class='options_frame account_password_container'>
				<div class='lowpanel_header'>Change Password</div>
				<div class='tax_setting_title sms_header'>Current Password</div><input type='password' id='opt_cp1' class='input_styling sms_input'>
				<div class='tax_setting_title sms_header'>New Password</div><input type='password' id='opt_cp2' class='input_styling sms_input'>
				<div class='tax_setting_title sms_header'>Re-type Password</div><input type='password' id='opt_cp3' class='input_styling sms_input'>
				<div class='lightbutton160' onclick='changePwClick()'>
					<div class='buttontext24'>Submit</div>
				</div>
			</div>


			<div class='options_frame vacation_mode_container'>
				<div class='lowpanel_header'>Change Nickname</div>
				<input type='text' id='new_nickname' class='input_styling sms_input'>
				<div class='account_rename_text' style='text-align:center;margin-top:2px;margin-bottom:2px;'>You may change your nickname here. Letters and numbers only. Offensive name =  Closed account. Cost: 10 credits, no refunds.</div>
				<div class='lightbutton160' onclick='changeNicknameClick()'>
					<div class='buttontext24'>Do it</div>
				</div>

			</div>

<!--
			<div class='options_frame vacation_mode_container'>
				<div class='lowpanel_header'>Vacation-mode</div>
				<span class='account_rename_text'>I am going away for a while and would like to freeze my account for 1 credit per day. I understand the consequences.</span>
				<div style='height:18px;' id='vacation_mode_options_help'></div>
				<div class='lightbutton160' onclick='vacationModeClick()'>
					<div class='buttontext24'>Proceed</div>
				</div>
			</div>
-->
			<div class='options_frame mid_bottom_container'>
				<div class='lowpanel_header'>Pay 2 Win</div>
				<span class='account_rename_text'>Clicking the button below costs you 5 credits. Obviously, you win!</span>
				<div class='lightbutton160' onclick='pay2winClick()'>
					<div class='buttontext24'>Win</div>
				</div>

			</div>

			<div class='options_frame right_side_container' style='top: 10px;	height: 87px;	width: 372px;	left: 597px;' id='donate_credits_container'>
				<div class='lowpanel_header'>Donate Credits</div>
				<div class='tax_setting_title sms_header' style='width:100px;'>Nickname</div><input type='text' id='donate_nickname' class='input_styling sms_input'>
				<div class='tax_setting_title sms_header' style='width:173px;'>Credits</div><input type='number' value='5' min='5' max='100' step='5' id='donate_credits' class='input_styling sms_input' style='width:50px; text-align:center;'>
				<div class='lightbutton160' onclick='donateCredits1()'>
					<div class='buttontext24' id='donate_credits_button_text'>Donate Credits</div>
				</div>
				<!--
				<span class='account_rename_text'>
					To donate credits, you must have purchased credits recently.<br>
					You must have 15 or more credits remaining after the donation.<br>
					Donation service charge is 10%, rounded up.<br>
					A donation of 20 credits to a player will cost you 22 credits.
				</span>
				-->
			</div>

			<div class='options_frame right_side_container' style='width: 372px;	left: 597px;	top: 122px;	height: 60px;' id='auto_resize_gui_container'>
				<div class='lowpanel_header'>Auto-resize GUI</div>
				<select id='auto_resize_gui_dropdown' class='input_styling'><option value='0'>No</option><option value='1'>Yes</option></select>
				<div class='lightbutton160' onclick='updateAutoResizeGui()'>
					<div class='buttontext24'>Set</div>
				</div>
			</div>


			<div class='options_frame right_side_container' style='width: 372px;	left: 597px;	top: 207px;	height: 106px;'>
				<div class='lowpanel_header'>Produced ships go to</div>
				<div class='account_rename_text'>When a ship has been built, move it automatically to my</div>
				<select id='move_new_ships_to' class='input_styling'>
					<option value='Base fleet'>Base fleet</option>
					<option value='Largest Fleet'>Largest fleet</option>
					<option value='Smallest Fleet'>Smallest fleet</option>
				<!--
					<option value='Outpost : Top strength'>Outpost : Top strength</option>
					<option value='Outpost : Top potential'>Outpost : Top potential</option>
					<option value='Outpost : Top output'>Outpost : Top output</option>
					<option value='Outpost : Least strength'>Outpost : Least strength</option>
					<option value='Outpost : Newest'>Outpost : Newest</option>
					<option value='Outpost : Auto'>Outpost : Auto</option>
				-->

				</select>
				<div class='lightbutton160' onclick='updateNewshipsGoToClick()'>
					<div class='buttontext24'>Set</div>
				</div>
				<div class='account_rename_text' id='move_new_ships_to_description'>Click the help-button for more info.</div>
			</div>

			<div class='options_frame vip_options' id='vip_pack_option'>
				<div class='lowpanel_header'>V.I.P. Package</div>
				<!--<div class='vip_icon_full'></div>-->
				<span class='account_rename_text'>Get VIP-status for 30 days. Get your own chat-icon, vip-badge and free renaming, commander customisation and wargames for the duration. For full details click the help-icon.</span>
				<div class='chat_color_select'>
					<span class='chat_select_text'> Select your chat color:</span>
					<select class='chat_color_preview chat_player_name col_01' id='vip_chat_color_select' onchange='updateChatColorSelect()' style='background-color:black;'>
						<option value='1' selected='selected' class='chat_player_name col_01'>Wanstey</option>
						<option value='2' class='chat_player_name col_02'>Wanstey</option>
						<option value='3' class='chat_player_name col_03'>Wanstey</option>
						<option value='4' class='chat_player_name col_04'>Wanstey</option>
						<option value='5' class='chat_player_name col_05'>Wanstey</option>
						<option value='6' class='chat_player_name col_06'>Wanstey</option>
						<option value='7' class='chat_player_name col_07'>Wanstey</option>
						<option value='8' class='chat_player_name col_08'>Wanstey</option>
						<option value='9' class='chat_player_name col_09'>Wanstey</option>
						<option value='10' class='chat_player_name col_10'>Wanstey</option>
						<option value='11' class='chat_player_name col_11'>Wanstey</option>
						<option value='12' class='chat_player_name col_12'>Wanstey</option>
						<option value='13' class='chat_player_name col_13'>Wanstey</option>
						<option value='14' class='chat_player_name col_14'>Wanstey</option>
						<option value='15' class='chat_player_name col_15'>Wanstey</option>
						<option value='16' class='chat_player_name col_16'>Wanstey</option>
						<option value='17' class='chat_player_name col_17'>Wanstey</option>
						<option value='18' class='chat_player_name col_18'>Wanstey</option>
						<option value='19' class='chat_player_name col_19'>Wanstey</option>
						<option value='20' class='chat_player_name col_20'>Wanstey</option>
					</select>
				</div>
				<span class='icon_select_text'> Select VIP-icon:</span>
				<div class='vip_icon_select_container' id='icon_selection'>
					<img class='vip_icon_select' id='vip_icon_01' src='/images/icons/vip/forum/vip01.png' onclick='selectVipIcon(1)'>
					<img class='vip_icon_select' id='vip_icon_02' src='/images/icons/vip/forum/vip02.png' onclick='selectVipIcon(2)'>
					<img class='vip_icon_select selected' id='vip_icon_03' src='/images/icons/vip/forum/vip03.png' onclick='selectVipIcon(3)'>
					<img class='vip_icon_select' id='vip_icon_04' src='/images/icons/vip/forum/vip04.png' onclick='selectVipIcon(4)'>
					<img class='vip_icon_select' id='vip_icon_05' src='/images/icons/vip/forum/vip05.png' onclick='selectVipIcon(5)'>
				</div>
				<div class='vip_purchase_button' onclick='purchaseVipClick()'>Purchase V.I.P. Pack</div>
			</div>

			<div class='options_frame vip_options' id='vip_pack_option_2' style='display:none'>
				<div class='lowpanel_header'>V.I.P. Package</div>
				<!--<div class='vip_icon_full'></div>-->
				<span class='account_rename_text' id='options_vip_timer'>Vip to 23.06.2016 23:44</span>
				<div class='lightbutton160' onclick='renewVip()'>
					<div class='buttontext24'>Add 30 days</div>
				</div>
				<div style='font-weight: 700; width: 100%; text-align: center; color: black; font-size: 15px; margin-top: 3px; margin-bottom: 3px;font-family: Orbitron, sans-serif; background-color: rgba(255,255,255,0.2);border-radius:3px;'>Change color (3 credits)</div>
				<select class='chat_color_preview chat_player_name col_01' id='vip_chat_color_select_extend' onchange='updateChatColorSelectExtend()' style='background-color:black; width: 225px;margin-bottom: 3px;'>
					<option value='1' selected='selected' class='chat_player_name col_01'>Wanstey</option>
					<option value='2' class='chat_player_name col_02'>Wanstey</option>
					<option value='3' class='chat_player_name col_03'>Wanstey</option>
					<option value='4' class='chat_player_name col_04'>Wanstey</option>
					<option value='5' class='chat_player_name col_05'>Wanstey</option>
					<option value='6' class='chat_player_name col_06'>Wanstey</option>
					<option value='7' class='chat_player_name col_07'>Wanstey</option>
					<option value='8' class='chat_player_name col_08'>Wanstey</option>
					<option value='9' class='chat_player_name col_09'>Wanstey</option>
					<option value='10' class='chat_player_name col_10'>Wanstey</option>
					<option value='11' class='chat_player_name col_11'>Wanstey</option>
					<option value='12' class='chat_player_name col_12'>Wanstey</option>
					<option value='13' class='chat_player_name col_13'>Wanstey</option>
					<option value='14' class='chat_player_name col_14'>Wanstey</option>
					<option value='15' class='chat_player_name col_15'>Wanstey</option>
					<option value='16' class='chat_player_name col_16'>Wanstey</option>
					<option value='17' class='chat_player_name col_17'>Wanstey</option>
					<option value='18' class='chat_player_name col_18'>Wanstey</option>
					<option value='19' class='chat_player_name col_19'>Wanstey</option>
					<option value='20' class='chat_player_name col_20'>Wanstey</option>
				</select>
				<div class='lightbutton160' onclick='changeVipColor()'>
					<div class='buttontext24'>Set new color</div>
				</div>

			</div>

			<!--
			<div class='options_frame combat_full_text_option_container'>
				<div class='lowpanel_header'>Combat details</div>
				<span class='account_rename_text'>Some devices are fast enough to handle the full details in combat, others are not.</span>
				<div style='height:18px;' id='full_combat_options_help'></div>
				<div class='lightbutton160' onclick='toggleFullCombatOutput()'>
					<div class='buttontext24' id='show_full_combat_text_button_text'>OFF</div>
				</div>
			</div>
			-->
		</div>
	</div>

	
		<div id='economy_slide' class='economy_slide'>
			<div class='economy_bg'>
				<div class='economy_box resource_box'>
					<div class='economy_box_header'>Resource Overview</div>

					<div class='eco_ovr_column nd_column'></div>
					<div class='eco_ovr_column sr_column'></div>
					<div class='eco_ovr_column in_column'></div>
					<div class='eco_ovr_column hs_column'></div>

					<div class='eco_ovr_line first_line in'>
						<div class='eco_ovr_title' id='eco_title_hwprod'>Homeworld Production</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_h'>0</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_i'>0</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_s'>0</div>
						<div class='eco_ovr_entry' id='eco_hw_prod_n'>0</div>
					</div>
					<div class='eco_ovr_line in'>
						<div class='eco_ovr_title' id='eco_title_opprod'>Outpost Production</div>
						<div class='eco_ovr_entry' id='eco_op_prod_h'>0</div>
						<div class='eco_ovr_entry' id='eco_op_prod_i'>0</div>
						<div class='eco_ovr_entry' id='eco_op_prod_s'>0</div>
						<div class='eco_ovr_entry' id='eco_op_prod_n'>0</div>
					</div>
					<div class='eco_ovr_line in'>
						<div class='eco_ovr_title' id='eco_title_ataxdist'>Alliance Tax Distribution</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_h'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_i'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_s'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_rec_n'>0</div>
					</div>
					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title' id='eco_title_fleetupkeep'>Fleet Upkeep</div>
						<div class='eco_ovr_entry' id='eco_flt_up_h'>0</div>
						<div class='eco_ovr_entry' id='eco_flt_up_i'>0</div>
						<div class='eco_ovr_entry' id='eco_flt_up_s'>0</div>
						<div class='eco_ovr_entry' id='eco_flt_up_n'>0</div>
					</div>
					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title'  id='eco_title_allianceupkeep'>Alliance Upkeep</div>
						<div class='eco_ovr_entry' id='eco_all_up_h'>0</div>
						<div class='eco_ovr_entry' id='eco_all_up_i'>0</div>
						<div class='eco_ovr_entry' id='eco_all_up_s'>0</div>
						<div class='eco_ovr_entry' id='eco_all_up_n'>0</div>
					</div>
					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title' id='eco_title_alliancetax'>Alliance Tax</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_h'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_i'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_s'>0</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_n'>0</div>
					</div>
					<div class='eco_ovr_line balance'>
						<div class='eco_ovr_title'  id='eco_title_balance'>Est. Income Balance</div>
						<div class='eco_ovr_entry' id='eco_balance_h'>0</div>
						<div class='eco_ovr_entry' id='eco_balance_i'>0</div>
						<div class='eco_ovr_entry' id='eco_balance_s'>0</div>
						<div class='eco_ovr_entry' id='eco_balance_n'>0</div>
					</div>

					<div class='eco_ovr_line out'>
						<div class='eco_ovr_title' id='eco_title_alliancetax'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_h'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_i'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_s'>&nbsp;</div>
						<div class='eco_ovr_entry' id='eco_tax_paid_n'>&nbsp;</div>
					</div>

					<div class='eco_ovr_line notenough'>
						<div class='eco_ovr_title' id='eco_title_upkeepdebt'>Upkeep-debt</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_h'>0</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_i'>0</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_s'>0</div>
						<div class='eco_ovr_entry' id='eco_upkeep_debt_n'>0</div>
					</div>



				</div>


				<div class='economy_box infra_bonus_box'>
					<div class='economy_box_header'>Bonuses</div>
					<div class='infra_entry'>
						<div class='infra_header'>Homeworld Mining Bonus</div>
						<div class='infra_value' id='eco_bonus_hw_mining'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Production Cost</div>
						<div class='infra_value' id='eco_bonus_prodcost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Research Cost</div>
						<div class='infra_value' id='eco_bonus_rescost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Development Cost</div>
						<div class='infra_value' id='eco_bonus_devcost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Facility Cost</div>
						<div class='infra_value' id='eco_bonus_faccost'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Alliance Upkeep</div>
						<div class='infra_value' id='eco_bonus_allyupkeep'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Unit Upkeep</div>
						<div class='infra_value' id='eco_bonus_upkeep'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Vault Size</div>
						<div class='infra_value' id='eco_bonus_vaultsize'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Alliance HW Mining Bonus</div>
						<div class='infra_value' id='eco_bonus_alliance_sector_hw_mining'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Alliance OP Mining Bonus</div>
						<div class='infra_value' id='eco_bonus_alliance_sector_op_mining'>0 %</div>
					</div>
					<div class='infra_entry'>
						<div class='infra_header'>Production Speed Bonus</div>
						<div class='infra_value' id='eco_bonus_production_speed'>0 %</div>
					</div>

				</div>

				<div class='slide_label'><div class='slide_heading'>Economy</div></div>

				<!--
				<div class='economy_box plate_heading'>
					<div class='slide_heading'>Economic Overview</div>
				</div>
				-->

			</div>
		</div>
	
	<div id='optionsslide' class='optionsslide'>
		<div class='optionsslide_content'>
			<div class='slide_label'><div class='slide_heading'>Options</div></div>
			<div class='options_frame avatar_selection'>
				<div class='lowpanel_header'>Customize Avatar</div>
				<div class='selected_member_avatar main_header_image_holder_dynamic avatar_selection_image_frame' id='avataruploader'>
					<img id='options_avatar_image' src='images/uploads/avatars/00066151_990.jpg'>
				</div>
				<div class='lowpanel_helpinfo'>Click image to upload a new avatar</div>
			</div>

			<div class='options_frame account_details_container'>
				<div class='lowpanel_header'>Refer new players</div>
				You can refer new players to AD2460 and earn referral credits when they buy their own credits.<br>
				Make sure they go to <br><b><span class='selectable_text'>http://www.ad2460.com?ref=66151</span></b><br> when they register, and it's done!<br>
	
	<a href='https://www.facebook.com/sharer/sharer.php?u=http://www.ad2460.com?ref=66151' target='_blank' onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://www.ad2460.com?ref=66151','FBshare','width=600,height=400');return false;">
	 Or simply share it on Facebook!
	</a>
	<br>
	<div style='cursor:pointer;' onclick='fetchReferrals()'>Click here to see your referrals</div>
		<!--Or just click here: <div class='fb-share-button' data-href='http://www.ad2460.com?ref=66151' data-layout='icon_link'></div>-->
	
			</div>

			<!--
			<div class='options_frame account_sms_container'>
				<div class='lowpanel_header'>SMS Options</div>
				<span style='display: block; text-align: left;'>Current Phone # is: 0000</span>
				<div class='tax_setting_title sms_header'>Update Phone #</div><input class='input_styling sms_input'>
				<div class='lightbutton160' onclick='updatePhoneNumber()'>
					<div class='buttontext24'>Change</div>
				</div>
			</div>
			-->

			<div class='options_frame account_sounds_container'>
				<div class='lowpanel_header'>Sound Options</div>
				SFX Volume<br>
				Off <input type='range' name='sfxvolume' id='sfxvolume' min='0' max='100' onchange='updateVolume()' style='width:200px'> Max<br/>
				Music Volume<br>
				Off <input type='range' name='musicvolume' id='musicvolume' min='0' max='100' onchange='updateVolume()' style='width:200px'> Max<br/>
				Combat SFX Volume<br>
				Off <input type='range' name='combatsfxvolume' id='combatsfxvolume' min='0' max='100' onchange='updateVolume()' style='width:200px'> Max<br/>
				Combat Music Volume<br>
				Off <input type='range' name='combatmusicvolume' id='combatmusicvolume' min='0' max='100' onchange='updateVolume()' style='width:200px'> Max<br/>
			</div>

			<div class='options_frame account_password_container'>
				<div class='lowpanel_header'>Change Password</div>
				<div class='tax_setting_title sms_header'>Current Password</div><input type='password' id='opt_cp1' class='input_styling sms_input'>
				<div class='tax_setting_title sms_header'>New Password</div><input type='password' id='opt_cp2' class='input_styling sms_input'>
				<div class='tax_setting_title sms_header'>Re-type Password</div><input type='password' id='opt_cp3' class='input_styling sms_input'>
				<div class='lightbutton160' onclick='changePwClick()'>
					<div class='buttontext24'>Submit</div>
				</div>
			</div>


			<div class='options_frame vacation_mode_container'>
				<div class='lowpanel_header'>Change Nickname</div>
				<input type='text' id='new_nickname' class='input_styling sms_input'>
				<div class='account_rename_text' style='text-align:center;margin-top:2px;margin-bottom:2px;'>You may change your nickname here. Letters and numbers only. Offensive name =  Closed account. Cost: 10 credits, no refunds.</div>
				<div class='lightbutton160' onclick='changeNicknameClick()'>
					<div class='buttontext24'>Do it</div>
				</div>

			</div>

<!--
			<div class='options_frame vacation_mode_container'>
				<div class='lowpanel_header'>Vacation-mode</div>
				<span class='account_rename_text'>I am going away for a while and would like to freeze my account for 1 credit per day. I understand the consequences.</span>
				<div style='height:18px;' id='vacation_mode_options_help'></div>
				<div class='lightbutton160' onclick='vacationModeClick()'>
					<div class='buttontext24'>Proceed</div>
				</div>
			</div>
-->
			<div class='options_frame mid_bottom_container'>
				<div class='lowpanel_header'>Pay 2 Win</div>
				<span class='account_rename_text'>Clicking the button below costs you 5 credits. Obviously, you win!</span>
				<div class='lightbutton160' onclick='pay2winClick()'>
					<div class='buttontext24'>Win</div>
				</div>

			</div>

			<div class='options_frame right_side_container' style='top: 10px;	height: 87px;	width: 372px;	left: 597px;' id='donate_credits_container'>
				<div class='lowpanel_header'>Donate Credits</div>
				<div class='tax_setting_title sms_header' style='width:100px;'>Nickname</div><input type='text' id='donate_nickname' class='input_styling sms_input'>
				<div class='tax_setting_title sms_header' style='width:173px;'>Credits</div><input type='number' value='5' min='5' max='100' step='5' id='donate_credits' class='input_styling sms_input' style='width:50px; text-align:center;'>
				<div class='lightbutton160' onclick='donateCredits1()'>
					<div class='buttontext24' id='donate_credits_button_text'>Donate Credits</div>
				</div>
				<!--
				<span class='account_rename_text'>
					To donate credits, you must have purchased credits recently.<br>
					You must have 15 or more credits remaining after the donation.<br>
					Donation service charge is 10%, rounded up.<br>
					A donation of 20 credits to a player will cost you 22 credits.
				</span>
				-->
			</div>

			<div class='options_frame right_side_container' style='width: 372px;	left: 597px;	top: 122px;	height: 60px;' id='auto_resize_gui_container'>
				<div class='lowpanel_header'>Auto-resize GUI</div>
				<select id='auto_resize_gui_dropdown' class='input_styling'><option value='0'>No</option><option value='1'>Yes</option></select>
				<div class='lightbutton160' onclick='updateAutoResizeGui()'>
					<div class='buttontext24'>Set</div>
				</div>
			</div>


			<div class='options_frame right_side_container' style='width: 372px;	left: 597px;	top: 207px;	height: 106px;'>
				<div class='lowpanel_header'>Produced ships go to</div>
				<div class='account_rename_text'>When a ship has been built, move it automatically to my</div>
				<select id='move_new_ships_to' class='input_styling'>
					<option value='Base fleet'>Base fleet</option>
					<option value='Largest Fleet'>Largest fleet</option>
					<option value='Smallest Fleet'>Smallest fleet</option>
				<!--
					<option value='Outpost : Top strength'>Outpost : Top strength</option>
					<option value='Outpost : Top potential'>Outpost : Top potential</option>
					<option value='Outpost : Top output'>Outpost : Top output</option>
					<option value='Outpost : Least strength'>Outpost : Least strength</option>
					<option value='Outpost : Newest'>Outpost : Newest</option>
					<option value='Outpost : Auto'>Outpost : Auto</option>
				-->

				</select>
				<div class='lightbutton160' onclick='updateNewshipsGoToClick()'>
					<div class='buttontext24'>Set</div>
				</div>
				<div class='account_rename_text' id='move_new_ships_to_description'>Click the help-button for more info.</div>
			</div>

			<div class='options_frame vip_options' id='vip_pack_option'>
				<div class='lowpanel_header'>V.I.P. Package</div>
				<!--<div class='vip_icon_full'></div>-->
				<span class='account_rename_text'>Get VIP-status for 30 days. Get your own chat-icon, vip-badge and free renaming, commander customisation and wargames for the duration. For full details click the help-icon.</span>
				<div class='chat_color_select'>
					<span class='chat_select_text'> Select your chat color:</span>
					<select class='chat_color_preview chat_player_name col_01' id='vip_chat_color_select' onchange='updateChatColorSelect()' style='background-color:black;'>
						<option value='1' selected='selected' class='chat_player_name col_01'>Wanstey</option>
						<option value='2' class='chat_player_name col_02'>Wanstey</option>
						<option value='3' class='chat_player_name col_03'>Wanstey</option>
						<option value='4' class='chat_player_name col_04'>Wanstey</option>
						<option value='5' class='chat_player_name col_05'>Wanstey</option>
						<option value='6' class='chat_player_name col_06'>Wanstey</option>
						<option value='7' class='chat_player_name col_07'>Wanstey</option>
						<option value='8' class='chat_player_name col_08'>Wanstey</option>
						<option value='9' class='chat_player_name col_09'>Wanstey</option>
						<option value='10' class='chat_player_name col_10'>Wanstey</option>
						<option value='11' class='chat_player_name col_11'>Wanstey</option>
						<option value='12' class='chat_player_name col_12'>Wanstey</option>
						<option value='13' class='chat_player_name col_13'>Wanstey</option>
						<option value='14' class='chat_player_name col_14'>Wanstey</option>
						<option value='15' class='chat_player_name col_15'>Wanstey</option>
						<option value='16' class='chat_player_name col_16'>Wanstey</option>
						<option value='17' class='chat_player_name col_17'>Wanstey</option>
						<option value='18' class='chat_player_name col_18'>Wanstey</option>
						<option value='19' class='chat_player_name col_19'>Wanstey</option>
						<option value='20' class='chat_player_name col_20'>Wanstey</option>
					</select>
				</div>
				<span class='icon_select_text'> Select VIP-icon:</span>
				<div class='vip_icon_select_container' id='icon_selection'>
					<img class='vip_icon_select' id='vip_icon_01' src='/images/icons/vip/forum/vip01.png' onclick='selectVipIcon(1)'>
					<img class='vip_icon_select' id='vip_icon_02' src='/images/icons/vip/forum/vip02.png' onclick='selectVipIcon(2)'>
					<img class='vip_icon_select selected' id='vip_icon_03' src='/images/icons/vip/forum/vip03.png' onclick='selectVipIcon(3)'>
					<img class='vip_icon_select' id='vip_icon_04' src='/images/icons/vip/forum/vip04.png' onclick='selectVipIcon(4)'>
					<img class='vip_icon_select' id='vip_icon_05' src='/images/icons/vip/forum/vip05.png' onclick='selectVipIcon(5)'>
				</div>
				<div class='vip_purchase_button' onclick='purchaseVipClick()'>Purchase V.I.P. Pack</div>
			</div>

			<div class='options_frame vip_options' id='vip_pack_option_2' style='display:none'>
				<div class='lowpanel_header'>V.I.P. Package</div>
				<!--<div class='vip_icon_full'></div>-->
				<span class='account_rename_text' id='options_vip_timer'>Vip to 23.06.2016 23:44</span>
				<div class='lightbutton160' onclick='renewVip()'>
					<div class='buttontext24'>Add 30 days</div>
				</div>
				<div style='font-weight: 700; width: 100%; text-align: center; color: black; font-size: 15px; margin-top: 3px; margin-bottom: 3px;font-family: Orbitron, sans-serif; background-color: rgba(255,255,255,0.2);border-radius:3px;'>Change color (3 credits)</div>
				<select class='chat_color_preview chat_player_name col_01' id='vip_chat_color_select_extend' onchange='updateChatColorSelectExtend()' style='background-color:black; width: 225px;margin-bottom: 3px;'>
					<option value='1' selected='selected' class='chat_player_name col_01'>Wanstey</option>
					<option value='2' class='chat_player_name col_02'>Wanstey</option>
					<option value='3' class='chat_player_name col_03'>Wanstey</option>
					<option value='4' class='chat_player_name col_04'>Wanstey</option>
					<option value='5' class='chat_player_name col_05'>Wanstey</option>
					<option value='6' class='chat_player_name col_06'>Wanstey</option>
					<option value='7' class='chat_player_name col_07'>Wanstey</option>
					<option value='8' class='chat_player_name col_08'>Wanstey</option>
					<option value='9' class='chat_player_name col_09'>Wanstey</option>
					<option value='10' class='chat_player_name col_10'>Wanstey</option>
					<option value='11' class='chat_player_name col_11'>Wanstey</option>
					<option value='12' class='chat_player_name col_12'>Wanstey</option>
					<option value='13' class='chat_player_name col_13'>Wanstey</option>
					<option value='14' class='chat_player_name col_14'>Wanstey</option>
					<option value='15' class='chat_player_name col_15'>Wanstey</option>
					<option value='16' class='chat_player_name col_16'>Wanstey</option>
					<option value='17' class='chat_player_name col_17'>Wanstey</option>
					<option value='18' class='chat_player_name col_18'>Wanstey</option>
					<option value='19' class='chat_player_name col_19'>Wanstey</option>
					<option value='20' class='chat_player_name col_20'>Wanstey</option>
				</select>
				<div class='lightbutton160' onclick='changeVipColor()'>
					<div class='buttontext24'>Set new color</div>
				</div>

			</div>

			<!--
			<div class='options_frame combat_full_text_option_container'>
				<div class='lowpanel_header'>Combat details</div>
				<span class='account_rename_text'>Some devices are fast enough to handle the full details in combat, others are not.</span>
				<div style='height:18px;' id='full_combat_options_help'></div>
				<div class='lightbutton160' onclick='toggleFullCombatOutput()'>
					<div class='buttontext24' id='show_full_combat_text_button_text'>OFF</div>
				</div>
			</div>
			-->
		</div>
	</div>

	
	<div id='supportslide' class='optionsslide'>
		<div class='optionsslide_content'>
			<div class='slide_label'><div class='slide_heading'>Support</div></div>

			<div class='options_frame support_box_1'>
				<div class='lowpanel_header'>Start new support ticket</div>
				<input type='text' maxlength='25' placeholder='Type the title here' id='support_title' style='width:90%;' onkeydown='handleSupportTitleKeydown(event)'><br>
				<textarea id='support_body' maxlength='1000' placeholder='Type the support request here' style='width: 90%; height: 230px; margin: 0px; padding: 0px; margin-top: 3px;'></textarea>
				<div class='lightbutton160' onclick='fileNewSupportTicket()'>
					<div class='buttontext24'>File ticket</div>
				</div>
				Cost : 2 credits.
			</div>

			<div class='options_frame support_box_2' >
				<div class='lowpanel_header'>My support tickets</div>
				<div class='' id='support_list_container' style='width:100%;height:212px;overflow:auto;'>
				No tickets found.
				</div>

			</div>

			<div class='options_frame support_box_3'>
				<div class='lowpanel_header'>Selected ticket</div>
				<div class='selected_support_container' id='selected_support_container'>
				Welcome to our ingame support system.<br>
				If you have a general question about the game, consider using the forums, and not support. Chances are other players know the answer and can respond faster.<br>
				If you wish to report a bug, you can use the forums for that as well.<br>
				We will try to respond to any support-ticket within 24 hours, but normally much faster.<br>
				Keep it clean, behave, and be patient, we will help you as soon as we can.<br><br>
				Yes, a new support-ticket costs 2 credits to file. We need to eat too.<br>
				- Spinner and Chairman


				</div>
			</div>
		</div>
	</div>

	
<!-- Bonuses Slide -->
        <div id='bonusslide' style='position: absolute; top: 24px; left: 1200px; right: 0px; bottom: 100px; opacity: 1;z-index: 3; display:none;'>
			<div style='position: absolute; top: 0px; left: 0px; height: 576px; width: 1000px; background: url(images/fixed/techslideglas.png); overflow:hidden;'>
				<div class='slide_label'><div class='slide_heading'>Active Bonuses</div></div>
				<div class='tutorial_image'></div>
				<div class='tutorial_content_container'>
					<div class='tutorial_header_1'>Active Bonuses</div>
					<div class='tutorial_body'>
						This is a list of your current active bonuses from researches, the tech tree or potentially other sources.<br>
						<div id='active_bonuses_list'>
							<div class='active_bonus_entry'>+10 percent hull on all energy capital ships</div>
							<div class='active_bonus_entry'>+5 percent weaponstrength (primary weapons) on all energy capital ships</div>
							<div class='active_bonus_entry'>+5 percent shieldstrength on all energy capital ships</div>
						</div>
					</div>
				</div>
			</div>
		</div>
<!-- End Bonuses Slide -->

	
	<div class='spy_report' id='single_infiltration_report' style='display:none; color:white; width: 501px;    border: 1px solid white;  border-radius: 5px;  z-index: 110;  background-color: rgba(0,0,0,0.9);  left: 422px;  top: 38px;  padding: 9px;'>
		<div class='infopanel_header' style='cursor:move;' id='intel_report_type_location'>Infiltration-report: Wallamoloom</div>
		<div class='bottomslide_close' id='player_info_close' onclick='closeSingleIntelReport()'><img src='images/fixed/cancel.png'></div>

		<div class='planetspy_container spy_player_details'>
			<div class='spy_report_player_planet'>
				<img class='target_player_img' id='intel_report_planet_type' src='images/planets/outpost_planets/planettype23.jpg'>
				<div class='target_player_img_shader'></div>
			</div>
			<div class='top_spy_list' onclick="openTopSpyList('recent_battles')">
				<div class='top_outpost_list battles_img' id='recent_battles'>
					<div class='top_list_header'>Recent Battles</div>
					<div class='outposts_list_container battles' id='recent_battles_container'>
						<!-- Per entry
						<div class='recent_battle_container'>
							<div class='recent_battle_vs'>vs.</div>
							<div class='recent_battle_opponent'>Some dude</div>
							<div class='recent_battle_result'>W</div>
						</div>
						END PER ENTRY -->
					</div>
					<div class='helptext'>Click to expand view</div>
				</div>
			</div>
			<div class='planetspy_info_title'>Present Strength:</div>
			<div class='planetspy_info_entry' id='intel_report_present_strength'>250.512</div>
			<div class='planetspy_info_title'>Present Fleets:</div>
			<div class='planetspy_info_entry' id='intel_report_present_fleets'>15</div>
			<div class='planetspy_info_title'></div>
			<div class='planetspy_info_entry'></div>
			<div class='planetspy_info_title'>Cannons</div>
			<div class='planetspy_info_entry' id='intel_report_cannons'>175</div>
			<div class='planetspy_info_title'>Shield-boosters</div>
			<div class='planetspy_info_entry' id='intel_report_present_shieldgens'>175</div>
			<div class='planetspy_info_title'>Artillery</div>
			<div class='planetspy_info_entry' id='intel_report_present_artillery'>44</div>
			<div class='planetspy_info_title'>Stations</div>
			<div class='planetspy_info_entry' id='intel_report_present_stations'>3</div>
			<!--
			<div class='planetspy_info_title'></div>
			<div class='planetspy_info_entry'></div>
			-->
			<div class='planetspy_info_title'>Present Frigates</div>
			<div class='planetspy_info_entry' id='intel_report_present_frigates'>789</div>
			<div class='planetspy_info_title'>Present Cruisers</div>
			<div class='planetspy_info_entry' id='intel_report_present_cruisers'>88</div>
			<div class='planetspy_info_title'>Present Battleships</div>
			<div class='planetspy_info_entry' id='intel_report_present_battleships'>2</div>
			<div class='planetspy_info_title'>Present Carriers</div>
			<div class='planetspy_info_entry' id='intel_report_present_carriers'>5</div>
			<div class='planetspy_info_title'>Present Minor Ships</div>
			<div class='planetspy_info_entry' id='intel_report_present_minors'>317</div>
			<div class='planetspy_info_title'></div>
			<div class='planetspy_info_entry'></div>

			<div id='intel_report_stored_res_container'>
				<div class='planetspy_info_title'>Stored resources:</div>
				<div class='planetspy_info_entry'></div>
				<div class='outpost_levels spy_holdings'>
					<div class='resouce_level hs_level' id='intel_report_own_hassium'>128.635</div>
					<div class='resouce_level sr_level' id='intel_report_own_strontium'>408.127</div>
					<div class='resouce_level nd_level' id='intel_report_own_neodymium'>610.842</div>
					<div class='resouce_level in_level' id='intel_report_own_indium'>59.689</div>
				</div>
			</div>
			<!--
			<div id='intel_report_ally_res_container'>
				<div class='planetspy_info_title'>Total Bank Holdings:</div>
				<div class='planetspy_info_entry'></div>
				<div class='outpost_levels spy_holdings'>
					<div class='resouce_level hs_level' id='intel_report_alliance_hassium'>0</div>
					<div class='resouce_level sr_level' id='intel_report_alliance_strontium'>0</div>
					<div class='resouce_level nd_level' id='intel_report_alliance_neodymium'>0</div>
					<div class='resouce_level in_level' id='intel_report_alliance_indium'>0</div>
				</div>
			</div>
			-->
		</div>
		<div class='planetspy_container spy_top_lists'>
			<div class='spy_target_info_container'>
				<div class='outpost_mainpanel_header'>Owner</div>
				<div class='spy_report_owner' id='intel_report_owner_name'>George Perp</div>
				<div class='spy_report_alliance' id='intel_report_owner_alliance_name'>(ROXY ALLIANCE)</div>
				<div class='outpost_mainpanel_header'>Starmap Location</div>
				<div class='outpost_coords' id='intel_report_target_coordinates'>[1:12:3:8.4]</div>
			</div>
			<div class='top_spy_list' onclick="openTopSpyList('top_outposts_2')">
				<div class='top_outpost_list outposts_img' id='top_outposts_2'>
					<div class='top_list_header'>Top Outposts</div>
					<div class='outposts_list_container' id='intel_report_outpost_list'>
						<!-- per entry
						<div class='planetspy_info_title'>Greppaloopi</div>
						<div class='planetspy_info_def'>
							<img src='../images/icons/defense_beacon_select.png' height='15'>
						</div>
						<div class='planetspy_info_entry coords'>[ 12:08:14:2.1 ]</div>
						END PER ENTRY -->
					</div>
					<div class='helptext'>Click to expand view</div>
				</div>
			</div>
			<div class='planetspy_info_title'>Total Strength</div>
			<div class='planetspy_info_entry' id='intel_report_owned_strength'>25400</div>
			<div class='planetspy_info_title'>Owned Fleets</div>
			<div class='planetspy_info_entry' id='intel_report_owned_fleets'>12</div>
			<div class='planetspy_info_title'></div>
			<div class='planetspy_info_entry'></div>
			<div class='planetspy_info_title'>Player Level</div>
			<div class='planetspy_info_entry' id='intel_report_player_level'>6</div>
			<div class='planetspy_info_title'>Player Score Ranking</div>
			<div class='planetspy_info_entry' id='intel_report_player_score_ranking'>#22</div>
			<div class='planetspy_info_title'>Tech Tilt:</div>
			<div class='planetspy_info_entry' id='intel_report_tech_tilt'>StronTech</div>
			<div class='planetspy_info_title'></div>
			<div class='planetspy_info_entry'></div>
			<div class='planetspy_info_title'>Owned Frigates</div>
			<div class='planetspy_info_entry' id='intel_report_owned_frigates'>789</div>
			<div class='planetspy_info_title'>Owned Cruisers</div>
			<div class='planetspy_info_entry' id='intel_report_owned_cruisers'>88</div>
			<div class='planetspy_info_title'>Owned Battleships</div>
			<div class='planetspy_info_entry' id='intel_report_owned_battleships'>2</div>
			<div class='planetspy_info_title'>Owned Carriers</div>
			<div class='planetspy_info_entry' id='intel_report_owned_carriers'>5</div>
			<div class='planetspy_info_title'>Owned Minor Ships</div>
			<div class='planetspy_info_entry' id='intel_report_owned_minors'>5</div>
			<div class='planetspy_info_title'></div>
			<div class='planetspy_info_entry'></div>

			<div id='intel_report_ally_res_container'>
				<div class='planetspy_info_title'>Total Bank Holdings:</div>
				<div class='planetspy_info_entry'></div>
				<div class='outpost_levels spy_holdings'>
					<div class='resouce_level hs_level' id='intel_report_alliance_hassium'>0</div>
					<div class='resouce_level sr_level' id='intel_report_alliance_strontium'>0</div>
					<div class='resouce_level nd_level' id='intel_report_alliance_neodymium'>0</div>
					<div class='resouce_level in_level' id='intel_report_alliance_indium'>0</div>
				</div>
			</div>

			<!--
	        <div class='top_spy_list' onclick='openTopSpyList("top_bankers")' id='intel_report_alliance_section'>
	            <div class='top_outpost_list bankers_img' id='top_bankers'>
	                <div class='top_list_header'>Top Bankers</div>
	                <div class='banker_list_heading'>
	                    <div class='planetspy_info_title banker'>Bankers:</div>
	                    <div class='planetspy_info_entry travel'>TT</div>
	                    <div class='planetspy_info_entry str'>STR</div>
	                </div>
	                <div class='outposts_list_container bankers' id='intel_top_bankers_list'>
	                </div>
	                <div class='helptext' id='spy_banker_help'>Click to expand view</div>
	            </div>
	        </div>
			-->

			<div id='intel_report_outpost_section' style='float: left; display: none;'>
				<div class='planetspy_info_title'>Outpost Level</div>
				<div class='planetspy_info_entry' id='intel_report_outpost_level'>7</div>
				<div class='planetspy_info_title'>Current Output</div>
				<div class='planetspy_info_entry' id='intel_report_outpost_output'>12400 u/h</div>
				<div class='planetspy_info_title'>Outpost Potential</div>
				<div class='planetspy_info_entry' id='intel_report_outpost_potential'>10/10</div>
				<div class='planetspy_info_title'>Resource Tilt</div>
				<div class='planetspy_info_entry' id='intel_report_outpost_resource_tilt'>Nd + Sr</div>
				<div class='planetspy_info_title'>Travel Time</div>
				<div class='planetspy_info_entry' id='intel_report_outpost_traveltime'>20m</div>
			</div>
		</div>
		<!--
		<div class='' style='  position: absolute; bottom: 20px;  right: 61px;'>
			<div class='lightbutton160' onclick="closeSingleIntelReport();">
				<div class='buttontext24'>Close</div>
			</div>
		</div>
		-->
	</div>

	

	
	<div class='sm_line_container' id='sm_line_container' style='display: none; opacity: 1;'>
		<div class='sm_line horizontal' id='sm_line_01' style='transform: translate(1800px, 0px);'></div>
		<div class='sm_line horizontal' id='sm_line_02' style='transform: translate(1800px, 0px);'></div>
		<div class='sm_line vertical' id='sm_line_03' style='transform: translate(0px, 1200px);'></div>
		<div class='sm_line vertical' id='sm_line_04' style='transform: translate(0px, 1200px);'></div>
		<div class='sm_line vertical' id='sm_line_05' style='transform: translate(0px, 1200px);'></div>
		<div class='sm_grid'>
			<div class='sm_line vertical' id='sm_line_06' style='transform: translate(0px, 1200px);'></div>
			<div class='sm_line vertical' id='sm_line_07' style='transform: translate(0px, 1200px);'></div>
			<div class='sm_line vertical' id='sm_line_08' style='transform: translate(0px, 1200px);'></div>
			<div class='sm_line horizontal' id='sm_line_09' style='transform: translate(1200px, 0px);'></div>
			<div class='sm_line horizontal' id='sm_line_10' style='transform: translate(1200px, 0px);'></div>
			<div class='sm_line horizontal' id='sm_line_11' style='transform: translate(1200px, 0px);'></div>
		</div>
	</div>
	
		<div class='adv_button gameinfobutton' id='gameinfo'  title='Gameinfo / Tutorial'><img src='images/icons/buttons/UI_gameinfo_icon.png'></div>
	
	<div class='fullnewspanel' id='fullnewspanel'>
		<div class='fullnews_top_header' id='fullnews_top_header'>
			<span>Latest News</span>
			<img class='close_fullnews' id='close_fullnews' src='images/icons/close_news.png' onclick='toggleFullNews()'>

		</div>
		<div class='fullnewsscroller' id='fullnewsscroller'>
			<div class='fullnewscontainer' id='fullnewscontainer'>

			</div>
		</div>
	</div>

	<div class='tickerpanel' id='tickerpanel'>
		<div class='tickerpanel_top_header' id='tickerpanel_top_header'>
			<span>Galaxy News</span>
			<img class='close_tickerpanel' id='close_tickerpanel' src='images/icons/close_news.png' onclick='toggleTickerPanel()'>
		</div>
		<div class='tickerscroller' id='tickerscroller'>
			<div class='tickercontainer' id='galactic_news_container'>
			</div>
		</div>
		<div class='ticker_helper'>Galactic news headlines, brought to you by Open Octa Millenium PowerHouse! (OOMPH!)</div>
	</div>

	
		<div class='launchslide' id='launchslide'>
			<div class='launchslide_bg'>
				<div class='launchslide_content'>
					<div class='infopanel_header'>Launch Preparation / Combat Readyness</div>
					<div id='launch_op_grace_warning' class='launch_fleet_box' style='position: absolute; left: 35px; top: 30px; width: 149px; color: yellow; padding: 5px; text-align: center; background: rgba(0,0,0,0.5); display:none;'>
						Warning<br>If you attack this outpost, all of your current outposts will lose their planet-specific grace.
					</div>
					<div id='launch_no_loot_warning' class='launch_fleet_box' style='position: absolute; left: 35px; top: 30px; width: 149px; color: yellow; padding: 5px; text-align: center; background: rgba(0,0,0,0.5); display:none;'>
						Warning<br>You will not be able to steal any resources from this target
					</div>
					<div id='launch_op_min_max_box' class='launch_fleet_box' style='position: absolute; left: 35px; top: 170px; width: 149px; color: yellow; padding: 5px; text-align: center; background: rgba(0,0,0,0.5); display:none;'>
					Attack-strength must be<br>
					<span id='min_op_launch_strength'></span> - <span id='max_op_launch_strength'></span><br>
					</div>

					<div class='launch_fleet_select launch_fleet_box'>
						<div class='launch_fleet_box_header'>Available Fleets</div>
						<div class='launch_fleet_scroll_outer'>
							<div class='scrollBG launch_fleet_scrollbg'>
								<div class='launch_fleet_scroll_container'>
									<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='launch_fleet_select_scroller'>

									</div>
								</div>
								<div class='lowpanel_table_headers launch_fleet_table'>
									<div class='table_fleet_name launch_fleet_table launch'>Fleet Name</div>
									<div class='table_fleet_owner owner_heading launch_fleet_table launch'>Owner</div>
									<div class='table_fleet_type launch_fleet_table launch'></div>
									<div class='table_fleet_size launch_fleet_table launch'>Cap</div>
									<div class='table_fleet_size launch_fleet_table launch'>Min</div>
									<div class='table_fleet_size launch_fleet_table launch'>T</div>
									<div class='table_fleet_strength launch_fleet_table'>Str</div>
								</div>
							</div>
							<div class='scrollbuttons_launch'>
								<div class='scrollbutton_up' id='launch_fleet_select_scroller_up' onclick="myScroll('launch_fleet_select_scroller',181,500,'scrollBG')"></div>
								<div class='scrollbutton_down' id='launch_fleet_select_scroller_down' onclick="myScroll('launch_fleet_select_scroller',-181,500,'scrollBG')"></div>
							</div>
						</div>
					</div>
					<div class='launch_fleet_overview launch_fleet_box'>
						<div class='launch_fleet_target_image'>
							<img src='../images/planets/planettype04.png'>
						</div>
						<div class='launch_fleet_overview_details'>
							<img src='images/icons/intel.png' style='position: absolute; top: 107px; height: 27px; right: 4px; background-color: grey; border-bottom: 1px solid white; border-right: 1px solid white; border-top: 1px solid darkgrey; border-left: 1px solid darkgrey; cursor:pointer;' onclick='openLaunchIntel()'>
							<div class='launch_fleet_box_header'>Contingent Details</div>
							<div class='launch_fleet_det_header'>Fleets Selected:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_fleets_selected'>0</div>
							<div class='launch_fleet_det_header'>Strength:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_strength'>-</div>
							<div class='launch_fleet_det_header'>Ships:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_ships'>-</div>
							<div class='launch_fleet_det_header'>Cargo Space:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_cargo_space'>-</div>
							<div class='launch_fleet_det_header'>Tech Tilt:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_tech_tilt'>-</div>

							<div class='launch_fleet_mid_box_header'>Available Target Details</div>
							<div class='launch_fleet_det_header'>Location:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_target_location_name'>-</div>
							<div class='launch_fleet_det_header'>Player</div>
							<div class='launch_fleet_det_entry' id='lf_ov_target_player_name'>-</div>
							<div class='launch_fleet_det_header'>Alliance:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_target_location_alliance_name'>-</div>
							<div class='launch_fleet_det_header'>Strength:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_target_location_strength'>-</div>
							<div class='launch_fleet_det_header'>Present fleets:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_target_location_fleets_present'>-</div>
							<div class='launch_fleet_det_header'>Present ships:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_target_location_ships'>-</div>
							<div class='launch_fleet_det_header'>Tech Tilt:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_target_location_tech_tilt'>-</div>
							<div class='launch_fleet_det_header'>Travel-time:</div>
							<div class='launch_fleet_det_entry' id='lf_ov_target_location_travel_time'>-</div>
						</div>
					</div>
					<div class='launch_fleet_help' style='display: none;'>
						Select fleets to participate in the operation from the list above. Selected fleets will be moved to the 'Selected Fleets' list and their capacities added to the 'Contigent Details'.<br>Commanding Officer is always the highest ranking commander from the selected fleets.
					</div>

					<div class='lightbutton160 launch_fleet_ships' id='launch_fleet_ships' onclick='shipListUpLaunchcontingent()'>
						<div class='buttontext24'>View Selection</div>
					</div>

					<div title='Reload Alliance Fleets' class='refresh_alliance_fleets_button' onclick='refreshAllianceFleetsClick()'></div>

					<div class='lightbutton160 launch_fleet_bonuses' id='launch_fleet_bonuses' onclick='showSelectedLaunchCompoBonuses()'>
						<div class='buttontext24'>View Bonuses</div>
					</div>
					<!--
					<div class='fixed_button fixed_button_320 launch_fleet_ship_view' id='launch_fleet_ships' onclick='shipListUpLaunchcontingent()'>
						<div class='fixed_button_regular regular_320' style='opacity: 1;'></div>
						<div class='fixed_button_hover green_320' style='opacity: 0;'></div>
						<div class='fixed_button_click green_320'></div>
						<div class='dyna_button_text type2'>View Selected Fleets Ships</div>
                    </div>
					-->

					<div class='launch_fleet_commander launch_fleet_box'>
						<div class='launch_fleet_box_header'>Commanding Officer</div>
						<div class='launch_fleet_det_header'>Name:</div>
						<div class='launch_fleet_det_entry' id='lf_cmd_name'>-</div>
						<div class='launch_fleet_det_header'>Rank:</div>
						<div class='launch_fleet_det_entry' id='lf_cmd_rank'>-</div>
						<div class='launch_fleet_det_header'>Commanding:</div>
						<div class='launch_fleet_det_entry' id='lf_cmd_commanding'>-</div>
						<div class='launch_fleet_det_header'>Perception:</div>
						<div class='launch_fleet_det_entry' id='lf_cmd_perception'>-</div>
						<div class='launch_fleet_det_header'>Tactics:</div>
						<div class='launch_fleet_det_entry' id='lf_cmd_tactics'>-</div>
						<div class='launch_fleet_det_header'>Morale:</div>
						<div class='launch_fleet_det_entry' id='lf_cmd_morale'>-</div>
						<div class='launch_fleet_det_header'>Fleet Limit:</div>
						<div class='launch_fleet_det_entry' id='lf_cmd_fleet_limit'>-</div>
					</div>
					<div class='launch_fleet_tactics launch_fleet_box' id='launch_fleet_tactics' >
						<div class='launch_fleet_box_header'>Tactical Dispositions</div>
						<div class='tactical_inner_subset launch1'>
							<div class='tactical_list_header tacticslide'>Target Priority</div>

							<div id='launch_target_priority_1' class='tactical_list tactics_launch' onclick='selectLaunchTactic(this.id)'><span>Firepower</span></div>
							<!--<div id='launch_target_priority_2' class='tactical_list tactics_launch' onclick='selectLaunchTactic(this.id)'><span>Primary Firepower</span></div>-->
							<div id='launch_target_priority_3' class='tactical_list tactics_launch' onclick='selectLaunchTactic(this.id)'><span>Least Hull</span></div>
							<div id='launch_target_priority_4' class='tactical_list tactics_launch' onclick='selectLaunchTactic(this.id)'><span>Most Hull</span></div>
							<div id='launch_target_priority_5' class='tactical_list tactics_launch' onclick='selectLaunchTactic(this.id)'><span>Least Manoeuvrability</span></div>
							<div id='launch_target_priority_6' class='tactical_list tactics_launch' onclick='selectLaunchTactic(this.id)'><span>Most Manoeuvrability</span></div>
							<div id='launch_target_priority_7' class='tactical_list tactics_launch' onclick='selectLaunchTactic(this.id)'><span>Closest Ship</span></div>
						</div>
						<div class='tactical_inner_subset launch2'>
							<div class='tactical_list_header tacticslide'>Target Switching</div>
							<div id='launch_target_switching_1' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>No</span></div>
							<div id='launch_target_switching_2' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Yes</span></div>
						</div>

						<div class='tactical_inner_subset launch3'>
							<div class='tactical_list_header tacticslide'>Fighter Priority</div>
							<div id='launch_fighter_priority_1' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Corvette defense</span></div>
							<div id='launch_fighter_priority_2' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Capital ship defense</span></div>
							<div id='launch_fighter_priority_4' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Defend all</span></div>
							<div id='launch_fighter_priority_3' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Ship-to-ship</span></div>
						</div>
						<div class='tactical_inner_subset launch4'>
							<div class='tactical_list_header tacticslide'>Corvette Priority</div>
							<div id='launch_corvette_priority_1' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Defensive</span></div>
							<div id='launch_corvette_priority_2' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Offensive</span></div>
						</div>
						<div class='tactical_inner_subset launch5'>
							<div class='tactical_list_header tacticslide'>Retreat condition</div>
							<!--<div class='tactical_list_subheader'><span>Call retreat at</span></div>-->
							<div>
								<div id='launch_retreat_percentage_1' class='tactical_list tactics_launch_percent' onclick='selectLaunchTactic(this.id)'><span>Never</span></div>
								<div id='launch_retreat_percentage_2' class='tactical_list tactics_launch_percent' onclick='selectLaunchTactic(this.id)'><span>15%</span></div>
								<div id='launch_retreat_percentage_3' class='tactical_list tactics_launch_percent' onclick='selectLaunchTactic(this.id)'><span>30%</span></div>
								<div id='launch_retreat_percentage_4' class='tactical_list tactics_launch_percent' onclick='selectLaunchTactic(this.id)'><span>45%</span></div>
								<div id='launch_retreat_percentage_5' class='tactical_list tactics_launch_percent' onclick='selectLaunchTactic(this.id)'><span>60%</span></div>
								<div id='launch_retreat_percentage_6' class='tactical_list tactics_launch_percent' onclick='selectLaunchTactic(this.id)'><span>75%</span></div>
							</div>
							<div class='tactical_list_subheader'><span>of remaining</span></div>
							<div>
								<div id='launch_retreat_type_1' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Firepower</span></div>
								<div id='launch_retreat_type_2' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Capital Ships</span></div>
								<div id='launch_retreat_type_3' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Total Hull</span></div>
							</div>
							<div class='tactical_list_subheader'><span>Retreat if unwinnable?</span></div>
							<div>
								<div id='launch_retreat_if_unwinnable_1' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>No</span></div>
								<div id='launch_retreat_if_unwinnable_2' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Yes</span></div>
							</div>
							<div class='tactical_list_subheader'><span>But if losses are even...</span></div>
							<div>
								<div id='launch_retreat_if_even_1' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Stay and Fight</span></div>
								<div id='launch_retreat_if_even_2' class='tactical_list tactics_launch_short' onclick='selectLaunchTactic(this.id)'><span>Retreat</span></div>
							</div>
						</div>
					</div>
					<div class='launch_fleet_xp_info' id='launch_fleet_xp_info' >
							XP Multiplier : 0.5
					</div>
					<div class='launch_fleet_launch_button'>
						<div class='fixed_button fixed_button_160_double' id='launch_fleets_button' onclick='launchOffensiveFleetClick()'>
							<div class='fixed_button_regular_double'></div>
							<div class='fixed_button_hover blue_double'></div>
							<div class='fixed_button_click blue_double'></div>
							<div id='launch_button_text' class='dyna_button_text type3'>Launch</div>
						</div>
					</div>
					<!--
					<div class='launch_fleet_cancel'>
						<div class='fixed_button fixed_button_140_condensed' id='cancel_launch_button' onclick="closeSlide('launchslide');">
							<div class='fixed_button_regular_condensed'></div>
							<div class='fixed_button_hover red22'></div>
							<div class='fixed_button_click red22'></div>
							<div class='dyna_button_text type3'>Cancel</div>
						</div>
					</div>
					-->
				</div>
				<div class='slide_label'><div class='slide_heading'>Launch fleets</div></div>
			</div>
		</div>


	
			<!-- Ship configuration -->
			<div class='bottomslider' id='shipconfigpanel'>
				<div class='helpcolumn1of3' id='configColumn1'>

					<div class='helpslide_header'>Ship Reconfiguration</div>
					<!-- Per capital ship
					<div class='shiptype_select'>
						<div class='shiptype_name'>Hammerhead</div>
						<div class='shiptype_img'>
							<img src='images/icons/miniships/hammerhead_mini.png'  />
						</div>
					</div>
					End Per capital ship -->

					<div class='column_helptext'>Select a ship type to reconfigure.</div>
				</div>
				<div class='helpcolumn2of3 minor_ship_assign_column_2' id='configColumn2'>
					<div class='column2header column2'>The Starbeamer</div>
					<div class='infopanel_header minor_ship_assign_column_2' style='text-transform:none; font-size: 12px; font-weight: 300;'>Slots Available: 50</div>
					<!-- Per small ship
					<div class='shiptype_select minor_ship'>
						<div class='shiptype_name'>Orb</div>
						<div class='shiptype_img'>
							<img src='images/icons/miniships/403_mini.png'  />
						</div>
					</div>
					<div class='shiptype_select minor_ship_assign'>
						<input class='inputfield50 minor_ship_assign_input' />
					</div>
					End per small ship -->


				</div>
				<div class='helpcolumn3of3 minor_ship_assign_column_3' id='configColumn3'>
					<div class='minor_ship_assign_help'>Surplus fighters will be moved to the Storage Fleet.<br />Ships not available will not be fitted.</div>
					<div class='column_button'>
						<div class='column_button_name'>Complete Reconfiguration</div>
					</div>

				</div>
				<div class='helpcolumnseparator1third'></div>
				<div class='helpcolumnseparator2third minor_ship_assign_separator_2'></div>
			</div>
			<!-- End configuration panel -->

			<!-- Ship Reassignment panel -->
			<div class='bottomslider' id='shipreassignpanel'>
				<div id='assignColumn1' class='helpcolumn1of3'>
					<div class='columnhelper' id='fm_noob_help_1'>Help info about moving ships between fleets.</div>
					<div class='helpslide_header'>Move ships</div>

					<div class='column_helptext'>1: Click a ship type to select it for reassignment.</div>

					<div id='reasignment_ship_type_select_container'>
						<!-- Per shiptype
						<div class='shiptype_select' id='shipTypeSelect1'>
							<div class='shiptype_name assignSelectedGlow'>Spearhead</div>
							<div class='shiptype_img'>
								<img src='images/icons/miniships/spearhead_mini.png'>
							</div>
						</div>
						-->
					</div>


				</div>
				<div class='helpcolumn2of3' id='assignColumn2'>
					<div class='columnhelper' id='fm_noob_help_2'>Help info about moving ships between fleets.</div>
					<div class='column2header' id='reassign_selected_shiptype_name'>No ship selected</div>
					<div class='column_helptext'>
						2:Choose location and fleet to reassign to.<br>
					</div>

					<div class='shipreassigncontainer'>
						<div class='move_to'>Reassign ships to:</div>
						<select id='reassign_to_location' class='move_to' onchange='populateReassignToFleet()'></select>
						<div class='move_to'>Into fleet:</div>
						<select id='reassign_to_fleet' class='move_to' onchange='reassignFleetChange()'></select>
					</div>

					<div class='column_helptext'>
						3:Use the percent-selector to select which ships to move (click individual ships for the final adjustments) and add a move-order.
					</div>

					<div class='new_reassign_input_text_container'>
						<input type='number' max='100' min='0' step='5' value='0' style='width:41px;margin-left:0%;' id='reassign_number_input' class='reassign_number_input' onkeyup='reassignSelectPercentDynamic()' onchange='reassignSelectPercentDynamic()'><div style='float:left;font-size:15px;margin-right:1%;margin-left:0%;'>%</div>
						<div class='ship_assign_short_button' onclick='reassignSelectPercent(100)' style='float: left; height: 22px; background-size: 100% 100%; line-height: 21px; bottom:2px;'>All</div>
						<div class='ship_assign_short_button' onclick='reassignSelectPercent(0)'style='float: left; height: 22px; background-size: 100% 100%; line-height: 21px; bottom:2px;'>None</div>
						<div class='reassign_ship_count_text' id='reassign_ship_count_text' style='width:19%'>Units: 0</div>
						<!--<input class='reassign_ship_count_text' id='reassign_ship_count_text_ships' type='number' step='5' min='0' style='width:40px' onkeyup='reassignSelectShipsDynamic()' onchange='reassignSelectShipsDynamic()' id='reassign_number_input_2' value='0'> -->
						<!--<div class='reassign_ship_count_text' style='width:37px'>Units</div>-->
						<div class='reassign_strength_count_text' id='reassign_strength_count_text' style='width:24%'>Str: 0</div>
					</div>

					<div class='shipreassigncontainer' id='reasignment_ship_select_container'>Ships:<br>

					</div>

					<!--
					<div class='ship_assign_short_button' onclick='reassignSelectAll()'>All</div>
					<div class='ship_assign_short_button' onclick='reassignSelectPercent(75)'>75%</div>
					<div class='ship_assign_short_button' onclick='reassignSelectPercent(50)'>50%</div>
					<div class='ship_assign_short_button' onclick='reassignSelectPercent(25)'>25%</div>
					<div class='ship_assign_short_button' onclick='reassignSelectNone()'>None</div>
					-->

					<div id='fm_op_recommended_strength_container' style='display:none;width:100%;text-align:center;'>Minimum recommended strength for this fleet : <span id='fm_op_recommended_strength'></span><br><span style='font-weight:bold;color:orange;font-size:11px;'>Note: Moving ships to Outpost Defense is a one way move!</b></div>
					<div class='lightbutton160 green' id='set_reassign' onclick='setReassignmentClick()'>
						<div class='buttontext24'>Add move-order</div>
					</div>


				</div>
				<div id='assignColumn3' class='helpcolumn3of3'>
					<div class='columnhelper' id='fm_noob_help_3'>Help info about moving ships between fleets.</div>
					<div class='column3header'>Pending move-orders</div>

					<div class='column_helptext'>4:Complete the pending move-orders</div>

					<div id='reassignmentListContainer'>
						<!-- Per ordered reassignment
						<div class='reassignlistentry'>
							<div class='reassigntype'>12 Starbeamers</div>
							<div class='reassignarrow'>--&gt;</div>
							<div class='reassigndest'>Willon's Fleet</div>
							<div class='reassigncancel'>X</div>
						</div>
						-->
					</div>

					<!--
					<div class='fixed_button fixed_button_320' id='go_reassign' onClick='executeReassignmentClick()'>
						<div class='fixed_button_regular regular_320' style='opacity: 1; '></div>
						<div class='fixed_button_hover green_320' style='opacity: 0; '></div>
						<div class='fixed_button_click green_320'></div>
						<div class='dyna_button_text type2'>Complete all move-orders</div>
					</div>
					-->

					<div class='lightbutton160 green' id='go_reassign' onclick='executeReassignmentClick()'>
						<div class='buttontext24'>Move Units</div>
					</div>


					<div id='reassign_close' style='position: absolute; top: 3px; right: 0px; cursor: pointer;' onclick='fleetAssignPanelDown()'>
						<img src='images/fixed/cancel.png'>
					</div>
				</div>
				<div class='helpcolumnseparator1third'></div>
				<div class='helpcolumnseparator2third'></div>
			</div>
			<!-- End Ship Reassignment panel -->

			<!-- Decomission panel -->
			<div class='bottomslider' id='retirementpanel'>
				<div id='assignColumn1' class='helpcolumn1of3'>
					<div class='helpslide_header'>Retire ships</div>
					<div id='retirement_ship_type_select_container'>
						<!-- Per shiptype
						<div class='shiptype_select' id='shipTypeSelect1'>
							<div class='shiptype_name assignSelectedGlow'>Spearhead</div>
							<div class='shiptype_img'>
								<img src='images/icons/miniships/spearhead_mini.png'>
							</div>
						</div>
						-->
					</div>
					<div class='column_helptext'>1: Click a ship type to select it for retirement.</div>
				</div>
				<div class='helpcolumn2of3' id='assignColumn2'>
					<div class='column2header' id='retirement_selected_shiptype_name'>No ship selected</div>
					<div class='shipreassigncontainer'>

					</div>
					<div class='shipreassigncontainer' id='retirement_ship_select_container'>Ships:<br>
						<!-- Per ship of selected type
						<div class='shipreassignselect' id='selectShip1'>
							<div class='condition'></div>
							<div class='supply'>18/18</div>
						</div>
						-->
					</div>
					<div class='fixed_button fixed_button_320' id='set_retirement' onclick='setRetirementClick()'>
						<div class='fixed_button_regular regular_320' style='opacity: 1; '></div>
						<div class='fixed_button_hover green_320' style='opacity: 0; '></div>
						<div class='fixed_button_click green_320'></div>
						<div class='dyna_button_text type2'>Add retirement-order</div>
					</div>
					<div class='column_helptext'>
						2:Retirement will delete ships permanently.<br>
						3:Once retired, they are gone forever.

					</div>
				</div>
				<div id='assignColumn3' class='helpcolumn3of3'>
					<div class='column3header'>Pending retirement-orders</div>
					<div id='reassignmentListContainer'>
						<!-- Per ordered reassignment
						<div class='reassignlistentry'>
							<div class='reassigntype'>12 Starbeamers</div>
							<div class='reassignarrow'>--&gt;</div>
							<div class='reassigndest'>Willon's Fleet</div>
							<div class='reassigncancel'>X</div>
						</div>
						-->
					</div>

					<div class='fixed_button fixed_button_320' id='go_reassign' onClick='executeRetirementClick()'>
						<div class='fixed_button_regular regular_320' style='opacity: 1; '></div>
						<div class='fixed_button_hover green_320' style='opacity: 0; '></div>
						<div class='fixed_button_click green_320'></div>
						<div class='dyna_button_text type2'>Confirm retirements</div>
					</div>
					<div class='column_helptext'>4:Click the button to confirm all retirement orders.</div>
					<div id='reassign_close' style='position: absolute; top: 3px; right: 0px; cursor: pointer;' onclick='fleetRetirementPanelDown()'>
						<img src='images/fixed/cancel.png'>
					</div>
				</div>
				<div class='helpcolumnseparator1third'></div>
				<div class='helpcolumnseparator2third'></div>
			</div>
			<!-- End Decomission panel -->


			<!-- Resupply panel-->
			<div class='bottomslider' id='resupplypanel'>
				<div id='resupplyColumn1' class='helpcolumn2of3 resupply_column_1'>
					<div class='column2header resupply'>Ship Selection</div>
					<div class='resupply_slot_counter'>
						<span class='header'>Free Slots:</span>
						<span class='entry' id='reassign_free_slots'>33</span>
					</div>
					<div id='resupply_ship_select_outer_container'>
						<!-- Per small ship End per ship -->
					</div>
					<div class='fixed_button fixed_button_320' style='margin-left:160px;' id='go_fill' onclick='activateRessuplyClick()'>
						<div class='fixed_button_regular regular_320'></div>
						<div class='fixed_button_hover green_320'></div>
						<div class='fixed_button_click green_320'></div>
						<div class='dyna_button_text type2'>Transfer the selected minor ships</div>
					</div>
					<div id='resupply_close' style='position: absolute; top: 3px; right: 0px; cursor: pointer;' onclick='selected_fleet_resupply_button_click()'>
						<img src='images/fixed/cancel.png'  />
					</div>
					<div class='column_helptext'>
						<div>
							<span class='bold'>C</span>
							<span>(Current) is the current ship count in your fleet.</span>
						</div>
						<div>
							<span class='bold'>A</span>
							<span>(Available) is the amount of ships of this type available in the Storage Fleet.</span>
						</div>
						<div>
							<span>Select one option on the left, adjust the numbers if you wish, then click the above button.</span>
						</div>
					</div>
					<div class='resupply_hoz_sep'></div>
					<div class='fixed_button fixed_button_320' style='margin-left: 160px;' id='empty_fleet_of_minor_ships_button' onclick='moveMinorsToBaseFleetClick()'>
						<div class='fixed_button_regular regular_320' style='opacity: 1;'></div>
						<div class='fixed_button_hover green_320' style='opacity: 0;'></div>
						<div class='fixed_button_click green_320'></div>
						<div class='dyna_button_text type2'>Move minor ships to the basefleet</div>
					</div>
					 <div class='column_helptext'>This transfers all minor ships to homeworld base immediately.</div>

				</div>

				<div id='resupplyColumn2' class='helpcolumn1of3'>
					<div class='helpslide_header'>Minor Ships</div>
					<div class='column3header'>Select preferred setup</div>
					<div class='resupply_option'>
						<div class='fixed_button fixed_button_26_square auto_fill_option' id='resupply_option_1' onclick='resupply_option_click(1)'>
							<div class='fixed_button_regular_square'></div>
							<div class='fixed_button_hover square_green' style='opacity: 0; '></div>
							<div class='fixed_button_click square_green'></div>
						</div>
						<span class='auto_fill_option'>Even distribution</span>
					</div>
					<div class='resupply_option'>
						<div class='fixed_button fixed_button_26_square auto_fill_option' id='resupply_option_2'  onclick='resupply_option_click(2)'>
							<div class='fixed_button_regular_square'></div>
							<div class='fixed_button_hover square_green' style='opacity: 0; '></div>
							<div class='fixed_button_click square_green'></div>
						</div>
						<span class='auto_fill_option'>Fighters only (No corvettes)</span>
					</div>
					<div class='resupply_option'>
						<div class='fixed_button fixed_button_26_square auto_fill_option' id='resupply_option_5' onclick='resupply_option_click(5)'>
							<div class='fixed_button_regular_square'></div>
							<div class='fixed_button_hover square_green' style='opacity: 0; '></div>
							<div class='fixed_button_click square_green'></div>
						</div>
						<span class='auto_fill_option'>T1 Fighters only</span>
					</div>
					<div class='resupply_option'>
						<div class='fixed_button fixed_button_26_square auto_fill_option' id='resupply_option_3' onclick='resupply_option_click(3)'>
							<div class='fixed_button_regular_square'></div>
							<div class='fixed_button_hover square_green' style='opacity: 0; '></div>
							<div class='fixed_button_click square_green'></div>
						</div>
						<span class='auto_fill_option'>Corvettes only (No fighters)</span>
					</div>
					<div class='resupply_option'>
						<div class='fixed_button fixed_button_26_square auto_fill_option' id='resupply_option_4' onclick='resupply_option_click(4)'>
							<div class='fixed_button_regular_square'></div>
							<div class='fixed_button_hover square_green' style='opacity: 0; '></div>
							<div class='fixed_button_click square_green'></div>
						</div>
						<span class='auto_fill_option'>Tier 2 only (No basic ships)</span>
					</div>
					<div class='column_helptext'>Upon activation, ships will instantly be moved from your base fleet and into the selected fleet according to set option.</div>
				</div>
				<div class='helpcolumnseparator1third'></div>
			</div>
		<!-- End Resupply panel -->

		<!-- Bottom Slide Panel -->
			<div class='bottomslider' id='tacticspanel'>
				<div class='quick_tactics_container' id='tacticsColumn1'>
					<div class='helpslide_header resupply'>Tactical Options</div>
					<div class='tactical_inner_subset tacticslide' id='tactics_slide_target_priority_container'>
						<div class='tactical_list_header tacticslide'>Target Priority</div>
						<div class='tactical_list_subheader'>Take-down priority</div>
						<div id='tac_target_priority_7' class='tactical_list tacticslide' onclick='selectTactic(this.id)'><span>Closest Ship</span></div>
						<div id='tac_target_priority_1' class='tactical_list tacticslide' onclick='selectTactic(this.id)'><span>Firepower</span></div>
						<!--<div id='tac_target_priority_2' class='tactical_list tacticslide' onclick='selectTactic(this.id)'><span>Primary Firepower</span></div>-->
						<div id='tac_target_priority_3' class='tactical_list tacticslide' onclick='selectTactic(this.id)'><span>Least Hull</span></div>
						<div id='tac_target_priority_4' class='tactical_list tacticslide' onclick='selectTactic(this.id)'><span>Most Hull</span></div>
						<div id='tac_target_priority_5' class='tactical_list tacticslide' onclick='selectTactic(this.id)'><span>Least Manoeuvrability</span></div>
						<div id='tac_target_priority_6' class='tactical_list tacticslide' onclick='selectTactic(this.id)'><span>Most Manoeuvrability</span></div>

					</div>

					<div class='tactical_inner_subset tacticslide'  id='tactics_slide_target_switching_container'>
						<div class='tactical_list_header tacticslide'>Re-evaluate all targets</div>
						<div class='tactical_list tacticslide' id='tac_target_switching_1' onclick='selectTactic(this.id)'><span>No</span></div>
						<div class='tactical_list tacticslide' id='tac_target_switching_2' onclick='selectTactic(this.id)'><span>Yes</span></div>
					</div>
				</div>

				<div class='quick_tactics_container column2' id='tacticsColumn2'>
					<div class='tactical_inner_subset tacticslide' id='tactics_slide_fighter_priority_container'>
						<div class='tactical_list_header tacticslide'>Fighter Priority</div>
						<div class='tactical_list tacticslide' id='tac_fighter_priority_1' onclick='selectTactic(this.id)'><span>Corvette defense</span></div>
						<div class='tactical_list tacticslide' id='tac_fighter_priority_2' onclick='selectTactic(this.id)'><span>Capital ship defense</span></div>
						<div class='tactical_list tacticslide' id='tac_fighter_priority_4' onclick='selectTactic(this.id)'><span>Defend all</span></div>
						<div class='tactical_list tacticslide' id='tac_fighter_priority_3' onclick='selectTactic(this.id)'><span>Ship-to-ship</span></div>
					</div>
					<div class='tactical_inner_subset tacticslide' id='tactics_slide_corvette_priority_container'>
						<div class='tactical_list_header tacticslide'>Corvette Priority</div>
						<div class='tactical_list tacticslide' id='tac_corvette_priority_1' onclick='selectTactic(this.id)'><span>Defense</span></div>
						<div class='tactical_list tacticslide' id='tac_corvette_priority_2' onclick='selectTactic(this.id)'><span>Offense</span></div>
					</div>
					<div class='tactical_help'>
						<span>These settings apply to this fleet only when it is operating on its own, or if the commander of the fleet is designated the commander of a attacking or defending force at its current location, or as part of a group of fleets on a mission.</span>
						<div id='copy_tactics_to_all_op_fleets_button' class='lightbutton320 blue' onclick="copyTacticsToAllOutpostFleets();">
							<div class='buttontext24'>Copy tactics to ALL OP-fleets</div>
						</div>

					</div>
				</div>
				<div class='quick_tactics_container column3' id='tacticsColumn3'>
					<div class='tactical_inner_subset tacticslide' id='tactics_slide_retreat_options_container'>

						<div class='tactical_list_header tacticslide'>Retreat condition</div>
						<div class='tactical_list_subheader'><span>Call retreat at</span></div>
						<div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_percentage_1' onclick='selectTactic(this.id)'><span>Never</span></div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_percentage_2' onclick='selectTactic(this.id)'><span>At 15%</span></div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_percentage_3' onclick='selectTactic(this.id)'><span>At 30%</span></div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_percentage_4' onclick='selectTactic(this.id)'><span>At 45%</span></div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_percentage_5' onclick='selectTactic(this.id)'><span>At 60%</span></div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_percentage_6' onclick='selectTactic(this.id)'><span>At 75%</span></div>
						</div>
						<div class='tactical_list_subheader'><span>of remaining</span></div>
						<div>
							<div class='tactical_list tacticslide' id='tac_retreat_type_1' onclick='selectTactic(this.id)'><span>Total Firepower</span></div>
							<div class='tactical_list tacticslide' id='tac_retreat_type_2' onclick='selectTactic(this.id)'><span>Capital Ships</span></div>
							<div class='tactical_list tacticslide' id='tac_retreat_type_3' onclick='selectTactic(this.id)'><span>Total Hull</span></div>
						</div>
						<div class='tactical_list_subheader'><span>Retreat if unwinnable?</span></div>
						<div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_if_unwinnable_1' onclick='selectTactic(this.id)'><span>No</span></div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_if_unwinnable_2' onclick='selectTactic(this.id)'><span>Yes</span></div>
						</div>
						<div class='tactical_list_subheader'><span>But if losses are even...</span></div>
						<div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_if_even_1' onclick='selectTactic(this.id)'><span>Stay and Fight</span></div>
							<div class='tactical_list tacticslide_short' id='tac_retreat_if_even_2' onclick='selectTactic(this.id)'><span>Retreat anyway</span></div>
						</div>
					</div>
					<div class='fixed_button fixed_button_320' id='update_tactical_selection' style='left: 10px;' onclick='update_fleet_tactics()'>
						<div class='fixed_button_regular regular_320'></div>
						<div class='fixed_button_hover green_320'></div>
						<div class='fixed_button_click green_320'></div>
						<div class='dyna_button_text type2'>Submit Tactical Change</div>
					</div>
					<div id='tactics_close' style='position: absolute; top: -7px; right: -28px; cursor: pointer;' onclick='selected_fleet_tactics_button_click()'>
						<img src='images/fixed/cancel.png'>
					</div>

						<!--<textarea id='sms' style='position: absolute; top: 10px; left: 10px; height: 130px; width: 280px; background: url(images/fixed/quickmessagearea.png) no-repeat; color:
						#FFFFFF; border: none; padding: 10px;'></textarea>
						<button id='smsbutton' style='position: absolute; top: 160px; width: 300px; left: 10px;'>Send Message</button>-->
				</div>
			</div>

			<!-- ship-overview -->
			<div class='bottomslider' id='ship_overview_panel'>
				<div class='ship_overview column1' id='shipsColumn1'>
					<div class='helpslide_header overview' id='ship_overview_h1'>Ship Overview</div>
					<div class='station_action_button' id='breakdownButton' style='display:none; position: absolute; top: 1px; left: 356px;' onclick='showStationShipsBreakdown()'>Details</div>
					<div id='ship_overview_capital_ships_container'>
					</div>
					<div class='separator_line' id='ship_overview_sep_1'></div>
					<div id='ship_overview_minor_ships_container'>
					</div>
				</div>
				<div class='ship_overview column2 column_depressed' id='shipsColumn2'>
					<div class='build_info_column_header blue'  id='ship_overview_h2'>Defences</div>
					<div id='ship_overview_defense_container'>
					</div>
				</div>
				<div class='ship_overview column3' id='shipsColumn3'>
					<div class='build_info_column_header blue' id='ship_overview_h3'>Utility Ships</div>
					<div id='ship_overview_utility1_container'>
					</div>
					<div class='separator_line'  id='ship_overview_sep_3'></div>
					<div id='ship_overview_utility2_container'>
					</div>
				</div>
				<div id='build_info_close' onclick='shipListDown()'>
					<img src='images/fixed/cancel.png'>
				</div>
			</div>
			<!-- End ship-overview -->

			<!-- station special ship-overview -->
			<div class='bottomslider' id='station_ship_breakdown_panel'>
				<div class='helpslide_header overview' id='ship_overview_h1'>Station Defense</div>
				<div class='ship_overview' id='station_ship_breakdown_container'>
				</div>
				<div id='build_info_close' onclick='shipListDownStationBreakdown()'>
					<img src='images/fixed/cancel.png'>
				</div>
			</div>
			<!-- End station special ship-overview -->

			<div class='bottomslider' id='build_panel'>
				<div class='build_info_container column1'>
					<div class='helpslide_header build_info_slide_header' id='build_panel_item_name'>The Starbeamer</div>
					<img class='build_info_main_img'  id='build_panel_item_image' src='images/fixed/shipimg250x100test.jpg'>
					<div class='build_info_tech_req' id=' id='build_panel_explanation''>
						To enable this production, the following criteria and/or dependencies need to be completed.<br>
						Red sections are not fulfilled.
					</div>
				</div>
				<div class='build_info_container column2 column_depressed' id='build_facility_clickable'>
					<div class='build_info_column_header red' id='build_panel_facility_heading'>Facility</div>
					<div class='build_info_no_need' id='build_panel_facility_noneed' style='display:none;'>
						No facility required.
					</div>
					<div class='build_info_img'>
					<img  id='build_panel_facility_image' src='images/icons/facility/331x100.jpg'>
					</div>
					<div class='build_info_dep_name' id='build_panel_facility_name'>N/A</div>
				</div>
				<div class='build_info_container column3' id='build_research_clickable'>
					<div class='build_info_column_header green' id='build_panel_research_heading'>Research</div>
					<div class='build_info_no_need' id='build_panel_research_noneed' style='display:none;'>
						No research required.
					</div>
					<div class='build_info_img'>
					<img  id='build_panel_research_image' src='images/icons/research/101.jpg'>
					</div>
					<div class='build_info_dep_name' id='build_panel_research_name'>N/A</div>
				</div>
				<div class='build_info_container column4 column_depressed'  id='build_development_clickable'>
					<div class='build_info_column_header green' id='build_panel_development_heading'>Development</div>
					<div class='build_info_no_need' id='build_panel_development_noneed' style='display:none;'>
						No development required.
					</div>
					<div class='build_info_img'>
					<img id='build_panel_development_image' src='images/icons/development/206.jpg'>
					</div>
					<div class='build_info_dep_name'id='build_panel_development_name'>N/A</div>
				</div>

				<div class='build_info_container column5' id='build_special_clickable'>
					<div class='build_info_column_header green' id='build_panel_special_heading'>Special</div>
					<div class='build_info_no_need' id='build_panel_special_noneed' style='display:none;'>
						No special requirement.
					</div>
					<div class='build_info_img'>
					<img id='build_panel_special_image' src='images/icons/techtree/206.jpg'>
					</div>
					<div class='build_info_dep_name'id='build_panel_special_name'>None</div>
				</div>

				<div class='build_info_container column6 column_depressed' id='build_techpoints_clickable'>
					<div class='build_info_column_header red' id='build_panel_techpoints_heading'>Tech Points</div>
					<div class='build_info_no_need' id='build_panel_techpoints_noneed' style='display:none;'>
						No techpoints required.
					</div>
					<div class='build_info_tech_req' id='build_panel_techpoints_string'>
					N/A
					</div>
				</div>
				<div id='build_info_close' onclick='buildMenuDown()'>
					<img src='images/fixed/cancel.png'>
				</div>
			</div>
	
		<div class='shipslide' id='shipslide' onclick='closeSlide("shipslide")'>
			<div class='shipslide_bg'>
				<div class='shipslide_tab'></div>
				<div class='shipslide_img_container'>
					<img class='shipslide_img' id='shipslide_ship_image' src='images/fixed/shipslidepic7.jpg'>
				</div>
				<div class='shipslide_shipname' id='shipslide_stat_unitname'></div>
				<div class='shipslide_shipstats'>
					<div style='color:yellow;font-style:italic;text-align:center; font-size:10px;' >Unlike all other sections in the game, this section shows all stats with your bonuses included!</div>
					<div class='shipslide_statname'>Hull</div>
					<div class='shipslide_statvalue' id='shipslide_stat_hull'>0</div>
					<div class='shipslide_statname'>Absorbs</div>
					<div class='shipslide_statvalue' id='shipslide_stat_absorbs'>0</div>
					<div class='shipslide_statname'>Shield</div>
					<div class='shipslide_statvalue' id='shipslide_stat_shield'>0</div>
					<div class='shipslide_statname'>Shield-recharge</div>
					<div class='shipslide_statvalue' id='shipslide_stat_shield_recharge'>0</div>
					<div class='shipslide_statname'>Maneuverability</div>
					<div class='shipslide_statvalue' id='shipslide_stat_maneuverability'>0</div>
					<div class='shipslide_separator'></div>
					<div class='shipslide_statname'>Pri. Weapon</div>
					<div class='shipslide_statvalue' id='shipslide_stat_pri_weapon'>0</div>
					<div class='shipslide_statname'> Range</div>
					<div class='shipslide_statvalue' id='shipslide_stat_pri_range'>0</div>
					<div class='shipslide_statname'> Damage</div>
					<div class='shipslide_statvalue' id='shipslide_stat_pri_damage'>0</div>
					<div class='shipslide_statname'> Targeting</div>
					<div class='shipslide_statvalue' id='shipslide_stat_pri_targeting'>0</div>
					<div class='shipslide_statname'> Rate of fire</div>
					<div class='shipslide_statvalue' id='shipslide_stat_pri_rof'>0</div>
					<div class='shipslide_statname'> Crit-chance</div>
					<div class='shipslide_statvalue' id='shipslide_stat_pri_crit'>0</div>
					<div class='shipslide_separator'></div>
					<div class='shipslide_statname'>Sec. Weapon</div>
					<div class='shipslide_statvalue' id='shipslide_stat_sec_weapon'>0</div>
					<div class='shipslide_statname'> Range</div>
					<div class='shipslide_statvalue' id='shipslide_stat_sec_range'>0</div>
					<div class='shipslide_statname'> Damage</div>
					<div class='shipslide_statvalue' id='shipslide_stat_sec_damage'>0</div>
					<div class='shipslide_statname'> Targeting</div>
					<div class='shipslide_statvalue' id='shipslide_stat_sec_targeting'>0</div>
					<div class='shipslide_statname'> Rate of fire</div>
					<div class='shipslide_statvalue' id='shipslide_stat_sec_rof'>0</div>
					<div class='shipslide_statname'> Crit-chance</div>
					<div class='shipslide_statvalue' id='shipslide_stat_sec_crit'>0</div>
					<div class='shipslide_separator'></div>
					<div class='shipslide_statname'>Ter. Weapon</div>
					<div class='shipslide_statvalue' id='shipslide_stat_ter_weapon'>0</div>
					<div class='shipslide_statname'> Range</div>
					<div class='shipslide_statvalue' id='shipslide_stat_ter_range'>0</div>
					<div class='shipslide_statname'> Damage</div>
					<div class='shipslide_statvalue' id='shipslide_stat_ter_damage'>0</div>
					<div class='shipslide_statname'> Targeting</div>
					<div class='shipslide_statvalue' id='shipslide_stat_ter_targeting'>0</div>
					<div class='shipslide_statname'> Rate of fire</div>
					<div class='shipslide_statvalue' id='shipslide_stat_ter_rof'>0</div>
					<div class='shipslide_statname'> Crit-chance</div>
					<div class='shipslide_statvalue' id='shipslide_stat_ter_crit'>0</div>
					<div class='shipslide_separator'></div>
					<div class='shipslide_statname'>Cargo capacity</div>
					<div class='shipslide_statvalue' id='shipslide_stat_cargo'>0</div>
					<div class='shipslide_statname'>Hangar capacity</div>
					<div class='shipslide_statvalue' id='shipslide_stat_hangar'>0</div>
					<div class='shipslide_statname'>Jump range</div>
					<div class='shipslide_statvalue' id='shipslide_stat_jumprange'>0</div>
					<div class='shipslide_statname'>Volatility</div>
					<div class='shipslide_statvalue' id='shipslide_stat_volatility'>0</div>
					<div class='shipslide_statname'>Pri. Special effect</div>
					<div class='shipslide_statvalue' id='shipslide_stat_pri_special'>0</div>
					<div class='shipslide_statname'>Sec. Special effect</div>
					<div class='shipslide_statvalue' id='shipslide_stat_sec_special'>0</div>
				</div>
				<div class='shipslide_shipinfo'>
					<div class='shipslide_infocorner'></div>
					<span  id='shipslide_stat_longdescription' style='display:block;width:500px;' class='selectable_text'>
					</span>
				</div>
			</div>
		</div>
	<iframe class='helpframe' id='outgamehelp' src='gameinfo.html?rn=42473723' seamless></iframe>
		<div class='starmap_bottomslider' id='starmap_slidepanel'>
			<div class='starmap_slidepanel_content' id='starmap_planet_player'>
				<div class='short_info_player_container'>
					<div class='selected_member_avatar short_info_avatar'>
						<img src='images/fixed/image2.png' id='playerinfo_avatar_image'>
					</div>
					<div class='short_info_main_header' id='playerinfo_playername'>N/A</div>
					<div class='short_info_left_container'>
						<div class='short_info_header'>Player Score Ranking:</div><div class='short_info_entry' id='playerinfo_playerrank'>#5</div>
						<div class='short_info_header'>Player Score:</div><div class='short_info_entry' id='playerinfo_playerscore'></div>
						<div class='short_info_header'>Player Strength:</div><div class='short_info_entry' id='playerinfo_playerstrength'></div>

						<div class='short_info_header'>Capital Ships:</div><div class='short_info_entry' id='playerinfo_capital_ships'>1.244</div>
						<div class='short_info_header'>Total Firepower:</div><div class='short_info_entry' id='playerinfo_total_firepower'>1.456.323</div>
						<!--<div class='short_info_header'>Top Commander:</div><div class='short_info_entry' id='playerinfo_top_commander_rank'>Vice Marshal</div>-->
					</div>
					<div class='short_info_right_container'>
						<div class='short_info_right_header' id='playerinfo_outposts_header'>Outposts</div>
						<div id='playerinfo_outposts_container' class='short_info_scroller'>

						</div>
					</div>
				</div>
				<div class='short_info_alliance_container'>
					<div class='short_info_alliance_content'>
						<div class='selected_member_avatar short_info_avatar'>
							<img src='images/fixed/avartar2.jpg' id='allianceinfo_logo_image' width='100' height='100'>
						</div>
						<div class='short_info_main_header' id='allianceinfo_alliance_name'>N/A</div>
						<div class='short_info_left_container'>
							<div class='short_info_header'>Alliance Ranking:</div><div class='short_info_entry' id='allianceinfo_alliance_rank'>#5</div>
							<div class='short_info_header'>Alliance Members:</div><div class='short_info_entry' id='allianceinfo_membercount'>41</div>
							<div class='short_info_header'>Alliance Leader:</div><div class='short_info_entry' id='allianceinfo_leader'>Powerlord</div>
							<div class='short_info_header'>Recruitment Officer:</div><div class='short_info_entry' id='allianceinfo_recruitment_officer'>Ragamuffinsen</div>
						</div>
						<div class='short_info_right_container'>
							<div class='short_info_right_header' id='allianceinfo_richest_members'>Bankers</div>
							<div id='allianceinfo_richest_members_container' class='short_info_scroller'>

							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- New short alliance info -->
			<div class='starmap_slidepanel_content' id='starmap_planet_alliance'>
				<div class='short_info_alliance_container alliance_search'>
					<div class='short_info_alliance_content'>
						<div class='selected_member_avatar short_info_avatar'>
							<img id='small_alliance_slider_logo' src='images/fixed/avartar2.jpg' />
						</div>
						<div class='short_info_main_header' id='small_alliance_slider_name'>N/A</div>
						<div class='short_info_left_container'>
							<div class='short_info_header'>Alliance Ranking:</div><div class='short_info_entry' id='small_alliance_slider_ranking'>N/A</div>
							<div class='short_info_header'>Alliance Members:</div><div class='short_info_entry' id='small_alliance_slider_members'>N/A</div>
							<div class='short_info_header'>Alliance Leader:</div><div class='short_info_entry' id='small_alliance_slider_leader'>N/A</div>
							<div class='short_info_header'>Recruitment Officer:</div><div class='short_info_entry' id='small_alliance_slider_recruitment_officer'>Unknown</div>
						</div>
						<div class='short_info_right_container'>
							<div class='short_info_right_header'>Bankers</div>
							<span id='small_alliance_slider_richest_members_container'>

							</span>
						</div>
					</div>
				</div>
			</div>
			<div class='bottomslide_close' id='bottomslider_close'>
				<img src='images/fixed/cancel.png'  />
			</div>
		</div>

		<div class='starmap_bottomslider' id='starmap_espionage_slidepanel'>
			<div class='starmap_slidepanel_content'>
				<div class='spy_slider_details'>
					<div class='spy_slider_info_top'>MISSION DETAILS</div>
					<div class='spy_slider_info_header'>Mission Time:</div>
					<div class='spy_slider_info_entry' id='sm_spypanel_mission_time'>30 hours</div>
					<div class='spy_slider_info_header'>Failure Chance:</div>
					<div class='spy_slider_info_entry' id='sm_spypanel_detection_chance'>8%</div>
					<div class='spy_slider_info_top'>OBJECTIVES</div>
					<div class='spy_slider_info_top' id='sm_spypanel_shortdesc'>Reveals information about target's homeworld, fleets, outposts and alliance.</div>
					<div class='spy_slider_info_warning' id='sm_spypanel_catch_warning'>Capture is bad.</div>

				</div>
				<div class='spy_slider_description'>
					<div class='claimtext_header' id='sm_intel_panel_type_header'>Espionage Mission</div>
					<img src='images/planets/notification/notify_espionage.jpg'  id='sm_spypanel_typepicture' class='spy_slider_image' style='border-radius: 5px; box-shadow: -1px -1px 1px rgba(0,0,0,0.5), 1px 1px 1px rgba(255,255,255,0.4);'>
					<div  id='sm_spypanel_longdesc'>The Espionage mission will place an agent on the ground of the homeworld you wish to sly on, and this agent will work to gather information without interacting with the population of the homeworld. The Agent will gather information about fleets, resources and outposts.</div>
				</div>
				<div class='build_info_container column_depressed spy_slider_build_info'>
					<div class='build_info_column_header green' id='sm_spypanel_facility_heading'>Required Facility</div>
					<div class='build_info_no_need' id='sm_spypanel_facility_noneed' style='display: none;'>No facility required.</div>
					<div class='build_info_img'>
						<img id='sm_spypanel_facility_image' src='images/icons/facility/331x100.jpg'>
					</div>
					<div class='build_info_dep_name' id='sm_spypanel_facility_name'>Intelligence Lvl 1</div>
				</div>
				<div class='costfield spy_slider_cost' id='spy_mission_init'>
					<div class='costbutton' id='spy_execute_button'>
						<div class='initiatebutton'></div>
						<div class='initiatebuttonhover'></div>
						<div class='buttontext costtext'>Execute</div>
					</div>
					<div id='spy_cost_h' class='hscost'>1.000</div>
					<div id='spy_cost_n' class='ndcost'>1.000</div>
					<div id='spy_cost_s' class='srcost'>1.000</div>
					<div id='spy_cost_i' class='incost'>1.000</div>
				</div>
			</div>
			<div class='bottomslide_close' id='sm_spypanel_bottomslider_close' onclick='hideEspionageOption()'>
				<img src='images/fixed/cancel.png'>
			</div>
		</div>


	
		<div id='game_object_info_box_container' class='game_object_info_box_container' style='display:none;'>
			<div id='g_o_close_button' onclick='closeGameInfoBox()' class='g_o_close_button'></div>
			<div id='g_o_name_container' class='g_o_name_container'></div>
			<div id='g_o_image_container' class='g_o_image_container'>
				<img id='g_o_image' class='g_o_image'>
			</div>

			<div class='tab_build_button green' id='gameInfoBoxRequirementsButton' style='position:absolute;top:66px;left:363px;'></div>
			<div id='g_o_description_container' class='g_o_description_container'></div>
			<div id='g_o_stats_container' class='g_o_stats_container'></div>

		</div>
	
		<div class='section_container' id='homeworld_content'>
			<div class='homeworldpane' id='planetinfo'>
			<div class='homeworld_bg_container'><img class='homeworld_bg' id='homeworld_bg' src='images/homeworlds/hw05bg.png'/></div>
			<div class='homeworld_name_panel'></div>
			<div id='spinnermoon' style='position:absolute;display:none;width:50px;height:50px;'><img id='moon_img' src='images/homeworlds/hw05moon01.png' alt='' border='0'></div>
				<div class='homeworld_img_container'>
					<img class='homeworld_img' id='homeworld_img' src='images/homeworlds/hw05.png' />
				</div>
				<div class='homeworld_info_container' id='homeworld_info_container'>
				<iframe src='https://tracker.simplaex.net/v1/games/session?game_id=1062&player_id=66151' width='0' height='0' frameborder='0'></iframe>
					<div class='homeworld_name_container'>
						<div class='homeworld_name' id='homeworld_planet_name' contenteditable='true' style='-webkit-touch-callout: default; -webkit-user-select: text; -khtml-user-select: text; -moz-user-select: text; -ms-user-select: text; ' spellcheck='false'>Ibusefat Ligo</div>
						<div class='homeworld_class_change' onclick='showWorldChangeHelp()'></div>
						<div class='homeworld_name_class' id='homeworld_name_class_string'>Class 5 Homeworld</div>
					</div>
					<div class='user_detail' id='hw_locaction_container'>
						<div class='user_detail_title'>Location: </div>
						<div class='user_detail_entry'  id='homeworld_location' onclick='zoomInTo(6,1,9,1,15)'>6:1:9:1.15</div>
					</div>
					<div class='user_detail' id='hw_nickname_container'>
						<div class='user_detail_title'>Owner: </div>
						<div class='user_detail_entry'  id='homeworld_leader_name'>Wanstey</div>
					</div>
					<div class='user_detail' id='hw_level_container'>
						<div class='user_detail_title'>Level: </div>
						<div class='user_detail_entry' id='homeworld_planet_advancement_level'></div>
					</div>
					<div class='user_detail'  id='hw_xp_container'>
						<div class='user_detail_title'>XP: </div>
						<div class='user_detail_entry'><span style='cursor:pointer;text-decoration:underline;' onclick='fetchXpLog()' id='homeworld_user_xp'> </span> <span class='ranking' id='homeworld_user_xp_rank'> </span></div>
					</div>
					<div class='user_detail' id='hw_score_container'>
						<div class='user_detail_title'>Score: </div>
						<div class='user_detail_entry'><span id='homeworld_user_score'> </span> <span class='ranking' id='homeworld_user_score_rank'> </span></div>
					</div>
					<div class='user_detail' id='hw_strength_container'>
						<div class='user_detail_title'>Strength: </div>
						<div class='user_detail_entry'><span id='homeworld_user_strength'> </span> <span class='ranking' id='homeworld_user_strength_rank'> </span></div>
					</div>
					<div class='user_detail' id='hw_tech_container'>
						<div class='user_detail_title'>Tech: </div>
						<div class='user_detail_entry'><span id='homeworld_planet_tech_name'></span> <span class='ranking'>(<span id='homeworld_planet_tech_matter'></span>/<span id='homeworld_planet_tech_energy'></span>/<span id='homeworld_planet_tech_displacement'></span>)</span></div>
					</div>

					<div class='user_detail' id='hw_outlook_container'>
						<div class='user_detail_title'>Outlook: </div>
						<div class='user_detail_entry' id='homeworld_planet_unused'>Coming soon...</div>
					</div>
					<div class='user_detail' id='hw_vip_container'>
						<span id='vip_promotion' style='display:none;'>
						<div class='localhelp' onclick="showLocalHelpTopic('V.I.P Package')" style='top: -2px; left: 443px;'><img src='images/icons/buttons/whatsthis.png'></div>
							<div onclick='openOptionsSlide("vip")' class='lightbutton420 blue'>Become A V.I.P. Player</div>
							<img class='button_icon_vip'src='images/icons/vip/forum/vip02.png'>
						</span>
						<span id='no_vip_promotion' style='display:none;'>
							<div class='user_detail_title'>Fleet Size: </div>
							<div class='user_detail_entry'><span id='homeworld_planet_fleet_size'> </span> Vessels</div>
						</span>
					</div>
					<div class='production_hw'>
						<div class='production_hw_title'>Homeworld resource production</div>
						<div class='hw_prod hs'><span id='hw_res_prod_h'>0</span><br><span class='prhour'>units/hour</span></div>
						<div class='hw_prod in'><span id='hw_res_prod_i'>0</span><br><span class='prhour'>units/hour</span></div>
						<div class='hw_prod sr'><span id='hw_res_prod_s'>0</span><br><span class='prhour'>units/hour</span></div>
						<div class='hw_prod nd'><span id='hw_res_prod_n'>0</span><br><span class='prhour'>units/hour</span></div>
					</div>

				</div>
			</div>

	
			<!-- Production Panel -->
			<div class='main_container halfsize half_6' id='production'>
				<!-- Infoframe -->
				<div class='infopanel' id='production_infopanel'>
					<div class='infopanel_content' id='production_infopanel_content'>
						<div class='infopanel_header' id='production_queue_header'>Production queue</div>
						<div class='lightbutton160' id='prod_view_all_ships' onclick='viewAllShipsClick({skipOutposts:true})'>
							<div class='buttontext24'>View all ships</div>
						</div>

						<!--
						<div class='selection_container rescomp_container'>
							<div class='rescomp_list infopanel_scroll_content' id='infopanel_completed_research_container'>

							</div>
							<div class='scrollbuttons' style='top:10px;'>
								<div class='scrollbutton_up' id='infopanel_completed_research_container_up' onclick="myScroll('infopanel_completed_research_container',136,500)"></div>
								<div class='scrollbutton_down' id='infopanel_completed_research_container_down' onclick="myScroll('infopanel_completed_research_container',-136,500)"></div>
							</div>
						</div>
						<div class='queue_list_help_text' id='completed_research_helptext'></div>
						-->


						<div class='tax_summary_resources' id='prod_queue_res_cost'>
							<div class='summary_entry hs' id='prod_queue_hs'>0</div>
							<div class='summary_entry in' id='prod_queue_in'>0</div>
							<div class='summary_entry sr' id='prod_queue_sr'>0</div>
							<div class='summary_entry nd' id='prod_queue_nd'>0</div>
						</div>



						<div class='prod_queue_scrollwrapper'>
							<div id='infopanel_production_queue_container' class='ally_dev_inner_scrollcontainer'>
								<!-- Content will be loaded here-->

								<!-- End content-->
							</div>
							<div class='scrollbuttons' style=''>
								<div class='scrollbutton_up' id='infopanel_production_queue_container_up' onclick="myScroll('infopanel_production_queue_container',136,500)"></div>
								<div class='scrollbutton_down' id='infopanel_production_queue_container_down' onclick="myScroll('infopanel_production_queue_container',-136,500)"></div>
							</div>
						</div>

						<div class='queue_list_help_text'>Click on a queued unit to view production details.</div>
					</div>
				</div>

				<!-- Side Panel -->
				<div class='sidepanel' id='production_sidepanel'>
					<div class='sidepanel_bg' id='production_sidepanel_bg'>
						<div class='sidepanel_content' id='production_sidepanel_content'>
							<div class='selected_item_img' ><img class='item_img' id='production_sidepanel_selected_ship_image' src='images/fixed/spacer.gif' /></div>
							<div class='selected_item_info_overlay' id='shipslidebutton_old'></div>
							<div class='main_panel_extended_content smallfont selected_item_description selectable_text' id='production_selected_item_stat_description'>No ship selected</div>
							<div class='selected_item_stats'>
								<div class='selected_item_statshade'></div>
							</div>
							<div class='selected_item_statcontainer'>
								<div class='selected_item_statname'>Pri. Firepower (<span id='production_selected_ship_stat_pri_weapon_type'></span>):</div>
								<div class='selected_item_statvalue' id='production_selected_ship_stat_pri_weaponstrength'>N/A</div>
								<div class='selected_item_statname'>Sec. Firepower (<span id='production_selected_ship_stat_sec_weapon_type'></span>):</div>
								<div class='selected_item_statvalue' id='production_selected_ship_stat_sec_weaponstrength'>N/A</div>
								<div class='selected_item_statname'>Ter. Firepower (<span id='production_selected_ship_stat_ter_weapon_type'></span>):</div>
								<div class='selected_item_statvalue' id='production_selected_ship_stat_ter_weaponstrength'>N/A</div>
								<div class='selected_item_statname'>Hull / Shield:</div>
								<div class='selected_item_statvalue' id='production_selected_ship_stat_hull'>N/A</div>
								<div class='selected_item_statname'>Maneuverability:</div>
								<div class='selected_item_statvalue' id='production_selected_ship_stat_maneuverability'>N/A</div>
								<div class='selected_item_statname' id='production_selected_ship_stat_hangar_cargo_header'>Hangar-capacity:</div>
								<div class='selected_item_statvalue' id='production_selected_ship_stat_hangar_cargo_capacity'>N/A</div>
								<div class='selected_item_statname'>Strength</div>
								<div class='selected_item_statvalue' id='production_selected_ship_stat_jump_range'>N/A</div>
							</div>
							<div class='selected_item_statcontainer_2'>
								<div class='selected_item_statname'>Time :</div>
								<div class='selected_item_statvalue' id='production_selected_item_stat_time'>N/A</div>
								<div class='selected_item_statname'>Upkeep:</div>
								<!--<div class='selected_item_statvalue'><span id='production_selected_item_stat_h_upkeep'></span>/<span id='production_selected_item_stat_n_upkeep'></span>/<span id='production_selected_item_stat_s_upkeep'></span>/<span id='production_selected_item_stat_i_upkeep'></span></div>-->
								<div class='selected_item_statvalue'><span id='production_selected_item_stat_total_upkeep'></span></div>
							</div>
							<div class='selected_item_nametab' class='shipinfotab'>
								<div class='selected_item_name' id='production_selected_ship_stat_shipname'>N/A</div>
							</div>

							<div class='selected_item_typetab'>
								<div class='selected_item_typename'  id='production_selected_ship_stat_shiptype_class'>N/A</div>
							</div>

							<div class='costfield prod_cost' id='prodcost' style='display:none;'>
								<!--OLD method, before x5 and x10
								<div class='costbutton' id='prodcostbutton'>
									<div class='initiatebutton' style='opacity: 1; '></div>
									<div class='initiatebuttonhover' style='opacity: 0; '></div>
									<div class='buttontext costtext'>Order</div>
								-->


								<div class='costbutton' id='prodcostbutton' style='width:80px;left: 33px;border: 1px solid green; top: 16px; height: 18px;'>
									<div class='buttontext costtext' style='position:relative;line-height:18px;width:100%;background:url(images/icons/elements/green_gradient_button_bg.png)'>Order</div>
								</div>
								<div class='costbutton5' id='prodcostbutton5' style='width: 40px; position: absolute; top: 16px; left: 116px; border: 1px solid green; height:18px;'>
									<div class='buttontext costtext' style='position:relative;line-height:18px;width:100%;background:url(images/icons/elements/green_gradient_button_bg.png)'>X5</div>
								</div>
								<div class='costbutton10' id='prodcostbutton10' style='width: 40px; position: absolute; top: 16px; left: 159px; border: 1px solid green; height:18px;'>
									<div class='buttontext costtext' style='position:relative;line-height:18px;width:100%;background:url(images/icons/elements/green_gradient_button_bg.png)'>X10</div>
								</div>

								<div class='disablebutton'>
									<div class='buttontext costtext'>N/A</div>
								</div>
								<div class='hscost' id='prod_hscost'>0</div>
								<div class='ndcost' id='prod_ndcost'>0</div>
								<div class='srcost' id='prod_srcost'>0</div>
								<div class='incost' id='prod_incost'>0</div>
							</div>


						</div><!-- End sidepanel content-->
						<div class='panel_slot_1' id='panel_slot_1' >
						   <div class='button_icon green' id='selected_prod_item_available_info' title='Click to see the requirements of the selected item'></div>
						</div>
						<div class='panel_slot_2' id='panel_slot_2'>
						   <div class='button_icon' id='shipslidebutton'  title='Click to see the full stats, including bonuses, for the selected unit'></div>
						</div>
						<!-- side Panel Borders -->
						<div class='sideborder_topright'></div>
						<div class='sideborder_right'></div>
						<div class='sideborder_bottomright'></div>
						<div class='sideborder_bottom'></div>
						<div class='sideborder_bottomextended'></div>

					</div>

				</div><!-- End production sidepanel -->

				<!-- Low Panel -->

				<div class='lowpanel' id='production_lowpanel'>
					<div class='lowpanel_bg'>
						<div class='lowpanel_content' id='production_lowpanel_content'>
							<div class='lowpanel_header'><span id='production_unitselection'>All units</span></div>
							<div class='lowpanel_table production_list_selection' style='overflow:auto;'>
		                   		<div class='selection_items_container lowpanel_scroll_content' id='production_list_container'></div>

								<!--
								<div class='scrollbuttons'>
									<div class='scrollbutton_up' id='production_list_container_up' onmousedown="return false" onclick="myScroll('production_list_container',190,105)"></div>
									<div class='scrollbutton_down' id='production_list_container_down' onmousedown="return false" onclick="myScroll('production_list_container',-190,105)"></div>
								</div>
								-->
							</div>
							<div class='selection_scrollmask_bottom'></div>
							<div class='selection_scrollmask_top'></div>

							<div class='selection_filter_container' style='width: 380px; left: -10px;'>
								<div class='filter_track'></div>
								<div class='filter_slider' id='production_filter_slider'></div>
								<div class='filter_heading' onclick="renderProductionitems('unavailable')">Unavailable</div>
								<div class='filter_heading' onclick="renderProductionitems('available')">Available</div>
								<div class='filter_heading' onclick="renderProductionitems('all')">All</div>
							</div>
							<div class='lowpanel_uitip_holder'><div class='lowpanel_uitip'>Click on a unit to view technical details.</div></div>
						</div>
						<!-- Low Panel Borders -->
						<!--<div class='lowborder_right'></div>-->
						<div class='lowborder_bottomright'></div>
						<div class='lowborder_bottomleft'></div>
						<div class='lowborder_bottom'></div>
					</div>


				</div>

				<!-- Main Panel -->
				<div class='main_panel production' id='production_main_panel'>
					<div class='main_panel_bg' id='production_main_panel_bg'></div>
					<div class='main_panel_content'>
						<div class='main_header_image_holder_dynamic'>
							<img src='images/fixed/production100.jpg' id='main_production_image'  class='main_header_300_image_dynamic' />
						</div>
						<h3 class='main_header_title'>Production</h3>

						<div class='main_helptext'>
							<span class='textchange'>Click panel to expand</span>
						</div>

						<div class='main_panel_extended_content' id='production_main_panel_extended_content'>
						Your homeworld production units supply your military with all their ships, as well as provide for the civilian section with transports, mining and other utility vessels. You can adjust your production setting as you see fit.
						</div>
					</div>

					<!-- Panel Borders -->
					<div class='mainborder_topright_homeworld'></div>
					<div class='mainborder_right_homeworld'></div>

					<div class='centerslide_container_homeworld' id='production_center_slider'>
						<div class='centerslide_homeworld center_blank'></div>
					</div>


					<div class='mainborder_bottom_homeworld'></div>
					<div class='mainborder_bottomright_ex_homeworld'></div>
					<div class='mainborder_bottomright_homeworld'></div>
					<div class='mainborder_bottomleft_homeworld'></div>

				</div>
			</div><!-- End Production Panel -->

	
			<!-- Development Panel -->
			<div class='main_container halfsize half_5' id='development'>
				<!-- Infoframe -->
				<div class='infopanel' id='development_infopanel'>
					<div class='infopanel_content' id='development_infopanel_content'>
						<div class='infopanel_header'>Ongoing development</div>
						<div id='infopanel_current_development_container'>
						<!-- Content will be loaded here-->

						<!-- End content-->
						</div>
						<div class='queue_list_help_text' id='current_development_helptext'></div>

						<div class='infopanel_header'>Completed development</div>
						<div class='selection_container devcomp_container'>
							<div class='devcomp_list infopanel_scroll_content' id='infopanel_completed_development_container'>
								<!-- Content will be loaded here-->

								<!-- End content-->
							</div>
							<div class='scrollbuttons' style='top:10px'>
								<div class='scrollbutton_up' id='infopanel_completed_development_container_up'  onclick="myScroll('infopanel_completed_development_container',136,500)"></div>
								<div class='scrollbutton_down' id='infopanel_completed_development_container_down'  onclick="myScroll('infopanel_completed_development_container',-136,500)"></div>
							</div>
						</div>
						<div class='queue_list_help_text' id='completed_development_helptext'></div>


					</div>
				</div>

				<!-- Side Panel -->
				<div class='sidepanel' id='development_sidepanel'>
					<div class='sidepanel_bg' id='development_sidepanel_bg'>
						<div class='sidepanel_content' id='development_sidepanel_content'>
							<div class='selected_item_img'><img class='item_img' id='development_sidepanel_selected_development_image' src='images/fixed/spacer.gif'/></div>
							<div class='selected_item_info_overlay' id='developmentslidebutton'></div>
							<div class='main_panel_extended_content smallfont selected_item_description' id='develpoment_selected_item_stat_developmentdescription'>No item selected</div>
							<div class='selected_item_stats'>
								<div class='selected_item_statshade'></div>
							</div>
							<div class='selected_item_statcontainer'>
								<div class='selected_item_statname'>Bonus-description :</div>
								<div class='selected_item_statfull'  id='current_development_bonus_description' ></div>
							</div>
							<div class='selected_item_statcontainer_2'>
								<div class='selected_item_statname'>Time :</div>
								<div class='selected_item_statvalue' id='development_selected_item_stat_time'>N/A</div>
								<!--<div class='selected_item_helpinfo'>Click on the development-image for a detailed stat view.</div>-->
							</div>
							<div class='selected_item_nametab' class='shipinfotab'>
								<div class='selected_dev_name' id='development_selected_item_stat_developmentname'>N/A</div>
							</div>

							<div class='selected_item_typetab'>
								<!--<div class='selected_item_typename'  id='development_selected_item_stat_something'>N/A</div>-->
							</div>

							<div class='costfield prod_cost' id='devcost' style='display:none;'>
								<div class='costbutton' id='devcostbutton'>
									<div class='initiatebutton' style='opacity: 1; '></div>
									<div class='initiatebuttonhover' style='opacity: 0; '></div>
									<div class='buttontext costtext'>Order</div>
								</div>
								<div class='disablebutton'>
									<div class='buttontext costtext'>N/A</div>
								</div>

								<div class='hscost' id='dev_hscost'>0</div>
								<div class='ndcost' id='dev_ndcost'>0</div>
								<div class='srcost' id='dev_srcost'>0</div>
								<div class='incost' id='dev_incost'>0</div>
							</div>

						</div><!-- End sidepanel content-->
						<div class='tab_build_button green' id='selected_dev_item_available_info'></div>

						<!-- side Panel Borders -->
						<div class='sideborder_topright'></div>
						<div class='sideborder_right'></div>
						<div class='sideborder_bottomright'></div>
						<div class='sideborder_bottom'></div>
						<div class='sideborder_bottomextended'></div>
					</div>

				</div><!-- End development sidepanel -->

				<!-- Low Panel -->

				<div class='lowpanel' id='development_lowpanel'>
					<div class='lowpanel_bg'>
						<div class='lowpanel_content' id='development_lowpanel_content'>
							<div class='lowpanel_header'><span id='development_unitselection'>Available Projects</span></div>

							<div class='lowpanel_table dev_list_selection' id='development_selection_container'  style='overflow:auto;'>
								<div class='selection_items_container lowpanel_scroll_content' id='development_list_container'>


								</div>

								<!--
								<div class='scrollbuttons'>
									<div class='scrollbutton_up' id='development_list_container_up' onclick="myScroll('development_list_container',210,105)"></div>
									<div class='scrollbutton_down' id='development_list_container_down' onclick="myScroll('development_list_container',-210,105)"></div>
								</div>
								-->
							</div>
							<div class='selection_scrollmask_bottom'></div>
							<div class='selection_scrollmask_top'></div>



							<div class='selection_filter_container' style='width: 380px; left: -10px;'>
								<div class='filter_track'></div>
								<div class='filter_slider' id='development_filter_slider'></div>
								<div class='filter_heading' onclick="renderDevelopments('unavailable')">Unavailable</div>
								<div class='filter_heading' onclick="renderDevelopments('available')">Available</div>
								<div class='filter_heading' onclick="renderDevelopments('all')">All</div>
							</div>
							<div class='lowpanel_uitip_holder'><div class='lowpanel_uitip'>Click on an item to view development-details.</div></div>
							<!--<div class='lowpanel_helpinfo'>Click on an item to view development-details.</div>-->
						</div>
						<!-- Low Panel Borders -->
						<!--<div class='lowborder_right'></div>-->
						<div class='lowborder_bottomright'></div>
						<div class='lowborder_bottomleft'></div>
						<div class='lowborder_bottom'></div>
					</div>
				</div>

				<!-- Main Panel -->
				<div class='main_panel development' id='development_main_panel'>
					<div class='main_panel_bg' id='development_main_panel_bg'></div>
					<div class='main_panel_content'>
						<div class='main_header_image_holder_dynamic'>
							<img src='images/fixed/500dynadev.jpg' id='main_development_image'  class='main_header_300_image_dynamic' />
						</div>
						<h3 class='main_header_title'>Development</h3>

						<div class='main_helptext'>
							<span class='textchange'>Click panel to expand</span>
						</div>

						<div class='main_panel_extended_content' id='development_main_panel_extended_content'>
						Your homeworld development involves all aspects of structures, waste-handling and recycling as well as generation of energy for your productions. Homeworld development is essential for growth.
						</div>
					</div>

					<!-- Panel Borders -->
					<div class='mainborder_topright_homeworld'></div>
					<div class='mainborder_right_homeworld'></div>

					<div class='centerslide_container_homeworld' id='development_center_slider'>
						<div class='centerslide_homeworld center_blank'></div>
					</div>

					<div class='mainborder_bottom_homeworld'></div>
					<div class='mainborder_bottomright_ex_homeworld'></div>
					<div class='mainborder_bottomright_homeworld'></div>
					<div class='mainborder_bottomleft_homeworld'></div>
				</div>
			</div><!-- End development Panel -->

	
			<!-- Research Panel -->
			<div class='main_container halfsize half_3' id='research'>
				<!-- Infoframe -->
				<div class='infopanel' id='research_infopanel'>
					<div class='infopanel_content' id='research_infopanel_content'>
						<div class='infopanel_header'>Ongoing research</div>
						<div id='infopanel_current_research_container'>
						<!-- Content will be loaded here-->

						<!-- End content-->
						</div>
						<div class='queue_list_help_text' id='current_research_helptext'></div>

						<div class='infopanel_header'>Completed research</div>

						<div class='selection_container rescomp_container'>
							<div class='rescomp_list infopanel_scroll_content' id='infopanel_completed_research_container'>
								<!-- Content will be loaded here-->

								<!-- End content-->
							</div>
							<div class='scrollbuttons' style='top:10px;'>
								<div class='scrollbutton_up' id='infopanel_completed_research_container_up' onclick="myScroll('infopanel_completed_research_container',136,500)"></div>
								<div class='scrollbutton_down' id='infopanel_completed_research_container_down' onclick="myScroll('infopanel_completed_research_container',-136,500)"></div>
							</div>
						</div>
						<div class='queue_list_help_text' id='completed_research_helptext'></div>


					</div>
				</div>

				<!-- Side Panel -->
				<div class='sidepanel' id='research_sidepanel'>
					<div class='sidepanel_bg' id='research_sidepanel_bg'>
						<div class='sidepanel_content' id='research_sidepanel_content'>
							<div class='selected_item_img'><img class='item_img' id='research_sidepanel_selected_research_image' src='images/fixed/spacer.gif'/></div>
							<div class='selected_item_info_overlay' id='researchslidebutton'></div>
							<div class='main_panel_extended_content smallfont selected_item_description' id='research_selected_item_stat_researchdescription' >No item selected</div>
							<div class='selected_item_stats'>
								<div class='selected_item_statshade'></div>
							</div>
							<div class='selected_item_statcontainer'>
								<div class='selected_item_statname'>Bonus-description :</div>
								<div class='selected_item_statfull'  id='current_research_bonus_description' ></div>
							</div>
							<div class='selected_item_statcontainer_2'>
								<div class='selected_item_statname'>Time :</div>
								<div class='selected_item_statvalue' id='research_selected_item_stat_time'>N/A</div>
								<!--<div class='selected_item_helpinfo'>Click on the research-image for a detailed stat view.</div>-->
							</div>
							<div class='selected_item_nametab' class='shipinfotab'>
								<div class='selected_res_name'  id='research_selected_item_stat_researchname'>N/A</div>
							</div>

							<!--
							<div class='selected_item_typetab'>
								<div class='selected_item_typename'  id='research_selected_item_stat_something'>N/A</div>
							</div>
							-->

							<div class='costfield prod_cost' id='rescost' style='display:none;'>
								<div class='costbutton' id='rescostbutton'>
									<div class='initiatebutton' style='opacity: 1; '></div>
									<div class='initiatebuttonhover' style='opacity: 0; '></div>
									<div class='buttontext costtext'>Order</div>
								</div>
								<div class='disablebutton'>
									<div class='buttontext costtext'>N/A</div>
								</div>
								<div class='hscost' id='res_hscost'>0</div>
								<div class='ndcost' id='res_ndcost'>0</div>
								<div class='srcost' id='res_srcost'>0</div>
								<div class='incost' id='res_incost'>0</div>
							</div>


							<!--
							<div class='selected_item_queuebutton' id='startbutton'>
								<div class='lightbutton' id='research_selected_item_start_button'>
									<div class='buttonregular'></div>
									<div class='buttonhover'></div>
								   <div class='buttontext' id='research_selected_item_start_button_label'>N/A</div>
								</div>
							</div>
							-->

						</div><!-- End sidepanel content-->
						<div class='tab_build_button green' id='selected_res_item_available_info'></div>

						<!-- side Panel Borders -->
						<div class='sideborder_topright'></div>
						<div class='sideborder_right'></div>
						<div class='sideborder_bottomright'></div>
						<div class='sideborder_bottom'></div>
						<div class='sideborder_bottomextended'></div>

					</div>

				</div><!-- End research sidepanel -->

				<!-- Low Panel -->

				<div class='lowpanel' id='research_lowpanel'>
					<div class='lowpanel_bg'>
						<div class='lowpanel_content' id='research_lowpanel_content'>
							<div class='lowpanel_header'><span id='research_unitselection'>Available Projects</span></div>

							<div class='lowpanel_table res_list_selection' id='research_selection_container'  style='overflow:auto;'>
								<div class='selection_items_container lowpanel_scroll_content' id='research_list_container'>

									<!-- Content will be loaded into here -->
									<!-- Like this: <div class='selectionitem' id='research001'><img src='images/fixed/researchitem1.png' style='cursor:pointer;' /></div> -->
									<!-- End content -->
								</div>

								<!--<div class='scrollbuttons'>
									<div class='scrollbutton_up' id='research_list_container_up' onclick="myScroll('research_list_container',210,105)"></div>
									<div class='scrollbutton_down' id='research_list_container_down' onclick="myScroll('research_list_container',-210,105)"></div>
								</div>
								-->
							</div>
							<div class='selection_scrollmask_bottom'></div>
							<div class='selection_scrollmask_top'></div>

							<div class='selection_filter_container' style='width: 380px; left: -10px;'>
								<div class='filter_track'></div>
								<div class='filter_slider' id='research_filter_slider'></div>
								<div class='filter_heading' onclick="renderResearches('unavailable')">Unavailable</div>
								<div class='filter_heading' onclick="renderResearches('available')">Available</div>
								<div class='filter_heading' onclick="renderResearches('all')">All</div>
							</div>
							<div class='lowpanel_uitip_holder'><div class='lowpanel_uitip'>Click on an item to view technical details.</div></div>
							<!--<div class='lowpanel_helpinfo'>Click on an item to view technical details.</div>-->
						</div>
						<!-- Low Panel Borders -->
						<!--<div class='lowborder_right'></div>-->
						<div class='lowborder_bottomright'></div>
						<div class='lowborder_bottomleft'></div>
						<div class='lowborder_bottom'></div>
					</div>

				</div>

				<!-- Main Panel -->
				<div class='main_panel research' id='research_main_panel'>
					<div class='main_panel_bg' id='research_main_panel_bg'></div>
					<div class='main_panel_content'>
						<div class='main_header_image_holder_dynamic'>
							<img src='images/fixed/500dynares.jpg' id='main_research_image'  class='main_header_300_image_dynamic' />
						</div>
						<h3 class='main_header_title'>Research</h3>

						<div class='main_helptext'>
							<span class='textchange'>Click panel to expand</span>
						</div>

						<div class='main_panel_extended_content' id='research_main_panel_extended_content'>
						Research is a necessity in the race for resources. Any edge you can get over your opposition is vital, and your research labs are the heart of your progress. Guard your secrets well.
						</div>
					</div>

					<!-- Panel Borders -->
					<div class='mainborder_topright_homeworld'></div>
					<div class='mainborder_right_homeworld'></div>

					<div class='centerslide_container_homeworld' id='research_center_slider'>
						<div class='centerslide_homeworld center_blank'></div>
					</div>

					<div class='mainborder_bottom_homeworld'></div>
					<div class='mainborder_bottomright_ex_homeworld'></div>
					<div class='mainborder_bottomright_homeworld'></div>
					<div class='mainborder_bottomleft_homeworld'></div>

				</div>
			</div><!-- End research Panel -->

	
			<!-- Facilities Panel -->
			<div class='main_container halfsize half_1' id='facility'>
				<!-- Infoframe -->
				<div class='infopanel' id='facility_infopanel'>
					<div class='infopanel_content' id='facilities_infopanel_content'>
						<div class='infopanel_header' id='facilities_info_container'>Facility sub-selection</div>
						<!-- Content will be loaded here, well, rendered tbh...-->

						<!-- End content-->
					</div>
				</div>

				<!-- Side Panel -->
				<div class='sidepanel' id='facility_sidepanel'>
					<div class='sidepanel_bg' id='facility_sidepanel_bg'>
						<div class='sidepanel_content' id='facility_sidepanel_content'>
							<div class='selected_facility_img'>
								<img class='facility_img' id='facility_sidepanel_selected_facility_image' src='images/fixed/failityplaceholder.jpg' height='75'>
							</div>

							<div class='selected_item_info_overlay' id='facilityslidebutton'></div>
							<div class='selected_facility_description'  id='facility_selected_item_stat_facilitydescription'>No facility selected</div>
							<div class='selected_facility_stats'>
								<div class='selected_item_statshade'></div>
							</div>
							<div class='selected_facility_statcontainer'>
								<div class='selected_item_statname'>Bonus-description :</div>
								<div class='selected_item_statfull'  id='current_facility_bonus_description' ></div>
							</div>
							<div class='selected_facility_statcontainer_2'>
								<div class='selected_item_statname'>Build-time :</div>
								<div class='selected_item_statvalue' id='next_facility_selected_item_stat_time'>N/A</div>
								<div class='selected_item_statname'>Upgrade-bonus :</div>
								<div class='selected_item_statfull' id='next_facility_bonus_description'>N/A</div>
							</div>
							<div class='selected_facility_typetab'></div>
							<div class='selected_facility_nametab' class='shipinfotab'>
								<div class='selected_item_name'  id='facility_selected_item_stat_facilityname'>N/A</div>
							</div>
							<div class='costfield fac_cost' id='faccost' style='display:none;'>
								<div class='costbutton' id='faccostbutton'>
									<div class='initiatebutton' style='opacity: 1; '></div>
									<div class='initiatebuttonhover' style='opacity: 0; '></div>
									<div class='buttontext costtext'>Build</div>
								</div>
								<div class='disablebutton'>
									<div class='buttontext costtext'>N/A</div>
								</div>
								<div class='hscost' id='fac_hscost'>0</div>
								<div class='ndcost' id='fac_ndcost'>0</div>
								<div class='srcost' id='fac_srcost'>0</div>
								<div class='incost' id='fac_incost'>0</div>
							</div>

						</div><!-- End sidepanel content-->
						<div class='tab_build_button green facility' id='selected_fac_item_available_info'></div>

						<!-- side Panel Borders -->
						<div class='sideborder_topright'></div>
						<div class='sideborder_right'></div>
						<div class='sideborder_bottomright'></div>
						<div class='sideborder_bottom'></div>
						<div class='sideborder_bottomextended'></div>

					</div>

				</div><!-- End facility sidepanel -->

				<!-- Low Panel -->

				<div class='lowpanel' id='facility_lowpanel'>
					<div class='lowpanel_bg'>
						<div class='lowpanel_content' id='facilities_lowpanel_content'>
							<div class='lowpanel_header'><span id='facilities_unitselection'>Facilities</span></div>
							<div class='lowpanel_table facilities_list_selection' style='overflow:auto;'>
								<div class='facility_list_container lowpanel_scroll_content' id='facility_list_container'>
									<!-- Content will be loaded into here -->

									<!-- End content -->
								</div>
								<!--
								<div class='scrollbuttons'>
									<div class='scrollbutton_up' id='facility_list_container_up' onclick="myScroll('facility_list_container',275,300)"></div>
									<div class='scrollbutton_down' id='facility_list_container_down' onclick="myScroll('facility_list_container',-275,300)"></div>
								</div>
								-->
							</div>
							<div class='selection_scrollmask_bottom' style='bottom:-3px;'></div>
							<div class='selection_scrollmask_top'></div>

							<!--<div class='lowpanel_uitip_holder'><div class='lowpanel_uitip'>Click on a facilities-icon to view further details.</div></div>-->
							<!--<div class='lowpanel_helpinfo'>Click on a facilities-icon to view further details.</div>-->
						</div>
						<!-- Low Panel Borders -->
						<!--<div class='lowborder_right'></div>-->
						<div class='lowborder_bottomright'></div>
						<div class='lowborder_bottomleft'></div>
						<div class='lowborder_bottom'></div>
					</div>
				</div>

				<!-- Main Panel -->
				<div class='main_panel facilities' id='facility_main_panel'>
					<div class='main_panel_bg' id='facilities_main_panel_bg'></div>
					<div class='main_panel_content'>
						<div class='main_header_image_holder_dynamic'>
							<img src='images/fixed/500dynafac.jpg' id='main_facilities_image'  class='main_header_300_image_dynamic' />
						</div>
						<h3 class='main_header_title'>Facilities</h3>

						<div class='main_helptext'>
							<span class='textchange'>Click panel to expand</span>
						</div>

						<div class='main_panel_extended_content' id='facilities_main_panel_extended_content'>
						Facilities are important in the race for resources. Any edge you can get over your opposition is vital, and your facilities labs are the heart of your progress. Guard your secrets well.
						Some facilities have sub-sections that are independently upgradable. Select a sub-section to upgrade it.

						</div>
					</div>

					<!-- Panel Borders -->

					<div class='mainborder_topright_homeworld'></div>
					<div class='mainborder_right_homeworld'></div>
					<div class='centerslide_container_homeworld' id='facility_center_slider'>
						<div class='centerslide_homeworld center_progress'></div>
					</div>
					<div class='mainborder_bottom_homeworld'></div>
					<div class='mainborder_bottomright_ex_homeworld'></div>
					<div class='mainborder_bottomright_homeworld'></div>
					<div class='mainborder_bottomleft_homeworld'></div>
				</div>
			</div><!-- End facilities Panel -->

	
		</div>
		<!--
			Ends the homeworld-content
		-->
	<div class='section_container' id='outposts_content'>

	<div class='outpostspane' id='outpostspane' style='width: 350px; left: 635px;'>
		<div class='outposts_name_panel'></div>
		<div class='outposts_img_container' style='left: -100px;'>
			<img class='outposts_img' src='images/fixed/station5.png'>
		</div>
		<div class='outposts_info_container' style='height:360px;'>
			<div class='outposts_name_container'>
				<div class='outposts_header'>Outposts Overview</div>
			</div>
			<div class='outposts_detail'>
				<div class='user_detail_title'>Outposts:</div>
				<div class='user_detail_entry'><span id='o_o_count'></span> / <span id='o_o_max'></span></div>
			</div>
			<div class='outposts_detail'>
				<div class='user_detail_title'>Output:</div>
				<div class='user_detail_entry' id='o_o_production'>271.208 u/h</div>
			</div>
			<!--
			<div class='outposts_detail'>
				<div class='user_detail_title'>Stored:</div>
				<div class='user_detail_entry' id='o_o_stored'>3.463.365</div>
			</div>
			-->
			<div class='outposts_detail overview' style='height:117px'>
				<div class='user_detail_title overview'>Resource Distribution:</div>
				<!--<div class='user_detail_title stored'>Stored:</div>-->
				<div class='outpost_dp_res_container overview'>
					<img class='outpost_dp_res_img' src='images/icons/elements/hs42.png'>
					<div class='outpost_dp_res_pct overview'>
						<span id='o_o_prod_percent_hs'>33%</span>
						<span class='resource_speed' id='o_o_production_hs'>88.741/h</span>
						<!--<span class='resource_stored' id='o_o_stored_hs'>1.114.687</span>-->
					</div>
				</div>
				<div class='outpost_dp_res_container overview'>
					<img class='outpost_dp_res_img' src='images/icons/elements/in42.png'>
					<div class='outpost_dp_res_pct overview'>
						<span id='o_o_prod_percent_in'>25%</span>
						<span class='resource_speed' id='o_o_production_in'>67.334/h</span>
						<!--<span class='resource_stored' id='o_o_stored_in'>859.037</span>-->
					</div>
				</div>
				<div class='outpost_dp_res_container overview'>
					<img class='outpost_dp_res_img' src='images/icons/elements/sr42.png'>
					<div class='outpost_dp_res_pct overview'>
						<span id='o_o_prod_percent_sr'>24%</span>
						<span class='resource_speed' id='o_o_production_sr'>64.017/h</span>
						<!--<span class='resource_stored' id='o_o_stored_sr'>838.349</span>-->
					</div>
				</div>
				<div class='outpost_dp_res_container overview'>
					<img class='outpost_dp_res_img' src='images/icons/elements/nd42.png'>
					<div class='outpost_dp_res_pct overview'>
						<span id='o_o_prod_percent_nd'>19%</span>
						<span class='resource_speed' id='o_o_production_nd'>51.116/h</span>
						<!--<span class='resource_stored' id='o_o_stored_nd'>651.292</span>-->
					</div>
				</div>
			</div>
			<div class='outposts_detail transport'>
				<!--<div class='lightbutton160' id='auto_transport_button' onclick='initiateAutoTransport()'>
					<div class='buttontext24'>Auto-transport</div>
				</div>
				<div class='user_detail_help'>
					Use available transports to retrieve stored resources from outposts.
					Highest fill-percent has priority. No escorts will be assigned.
					<br><span id='outposts_transport_available_counter'>0</span> transports available.
				</div>
				-->
				<div class='user_detail_help' style='height:139px; text-align:left;padding-left:5px;padding-top:0px;'>
					- Renaming an outpost costs 2 credits.<br>
					- If someone captures one of your outposts, your other outposts can not be attacked for 3 hours.<br>
					- The higher the potential, and the higher the outpost-level, the more resources are extracted.<br>
					- Outposts generate resources directly on your homeworld every 15 minutes.<br>
					- When defending an outpost, you will gain combat-bonuses based on your Commanders level and the level of the outpost.
				</div>

			</div>
		</div>
	</div>

	<div class='outpostspane outposts_list'>
		<div class='outpost_list_col_sep list_sep_1'></div>
		<div class='outpost_list_col_sep list_sep_2'></div>
		<div class='outpost_list_col_sep list_sep_3'></div>
		<div class='outpost_list_col_sep list_sep_4'></div>
		<div class='outpost_list_col_sep list_sep_5'></div>
		<!--<div class='outpost_list_col_sep list_sep_6'></div>-->
		<div class='outpost_list_header_container' id='outpost_list_header_container'>
			<h3 class='main_header_title outpost_list_main_header'>Your Outposts</h3>
			<!--<div class='outpost_list_stor_header' id='op_list_hd_fill' onclick='setOutpostSorting("fill")'>Fill</div>-->
			<div class='outpost_list_out_header' id='op_list_hd_output'  onclick='setOutpostSorting("output")'>Output</div>
			<div class='outpost_list_pot_header' id='op_list_hd_potential'  onclick='setOutpostSorting("potential")'>Pot</div>
			<div class='outpost_list_def_header' id='op_list_hd_def' onclick='setOutpostSorting("def")'>Def</div>
			<div class='outpost_list_lvl_header' id='op_list_hd_level' onclick='setOutpostSorting("level")'>Lvl</div>
			<div class='outpost_list_tt_header' id='op_list_hd_traveltime' onclick='setOutpostSorting("traveltime")'>T-Time</div>

		</div>
		<div class='outpost_list_scrollwrapper' id='outpost_list_scroller'>

		</div>
		<div class='outpost_list_footer_container'>
			Click on an outpost to view details.<br><span style='color:red'>Red</span> text in the DEF column means that outpost needs more defense.
		</div>
	</div>

	<div class='main_container outpostsize third_9' id='selected_outpost_panel' style='z-index: 1; top: 385px; left: 635px;'>
		<div class='infopanel' id='selected_outpost_infopanel'>
			<div class='infopanel_content'>
				<div class='outpost_fleet_info' id='selected_outpost_fleetdetails' style='display: none;'></div>
				<div class='outpost_defense_overview' id='selected_outpost_fleet_overview'>
					<div class='infopanel_header'>Defensive Fleet Overview</div>
					<div class='outpost_commander'>
						<div class='commander_container'>
							<div class='row_entry commander_entry' id='selected_outpost_commander' onclick='outpostDefensiveCommanderPanelClick()' style='height: 228px;'>
								<div class='defensive_commander_header'>Commanding Officer</div>
								<div class='defensive_commander'>
									<div class='defensive_commander_img'>
										<img id='selected_outpost_commander_background' src='images/commanders/nobg.jpg' style='width: 116px; height:130px; position: absolute;'>
										<img id='selected_outpost_commander_uniform' src='images/commanders/nouniform.png' style='width: 116px; position: absolute;'>
										<img id='selected_outpost_commander_head' src='images/commanders/nohead.png' style='width: 116px; position: absolute;'>
									</div>
									<div class='defensive_commander_name'>
										<div id='selected_outpost_commander_rank' style='padding-top: 5px;'>N/A</div>
										<div id='selected_outpost_commander_name' class='defensive_commander_rank'>N/A</div>
										<img id='selected_outpost_commander_rank_image' src='images/icons/insignias/rank05.png' style='margin-top: 5px;'>
									</div>
								</div>
								<div class='def_commander_statcontainer outpost'>
									<div class='outpost_comm_stat_styling_1'></div>
									<div class='outpost_comm_stat_styling_2'></div>
									<div class='outpost_comm_stat_styling_3'></div>
									<div class='comm_stat_container outpost'>
										<div class='comm_stat_header'>Personality</div>
										<div class='comm_stat_entry' id='selected_outpost_commander_stat_personality'>N/A</div>
										<div class='comm_stat_header comm_stat_margin'>Commanding</div>
										<div class='comm_stat_entry comm_stat_margin' id='selected_outpost_commander_stat_commanding'>0</div>
										<div class='comm_stat_header'>Perception</div>
										<div class='comm_stat_entry' id='selected_outpost_commander_stat_perception'>0</div>
										<div class='comm_stat_header'>Tactics</div>
										<div class='comm_stat_entry' id='selected_outpost_commander_stat_tactics'>0</div>
										<div class='comm_stat_header'>Morale</div>
										<div class='comm_stat_entry' id='selected_outpost_commander_stat_morale'>0</div>
										<div class='comm_stat_header comm_stat_margin'>Experience</div>
										<div class='comm_stat_entry comm_stat_margin' id='selected_outpost_commander_stat_experience'>0</div>
										<div class='comm_stat_header'>Strength-limit</div>
										<div class='comm_stat_entry' id='selected_outpost_commander_stat_ship_limit'>5</div>
										<div class='comm_stat_header'>Fleet-limit</div>
										<div class='comm_stat_entry' id='selected_outpost_commander_stat_fleet_limit'>-</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class='outpost_fleet_details'>
						<div class='def_overview_container' style='position: relative;'>
							<div class='def_fleet_entry'>
								<div class='def_detail_title'>Total Fleets</div>
								<div class='def_detail_entry' id='selected_outpost_total_fleets'>0</div>
								<div class='def_detail_title'>Ship-count</div>
								<div class='def_detail_entry' id='selected_outpost_ship_count'>0</div>
								<div class='def_detail_title'>Minor ships</div>
								<div class='def_detail_entry' id='selected_outpost_minors_count'>0</div>
								<div class='def_detail_title'>Strength</div>
								<div class='def_detail_entry' id='selected_outpost_firepower'>0</div>
								<!--
								<div class='def_detail_title'>Defenses</div>
								<div class='def_detail_entry' id='selected_outpost_defenses'>0</div>
								-->
								<div class='def_detail_title'>Techtilt</div>
								<div class='def_detail_entry' id='selected_outpost_total_techtilt'>Neutral</div>
								<!--
								<div class='def_detail_title'>Allied fleets</div>
								<div class='def_detail_entry' id='selected_outpost_allied_fleets'>0</div>
								<div class='def_detail_title'>Max-fleets</div>
								<div class='def_detail_entry' id='selected_outpost_max_fleets'>0</div>
								-->
							</div>
						</div>
					</div>
					<div class='row_container outpost_def_tac_row'>
						<div class='def_tactics_entry row_entry' id='selected_outpost_simple_tactics' onclick='outpostTacticsPanelClick()' style='height: 154px;'>
							<div class='queue_entry_content_container'>
								<div class='dumb2 def_tactical_header'>Simple Tactical Options</div>
								<div class='queue_entry_info fleet_info_bg'>Tactical overview area. Yet to be designed and determined</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class='sidepanel' id='selected_outpost_sidepanel'>
			<div class='sidepanel_bg' id='selected_outpost_sidepanel_bg'>
				<div class='sidepanel_content'>
					<div class='outpost_portrait'><img src='images/fixed/outpost_lvl_1_3.jpg'  id='selected_outpost_portrait'></div>
					<div class='selected_outpost_typetab'>
						<div class='selected_item_name outpost_name' title='Renaming an outpost costs 2 credits (FREE for VIPs)' id='selected_outpost_name' contenteditable='false' spellcheck='false' style='-webkit-touch-callout: default; -webkit-user-select: text; -khtml-user-select: text; -moz-user-select: text; -ms-user-select: text;'>No outpost selected</div>
					</div>
					<div class='selected_outpost_abandon'>
						<div class='fixed_button fixed_button_140_condensed' id='outpost_abandon_button' onclick='abandonOutpostClickFirst()'>

							<div class='fixed_button_regular_condensed'></div>
							<div class='fixed_button_hover red22'></div>
							<div class='fixed_button_click red22'></div>
							<div class='dyna_button_text type3'>Abandon</div>
						</div>
						<div class='selected_outpost_abandon_timer'>Allowed in: <span id='sel_outpost_abandon_timer_string'>--:--</span></div>
					</div>
					<div class='selected_outpost_actionstab'>
						<!--
						<div class='fixed_button fixed_button_160_double' id='selected_outpost_transport_button' onclick='prepareTransportClickNew()'>
							<div class='fixed_button_regular_double'></div>
							<div class='fixed_button_hover blue_double'></div>
							<div class='fixed_button_click blue_double'></div>
							<div class='dyna_button_text type3'>Prepare Transport</div>
						</div>
						-->
						<div class='fixed_button fixed_button_160_double' id='selected_outpost_deactivate_button' onclick='activateOutpost()' style='margin-top:25px;'>
							<div class='fixed_button_regular_double'></div>
							<div class='fixed_button_hover blue_double'></div>
							<div class='fixed_button_click blue_double'></div>
							<div class='dyna_button_text type3' id='new_outpost_activate_button'>Deactivate Outpost</div>
						</div>

					</div>
					<div class='selected_outpost_current_info'>
						<div class='selected_outpost_stat'>Current Output:</div>
						<div class='selected_outpost_statvalue'></div>
						<div class='outpost_element_box first'>
							<div class='outpost_element_prod'></div>
							<div class='outpost_element_quantity'>
								<div class='px12shade' id='selected_outpost_prod_hs_current'>0 u/h</div>
								<div class='px12quantity' id='selected_outpost_prod_hs_current_shadow'>0 u/h</div>
							</div>
						</div>
						<div class='outpost_element_upgraded first'>
							<div class='px12shade' id='selected_outpost_prod_hs_next'>0 u/h</div>
							<div class='px12quantity' id='selected_outpost_prod_hs_next_shadow'>0 u/h</div>
						</div>
						<div class='outpost_element_box second'>
							<div class='outpost_element_prod'></div>
							<div class='outpost_element_quantity'>
								<div class='px12shade' id='selected_outpost_prod_in_current'>0 u/h</div>
								<div class='px12quantity' id='selected_outpost_prod_in_current_shadow'>0 u/h</div>
							</div>
						</div>
						<div class='outpost_element_upgraded second'>
							<div class='px12shade' id='selected_outpost_prod_in_next'>0 u/h</div>
							<div class='px12quantity' id='selected_outpost_prod_in_next_shadow'>0 u/h</div>
						</div>
						<div class='outpost_element_box third'>
							<div class='outpost_element_prod'></div>
							<div class='outpost_element_quantity'>
								<div class='px12shade' id='selected_outpost_prod_sr_current'>0 u/h</div>
								<div class='px12quantity' id='selected_outpost_prod_sr_current_shadow'>0 u/h</div>
							</div>
						</div>
						<div class='outpost_element_upgraded third'>
							<div class='px12shade' id='selected_outpost_prod_sr_next'>0 u/h</div>
							<div class='px12quantity' id='selected_outpost_prod_sr_next_shadow'>0 u/h</div>
						</div>
						<div class='outpost_element_box fourth'>
							<div class='outpost_element_prod'></div>
							<div class='outpost_element_quantity'>
								<div class='px12shade' id='selected_outpost_prod_nd_current'>0 u/h</div>
								<div class='px12quantity' id='selected_outpost_prod_nd_current_shadow'>0 u/h</div>
							</div>
						</div>
						<div class='outpost_element_upgraded fourth'>
							<div class='px12shade' id='selected_outpost_prod_nd_next'>0 u/h</div>
							<div class='px12quantity' id='selected_outpost_prod_nd_next_shadow'>0 u/h</div>
						</div>
					</div>
					<div class='selected_outpost_maskdown'></div>
					<div class='selected_outpost_upgradetitle'>Next Level</div>
					<div class='selected_outpost_maskup'></div>
					<div class='selected_outpost_upgrade_info'>
						<!--
							<div class='selected_outpost_stat'>Total Storage:</div>
							<div class='selected_outpost_statvalue' id='selected_outpost_next_total_storage'>N/A</div>
						-->
						<div class='selected_outpost_stat'>New Operating Capacity:</div>
						<div class='selected_outpost_statvalue' id='selected_outpost_next_operating_capacity'>N/A</div>
						<div class='selected_outpost_stat'>Upgrade-time:</div>
						<div class='selected_outpost_statvalue' id='selected_outpost_next_upgrade_time'>N/A</div>
					</div>
					<div class='costfield outpost_upgrade_cost' id='selected_outpost_upgrade_cost_container'>
						<div class='costbutton' id='selected_outpost_upgrade_button' onclick='upgradeOutpostClick()'>
							<div class='initiatebutton'></div>
							<div class='initiatebuttonhover'></div>
							<div class='buttontext costtext' id='selected_outpost_upgrade_button_text'>Upgrade</div>
						</div>
						<div class='disablebutton' id='selected_outpost_upgrade_button_disabled' style='display: none;' onclick='outpostUpgradeDisabledClick()'>
							<div class='buttontext costtext' id='selected_outpost_upgrade_button_disabled_text'>N/A</div>
						</div>
						<div class='hscost' id='selected_outpost_upgrade_cost_hs'>N/A</div>
						<div class='incost' id='selected_outpost_upgrade_cost_in'>N/A</div>
						<div class='srcost' id='selected_outpost_upgrade_cost_sr'>N/A</div>
						<div class='ndcost' id='selected_outpost_upgrade_cost_nd'>N/A</div>


					</div>
				</div>
				<div class='sideborder_topright'></div>
				<div class='sideborder_right'></div>
				<div class='sideborder_bottomright'></div>
				<div class='sideborder_bottom'></div>
				<div class='sideborder_bottomextended'></div>

			</div>
		</div>

		<div class='lowpanel' id='outpost_lowpanel_6'>
			<div class='lowpanel_bg' style='bottom: 6px;'>
				<div class='lowpanel_content'>
					<div class='lowpanel_header'>Defensive fleets</div>
					<div class='lowpanel_table' style='height: 215px;width: 455px;'>
						<div class='lowpanel_table_borderwrapper scrollBG'>
							<div class='lowpanel_table_contentlist footer lowpanel_scroll_content' id='selected_outpost_fleets_container'></div>
							<div class='lowpanel_table_headers'>
								<div class='table_fleet_name outpost'>Fleet-name</div>
								<div class='table_fleet_type outpost'></div>
								<div class='table_fleet_size outpost'>Cap</div>
								<div class='table_fleet_size outpost'>Min</div>
								<div class='table_fleet_strength outpost'>Strength</div>
							</div>
							<div class='lowpanel_table_footers' onclick='showOutpostDefensiveOverview()'>
								<div class='lowpanel_table_footer_bg'></div>
								<div class='lowpanel_table_footer_title'>Defensive Overview and Tactics</div>
							</div>
							<div class='tableborderleft'></div>
							<div class='tableborderright'></div>
							<div class='tableborderbottom'></div>
							<div class='tablebordertop'></div>
							<div class='tablebordertopleft'></div>
							<div class='tablebordertopright'></div>
							<div class='tableborderbottomleft'></div>
							<div class='tableborderbottomright'></div>
						</div>
						<div class='scrollbuttons'>
							<div class='scrollbutton_up' id='selected_outpost_fleets_container_down' onclick='myScroll("selected_outpost_fleets_container",-181,500,"scrollBG")'></div>
							<div class='scrollbutton_down' id='selected_outpost_fleets_container_up' onclick='myScroll("selected_outpost_fleets_container",181,500,"scrollBG")'></div>
						</div>
					</div>
					<div class='lowpanel_uitip_holder'>
						<div class='lowpanel_uitip'>Click on a fleet name to view details.</div>
					</div>
				</div>
				<div class='lowborder_right'></div>
				<div class='lowborder_bottomright'></div>
				<div class='lowborder_bottomleft'></div>
				<div class='lowborder_bottom'></div>

			</div>
		</div>

		<div class='main_panel outpost darkpanel' id='outpost_mainpanel'>
			<div class='main_panel_bg'></div>
			<div class='main_panel_content' id='outpost_mainpanel_content'>
				<div class='outpost_mini_info'>
					<div class='outpost_mini_info_level' id='selected_outpost_main_mini_level'>L1</div>
					<div class='outpost_mini_info_title'>Output:</div>
					<div class='outpost_mini_info_entry' id='selected_outpost_main_total_output'>0 u/h</div>
					<div class='outpost_mini_info_title'>Utilization:</div>
					<div class='outpost_mini_info_entry' id='selected_outpost_main_utilization'>N/A</div>
				</div>
				<div class='outpost_img_container'>
					<img class='outpost_img' src='images/planets/outpost_planets/planettype00.jpg'  id='selected_outpost_planet_image'>
				</div>
				<h3 class='main_header_title outpost_title' id='selected_outpost_main_name'>No Outpost Selected</h3>
				<div class='main_helptext helptext_small'>
					<span class='textchange'>Select one of your outposts in the list</span>
				</div>
				<div class='main_panel_darkpanel'>
					<div class='outpost_dp_title'>Potential:</div>
					<div class='outpost_dp_entry' id='selected_outpost_potential'>N/A</div>
					<div class='outpost_dp_title'>Operating Capacity:</div>
					<div class='outpost_dp_entry' id='selected_outpost_operating_capacity'>0 %</div>
					<div class='outpost_dp_title'>Recommended defense:</div>
					<div class='outpost_dp_entry' id='selected_outpost_recommended_defense'>-</div>
					<div class='outpost_dp_title'>Present defense:</div>
					<div class='outpost_dp_entry' id='selected_outpost_present_defense'>-</div>

			<!--
					<div class='outpost_dp_title'>Total storage:</div>
					<div class='outpost_dp_entry' id='selected_outpost_total_storage'>N/A</div>
					<div class='outpost_dp_title'>Stored resources:</div>
					<div class='outpost_dp_entry'  id='selected_outpost_stored_resources'>N/A</div>
					<div class='outpost_dp_title'>Time to max:</div>
					<div class='outpost_dp_entry'  id='selected_outpost_time_to_max'>N/A</div>
					<div class='outpost_dp_title'>Transport present:</div>
					<div class='outpost_dp_entry' id='selected_outpost_transport_present'>0</div>
					<div class='outpost_dp_title'>Transport-time:</div>
					<div class='outpost_dp_entry' id='selected_outpost_transport_time'>103m</div>
			-->
					<div class='outpost_dp_tab'>Hourly Output</div>
					<div class='outpost_dp_res_dist'>
						<div class='outpost_dp_res_container'>
							<img class='outpost_dp_res_img' src='images/icons/elements/hs42.png'>
							<div class='outpost_dp_res_pct'>
								<span id='selected_outpost_output_percent_hs'>0%</span>
								<span class='resource_speed' id='selected_outpost_output_hs'>0 u/h</span>
							</div>
						</div>
						<div class='outpost_dp_spacer'></div>
						<div class='outpost_dp_res_container'>
							<img class='outpost_dp_res_img' src='images/icons/elements/in42.png'>
							<div class='outpost_dp_res_pct'>
								<span id='selected_outpost_output_percent_in'>0%</span>
								<span class='resource_speed' id='selected_outpost_output_in'>0 u/h</span>
							</div>
						</div>
						<div class='outpost_dp_spacer'></div>
						<div class='outpost_dp_res_container'>
							<img class='outpost_dp_res_img' src='images/icons/elements/sr42.png'>
							<div class='outpost_dp_res_pct'>
								<span id='selected_outpost_output_percent_sr'>0%</span>
								<span class='resource_speed' id='selected_outpost_output_sr'>0 u/h</span>
							</div>
						</div>
						<div class='outpost_dp_spacer'></div>
						<div class='outpost_dp_res_container'>
							<img class='outpost_dp_res_img' src='images/icons/elements/nd42.png'>
							<div class='outpost_dp_res_pct'>
								<span id='selected_outpost_output_percent_nd'>0%</span>
								<span class='resource_speed' id='selected_outpost_output_nd'>0 u/h</span>
							</div>
						</div>
					</div>
				</div>
				<div class='main_panel_extended_content'>
					<div class='outpost_mainpanel_header'>Starmap Location</div>
					<div class='outpost_coords' id='selected_outpost_coords'>[x:x:x:x:x]</div>
					<!--
					<div class='outpost_mainpanel_header' style='text-transform:uppercase; text-align: center;'>Current Resources</div>

					<div class='outpost_levels'>
						<div class='resouce_level hs_level' id='selected_outpost_stored_hs'>N/A</div>
						<div class='resouce_level sr_level' id='selected_outpost_stored_sr'>N/A</div>
						<div class='resouce_level nd_level' id='selected_outpost_stored_nd'>N/A</div>
						<div class='resouce_level in_level' id='selected_outpost_stored_in'>N/A</div>
					</div>
					-->
				</div>
			</div>
			<div class='centerslide_inside'>
				<div class='insideslide'>
					<img class='zerofill' id='selected_outpost_fill_image' src='images/tiles/outpostcornerinside0.png'>
				</div>
			</div>
			<div class='mainborder_topright_outpost'></div>
			<div class='mainborder_right_outpost'></div>
			<div class='centerslide_container'>
				<div class='centerslide_high_outpost'></div>
				<div class='centerslide_low_outpost'></div>
				<div class='centerslide_mid_outpost'></div>
			</div>
			<div class='mainborder_bottom_outpost'></div>
			<div class='mainborder_bottomright_outpost'>
				<img class='inactiveOutpost' id='selected_outpost_status_corner_image' src='images/tiles/panelborders/bottomrightoff.png'>
			</div>
			<div class='mainborder_bottomextended_outpost'></div>
			<div class='mainborder_bottomleft_outpost'></div>
		</div>
	</div>

	
		</div>
		<!-- Ends the outposts-content-->
	<div class='section_container' id='alliance_content'><img class='alliance_bg_img' src='images/fixed/alliance_bg_img.png'>
		<div class='alliancepane noalliance' id='no_allianse_alliancepane' style='display:none;'>
			<div class='alliance_info_container'>
				<div class='alliancecrest'>
					<img src='images/fixed/avatartest.png' id='avatar_crest_image' />
				</div>
				<div class='alliance_noallianceinfo'>
					<div class='alliance_noalliancetext'>
						You are not a member of an alliance.<br />
						Join an existing alliance, or create your own below.
					</div>
				</div>
				<div class='create_alliance_container'>
					<div class='create_alliance_header'>Create a new Alliance</div>
					<input class='create_alliance_name' placeholder='Type alliance name here...' id='new_alliance_name_input' />
					<div class='lightbutton160' id='newalliance_create' onclick="createAllianceClick()">
						<div class='buttontext24'>Create</div>
					</div>
				</div>
			</div>
		</div>
	
		<div class='alliancepane' id='alliancepane' >
			<div class='alliance_name_panel'></div>
			<div class='alliance_info_container'>
				<div id='leave_alliance' class='leave_alliance fixed_button fixed_button_160_double' onclick='leaveAllianceClick()'>
					<div class='fixed_button_regular_double'></div>
					<div class='fixed_button_hover blue_double'></div>
					<div class='fixed_button_click blue_double'></div>
					<div class='dyna_button_text type3'>Leave Alliance</div>
				</div>
				<div id='alliance_crest_container' class='alliance_crest_container'>
					<img class='crestimage' id='crest' src='images/uploads/alliancelogos/none.jpg'  style='left:auto;right:10px;'/>
				</div>
				<div class='alliance_summary' style='text-align:left;left:auto;'>
					<span id='alliance_pane_alliance_name' style='left:10px;'></span><br />

					<div class='user_detail alliance' >
						<div class='user_detail_title' style='width:156px;'>Members: </div>
						<div class='user_detail_entry' id='alliance_pane_members_number' ></div>
					</div>

					<div class='user_detail alliance'>
						<div class='user_detail_title' style='width:156px;'>Leader: </div>
						<div class='user_detail_entry' id='alliance_pane_leader_name' ></div>
					</div>

					<div class='user_detail alliance'>
						<div class='user_detail_title' style='width:156px;'>Officers: </div>
						<div class='user_detail_entry' id='alliance_pane_officers_number' ></div>
					</div>

					<div class='user_detail alliance'>
						<div class='user_detail_title' style='width:156px;'>Score Rank: </div>
						<div class='user_detail_entry' id='alliance_pane_score_ranking_number' ></div>
					</div>

					<div class='user_detail alliance'>
						<div class='user_detail_title' style='width:156px;'>Strength Rank: </div>
						<div class='user_detail_entry' id='alliance_pane_strength_ranking_number' ></div>
					</div>

					<div class='user_detail alliance'>
						<div class='user_detail_title' style='width:156px;'>XP Rank: </div>
						<div class='user_detail_entry' id='alliance_pane_xp_ranking_number' ></div>
					</div>
					<div class='user_detail alliance'>
						<div class='user_detail_title' style='width:156px;'>Alliance-forum: </div>
						<div class='user_detail_entry' id='alliance_pane_xp_ranking_number' onclick='forumClick(8)' style='cursor:pointer;'>Click here</div>
					</div>
					<div class='user_detail motd'>
						<div class='motd_header'>MOTD</div>
						<div class='alliance_motd' id='alliance_motd'></div>
					</div>
				</div>
			</div>
		</div>


	
		<div class='main_container halfsize half_1' id='allianceinvites' style='display:none;'>
			<div class='nocontainer'>
				<div class='invites_table'>
					<div class='invites_table_borderwrapper scrollBG'>
						<div class='invites_table_contentlist'>
							<div class='invites_table_scrollwrapper' id='allYourInvites'>

							</div>
						</div>
						<div class='invites_table_headers'>
							<div class='invites_table_fleet_name'>Invites</div>
						</div>
					</div>
					<div class='scrollbuttons invites'>
						<div class='scrollbutton_up' id='allYourInvites_up' onclick="myScroll('allYourInvites',120,500,'scrollBG')"></div>
						<div class='scrollbutton_down' id='allYourInvites_down' onclick="myScroll('allYourInvites',-120,500,'scrollBG')"></div>
					</div>
				</div>
			</div>
		</div>
	
			<div class='main_container halfsize half_1' id='alliance_management' >
				<div class='infopanel' id='alliance_management_infopanel'>
					<div class='infopanel_content' id='alliance_management_infopanel_content'>
						Shows current detailed settings for the alliance.
					</div>
				</div>
				<div class='sidepanel' id='alliance_management_sidepanel'>
					<div class='sidepanel_bg' id='alliance_sidepanel_sidepanel_bg'>
						<div class='sidepanel_content' id='alliance_management_sidepanel_content'>
							Select an area of management in the list to the left.
						</div>
						<div class='sideborder_topright'></div>
						<div class='sideborder_right'></div>
						<div class='sideborder_bottomright'></div>
						<div class='sideborder_bottom'></div>
						<div class='sideborder_bottomextended'></div>

					</div>
				</div>

				<div class='lowpanel' id='alliance_management_lowpanel'>
					<div class='lowpanel_bg' style='bottom: 6px;'>
						<div class='lowpanel_content' id='alliance_management_lowpanel_content'>
							<div class='lowpanel_header'>Management Options</div>
							<div class='lowpanel_table alliance_management'>
								<div class='lowpanel_table_borderwrapper scrollBG'>
									<div class='lowpanel_table_contentlist noheaders'>
										<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='alliance_manage'>
											<div class='tableselection evenline ' >
												<div class='table_alliance_management_section view_alliance_info' id='view_all_info' onclick="allianceManagementAllianceInformationClick()">Alliance Information</div>
											</div>
											<div class='tableselection oddline' >
												<div class='table_alliance_management_section' id='view_off_rank'onclick="allianceManagementRankManagementClick()">Officers and Rank Management</div>
											</div>
											<div class='tableselection evenline ' >
												<div class='table_alliance_management_section view_alliance_news' id='view_alliance_news' onclick="allianceManagementAllianceNewsClick()">Alliance News</div>
											</div>
											<div class='tableselection oddline' >
												<div class='table_alliance_management_section view_motd' id='view_motd' onclick="allianceManagementMessageOfTheDayClick()">Message of the Day</div>
											</div>
											<div class='tableselection evenline' >
												<div class='table_alliance_management_section' id='view_invites' onclick="allianceManagementIssuedInvitesClick()">Invites</div>
											</div>
											<div class='tableselection oddline' >
												<div class='table_alliance_management_section view_tax' id='view_taxes' onclick="allianceManagementTaxSystemClick()">Tax-System</div>
											</div>
											<div class='tableselection evenline ' >
												<div class='table_alliance_management_section view_bank' id='view_bank' onclick="allianceManagementAllianceBankClick()">Alliance Bank</div>
											</div>
											<div class='tableselection oddline' >
												<div class='table_alliance_management_section view_stations' id='view_stations' onclick="allianceManagementStationsSettingsClick()">Stations</div>
											</div>
											<div class='tableselection evenline' >
												<div class='table_alliance_management_section view_military' id='view_military' onclick="allianceManagementMilitarySettingsClick()">Other Settings</div>
											</div>

											<!--
											<div class='tableselection evenline' >
												<div class='table_alliance_management_section' id='view_missions' onclick="allianceManagementMissionsClick()">Missions</div>
											</div>
											-->

										</div>
									</div>
									<div class='tableborderleft'></div>
									<div class='tableborderright'></div>
									<div class='tableborderbottom'></div>
									<div class='tablebordertop'></div>
									<div class='tablebordertopleft'></div>
									<div class='tablebordertopright'></div>
									<div class='tableborderbottomleft'></div>
									<div class='tableborderbottomright'></div>
								</div>
								<div class='scrollbuttons'>
									<div class='scrollbutton_up' id='alliance_manage_up' onclick="myScroll('alliance_manage',181,500,'scrollBG')"></div>
									<div class='scrollbutton_down' id='alliance_manage_down' onclick="myScroll('alliance_manage',-181,500,'scrollBG')"></div>
								</div>
							</div>
							<!--<input class='newmember_input' placeholder='Invite player...' id='alliance_invite_name_input'/>
							<div class='lightbutton160' id='alliance_invite_button' onclick="allianceInviteButtonClick()">
								<div class='buttontext24'>Invite</div>
							</div>-->
							<div class='lowpanel_uitip_holder'>
								<div class='lowpanel_uitip'>Click on a list-entry to view details</div>
							</div>
						</div>
						<div class='lowborder_right'></div>
						<div class='lowborder_bottomright'></div>
						<div class='lowborder_bottomleft'></div>
						<div class='lowborder_bottom'></div>
					</div>
				</div>

				<div class='main_panel alliancemanage' id='alliance_management_main_panel'>
					<div class='main_panel_bg' id='alliance_management_main_panel_bg'></div>
					<div class='main_panel_content' id='alliance_management_main_content'>
						<div class='main_header_image_holder_dynamic'>
							<img src='images/fixed/500dynaimage.jpg' id='alliance_management_planet_image' class='main_header_dynamic_image' />
						</div>
						<h3 class='main_header_title alliance_title'>
							Alliance Management
						</h3>
						<div class='main_helptext'>
							<span class='textchange'>Click panel to expand</span>
						</div>
						<div class='main_panel_extended_content' id='alliance_management_main_panel_extended_content'>
							This is where the alliance leader makes his managerieal setups, and also where the officers of the alliance can make selected changes.
						</div>
					</div>
					<div class='mainborder_topright'></div>
					<div class='mainborder_right'></div>
					<div class='centerslide_container'>
						<div class='centerscrew1'><img class='circular1' src='images/tiles/panelborders/circular.png' /></div>
						<div class='centerscrew2'><img class='circular2' src='images/tiles/panelborders/circular.png' /></div>
						<div class='centerscrew3'><img class='circular3' src='images/tiles/panelborders/circular.png' /></div>
					</div>
					<div class='mainborder_bottomright' style='background:url(images/tiles/panelborders/alliance_bottom_right.png);'></div>
					<div class='mainborder_bottomrightextended'></div>
					<div class='mainborder_bottom'></div>
					<div class='mainborder_bottomleft'></div>
					<div style='position: absolute; width: 100%; height: 100%; background:none;'></div>
				</div>
			</div>

	
		<div class='main_container halfsize half_3' id='alliancemembers_nopanel' style='display:none;'>
			<div class='nocontainer'>
				<table class='nocontainer_table'>
					<tr>
						<td>
							<span class='nocontainer_title'>Member Directory</span>
							<span class='nocontainer_subtitle'>Not Yet Available.</span>
						</td>
					</tr>
				</table>
			</div>
		</div>
	

			<div class='main_container halfsize half_3' id='alliance_members'  >
				<div class='infopanel' id='alliance_members_infopanel'>
					<div class='infopanel_content' id='memberdir_infopanel_content'>
						<div class='infopanel_header'>Player News</div>
					</div>
				</div>
				<div class='sidepanel' id='alliance_members_sidepanel'>
					<div class='sidepanel_bg' id='sidepanel_bg'>
						<div class='sidepanel_content'>
							<div class='selected_member_nametab'>
								<div class='selected_member_name' id='alliance_memberlist_selected_member_name'>No player selected</div>
								<div class='selected_member_rank' id='alliance_memberlist_selected_member_rank'>N/A</div>
							</div>
							<div class='selected_member_avatar'><img id='selected_member_avatar_image' class='selected_member_avatar_image'></div>
							<div class='selected_member_info_static_1'>
								Homeworld: <span id='selected_member_homeworld'></span><br>
								Outposts: <span id='selected_member_outposts'></span><br>
								Strength: <span id='selected_member_strength'></span><br>
								Alliance-ships: <span id='selected_member_alliance_ships'></span><br>
								On vacation: <span id='selected_member_alliance_vacation'></span>
							</div>
							<div class='selected_member_info_static_2'>
								Member since: <span id='selected_member_join_date'></span><br>
								Last online: <span id='selected_member_last_online'></span><br>
								Score: <span id='selected_member_score'></span><br>
								Level: <span id='selected_member_level'></span><br>
								In grace: <span id='selected_member_alliance_grace'></span>
							</div>
							<div class='selected_member_pub_info'>
								<div class='member_info_header'>Alliance Public Note:</div>
								<textarea class='member_pub_info_edit input_styling' id='selected_member_pubinfo_textarea' style='display:none;'></textarea>
								<div class='member_pub_info_noedit' id='selected_member_pubinfo_div' style='display:block'></div>
								<div class='lightbutton160 pub_info' id='member_converse' style='display:none'>
									<div class='buttontext24'>Converse</div>
								</div>
								<div class='lightbutton160 pub_info' id='member_info_submit' onclick='submitMemberInfoClick()' style='display:none'>
									<div class='buttontext24'>Submit</div>
								</div>
							</div>


							<div class='invite_shade_bottom member_list' style='bottom: 58px;'></div>
							<div class='responsibility_select_container'>
								<div class='rank_header'>Responsibility</div>
								<select class='response_select' id='alliance_member_responsibility_dropdown' >
									<option value='0'></option>
									<option value='1'>Recruitment Officer</option>
									<option value='2'>Missions Officer</option>
									<option value='3'>Fleet Officer</option>
									<option value='4'>Member Helper</option>
									<option value='5'>Tax Officer</option>
									<option value='6'>Projects Manager</option>
									<option value='7'>PR Officer</option>
								</select>
							</div>
							<div class='lightbutton160 promote' id='self_demote' onclick='resignLeadershipClick()' >
								<div class='buttontext24'>Step down</div>
							</div>
							<div class='responsibility_select_container' style='height:24px;bottom:0px;width:60%;right:24px;'>
								<select class='response_select' id='new_leader_dropdown' >
									<option value='0'>Select new leader</option>
								</select>
							</div>
							<div class='lightbutton160 promote' id='member_promote' onclick='alliancePromoteClick()' >
								<div class='buttontext24'>Promote</div>
							</div>
							<div class='lightbutton160 demote' id='member_demote' onclick='allianceDemoteClick()' >
								<div class='buttontext24'>Demote</div>
							</div>
							<div class='lightbutton160 kick' id='member_remove' onclick='allianceKickClick()' >
								<div class='buttontext24'>Kick</div>
							</div>
						</div>
						<div class='sideborder_topright'></div>
						<div class='sideborder_right'></div>
						<div class='sideborder_bottomright'></div>
						<div class='sideborder_bottom'></div>
						<div class='sideborder_bottomextended'></div>
					</div>

				</div>
				<div class='lowpanel' id='alliance_members_lowpanel'>
					<div class='lowpanel_bg' style='bottom: 6px;'>
						<div class='lowpanel_content' id='alliance_members_lowpanel_content'>
							<div class='lowpanel_header'>Member List</div>
							<div class='lowpanel_table member_dir'>
								<div class='lowpanel_table_borderwrapper scrollBG'>
									<div class='lowpanel_table_contentlist'>
										<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='member_dir'>

										</div>
									</div>
									<div class='lowpanel_table_headers'>
										<div class='table_alliance_member_name'>Name</div>
										<div class='table_alliance_member_strength'>Str</div>
										<div class='table_alliance_member_rank'>Rank</div>
                                    </div>
									<div class='tableborderleft'></div>
									<div class='tableborderright'></div>
									<div class='tableborderbottom'></div>
									<div class='tablebordertop'></div>
									<div class='tablebordertopleft'></div>
									<div class='tablebordertopright'></div>
									<div class='tableborderbottomleft'></div>
									<div class='tableborderbottomright'></div>
								</div>
								<div class='scrollbuttons'>
									<div class='scrollbutton_up' id='member_dir_up' onclick="myScroll('member_dir',212,300,'scrollBG')"></div>
									<div class='scrollbutton_down' id='member_dir_down' onclick="myScroll('member_dir',-212,300,'scrollBG')"></div>
								</div>
							</div>
							<div class='lowpanel_uitip_holder'>
								<div class='lowpanel_uitip'>Click on a member to view more information.</div>
							</div>
						</div>
						<div class='lowborder_right'></div>
						<div class='lowborder_bottomright'></div>
						<div class='lowborder_bottomleft'></div>
						<div class='lowborder_bottom'></div>
					</div>
				</div>
				<div class='main_panel member_directory' id='alliance_members_main_panel'>
					<div class='main_panel_bg' id='member_dir_main_panel_bg'></div>
					<div class='main_panel_content' id='member_dir_main_content'>
						<div class='main_header_image_holder_dynamic'>
							<img src='images/fixed/500dynaimage2.jpg' id='planet2' class='main_header_dynamic_image' />
						</div>
						<h3 class='main_header_title alliance_title'>Member Directory</h3>
						<div class='main_helptext'>
							<span class='textchange'>Click panel to expand</span>
						</div>
						<div class='main_panel_extended_content' id='member_dir_main_panel_extended_content'>
							List of all members in the alliance, as well as available detailed information about each member.
						</div>
					</div>
					<div class='mainborder_topright'></div>
					<div class='mainborder_right'></div>
					<div class='centerslide_container'>
						<div class='centerscrew1'><img class='circular1' src='images/tiles/panelborders/circular.png' /></div>
						<div class='centerscrew2'><img class='circular2' src='images/tiles/panelborders/circular.png' /></div>
						<div class='centerscrew3'><img class='circular3' src='images/tiles/panelborders/circular.png' /></div>
					</div>
					<div class='mainborder_bottomright' style='background:url(images/tiles/panelborders/alliance_bottom_right.png);'></div>
					<div class='mainborder_bottomrightextended'></div>
					<div class='mainborder_bottom'></div>
					<div class='mainborder_bottomleft'></div>
					<div style='position: absolute; width: 100%; height: 100%; background:none;'></div>
				</div>
			</div>


	
		<div class='main_container halfsize half_5' id='marketplace_nopanel' style='display:none;' >
			<div class='nocontainer'>
				<table class='nocontainer_table'>
					<tr>
						<td>
							<span class='nocontainer_title'>Alliance Marketplace</span>
							<span class='nocontainer_subtitle'>Not Yet Available.</span>
						</td>
					</tr>
				</table>
			</div>
		</div>

	
		<div class='main_container halfsize half_5' id='marketplace' >
			<div class='infopanel' id='marketplace_infopanel'>
				<div class='infopanel_content' id='marketplace_infopanel_content'>
					<!-- All content here must be dynamic, even the header to support dual-view of selected trade or own trades-->

					<div class='infopanel_header'>Trade-details</div>
					No trade selected in the Trade Listing.
					<!-- Thus ends the infopanel content... -->
				</div>
			</div>
			<div class='sidepanel' id='marketplace_sidepanel'>
				<div class='sidepanel_bg' id='marketplace_sidepanel_bg'>

					<div class='sidepanel_content' style='width: 305px; height: 215px; text-align:center;'>
						<div class='alliance_dev_side_header' style='margin-bottom:4px;'>Create Trade</div>
						<div class='trade_filter_container issue' id='trade_issue_container'>
							<div class='trade_select_header'>Offer</div>
							<input class='input_styling trade' id='new_trade_amount_textfield' maxlength='9' onkeyup='renderSelectedTradeResult()' value='1000'/>
							<div class='trade_element_container'>
								<img id='new_trade_hs_from' onclick='registerClickNewTradeFrom(1)' class='outpost_dp_res_img trade' src='images/icons/elements/hs42.png'>
								<img id='new_trade_in_from' onclick='registerClickNewTradeFrom(4)' class='outpost_dp_res_img trade' src='images/icons/elements/in42.png'>
								<img id='new_trade_sr_from' onclick='registerClickNewTradeFrom(3)' class='outpost_dp_res_img trade' src='images/icons/elements/sr42.png'>
								<img id='new_trade_nd_from' onclick='registerClickNewTradeFrom(2)' class='outpost_dp_res_img trade' src='images/icons/elements/nd42.png'>
							</div>
							<div class='trade_select_header'>In exchange for</div>
							<div class='trade_output' id='trade_result_text_field'></div>
							<div class='trade_element_container'>
								<img id='new_trade_hs_to' onclick='registerClickNewTradeTo(1)' class='outpost_dp_res_img trade' src='images/icons/elements/hs42.png'>
								<img id='new_trade_in_to' onclick='registerClickNewTradeTo(4)' class='outpost_dp_res_img trade' src='images/icons/elements/in42.png'>
								<img id='new_trade_sr_to' onclick='registerClickNewTradeTo(3)' class='outpost_dp_res_img trade' src='images/icons/elements/sr42.png'>
								<img id='new_trade_nd_to' onclick='registerClickNewTradeTo(2)' class='outpost_dp_res_img trade' src='images/icons/elements/nd42.png'>
							</div>

							<div class='lightbutton160 issue_trade' onclick='registerNewTradeClick()'>
								<div class='buttontext24'>Issue</div>
							</div>
						</div>
					</div>
					<div class='sideborder_topright'></div>
					<div class='sideborder_right'></div>
					<div class='sideborder_bottomright'></div>
					<div class='sideborder_bottom'></div>
					<div class='sideborder_bottomextended'></div>

				</div>

			</div>
			<div class='lowpanel' id='marketplace_lowpanel'>
				<div class='lowpanel_bg' style='bottom: 6px;'>
					<div class='lowpanel_content' id='marketplace_lowpanel_content'>
						<div class='lowpanel_header'>Trade listing</div>
						<div class='trade_filter_container' id='trade_listing'>
							<div class='member_info_header filter_top' style='width: 100%; text-align: center;'>Filter</div>
							<div class='lightbutton160' onclick='tradeFilterAllClick()'>
								<div class='buttontext24'>All</div>
							</div>
							<div class='member_info_header trade_filter_header' style='width: 50%; text-align: center; display: inline-block;'>Offering</div><div class='member_info_header trade_filter_header' style='width: 50%; text-align: center;display: inline-block;'>For</div>

							<div class='elementbutton' id='element1'>
								<img id='filter_hs_from' onclick='registerTradeFilterFromClick(1)' class='outpost_dp_res_img' src='images/icons/elements/hs42.png'>
							</div>
							<div class='elementbutton' id='element2'>
								<img id='filter_hs_to' onclick='registerTradeFilterToClick(1)' class='outpost_dp_res_img' src='images/icons/elements/hs42.png'>
							</div>
							<div class='elementbutton' id='element7'>
								<img id='filter_in_from' onclick='registerTradeFilterFromClick(4)' class='outpost_dp_res_img' src='images/icons/elements/in42.png'>
							</div>
							<div class='elementbutton' id='element8'>
								<img id='filter_in_to' onclick='registerTradeFilterToClick(4)' class='outpost_dp_res_img' src='images/icons/elements/in42.png'>
							</div>
							<div class='elementbutton' id='element5'>
								<img id='filter_sr_from' onclick='registerTradeFilterFromClick(3)' class='outpost_dp_res_img' src='images/icons/elements/sr42.png'>
							</div>
							<div class='elementbutton' id='element6'>
								<img id='filter_sr_to' onclick='registerTradeFilterToClick(3)' class='outpost_dp_res_img' src='images/icons/elements/sr42.png'>
							</div>
							<div class='elementbutton' id='element3'>
								<img id='filter_nd_from' onclick='registerTradeFilterFromClick(2)' class='outpost_dp_res_img' src='images/icons/elements/nd42.png'>
							</div>
							<div class='elementbutton' id='element4'>
								<img id='filter_nd_to' onclick='registerTradeFilterToClick(2)' class='outpost_dp_res_img' src='images/icons/elements/nd42.png'>
							</div>

						</div>
						<div class='lowpanel_table market_table'>
							<div class='lowpanel_table_borderwrapper scrollBG'>
								<div class='lowpanel_table_contentlist footer'>
									<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='market_scroller'>
										<div class='tableselection evenline' onclick="$('#selected_trade').show();$('#your_trades').hide();minimizeSelectedRow(tableid,rowheight);">
											<div class='tradeelementheader'>Neodymium</div>
											<div class='tradeelementheader'>Strontium</div>
											<div class='tradeelementheader'>Biggleworth</div>
											<div class='tradevolume'>9.999.999</div>
										</div>
									</div>
								</div>
								<div class='lowpanel_table_headers'>
									<div class='tradeelementheader'>Offering</div>
									<div class='tradeelementheader'>For</div>
									<div class='tradeelementheader'>Member</div>
									<div class='tradevolume'>Units</div>
								</div>
								<div class='lowpanel_table_footers' style='cursor:pointer;'>
									<div class='lowpanel_table_footer_bg'></div>
									<div class='lowpanel_table_footer_title' onclick="showOwnTrades()">View Own Trades</div>
								</div>
								<div class='tableborderleft'></div>
								<div class='tableborderright'></div>
								<div class='tableborderbottom'></div>
								<div class='tablebordertop'></div>
								<div class='tablebordertopleft'></div>
								<div class='tablebordertopright'></div>
								<div class='tableborderbottomleft'></div>
								<div class='tableborderbottomright'></div>
							</div>
							<div class='scrollbuttons'>
								<div class='scrollbutton_up' id='market_scroller_up' onclick="myScroll('market_scroller',180,500,'scrollBG')"></div>
								<div class='scrollbutton_down' id='market_scroller_down' onclick="myScroll('market_scroller',-180,500,'scrollBG')"></div>
							</div>
						</div>
						<div class='lowpanel_uitip_holder'>
							<div class='lowpanel_uitip'>Click an entry to view details.</div>
						</div>

					</div>
					<div class='lowborder_right'></div>
					<div class='lowborder_bottomright'></div>
					<div class='lowborder_bottomleft'></div>
					<div class='lowborder_bottom'></div>

				</div>
			</div>

			<div class='main_panel marketplace darkpanel' id='marketplace_main_panel'>
				<div class='main_panel_bg' id='marketplace_main_panel_bg'></div>
				<div class='main_panel_content' id='marketplace_main_content'>
					<div class='main_header_image_holder_dynamic'>
						<img src='images/fixed/marketplace.png' class='main_header_dynamic_image' />
					</div>

					<h3 class='main_header_title alliance_title'>Marketplace</h3>

					<div class='main_helptext'><span class='textchange'>Click panel to expand</span> </div>

					<div class='main_panel_darkpanel' id='marketplace_darkpanel'>
						<div>
							<img class='outpost_dp_res_img' src='images/icons/elements/hs42.png' id='exchange_rate_hs_from' onclick="registerClickExchangeRateFrom(1)" />
							<img class='outpost_dp_res_img' src='images/icons/elements/in42.png' id='exchange_rate_in_from' onclick="registerClickExchangeRateFrom(4)" />
							<img class='outpost_dp_res_img' src='images/icons/elements/sr42.png' id='exchange_rate_sr_from' onclick="registerClickExchangeRateFrom(3)" />
							<img class='outpost_dp_res_img' src='images/icons/elements/nd42.png' id='exchange_rate_nd_from' onclick="registerClickExchangeRateFrom(2)" />
						</div>
						<div>Convert To...</div>
						<div>
							<img class='outpost_dp_res_img' src='images/icons/elements/hs42.png' id='exchange_rate_hs_to' onclick="registerClickExchangeRateTo(1)" />
							<img class='outpost_dp_res_img' src='images/icons/elements/in42.png' id='exchange_rate_in_to' onclick="registerClickExchangeRateTo(4)" />
							<img class='outpost_dp_res_img' src='images/icons/elements/sr42.png' id='exchange_rate_sr_to' onclick="registerClickExchangeRateTo(3)" />
							<img class='outpost_dp_res_img' src='images/icons/elements/nd42.png' id='exchange_rate_nd_to' onclick="registerClickExchangeRateTo(2)" />

						</div>
						<div class='outpost_dp_tab'>Exchange-rates</div>

						<div class='conversion_container'>
							<span class='conversion_rate' id='current_exchange_rate'></span>
							<span>Click on resources to see rates.</span>
						</div>
					</div>

					<div class='main_panel_extended_content' id='marketplace_main_panel_extended_content'>
						This is where you trade resources with other players in your alliance. You can select a trade from the list below, or you can create a new trade-offer on the right hand side.
					</div>
				</div>
				<div class='mainborder_topright'></div>
				<div class='mainborder_right'></div>

				<div class='centerslide_container'>
					<div class='centerscrew1'><img class='circular1' src='images/tiles/panelborders/circular.png' /></div>
					<div class='centerscrew2'><img class='circular2' src='images/tiles/panelborders/circular.png' /></div>
					<div class='centerscrew3'><img class='circular3' src='images/tiles/panelborders/circular.png' /></div>
				</div>
				<div class='mainborder_bottomright' style='background:url(images/tiles/panelborders/alliance_bottom_right.png);'></div>
				<div class='mainborder_bottomrightextended'></div>
				<div class='mainborder_bottom'></div>
				<div class='mainborder_bottomleft'></div>
			</div>
		</div>

	
		<div class='main_container halfsize half_6' id='alliancedev_nopanel' style='display:none;'>
			<div class='nocontainer'>
				<table class='nocontainer_table'>
					<tr>
						<td>
							<span class='nocontainer_title'>Alliance Development</span>
							<span class='nocontainer_subtitle'>Not Yet Available.</span>
						</td>
					</tr>
				</table>
			</div>
		</div>
	
		<div class='main_container halfsize half_6' id='alliancedev' >

			<div class='infopanel' id='alliancedev_infopanel'>
				<div class='infopanel_content' id='alliancedev_infopanel_content'>
					<div class='infopanel_header'>Current Alliance Project</div>
					<div class='row_container current_ally_dev' id='current_ally_dev_upgrade' style='display:none'>
						<div id='ally_dev' class='row_entry current_ally_dev'>
							<div class='queue_entry_content_container'>
								<div class='queue_entry_name ally_dev' id='current_alliance_development_name'>No project selected</div>
								<div class='dev_closed_time'>
									<div class='dev_progress_bar' id='current_alliance_development_progress_bar'></div>
									<div class='dev_progress_timer' id='current_alliance_development_time_string'>N/A</div>
								</div>
								<div class='dev_opened_time' id='current_alliance_development_time_string_2'>N/A<br />N/A<br />N/A</div>
								<div class='queue_entry_info' style='margin-bottom: 5px;' id='current_alliance_development_info'>N/A</div>
								<div class='queue_entry_img'><img src='images/fixed/outpostportrait200x200.jpg' id='current_alliance_development_image' /></div>
							</div>
						</div>
					</div>

					<div class='infopanel_header'>Active Bonuses and Upgrades</div>
					<div class='ally_dev_scrollwrapper'>
						<div class='ally_dev_inner_scrollcontainer lowpanel_scroll_content' id='alliancedev_scroller_inner'>
							<!-- Per item
							<div class='row_container ally_dev'>
								<div class='row_entry dev_bonus_entry' id='dev-bonus1'>
									<div class='queue_entry_content_container'>
										<div class='queue_entry_name header'>Military Cooperation Level 2</div>
										<div class='queue_entry_info'>Blah blah blah blah</div>
										<div class='queue_entry_img'>
											<img src='images/fixed/outpostportrait200x200.jpg' />
										</div>
									</div>
								</div>
							</div>
							-->
						</div> <!-- End Inner Scrollcontainer -->
						<div class='scrollbuttons'>
							<div class='scrollbutton_up' id='alliancedev_scroller_inner_up' onclick="myScroll('alliancedev_scroller_inner',210,1500,'scrollBG')"></div>
							<div class='scrollbutton_down' id='alliancedev_scroller_inner_down' onclick="myScroll('alliancedev_scroller_inner',-210,1500,'scrollBG')"></div>
						</div>
					</div> <!-- End Scrollwrapper -->

				</div>
			</div>

			<div class='sidepanel' id='alliancedev_sidepanel'>
				<div class='sidepanel_bg' id='alliancedev_sidepanel_bg'>
					<div class='sidepanel_content' id='alliancedev_sidepanel_content'>

						<div class='alliance_dev_side_header' id='alliance_dev_selected_project_name'>No project selected</div>
						<div class='ally_dev_img image_shader'>
							<img id='ally_dev_img' src='images/fixed/outpost3.jpg' />
						</div>
						<div class='alliance_dev_complete_time'>
							<div class='shade_down ally_dev'></div>
							<div class='shade_up ally_dev'></div>
							<span class='header'>Time to complete:</span>
							<span class='time' id='alliance_dev_selected_project_complete_time'>N/A</span>
						</div>

						<div class='costfield prod_cost' id='alliance_dev_selected_project_prodcost' >
							<div class='costbutton' id='alliance_dev_selected_project_prodcost_button'>
								<div class='initiatebutton' ></div>
								<div class='initiatebuttonhover' ></div>
								<div class='buttontext costtext'>N/A</div>
							</div>
							<div class='disablebutton'>
								<div class='buttontext costtext'>N/A</div>
							</div>
							<div class='hscost' id='alliance_dev_selected_project_cost_h'>0</div>
							<div class='ndcost' id='alliance_dev_selected_project_cost_n'>0</div>
							<div class='srcost' id='alliance_dev_selected_project_cost_s'>0</div>
							<div class='incost' id='alliance_dev_selected_project_cost_i'>0</div>
						</div>

						<div class='ally_dev_description' id='alliance_dev_selected_project_description'></div>
					</div>
					<div class='sideborder_topright'></div>
					<div class='sideborder_right'></div>
					<div class='sideborder_bottomright'></div>
					<div class='sideborder_bottom'></div>
					<div class='sideborder_bottomextended'></div>
				</div>

			</div>

			<div class='lowpanel' id='alliancedev_lowpanel'>
				<div class='lowpanel_bg' style='bottom: 6px;'>
					<div class='lowpanel_content' id='alliancedev_lowpanel_content'>
						<div class='lowpanel_header'>Alliance Projects</div>
						<div class='lowpanel_table alliance_dev_selection'>
							<div class='devscroller lowpanel_scroll_content' id='alliancedevscroller'>

								<div class='alliance_dev_item' id='alliance_dev_item_1' onclick='selectAllianceDevItem(1)'>
									<img class='alliance_dev_item_img' id='all_dev_img_1' src='images/icons/wide_alliancepro/601.jpg' />
									<div class='alliance_dev_item_level' id='all_dev_level_1'>0</div>
									<div class='alliance_dev_item_label' id='all_dev_label_1'></div>
								</div>
								<div class='alliance_dev_item' id='alliance_dev_item_2' onclick='selectAllianceDevItem(2)'>
									<img class='alliance_dev_item_img' id='all_dev_img_2' src='images/icons/wide_alliancepro/605.jpg' />
									<div class='alliance_dev_item_level' id='all_dev_level_2'>0</div>
									<div class='alliance_dev_item_label' id='all_dev_label_2'></div>
								</div>
								<div class='alliance_dev_item' id='alliance_dev_item_3' onclick='selectAllianceDevItem(3)'>
									<img class='alliance_dev_item_img' id='all_dev_img_3' src='images/icons/wide_alliancepro/609.jpg' />
									<div class='alliance_dev_item_level' id='all_dev_level_3'>0</div>
									<div class='alliance_dev_item_label' id='all_dev_label_3'></div>
								</div>
								<div class='alliance_dev_item' id='alliance_dev_item_4' onclick='selectAllianceDevItem(4)'>
									<img class='alliance_dev_item_img' id='all_dev_img_4' src='images/icons/wide_alliancepro/613.jpg' />
									<div class='alliance_dev_item_level' id='all_dev_level_4'>0</div>
									<div class='alliance_dev_item_label' id='all_dev_label_4'></div>
								</div>
								<div class='alliance_dev_item' id='alliance_dev_item_5' onclick='selectAllianceDevItem(5)'>
									<img class='alliance_dev_item_img' id='all_dev_img_5' src='images/icons/wide_alliancepro/617.jpg' />
									<div class='alliance_dev_item_level' id='all_dev_level_5'>0</div>
									<div class='alliance_dev_item_label' id='all_dev_label_5'></div>
								</div>
								<div class='alliance_dev_item' id='alliance_dev_item_6' onclick='selectAllianceDevItem(6)'>
									<img class='alliance_dev_item_img' id='all_dev_img_6' src='images/icons/wide_alliancepro/621.jpg' />
									<div class='alliance_dev_item_level' id='all_dev_level_6'>0</div>
									<div class='alliance_dev_item_label' id='all_dev_label_6'></div>
								</div>

							</div>
							<div class='shade_up dev_select'></div>
							<div class='shade_down dev_select'></div>
						</div>
					</div>
					<div class='lowborder_right'></div>
					<div class='lowborder_bottomright'></div>
					<div class='lowborder_bottomleft'></div>
					<div class='lowborder_bottom'></div>
				</div>
			</div>

			<div class='main_panel alliancedevelopment' id='alliancedev_main_panel'>
				<div class='main_panel_bg' id='alliancedev_main_panel_bg'></div>
				<div class='main_panel_content' id='alliancedev_main_content'>
					<div class='main_header_image_holder_dynamic'>
						<img src='images/fixed/allaincedev2.jpg' id='alliancedev_planet2' class='main_header_dynamic_image' />
					</div>

					<h3 class='main_header_title alliance_title'>Alliance Development</h3>
					<div class='main_helptext'><span class='textchange'>Click panel to expand</span></div>
					<div class='main_panel_extended_content' id='alliancedev_main_panel_extended_content'>
						Information about alliance upgrades that the leader can initiate. Members can view what is currently under development and get an overview of finished projects as well as available options.<br><br>
						<b>Remember that the alliance leader must be Level 7 or higher to initiate these projects.</b>

					</div>
				</div>
				<div class='mainborder_topright'></div>
				<div class='mainborder_right'></div>

				<div class='centerslide_container'>
					<div class='centerscrew1'><img class='circular1' src='images/tiles/panelborders/circular.png' /></div>
					<div class='centerscrew2'><img class='circular2' src='images/tiles/panelborders/circular.png' /></div>
					<div class='centerscrew3'><img class='circular3' src='images/tiles/panelborders/circular.png' /></div>
				</div>
				<div class='mainborder_bottomright' style='background:url(images/tiles/panelborders/alliance_bottom_right.png);'></div>
				<div class='mainborder_bottomrightextended'></div>
				<div class='mainborder_bottom'></div>
				<div class='mainborder_bottomleft'></div>
				<div style='position: absolute; width: 100%; height: 100%; background:none;'></div>
			</div>
		</div>


	
		</div>
		<!-- Ends the alliance-content-->
	<div class='section_container' id='military_content'>
	<div style='position: absolute; left: 630px; top: 10px; background: url(images/fixed/350glass.png) no-repeat; height: 372px; width: 350px;'>
		<div style='position: absolute;top: 171px;background: url(images/fixed/military_main.png);height: 300px;width: 400px;left: -30px;'></div>
		<div class='military_overview_main_header'>Military Overview</div>
		<div title='Reload Military Data' class='refresh_alliance_fleets_button' onclick='reloadAllMilitaryData(1)' style='top: 5px; left: 315px;'></div>

		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Fleets</div>
			<div class='military_overview_entry' id='mo_fleets'></div>
		</div>
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Capital ships</div>
			<div class='military_overview_entry' id='mo_capital_ships'></div>
		</div>
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Minor ships</div>
			<div class='military_overview_entry' id='mo_minor_ships'></div>
		</div>

		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Strength</div>
			<div class='military_overview_entry' id='mo_firepower'></div>
		</div>

		<div class='military_overview_separator'></div>

		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Alliance Fleets</div>
			<div class='military_overview_entry' id='mo_a_fleets'></div>
		</div>
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Active Alliance Fleets</div>
			<div class='military_overview_entry' id='mo_active_a_fleets'></div>
		</div>

		<div class='military_overview_separator'></div>

		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Commanders</div>
			<div class='military_overview_entry' id='mo_commanders'></div>
		</div>
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Top Rank</div>
			<div class='military_overview_entry' id='mo_top_rank'></div>
		</div>
		<!--
		<div class='military_overview_separator'></div>
		-->
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Spies / Infiltrators</div>
			<div class='military_overview_entry' id='mo_spies_infiltrators'></div>
		</div>
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Active Intelligence</div>
			<div class='military_overview_entry' id='mo_active_intelligence'></div>
		</div>
		<!--
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Active Missions</div>
			<div class='military_overview_entry' id='mo_active_missions'></div>
		</div>
		-->


		<!--
		<div class='military_overview_separator'></div>

		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Upkeep Hassium</div>
			<div class='military_overview_entry' id='mo_upkeep_hassium'></div>
		</div>
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Upkeep Indium</div>
			<div class='military_overview_entry' id='mo_upkeep_indium'></div>
		</div>
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Upkeep Strontium</div>
			<div class='military_overview_entry' id='mo_upkeep_strontium'></div>
		</div>
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Upkeep Neodymium</div>
			<div class='military_overview_entry' id='mo_upkeep_neodymium'></div>
		</div>
		<div class='military_overview_entry_container'>
			<div class='military_overview_title'>Current upkeep bonus</div>
			<div class='military_overview_entry' id='current_upkeep_bonus'></div>
		</div>
		-->

		<div class='military_overview_entry_container transport'>
			<div class='general_button_blue' id='view_nemesis' style='width: 148px; height: 22px; background-size: contain;' onclick='viewNemesisClick()'>My Nemesis</div>
			<div class='general_button_blue' id='view_all_ships' style='left:170px;width: 148px; height: 22px; background-size: contain;' onclick='viewAllShipsClick({skipOutposts:true})'>All ships</div>
		</div>



	</div>



	
		<div class='main_container thirdsize third_1' id='fleet_management' >
			<div class='infopanel' id='fleet_management_infopanel'>
				<div class='infopanel_content' id='fleet_management_infopanel_content'>
					<div id='fleetdetails'>
						<div class='infopanel_header'>Fleet Composition</div>
						<div id='fleet_composition_container'>
							<!-- Here goeth the shiptypes! -->



						</div>
						<div class='fleet_infopanel_help' id='fleet_infopanel_help'>No fleet selected.</div>
					</div>
				</div>
			</div>

			<div class='sidepanel' id='fleet_management_sidepanel'>
				<div class='sidepanel_bg' id='fleet_management_sidepanel_bg'>
					<div class='sidepanel_content' style='width: 450px; height: 165px; '>
						<div class='selected_fleet_info'>
							<div class='heading'>Strength:</div>
							<div class='entry' id='fleet_management_sidepanel_selected_fleet_shipcount'>-</div>
							<div class='heading'>Firepower:</div>
							<div class='entry' id='fleet_management_sidepanel_selected_fleet_strength'>-</div>
							<div class='heading'>Tech Tilt:</div>
							<div class='entry' id='fleet_management_sidepanel_selected_fleet_techtilt'>-</div>
							<div class='heading'>Battles/Wins/Losses</div>
							<div class='entry'><span id='fleet_management_sidepanel_selected_fleet_battles'>0</span>/<span id='fleet_management_sidepanel_selected_fleet_wins'>0</span>/<span id='fleet_management_sidepanel_selected_fleet_losses'>0</span></div>
							<div class='heading'>Minor Ships:</div>
							<div class='entry' id='fleet_management_sidepanel_selected_fleet_shortage'>-</div>
							<div class='heading'>Recharge:</div>
							<div class='entry' id='fleet_management_sidepanel_selected_fleet_recharge' >-</div>
							<div class='heading'>Upkeep:</div>
							<div class='entry' id='fleet_management_sidepanel_selected_fleet_upkeep' >-</div>

						</div>

						<div class='selected_fleet_actions'>
							<div class='lightbutton160' id='selected_fleet_shipreassign_button' onclick='selected_fleet_shipreassign_button_click()'>
								<div class='buttontext24'>Move ships</div>
							</div>
						</div>
						<div class='selected_fleet_actions'>
							<div class='lightbutton160' id='selected_fleet_resupply_button' onclick='selected_fleet_resupply_button_click()'>
								<div class='buttontext24'>Minor ships</div>
							</div>
						</div>
						<div class='selected_fleet_actions'>
							<div class='lightbutton160' id='selected_fleet_tactics_button' onclick='selected_fleet_tactics_button_click()'>
								<div class='buttontext24'>Tactics</div>
							</div>
						</div>
						<div class='selected_fleet_actions' id='disband_button_container'>
							<div class='lightbutton160' id='selected_fleet_ship_disband_button' onclick='selected_fleet_disband_button_click()'>
								<div class='buttontext24' id='selected_fleet_ship_disband_button_text'>Disband</div>
							</div>
						</div>
						<!--
						<div class='selected_fleet_actions' id='load_cargo_button_container' style='display:none;'>
							<div class='lightbutton160' id='selected_fleet_load_cargo_button' onclick='selected_fleet_load_cargo_button_click()'>
								<div class='buttontext24'>Load Cargo</div>
							</div>
						</div>
						-->

						<div class='selected_fleet_actions' id='toggle_alliance_fleet_status_container' style='width:300px;'>
							<select disabled id='toggle_alliance_fleet_status' onchange='toggleAllianceFleet()' style='width:200px;border-top-left-radius: 5px;border-bottom-left-radius: 5px; font-size:12px;'>
								<option value=0>No alliance-use permitted</option>
								<option value=1>Alliance-use permitted</option>
							</select>
						</div>
						<!--<div class='selected_fleet_actions' id='toggle_defense_fleet_status_container' style='width:300px;'>
							<select disabled id='toggle_defense_fleet_status' onchange='toggleDefenseFleet()' style='width:200px;border-top-left-radius: 5px;border-bottom-left-radius: 5px; font-size:12px;'>
								<option value=0>Do not assist with outpost-defense</option>
								<option value=1>Assist with outpost-defense</option>
							</select>
						</div>-->

						<div class='selected_fleet_img'>
							<img id='fm_selected_commander_bg' src='images/commanders/nobg.jpg' width='100' style='position:absolute;'>
							<img id='fm_selected_commander_uniform' src='images/commanders/nouniform.png' width='100' style='position:absolute;'>
							<img id='fm_selected_commander_head' src='images/commanders/nohead.png' width='100' style='position:absolute;'>
						</div>
						<div class='selected_fleet_nametab'>
							<div class='selected_item_name fleet_name' contenteditable='true' id='fleet_management_sidepanel_selected_fleet_name' style='-webkit-touch-callout: default; -webkit-user-select: text; -khtml-user-select: text; -moz-user-select: text; -ms-user-select: text; ' spellcheck='false'>No fleet selected.</div>
						</div>
						<div class='selected_fleet_cmd_namerank'><span id='selected_fleet_commander_rank_and_name'>-</span><br><span id='selected_fleet_commander_rank' style='font-style:italic'>-</span>
						</div>
									<!--Fleet information combined stats, technology skew, Commander. Functions for swapping, removing commander from fleet.  Links directly to commander view. Commander view in turn links directly to commander's fleet. Also includes efficiency rating. This is a simple 1:x value based on kills/losses. Will be important for seeing which fleets are the most efficient in their fights.-->
						<div class='sidepanel_uitip fleet_side_help'>Choose a view or click commander to set options.</div>
					</div>
					<div class='sideborder_topright'></div>
					<div class='sideborder_right'></div>
					<div class='sideborder_bottomright'></div>
					<div class='sideborder_bottom'></div>
					<div class='sideborder_bottomextended'></div>

				</div>

			</div>

			<div class='lowpanel' id='fleet_management_lowpanel'>
				<div class='lowpanel_bg' style='height: 0px; '>
					<div class='lowpanel_content' id='fleet_management_lowpanel_content' style='height: 280px; width: 450px; opacity: 0; '>
						<div class='lowpanel_header'>Your Fleets</div>
						<div class='lowpanel_table fleet' style='width: 455px; '>
							<div class='lowpanel_table_borderwrapper scrollBG' style='width: 425px; background-position: 0px 0px; '>
								<div class='lowpanel_table_contentlist footer'>
									<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='allYourFleets' style='top: 0px; '>


									</div>
								</div>
								<div class='lowpanel_table_headers'>
									<div class='table_fleet_name' onclick='fleetNameSortclick()'>Fleet Name</div>
									<div class='table_fleet_type'></div>
									<div class='table_fleet_loc'>Location</div>
									<div class='table_fleet_size'>Cap</div>
									<div class='table_fleet_size'>Min</div>
									<div class='table_fleet_size'>Tra</div>
									<div class='table_fleet_strength' onclick='fleetFirepowerSortclick()'>Str</div>
								</div>
								<div class='lowpanel_table_footers' id='reserve_fleet_button'>
									<div class='lowpanel_table_footer_bg'></div>
									<div class='lowpanel_table_footer_title'>&gt;&gt; View non-combatant units &lt;&lt;</div>
								</div>
								<div class='tableborderleft'></div>
								<div class='tableborderright'></div>
								<div class='tableborderbottom'></div>
								<div class='tablebordertop'></div>
								<div class='tablebordertopleft'></div>
								<div class='tablebordertopright'></div>
								<div class='tableborderbottomleft'></div>
								<div class='tableborderbottomright'></div>
							</div>
							<div class='scrollbuttons' style='top: 36px; '>
								<div class='scrollbutton_up' id='allYourFleets_up' onclick="myScroll('allYourFleets',181,500,'scrollBG')"></div>
								<div class='scrollbutton_down' id='allYourFleets_down' onclick="myScroll('allYourFleets',-181,500,'scrollBG')"></div>
							</div>
						</div>
						<div class='fixed_button fixed_button_320' id='go_transport' onclick='createFleetClick()' style='margin-left: 60px;'>
							<div class='fixed_button_regular regular_320' style='opacity: 1; '></div>
							<div class='fixed_button_hover green_320' style='opacity: 0; '></div>
							<div class='fixed_button_click green_320'></div>
							<div class='dyna_button_text type2'>Create New Fleet</div>
						</div>
						<div class='lowpanel_uitip_holder'>
							<div class='lowpanel_uitip'>Click on a fleet name to view details.</div>
						</div>
					</div>
					<div class='lowborder_right'></div>
					<div class='lowborder_bottomright'></div>
					<div class='lowborder_bottomleft'></div>
					<div class='lowborder_bottom'></div>

				</div>
			</div>

			<div class='main_panel fleetmanagement darkpanel' id='fleet_management_main_panel' style='width: 300px; height: 180px; '>
				<div class='main_panel_bg' id='main_panel_bg' style='background-position: 0px 0px; '></div>
				<div class='main_panel_content' id='fleet_management_main_content' style='width: 255px; '>
					<div class='main_header_image_holder_dynamic'>
						<img src='images/fixed/500dynafleet.jpg' id='fleet_management_main_image' class='main_header_dynamic_image'/>
					</div>
					<h3 class='main_header_title military_title'>Fleet Management</h3>
					<div class='main_helptext'>
						<span class='textchange'>CLICK PANEL TO EXPAND</span>
					</div>

					<div class='main_panel_darkpanel' style='height: 230px; width: 200px; right: -245px; opacity: 0; display: none; '>
						<div class='fleet_dp_tab'>Fleets Overview</div>
						<div class='fleet_dp_title'>Fleets:</div>
						<div class='fleet_dp_entry' id='my_fleet_count'> </div>
						<div class='fleet_dp_title'>Capital Ships</div>
						<div class='fleet_dp_entry' id='my_ship_count'> </div>
						<div class='fleet_dp_title'>Main Strength:</div>
						<div class='fleet_dp_entry' id='my_fleet_strength'> </div>
						<div class='fleet_dp_title'>OP Defensive Strength:</div>
						<div class='fleet_dp_entry' id='my_fleet_op_strength'> </div>

						<div class='fleet_dp_title'>Battles won:</div>
						<div class='fleet_dp_entry' id='my_fleet_wins'> </div>
						<div class='fleet_dp_title'>Battles lost:</div>
						<div class='fleet_dp_entry' id='my_fleet_losses'> </div>
						<div class='fleet_dp_title'>Upkeep:</div>
						<div class='fleet_dp_entry' id='my_fleet_total_upkeep'> </div>

						<div class='fleet_dp_needs'>
							<div class='fleet_dp_title'>Resupply:</div>
							<div class='fleet_dp_entry' id='my_fleets_with_shortage'> </div>
							<div class='fleet_dp_title'>Slots:</div>
							<div class='fleet_dp_entry' id='my_global_shortage'> </div>
						</div>
					</div>

					<div class='main_panel_extended_content' style='opacity: 0; '>
						This is where you create, modify and disband your fleets. you can also move ships between fleets and resupply fleets with fighters.
					</div>
				</div>
				<div class='mainborder_topright'></div>
				<div class='mainborder_right'></div>
				<div class='centerslide_container'>
					<div class='inner_corner_slider' style='position: absolute;width: 20px;height: 26px;top: -32px;background: url(images/tiles/cornerslider02.png) no-repeat bottom ;right: 24px;'></div>
					<div class='outer_corner_slider' style='position: absolute;width: 20px;height: 32px;top: -40px;background: url(images/tiles/cornerslider01a.png) no-repeat bottom;right: 9px;'></div>
				</div>
				<div class='mainborder_bottomright_ex_military'></div>
				<div class='mainborder_bottomright_military_open'></div>
				<div class='mainborder_bottom'></div>
				<div class='mainborder_bottomleft'></div>
				<div style='position: absolute; width: 100%; height: 100%; background:none;'></div>
			</div>
		</div>


	
			<!-- Fleet Tracking Content Box -->
			<div class='main_container thirdsize third_2' id='fleet_tracking'>
					<div class='infopanel' id='fleet_movement_infopanel'>
						<div class='infopanel_content' id='fleet_movement_infopanel_content'>
							<div class='infopanel_header'>Fleet Log</div>
							<div class='selection_container fleetlog_container'>
								<div class='fleetlog_list' id='fleetlog'>

								</div>
							</div>

						</div>
					</div>
					<div class='sidepanel' id='fleet_tracking_sidepanel'>
						<div class='sidepanel_bg' id='fleet_tracking_sidepanel_bg'>
							<div class='sidepanel_content'>
								<div class='selected_fleet_nametab' style='z-index: 2;'>
									<div class='selected_item_name' id='fleet_move_selected_fleet_name'></div>
								</div>
								<div class='selected_item_stats fleetmove'>
									<div style='display: inline-block; width: 100px;'>Ships</div>
									<div style='display: inline-block; width: 90px; text-align: right;' id='fleet_move_selected_fleet_shipcount'></div>
									<div style='display: inline-block; width: 100px;'>Firepower</div>
									<div style='display: inline-block; width: 90px; text-align: right;' id='fleet_move_selected_fleet_strength'></div>
									<div style='display: inline-block; width: 100px;'>Tech Tilt</div>
									<div style='display: inline-block; width: 90px; text-align: right;' id='fleet_move_selected_fleet_techtilt'></div>
									<div style='display: inline-block; width: 100px;'>Wins/Losses</div>
									<div style='display: inline-block; width: 90px; text-align: right;' id='fleet_move_selected_fleet_winslosses'></div>
									<div style='display: inline-block; width: 100px;'>Upkeep</div>
									<div style='display: inline-block; width: 90px; text-align: right;' id='fleet_move_selected_fleet_upkeep'></div>
									<div style='display: inline-block; width: 100px;'>Minor Ships</div>
									<div style='display: inline-block; width: 90px; text-align: right;' id='fleet_move_selected_fleet_shortage'></div>
									<div style='display: inline-block; width: 100px;'>Cargo</div>
									<div style='display: inline-block; width: 90px; text-align: right;' id='fleet_move_selected_fleet_cargo'></div>

								</div>
								<div class='fleet_move_input'>
									<div class='fleet_move_loc_header'>Current Location:</div>
									<div class='fleet_move_loc_entry' id='fleet_move_loc_entry'>N/A</div>
									<div class='fleet_move_select_header' id='move_to_preset_loc_header'>Move to:</div>
									<select class='move_to_preset_loc' id='move_to_preset_loc' onchange='fleetMovementDropdownChange()'>
									</select>
									<!--
									<input class='inputfield32 fleet_move first_coord' id='fleet_move_quadrant'/>
									<div class='fleet_move_sep'>:</div>
									<input class='inputfield32 fleet_move' id='fleet_move_sector'/>
									<div class='fleet_move_sep'>:</div>
									<input class='inputfield32 fleet_move' id='fleet_move_cluster'/>
									<div class='fleet_move_sep'>:</div>
									<input class='inputfield32 fleet_move' id='fleet_move_system'/>
									<div class='fleet_move_sep'>:</div>
									<input class='inputfield32 fleet_move' id='fleet_move_position' />
									-->
									<div class='fleet_move_to_selected_header'  id='move_to_preset_selected_location_header'>Selected Location:</div>
									<div class='fleet_move_to_selected_entry' id='fleet_move_selected_location'>-</div>
									<div class='lightbutton160' id='fleet_move_launch_button' onclick='fleetMoveLaunchClick()'>
										<div class='buttontext24'>Launch</div>
									</div>
									<div class='fleet_move_nomove' style='display: none; ' id='fleet_move_no_move'>This fleet cannot move.</div>
								</div>
							</div>
							<div class='sideborder_topright'></div>
							<div class='sideborder_right'></div>
							<div class='sideborder_bottomright'></div>
							<div class='sideborder_bottom'></div>
							<div class='sideborder_bottomextended'></div>

						</div>
					</div>
					<div class='lowpanel' id='fleet_tracking_lowpanel'>
						<div class='lowpanel_bg'>
						<div class='lowpanel_content' id='fleet_movement_lowpanel_content'>

							<div class='midheading'>Fleet List</div>
							<div class='lowpanel_table fleet' style='height: 280px;'>
								<div class='lowpanel_table_borderwrapper scrollBG'>
									<div class='lowpanel_table_contentlist'>
										<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='moveYourFleets'>

										</div>
									</div>
								<div class='lowpanel_table_headers'>
									<div class='table_fleet_name'>Fleet Name</div>
								  <div class='table_fleet_type'></div>
								  <div class='table_fleet_loc'>Location</div>
								  <div class='table_fleet_loc dest'>Destination</div>
									<div class='table_fleet_eta'>E.T.A.</div>
								</div>
								<div class='tableborderleft'></div>
								<div class='tableborderright'></div>
								<div class='tableborderbottom'></div>
								<div class='tablebordertop'></div>
								<div class='tablebordertopleft'></div>
								<div class='tablebordertopright'></div>
								<div class='tableborderbottomleft'></div>
								<div class='tableborderbottomright'></div>
								</div>
								<div class='scrollbuttons'>
									<div class='scrollbutton_up' id='moveYourFleets_up' onclick="myScroll('moveYourFleets',181,500,'scrollBG')"></div>
									<div class='scrollbutton_down' id='moveYourFleets_down' onclick="myScroll('moveYourFleets',-181,500,'scrollBG')"></div>
								</div>
							</div>

							<div class='fleet_move_transport_resources' style='position:absolute;bottom: 6px;left:38px;text-align: center;font-size: 12px;color:white;'>
								<div class='g_o_cost_field' style='font-size:13px;'>
									<div class='g_o_cost_value' id='fm_cargo_h'>0</div>
									<div class='g_o_cost_value' id='fm_cargo_i'>0</div>
									<div class='g_o_cost_value' id='fm_cargo_s'>0</div>
									<div class='g_o_cost_value' id='fm_cargo_n'>0</div>
								</div>
							</div>


							<div class='lowpanel_uitip_holder'>
								<div class='lowpanel_uitip'>Click a fleet to view its details.</div>
							</div>
						</div>
						<div class='lowborder_right'></div>
						<div class='lowborder_bottomright'></div>
						<div class='lowborder_bottomleft'></div>
						<div class='lowborder_bottom'></div>

					</div>
				</div>

					<div class='main_panel fleetmovement' id='fleet_tracking_main_panel'>
					<div class='main_panel_bg' id='fleet_movement_main_panel_bg'></div>
						<div class='main_panel_content' id='fleet_movement_main_content'>

							<div class='main_header_image_holder_dynamic'>
								<img src='images/fixed/fleetmovement.jpg' id='planet' class='main_header_dynamic_image' />
							</div>

							<h3 class='main_header_title military_title'>Fleet Movement</h3>

							<div class='main_helptext'><span class='textchange'>CLICK PANEL TO EXPAND</span>
							</div>

							<div class='main_panel_extended_content' id='fleet_movement_main_panel_extended_content'>
								This is where you assign movement orders to your fleets. This is also where you keep track of the latest movements of your fleets, as well as get updates on their latest encounters with enemy fleets.
							</div>
						</div>
						<div class='mainborder_topright'></div>
						<div class='mainborder_right'></div>
						<div class='centerslide_container'>
							<div class='inner_corner_slider' style='position: absolute;width: 20px;height: 26px;top: -32px;background: url(images/tiles/cornerslider02.png) no-repeat bottom ;right: 24px;'></div>
							<div class='outer_corner_slider' style='position: absolute;width: 20px;height: 32px;top: -40px;background: url(images/tiles/cornerslider01a.png) no-repeat bottom;right: 9px;'></div>
						</div>
						<div class='mainborder_bottomright_ex_military'></div>
						<div class='mainborder_bottomright_military_open'></div>
						<div class='mainborder_bottom'></div>
						<div class='mainborder_bottomleft'></div>

						<div style='position: absolute; width: 100%; height: 100%; background:none;'></div>

					</div>
				</div>
	
            <!-- Commander Content Box -->
		<div class='main_container thirdsize third_4' id='commanders'>
			<img src='images/icons/insignias/rank08.png' id='commander_points_blink'>
			<div class='infopanel' id='commanders_infopanel'>
				<div class='infopanel_content'>
					<div id='commander_history'>
						<div class='infopanel_header'>Career History</div>
						<div class='comm_history_header'>Total Battles</div>
						<div class='comm_history_entry' id='selected_commander_history_battles'>N/A</div>
						<div class='comm_history_header'>Won</div>
						<div class='comm_history_entry' id='selected_commander_history_battles_won'>N/A</div>
						<div class='comm_history_header'>Lost</div>
						<div class='comm_history_entry' id='selected_commander_history_battles_lost'>N/A</div>
						<div class='comm_history_header'>Missions Completed</div>
						<div class='comm_history_entry' id='selected_commander_history_missions_completed'>N/A</div>
						<div class='comm_history_header'></div>
						<div class='comm_history_entry'></div>

						<div class='infopanel_header'>Special Achievements</div>
						<div id='selected_commander_special_achievements_container'>
							<!--
							<div class='comm_history_header'>Total Annihilation</div>
							<div class='comm_history_entry'>Denied Enemy Retreat</div>
							<div class='comm_history_header'>Against All Odds</div>
							<div class='comm_history_entry'>Won a Calculated Loss</div>
							-->
						</div>
						<!-- Design not done. Button class added for future placement -->
						<div class='fixed_button fixed_button_140_condensed comm_history_button' id='selected_commander_retire_button'>
							<div class='fixed_button_regular_condensed'></div>
							<div class='fixed_button_hover red22' style='opacity: 0; '></div>
							<div class='fixed_button_click red22'></div>
							<div class='dyna_button_text type3'>Retire</div>
						</div>
					</div>

					<div class='academy_recruits' id='academy_recruits'>
						<div class='infopanel_header'>Available Commanders</div>
						<div id='academy_recruits_container'>
							<!--
							<div class='commander_recruits' id='recruit_1'>Mumber 1</div>
							<div class='commander_recruits' id='recruit_2'>Number 2</div>
							<div class='commander_recruits' id='recruit_3'>Number 3</div>
							<div class='commander_recruits' id='recruit_4'>Number 4</div>
							<div class='commander_recruits' id='recruit_5'>Number 5</div>
							<div class='commander_recruits' id='recruit_6'>Number 6</div>
							-->
							</div>
					</div>
				</div>
			</div>

			<div class='sidepanel' id='commanders_sidepanel'>
				<div class='sidepanel_bg' id='commanders_sidepanel_bg'>
					<div class='sidepanel_content'>
						<div class='commander_info' id='commander_sheet'>
							<div class='selected_commander_img'>
								<img class='selected_commander_bg' id='selected_commander_bg' src='images/commanders/nobg.jpg'>
								<img class='selected_commander_uniform' id='selected_commander_uniform' src='images/commanders/nouniform.png'>
								<img class='selected_commander_head' id='selected_commander_head' src='images/commanders/nohead.png'>
							</div>
							<div class='selected_commander_namerank_tab'>
								<div class='selected_item_name rank_tab_entry' id='selected_commander_rank_name'></div>
								<div class='selected_item_name name_tab_entry' title='Renaming a commander costs 2 credits (FREE for VIPs)' id='selected_commander_name'  style='-webkit-touch-callout: default; -webkit-user-select: text; -khtml-user-select: text; -moz-user-select: text; -ms-user-select: text;' spellcheck='false'>No commander selected</div>
							</div>
							<div class='comm_assign_field'>
								<div class='lightbutton160' id='selected_commander_fleet_manage_button'>
									<div class='buttontext24'>Manage Fleet</div>
								</div>
							</div>

							<div class='comm_stat_styling_1'></div>
							<div class='comm_stat_styling_2'></div>
							<div class='comm_stat_styling_3'></div>
							<div class='comm_stat_container'>
								<div class='comm_stat_header'>Personality</div>
								<div class='comm_stat_entry' id='selected_commander_personality'>N/A</div>

								<div class='comm_stat_header high comm_stat_margin'>Commanding</div>
								<div class='comm_stat_entry high comm_stat_margin' id='selected_commander_commanding'>N/A</div>
								<div class='comm_stat_entry_plus high comm_stat_margin' style='display:none;' title='Increase Commanding by 1. Affects use of ability.' id='commander_stat_plus_button_commanding' onclick="plusCommanderStat('commanding')">+</div>
								<div class='comm_stat_entry_plus high comm_stat_margin' style='display:none;' title='Increase Commanding by 5. Affects use of ability.' id='commander_stat_plus_button_commanding_5' onclick="plusCommanderStatFive('commanding')">+5</div>

								<div class='comm_stat_header high'>Perception</div>
								<div class='comm_stat_entry high' id='selected_commander_perception'>N/A</div>
								<div class='comm_stat_entry_plus high' style='display:none;'  title='Increase Perception by 1. Affects accuracy.' id='commander_stat_plus_button_perception' onclick="plusCommanderStat('perception')">+</div>
								<div class='comm_stat_entry_plus high' style='display:none;'  title='Increase Perception by 5. Affects accuracy.' id='commander_stat_plus_button_perception_5' onclick="plusCommanderStatFive('perception')">+5</div>

								<div class='comm_stat_header high'>Tactics</div>
								<div class='comm_stat_entry high' id='selected_commander_tactics'>N/A</div>
								<div class='comm_stat_entry_plus high' style='display:none;' title='Increase Tactics by 1. Affects target-pri override.' id='commander_stat_plus_button_tactics' onclick="plusCommanderStat('tactics')">+</div>
								<div class='comm_stat_entry_plus high' style='display:none;' title='Increase Tactics by 5. Affects target-pri override.' id='commander_stat_plus_button_tactics_5' onclick="plusCommanderStatFive('tactics')">+5</div>

								<div class='comm_stat_header high'>Morale</div>
								<div class='comm_stat_entry high' id='selected_commander_morale'>N/A</div>
								<div class='comm_stat_entry_plus high' style='display:none;' title='Increase Morale by 1. Affects damage.' id='commander_stat_plus_button_morale' onclick="plusCommanderStat('morale')">+</div>
								<div class='comm_stat_entry_plus high' style='display:none;' title='Increase Morale by 5. Affects damage.' id='commander_stat_plus_button_morale_5' onclick="plusCommanderStatFive('morale')">+5</div>

								<div class='comm_stat_header top_space'>Stat-points</div>
								<div class='comm_stat_entry top_space' id='selected_commander_statpoints'>N/A</div>

								<div class='comm_stat_header comm_stat_margin'>Experience</div>
								<div class='comm_stat_entry comm_stat_margin' id='selected_commander_experience'>-/-</div>
								<div class='comm_stat_header'>Strength-limit</div>
								<div class='comm_stat_entry' id='selected_commander_ship_limit'>N/A</div>
								<div class='comm_stat_header'>Fleet Limit</div>
								<div class='comm_stat_entry' id='selected_commander_fleet_limit'>N/A</div>
							</div>
							<div class='comm_status_container' id='commander_current_assignment_section'>
								<div class='comm_stat_header'>Fleet Name</div>
								<div class='comm_stat_entry' id='selected_commander_fleet_name'>N/A</div>
								<div class='comm_stat_header'>Location</div>
								<div class='comm_stat_entry' id='selected_commander_location'>N/A [0:0:0:0:0]</div>
								<!--<div class='comm_stat_header'>Subordinate Fleets</div>
								<div class='comm_stat_entry' id='selected_commander_subordinate_fleets'>None</div>-->
								<div class='comm_dp_title' style='color: black;'>Reassign to:</div>
								<select class='comm_fleet_select'  id='selected_commander_fleet_dropdown'>
								</select>
							</div>
							<div class='comm_stat_styling_4'></div>
							<div class='comm_stat_styling_5'>Current Assignment</div>
							<div class='comm_stat_styling_6'></div>
						</div>
						<div class='comm_custom_container' id='customize_commander_container_none'>
								Select a commander in the list to the left to activate this section.
						</div>
						<div class='comm_custom_container' id='customize_commander_container_dead' style='display:none;'>
								We do not wake the dead to redress or perform surgery.
						</div>

						<div class='comm_custom_container' id='customize_commander_container' style='display:none;'>
							<div class='comm_custom_face'>
								<div class='comm_custom_prev'>
									<div class='select_arrow_left' onclick='prevFaceClick()'></div>
								</div>
								<div class='comm_custom_purchase'>Face</div>
								<div class='comm_custom_next'>
									<div class='select_arrow_right' onclick='nextFaceClick()'></div>
								</div>
							</div>
							<div class='comm_custom_uniform'>
								<div class='comm_custom_prev'>
									<div class='select_arrow_left' onclick='prevUniformClick()'></div>
								</div>
								<div class='comm_custom_purchase'>Uniform</div>
								<div class='comm_custom_next'>
									<div class='select_arrow_right' onclick='nextUniformClick()'></div>
								</div>
							</div>
							<div id='comm_custom_helptext' class='comm_custom_helptext'>Saving a custom Head / Uniform costs 2 credits.</div>
							<div class='comm_custom_purchase_button' onclick='saveCustomCommander()'>Save</div>
						</div>
					</div>
					<div class='sideborder_topright'></div>
					<div class='sideborder_right' style='z-index:-1;'></div>
					<div class='sideborder_bottomright'></div>
					<div class='sideborder_bottom'></div>
					<div class='sideborder_bottomextended'></div>
				</div>

			</div>

			<div class='lowpanel' id='commanders_lowpanel'>
				<div class='lowpanel_bg' style='bottom: 6px;'>
					<div class='lowpanel_content'>
						<div class='lowpanel_header'>Your Commanders</div>
						<div class='lowpanel_table fleet'>
							<div class='lowpanel_table_borderwrapper scrollBG'>
								<div class='lowpanel_table_contentlist footer'>
									<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='allYourCommanders'>
										<!-- Per commander
										<div class='tableselection evenline' id='manage_selected_commander'>
											<div class='table_comm_active'>
												<img src='../images/icons/activecommander.png'>
											</div>
											<div class='table_comm_name'>V.Adm Haron</div>
											<div class='table_fleet_type' title='This is a Homeworld Fleet'>
												<img src='images/icons/homeworld_fleet_0.png'>
											</div>
											<div class='table_comm_name'>Homeworld Fleet</div>
											<div class='table_comm_fleet_size'>425 / 800</div>
										</div>
										-->
									</div>
								</div>
								<div class='lowpanel_table_headers'>
									<div class='table_comm_name_header'>Commander Name</div>
									<div class='table_fleet_type comm'></div>
									<div class='table_fleet_name'>Fleet Name</div>
									<div class='table_fleet_size'>Strength</div>
								</div>
								<div class='lowpanel_table_footers' id='war_academy_recruits_link' onclick='showMyRecruits()'>
									<div class='lowpanel_table_footer_bg'></div>
									<div class='lowpanel_table_footer_title'>&gt;&gt; View War Academy Recruits &lt;&lt;</div>
								</div>
								<div class='tableborderleft'></div>
								<div class='tableborderright'></div>
								<div class='tableborderbottom'></div>
								<div class='tablebordertop'></div>
								<div class='tablebordertopleft'></div>
								<div class='tablebordertopright'></div>
								<div class='tableborderbottomleft'></div>
								<div class='tableborderbottomright'></div>
							</div>
							<div class='scrollbuttons'>
								<div class='scrollbutton_up' id='allYourCommanders_up' onclick="myScroll('allYourCommanders',181,500,'scrollBG')"></div>
								<div class='scrollbutton_down' id='allYourCommanders_down' onclick="myScroll('allYourCommanders',-181,500,'scrollBG')"></div>
							</div>
						</div>
						<div class='lowpanel_uitip_holder'>
							<div class='lowpanel_uitip'>Click on a commander in the list to view details.</div>
						</div>
					</div>
					<div class='lowborder_right'></div>
					<div class='lowborder_bottomright'></div>
					<div class='lowborder_bottomleft'></div>
					<div class='lowborder_bottom'></div>

				</div>
			</div>

			<div class='main_panel commanders darkpanel' id='commanders_main_panel'>
				<div class='main_panel_bg' id='commanders_main_panel_bg'></div>
				<div class='main_panel_content' id='commanders_main_content'>
					<div class='main_header_image_holder_dynamic'>
						<img src='images/fixed/500dynacomm.jpg' id='main_commanders_image' class='main_header_dynamic_image'>
					</div>
					<h3 class='main_header_title military_title'>Commanders</h3>
					<div class='main_helptext'>
						<span class='textchange'>Click panel to expand</span>
					</div>
					<div class='main_panel_extended_content' id='commanders_main_panel_extended_content'>
						Your commanders are the center of your fleets. Their abilities determine much of the performance of your fleets and can be the deciding factor in many battles.
					</div>
					<div class='main_panel_darkpanel'>
						<div class='comm_dp_tab'>Commanders Overview</div>
						<div class='comm_dp_title'>Commanders</div>
						<div class='comm_dp_entry' id='commanders_count'>-</div>
						<div class='comm_dp_title'>Active</div>
						<div class='comm_dp_entry' id='commanders_active'>-</div>
						<div class='comm_dp_title'>Inactive</div>
						<div class='comm_dp_entry' id='commanders_inactive'>-</div>
						<div class='comm_dp_title'>Strength Capacity:</div>
						<div class='comm_dp_entry' id='commanders_ship_capacity'>-</div>
						<div class='comm_dp_title'>Highest Rank</div>
						<div class='comm_dp_entry' id='commanders_highest_rank'>-</div>

						<div class='fleet_dp_needs'>
							<div class='comm_dp_title'>War Academy:</div>
							<div class='comm_dp_entry' id='commanders_war_academy_level'>-</div>
							<div class='comm_dp_title'>Recruits Available:</div>
							<div class='comm_dp_entry' id='commanders_recruits_available'>-</div>
						</div>
					</div>
				</div>
				<div class='mainborder_topright'></div>
				<div class='mainborder_right'></div>
				<div class='centerslide_container'>
					<div class='inner_corner_slider' style='position: absolute;width: 20px;height: 26px;top: -32px;background: url(images/tiles/cornerslider02.png) no-repeat bottom ;right: 24px;'></div>
					<div class='outer_corner_slider' style='position: absolute;width: 20px;height: 32px;top: -40px;background: url(images/tiles/cornerslider01a.png) no-repeat bottom;right: 9px;'></div>
				</div>
				<div class='mainborder_bottomright_ex_military'></div>
				<div class='mainborder_bottomright_military_open'></div>
				<div class='mainborder_bottom'></div>
				<div class='mainborder_bottomleft'></div>
			</div>
		</div>
		<!-- End commanders-panel -->


	
		<div class='main_container thirdsize third_5' id='combat_log'>
			<div class='infopanel' id='combat_log_infopanel'>
				<div class='infopanel_content'>
					<img class='battle_planet_com_log' id='combat_log_bg_image' src='images/planets/planettype04.png' height='100%' width='100%'>
					<div class='infopanel_header'>Battle Summary</div>

					<div class='combat_summary_pane com_log'>
						<div class='com_sum_ship_sum com_log'>
							<div class='com_sum_side_entry com_log'>
								<div>Attacker</div>
							</div>
							<div class='com_sum_center_entry'>
							</div>
							<div class='com_sum_side_entry com_log'>
								<div>Defender</div>
							</div>
							<div class='com_sum_side_entry com_sum_line'>
								<div>
									<div class='com_sum_half com_log'>Total</div>
									<div class='com_sum_half com_log'>Lost</div>
								</div>
							</div>
							<div class='com_sum_center_entry com_sum_line'>
								<div>Ships</div>
							</div>
							<div class='com_sum_side_entry com_sum_line'>
								<div>
									<div class='com_sum_half com_log'>Total</div>
									<div class='com_sum_half com_log'>Lost</div>
								</div>
							</div>
						</div>

						<div class='com_sum_ship_numbers com_log'>
							<div class='com_sum_side_entry com_sum_line'>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_frigates_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_frigates_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_cruisers_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_cruisers_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_battleships_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_battleships_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_carriers_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_carriers_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_transports_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_transports_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_utility_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_utility_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_defenses_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_defenses_lost'>0</div>
								</div>
							</div>
							<div class='com_sum_center_entry com_sum_line com_log'>
								<div>Frigates</div>
								<div>Cruisers</div>
								<div>Battleships</div>
								<div>Carriers</div>
								<div>Transports</div>
								<div>Utility Ships</div>
								<div>Defenses</div>
							</div>
							<div class='com_sum_side_entry com_sum_line'>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_frigates_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_frigates_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_cruisers_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_cruisers_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_battleships_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_battleships_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_carriers_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_carriers_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_transports_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_transports_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_utility_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_utility_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_defenses_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_defenses_lost'>0</div>
								</div>
							</div>
						</div>
						<div class='com_sum_ship_numbers'>
							<div class='com_sum_side_entry com_sum_line'>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_lost'>0</div>
								</div>
							</div>
							<div class='com_sum_center_entry com_sum_line'>
								<div>Total</div>
							</div>
							<div class='com_sum_side_entry com_sum_line'>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_lost'>0</div>
								</div>
							</div>
						</div>
						<div class='com_sum_ship_numbers'>
							<div class='com_sum_side_entry'>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_fighters_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_fighters_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_att_corvettes_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_att_corvettes_lost'>0</div>
								</div>
							</div>
							<div class='com_sum_center_entry'>
								<div>Fighter-wings</div>
								<div>Corvette-wings</div>
							</div>
							<div class='com_sum_side_entry'>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_fighters_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_fighters_lost'>0</div>
								</div>
								<div>
									<div class='com_sum_half com_log' id='cl_bs_def_corvettes_total'>0</div>
									<div class='com_sum_half com_log' id='cl_bs_def_corvettes_lost'>0</div>
								</div>
							</div>
						</div>
							<div class='com_sum_ship_numbers'>
								<div class='com_sum_side_entry com_sum_line'>
									<div>
										<div class='com_sum_half com_log' id='cl_bs_att_xp'>0</div>
									</div>
								</div>
								<div class='com_sum_center_entry com_sum_line'>
									<div>XP</div>
								</div>
								<div class='com_sum_side_entry com_sum_line'>
									<div>
										<div class='com_sum_half com_log' id='cl_bs_def_xp'>0</div>
									</div>
								</div>
							</div>
						<div class='com_sum_ship_numbers com_sum_bottom' id='cl_bs_commander_details_text_container'></div>
						<div class='com_sum_ship_numbers com_sum_bottom' id='cl_bs_stolen_header'>Stolen resources</div>
						<div class='g_o_cost_field' style='font-size:13px;margin-left:18px;'>
							<div class='g_o_cost_value' id='cl_bs_stolen_h'>0</div>
							<div class='g_o_cost_value' id='cl_bs_stolen_i'>0</div>
							<div class='g_o_cost_value' id='cl_bs_stolen_s'>0</div>
							<div class='g_o_cost_value' id='cl_bs_stolen_n'>0</div>
						</div>

						<div class='com_sum_ship_numbers com_sum_bottom' id='cl_bs_bonus_header'>Bonus resources</div>
						<div class='g_o_cost_field' style='font-size:13px;margin-left:18px;'>
							<div class='g_o_cost_value' id='cl_bs_bonus_h'>0</div>
							<div class='g_o_cost_value' id='cl_bs_bonus_i'>0</div>
							<div class='g_o_cost_value' id='cl_bs_bonus_s'>0</div>
							<div class='g_o_cost_value' id='cl_bs_bonus_n'>0</div>
						</div>

					</div>
				</div>
			</div>

			<div class='sidepanel' id='combat_log_sidepanel'>
				<div class='sidepanel_bg' id='combat_log_sidepanel_bg'>
					<div class='sidepanel_content'>
						<div class='combat_log_summary_field'><div id='cl_share_container_1' class='cl_share_container_1' style='display:none;'><img src='images/icons/fb-share-button.png'></div><div id='cl_share_container_2' class='cl_share_container_2' style='display:none'><img src='images/icons/link-share-button.png'></div></div>
						<div class='combat_log_summary_container'>
							<div class='combat_log_summary_line_odd'>
								<div class='summary_left' id='sel_cl_att_name'>N/A</div>
								<div class='summary_center'>Player</div>
								<div class='summary_right' id='sel_cl_def_name'>N/A</div>
							</div>
							<div class='combat_log_summary_line_even'>
								<div class='summary_left' id='sel_cl_att_alliance_name'>-</div>
								<div class='summary_center'>Alliance</div>
								<div class='summary_right' id='sel_cl_def_alliance_name'>-</div>
							</div>
							<div class='combat_log_summary_line_odd'>
								<div class='summary_left' id='sel_cl_att_cmd_rank'>-</div>
								<div class='summary_center'>Cmd.Rank</div>
								<div class='summary_right' id='sel_cl_def_cmd_rank'>-</div>
							</div>
							<div class='combat_log_summary_line_even'>
								<div class='summary_left' id='sel_cl_att_fleets'>-</div>
								<div class='summary_center'>Fleets</div>
								<div class='summary_right' id='sel_cl_def_fleets'>-</div>
								</div>
							<div class='combat_log_summary_line_odd'>
								<div class='summary_left' id='sel_cl_att_ships'>-</div>
								<div class='summary_center'>Ships</div>
								<div class='summary_right' id='sel_cl_def_ships'>-</div>
							</div>
							<div class='combat_log_summary_line_even'>
								<div class='summary_left' id='sel_cl_att_losses'>-</div>
								<div class='summary_center'>Losses</div>
								<div class='summary_right' id='sel_cl_def_losses'>-</div>
							</div>
						</div>
						<div class='selected_commander_img combat_log_img_att'>
							<img id='cl_att_commander_bg' src='images/commanders/nobg.jpg' width='100'  style='position:absolute;' class='flip_img'>
							<img id='cl_att_commander_uniform' src='images/commanders/nouniform.png' width='100'  style='position:absolute;'  class='flip_img'>
							<img id='cl_att_commander_head' src='images/commanders/nohead.png' width='100' style='position:absolute;' class='flip_img'>

						</div>
						<div class='selected_commander_img combat_log_img_def'>
							<img id='cl_def_commander_bg' src='images/commanders/nobg.jpg' width='100' style='position:absolute;'>
							<img id='cl_def_commander_uniform' src='images/commanders/nouniform.png' width='100' style='position:absolute;'>
							<img id='cl_def_commander_head' src='images/commanders/nohead.png' width='100' style='position:absolute;'>
						</div>
						<div class='selected_fleet_nametab combat_log_summary_tab'>
							<div class='selected_item_name combat_log_tab'>
								<div>Battle at <span id='sel_cl_location_name'>-</span><span class='combat_log_battle_time'  id='sel_cl_timestamp'>N/A</span></div>
								<div class='combat_log_battle_coords' id='sel_cl_location_coordinates'>[]</div>
							</div>
						</div>
						<div class='combat_log_init_view_container'  id='sel_cl_view_battle_button'>
							<div class='fixed_button fixed_button_320 battle_replay' id='battle-replay'>
								<div class='fixed_button_regular regular_320' style='opacity: 1;'></div>
								<div class='fixed_button_hover green_320' style='opacity: 0;'></div>
								<div class='fixed_button_click green_320'></div>
								<div class='dyna_button_text type2'>View Complete Battle</div>
							</div>
						</div>
						<div class='combat_log_att_result_big' id='combat_log_att_result_big'>---</div>
						<div class='combat_log_def_result_big' id='combat_log_def_result_big'>---</div>
					</div>
					<div class='sideborder_topright'></div>
					<div class='sideborder_right'></div>
					<div class='sideborder_bottomright'></div>
					<div class='sideborder_bottom'></div>
					<div class='sideborder_bottomextended'></div>

				</div>
			</div>

			<div class='lowpanel' id='combat_log_lowpanel'>
				<div class='lowpanel_bg' style='bottom: 6px;'>
					<div class='lowpanel_content' id='combat_log_lowpanel_content'>
						<div class='lowpanel_header'>Battles List</div>
						<div class='lowpanel_table fleet' style='height: 312px;'>
							<div class='lowpanel_table_borderwrapper scrollBG'>
								<!--<div class='lowpanel_table_contentlist footer double'>-->
								<div class='lowpanel_table_contentlist'>
									<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='combat_log_container'>
										<!-- Will be filled dynamically -->
										<!-- Each entry linking to loadFirstDataForCombat(combat-id) -->

									</div>
								</div>
								<div class='lowpanel_table_headers'>
									<div class='table_combat_log_timestamp'>Time</div>
									<div class='table_combat_log_opponent'>Opponent</div>
									<div class='table_combat_log_icon'>A/D</div>
									<div class='table_combat_log_location'>Location</div>
									<div class='table_combat_log_outcome'>R</div>
                                </div>

								<div class='tableborderleft'></div>
								<div class='tableborderright'></div>
								<div class='tableborderbottom'></div>
								<div class='tablebordertop'></div>
								<div class='tablebordertopleft'></div>
								<div class='tablebordertopright'></div>
								<div class='tableborderbottomleft'></div>
								<div class='tableborderbottomright'></div>
							</div>
							<div class='scrollbuttons'>
								<div class='scrollbutton_up' id='combat_log_container_up' onclick="myScroll('combat_log_container',181,500,'scrollBG')"></div>
								<div class='scrollbutton_down' id='combat_log_container_down' onclick="myScroll('combat_log_container',-181,500,'scrollBG')"></div>
							</div>
						</div>
						<div class='lowpanel_uitip_holder'>
							<div class='lowpanel_uitip'>Click on a battle to view details.</div>
						</div>
					</div>
					<div class='lowborder_right'></div>
					<div class='lowborder_bottomright'></div>
					<div class='lowborder_bottomleft'></div>
					<div class='lowborder_bottom'></div>

				</div>
			</div>

			<div class='main_panel combat_log' id='combat_log_main_panel'>
				<div class='main_panel_bg' id='combat_log_main_panel_bg'></div>
				<div class='main_panel_content' id='combat_log_main_content'>
					<div class='main_header_image_holder_dynamic'>
						<img src='images/fixed/500dynaimage3.jpg' id='combat_log_dynaimage' class='main_header_dynamic_image' >
					</div>

					<h3 class='main_header_title military_title'>Combat Log</h3>
					<div class='main_helptext'><span class='textchange'>CLICK PANEL TO EXPAND</span></div>
					<div class='main_panel_extended_content' id='combat_log_main_panel_extended_content'>
						This panel contains all the relevant information about your past battles, with quick summaries, and the option to view the battles.
					</div>
				</div>
				<div class='mainborder_topright'></div>
				<div class='mainborder_right'></div>
				<div class='centerslide_container'>
					<div class='inner_corner_slider' style='position: absolute;width: 20px;height: 26px;top: -32px;background: url(images/tiles/cornerslider02.png) no-repeat bottom ;right: 24px;'></div>
					<div class='outer_corner_slider' style='position: absolute;width: 20px;height: 32px;top: -40px;background: url(images/tiles/cornerslider01a.png) no-repeat bottom;right: 9px;'></div>
				</div>
				<div class='mainborder_bottomright_ex_military'></div>
				<div class='mainborder_bottomright_military_open'></div>
				<div class='mainborder_bottom'></div>
				<div class='mainborder_bottomleft'></div>
				<div style='position: absolute; width: 100%; height: 100%; background:none;'></div>
			</div>
		</div>
 
		<div class='main_container thirdsize third_8' id='target_search'>
			<div class='infopanel' id='target_search_infopanel'>
				<div class='infopanel_content'>
					<!--<img class='target_search_info_background' id='target_search_bg_image' src='images/fixed/launchbg.jpg' height='100%' width='100%'>-->
					<div class='infopanel_header' id='target_search_infopanel_header'>No target selected</div>
						<div id='target_search_infopanel_coordsdiv' style='text-align:center;width:99%;color:#45D6EB; cursor:url(css/smbutton.png), auto;font-size:13px;'></div>
						<div id='target_search_infopanel_content'>
							Click a target to the left to display the intel overview
						</div>
				</div>
			</div>

			<div class='sidepanel' id='target_search_sidepanel'>
				<div class='sidepanel_bg' id='target_search_sidepanel_bg'>
					<div class='sidepanel_content'>
						<div class='selected_fleet_nametab'>
							<div class='selected_item_name' id='target_search_side_header'>Search-parameters</div>
						</div>
						<div class='rank_name_note' id='target_search_form_box' style='top:29px;'>
							<div class='rank_header'>Alliance</div>
							<input id='target_search_aname' class='rank_rename input_styling' id='target_search_aname' style=' width:240px;'>
							<div class='rank_header'>Quadrant</div>
							<select id='target_search_quadrant' class='rank_note input_styling'  style='height:21px; padding:0px; padding-left:10px; width:250px;'><option value='1'>Alpha (1)</option><option value='2'>Beta (2)</option><option value='3'>Gamma (3)</option><option value='4'>Delta (4)</option><option value='5'>Epsilon (5)</option><option value='6'>Zeta (6)</option><option value='7'>Eta (7)</option><option value='8'>Theta (8)</option><option value='9'>Iota (9)</option><option value='10'>Kappa (10)</option><option value='11'>Lambda (11)</option><option value='12'>Omicron (12)</option><option value='13'>Sigma (13)</option><option value='14'>Upsilon (14)</option><option value='15'>Psi (15)</option><option value='16'>Omega (16)</option></select>
							<div class='rank_header'>Distance</div>
							<select id='target_search_distance' class='rank_note input_styling'  style='height:21px; padding:0px; padding-left:10px; width:250px;'><option value='1000'>Any</option><option value='1'>1 jump</option><option value='2'>2 jumps</option><option value='3' selected='selected'>3 jumps</option><option value='5'>5 jumps</option><option value='10'>10 jumps</option></select>
							<div class='rank_header'>Strength</div>
							<select id='target_search_strength' class='rank_note input_styling' style='height:21px; padding:0px; padding-left:10px; width:250px;'><option value='1'>Any</option><option value='2'>0-10.000</option><option value='3'>10.001-20.000</option><option value='4'>20.001-30.000</option><option value='5'>30.001-50.000</option><option value='6'>50.001-70.000</option><option value='7'>70.001-100.000</option><option value='8'>100.001-150.000</option><option value='9'>150.001-200.000</option><option value='10'>200.001-500.000</option><option value='11'>500.001-2.000.000</option></select>
							<div class='rank_header'>Bounty</div>
							<select id='target_search_bounty' class='rank_note input_styling' style='height:21px; padding:0px; padding-left:10px; width:250px;'><option value='0'>Any</option><option value='1'>Show only targets with bounty</option></select>
							<!--
							<div class='espionage_activation' onclick='targetSearchClickSpecial()' style='    position: absolute;top: 128px;left: -7px;color: #e5e5e5;font-family: "Orbitron", sans-serif;font-size: 14px;font-weight: 700;letter-spacing: 1px;line-height: 22px;'>Stations and Banks</div>
							<div class='lightbutton160 motd_submit' onclick='targetSearchClick()' style='top:3px;margin-right:47px;'><div class='buttontext24'>Player-Search</div></div>
							-->

							<div class='general_button_blue' onclick='targetSearchClickSpecial()' style='position: absolute;top: 128px;left: -20px; width:152px;'>Stations and Banks</div>
							<div class='general_button_blue' onclick='targetSearchClick()' style='position: absolute;top: 128px;left: 147px; width:152px'>Player-Search</div>
							<div class='general_button_blue' onclick='targetSearchClickOutposts()' style='position: absolute;top: 128px;left: 314px; width:152px'>Outposts</div>



						</div>
					</div>
					<div class='sideborder_topright'></div>
					<div class='sideborder_right'></div>
					<div class='sideborder_bottomright'></div>
					<div class='sideborder_bottom'></div>
					<div class='sideborder_bottomextended'></div>
				</div>

			</div>

			<div class='lowpanel' id='target_search_lowpanel'>
				<div class='lowpanel_bg' style='bottom: 6px;'>
					<div class='lowpanel_content' id='target_search_lowpanel_content'>
						<div class='lowpanel_header'>Target List</div>
						<div class='lowpanel_table fleet' style='height: 312px;'>
							<div class='lowpanel_table_borderwrapper scrollBG'>
								<div class='lowpanel_table_contentlist'>
									<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='target_search_container'>
										<!-- Will be filled dynamically -->
										<!-- Each entry linking to ...a target -->

									</div>
								</div>
								<div class='lowpanel_table_headers'>
									<div class='table_target_search_player' onclick='sortTargetSearch("nickname")' style='cursor:pointer;' id='target_search_col_1'>Player</div>
									<div class='table_target_search_alliance' onclick='sortTargetSearch("alliance")' style='cursor:pointer;' id='target_search_col_2'>Alliance</div>
									<div class='table_target_search_strength' onclick='sortTargetSearch("strength")' style='cursor:pointer;' id='target_search_col_3'>Strength</div>
									<div class='table_target_search_level' onclick='sortTargetSearch("level")' style='cursor:pointer;' id='target_search_col_4'>Lvl</div>
									<div class='table_target_search_bounty' onclick='sortTargetSearch("bounty")' style='cursor:pointer;' id='target_search_col_5'>Bty</div>
                                </div>

								<div class='tableborderleft'></div>
								<div class='tableborderright'></div>
								<div class='tableborderbottom'></div>
								<div class='tablebordertop'></div>
								<div class='tablebordertopleft'></div>
								<div class='tablebordertopright'></div>
								<div class='tableborderbottomleft'></div>
								<div class='tableborderbottomright'></div>
							</div>
							<div class='scrollbuttons'>
								<div class='scrollbutton_up' id='target_search_container_up' onclick="myScroll('target_search_container',181,500,'scrollBG')"></div>
								<div class='scrollbutton_down' id='target_search_container_down' onclick="myScroll('target_search_container',-181,500,'scrollBG')"></div>
							</div>
						</div>
						<div class='lowpanel_uitip_holder'>
							<div class='lowpanel_uitip'>Click on a target to look at any gathered intel</div>
						</div>
					</div>
					<div class='lowborder_right'></div>
					<div class='lowborder_bottomright'></div>
					<div class='lowborder_bottomleft'></div>
					<div class='lowborder_bottom'></div>

				</div>
			</div>

			<div class='main_panel combat_log' id='target_search_main_panel'>
				<div class='main_panel_bg' id='target_search_main_panel_bg'></div>
				<div class='main_panel_content' id='target_search_main_content'>
					<div class='main_header_image_holder_dynamic'>
						<!--<img src='images/fixed/500dynaimage3.jpg' id='target_search_dynaimage' class='main_header_dynamic_image' >-->
						<img src='images/fixed/500dynatargets.png' id='target_search_dynaimage' class='main_header_dynamic_image' >

					</div>

					<h3 class='main_header_title military_title'>Target Search</h3>
					<div class='main_helptext'><span class='textchange'>CLICK PANEL TO EXPAND</span></div>
					<div class='main_panel_extended_content' id='target_search_main_panel_extended_content'>
						This panel allows you to quickly find suitable targets and look at the intel you might have on them.
					</div>
				</div>
				<div class='mainborder_topright'></div>
				<div class='mainborder_right'></div>
				<div class='centerslide_container'>
					<div class='inner_corner_slider' style='position: absolute;width: 20px;height: 26px;top: -32px;background: url(images/tiles/cornerslider02.png) no-repeat bottom ;right: 24px;'></div>
					<div class='outer_corner_slider' style='position: absolute;width: 20px;height: 32px;top: -40px;background: url(images/tiles/cornerslider01a.png) no-repeat bottom;right: 9px;'></div>
				</div>
				<div class='mainborder_bottomright_ex_military'></div>
				<div class='mainborder_bottomright_military_open'></div>
				<div class='mainborder_bottom'></div>
				<div class='mainborder_bottomleft'></div>
				<div style='position: absolute; width: 100%; height: 100%; background:none;'></div>
			</div>
		</div>
 
		<div class='main_container thirdsize third_9' id='wargame'>
			<div class='infopanel' id='wargame_infopanel'>
				<div class='infopanel_content'>
					<div class='infopanel_header' id='wargame_infopanel_header'>Selected Wargame</div>
						<div id='wargame_infopanel_coordsdiv' style='text-align:center;width:99%;color:#45D6EB; cursor:url(css/smbutton.png), auto;font-size:13px;'></div>
						<div id='wargame_infopanel_content'>
							Click something to see something?
						</div>
				</div>
			</div>

			<div class='sidepanel' id='wargame_sidepanel'>
				<div class='sidepanel_bg' id='wargame_sidepanel_bg'>
					<div class='sidepanel_content'>
						<div class='selected_fleet_nametab'>
							<div class='selected_item_name' id='wargame_side_header'>Wargame Details</div>
						</div>
						<div id='wargames_general_info_container' style='vertical-align:top;height:80px;left:0px; position:absolute; width:215px; top:29px;'>
							<div class='wargames_sidepanel_header'>All Wargames</div>
							<div class='general_wargame_details_header'>Wargames won</div>
							<div class='general_wargame_details_entry' id='total_wargames_won'>0</div>
							<div class='general_wargame_details_header'>Wargames lost</div>
							<div class='general_wargame_details_entry' id='total_wargames_lost'>0</div>
							<div class='general_wargame_details_header'>Wargames Win %</div>
							<div class='general_wargame_details_entry' id='total_wargames_won_percent'>0</div>
							<div class='general_wargame_details_header'>Wargames won rank</div>
							<div class='general_wargame_details_entry' id='wargames_won_rank'>0</div>
							<div class='general_wargame_details_header'>Wargames today</div>
							<div class='general_wargame_details_entry' id='wargames_today'>0</div>
						</div>
						<div id='wargames_specific_info_container' style='vertical-align:top;height:80px;top;left:237px; position:absolute; width:215px; top:29px;'>
							<div class='wargames_sidepanel_header' id='wargames_selected_opponent_header'>Selected opponent</div>
							<div class='general_wargame_details_header'>My wins</div>
							<div class='general_wargame_details_entry' id='my_wargames_won'>-</div>
							<div class='general_wargame_details_header'>My losses</div>
							<div class='general_wargame_details_entry' id='my_wargames_lost'>-</div>
							<div class='general_wargame_details_header'>Win %</div>
							<div class='general_wargame_details_entry' id='my_wargames_won_percent'>-</div>
						</div>
					</div>
					<div class='sideborder_topright'></div>
					<div class='sideborder_right'></div>
					<div class='sideborder_bottomright'></div>
					<div class='sideborder_bottom'></div>
					<div class='sideborder_bottomextended'></div>

				</div>
			</div>

			<div class='lowpanel' id='wargame_lowpanel'>
				<div class='lowpanel_bg' style='bottom: 6px;'>
					<div class='lowpanel_content' id='wargame_lowpanel_content'>
						<div class='lowpanel_header'>Challenge List</div>
						<div class='lowpanel_table fleet' style='height: 250px;'>
							<div class='lowpanel_table_borderwrapper scrollBG'>
								<div class='lowpanel_table_contentlist'>
									<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='wargame_container'>
										<!-- Will be filled dynamically -->
										<!-- Each entry linking to ...a target -->

									</div>
								</div>
								<div class='lowpanel_table_headers'>
									<div class='table_wargame_opponent_player'>Player</div>
									<div class='table_wargame_strength'>Strength-range</div>
                                </div>

								<div class='tableborderleft'></div>
								<div class='tableborderright'></div>
								<div class='tableborderbottom'></div>
								<div class='tablebordertop'></div>
								<div class='tablebordertopleft'></div>
								<div class='tablebordertopright'></div>
								<div class='tableborderbottomleft'></div>
								<div class='tableborderbottomright'></div>
							</div>
							<div class='scrollbuttons'>
								<div class='scrollbutton_up' id='wargame_container_up' onclick="myScroll('wargame_container',181,500,'scrollBG')"></div>
								<div class='scrollbutton_down' id='wargame_container_down' onclick="myScroll('wargame_container',-181,500,'scrollBG')"></div>
							</div>
						</div>
						<div class='direct_challenge_shortcut_container' id='direct_challenge_shortcut_container'>
							<input type='text' id='challenge_nickname' placeholder='Nickname'  class='input_styling' value=''>
							<select id='challenge_nickname_fleet_dropdown' class='no_class_at_all' onfocus='updateChallengeFleets()'><option value='0'>Select fleet</option></select>
							<div class='lightbutton160 green' id='challenge_shortcut_button' onclick='challengeByNicknameClick()'>
									<div class='buttontext24'>Challenge!</div>
							</div>
						</div>

						<div class='lowpanel_uitip_holder'>
							<div class='lowpanel_uitip'>Click a challenge for more information</div>
						</div>
					</div>
					<div class='lowborder_right'></div>
					<div class='lowborder_bottomright'></div>
					<div class='lowborder_bottomleft'></div>
					<div class='lowborder_bottom'></div>

				</div>
			</div>

			<div class='main_panel combat_log' id='wargame_main_panel'>
				<div class='main_panel_bg' id='wargame_main_panel_bg'></div>
				<div class='main_panel_content' id='wargame_main_content'>
					<div class='main_header_image_holder_dynamic'>
						<img src='images/fixed/500dynawargame.jpg' id='wargame_dynaimage' class='main_header_dynamic_image' >

					</div>
					<h3 class='main_header_title military_title'>Wargames</h3>
					<div class='main_helptext'><span class='textchange'>CLICK PANEL TO EXPAND</span></div>
					<div class='main_panel_extended_content' id='wargame_main_panel_extended_content'>Wargames are simulated challenges and no units are damaged or lost for real. This panel shows your challenges, incoming and outgoing</div>
				</div>
				<div class='mainborder_topright'></div>
				<div class='mainborder_right'></div>
				<div class='centerslide_container'>
					<div class='inner_corner_slider' style='position: absolute;width: 20px;height: 26px;top: -32px;background: url(images/tiles/cornerslider02.png) no-repeat bottom ;right: 24px;'></div>
					<div class='outer_corner_slider' style='position: absolute;width: 20px;height: 32px;top: -40px;background: url(images/tiles/cornerslider01a.png) no-repeat bottom;right: 9px;'></div>
				</div>
				<div class='mainborder_bottomright_ex_military'></div>
				<div class='mainborder_bottomright_military_open'></div>
				<div class='mainborder_bottom'></div>
				<div class='mainborder_bottomleft'></div>
				<div style='position: absolute; width: 100%; height: 100%; background:none;'></div>
			</div>
		</div>
 
            <!-- Intel Content Box -->
			<div class='main_container thirdsize third_7' id='intelligence_panel'>

				<div class='infopanel' id='intelligence_infopanel'>
					<div class='infopanel_content'>
						<div class='spy_log' id='full_spy_log'>
							<div class='infopanel_header' id='intelligence_log_header'>Intelligence-log</div>
							<div class='selection_container spy_log_container'>
								<div class='fleetlog_list spy_log infopanel_scroll_content' id='spyLog'>
									<div class='fleetlog_entry spy_entry'>
										<div class='fleetlog_icon'>
											<img src='images/icons/outpost_fleet_2.png'>
										</div>
										<div class='fleetlog_content spy_content'>
											<span>There are no recent intel-updates to display.</span>
										</div>
									</div>
								</div>
								<div class='scrollbuttons'>
									<div class='scrollbutton_up'  id='spyLog_up' onclick="myScroll('spyLog',280,500)"></div>
									<div class='scrollbutton_down' id='spyLog_down' onclick="myScroll('spyLog',-280,500)"></div>
								</div>
							</div>
							<!-- her skal imagene med view-options -->
							<div id='alliance_new_buttons_container' style='position:absolute;top:306px;width:495px;'>
								<div class='intel_log_view_actions' id='intel_view_toggle_1'>
									<div class='fixed_button fixed_button_21_square' id='intel_view_1'>
										<div class='fixed_button_click square_blue_small' id='intel_view_clicker_1' onclick='toggleIntelViewFilter(1)'></div>
									</div>
									<div class='fleet_assign_button_text intel_view_setting'>Own scouts</div>
								</div>

								<div class='intel_log_view_actions' id='intel_view_toggle_2'>
									<div class='fixed_button fixed_button_21_square' id='intel_view_2'>
										<div class='fixed_button_click square_blue_small' id='intel_view_clicker_2' onclick='toggleIntelViewFilter(2)'></div>
									</div>
									<div class='fleet_assign_button_text intel_view_setting'>Own spies</div>
								</div>

								<div class='intel_log_view_actions' id='intel_view_toggle_3'>
									<div class='fixed_button fixed_button_21_square' id='intel_view_3'>
										<div class='fixed_button_click square_blue_small' id='intel_view_clicker_3' onclick='toggleIntelViewFilter(3)'></div>
									</div>
									<div class='fleet_assign_button_text intel_view_setting'>Own infiltrators</div>
								</div>
							</div>
							<div id='alliance_new_buttons_container' style='position:absolute;top:330px;width:495px;'>
								<div class='intel_log_view_actions' id='intel_view_toggle_4'>
									<div class='fixed_button fixed_button_21_square' id='intel_view_4'>
										<div class='fixed_button_click square_blue_small' id='intel_view_clicker_4' onclick='toggleIntelViewFilter(4)'></div>
									</div>
									<div class='fleet_assign_button_text intel_view_setting'>Ally scouts</div>
								</div>

								<div class='intel_log_view_actions' id='intel_view_toggle_5'>
									<div class='fixed_button fixed_button_21_square' id='intel_view_5'>
										<div class='fixed_button_click square_blue_small' id='intel_view_clicker_5' onclick='toggleIntelViewFilter(5)'></div>
									</div>
									<div class='fleet_assign_button_text intel_view_setting'>Ally spies</div>
								</div>

								<div class='intel_log_view_actions' id='intel_view_toggle_6'>
									<div class='fixed_button fixed_button_21_square' id='intel_view_6'>
										<div class='fixed_button_click square_blue_small' id='intel_view_clicker_6' onclick='toggleIntelViewFilter(6)'></div>
									</div>
									<div class='fleet_assign_button_text intel_view_setting'>Ally infiltrators </div>
								</div>
							</div>

						</div>

						<!-- Removed single spy report -->

					</div>
				</div> <!-- end infopanel -->

				<div class='sidepanel' id='intelligence_sidepanel'>
					<div class='sidepanel_bg' id='intel_sidepanel_bg'>
						<div class='sidepanel_content'>
							<div class='selected_fleet_nametab'>
								<div class='selected_item_name' id='sel_intel_report_planet_name'>No mission selected</div>
							</div>
							<div class='selected_fleet_img spy_img'>
								<img id='intel_selected_mission_image' src='images/planets/notification/notify_espionage.jpg'>
							</div>
							<div class='selected_fleet_cmd_namerank spy_field' id='abort_spy_container' style='display:none;'>
								<div class='lightbutton160' id='abort_spy' >
									<div class='buttontext24'>Abort</div>
								</div>
							</div>

							<div class='selected_fleet_info'>
								<div class='spy_stat_header'>Owner:</div>
								<div class='spy_stat_entry' id='sel_intel_report_owner_name'>-</div>
								<div class='spy_stat_header'>Alliance Name:</div>
								<div class='spy_stat_entry italic' id='sel_intel_report_alliance_name'>-</div>
								<div class='spy_stat_header'>Espionage Type:</div>
								<div class='spy_stat_entry' id='sel_intel_report_mission_type'>-</div>
								<div class='spy_stat_header'>Detection-chance:</div>
								<div class='spy_stat_entry' id='sel_intel_report_detection_chance'>-</div>
								<div class='spy_stat_header'>Next update in:</div>
								<div class='spy_stat_entry' id='sel_intel_report_next_update_timestamp'>-</div>

								<!--Espionage information based on target selected in the list. Shows Target name, espionage type, duration, chance of detection, preliminary results (if any), progress until complete. Latest update. etc. Ability to cancel operation included.-->
							</div>
						</div>
						<div class='sideborder_topright'></div>
						<div class='sideborder_right'></div>
						<div class='sideborder_bottomright'></div>
						<div class='sideborder_bottom'></div>
						<div class='sideborder_bottomextended'></div>

					</div>
				</div> <!-- end sidepanel -->

				<div class='lowpanel' id='intelligence_lowpanel'>
					<div class='lowpanel_bg' style='bottom: 6px;'>
						<div class='lowpanel_content' id='intel_lowpanel_content'>
							<div class='lowpanel_header'>Current Operations</div>
							<div class='lowpanel_table fleet' style='height: 240px;'>
								<div class='lowpanel_table_borderwrapper scrollBG'>
									<div class='lowpanel_table_contentlist footer'>
										<div class='lowpanel_table_scrollwrapper lowpanel_scroll_content' id='spyMissions'>
											<!--
											<div class='tableselection evenline' id='intel_mission_row_xxx'>
												<div class='table_spy_target'>Evon V</div>
												<div class='table_fleet_type' title='This fleet is at an outpost.'>
													<img src='images/icons/outpost_fleet_1.png'>
												</div>
												<div class='table_spy_type'>Espionage</div>
												<div class='table_spy_eta'>2h13m</div>
											</div>
											-->
										</div>
									</div>

									<div class='lowpanel_table_headers'>
										<div class='table_spy_target'>Target</div>
										<div class='table_fleet_type'></div>
										<div class='table_spy_type'>Type</div>
										<div class='table_spy_eta'>ETA</div>
									</div>

									<div class='lowpanel_table_footers' id='open_spy_log' onclick='renderIntelligenceLog(0)'>
										<div class='lowpanel_table_footer_bg'></div>
										<div class='lowpanel_table_footer_title'>&gt;&gt; View Complete Intelligence Log &lt;&lt;</div>
									</div>

									<div class='tableborderleft'></div>
									<div class='tableborderright'></div>
									<div class='tableborderbottom'></div>
									<div class='tablebordertop'></div>
									<div class='tablebordertopleft'></div>
									<div class='tablebordertopright'></div>
									<div class='tableborderbottomleft'></div>
									<div class='tableborderbottomright'></div>
								</div>
								<div class='scrollbuttons'>
									<div class='scrollbutton_up' id='spyMissions_up' onclick="myScroll('spyMissions',151,500,'scrollBG')"></div>
									<div class='scrollbutton_down' id='spyMissions_down' onclick="myScroll('spyMissions',-151,500,'scrollBG')"></div>
								</div>

							</div>


							<div id='new_intel_buttons_container'>
								<div class='lowpanel_header'>Counter Intelligence</div>
								<div class='lightbutton160 enabled' id='anti_spy_button' onclick='antiSpySweepClick()'>
										<div class='buttontext24'>Spy Sweep</div>
								</div>
								<div class='lightbutton160 disabled' id='anti_infiltrator_button' onclick='antiInfiltratorSweepClick()'>
										<div class='buttontext24'>Infiltrator Sweep</div>
								</div>
								<div style='width: 145px; float: left; background-color: rgba(0,0,0,0.6); text-align: center; margin-left: 12px; height: 17px; color: white; border-radius: 0px 0px 5px 5px; font-family: Roboto, sans-serif;'>Cost: 100 K / res</div>
								<div style='width: 145px; float: left; background-color: rgba(0,0,0,0.6); text-align: center; margin-left: 70px; height: 17px; color: white; border-radius: 0px 0px 5px 5px; font-family: Roboto, sans-serif;'>Cost: 200 K / res</div>


							</div>


							<div class='lowpanel_uitip_holder'>
								<div class='lowpanel_uitip'>Click on a mission-entry to view details.</div>
							</div>
						</div>
						<div class='lowborder_right'></div>
						<div class='lowborder_bottomright'></div>
						<div class='lowborder_bottomleft'></div>
						<div class='lowborder_bottom'></div>

					</div>
				</div>

				<div class='main_panel intelligence' id='intelligence_main_panel'>
					<div class='main_panel_bg' id='intel_main_panel_bg'></div>
					<div class='main_panel_content' id='intel_main_content'>
						<div class='main_header_image_holder_dynamic'>
							<img src='images/fixed/500dynaspy.jpg' id='intel_header_dynamic_image' class='main_header_dynamic_image'>
						</div>
						<h3 class='main_header_title military_title'>Intelligence</h3>
						<div class='main_helptext'><span class='textchange'>CLICK PANEL TO EXPAND</span></div>
						<div class='main_panel_extended_content' id='intel_main_panel_extended_content'>This is where you can review your intelligence operations. All operations are initiated from the planet view in the Starmap.</div>
					</div>
					<div class='mainborder_topright'></div>
					<div class='mainborder_right'></div>
					<div class='centerslide_container'>
						<div class='inner_corner_slider' style='position: absolute;width: 20px;height: 26px;top: -32px;background: url(images/tiles/cornerslider02.png) no-repeat bottom ;right: 24px;'></div>
						<div class='outer_corner_slider' style='position: absolute;width: 20px;height: 32px;top: -40px;background: url(images/tiles/cornerslider01a.png) no-repeat bottom;right: 9px;'></div>
					</div>
					<div class='mainborder_bottomright_ex_military'></div>
					<div class='mainborder_bottomright_military_open'></div>
					<div class='mainborder_bottom'></div>
					<div class='mainborder_bottomleft'></div>
					<div style='position: absolute; width: 100%; height: 100%; background:none;'></div>
				</div> <!-- end main panel -->

			</div>

	
		</div><!-- Ends the military-content-->
	
		<!--
		<div class='helper_checklist' id='helper_checklist'>
			<div class='helper_logo' onclick='closePanels()'></div>
			<div class='chat_func_1 helper_maxmin' id='helper_maxmin' style='left:300px;' onclick='toggleHelperSize()'></div>
			<div class='helper_header'  onclick='closePanels()'>Get Started</div>
			<div class='helper_subheader' onclick='closePanels()'>Follow these simple steps to get started in AD2460.</div>
        	<div class='helper_container' id='helper_container'>
                <div class='helper_entry' id='the_thing'>
                    <div class='helper_one_line'>How to do the thing.
                        <img class='helper_icon' src='images/icons/buttons/cycle20.png'>
                    </div>
                    <div class='helper_full_info'>
                    All you need to do to do the thing we ask you to do is to go and click the thing with the text. This shows an image. click this and then you will see a list. Scroll this until you find the thing. click this thing, then the other thing, and you will have done the thing you were supposed to. The info about that thing is in the lower right of the other place that you can see clearly. Profit!
                    </div>
                </div>
                <div class='helper_entry' id='the_thing_2'>
                    <div class='helper_one_line'>How to do the thing.
                        <img class='helper_icon' src='images/icons/buttons/cycle20.png'>
                    </div>
                    <div class='helper_full_info'>
                    All you need to do to do the thing we ask you to do is to go and click the thing with the text. This shows an image. click this and then you will see a list. Scroll this until you find the thing. click this thing, then the other thing, and you will have done the thing you were supposed to. The info about that thing is in the lower right of the other place that you can see clearly. Profit!
                    </div>
                </div>
            </div>
        </div>

		<div class='checklist_button' id='checklist_initiate' style='display: none;'>
        	<div class='check_header'>Start Here!</div>
            <div class='check_help' id='check_help'>Click to open helper.</div>
        </div>
		-->
		<div class='help_commander' id='help_commander'>
			<img src='images/commanders/helpcommander_big.png'>
			<div class='help_commander_comment' id='help_comm_field' style='opacity: 1;'>
				<span class='help_subject' id='help_comm_head'>We need more resources!</span>
				<span class='help_commander_subject' id='help_comm_text'></span>
				</div>
		</div>



		<div class='slide_closer' id='slidecloser' onclick='closeSlides();hideSlideCloser();' >
		</div>
		<div class='slide_closer_help' id='slidecloserhelp' onclick='$("#gameinfo").click();hideSlideCloser();' >
		</div>


	
	<div class='playerinfo_draggable' style='display:none' id='playerinfo_popup'>
		<div class='playerinfo_container'>
			<img class='player_avatar' id='player_info_avatar' src='images/fixed/avartar2.jpg'>
			<img class='vip_info' id='player_info_vip_icon' src='images/icons/vip/forums/none.png'>

				<div class='playerinfo_playername' id='player_info_nickname'>Agathon the Bulb</div>
				<div class='info_bubble_chat' title='Message' id='player_info_msglink'></div>
				<div class='info_bubble_invite' title='Invite to alliance' id='player_info_invitelink' style='display:none;'></div>
				<div class='bottomslide_close' id='player_info_close' onclick='hidePlayerInfoPopup()'><img src='images/fixed/cancel.png'></div>
				<div class='playerinfo_title'>Homeworld</div>
			<div class='playerinfo_homeworld' id='player_info_homeworld_name'>Komplonatic Prime</div>
				<div class='playerinfo_title'>Alliance</div>
			<div class='playerinfo_alliance' id='player_info_alliance_name'>The Fabulous Five</div>
				<div class='playerinfo_title'>Player Level</div>
			<div class='playerinfo_entry' id='player_info_level'>7</div>
				<div class='playerinfo_title'>Strength</div>
			<div class='playerinfo_entry' id='player_info_strength'>1.000.000</div>
				<div class='playerinfo_title'>Score</div>
			<div class='playerinfo_entry' id='player_info_score'>1.000.000</div>

				<div class='wargames_summary'>
					<div class='wargames_sidepanel_header' id='player_info_wargames_heading'>Wargames VS Powerlord</div>
					<div class='wargame_sum_header'>My Wins</div><div class='wargame_sum_entry' id='player_info_wargames_my_wins'>999</div>
					<div class='wargame_sum_header'>My Losses</div><div class='wargame_sum_entry' id='player_info_wargames_my_losses'>999</div>
					<div class='wargame_sum_header'>Win %</div><div class='wargame_sum_entry' id='player_info_wargames_my_winpercent'>99%</div>
					<div class='info_bubble_challenge' title='Challenge to a wargame' id='player_info_wargamelink'></div>
				</div>
				<div class='battles_summary'>
					<div class='wargames_sidepanel_header'>Recent Clashes</div>
					<div class='wargames_listing'>
						<div class='wargames_sidepanel_header'>Wargames</div>
						<div id='player_info_wargames_container'>
						<div class='tableselection'>
								<div class='table_combat_log_location'>Wolf 359</div><div class='table_combat_log_outcome'>L</div>
							</div>
					</div>
					</div>
					<div class='battles_listing'>
						<div class='wargames_sidepanel_header'>Real Clashes</div>
					<div id='player_info_combats_container'>
						<div class='tableselection'>
							<div class='table_combat_log_location'>Rota Nove</div><div class='table_combat_log_outcome'>W</div>
						</div>
					</div>
					</div>
				</div>
				<div class='bounty_overview'>
					<div class='bounty_icon'></div>
					<div class='wargames_sidepanel_header'>Total Bounties</div>
					<div class='bounty_total' id='player_info_total_bounty'>129 credits</div>
				</div>
				<div class='lightbutton160' id='player_info_view_intel_button'>View Recent Intel</div>
				<div class='banbuttons' style='text-align:center;width:100%'>
					<div class='lightbutton160' style='margin-left:20px;' id='admin_ban_button' style='display:none;'>ChatBan (2hrs)</div>
					<div class='lightbutton160' style='margin-left:20px;'id='admin_unban_button' style='display:none;'>UnBan</div>
				</div>
				<div class='playerinfo_line'></div>
		</div>
	</div>

	<div class='allianceinfo_draggable' id='allianceinfo_popup' style='display:none'>
		<div class='allianceinfo_container'>
			<img class='alliance_avatar' id='alliance_info_avatar' src='images/fixed/avartar2.jpg'>
			<div class='playerinfo_playername alliance' id='alliance_info_name'>The Fabulous Five</div>
			<div class='bottomslide_close' onclick='hideAllianceInfoPopup()'><img src='images/fixed/cancel.png'></div>
			<div class='playerinfo_title'>Strength</div><div class='playerinfo_entry' id='alliance_info_strength'>0</div>
			<div class='playerinfo_title'>Members</div><div class='playerinfo_entry' id='alliance_info_membercount'>0</div>
			<div class='playerinfo_title'>Average Strength</div><div class='playerinfo_entry' id='alliance_info_avg_strength'>0</div>
			<div class='playerinfo_title'>Alliance Ranking</div><div class='playerinfo_entry' id='alliance_info_strength_ranking'>#0</div>
			<div class='playerinfo_title'>Alliance Leader</div><div class='playerinfo_entry' style='color: #ffe868; cursor:pointer;' id='alliance_info_leader_name'>--</div>
			<div class='playerinfo_title'>Recruitment Officer</div><div class='playerinfo_entry' style='color: #ffe868; cursor:pointer;' id='alliance_info_recruiter_name'>--</div>
			<div class='playerinfo_title'>Alliance Bank</div><div class='playerinfo_entry' id='allianceinfo_popup_bankers' style='height:auto; overflow:auto'></div>
			<div class='lightbutton160 red' id='alliance_info_declare_war_button' style='display:none'>Declare War</div>
			<div class='battles_summary'>
				<div class='wargames_sidepanel_header'>Recent Clashes</div>
				<div class='clashes_listing' id='alliance_info_combats_container'>
					<div class='tableselection'>
						<div class='table_combat_log_location'>Poundhammer78</div><div class='table_combat_log_outcome'>vs</div><div class='table_combat_log_location'>TheDestructiveOne</div><div class='table_combat_log_outcome'>L</div>
					</div>
				</div>
			</div>
			<div class='battles_summary'>
				<div class='wargames_sidepanel_header'>Public Statement</div>
				<div class='clashes_listing' style='padding-left:3px; padding-right:3px;' id='alliance_info_public_text'></div>
			</div>
			<!--<div class='lightbutton160' id='alliance_info_view_intel_button'>View Recent Intel</div>	-->
			<div class='allianceinfo_line'></div>
		</div>
	</div>


	
		<div class='confirmation_plate' id='confirmation_popup'>
			<div class='confirmation_position'>
				<div class='confirmation_box'>
					<div class='confirmation_box_text' id='conf_main_text'>Hubba</div>
					<div class='confirm_accept'>
						<div class='lightbutton160' id='conf_ok_button'>
							<div class='buttontext24' id='conf_ok_button_text'>Ok</div>
						</div>
					</div>
					<div class='confirm_reject'>
						<div class='lightbutton160' id='conf_cancel_button' onclick='hideConfirmationPopup()'>
							<div class='buttontext24' id='conf_cancel_button_text'>Cancel</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	
		<div class='confirmation_plate' id='ok_popup'>
			<div class='confirmation_position'>
				<div class='confirmation_box'>
					<div class='confirmation_box_text' id='ok_main_text'>Okokokok</div>
					<div class='confirm_accept' style='left:126px'>
						<div class='lightbutton160' id='ok_ok_button'>
							<div class='buttontext24' id='ok_ok_button_text'>Ok</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class='new_ok_plate' id='new_ok_popup'>
			<div class='new_ok_position'>
				<div class='new_ok_box'>
					<div class='new_ok_box_text' id='new_ok_main_text'>Okokokok</div>
					<div class='new_ok_accept'>
						<div class='lightbutton160' id='new_ok_button'>
							<div class='buttontext24' id='new_ok_button_text'>Ok</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		<!-- And the secondary one , detectEvent-thing -->
		<div class='detected_event_box' id='detected_event_box' style='background-color:rgba(0,0,0,0.9);border:1px solid #777777;border-radius:4px;position:absolute;z-index:12;display:none;width:197px;left:0px;top:150px;height:450px;'>
			<div class='detected_event_box_text_heading' style='padding:3px;font-style:italic;color:white;font-size:16px'>TUTORIAL</div>
			<div class='detected_event_box_text' id='d_e_main_text' style='padding:3px;font-style:italic;color:white;font-size:13px'>
			</div>
			<div class='detected_event_button_container' style='bottom:10px;position:absolute;left:15px;'>
				<div class='lightbutton160' id='d_e_ok_button' onclick='hideDetectedEventsBox()'>
					<div class='buttontext24' id='d_e_ok_button_text'>Ok</div>
				</div>
			</div>
		</div>

	
        <!-- Tech Point Award -->
        <div class='tech_point_award_container' id='tech_award_display' onclick='hideTechAward()'>
            <div class='tech_point_award_bg' id='techpoint_bg'></div>
            <div class='tech_point_award_gfx' id='techpoint_gfx'>
                <img src='images/fixed/techpointline.png' />
            </div>
            <div class='tech_point_award_icon' id='techpoint_icon' style='position: absolute;top: -65px;left: 450px;'>
                <img src='images/fixed/techpointline_icon.png' />
            </div>
            <div class='tech_point_award_heading' id='techpoint_head'>TECH POINT AWARDED!</div>
            <div class='tech_point_award_desc' id='techpoint_desc'></div>
        </div>

        <!-- Mission complete Award -->
        <div class='tech_point_award_container' id='mission_complete_display' onclick='hideMissionCompleteAward()'>
            <div class='mission_complete_award_bg' id='mission_complete_bg'></div>
            <div class='mission_complete_award_gfx' id='mission_complete_gfx'>
                <img 'mission_complete_img' src='images/fixed/techpointline.png' />
            </div>
            <div class='tech_point_award_icon' id='mission_complete_icon' style='position: absolute;top: -65px;left: 450px;'>
                <img src='images/fixed/mission_complete_icon.png' />
            </div>
            <div class='tech_point_award_heading' id='mission_complete_head'>Mission Completed!</div>
            <div class='tech_point_award_desc' id='mission_complete_desc'></div>
        </div>

		<!-- New Level Up thing -->
		<div class='level_up_container' id='level_up_container' onclick='hideLevelUpPlate()'>
			<div class='level_up_top'>
				<div class='level_up_icon' id='level_up_icon'></div>
				<div class='level_up_line' id='level_up_line'></div>
				<div class='level_up_text' id='level_up_text'>YOU HAVE REACHED LEVEL 4!</div>
			</div>
			<div class='level_up_main' id='level_up_main'>
				<div class='level_up_desc' id='level_up_desc'></div>
				<div class='level_help_commander' id='level_commander'></div>
			</div>
		</div>


	
		<div style='display:block;position:absolute;' id='blind_status_window' aria-live='polite' role='log'></div>

		<audio id='sfx_click1'		src='audio/click1.mp3' preload='auto'></audio>
		<audio id='sfx_click2'		src='audio/click2.mp3' preload='auto'></audio>
		<audio id='sfx_click3'		src='audio/click3.mp3' preload='auto'></audio>
		<audio id='sfx_drill'		src='audio/drill.mp3' preload='none'></audio>
		<audio id='sfx_error'		src='audio/error.mp3' preload='auto'></audio>
		<audio id='sfx_focus'		src='audio/focus.mp3' preload='auto'></audio>
		<audio id='sfx_newmsg'		src='audio/newmsg.mp3' preload='auto'></audio>
		<audio id='sfx_quickslide'	src='audio/quickslide.mp3' preload='none'></audio>
		<audio id='sfx_quickerslide' src='audio/quickerslide.mp3' preload='none'></audio>
		<audio id='sfx_incoming_alarm' src='audio/incoming_alarm.mp3' preload='auto'></audio>
		<audio id='challenge' src='audio/wargame.mp3' preload='auto'></audio>
		<audio id='applause' src='audio/applause.mp3' preload='auto'></audio>

		<audio id='beam_weapon_01' src='audio/beam_weapon_01.mp3' preload='auto'></audio>
		<audio id='beam_weapon_02' src='audio/beam_weapon_02.mp3' preload='auto'></audio>
		<audio id='beam_weapon_03' src='audio/beam_weapon_03.mp3' preload='auto'></audio>
		<audio id='beam_weapon_04' src='audio/beam_weapon_04.mp3' preload='auto'></audio>

		<audio id='missile_impact_01' src='audio/missile_impact_01.mp3' preload='auto'></audio>
		<audio id='missile_impact_02' src='audio/missile_impact_02.mp3' preload='auto'></audio>
		<audio id='missile_impact_03' src='audio/missile_impact_03.mp3' preload='auto'></audio>
		<audio id='missile_impact_04' src='audio/missile_impact_04.mp3' preload='auto'></audio>
		<audio id='missile_impact_05' src='audio/missile_impact_05.mp3' preload='auto'></audio>
		<audio id='missile_impact_06' src='audio/missile_impact_06.mp3' preload='auto'></audio>
		<audio id='missile_impact_07' src='audio/missile_impact_07.mp3' preload='auto'></audio>
		<audio id='missile_impact_08' src='audio/missile_impact_08.mp3' preload='auto'></audio>
		<audio id='missile_impact_09' src='audio/missile_impact_09.mp3' preload='auto'></audio>
		<audio id='missile_impact_10' src='audio/missile_impact_10.mp3' preload='auto'></audio>

		<audio id='explosion_01' src='audio/explosion_01.mp3' preload='auto'></audio>

		<audio id='volker_shot_01' src='audio/volker_shot_01.mp3' preload='auto'></audio>

		<audio id='missile_down_01' src='audio/missile_down_01.mp3' preload='auto'></audio>
		<audio id='missile_down_02' src='audio/missile_down_02.mp3' preload='auto'></audio>

		<audio id='volatility_explosion' src='audio/volatility_explosion.mp3' preload='auto'></audio>

		<audio id='minor_explosion_01' src='audio/minor_explosion_01.mp3' preload='auto'></audio>
		<audio id='minor_explosion_02' src='audio/minor_explosion_02.mp3' preload='auto'></audio>

		<audio id='disable' src='audio/disable.mp3' preload='auto'></audio>
		<audio id='empeffect' src='audio/empeffect.mp3' preload='auto'></audio>
		<audio id='music' src='audio/starmap_loop.mp3' preload='auto' onended='musicIngameEnded()'></audio>
		<audio id='combatmusic' src='audio/ad_battle_glory.mp3' preload='none'  onended='musicEnded()'></audio>
		<audio id='gravityeffect' src='audio/gravityeffect.mp3' preload='auto'></audio>
		<audio id='stationeffect' src='audio/stationeffect.mp3' preload='auto'></audio>
		<audio id='shield_drain_effect' src='audio/shield_drain.mp3' preload='auto'></audio>
		<audio id='station_shot_01' src='audio/station_shot_01.mp3' preload='auto'></audio>

		<audio id='levelup' src='audio/levelup.mp3' preload='auto'></audio>
		<audio id='helperin' src='audio/helperin.mp3' preload='auto'></audio>


		<script type='text/javascript'>
			document.getElementById('beam_weapon_01').type='combat';
			document.getElementById('beam_weapon_02').type='combat';
			document.getElementById('beam_weapon_03').type='combat';
			document.getElementById('beam_weapon_04').type='combat';

			document.getElementById('missile_impact_01').type='combat';
			document.getElementById('missile_impact_02').type='combat';
			document.getElementById('missile_impact_03').type='combat';
			document.getElementById('missile_impact_04').type='combat';
			document.getElementById('missile_impact_05').type='combat';
			document.getElementById('missile_impact_06').type='combat';
			document.getElementById('missile_impact_07').type='combat';
			document.getElementById('missile_impact_08').type='combat';
			document.getElementById('missile_impact_09').type='combat';
			document.getElementById('missile_impact_10').type='combat';

			document.getElementById('explosion_01').type='combat';

			document.getElementById('volker_shot_01').type='combat';

			document.getElementById('missile_down_01').type='combat';
			document.getElementById('missile_down_02').type='combat';

			document.getElementById('volatility_explosion').type='combat';
			document.getElementById('minor_explosion_01').type='combat';
			document.getElementById('minor_explosion_02').type='combat';
			document.getElementById('disable').type='combat';
			document.getElementById('empeffect').type='combat';
			document.getElementById('combatmusic').type='combat';

			document.getElementById('gravityeffect').type='combat';
			document.getElementById('stationeffect').type='combat';
			document.getElementById('shield_drain_effect').type='combat';
			document.getElementById('station_shot_01').type='combat';
		</script>


	
	<script type='text/javascript'>
		var initialServerTime=1507203681;
		testvar='yes';
		user_id=66151;
		ad2460.user_id=66151;
		ad2460.ref=0;
		ad2460.click_id="";

		ad2460.nickname="Wanstey";
		ad2460.reg_country_iso_3166="uk";
		ad2460.avatar='00066151_990.jpg';
		ad2460.vip_status=0;
		ad2460.motd="Welcome to AD2460 and Cycle V : Vae Victis!\n\nThe game has just started!\nGood luck everyone!\n";
		ad2460.temp_selected_vip_icon=3;
		var hoursX=new Array;
		var moontestcounter=0;
		ad2460.chatserver='http://adchat.ad2460.com/';
		var chatInterval=false;
		var resizeGuiOnWindowResize=false;

		// These must be part of the language setup coming later
		var day_indicator='d';
		var hour_indicator='h';
		var minute_indicator='m';
		var second_indicator='s';

		var debug_image_server='adback2';
		var chatPaneVisible=1;
		ad2460.bounties=new Array;
		var combat_test_mode=0;

		ad2460.time_passing=true;
	

	$.support.cors = true;

	$(window).load(function() {
		// Exectutes late
		
		checkScrollButtonStatus('infopanel_production_queue_container');
		
		
		
		
		document.getElementById('move_new_ships_to').selectedIndex=1;
		document.getElementById('auto_resize_gui_dropdown').selectedIndex=0;
		checkInitialVipStatus();
		setupKeyboardShortcuts();
	});

	$(document).ready(function() {
		ad2460.serverTime=initialServerTime;
		//renderMOTD();
		$.ajaxSetup({
		    type: 'POST',

		    xhrFields: {
		       withCredentials: true
		    },
		    crossDomain: true
		});

		ad2460.homeworld.x=259;
		ad2460.homeworld.y=292;
		ad2460.homeworld.quadrant=6;
		ad2460.homeworld.sector=1;
		ad2460.homeworld.cluster=9;
		ad2460.homeworld.system=1;
		ad2460.homeworld.position=15;
		ad2460.homeworld.planet_id=309134;
		ad2460.homeworld.name="Ibusefat Ligo";
		ad2460.homeworld.reg_timestamp=1499955247;

		jQuery.fx.interval=30;

		//renderSoundIcon();

		fetchAllTechData(function(){performDefaultFacilitySelection(); reloadAllMilitaryData(); });

		updateMoonNew();
		//createComet();
		//createNebula();
		//updateMoonTest();

		starmapViewLevel(1,0,0,0,0);
		//getGalaxyData();
		renderNewTradeIcons();
		renderExchangeRateIcons();
		renderTradeFilterButtons();
		loadTechpoints(function(){fetchPlayerUpdates();renderHomeworldTechBalance();fetchConversations();});
		ad2460.techpoints=1;


		reloadProspectingMissions();

		document.getElementById('target_search_quadrant').selectedIndex=5;


		document.getElementById('homeworldbutton').tabIndex = '1';
		document.getElementById('outpostsbutton').tabIndex = '2';
		document.getElementById('alliancebutton').tabIndex = '3';
		document.getElementById('militarybutton').tabIndex = '4';
		document.getElementById('missionsbutton').tabIndex = '5';

		document.getElementById('homeworld_planet_name').onblur=function(event){
			var enteredName=document.getElementById('homeworld_planet_name').innerHTML;
			enteredName=enteredName.replace('<br>','');
			if (enteredName==''){
				setHomeworldName(ad2460.homeworld.name);
			}
		}

		document.getElementById('homeworld_planet_name').onkeypress=function(event){
			if (event.which==13 || event.keyCode==13) {
				updateHomeworldName();
				document.getElementById('homeworld_planet_name').blur();
				return false;
			}
		}

		document.getElementById('starmap_search_input_player').onkeypress=function(event){
			if (event.which==13 || event.keyCode==13) {
				searchUniverseClick('player');
			}
		}

		document.getElementById('starmap_search_input_alliance').onkeypress=function(event){
			if (event.which==13 || event.keyCode==13) {
				searchUniverseClick('alliance');
			}
		}
		document.getElementById('starmap_search_input_planet').onkeypress=function(event){
			if (event.which==13 || event.keyCode==13) {
				searchUniverseClick('planet');
			}
		}


		fetchPlayerLinks();
		$('#sidebar_toggle_links').click();


	ad2460.forum.forums.push(new forum(11,'Announcements'));
ad2460.forum.forums.push(new forum(5,'Questions'));
ad2460.forum.forums.push(new forum(1,'General discussions'));
ad2460.forum.forums.push(new forum(9,'Alliance Recruitment'));
ad2460.forum.forums.push(new forum(2,'Feedback'));
ad2460.forum.forums.push(new forum(3,'Technical'));
ad2460.forum.forums.push(new forum(4,'Bugs'));
ad2460.forum.forums.push(new forum(6,'Suggestions'));
ad2460.forum.forums.push(new forum(7,'Off-topic discussions'));
ad2460.forum.forums.push(new forum(8,'Alliance-forums'));
ad2460.forum.forums.push(new forum(10,'Galactic Alliance Discussion'));
ad2460.productionitems.push(new ship(401, "Spike", 'Fighter', 'Normal', 12600, 16800, 8400, 8400, 105, 0, 334, 0, 0, 0, 'None', 0, "The Spike is the workhorse of the galactic navy. A no-nonsense tough fighter that is supremely reliable. For those specializing in InTech, its usefulness will only increase.<br/><br/>In Ship-to-Ship mode, this fighter will target enemy fighters first, and then enemy corvettes.<br/><br/>Fighters can also shoot down up to 3 incoming missiles. The amount is dependent on the tactical setting for the fleet.", 240, 25, 'Matter', 80, 0, 'Matter', 125, 112, 1, 2, 2, 9, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 102, 59, 79, 40, 40, 0, "Matter"));
ad2460.productionitems.push(new ship(402, "Vulture", 'Fighter', 'Normal', 12600, 25200, 8400, 8400, 105, 0, 335, 0, 0, 21, 'Matter', 848, "The Vulture is an extremely small and light InTech fighter. They have an impressive manoeuvrability, and light but powerful weapons. This comes at the cost of shields and armour.<br/><br/>In Ship-to-Ship mode, this fighter will target enemy corvettes first, and then enemy fighters.", 185, 18, 'Matter', 100, 0, 'Matter', 105, 108, 2, 2, 2, 12, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 125, 59, 119, 40, 40, 0, "Matter"));
ad2460.productionitems.push(new ship(403, "Orb", 'Fighter', 'Normal', 12600, 8400, 16800, 8400, 105, 0, 337, 0, 0, 0, 'None', 0, "The Orb is the basic StronTech fighter. StronTech allows for increased output in the shields and weapons department. This comes at the cost of its hull.<br/><br/>In Ship-to-Ship mode, this fighter will target enemy fighters first, and then enemy corvettes.", 150, 18, 'Energy', 275, 0, 'Energy', 120, 120, 1, 3, 3, 9, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 105, 59, 40, 79, 40, 0, "Energy"));
ad2460.productionitems.push(new ship(404, "Bolt", 'Fighter', 'Normal', 12600, 8400, 25200, 8400, 105, 0, 338, 0, 0, 21, 'Energy', 824, "This advanced StronTech fighter is, despite its weird shape, a formidable ship. It has excellent manoeuvrability and firepower, coupled with excellent shields.<br/><br/>In Ship-to-Ship mode, this fighter will target enemy corvettes first, and then enemy fighters.", 200, 20, 'Energy', 300, 0, 'Energy', 200, 110, 1, 2, 3, 10, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 110, 59, 40, 119, 40, 0, "Energy"));
ad2460.productionitems.push(new ship(405, "Swoop", 'Fighter', 'Normal', 12600, 8400, 8400, 16800, 105, 0, 340, 0, 0, 0, 'None', 0, "This fighter has all the hallmarks of the NeoTech; the curved lines and the distinct field displacement engines. NeoTech fighters are superior to most other fighters in manoeuvrability, and are not easily bested in a one-on-one fight.<br/><br/>In Ship-to-Ship mode, this fighter will target enemy fighters first, and then enemy corvettes.", 190, 18, 'Displacement', 130, 0, 'Displacement', 85, 98, 1, 3, 1, 9, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 110, 59, 40, 40, 79, 0, "Displacement"));
ad2460.productionitems.push(new ship(406, "Blink", 'Fighter', 'Normal', 12600, 8400, 8400, 25200, 105, 0, 341, 0, 0, 21, 'Displacement', 827, "The Blink is a one-man jump engine. It can instantly jump a very short distance, giving it a massive advantage in any dogfight. The blink is the hardest fighter to take down.<br/><br/>Every 3 rounds, the Blink will perform a short jump, causing its opponents to lose their targeting. Blinks that perform this manoeuvre will not get shot at that combat round. <br/><br/>In Ship-to-Ship mode, this fighter will target enemy corvettes first, and then enemy fighters.", 160, 12, 'Displacement', 75, 0, 'Displacement', 140, 93, 3, 1, 2, 8, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 122, 59, 40, 40, 119, 0, "Displacement"));
ad2460.productionitems.push(new ship(407, "Ghost", 'Corvette', 'Normal', 42000, 21000, 21000, 84000, 210, 0, 341, 0, 0, 31, 'Displacement', 854, "Bending space is NeoTech at its finest. Bending light around its exterior allows this corvette to become virtually invisible to the eye. These ships are ghosts until they open fire.<br/><br/>Ghosts are exceptional at taking out fighters around it, and moves in closer to capital ships to fire on both at the same time.<br/><br/>In combat, these units will cloak in the first round of battle, and only appear again once they open fire. At this point they can be targeted and shot at normally.<br/><br/>Corvettes will always fire on the closest capital ship, regardless of chosen tactical settings.", 550, 80, 'Displacement', 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'Displacement', 460, 42, 5, 1, 10, 10, 'Displacement', 180, 120, 3, 1, 1, 12, 0, 0, 0, 0, 5, 0, 105, 257, 129, 129, 515, 0, "Displacement"));
ad2460.productionitems.push(new ship(408, "Anvil", 'Corvette', 'Normal', 33600, 67200, 16800, 16800, 210, 0, 334, 0, 201, 0, 'None', 0, "These InTech corvettes are known as 'Anvils'. Largely due to their shape, but also due to their toughness and their ability to inflict damage on capital ships. Corvettes are fighters, but referred to as 'anti-C'. Anti-C comes from the term 'anti-capital-ship-capable'.<br/><br/>Corvettes will always fire on the closest capital ship, regardless of chosen tactical settings.", 420, 50, 'Matter', 160, 0, 'Matter', 0, 0, 0, 0, 0, 0, 'Matter', 420, 44, 2, 2, 5, 30, 'Matter', 130, 110, 2, 1, 1, 10, 0, 0, 0, 0, 0, 0, 92, 207, 413, 105, 105, 0, "Matter"));
ad2460.productionitems.push(new ship(409, "Blade", 'Corvette', 'Normal', 33600, 16800, 67200, 16800, 210, 0, 337, 0, 202, 0, 'None', 0, "The Blade is a StronTech corvette. It carries a crew of 3, and is equipped to deal damage to capital ships, if needed. They are still formidable fighters, and can handle several regular fighters with relative ease.<br/><br/>Corvettes will always fire on the closest capital ship, regardless of chosen tactical settings.", 285, 40, 'Energy', 510, 0, 'None', 0, 0, 0, 0, 0, 0, 'Energy', 295, 41, 3, 2, 6, 30, 'Energy', 140, 105, 1, 2, 2, 10, 0, 0, 0, 0, 0, 0, 95, 207, 105, 413, 105, 0, "Energy"));
ad2460.productionitems.push(new ship(410, "Volt", 'Corvette', 'Normal', 33600, 16800, 16800, 67200, 210, 0, 340, 0, 203, 0, 'None', 0, "This NeoTech corvette is versatile, quick and hard-hitting. It poses a real threat to the lesser capital ships, and should never be disregarded in a fight.<br/><br/>Corvettes will always fire on the closest capital ship, regardless of chosen tactical settings.", 350, 40, 'Displacement', 220, 0, 'None', 0, 0, 0, 0, 0, 0, 'Displacement', 230, 38, 4, 2, 5, 30, 'Displacement', 80, 96, 1, 3, 1, 11, 0, 0, 0, 0, 0, 0, 96, 207, 105, 105, 413, 0, "Displacement"));
ad2460.productionitems.push(new ship(411, "Outrider", 'Frigate', 'Normal', 49000, 63000, 31500, 31500, 945, 0, 334, 0, 235, 0, 'None', 0, "This InTech frigate is a versatile capital ship. It carries only a small amount of fighters, but is fast, tough, and functions very well in groups.", 4150, 100, 'Matter', 1500, 300, 'Matter', 575, 33, 2, 1, 2, 37, 'Matter', 180, 45, 1, 3, 2, 64, 'Matter', 243, 95, 1, 1, 1, 30, 0, 0, 1, 1, 0, 0, 30, 492, 633, 316, 316, 8, "Matter"));
ad2460.productionitems.push(new ship(412, "Arc", 'Frigate', 'Normal', 49000, 31500, 63000, 31500, 945, 0, 337, 0, 236, 0, 'None', 0, "This beautiful creation is a StronTech frigate. Behind its relatively lean exterior lies a fiery core that is capable of dealing deadly blows to anyone it comes up against. It is also one of the smallest and most agile of the capital ships.", 3200, 100, 'Energy', 2300, 400, 'Energy', 950, 28, 1, 1, 3, 36, 'Energy', 130, 40, 2, 2, 3, 64, 'Energy', 131, 93, 2, 1, 1, 30, 0, 0, 1, 1, 0, 0, 30, 492, 316, 633, 316, 10, "Energy"));
ad2460.productionitems.push(new ship(413, "Prime", 'Frigate', 'Normal', 49000, 31500, 31500, 63000, 945, 0, 340, 0, 237, 0, 'None', 0, "This NeoTech frigate is a great asset to any fleet. It carries only a modest fighter support, but these frigates are powerful and manoeuvrable vessels. In groups they are formidable opponents.", 3500, 100, 'Displacement', 1900, 500, 'Displacement', 900, 30, 1, 1, 2, 36, 'Displacement', 250, 37, 2, 1, 2, 64, 'Displacement', 95, 100, 1, 3, 1, 30, 0, 0, 1, 1, 0, 0, 32, 492, 316, 316, 633, 9, "Displacement"));
ad2460.productionitems.push(new ship(414, "Spearhead", 'Cruiser', 'Normal', 210000, 297500, 175000, 175000, 3780, 0, 335, 0, 204, 10, 'Matter', 0, "It doesn't look like much, but it can withstand a lot of punishment in a battle. Even for an InTech ship it is slow, but can pack a punch.", 17000, 400, 'Matter', 4400, 800, 'Matter', 1650, 42, 2, 1, 3, 60, 'Matter', 295, 38, 3, 2, 2, 80, 'Matter', 171, 90, 2, 2, 0, 32, 0, 0, 4, 1, 0, 0, 19, 1980, 2805, 1650, 1650, 14, "Matter"));
ad2460.productionitems.push(new ship(415, "Starbeamer", 'Cruiser', 'Normal', 210000, 175000, 297500, 175000, 3780, 0, 338, 0, 205, 10, 'Energy', 0, "This StronTech cruiser is known as the Starbeamer. The cruiser is a highly versatile ship with a very balanced load. C-2-C-weaponry (Capital-to-Capital) is good, but it also boasts impressive secondary weapons as well as a good covering of anti-fighter turrets. ", 11000, 300, 'Energy', 13000, 1200, 'Energy', 1700, 41, 1, 2, 3, 54, 'Energy', 295, 30, 2, 3, 3, 80, 'Energy', 225, 88, 4, 1, 0, 30, 0, 0, 4, 1, 0, 0, 20, 1980, 1650, 2805, 1650, 20, "Energy"));
ad2460.productionitems.push(new ship(416, "Infinite", 'Cruiser', 'Normal', 210000, 175000, 175000, 297500, 3780, 0, 341, 0, 206, 10, 'Displacement', 0, "The NeoTech cruiser is a formidable ship, and as a cruiser, it is a great all-round ship with massive offensive capabilities, a vast hangar for fighter support and great defensive capabilities. The Infinite is not to be messed with by lesser ships.", 15000, 300, 'Displacement', 7000, 1500, 'Displacement', 1400, 40, 3, 1, 2, 54, 'Displacement', 200, 30, 1, 5, 3, 80, 'Displacement', 158, 93, 6, 1, 0, 30, 0, 0, 4, 1, 0, 0, 22, 1980, 1650, 1650, 2805, 16, "Displacement"));
ad2460.productionitems.push(new ship(417, "Warden", 'Battleship', 'Normal', 1225000, 1575000, 700000, 700000, 7560, 0, 336, 0, 207, 20, 'Matter', 0, "This InTech battleship is known only as The Warden. There are no easy ways to deal with a ship of this size. The Warden has both a formidable arsenal as well as hangar space enough to make the fighters alone a formidable force.", 83000, 2000, 'Matter', 18000, 1500, 'Matter', 1800, 35, 3, 3, 3, 68, 'Matter', 280, 38, 5, 5, 3, 80, 'Matter', 180, 90, 2, 5, 0, 30, 0, 0, 16, 1, 0, 0, 12, 10107, 12994, 5775, 5775, 28, "Matter"));
ad2460.productionitems.push(new ship(418, "Beast", 'Battleship', 'Normal', 1225000, 700000, 1575000, 700000, 7560, 0, 339, 0, 208, 20, 'Energy', 0, "This is the pinnacle of destructive power, and whoever wields this weapon in a battle, is sure to be noticed. The StronTech battleship carries a huge arsenal of weapons and fighters. Its main guns should be avoided at all costs.", 60000, 800, 'Energy', 40000, 3000, 'Energy', 2175, 33, 4, 2, 4, 68, 'Energy', 500, 36, 3, 3, 5, 80, 'Energy', 288, 102, 3, 2, 0, 30, 0, 0, 16, 1, 0, 0, 13, 10107, 5775, 12994, 5775, 32, "Energy"));
ad2460.productionitems.push(new ship(419, "Beacon", 'Battleship', 'Normal', 1225000, 700000, 700000, 1575000, 7560, 0, 342, 0, 209, 20, 'Displacement', 0, "The Beacon is a deadly hunter with destructive capabilities that are almost unrivalled in the galaxy. As battleships go, this one is equipped for any circumstances. It even boasts unconventional side-guns to prevent anyone from coming in at its flanks.", 78000, 1000, 'Displacement', 22000, 4000, 'Displacement', 1800, 36, 5, 2, 4, 68, 'Displacement', 500, 34, 4, 2, 4, 80, 'Displacement', 194, 98, 3, 3, 0, 30, 0, 0, 16, 1, 0, 0, 15, 10107, 5775, 5775, 12994, 29, "Displacement"));
ad2460.productionitems.push(new ship(420, "Colossus", 'Carrier', 'Normal', 350000, 350000, 175000, 175000, 2520, 0, 335, 0, 210, 20, 'Matter', 0, "The Colossus is &nbsp;a massive InTech carrier ship that brings corvettes and fighters into the battle in large quantities. Having the upper hand in fighters can sometimes tip the scales of the battle.", 21000, 300, 'Matter', 3000, 500, 'Matter', 360, 25, 1, 1, 1, 72, 'Matter', 200, 33, 2, 2, 1, 80, 'Matter', 171, 105, 3, 2, 0, 30, 0, 0, 20, 1, 0, 0, 5, 1238, 1238, 619, 619, 16, "Matter"));
ad2460.productionitems.push(new ship(421, "Heron", 'Carrier', 'Normal', 350000, 175000, 350000, 175000, 2520, 0, 338, 0, 211, 20, 'Energy', 0, "This StronTech carrier hauls a huge amount of fighters and corvettes into the battle. Although not heavily armed, its cargo is of the dangerous sort.", 19000, 300, 'Energy', 5000, 600, 'Energy', 440, 22, 1, 1, 3, 72, 'Energy', 170, 30, 2, 2, 3, 80, 'Energy', 315, 88, 3, 1, 0, 30, 0, 0, 20, 1, 0, 0, 5, 1238, 619, 1238, 619, 20, "Energy"));
ad2460.productionitems.push(new ship(422, "Rivet", 'Carrier', 'Normal', 350000, 175000, 175000, 350000, 2520, 0, 341, 0, 212, 20, 'Displacement', 0, "Long, sleek and full of fighters, the NeoTech carrier is a very distinct ship. As carriers go, the ship has only a modest amount of offensive capabilities, but can take a beating if necessary.", 20000, 300, 'Displacement', 3500, 500, 'Displacement', 300, 23, 1, 1, 2, 72, 'Displacement', 250, 27, 1, 3, 1, 80, 'Displacement', 234, 89, 2, 2, 0, 30, 0, 0, 20, 1, 0, 0, 7, 1238, 619, 619, 1238, 18, "Displacement"));
ad2460.productionitems.push(new ship(423, "Hammerhead", 'Frigate', 'Normal', 66500, 122500, 45500, 45500, 1260, 0, 335, 0, 0, 31, 'Matter', 849, "The Hammerhead is a frigate designed specifically to handle damage head-on. The front of the ship has been massively reinforced and is able to withstand a lot of heavy fire.<br/><br/>This ability comes at the cost of not having a forward mounted primary weapon. To compensate for this, the Hammerhead has an array of missile bays behind its 'head' that fire an impressive amount of missiles. These missiles are small, and not the most powerful, but the sheer amount of projectiles it fires secures that a certain amount of them get past any defending fighters and actually reach their target.<br/><br/>The Hammerhead has no need to move while it is in combat, as it has a good range on its missiles.", 6000, 200, 'Matter', 0, 0, 'Matter', 0, 0, 0, 0, 0, 0, 'Matter', 185, 35, 2, 6, 2, 62, 'Matter', 180, 95, 1, 1, 0, 30, 0, 0, 0, 1, 0, 0, 20, 667, 1228, 455, 455, 10, "Matter"));
ad2460.productionitems.push(new ship(424, "Omega", 'Battleship', 'Normal', 1176000, 1470000, 637000, 637000, 6300, 0, 336, 120, 0, 51, 'Matter', 850, "The Omega is the pinnacle of the InTech vessels. Although it is smaller than the Warden, the Omega boasts an impressively powerful damage output for its size. <br/><br/>The Omega is also able to counter missiles that target it, and can take out up to 40 of these missiles each turn.<br/><br/>The Omega is especially well suited to counter smaller ships in greater numbers. It has an array of smaller primary and tertiary guns that are used to great effect on multiple targets.", 70000, 1200, 'Matter', 0, 0, 'Matter', 1700, 45, 8, 1, 5, 55, 'Matter', 300, 30, 2, 3, 3, 76, 'Matter', 270, 100, 6, 3, 0, 40, 0, 0, 8, 1, 0, 0, 18, 9702, 12128, 5256, 5256, 25, "Matter"));
ad2460.productionitems.push(new ship(425, "Scythe", 'Frigate', 'Normal', 70000, 49000, 112000, 49000, 1260, 0, 338, 0, 0, 31, 'Energy', 852, "The Scythe sweeps into the battle like no other frigate. It is tall, thin and fast. It sweeps across the battle very quickly and is a formidable upgrade to the regular StronTech frigate.<br/><br/>The Scythe is designed to be effective against cruiser-class ships.<br/><br/>The Scythe has no hangar space for minor ships.", 3000, 80, 'Energy', 2700, 500, 'Energy', 1600, 26, 1, 1, 3, 45, 'None', 0, 0, 0, 0, 0, 0, 'Energy', 100, 100, 1, 1, 0, 30, 0, 0, 0, 1, 0, 0, 37, 702, 492, 1122, 492, 25, "Energy"));
ad2460.productionitems.push(new ship(426, "The Volker", 'Cruiser', 'Normal', 385000, 140000, 665000, 210000, 3780, 0, 339, 114, 0, 51, 'Energy', 851, "Known affectionately as the Big Gun, this is a single-purpose vessel. Deal as much damage to the opposing ships as possible in huge single bursts. The Volker excels at its task.<br/><br/>Any other ship hit by the primary gun of this cruiser will instantly lose its entire shield. The shield can still recharge normally afterwards. Stripping an enemy shield is especially useful against the larger ships.<br/><br/>Damage from the Volker primary shot is calculated before the shield is stripped.", 8500, 200, 'Energy', 11000, 700, 'Energy', 6000, 20, 1, 1, 4, 61, 'None', 0, 0, 0, 0, 0, 0, 'Energy', 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 22, 3630, 1320, 6270, 1980, 35, "Energy"));
ad2460.productionitems.push(new ship(427, "Protector", 'Cruiser', 'Normal', 385000, 175000, 665000, 175000, 3780, 0, 339, 114, 0, 41, 'Energy', 853, "Mainly a defensive ship, the Protector is capable of increasing the shields of other units in its vicinity, as well as knocking out enemy fighters and corvettes with strong EMP waves.<br/><br/>Each combat round, the Protector will fire off an EMP wave. Any enemy minor ships caught in the blast might be affected by it and disabled for the remainder of the round. The range of this blast is visible in combat. If a minor ship avoids an EMP blast once, it is immune to further EMP-effects for the remainder of the round. Each Protector can only attempt to EMP a maximum of 50 minor ships per round.<br/><br/>The Protector is also able to transfer its shielding to other units nearby. It will drain its own shield in this way, but keep friendly ship shields up for longer. This effect only works for damage caused by enemy primary weapons.<br/><br/>Finally, the Protector is capable of shooting down up to 12 missiles (secondary shots) per round, but within a very limited range.<br/>", 10000, 350, 'Energy', 28000, 2500, 'Energy', 1300, 37, 1, 1, 2, 48, 'Energy', 225, 34, 4, 4, 3, 65, 'Energy', 135, 90, 3, 4, 1, 40, 0, 0, 2, 1, 3, 4, 25, 3630, 1650, 6270, 1650, 25, "Energy"));
ad2460.productionitems.push(new ship(428, "Defender", 'Cruiser', 'Normal', 343000, 301000, 91000, 665000, 3780, 0, 342, 114, 0, 41, 'Displacement', 855, "The Defender is designed to take a hit. In fact, it's designed to take a lot of them, as one of its primary functions is to act as a magnet for incoming fire, deflecting shots onto itself, and away from other capital ships.<br/><br/>Any missiles coming within the range of the defenders 'magnet' with a target in close proximity will have a 25% chance of being redirected onto the defender which then takes all the damage of the missile instead of the intended target.<br/><br/>There is no limit on the amount of missiles the defender can redirect per combat round.", 24000, 400, 'Displacement', 6000, 1500, 'Displacement', 550, 35, 1, 2, 5, 63, 'Displacement', 375, 34, 3, 4, 3, 80, 'Displacement', 198, 96, 3, 2, 0, 30, 0, 0, 0, 1, 0, 0, 20, 3234, 2838, 858, 6270, 25, "Displacement"));
ad2460.productionitems.push(new ship(429, "Gravity Well", 'Battleship', 'Normal', 840000, 420000, 420000, 2100000, 5040, 0, 342, 120, 0, 51, 'Displacement', 856, "The Gravity Well is the most destructive weapon available. It carries a black hole that is placed close to the enemy and will suck nearby ships into it once it has been activated. The gravity well ship itself separates into parts that accelerate away from the hole.<br/><br/>In combat, the gravity well will spend 3 rounds charging up their short jump engines. Once these are charged, the gravity well will jump right into the middle of the opposing fleet where it will stand stationary for 2 rounds preparing the black hole it is about to release. Once the 2 rounds have passed, the black hole effect will hit any opposing ships close to it causing a substantial amount of damage.<br/><br/>The closer an enemy ship is to the Gravity Well, the more damage it will sustain each combat round.<br/><br/>The Gravity Well itself is not affected by the black hole.<br/><br/> ", 25000, 275, 'Displacement', 15000, 5000, 'None', 0, 0, 0, 0, 0, 0, 'Displacement', 225, 38, 4, 5, 1, 80, 'Displacement', 108, 80, 5, 6, 3, 36, 0, 0, 0, 1, 2, 0, 55, 6930, 3465, 3465, 17325, 70, "Displacement"));
ad2460.productionitems.push(new ship(430, "Scout", 'Fighter', 'Probe', 1400, 700, 700, 700, 21, 0, 331, 0, 238, 0, 'None', 0, "Scout ships are invaluable assets to assess the strength of the opponent, and are almost always sent out ahead of any attack. It will return any available information about its target, unless discovered.<br/><br/>The scout ship has no ability to return to its planet of origin, and will self-destruct once it has verified that the data it has collected has been received.", 5, 1, 'None', 0, 0, 'None', 0, 10, 0, 0, 0, 9, 'None', 0, 10, 0, 0, 0, 10, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 90, 0, 0, 0, 0, 10, ""));
ad2460.productionitems.push(new ship(431, "Prospector", 'Corvette', 'Prospecting', 1400, 700, 700, 700, 21, 0, 331, 0, 0, 0, 'None', 0, "In order to find out if it is worthwhile to place an outpost around a planet, it is wise to check out what kind of resources and the abundance with which they appear on any given planet. The prospecting ship is the tool for this, and it will map entire galactic clusters at a time.<br/><br/>Once the prospecting ship has mapped out all the solar systems in the cluster, it will relay the data back to the homeworld and then self-destruct.", 40, 1, 'None', 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 78, 0, 0, 0, 0, 0, ""));
ad2460.productionitems.push(new ship(432, "Salvage Ship", 'Frigate', 'Utility', 7000, 4200, 4200, 4200, 210, 0, 332, 0, 213, 0, 'None', 0, "The salvage ship's primary task is to gather any debris left on the battlefield after a combat. Each salvage ship can then convert such debris into usable resources (max 200.000).<br/><br/>The salvage ship can be moved into mobile fleets. Defending fleets are allowed salvage, regardless of the outcome of the battle.<br/><br/>Attacking fleets can not claim salvage.<br/><br/>Any ally fleets that contain salvage ships, and are involved in battles as defending fleets, will award all their salvage only to the defending player.<br/><br/>In a combat, up to 30% of the lost ships resource-costs can be reclaimed as salvage. So if ships worth 5.000.000 resources are destroyed (both sides, added) you would need 8 salvage-ships to pick up the floating 1.500.000 resources to be reclaimed.", 3000, 1, 'None', 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 9, 9, 9, 9, 2, ""));
ad2460.productionitems.push(new ship(433, "Repair Ship", 'Frigate', 'Utility', 7000, 4200, 4200, 4200, 210, 0, 332, 0, 214, 0, 'None', 0, "Every fleet should have a repair ship enlisted. Normally ships are only repaired at the homeworld. A fleet containing a repair ship will regain 500 hull per 15 minutes, regardless of location, as long as they are not in combat. <br/><br/>Repair ships do not count towards ship total in a fleet.", 3000, 1, 'None', 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 50, 0, 0, 1, 0, 0, 0, 42, 25, 25, 25, 0, ""));
ad2460.productionitems.push(new ship(434, "Boarding Ship", 'Frigate', 'Normal', 63000, 42000, 42000, 42000, 600, 0, 332, 0, 215, 0, 'None', 0, "The boarding ship allows for you to attempt to take over one of the capital ships of the enemy and turn it against them, or perform sabotage on them directly.<br/><br/>Boarding-ships need to come within extremely close range to attempt a boarding. If they manage to stay alive long enough to do, they can have one of multiple effects on the target vessel, like setting off massive explosions inside the ship, disabling the vessels shields, or interfere with the vessels target-array to make it target allied ships. Boarding-ships will ALWAYS use the targeting-setting of Closest Ship, and usually operate in groups to increase the chance of a successful boarding.<br/>They do take a long time to get in close enough range, so they are of little use in short battles. They are considered weak against Frigates, but can be devastating against Battleships.<br/>To defend against these units, targeting Closest Ship is a good idea.<br/><br/>This unit is considered a late-game-unit, and has little use at an early stage. Learning how to use these cleverly will give you a real advantage.", 2500, 80, 'None', 500, 220, 'Combined', 0, 0, 1, 1, 0, 5, 'None', 0, 0, 0, 0, 0, 0, 'Combined', 270, 110, 1, 2, 1, 20, 0, 0, 0, 1, 0, 0, 70, 633, 421, 421, 421, 2, ""));
ad2460.productionitems.push(new ship(435, "Small Transport", 'Frigate', 'Utility', 3500, 2100, 2100, 2100, 84, 0, 331, 0, 239, 0, 'None', 0, "Transports are used to carry resources back to your homeworld after raiding other players.<br/>This is the smallest version, and it can hold up to 25 000 resource-units.", 750, 50, 'None', 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 25000, 0, 1, 0, 0, 0, 22, 13, 13, 13, 5, ""));
ad2460.productionitems.push(new ship(436, "Large Transport", 'Cruiser', 'Utility', 24500, 17500, 17500, 17500, 210, 0, 332, 0, 216, 0, 'None', 0, "The large transport ship is an advanced version of the basic transport, and can handle a much higher volume of resources. ", 3000, 75, 'None', 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 200000, 0, 1, 0, 0, 0, 145, 105, 105, 105, 10, ""));
ad2460.productionitems.push(new ship(437, "Adamant", 'Cruiser', 'Normal', 210000, 245000, 140000, 140000, 3780, 0, 335, 114, 0, 41, 'Matter', 821, "This InTech cruiser has a defensive orientation, and can shoot down incoming secondary fire within its range. <br/><br/>Unlike a minor ship, this vessel can shoot down up to 35 missiles per turn. <br/><br/>It is also equipped with strong secondary missiles.", 10000, 300, 'Matter', 3000, 500, 'Matter', 0, 175, 0, 0, 0, 20, 'Matter', 300, 50, 4, 4, 3, 80, 'Matter', 135, 115, 3, 2, 0, 30, 0, 0, 4, 1, 6, 0, 9, 1980, 2310, 1320, 1320, 15, "Matter"));
ad2460.productionitems.push(new ship(438, "Outpost Lvl 1", 'None', 'Satelite', 5600, 3500, 3500, 3500, 126, 0, 331, 0, 232, 0, 'None', 0, "This is the basic outpost. It will allow for resource extraction from dead worlds.", 1, 1, 'None', 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ""));
ad2460.productionitems.push(new ship(439, "Outpost Lvl 4", 'None', 'Satelite', 52500, 35000, 35000, 35000, 1260, 0, 332, 0, 233, 0, 'None', 0, "The Level 4 advanced outpost is superior to the previous versions of the outpost, and allows for a much higher resource output.", 1, 1, 'None', 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ""));
ad2460.productionitems.push(new ship(440, "Outpost Lvl 7", 'None', 'Satelite', 350000, 210000, 210000, 210000, 2520, 0, 333, 0, 234, 0, 'None', 0, "The level 7 outpost, is a further advancement on the previous levels of the outpost. Resource extraction is &nbsp;again increased drastically.", 1, 1, 'None', 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 'None', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ""));
ad2460.productionitems.push(new ship(441, "Light Frigate", 'Frigate', 'Normal', 10500, 10500, 10500, 10500, 210, 0, 0, 0, 238, 0, 'None', 0, "This is the basic military vessel. It is popularly known as 'The Frigette' due to its relatively small size. It works well enough, but is rather unimpressive once research into the other technologies have begun.", 2000, 70, 'Combined', 275, 80, 'Combined', 400, 25, 1, 1, 1, 36, 'Combined', 150, 40, 1, 2, 1, 60, 'Combined', 72, 90, 2, 2, 1, 20, 0, 0, 1, 1, 0, 0, 23, 168, 168, 168, 168, 5, ""));
ad2460.productionitems.push(new ship(442, "Vanguard", 'Frigate', 'Normal', 49000, 63000, 31500, 31500, 945, 0, 335, 0, 240, 10, 'Matter', 0, "The Vanguard is a specialised version of the Outrider designed to lay down suppressive fire against incoming fighters and corvettes.<br/><br/>The Vanguard, living up to its name working the forefront of the battle line, securing the space ahead for the main fleet, removing smaller 'obstacles' blocking the forward path.<br/><br/>The Vanguard is equipped only with a primary weapon and anti-fighter guns. Given the usual opposition, better range and higher accuracy is usually the only deterrent needed.", 4150, 100, 'Matter', 1000, 250, 'Matter', 520, 30, 1, 1, 1, 37, 'Matter', 200, 50, 1, 2, 1, 50, 'Matter', 200, 120, 5, 2, 2, 33, 0, 0, 1, 1, 0, 0, 30, 492, 633, 316, 316, 6, "Matter"));
ad2460.productionitems.push(new ship(443, "Rapphire", 'Frigate', 'Normal', 49000, 31500, 63000, 31500, 945, 0, 338, 0, 241, 10, 'Energy', 0, "The Rapphire is a new addition to the StronTech fleet, and is a frigate primarily designed for taking out incoming fighters and corvettes.<br/><br/>The Rapphire is in many ways similar to its origin ship, the Arc, but has been stripped of all missile weapons, and is instead focused on anti-fighter guns. A huge motion array at the front of the ship gives it superior targeting abilities. Along with an impressive rate of fire, this ship will cause trouble for even the most seasoned fighter pilots.<br/><br/>The Rapphire also has, at the cost of shot power, great range, allowing it to remain behind other frigates in battle.", 3200, 100, 'Energy', 2000, 300, 'Energy', 550, 32, 1, 1, 3, 37, 'Energy', 200, 50, 1, 2, 1, 50, 'Energy', 125, 120, 4, 6, 5, 33, 0, 0, 1, 1, 0, 0, 30, 492, 316, 633, 316, 8, "Energy"));
ad2460.productionitems.push(new ship(444, "Glimmer", 'Frigate', 'Normal', 49000, 31500, 31500, 63000, 945, 0, 341, 0, 242, 10, 'Displacement', 0, "The Glimmer is based on the Prime frigate, but slightly modified and fitted to take on mostly fighters and corvettes.<br/><br/>The Glimmer is a hard-hitter when it comes to smaller ships. It is impressively accurate, and deals a formidable amount of damage with each shot, thus ensuring the destruction of both incoming fighters and corvettes.<br/><br/>The Glimmmer is also a very fast ship, and will plunge headlong into the oncoming minor ships once the action begins.", 3500, 100, 'Displacement', 1500, 500, 'Displacement', 480, 35, 1, 1, 1, 37, 'Displacement', 200, 50, 1, 2, 1, 50, 'Displacement', 300, 110, 4, 2, 2, 33, 0, 0, 1, 1, 0, 0, 32, 492, 316, 316, 633, 10, "Displacement"));
ad2460.productionitems.push(new ship(499, "Ancient Station", 'Battleship', 'Satelite', 7000000, 7000000, 7000000, 7000000, 6048000, 0, 0, 0, 0, 255, 'General', 1999, "These mysterious ancient stations have been found sharing the orbit of certain planets around the galaxy.<br/><br/>Most engineers agree that there is a connection between these stations and the jumpgates. Although the station can be operated, many of it's systems are operating automatically and no one has been able to figure out how everything works.<br/><br/>The ancient station has some impressive defensive abilities, and ownership of one is considered of prime tactical importance.", 10000000, 2000, 'None', 0, 0, 'Combined', 4500, 40, 10, 1, 3, 120, 'None', 0, 0, 0, 0, 0, 0, 'Combined', 160, 125, 20, 4, 2, 50, 0, 0, 0, 1, 0, 0, 0, 37125, 37125, 37125, 37125, 0, ""));
ad2460.productionitems.push(new ship(501, "Projectile Cannon", 'Frigate', 'Satelite', 10500, 10500, 7000, 7000, 126, 0, 334, 0, 217, 0, 'None', 0, "Anti-frigate turrets with InTech ammo.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or outposts.", 1700, 50, 'Matter', 350, 350, 'Matter', 550, 42, 1, 1, 1, 65, 'Matter', 0, 0, 0, 0, 0, 0, 'Matter', 72, 85, 1, 1, 1, 35, 0, 0, 0, 0, 0, 0, 0, 54, 54, 35, 35, 0, "Matter"));
ad2460.productionitems.push(new ship(502, "Plasma Cannon", 'Frigate', 'Satelite', 10500, 7000, 10500, 7000, 126, 0, 337, 0, 218, 0, 'None', 0, "Anti-frigate turrets using super-heated plasma-rounds.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 1500, 50, 'Energy', 450, 450, 'Energy', 650, 39, 1, 1, 1, 65, 'Energy', 0, 0, 0, 0, 0, 0, 'Energy', 72, 85, 1, 1, 1, 35, 0, 0, 0, 0, 0, 0, 0, 54, 35, 54, 35, 0, "Energy"));
ad2460.productionitems.push(new ship(503, "Ion Cannon", 'Frigate', 'Satelite', 10500, 7000, 7000, 10500, 126, 0, 340, 0, 219, 0, 'None', 0, "Anti-frigate turrets firing ionised NeoTech rounds.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 1600, 50, 'Displacement', 400, 400, 'Displacement', 600, 40, 1, 1, 1, 65, 'Displacement', 0, 0, 0, 0, 0, 0, 'Displacement', 72, 85, 1, 1, 1, 35, 0, 0, 0, 0, 0, 0, 0, 54, 35, 35, 54, 0, "Displacement"));
ad2460.productionitems.push(new ship(504, "InTech Shield-booster", 'Frigate', 'Satelite', 16800, 16800, 16800, 16800, 210, 0, 334, 0, 220, 5, 'Matter', 0, "This orbital satellite boosts the shielding of any friendly capital units. It works by using its multiple shield generators in a targeted way, and firing it at the target, boosting its shield.<br/><br/>The shield booster will regenerate up to 500 shield points per round distributed evenly on any capital ships on the battlefield that do not have their shields at full value.<br/><br/>Shield boosters are also equipped with anti-missile systems, and are able to attempt to shoot down up to 3 missiles within range per round.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 1800, 150, 'Matter', 350, 350, 'None', 0, 125, 0, 0, 0, 14, 'None', 0, 0, 0, 0, 0, 0, 'Matter', 180, 90, 1, 2, 1, 36, 0, 0, 0, 0, 1, 0, 0, 75, 75, 50, 50, 3, "Matter"));
ad2460.productionitems.push(new ship(505, "StronTech Shield-booster", 'Frigate', 'Satelite', 16800, 16800, 16800, 16800, 210, 0, 337, 0, 221, 5, 'Energy', 0, "This orbital satellite increases the shielding of any friendly capital units. It works by mounted shield projectors that effectively fire shielding charges at its target, boosting its shield.<br/><br/>The shield booster will regenerate up to 500 shield points per round distributed evenly on any capital ships on the battlefield that do not have their shields at full value.<br/><br/>Shield boosters are also equipped with anti-missile systems, and are able to attempt to shoot down up to 3 missiles within range per round.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 1550, 100, 'Energy', 650, 500, 'None', 0, 125, 0, 0, 0, 14, 'None', 0, 0, 0, 0, 0, 0, 'Energy', 180, 90, 1, 2, 1, 36, 0, 0, 0, 0, 1, 0, 0, 75, 50, 75, 50, 4, "Energy"));
ad2460.productionitems.push(new ship(506, "NeoTech Shield-booster", 'Frigate', 'Satelite', 16800, 16800, 16800, 16800, 210, 0, 340, 0, 222, 5, 'Displacement', 0, "This orbital satellite augments the shielding of any friendly capitals units in the battle. By aiming its field-shielding generators at a friendly vessel, it effectively performs a recharge of that unit's shields.<br/><br/>The shield booster will regenerate up to 500 shield points per round distributed evenly on any capital ships on the battlefield that do not have their shields at full value.<br/><br/>Shield boosters are also equipped with anti-missile systems, and are able to attempt to shoot down up to 3 missiles within range per round.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 1650, 125, 'Displacement', 400, 600, 'None', 0, 125, 0, 0, 0, 14, 'None', 0, 0, 0, 0, 0, 0, 'Displacement', 180, 90, 1, 2, 1, 36, 0, 0, 0, 0, 1, 0, 0, 75, 50, 50, 75, 3, "Displacement"));
ad2460.productionitems.push(new ship(507, "InTech Artillery", 'Frigate', 'Satelite', 28000, 28000, 17500, 17500, 420, 0, 334, 0, 223, 10, 'Matter', 0, "Heavy orbital artillery able to damage capital ships. Uses InTech rounds.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 4000, 150, 'Matter', 1750, 400, 'Matter', 320, 35, 1, 1, 3, 90, 'Matter', 400, 28, 1, 2, 3, 88, 'Matter', 135, 80, 1, 2, 1, 37, 0, 0, 0, 0, 0, 0, 0, 143, 143, 107, 107, 5, "Matter"));
ad2460.productionitems.push(new ship(508, "StronTech Artillery", 'Frigate', 'Satelite', 28000, 17500, 28000, 17500, 420, 0, 337, 0, 224, 10, 'Energy', 0, "Heavy orbital guns able to damage capital ships. Fires StronTech rounds.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 3500, 150, 'Energy', 2250, 500, 'Energy', 360, 33, 1, 1, 3, 90, 'Energy', 300, 27, 1, 3, 4, 88, 'Energy', 135, 80, 1, 2, 1, 37, 0, 0, 0, 0, 0, 0, 0, 143, 107, 143, 107, 5, "Energy"));
ad2460.productionitems.push(new ship(509, "NeoTech Artillery", 'Frigate', 'Satelite', 28000, 17500, 17500, 28000, 420, 0, 340, 0, 225, 10, 'Displacement', 0, "Massive orbital cannons able to take out capital ships using NeoTech rounds.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 3750, 150, 'Displacement', 2000, 450, 'Displacement', 340, 32, 1, 1, 3, 90, 'Displacement', 350, 25, 1, 2, 2, 88, 'Displacement', 135, 80, 1, 2, 1, 37, 0, 0, 0, 0, 0, 0, 0, 143, 107, 107, 143, 5, "Displacement"));
ad2460.productionitems.push(new ship(510, "InTech Defence-station", 'Cruiser', 'Satelite', 126000, 126000, 101500, 101500, 2520, 0, 335, 0, 226, 20, 'Matter', 0, "A small battle station. Has both artillery and flak turrets. Fires InTech rounds.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 15500, 300, 'Matter', 4500, 1500, 'Matter', 1100, 30, 1, 2, 2, 80, 'Matter', 340, 35, 2, 3, 0, 80, 'Matter', 180, 95, 2, 3, 1, 38, 0, 0, 0, 0, 0, 0, 0, 641, 641, 535, 535, 12, "Matter"));
ad2460.productionitems.push(new ship(511, "StronTech Defence-station", 'Cruiser', 'Satelite', 126000, 101500, 126000, 101500, 2520, 0, 338, 0, 227, 20, 'Energy', 0, "A small orbital battle station with StronTech weapons for defence of the homeworld.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 13500, 300, 'Energy', 6500, 2000, 'Energy', 1250, 30, 1, 2, 4, 80, 'Energy', 300, 30, 2, 4, 0, 80, 'Energy', 180, 95, 2, 3, 1, 38, 0, 0, 0, 0, 0, 0, 0, 641, 535, 641, 535, 16, "Energy"));
ad2460.productionitems.push(new ship(512, "NeoTech Defence-station", 'Cruiser', 'Satelite', 126000, 101500, 101500, 126000, 2520, 0, 341, 0, 228, 20, 'Displacement', 0, "A minor battle station. Anti-fighter turrets and large cannons allow the station to support fleets in the event of an attack. Uses NeoTech weapons.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 14500, 300, 'Displacement', 5500, 1750, 'Displacement', 900, 30, 3, 1, 3, 80, 'Displacement', 280, 32, 3, 3, 0, 80, 'Displacement', 180, 95, 2, 3, 1, 38, 0, 0, 0, 0, 0, 0, 0, 641, 535, 535, 641, 14, "Displacement"));
ad2460.productionitems.push(new ship(513, "InTech Battle-station", 'Battleship', 'Satelite', 595000, 595000, 455000, 455000, 3780, 0, 336, 0, 229, 30, 'Matter', 0, "The InTech battle-station is a massive floating fortress. It has the capacity to withstand huge amounts of incoming damage, while at the same time delivering formidable amounts of damage to the opposing ships.<br/><br/>The battle-station is the most destructive homeworld defence unit available. The InTech battle-station can withstand more punishment than any other battle-station.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 80000, 450, 'Matter', 25000, 3000, 'Matter', 2300, 30, 2, 3, 2, 80, 'Matter', 350, 32, 4, 4, 0, 88, 'Matter', 270, 100, 4, 3, 1, 40, 0, 0, 0, 0, 0, 0, 0, 3029, 3029, 2673, 2673, 18, "Matter"));
ad2460.productionitems.push(new ship(514, "StronTech Battle-station", 'Battleship', 'Satelite', 595000, 455000, 595000, 455000, 3780, 0, 339, 0, 230, 30, 'Energy', 0, "The StronTech battle-station is an imposing construction on its own. This battle-station is also the most destructive one of them all. <br/><br/>Very few captains feel comfortable being on the wrong side of the battlefield when one or more of these floating fortresses are involved.<br/><br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 70000, 450, 'Energy', 35000, 4000, 'Energy', 2200, 30, 3, 2, 4, 80, 'Energy', 280, 30, 5, 4, 0, 88, 'Energy', 270, 100, 4, 3, 1, 40, 0, 0, 0, 0, 0, 0, 0, 3029, 2673, 3029, 2673, 20, "Energy"));
ad2460.productionitems.push(new ship(515, "NeoTech Battle-station", 'Battleship', 'Satelite', 595000, 455000, 455000, 595000, 3780, 0, 342, 0, 231, 30, 'Displacement', 0, "The NeoTech battle-station can only be described as a beautiful beast. The combination of massive weapons, impressive hull and a shield that just won't give in, makes the NeoTech battle-station extremely hard to beat.<br/><br/>A battle station like this is absolutely worth its salt in any defensive fight.<br/><br/>Orbital defence units are automatically placed in your base fleet, and can only be used for defending your homeworld or your outposts.", 75000, 450, 'Displacement', 30000, 4500, 'Displacement', 1500, 30, 3, 3, 3, 80, 'Displacement', 400, 28, 7, 2, 0, 88, 'Displacement', 270, 100, 4, 3, 1, 40, 0, 0, 0, 0, 0, 0, 0, 3029, 2673, 2673, 3029, 19, "Displacement"));
ad2460.techitems.push(new techitem(800, "Focused Research and Production", "Reduces production-time of all units by 1% per point allocated.<br/>Also decreases all research-times by 1% per point allocated.", 1, "Matter", 0, 5, 1122, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(801, "InTech Weapons Focus", "Increases all InTech weapons damage by 1% of base value per point allocated.", 1, "Matter", 0, 5, 1105, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(802, "Advanced Hull Materials", "Increases all capital ships hull values by 1% of base value per point allocated.", 1, "Matter", 0, 5, 1102, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(811, "Capital Ships Missiles", "Increases the secondary damage of InTech based capital ships by 2% of base value per point allocated.", 2, "Matter", 10, 5, 1102, 2, 4, 6, 8, 10, 0, 0, 0));
ad2460.techitems.push(new techitem(812, "InTech Capital Ship Primary Weapon Upgrade", "Increases the primary weapon-damage of InTech based capital ships by 1% of base value per point allocated.", 2, "Matter", 10, 5, 1105, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(831, "Improved Homeworld Refinement", "Homeworld refinement is increased by 20 % per point allocated.", 2, "Matter", 10, 5, 1155, 20, 40, 60, 80, 100, 0, 0, 0));
ad2460.techitems.push(new techitem(823, "Homeworld Protection Act", "All PDS units are upgraded with tougher plating and heavier missile payloads and more specialised shield generators.<br/>Shield efficiency versus NeoTech weapons is increased by 5% per point.<br/>Unit absorb is increased by 2% of base value per point.<br/>Secondary weapon damage is increased by 2% of base value.<br/>These bonuses apply to all InTech defence units.", 3, "Matter", 20, 5, 1101, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(832, "Retribution Insurance", "PDS units are fitted with thicker plating, and more efficient primary weapon power generators. The effect of this is a 5% increase base hull values and a 2% increase in primary weapons firepower base value per point spent.<br/>This affects all InTech defence units.", 3, "Matter", 20, 5, 1127, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(848, "Vulture Fighter", "Enables the construction of the Vulture InTech fighter. <br/><br/>Facility requirements have to be met in order to start production.", 3, "Matter", 20, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(809, "Minor Ship Hull Upgrade", "Increases the hull values of all minor ships by 5% of base value per point allocated.", 4, "Matter", 30, 5, 1102, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(810, "Improved Light InTech Weapons", "Increases the firepower of InTech based minor ships by 5% of base value per point allocated.", 4, "Matter", 30, 5, 1105, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(830, "Fortification", "Commander-effect: InTech Units might be able to handle a few moments where the InTech structural field generators are running beyond their normal limitations. In combat, this results in 33% less damage for 2 turns. Usable only once per combat at the commanders discretion.", 4, "Matter", 30, 1, 1102, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(849, "Hammerhead War Frigate", "Enable the construction of the Hammerhead InTech frigate. <br/><br/>Facility requirements have to be met in order to start production.", 4, "Matter", 30, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(821, "The Adamant", "Enables the construction of the Adamant cruiser. <br/><br/>Facility requirements have to be met in order to start production.", 5, "Matter", 40, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(840, "Impact Hardening", "All your InTech capital ships hulls are upgraded with impact hardening hull plates. These plates increase in hardness when heated from impacting weapons fire, and add 2% to the ships hull absorption rating (of base value) per hit per point, up to a 100% bonus. Once it reaches 100%, the plates are saturated, and the effect is lost for the remainder of the combat.", 5, "Matter", 40, 5, 1112, 10, 20, 30, 40, 50, 0, 0, 0));
ad2460.techitems.push(new techitem(841, "Enhanced Absorption", "By adding a newly discovered compound to the metal mix of the hull plating, and applying electrical current in key locations of the hull, scientists have been able to make the hull absorb more than previously possible.<br/>Carriers, Cruisers and Battleships will take 2% less hull-damage per point applied.", 5, "Matter", 40, 5, 1110, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(822, "InTech Production Efficiency", "Reduces production time of InTech based ships by 5% per point allocated.", 6, "Matter", 50, 5, 1120, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(839, "Battleship Primary Range", "Increases primary weapon range for all InTech battleships by 1 per point allocated.", 6, "Matter", 50, 5, 1132, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(850, "Omega Battleship", "Enables the construction of the Omega InTech battleship. <br/><br/>Facility requirements have to be met in order to start production.", 6, "Matter", 50, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(803, "Focused Research and Production", "Reduces production-time of all units by 1% per point allocated.<br/>Also decreases all research-times by 1% per point allocated.", 1, "Energy", 0, 5, 1122, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(804, "StronTech Weapons Focus", "Increases all StronTech weapons damage by 1% of base value per point allocated.", 1, "Energy", 0, 5, 1105, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(805, "Advanced Shield Generators", "Increases all capital ships shield values by 1% of base value per point allocated.", 1, "Energy", 0, 5, 1101, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(815, "StronTech Capital Ship Shield Upgrade", "Increases the shield value of all StronTech based capital ships by 2% of base value per point allocated.", 2, "Energy", 10, 5, 1101, 2, 4, 6, 8, 10, 0, 0, 0));
ad2460.techitems.push(new techitem(816, "StronTech Capital Ship Primary Weapon Upgrade", "Increases the primary weapon-damage of StronTech based capital ships by 1% of base value per point allocated.", 2, "Energy", 10, 5, 1105, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(834, "Improved Refinement", "Homeworld refinement is increased by 20 % per point allocated.", 2, "Energy", 10, 5, 1155, 20, 40, 60, 80, 100, 0, 0, 0));
ad2460.techitems.push(new techitem(824, "Bolt Fighters", "Enables the construction of the Bolt fighter. <br/><br/>Facility requirements have to be met in order to start production.", 3, "Energy", 20, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(826, "Strategic Defence Act", "All PDS Units are upgraded with tougher plating and heavier missile payloads and more specialised shield generators.<br/>Shield efficiency versus InTech weapons is increased by 5% per point.<br/>Unit hull is increased by 5% of base value per point.<br/>Secondary weapon damage is increased by 2% of base value.<br/>These bonuses apply to all StronTech defensive units.", 3, "Energy", 20, 5, 1101, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(835, "Protective Power Enactment", "PDS units are fitted with new, powerful generators that increase shields by 10% and primary weapon damage by 2% of their base values per point spent.<br/>This bonus applies to all StronTech defence units.<br/>", 3, "Energy", 20, 5, 1127, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(813, "Minor Ship Shields Upgrade", "Increases the shield value of all minor ships by 5% of base value per point allocated.", 4, "Energy", 30, 5, 1101, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(814, "Improved Light StronTech Weapons", "Increases the firepower of all StronTech based minor ships by 5% of base value per point allocated.", 4, "Energy", 30, 5, 1105, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(833, "Devastation", "Commander-effect: By channeling extra power to the primary weapon-systems, it should be possible for StronTech capital units to add 25 % extra yield for 2 turns without burning them out. Usable only once per combat at the commanders discretion.", 4, "Energy", 30, 1, 1107, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(852, "The Scythe", "Enables the construction of the Scythe StronTech frigate. <br/><br/>Facility requirements have to be met in order to start production.", 4, "Energy", 30, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(843, "Directed Profusion", "StronTech capital ships weapons generate energy in the act of firing, and you can now harness this energy and redirect it back into the weapon. Every primary or secondary shot has a 10% chance of yielding 10% extra damage per point allocated.", 5, "Energy", 40, 5, 1105, 10, 20, 30, 40, 50, 0, 0, 0));
ad2460.techitems.push(new techitem(844, "EMP Surge", "Each primary weapon shot from any StronTech-based cruiser or battleship class unit has a 5% chance per point of causing an EMP surge in the target unit, disabling it for the remainder of the round.", 5, "Energy", 40, 5, 1107, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(853, "The Protector", "Enables the construction of the Protector StronTech cruiser. <br/><br/>Facility requirements have to be met in order to start production.", 5, "Energy", 40, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(825, "StronTech Production Efficiency", "Reduces production time of StronTech based ships by 5% per point allocated.", 6, "Energy", 50, 5, 1120, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(842, "Frigate Primary Range", "Increases primary weapon range for all StronTech frigates by 1 per point allocated.", 6, "Energy", 50, 5, 1132, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(851, "The Big Gun", "Enables the construction of the The Volker, a powerful StronTech cruiser. <br/><br/>Facility requirements have to be met in order to start production.", 6, "Energy", 50, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(806, "Focused Research and Production", "Reduces production-time of all units by 1% per point allocated.<br/>Also decreases all research-times by 1% per point allocated.", 1, "Displacement", 0, 5, 1122, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(807, "NeoTech Weapons Focus", "Increases all NeoTech weapons damage by 1% of base value per point allocated.", 1, "Displacement", 0, 5, 1105, 1, 2, 3, 4, 5, 66151, 807, 5));
ad2460.techitems.push(new techitem(808, "Advanced Propulsion Systems", "Increases all capital ships manoeuvrability values by 1 of base value per point allocated.", 1, "Displacement", 0, 5, 1103, 1, 2, 3, 4, 5, 66151, 808, 5));
ad2460.techitems.push(new techitem(819, "Improved NeoTech Capital Ship Maneuvrability", "Increases the maneuverability of all NeoTech capital ships by 1 per point allocated.", 2, "Displacement", 10, 5, 1103, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(820, "NeoTech Capital Ship Primary Weapon Upgrade", "Increases the primary weapon-damage of NeoTech based capital ships by 1% per point allocated.", 2, "Displacement", 10, 5, 1105, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(837, "Improved Refinement", "Homeworld refinement is increased by 20 % per point allocated.", 2, "Displacement", 10, 5, 1155, 20, 40, 60, 80, 100, 0, 0, 0));
ad2460.techitems.push(new techitem(827, "Blink Fighter", "Enables the construction of the Blink Fighter. <br/><br/>Facility requirements have to be met in order to start production.", 3, "Displacement", 20, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(829, "Protectionist Initiative", "All PDS Units are upgraded with heavier missile payloads and more specialised shield generators.<br/>Shield efficiency versus StronTech weapons is increased by 5% per point.<br/>Secondary weapon damage is increased by 2% of base value per point.<br/>These bonuses apply to all NeoTech defensive units.", 3, "Displacement", 20, 5, 1101, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(838, "Defensive Versatility Program", "A reworking of the major components of the PDS units are done, resulting in a 2% hull, 5% shield, and a 2% primary weapons firepower increase (of base value) per point spent.<br/>This bonus affects all NeoTech PDS units.", 3, "Displacement", 20, 5, 1127, 1, 2, 3, 4, 5, 0, 0, 0));
ad2460.techitems.push(new techitem(817, "Minor Ship Maneuvrability Upgrade", "Increases the manoeuvrability of all minor ships by 3 per point allocated.", 4, "Displacement", 30, 5, 1103, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(818, "Improved Light NeoTech Weapons", "Increases the firepower of all NeoTech based minor ships by 5% per point allocated.", 4, "Displacement", 30, 5, 1105, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(836, "Defensive Negation Effect", "Commander-effect: By redirecting brief bursts of extra power to the navigational thrust, all NeoTech capital units can have a 40% chance to avoid any shot for 2 rounds. This happens before any other hit calculations. Defenders and minor ships disregard this effect when shooting or attracting missiles. Usable only once per combat at the commanders discretion.", 4, "Displacement", 30, 1, 1103, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(854, "Ghost", "Enables the construction of the Ghost NeoTech corvette. <br/><br/>Facility requirements have to be met in order to start production.", 4, "Displacement", 30, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(846, "Gravity Payload", "Special shield impact effect enhancers are added to the secondary weapons of all NeoTech units. On a successful hit, these cause a massive gravitational effect on the shields of its target, causing it to inflict NeoTech damage on any adjacent ships shields. The damage inflicted in this way is 10% of the initial weapon damage per point allocated. Only shields are affected by this damage.", 5, "Displacement", 40, 5, 1105, 10, 20, 30, 40, 50, 0, 0, 0));
ad2460.techitems.push(new techitem(847, "Field Conduction", "NeoTech shields are now able to use their field shifting technologies to actively displace incoming primary weapon fire. This type of field displacement allows the shield to re-harness some of the energy from the incoming fire to recharge itself.<br/>Each point allocated gives a 3% chance to convert incoming shield damage to shield recharge.", 5, "Displacement", 40, 5, 1115, 10, 20, 30, 40, 50, 0, 0, 0));
ad2460.techitems.push(new techitem(855, "Defender", "Enables the construction of the Defender NeoTech cruiser. <br/><br/>Facility requirements have to be met in order to start production.", 5, "Displacement", 40, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(828, "NeoTech Production Efficiency", "Reduces production time of NeoTech based ships by 5% per point allocated.", 6, "Displacement", 50, 5, 1120, 5, 10, 15, 20, 25, 0, 0, 0));
ad2460.techitems.push(new techitem(845, "Cruiser Primary Range", "Increases primary weapon range for all NeoTech cruiser-class ships by 1 per point allocated.", 6, "Displacement", 50, 5, 1132, 0, 0, 0, 0, 0, 0, 0, 0));
ad2460.techitems.push(new techitem(856, "Gravity Well", "Enables the construction of the Gravity Well NeoTech battleship.<br/><br/>Facility requirements have to be met in order to start production.", 6, "Displacement", 50, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0));


		window.onkeydown = function(e) {
			if (e.keyCode == 9 || e.which == 9) {
				e.preventDefault();
				return false;
			}
		}

		updateTierData();

		setInterval ( function(){createComet()}, 90000 );
		setInterval ( function(){createBlink()}, 250000 );
		setInterval ( function(){createNebula()},120000 );
		setInterval ( function(){handleTimers()}, 1000 );
		//setInterval ( 'updateMoonTest()', 1000 );
		setInterval ( 'updateMoonNew()', 60000 );

		setInterval('checkForQueuedFeedback()',1000);
		setInterval('updateServerTime()',30000);
		setInterval('reRenderRecentThreads()',60000);
		setInterval('updateSelectedOutpostAbandonTime()',60000);

		setInterval('loadMissionsData()',300000);
		setInterval(function(){
			if (ad2460.combatListener.enabled==false) {
				loadAllIntel();fetchPlayerLinks();
			}
		},50000);

		setTimeout("checkUnclaimedTechPoints('player_update',1)",3000);
		setTimeout('specialNewLoadClusterContent(ad2460.homeworld.quadrant, ad2460.homeworld.sector, ad2460.homeworld.cluster)',5000);
		var rankingsTimeout=setTimeout('reloadRankings()',2000);

		setTimeout("fetchSessionData()",30000);

		var rankingsInterval=setInterval('reloadRankings()', 180000 ); // every 3 minutes, which means 120 K even after compressing
		ad2460.admin_status=0;

		var pUpdatesInterval=	setInterval ( function(){fetchPlayerUpdates()}, 180000 );
		var newConvInterval=	setInterval ( function(){fetchNewConversations()}, 10000 );
		//var allConvInterval=	setInterval ( function(){fetchConversations()}, 120000 );

		var prospectInterval=	setInterval ( function(){checkProspectingMissions()}, 20000 );
		var fleetMoveInterval=	setInterval ( function(){updateFleetMoveEtas()}, 30000 );
		var latestThreadsInterval=	setInterval ( function(){renderLatestThreads()}, 60000 );
		var intelInterval=		setInterval ( function(){checkCompletedIntel()}, 1000 );
		var reloadFlagInterval=setInterval ( function(){checkReloadFleetFlag()}, 10000 );
		var reloadCombatLogsInterval=setInterval ( function(){loadCombatLogs()}, 180000 );
		var renderCombatLogsInterval=setInterval ( function(){renderCombatLogList()}, 60000 );
		var renderEconomyInterval=setInterval ( function(){renderEconomyOverview()}, 60000 );
		var outpostInterval=	setInterval ( function(){ fetchOwnOutposts()  }, 300000 );
		var detectedEventsInterval=setInterval(function(){detectEvents()} ,5000);
		var unclaimedTechpointsInterval=	setInterval ( function(){ processUnclaimedTechPoints();processUndisplayedTechPoints();highLightTechTreeButton();  }, 5000 );
		var unclaimedTechpointsInterval2=	setInterval ( function(){ checkUnclaimedTechPoints('player_update',1); checkUnclaimedTechPoints('player_update',2); checkUnclaimedTechPoints('player_update',3); checkUnclaimedTechPoints('player_update',4); checkUnclaimedTechPoints('player_update',5); checkUnclaimedTechPoints('player_update',6); checkUnclaimedTechPoints('player_update',7); checkUnclaimedTechPoints('player_update',8); checkUnclaimedTechPoints('player_update',9); checkUnclaimedTechPoints('player_update',10); checkUnclaimedTechPoints('player_update',11); checkUnclaimedTechPoints('player_update',12); checkUnclaimedTechPoints('player_update',13); checkUnclaimedTechPoints('player_update',14); checkUnclaimedTechPoints('player_update',15); checkUnclaimedTechPoints('player_update',16); checkUnclaimedTechPoints('player_update',17); checkUnclaimedTechPoints('player_update',18); checkUnclaimedTechPoints('player_update',19);  }, 20000 );

		setInterval ( function(){
			if (ad2460.allianceData.lastAllianceMenuSelected=='stations') {
				allianceManagementStationsSettingsClick();
			}
			if (ad2460.allianceData.lastAllianceMenuSelected=='bank') {
				allianceManagementAllianceBankClick();
			}
		}, 900000 );

		//var undisplayedTechpointsInterval=	setInterval ( function(){ processUndisplayedTechPoints()  }, 5000 );
		grace_time_interval=setInterval(function(){ updateGraceTimer()  }, 30000 );
		//renderProspectingMissions?

		
		setInterval ( function(){reloadAllianceData()}, 120000 );
	

		loadAllIntel();
		updateMilitaryOverview();
		loadCombatLogs();
		initVolume();
		setTimeout('updateGraceTimer()',3000);
		setTimeout('loadMissionsData()',2000);
		loadDetectedEvents();

		if (ad2460.audioVars.musicVolume>0) {
			//document.getElementById('music').volume=ad2460.audioVars.musicVolume;
			//document.getElementById('music').play();
		}


		window.onblur=function(){ad2460.lastBlur=new Date;}
		window.onfocus=function(){
			ad2460.lastFocus=new Date;
			handleIdleTime(Math.floor((ad2460.lastFocus-ad2460.lastBlur)/1000));
		}



		$('#reserve_fleet_button').click(
			function() {
				selectStorageFleet();
			}
		);

		$('#forumopenbutton').click(
			function() {
				//play_multi_sound('sfx_quickslide');
			}
		);
		$('#production').click(
			function() {
			//	play_multi_sound('sfx_focus');
			}
		);
		$('#research').click(
			function() {
			//	play_multi_sound('sfx_focus');
			}
		);
		$('#facilities').click(
			function() {
			//	play_multi_sound('sfx_focus');
			}
		);
		$('#development').click(
			function() {
			//	play_multi_sound('sfx_focus');
			}
		);

		$('#process_5').click(
			function(event) {
				specialProcessOpenPanel('development',0,event);
			}
		);
		$('#process_3').click(
			function(event) {
				specialProcessOpenPanel('research',0,event);
			}
		);
		$('#process_1').click(
			function(event) {
				specialProcessOpenPanel('facility',0,event);
			}
		);
		$('#process_6').click(
			function(event) {
				specialProcessOpenPanel('production',0,event);
			}
		);

		$('#process_2').click(
			function() {
				$('#outpostsbutton').click();
			}
		);

		$('#process_7').click(
			function() {
				$('#starmapbutton').click();
				$('#starmapbutton').fadeOut().fadeIn();
				$('#show_prospect_list').delay(800).fadeOut().fadeIn();
				setTimeout('showProspectList()',800);
			}
		);

		$('#process_8').click(
			function() {
				$('#militarybutton').click();
				$('#militarybutton').fadeOut().fadeIn();
				setTimeout('$("#intelligence_main_panel").click()',800);
			}
		);

		$('#process_4').click(
			function(event) {
				specialProcessOpenPanel('alliancedev',0,event);

			}
		);

		$('#process_9').click(
			function() {
				$('#missionsbutton').click();
				$('#missionsbutton').fadeOut().fadeIn();
				//setTimeout('$("#intelligence_main_panel").click()',800);
			}
		);



		enableAvatarUploader();
		setTimeout('updateServerTime()',1000);
		setTimeout('renderEconomyOverview()',2000);
		setTimeout('scrollChatToBottom()',1500);

		setTimeout('recallChannel()',2000);


	});


		var translations={};
		translations.general_error="Error";
		translations.general_yes="Yes";
		translations.general_no="No";
		translations.general_none="None";
		translations.general_unknown="Unknown";
		translations.military_intel_type_scout="Scout";
		translations.military_intel_type_espionage="Espionage";
		translations.military_intel_type_infiltration="Infiltration";
		translations.military_intel_type_spy_sweep="Spy Sweep";
		translations.military_intel_type_infiltration_sweep="Infiltration Sweep";

		translations.military_intel_report_type_scout="Scout-report";
		translations.military_intel_report_type_espionage="Espionage-report";
		translations.military_intel_report_type_infiltration="Infiltration-report";
		translations.homeworld_facility_already_building="Facilities must be built one at the time";
		translations.homeworld_facility_not_enough_res="Not enough resources";
		translations.homeworld_facility_requirements_not_met="Requirements not met";

		translations.general_balanced="Balanced";
		translations.general_matter="InTech";
		translations.general_energy="StronTech";
		translations.general_displacement="NeoTech";


		translations.general_useless="Useless";
		translations.general_abysmal="Abysmal";
		translations.general_horrible="Horrible";
		translations.general_bad="Bad";
		translations.general_poor="Poor";

		translations.general_acceptable="Acceptable";
		translations.general_ok="Ok";
		translations.general_decent="Decent";
		translations.general_adequate="Adequate";
		translations.general_plain="Plain";
		translations.general_average="Average";
		translations.general_fair="Fair";
		translations.general_good="Good";
		translations.general_very_good="Very good";
		translations.general_superb="Superb";
		translations.general_excellent="Excellent";

		translations.donate_string="Are you sure you wish to donate ?1? credits to ?2? ?";

		translations.military_fleet_log_arrival_template="?1? has arrived at ?2?.";
		translations.military_fleet_log_departure_template="?1? has left ?2? and is on it\'s way to ?3?.";

		translations.military_fleet_log_departure_escort_template="?1? is preparing for escort-duty from ?2? to ?3?.";

		translations.military_fleet_log_launch_template="?1? launched on a hostile mission towards ?2?.";
		translations.military_fleet_log_midair_template="?1? was attacked at ?2? while charging it\'s jumpengines.";
		translations.military_fleet_log_missionlaunch_template="?1? has been sent to ?2? on a mission.";
		translations.military_fleet_log_missionreturn_template="?1? has returned to ?2? after a mission.";

		translations.required_points_string="You are required to place ?1? points in the ?2? tech tree.";
		translations.required_points_string_general="You are required to place a total of ?1? points in the tech tree.";

		translations.techpoint_heading="Tech-point awarded!";
		translations.techpoint_facility="You have completed your ?1? and received 1 tech-point which you can spend in the tech-tree.";
		translations.techpoint_research="You have completed your research on ?1? and received 1 tech-point which you can spend in the tech-tree.";
		translations.techpoint_development="You have completed your development-project ?1? and received 1 tech-point which you can spend in the tech-tree.";
		translations.techpoint_production="You have built your first ?1? and received 1 tech-point which you can spend in the tech-tree.";
		translations.techpoint_academy_use="You have promoted a commander from the academy and received 1 tech-point which you can spend in the tech-tree.";
		translations.techpoint_commander_level="One of your commanders has reached the rank of ?1?. You have thus received 1 tech-point which you can spend in the tech-tree.";
		translations.techpoint_claim_outpost="You have claimed your ?1? outpost. 1 tech-point has been awarded.";
		translations.techpoint_upgrade_outpost="One of your outposts has reached level ?1?. 1 tech-point has been awarded.";
		translations.techpoint_gain_level="You have reached level ?1?. 1 tech-point has been awarded.";
		translations.techpoint_intel_operation_scout="You have completed your first successful scout-mission. 1 tech-point has been awarded.";
		translations.techpoint_intel_operation_espionage="You have completed your first successful espionage-mission. 1 tech-point has been awarded.";
		translations.techpoint_intel_operation_infiltration="You have completed your first successful infiltration-mission. 1 tech-point has been awarded.";
		translations.techpoint_completed_mission="You have completed the mission ?1?. 1 tech-point has been awarded.";
		translations.techpoint_prospect="You have prospected your first cluster. 1 tech-point has been awarded.";

		translations.techpoint_complete_mission="You have completed the mission ?1?. 1 tech-point has been awarded.";

		translations.techpoint_wargames_won="You have won your ?1?th wargame. 1 tech-point has been awarded.";

		translations.techpoint_small_wins="You have won your ?1?th Small Win. 1 tech-point has been awarded.";
		translations.techpoint_large_wins="You have won your ?1?th Large Win. 1 tech-point has been awarded.";
		translations.techpoint_huge_wins="You have won your ?1?th Huge Win. 1 tech-point has been awarded.";
		translations.techpoint_tactical_victories="You have won your ?1?th Tactical Victory. 1 tech-point has been awarded.";
		translations.techpoint_underdog_wins="You have won your ?1?th Underdog Win. 1 tech-point has been awarded.";
		translations.techpoint_killed_strength="You have killed a total of ?1? Strength. 1 tech-point has been awarded.";

		translations.position_1="1st";
		translations.position_2="2nd";
		translations.position_3="3rd";
		translations.position_4="4th";
		translations.position_5="5th";
		translations.position_6="6th";
		translations.position_7="7th";
		translations.position_8="8th";
		translations.position_9="9th";
		translations.position_10="10th";

		translations.position_11="11th";
		translations.position_12="12th";
		translations.position_13="13th";
		translations.position_14="14th";
		translations.position_15="15th";
		translations.position_16="16th";
		translations.position_17="17th";
		translations.position_18="18th";
		translations.position_19="19th";
		translations.position_20="20th";

		translations.outpost_abandon_confirmation="Are you sure you wish to abandon this outpost? The outpost will be obliterated.";

		translations.alliance_news_allied_op_inc_attack_with_alliance="Outpost ?1? belonging to ?2? was attacked by ?3? of ?4?.";
		translations.alliance_news_allied_op_inc_attack_without_alliance="Outpost ?1? belonging to ?2? was attacked by ?3?.";

		translations.alliance_news_allied_station_inc_attack_with_alliance="The station ?1? belonging to ?2? was attacked by ?3? of ?4?.";
		translations.alliance_news_allied_station_inc_attack_without_alliance="The station ?1? belonging to ?2? was attacked by ?3?.";

		translations.alliance_news_allied_bank_inc_attack_with_alliance="The alliance bank was attacked by ?1? of ?2?.";
		translations.alliance_news_allied_bank_inc_attack_without_alliance="The alliance bank was attacked by ?1?.";

		// bugged, fix this carefully pls
		translations.alliance_news_allied_bank_launch_attack_with_alliance="The alliance bank of ?1? was attacked by ?2?.";
		translations.alliance_news_allied_bank_launch_attack_without_alliance="The alliance bank of ?1? was attacked by ?2?.";

		translations.alliance_news_allied_hw_inc_attack_with_alliance="The homeworld of ?2?, ?1?, was attacked by ?3? of ?4?.";
		translations.alliance_news_allied_hw_inc_attack_without_alliance="The homeworld of ?2?, ?1?, was attacked by ?3?.";

		translations.alliance_news_allied_project_init="?1? has initiated the project: ?2?! Funds have been taken from the alliance bank.";
		translations.alliance_news_allied_project_done="The Alliance has completed the project: ?1?!";

		translations.alliance_news_allied_launch_op_with_alliance="?1? attacked the outpost ?2? owned by ?3? of ?4?.";
		translations.alliance_news_allied_launch_op_without_alliance="?1? attacked the outpost ?2? owned by ?3?.";

		translations.alliance_news_allied_launch_station_with_alliance="?1? attacked the station ?2? owned by ?3? of ?4?.";
		translations.alliance_news_allied_launch_station_without_alliance="?1? attacked the station ?2? owned by ?3?.";

		translations.alliance_news_allied_launch_hw_with_alliance="?1? attacked ?2?, the homeworld of ?3?, a member of ?4?.";
		translations.alliance_news_allied_launch_hw_without_alliance="?1? attacked ?2?, the homeworld of ?3?.";

		translations.alliance_news_failed_station_upkeep="Your alliance bank could not cover the upkeep-costs for the station-fleet at ?1?.<br>?2? ships were damaged and ?3? ships were destroyed.";
		translations.alliance_news_failed_bankfleet_upkeep="Your alliance bank could not cover the upkeep-costs for the bank-fleet at ?1?.<br>?2? ships were damaged and ?3? ships were destroyed.";

		translations.alliance_confirming_war_declaration="If you declare war on ?1?, your alliance will get a score modifier of ?2? and ?3? will get a score-modifier of ?4?. Are you absolutely sure?";

		translations.alliance_news_joined="?1? has joined the alliance.";
		translations.alliance_news_left="?1? has left the alliance.";
		translations.alliance_news_mission_init="?1? has initiated the mission \'?2?\'.";
		translations.alliance_news_mission_failed="The mission \'?1?\' failed.";
		translations.alliance_news_mission_succeeded="The mission \'?1?\' succeeded!";

		translations.alliance_news_outpost_lost="The outpost was lost.";
		translations.alliance_news_outpost_captured="The outpost was captured.";

		translations.alliance_news_station_lost="The station was lost.";
		translations.alliance_news_station_captured="The station was captured.";

		translations.alliance_news_lost_sector="We have lost control of ?1?.";
		translations.alliance_news_won_sector="We have taken control of ?1?.";

		translations.view_combat="View combat.";
		translations.view_mission="View mission.";

		translations.alliance_news_tax_change_taxed="The alliance has converted to a taxed alliance";
		translations.alliance_news_tax_change_free="The alliance has converted to a free alliance";

		translations.alliance_news_leadership_change="?1? decided to step down, and appointed ?2? as the new leader of the alliance.";

		translations.alliance_news_renamed="The alliance has been renamed to ?1?.";

	</script>
	
		<!-- Google Code for AD Registration Conversion Page -->
		<script type='text/javascript'>
		/* <![CDATA[ */
		var google_conversion_id = 973017891;
		var google_conversion_language = 'en';
		var google_conversion_format = '3';
		var google_conversion_color = 'ffffff';
		var google_conversion_label = 's6aHCPyLolwQo6b8zwM';
		var google_remarketing_only = false;
		/* ]]> */
		</script>
		<script type='text/javascript' src='//www.googleadservices.com/pagead/conversion.js'>
		</script>
		<noscript>
		<div style='display:inline;''>
		<img height='1' width='1' style='border-style:none;'' alt='' src='//www.googleadservices.com/pagead/conversion/973017891/?label=s6aHCPyLolwQo6b8zwM&amp;guid=ON&amp;script=0'>
		</div>
		</noscript>
		
				</div><!-- End main content container-->
				<!-- System Messages -->
				<!--<div class='adlogo' id='logo'></div>-->
				<div class='servertime' id='servertime'></div>
				<div class='new_black_box_behind_notifications'></div>
				<div class='alliance_alert' id='alliance_alert' onclick='allianceAlertClick()' style='display:none' title='Alliance News'></div>
				<div class='attack_alert' id='attack_alert' onclick='attackAlertClick()' style='display:none' title='Personal News'></div>

				<div class='systemtextcontainer'>
					<div class='systemtext' id='systemtext'>
						<div class='systexticon'>
							<img class='systexticonimg' id='systeminfo_image' src='images/fixed/systemicon.png' />
						</div>
						<div class='systemtext_header' id='systemtext_header'>Update</div>
						<div class='systemtext_body' id='systemtext_body'>A minor hotfix has been applied to prevent resources from 'leaking' at outposts whose capacity is at max.</div>
					</div>
				</div>

				<div class='gracetime_container' id='gracetime_container' style='z-index:10;cursor:pointer;' onclick='cancelGraceTimeClick()'><span>Remaining grace-time</span><br><span id='grace_time_counter'></span></div>
				<!-- End System Messages -->

				<!-- Help Overlay -->
				<div class='help_overlay_container' id='help_overlay' style='display: none;'>
					<div class='help_overlay_box' style='top: 45px;left: 220px;height: 138px;width: 437px; vertical-align:middle;'>
						<div style='padding-top: 37px;'>Clicking this panel opens up all the options for the production of units on your homeworld. These are used to fill your military fleets, provide transports and utility ships for miscellneaous activites. Make sure you have something in production so long as you have the resources for it.</div>
					</div>
					<div class='help_overlay_box' style='top: 5px;left: 5px;height: 115px;width: 155px;'>
						<div style='padding-top: 9.316666603088379px;'>These buttons navigate the main areas of the game, each containing openable panels that provide you with easy access to specific game-functions.</div>
					</div>
					<div class='help_overlay_box' style='top: 155px;left: 5px;height: 210px;width: 155px;'>
						<div style='padding-top: 57px;'>This area reiterates the latest events from your nation. Any new news will immediately be updated in this window, so you can follow unfolding events as they happen.</div>
					</div>
					<div class='help_overlay_box' style='bottom: 0px;left: 219px;height: 70px;width: 260px;'>
						<div style='padding-top: 3px;'>This display shows the current active researches, developments and other ongoing building activities of yours. Click on any one of them to open the associated panel directly.</div>
					</div>
					<div class='help_overlay_box' style='right: 15px;top: 44px;height: 322px;width: 445px;'>
						<div style='padding-top: 145px;'>This panel shows a summary of your game so far. You can also rename your planet by clicking on the name of the planet. Give it a shot.</div>
					</div>
				</div>
				<!-- End Help Overlay -->

				<!-- THE NEW BATTLE VIEW! -->
				<div id='battle_container' class='main_content_container combat_view' style='display:none;'>
					<div class='battle_live_stats' id='battle_live_stats'>
						<img class='in_battle_planet' id='in_battle_planet' src='images/planets/outpost_planets/planettype09.jpg'>
						<div class='in_battle_planet_name' id='in_battle_planet_name'>Utmarin Ago Prime</div>
						<div class='battle_planet_type' id='battle_planet_type'>Outpost</div>
						<div class='gauges_header'>Status %</div>
						<div class='capitals_gauge'>
							<div class='gauge_name'>Capitals</div>
							<div class='capitals_att_gauge_container'>
								<div id='att_capitals'></div>
							</div>
							<div class='capitals_def_gauge_container'>
								<div id='def_capitals'></div>
							</div>
							<div class='att_ret_ver'></div>
							<div class='def_ret_ver'></div>
						</div>
						<div class='firepower_gauge'>
							<div class='gauge_name'>Firepower</div>
							<div class='firepower_att_gauge_container'>
								<div id='att_firepower'></div>
							</div>
					    	<div class='firepower_def_gauge_container'>
					    		<div id='def_firepower'></div>
					    	</div>
							<div class='att_ret_ver'></div>
							<div class='def_ret_ver'></div>

					    </div>
					    <div class='hull_gauge'>
							<div class='gauge_name'>Hull</div>
							<div class='hull_att_gauge_container'>
					    		<div id='att_hull'></div>
					    	</div>
					    	<div class='hull_def_gauge_container'>
					    		<div id='def_hull'></div>
					    	</div>
							<div class='att_ret_ver'></div>
							<div class='def_ret_ver'></div>

						</div>

					</div>

					<div class='battle_controls' id='battle_controls'>
						<div class='music_toggle' id='combat_music_toggle' onclick='toggleCombatMusic()'></div>
						<div class='sound_toggle' id='combat_sfx_toggle' onclick='toggleCombatSound()'></div>

						<div class='turn_container'>
							<div class='gauge_name'>Turn</div>
							<div class='turn_counter_indicator' id='turn_circle'>
								<div class='turn_counter_number' id='turn_digit'></div>
							</div>
						</div>


						<div class='battle_tactics_view' onclick='toggleCombatTacticsViewer()'>
							<div class='gauge_name'>Tactical panel</div>
							<div class='tactics_status' id='tactics_status' >Click to open</div>
						</div>

						<div class='speed_gauge' id='speed_gauge'>
							<div class='com_pb_slower' onclick='parseCombatSlower()'></div><div class='com_pb_playpause' onclick='pauseCombat()'></div><div class='com_pb_faster' onclick='parseCombatFaster()'></div>
							<div class='speed_indicator normal' id='combat_speed_indicator'></div>
						</div>

						<div class='com_options_container'>
							<div class='gauge_name'>Presentation Options</div>
							<div class='hoz_control_option' id='battle_control01' onclick='toggleCombatCommentary()'>
								<div class='control_track'>
									<div class='control_left'>Text On</div><div class='control_right'>Text Off</div>
								</div>
								<div class='control_pot pot_on' id='combat_text_on_off'></div>
							</div>
							<div class='hoz_control_option' id='battle_control02' onclick='toggleFullCombatOutput()'>
								<div class='control_track'>
									<div class='control_left'>Full Text</div><div class='control_right'>Summary Text</div>
								</div>
								<div class='control_pot'  id='combat_fulltext_summary'></div>
							</div>
							<div class='hoz_control_option' id='battle_control03' onclick='toggleExtraFX()'>
								<div class='control_track'>
									<div class='control_left'>Extra FX On</div><div class='control_right'>Extra FX Off</div>
								</div>
								<div class='control_pot' id='combat_extrafx_on_off'></div>
							</div>
							<!--
							<div class='ver_control_option' id='battle_control02'>
								<div class='control_track'></div><div class='control_pot'></div>
							</div>
							-->
						</div>

						<div id='close_battle' class='fixed_button fixed_button_160_double close_battle_button'  onclick='closeBattleViewClick()'>
							<div class='fixed_button_regular_double'></div>
							<div class='fixed_button_hover blue_double' style='opacity: 0;'></div>
							<div class='fixed_button_click blue_double'></div>
							<div class='dyna_button_text type3'>Exit Battle</div>
						</div>
						<div class='combat_link_container'>
							<span class='combat_link_header'>Link: </span>
							<span class='combat_link_entry' id='debug_launch_id' style='color:orange;-webkit-touch-callout: default; -webkit-user-select: text; -khtml-user-select: text; -moz-user-select: text; -ms-user-select: text; cursor:pointer;' title='Click to paste combat-link to the the chat-input. Shift+Click to paste a summary-link in stead. CTRL+Click to open the combat in a new tab or window in stead.' onclick='addChatCombatLink(event)'></span>
						</div>


					</div>



					<div class='battle_stats_field' id='battle_stats_field'>

			    		<div class='metrics_header'>METRICS</div>
			    		<div class='battle_numbers'>
			    			<div id='att_fleets'>2</div>
			    			<div>Fleets</div>
			    			<div id='def_fleets'>7</div>

			    			<div id='att_capital_ships'>128</div>
			    			<div>Capitals</div>
			    			<div id='def_capital_ships'>55</div>

			    			<div id='att_losses'>4890</div>
			    			<div>Losses</div>
			    			<div id='def_losses'>3636</div>
			    		</div>

			        	<div class='battle_stat_str_gauge'>
			        		<div class='gauge_name'>Fleet strengths</div>

			        		<div class='str_att_gauge_container'>
			        			<div id='str_gauge_att'></div>
			        		</div>
			        		<div class='str_def_gauge_container'>
			        			<div id='str_gauge_def'></div>
			        		</div>
			        		<div class='str_gauge_nr att' id='att_strength'>0</div>
			        		<div class='str_gauge_nr def' id='def_strength'>0</div>
			        	</div>
			        	<div class='battle_stat_losses_gauge'>
			        		<div class='gauge_name'>Relative Losses</div>
			        		<div class='battle_stat_losses_gauge_container'>
			        			<div class='battle_losses_att_gauge'>
			        				<div id='negative_losses'></div>
			        			</div>
			        			<div class='battle_losses_def_gauge'>
									<div id='positive_losses'></div>
			        			</div>
			        		</div>
			        	</div>

						<div class='battle_values'>
        					<div class='battle_values_header'>Fleet Values</div>
        					<div class='att_value_meter' id='att_costs'>0</div>
							<div class='def_value_meter' id='def_costs'>0</div>
						</div>

					</div>

						<div class='battle_attacker_field'>
						<div class='battle_playername' id='att_playername'>---</div>
						<div class='battle_commander_container'>
							<div class='attacker_commander_img_container'>

								<img id='combat_att_commander_bg' src='images/commanders/nobg.jpg' class='attacker_commander_img flip_img'>
								<img id='combat_att_commander_uniform' src='images/commanders/nouniform.png' class='attacker_commander_img flip_img'>
								<img id='combat_att_commander_head' src='images/commanders/nohead.png' class='attacker_commander_img flip_img'>

							</div>
							<div class='battle_comm_name_rank'>
								<div class='battle_comm_text'><span id='att_commander_rank'>---</span><br><span class='battle_comm_text_name' id='att_commander_name'>---</span></div>
								<img id='att_commander_insignia_image' class='battle_comm_rank_img' src='images/icons/insignias/rank09.png'>
							</div>
						</div>
						<div class='battle_capitals_field'>
							<div class='battle_capitals_container' id='att_capitals_container'>

							</div>
						</div>
						<div class='battle_minor_ships_container' id='att_minors_container'>

						</div>

					</div>
					<div class='battle_defender_field'>
						<div class='battle_playername right'  id='def_playername'>---</div>
						<div class='battle_commander_container'>
							<div class='attacker_commander_img_container right'>
								<img id='combat_def_commander_bg' src='images/commanders/nobg.jpg' class='attacker_commander_img'>
								<img id='combat_def_commander_uniform' src='images/commanders/nouniform.png' class='attacker_commander_img'>
								<img id='combat_def_commander_head' src='images/commanders/nohead.png' class='attacker_commander_img'>

							</div>
							<div class='battle_comm_name_rank right'>
								<div class='battle_comm_text'><span id='def_commander_rank'>---</span><br><span class='battle_comm_text_name' id='def_commander_name'>---</span></div>
								<img id='def_commander_insignia_image' class='battle_comm_rank_img' src='images/icons/insignias/rank05.png'>
							</div>
						</div>

						<div class='battle_capitals_field right'>
							<div class='battle_capitals_container'  id='def_capitals_container'>

							</div>
						</div>
						<div class='battle_minor_ships_container right' id='def_minors_container'>

						</div>
						<div class='battle_short_separator'></div>
						<div class='battle_defenses_container'  id='def_defense_container'>

						</div>

					</div>
					<!--  display:none;position:absolute;top: 167px;left: 527px;  -->
					<div id='battlepane' class='battlepane'>
						<img id='in_combat_planet' style='position: absolute; top: 167px; left: 525px; opacity: 1; transform: scale(1,3);' src='images/planets/planettype6.png'>
						<canvas id='combatcanvas' style='position:absolute;height:700px;width:700px;'></canvas>
						<canvas id='minorcanvas' style='position:absolute;height:700px;width:700px;'></canvas>
						<canvas id='rightcombatcanvas' style='position:absolute;height:700px;width:700px;'></canvas>
						<canvas id='rightminorcanvas' style='position:absolute;height:700px;width:700px;'></canvas>

						<canvas id='effectcanvas' style='position:absolute;height:700px;width:700px;'></canvas>
						<div class='tactical_viewer' id='tactical_viewer'>
							<!--<div class='tactics_button' onclick='toggleCombatTacticsViewer()'>Tactics</div>-->
							<div class='tactics_view' id='combat_tactics_view' onclick='toggleCombatTacticsViewer()'>
								<div class='tactical_inner_subset'>
									<div class='tactics_selected_viewer' id='combat_att_tactics_target_priority'>N/A</div>
									<div class='tactical_list_header viewer'>Target Priority</div>
									<div class='tactics_selected_viewer' id='combat_def_tactics_target_priority'>N/A</div>
								</div>
								<div class='tactical_inner_subset'>
									<div class='tactics_selected_viewer' id='combat_att_tactics_target_switching'>N/A</div>
									<div class='tactical_list_header viewer'>Target Re-evaluation</div>
									<div class='tactics_selected_viewer' id='combat_def_tactics_target_switching'>N/A</div>
								</div>
								<div class='tactical_inner_subset'>
									<div class='tactics_selected_viewer' id='combat_att_tactics_fighter_priority'>N/A</div>
									<div class='tactical_list_header viewer'>Fighter Priority</div>
									<div class='tactics_selected_viewer' id='combat_def_tactics_fighter_priority'>N/A</div>
								</div>
								<div class='tactical_inner_subset'>
									<div class='tactics_selected_viewer' id='combat_att_tactics_corvette_priority'>N/A</div>
									<div class='tactical_list_header viewer'>Corvette Priority</div>
									<div class='tactics_selected_viewer' id='combat_def_tactics_corvette_priority'>N/A</div>
								</div>
								<div class='tactical_inner_subset'>
									<div class='tactical_list_header solo'>Retreat condition</div>
									<div class='tactics_selected_viewer' id='combat_att_tactics_retreat_percent'>N/A</div>
									<div class='tactical_list_subheader viewer'>Call retreat</div>
									<div class='tactics_selected_viewer' id='combat_def_tactics_retreat_percent'>N/A</div>
									<div class='tactics_selected_viewer selected' id='combat_att_tactics_retreat_type'>N/A</div>
									<div class='tactical_list_subheader viewer'>of remaining</div>
									<div class='tactics_selected_viewer selected' id='combat_def_tactics_retreat_type'>N/A</div>
									<div class='tactics_selected_viewer selected' id='combat_att_tactics_retreat_if_unwinnable'>N/A</div>
									<div class='tactical_list_subheader viewer'>Retreat if unwinnable?</div>
									<div class='tactics_selected_viewer selected' id='combat_def_tactics_retreat_if_unwinnable'>N/A</div>
									<div class='tactics_selected_viewer selected' id='combat_att_tactics_retreat_if_even_losses'>N/A</div>
									<div class='tactical_list_subheader viewer'>But if losses are even...</div>
									<div class='tactics_selected_viewer selected' id='combat_def_tactics_retreat_if_even_losses'>N/A</div>

								</div>
							</div>
						</div>

						<div id='combat_waiting_outer' class='combat_waiting_outer' style='position:absolute;top:50px;left:0px;width:100%;text-align:center;display:none;'><div class='combat_waiting_inner' style='color:white;'>Waiting for fleet-update....</div></div>

						<!--<div class='transbg'></div>-->
						<div id='combat_title_att' class='combat_title_att'>
							<div class='combat_entry_span'><span>Attacker</span><br /><span id='attackerName'>Attacker</span></div>
							<div class='combat_entry_span'><img class='playerimg' id='attackerPlayerImg' src='images/fixed/defaultplayer.jpg' /><img class='allianceimg' id='attackerAllianceImg' src='images/fixed/defaultcrest.jpg' /></div>
						</div>
						<div id='combat_title_def' class='combat_title_def'>
							<div class='combat_entry_span'><span>Defender</span><br /><span id='defenderName'>Defender</span></div>
							<div class='combat_entry_span'><img class='playerimg' id='defenderPlayerImg' src='images/fixed/defaultplayer.jpg' /><img class='allianceimg' id='defenderAllianceImg' src='images/fixed/defaultcrest.jpg' /></div>
						</div>
						<div id='combat_planet' class='combat_location'>
							<img id='locationPlanetImg' src='images/planets/planettype05.png' height='250' />
							<div id='location_title' class='combat_location_title'><span id='locationName'>Abrobattem Prime</span>
								<div id='location_title' class='combat_location_entry_span'><span id='locationCoords'>[12:4:11:6.8]</span></div>
							</div>
						</div>
						<div class='combat_mission_container' id='combat_mission_container'>
							<img id='combatMissionImg' class='combatMissionImg' src='images/fixed/missions/mission_pack_img_5.jpg'>
							<div class='left_frame' id='leftFrame'></div>
							<div class='right_frame' id='rightFrame'></div>
							<div class='left_line' id='leftLine'></div>
							<div class='right_line' id='rightLine'></div>
							<div class='mission_header_container' id='missionHeaderCont'>
								<span id='combat_mission_pack_name'>The Mission Pack</span>
								<span id='combat_mission_name'>The Mission Name</span>
							</div>
						</div>


						<div class='combat_summary_pane'>
							<div class='com_sum_top'>
								<img id='location_planet_img_sum' class='com_sum_planet_img' src='images/planets/planettype05.png' height='250' style='left: 0px; -webkit-transform: rotate(0deg);'/>
								<div class='combat_result_text' style='-webkit-transform: scale(1, 1);'>
									<span id='combat_summary_short_result_text'>Attacker wins</span>
									<div class='combat_location_entry_span com_sum' id='combat_summary_secondary_short_result_text'>Outpost Claimed</div>
								</div>
								<div id='combat_location_title_sum' class='combat_location_title com_sum' style='left: 115px;'>
									<span id='combat_summary_planet_name'>The Embattled Planet</span>
									<div class='combat_location_entry_span'>Battle Summary</div>
								</div>

								<img id='combatMissionSumImg' class='combatMissionImg' src='images/fixed/missions/mission_pack_img_5.jpg'>
								<div class='combatMissionSumText' id='comSumEndText'>Mission Successful</div>
								<div class='left_frame' id='leftSumFrame' style='transform: translate(0px, 0px); top: 5px;'></div>
								<div class='right_frame' id='rightSumFrame' style='transform: translate(0px, 0px); top: 5px;'></div>
								<div class='left_line' id='leftSumLine' style='transform: translate(0px, 0px); top: 70px;'></div>
								<div class='right_line' id='rightSumLine' style='transform: translate(0px, 0px); top: 170px;'></div>

							</div>
							<div class='com_sum_combatant_list'>
								<div class='com_sum_side_entry'>
									<div id='combat_summary_att_nickname'>Mr. Soft</div>
								</div>
								<div class='com_sum_center_entry'>
									<div>Player</div>
								</div>
								<div class='com_sum_side_entry'>
									<div id='combat_summary_def_nickname'>Dr. Moustachenbarte</div>
								</div>
								<div class='com_sum_side_entry'>
									<div  id='combat_summary_att_alliancename'>The Finer Alliance</div>
								</div>
								<div class='com_sum_center_entry'>
									<div>Alliance</div>
								</div>
								<div class='com_sum_side_entry'>
									<div id='combat_summary_def_alliancename'>Schadenfreunde</div>
								</div>
							</div>
							<div class='com_sum_ship_sum'>
								<div class='com_sum_side_entry'>
									<div>Attacker</div>
								</div>
								<div class='com_sum_center_entry'>
								</div>
								<div class='com_sum_side_entry'>
									<div>Defender</div>
								</div>
								<div class='com_sum_side_entry com_sum_line'>
									<div>
										<div class='com_sum_half'>Total</div>
										<div class='com_sum_half'>Lost</div>
									</div>
								</div>
								<div class='com_sum_center_entry com_sum_line'>
									<div>Ships</div>
								</div>
								<div class='com_sum_side_entry com_sum_line'>
									<div>
										<div class='com_sum_half'>Total</div>
										<div class='com_sum_half'>Lost</div>
									</div>
								</div>
							</div>

							<div class='com_sum_ship_numbers'>
								<div class='com_sum_side_entry com_sum_line'>
									<div>
										<div class='com_sum_half' id='com_sum_att_frigates_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_frigates_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_att_cruisers_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_cruisers_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_att_battleships_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_battleships_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_att_carriers_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_carriers_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_att_transports_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_transports_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_att_utility_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_utility_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_att_defenses_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_defenses_lost'>0</div>
									</div>
								</div>
								<div class='com_sum_center_entry com_sum_line'>
									<div>Frigates</div>
									<div>Cruisers</div>
									<div>Battleships</div>
									<div>Carriers</div>
									<div>Transports</div>
									<div>Utility Ships</div>
									<div>Defenses</div>
								</div>
								<div class='com_sum_side_entry com_sum_line'>
									<div>
										<div class='com_sum_half' id='com_sum_def_frigates_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_frigates_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_def_cruisers_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_cruisers_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_def_battleships_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_battleships_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_def_carriers_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_carriers_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_def_transports_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_transports_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_def_utility_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_utility_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_def_defenses_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_defenses_lost'>0</div>
									</div>
								</div>
							</div>
							<div class='com_sum_ship_numbers'>
								<div class='com_sum_side_entry com_sum_line'>
									<div>
										<div class='com_sum_half' id='com_sum_att_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_lost'>0</div>
									</div>
								</div>
								<div class='com_sum_center_entry com_sum_line'>
									<div>Total</div>
								</div>
								<div class='com_sum_side_entry com_sum_line'>
									<div>
										<div class='com_sum_half' id='com_sum_def_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_lost'>0</div>
									</div>
								</div>
							</div>
							<div class='com_sum_ship_numbers'>
								<div class='com_sum_side_entry'>
									<div>
										<div class='com_sum_half' id='com_sum_att_fighters_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_fighters_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_att_corvettes_total'>0</div>
										<div class='com_sum_half' id='com_sum_att_corvettes_lost'>0</div>
									</div>
								</div>
								<div class='com_sum_center_entry'>
									<div>Fighter-wings</div>
									<div>Corvette-wings</div>
								</div>
								<div class='com_sum_side_entry'>
									<div>
										<div class='com_sum_half' id='com_sum_def_fighters_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_fighters_lost'>0</div>
									</div>
									<div>
										<div class='com_sum_half' id='com_sum_def_corvettes_total'>0</div>
										<div class='com_sum_half' id='com_sum_def_corvettes_lost'>0</div>
									</div>
								</div>
							</div>
							<div class='com_sum_ship_numbers'>
								<div class='com_sum_side_entry'>
									<div id='combat_summary_att_xp'></div>
								</div>
								<div class='com_sum_center_entry'>
									<div>XP</div>
								</div>
								<div class='com_sum_side_entry'>
									<div id='combat_summary_def_xp'></div>
								</div>
							</div>

							<div class='com_sum_ship_numbers com_sum_bottom' id='com_sum_stolen_header'>Stolen resources</div>
							<div class='tax_summary_resources' id='com_sum_stolen'>
								<div class='summary_entry hs' id='com_sum_stolen_h'>0</div>
								<div class='summary_entry in' id='com_sum_stolen_i'>0</div>
								<div class='summary_entry sr' id='com_sum_stolen_s'>0</div>
								<div class='summary_entry nd' id='com_sum_stolen_n'>0</div>
							</div>
							<div class='com_sum_ship_numbers com_sum_bottom' id='com_sum_bonus_header'>Combat Win Bonus</div>
							<div class='tax_summary_resources' id='com_sum_bonus'>
								<div class='summary_entry hs' id='com_sum_bonus_h'>0</div>
								<div class='summary_entry in' id='com_sum_bonus_i'>0</div>
								<div class='summary_entry sr' id='com_sum_bonus_s'>0</div>
								<div class='summary_entry nd' id='com_sum_bonus_n'>0</div>
							</div>


							<div class='com_sum_ship_numbers com_sum_bottom' id='com_sum_commander_details_text_container'></div>
							<div class='com_sum_ship_numbers com_sum_bottom' id='share_combat_container'></div>
						</div>
					</div>

					<div class='ship_info_plate' id='ship_info_plate_left' style='width: 0px; display: none; overflow: hidden;' onclick='hideCombatShipPanel(this)'>
						<div class='ship_info_plate_container'>
							<div class='ship_info_plate_stats'>
								<div class='battle_stat_entry shipinfo right'>Class:</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_class_left'>Battleship</div>
								<div class='battle_stat_entry shipinfo right'>Firepower:</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_firepower_left'>0</div>
								<div class='battle_stat_entry shipinfo right'>Shields:</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_shield_left'>0</div>
								<div class='battle_stat_entry shipinfo right'>Hull</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_hull_left'>0</div>
								<div class='battle_stat_entry shipinfo right'>Manoeuvrability:</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_manoeuvre_left'>0</div>
							</div>
							<img class='capital_ship_img info_plate'  id='ship_info_plate_image_left' src='images/icons/miniships/100x100/418.png'>
						</div>
						<div class='selected_item_nametab ship_info_plate_tab'>
							<div class='selected_item_name' id='ship_info_plate_name_left'>THE STARBEAMER</div>
						</div>
					</div>

					<div class='ship_info_plate ship_info_plate_right' id='ship_info_plate_right' style='width: 0px; display: none; overflow: hidden;' onclick='hideCombatShipPanel(this)'>
						<div class='ship_info_plate_container'>
							<div class='ship_info_plate_stats'>
								<div class='battle_stat_entry shipinfo right'>Class:</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_class_right'>Battleship</div>
								<div class='battle_stat_entry shipinfo right'>Firepower:</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_firepower_right'>0</div>
								<div class='battle_stat_entry shipinfo right'>Shields:</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_shield_right'>0</div>
								<div class='battle_stat_entry shipinfo right'>Hull</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_hull_right'>0</div>
								<div class='battle_stat_entry shipinfo right'>Manoeuvrability:</div>
								<div class='battle_stat_header shipinfo right' id='ship_info_plate_manoeuvre_right'>0</div>
							</div>
							<img class='capital_ship_img info_plate'  id='ship_info_plate_image_right' src='images/icons/miniships/100x100/418.png'>
						</div>
						<div class='selected_item_nametab ship_info_plate_tab'>
							<div class='selected_item_name' id='ship_info_plate_name_right'>THE STARBEAMER</div>
						</div>
					</div>

					<!--
					<div class='tactical_plate' style='width: 0px; bottom: 0px; height: 686px; display: none; overflow: hidden;'>
						<div class='inner_tactical_plate' id='inner_tactics'>
							<div class='tactical_inner_subset'>
								<div class='tactical_list_header'>Target Priority</div>
								<div class='tactical_list_subheader'>Take-down priority</div>
								<div id='tac_01_01' class='tactical_list selected' onclick='selectTactic(tac_01_01)'><span>Total Firepower</span></div>
								<div id='tac_01_02' class='tactical_list' onclick='selectTactic(tac_01_02)'><span>Primary Firepower</span></div>
								<div id='tac_01_05' class='tactical_list' onclick='selectTactic(tac_01_05)'><span>Most Hull</span></div>
								<div id='tac_01_06' class='tactical_list' onclick='selectTactic(tac_01_06)'><span>Least Hull</span></div>
								<div id='tac_01_07' class='tactical_list' onclick='selectTactic(tac_01_07)'><span>Least Manoeuvrability</span></div>
								<div id='tac_01_08' class='tactical_list' onclick='selectTactic(tac_01_08)'><span>Most Manoeuvrability</span></div>
								<div id='tac_01_09' class='tactical_list' onclick='selectTactic(tac_01_09)'><span>Closest Ship</span></div>
							</div>
							<div class='tactical_inner_subset'>
								<div class='tactical_list_header'>Target Re-evaluation</div>
								<div class='tactical_list'><span>Consider switching</span></div>
								<div class='tactical_list selected'><span>Do not switch</span></div>
							</div>
							<div class='tactical_inner_subset'>
								<div class='tactical_list_header'>Fighter Priority</div>
								<div class='tactical_list selected'><span>Defensive Positioning</span></div>
								<div class='tactical_list'><span>Corvette Coverage</span></div>
								<div class='tactical_list'><span>Ship-to-ship</span></div>
							</div>
							<div class='tactical_inner_subset'>
								<div class='tactical_list_header'>Corvette Priority</div>
								<div class='tactical_list selected'><span>Defensive Orders</span></div>
								<div class='tactical_list'><span>Offensive Orders</span></div>
							</div>
							<div class='tactical_inner_subset'>
								<div class='tactical_list_header'>Retreat condition</div>
								<div class='tactical_list_subheader'><span>Call retreat at</span></div>
								<div>
									<div class='tactical_list'><span>At 60% remaining</span></div>
									<div class='tactical_list'><span>At 50%</span></div>
									<div class='tactical_list'><span>At 40%</span></div>
									<div class='tactical_list selected'><span>At 30%</span></div>
									<div class='tactical_list'><span>At 20%</span></div>
									<div class='tactical_list'><span>At 10%</span></div>
								</div>
								<div class='tactical_list_subheader'><span>of remaining</span></div>
								<div>
									<div class='tactical_list selected'><span>Total Firepower</span></div>
									<div class='tactical_list'><span>Capital Ships</span></div>
									<div class='tactical_list'><span>Total Hull</span></div>
								</div>
								<div class='tactical_list_subheader'><span>Retreat if unwinnable?</span></div>
								<div>
									<div class='tactical_list selected'><span>Yes</span></div>
									<div class='tactical_list'><span>No</span></div>
								</div>
								<div class='tactical_list_subheader'><span>But if losses are even...</span></div>
								<div>
									<div class='tactical_list'><span>Retreat anyway</span></div>
									<div class='tactical_list selected'><span>Stay and Fight</span></div>
								</div>
							</div>
							<div class='fixed_button fixed_button_320' id='update_tactical_selection' style='left: 120px;'>
								<div class='fixed_button_regular regular_320' style='opacity: 1;'></div>
								<div class='fixed_button_hover green_320' style='opacity: 0;'></div>
								<div class='fixed_button_click green_320'></div>
								<div class='dyna_button_text type2'>Submit Tactical Change</div>
							</div>
						</div>
					</div>   -->
				</div> <!-- END NEW BATTLE VIEW -->

				<!-- Chat Panel -->
				<div id='chatpane' class='chatpane'>
					<!--
					<div class='player_comm_header_field' id='forumheaders'>
						<div class='forumheaderfield' id='forumheaderfield'>
							<div class='player_comm_header_container'>
								<div class='player_comm_header_text'>Forums</div>
							</div>
							<div class='player_comm_entry_container' id='latest_forum_threads'></div>
						</div>
						<div class='forumheaderfield' id='allianceheaderfield'>
							<div class='player_comm_header_container'>
								<div class='player_comm_header_text'>Alliance</div>
							</div>
							<div class='player_comm_entry_container' id='latest_alliance_threads'></div>
						</div>
						<div class='forumheaderfield' id='mailheaderfield'>
							<div class='player_comm_header_container'>
								<div class='player_comm_header_text'>Messages</div>
							</div>
							<div class='player_comm_entry_container' id='latest_messages'></div>
						</div>
					</div>
					-->

					<div id='chat_channel_buttons_container' class='chat_channel_buttons_container'>
			            <div class='chat_header_1 chat_heading' id='global' onclick="selectChatChannel('global')"><div class='chat_activity_indicator'></div><div class='chat_unread_indicator'></div>Galaxy</div>
			            <div class='chat_header_2 chat_heading' id='local' onclick="selectChatChannel('help')"><div class='chat_activity_indicator'></div><div class='chat_unread_indicator'></div>Help</div>
			            <div class='chat_header_3 chat_heading' id='group' onclick="selectChatChannel('alliance')"><div class='chat_activity_indicator'></div><div class='chat_unread_indicator'></div>Alliance</div>
						<div class='chat_header_4 chat_heading' id='view_combat_text' onclick="selectChatChannel('combat')">Battle Log</div>

						<!--
							<div class='chat_header_4 chat_heading' id='view_headers'>Headers</div>
							<div class='chat_header_1 chat_heading' id='forumtopics'>Forums</div>
							<div class='chat_header_2 chat_heading' id='alliancetopics'>Alliance</div>
							<div class='chat_header_3 chat_heading' id='messageheaders'>Messages</div>
							<div class='chat_header_4 chat_heading' id='view_channels'>Channels</div>
						-->
			         </div>

					<div class='vert_chat_line'>
						<div class='vert_underline' id='underline'></div>
						<div class='vert_sections'></div>
						<div class='vert_overline' id='overline'></div>
					</div>

					<div class='chat_functions_off' id='chatfunctionsoff'></div>
					<div class='chat_functions' id='chatfunctions'>
						<div id='slot1' class='chat_func_1' onclick='chatMaxclick()'></div>
						<div id='slot2' class='chat_func_2'></div>
						<div id='slot3' class='chat_func_3'></div>
						<div id='slot4' class='chat_func_4'></div>
					</div>

					<div class='chatbg' id='chatbg'></div>

					<div id='chatcontent' class='chat_container'>
						<div class='chat_wrapper' role='log' aria-live='polite' id='global_chat_container_table_body' style='display:none; -webkit-touch-callout: default; -webkit-user-select: text; -khtml-user-select: text; -moz-user-select: text; -ms-user-select: text; ' >
						</div>
						<div class='chat_wrapper' id='quadrant_chat_container_table_body'  style='display:none; -webkit-touch-callout: default; -webkit-user-select: text; -khtml-user-select: text; -moz-user-select: text; -ms-user-select: text; ' >
						</div>
						<div class='chat_wrapper' id='alliance_chat_container_table_body'   style='display:none; -webkit-touch-callout: default; -webkit-user-select: text; -khtml-user-select: text; -moz-user-select: text; -ms-user-select: text; '>
						</div>
						<div class='chat_wrapper' role='log' aria-live='polite' id='combat_commentary_container'   style='display:none; -webkit-touch-callout: default; -webkit-user-select: text; -khtml-user-select: text; -moz-user-select: text; -ms-user-select: text; '>
							<div>Waiting for communication-signal...Please stand by...</div>
						</div>
					</div>
					<div class='chat_input_wrapper' id='chat_input'><textarea id='chat_input_field' maxlength='300' class='chat_input input_styling_dark mousetrap' placeholder='Click and type here...'></textarea></div>

					<div class='player_info_bubble_wrapper'>

						<div class='player_info_bubble'>
							<div id='playerIDmsg' class='info_bubble_chat'></div>
							<div class='info_bubble_avatar' id='playerID'>
								<img src='images/planets/outpost_planets/planettype11.jpg'  id='playerIDplanetimg' >
							</div>
							<div class='info_bubble_name' id='playerIDname'></div>
							<div class='info_bubble_alliance' id='playerIDalliance'></div>
							<div class='info_bubble_homeworld' id='playerIDhwname'></div>
							<div class='info_bubble_strength' id='playerIDstrength'></div>
							<div class='bottomslide_close' onclick='hideChatPlayerInfo()'><img src='images/fixed/cancel.png'></div>
						</div>

					</div>
				</div>
				<!-- End Chat Panel-->


				<div class='simple_plate' id='simple_popup' >
					<div class='simple_box_header' id='simple_header_text' >Not so long text</div>
					<div class='simple_box_text' id='simple_main_text'>This could be a long text! </div>
					<div class='simple_accept' >
						<div class='lightbutton160' id='simple_ok_button' onclick='hideSimpleBox()'>
							<div class='buttontext24' id='simple_ok_button_text'>Ok</div>
						</div>
					</div>
				</div>

				<div class='large_plate' id='large_popup' >
					<img class='large_plate_bg_img' id='large_plate_bg_img' src='images/planets/planettype04.png'>
					<div class='large_box_header' id='large_header_text' >Combat Summary</div>
					<div class='large_box_text' id='large_main_text'></div>
					<div class='large_accept' >
						<div class='lightbutton160' id='large_ok_button' onclick='hideSimpleBoxLarge()'>
							<div class='buttontext24' id='large_ok_button_text'>Close</div>
						</div>
					</div>
				</div>

				<div class='nemesis_plate' id='nemesis_popup' >
					<img class='nemesis_plate_bg_img' id='nemesis_plate_bg_img' src='images/fixed/conceptship1.jpg'>
					<div class='nemesis_box_header' id='nemesis_header_text' >Nemesis List</div>
					<div class='nemesis_box_text' id='nemesis_main_text'></div>
					<div class='nemesis_accept' >
						<div class='lightbutton160' id='nemesis_ok_button' onclick='hideSimpleBoxNemesis()'>
							<div class='buttontext24' id='nemesis_ok_button_text'>Close</div>
						</div>
					</div>
				</div>

			</div><!-- End main_bg  -->

			<div class='simple_plate' id='simple_popup_2' >
				<div class='simple_box_header' id='simple_header_text_2' >Not so long text</div>
				<div class='simple_box_text' id='simple_main_text_2'>This could be a long text! </div>
				<div class='simple_accept_2' style='float:left;'>
					<div class='lightbutton160' id='simple_ok_button_2' onclick='hideSimpleBox2()'>
						<div class='buttontext24' id='simple_ok_button_text_2'>Ok</div>
					</div>
				</div>
				<div class='simple_cancel_2' style='float:right;' >
					<div class='lightbutton160' id='simple_cancel_button_2' onclick='hideSimpleBox2()'>
						<div class='buttontext24' id='simple_cancel_button_text_2'>Ok</div>
					</div>
				</div>

			</div>

		</body><!-- End Body -->
	</html>
